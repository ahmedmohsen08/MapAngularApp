(self.webpackChunkmap_app=self.webpackChunkmap_app||[]).push([[179],{6089:(bt,Qe,pe)=>{"use strict";var he=pe(9095),de=pe(4703),_e="value",p="\n  ",H={};function fe(ie){var W=Array.isArray(ie);return function(Y){var ne=ve(H.plainArray,Y);if(ne)return ne;if(W&&Y.length!==ie.length)return"an array with "+ie.length+" items";for(var ee=0;ee<Y.length;ee++)if(ne=ve(W?ie[ee]:ie,Y[ee]))return[ee].concat(ne)}}function ve(ie,W){if(null!=W||ie.hasOwnProperty("__required")){var J=ie(W);if(J)return Array.isArray(J)?J:[J]}}function Ie(ie,W){var J=ie.length,re=ie[J-1],Y=ie.slice(0,J-1);return 0===Y.length&&(Y=[_e]),W=de(W,{path:Y}),"function"==typeof re?re(W):Je(W,function _t(ie){return"must be "+function dt(ie){return/^an? /.test(ie)?ie:/^[aeiou]/i.test(ie)?"an "+ie:/^[a-z]/i.test(ie)?"a "+ie:ie}(ie)+"."}(re))}function Je(ie,W){return(ht(ie.path)?"Item at position ":"")+ie.path.join(".")+" "+W}function ht(ie){return"number"==typeof ie[ie.length-1]||"number"==typeof ie[0]}H.assert=function(ie,W){return W=W||{},function(J){var re=ve(ie,J);if(re){var Y=Ie(re,W);throw W.apiName&&(Y=W.apiName+": "+Y),new Error(Y)}}},H.shape=function(W){var J=function xt(ie){return Object.keys(ie||{}).map(function(W){return{key:W,value:ie[W]}})}(W);return function(Y){var ne=ve(H.plainObject,Y);if(ne)return ne;for(var ee,me=[],Q=0;Q<J.length;Q++)(ne=ve(J[Q].value,Y[ee=J[Q].key]))&&me.push([ee].concat(ne));return me.length<2?me[0]:function(qe){me=me.map(function(Ae){return"- "+Ae[0]+": "+Ie(Ae,qe).split("\n").join(p)});var Ue=qe.path.join(".");return"The following properties"+(Ue===_e?"":" of "+Ue)+" have invalid values:"+p+me.join(p)}}},H.strictShape=function(W){var J=H.shape(W);return function(Y){var ne=J(Y);if(ne)return ne;var ee=Object.keys(Y).reduce(function(Z,me){return void 0===W[me]&&Z.push(me),Z},[]);return 0!==ee.length?function(){return"The following keys are invalid: "+ee.join(", ")}:void 0}},H.arrayOf=function(W){return fe(W)},H.tuple=function(){return fe(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments))},H.required=function(W){function J(re){return null==re?function(Y){return Je(Y,ht(Y.path)?"cannot be undefined/null.":"is required.")}:W.apply(this,arguments)}return J.__required=!0,J},H.oneOfType=function(){var W=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(re){var Y=W.map(function(ne){return ve(ne,re)}).filter(Boolean);if(Y.length===W.length)return Y.every(function(ne){return 1===ne.length&&"string"==typeof ne[0]})?function ze(ie){return ie.length<2?ie[0]:2===ie.length?ie.join(" or "):ie.slice(0,-1).join(", ")+", or "+ie.slice(-1)}(Y.map(function(ne){return ne[0]})):Y.reduce(function(ne,ee){return ee.length>ne.length?ee:ne})}},H.equal=function(W){return function(re){if(re!==W)return JSON.stringify(W)}},H.oneOf=function(){var J=(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments)).map(function(re){return H.equal(re)});return H.oneOfType.apply(this,J)},H.range=function(W){var J=W[0],re=W[1];return function(ne){if(ve(H.number,ne)||ne<J||ne>re)return"number between "+J+" & "+re+" (inclusive)"}},H.any=function(){},H.boolean=function(W){if("boolean"!=typeof W)return"boolean"},H.number=function(W){if("number"!=typeof W)return"number"},H.plainArray=function(W){if(!Array.isArray(W))return"array"},H.plainObject=function(W){if(!he(W))return"object"},H.string=function(W){if("string"!=typeof W)return"string"},H.func=function(W){if("function"!=typeof W)return"function"},H.validate=ve,H.processMessage=Ie,bt.exports=H},9095:bt=>{"use strict";var Qe=Object.prototype.toString;bt.exports=function(pe){var he;return"[object Object]"===Qe.call(pe)&&(null===(he=Object.getPrototypeOf(pe))||he===Object.getPrototypeOf({}))}},2564:(bt,Qe,pe)=>{"use strict";var he=pe(9652).x0;function de(_e){this.origin=_e.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=_e.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=_e,this.send=this.send.bind(this),this.countries=_e.countries?_e.countries.split(","):null,this.types=_e.types?_e.types.split(","):null,this.bbox=_e.bbox?_e.bbox:null,this.language=_e.language?_e.language.split(","):null,this.limit=_e.limit?+_e.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(_e),this.eventQueue=new Array,this.flushInterval=_e.flushInterval||1e3,this.maxQueueSize=_e.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}de.prototype={select:function(_e,p){var H=this.getSelectedIndex(_e,p),fe=this.getEventPayload("search.select",p);if(fe.resultIndex=H,fe.resultPlaceName=_e.place_name,fe.resultId=_e.id,(H!==this.lastSentIndex||fe.queryString!==this.lastSentInput)&&-1!=H&&(this.lastSentIndex=H,this.lastSentInput=fe.queryString,fe.queryString))return this.push(fe)},start:function(_e){var p=this.getEventPayload("search.start",_e);if(p.queryString)return this.push(p)},keyevent:function(_e,p){if(_e.key&&!_e.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(_e.keyCode)){var H=this.getEventPayload("search.keystroke",p);if(H.lastAction=_e.key,H.queryString)return this.push(H)}},send:function(_e,p){if(!this.enableEventLogging)return p?p():void 0;var H=this.getRequestOptions(_e);this.request(H,function(fe){return fe?this.handleError(fe,p):p?p():void 0}.bind(this))},getRequestOptions:function(_e){return Array.isArray(_e)||(_e=[_e]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(_e)}},getEventPayload:function(_e,p){var H;H=p.options.proximity?"object"==typeof p.options.proximity?[p.options.proximity.longitude,p.options.proximity.latitude]:"ip"===p.options.proximity?[999,999]:p.options.proximity:null;var fe=p._map?p._map.getZoom():void 0,ve={event:_e,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:p.options.autocomplete,fuzzyMatch:p.options.fuzzyMatch,proximity:H,limit:p.options.limit,routing:p.options.routing,worldview:p.options.worldview,mapZoom:fe,keyboardLocale:this.locale};return ve.queryString="search.select"===_e?p.inputString:"search.select"!=_e&&p._inputEl?p._inputEl.value:p.inputString,ve},request:function(_e,p){var H=new XMLHttpRequest;for(var fe in H.onreadystatechange=function(){if(4==this.readyState)return p(204==this.status?null:this.statusText)},H.open(_e.method,_e.host+"/"+_e.path,!0),_e.headers)H.setRequestHeader(fe,_e.headers[fe]);H.send(_e.body)},handleError:function(_e,p){if(p)return p(_e)},generateSessionID:function(){return he()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(_e,p){if(p._typeahead){var fe=_e.id;return p._typeahead.data.map(function(ze){return ze.id}).indexOf(fe)}},shouldEnableLogging:function(_e){return!(!1===_e.enableEventLogging||_e.origin&&"https://api.mapbox.com"!==_e.origin||_e.localGeocoder||_e.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(_e,p){this.eventQueue.push(_e),(this.eventQueue.length>=this.maxQueueSize||p)&&this.flush()},remove:function(){this.flush()}},bt.exports=de},3424:bt=>{bt.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},3569:bt=>{function Qe(){}Qe.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const pe={enableHighAccuracy:!0};return new Promise(function(he,de){window.navigator.geolocation.getCurrentPosition(he,de,pe)})}},bt.exports=Qe},8545:(bt,Qe,pe)=>{"use strict";var he=pe(5562),de=pe(3082),_e=pe(4703),p=pe(9069).EventEmitter,H=pe(3424),fe=pe(9471),ve=pe(7075),Ie=pe(2564),ze=pe(1753),_t=pe(6775),dt=pe(3569),Je=pe(2777);function ie(W){this._eventEmitter=new p,this.options=_e({},this.options,W),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new dt}ie.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(W){return W.place_name},render:function(W){var J=W.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+J[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+J.splice(1,J.length).join(",")+"</div></div>"}},addTo:function(W){function J(re,Y){if(!document.body.contains(Y))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const ne=re.onAdd();Y.appendChild(ne)}if(W._controlContainer)W.addControl(this);else if(W instanceof HTMLElement)J(this,W);else{if("string"!=typeof W)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");{const re=document.querySelectorAll(W);if(0===re.length)throw new Error("Element ",W,"not found.");if(re.length>1)throw new Error("Geocoder can only be added to a single html element");J(this,re[0])}}},onAdd:function(W){if(W&&"string"!=typeof W&&(this._map=W),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=ve(fe({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new Ie(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var J=this.container=document.createElement("div");J.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var re=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",de(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(qe){this.eventManager.keyevent(qe,this)}.bind(this));var Y=document.createElement("div");Y.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var ne=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(ne),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),Y.appendChild(this._clearEl),Y.appendChild(this._loadingEl),J.appendChild(re),J.appendChild(this._inputEl),J.appendChild(Y),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var ee=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(ee),Y.appendChild(this._geolocateEl),this._showGeolocateButton()}var Z=this._typeahead=new he(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),Z.getItemValue=this.options.getItemValue;var me=Z.list.draw,Q=this._footerNode=function xt(){var W=document.createElement("div");return W.className="mapboxgl-ctrl-geocoder--powered-by",W.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',W}();return Z.list.draw=function(){me.call(this),Q.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),Q.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(Q)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),J},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(W){this._hideLoadingIcon();const J={geometry:{type:"Point",coordinates:[W.coords.longitude,W.coords.latitude]}};this._handleMarker(J),this._fly(J),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(J),this._showClearButton(),this.fresh=!1;const re={limit:1,language:[this.options.language],query:J.geometry.coordinates,types:["address"]};this.options.localGeocoderOnly?(this._setInputValue(J.geometry.coordinates[0]+","+J.geometry.coordinates[1]),this._eventEmitter.emit("result",{result:J})):this.geocoderService.reverseGeocode(re).send().then(function(Y){const ne=Y.body.features[0];if(ne){const ee=Je.transformFeatureToGeolocationText(ne,this.options.addressAccuracy);this._setInputValue(ee),ne.user_coordinates=J.geometry.coordinates,this._eventEmitter.emit("result",{result:ne})}else this._eventEmitter.emit("result",{result:{user_coordinates:J.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(W){1===W.code?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(W,J){var re=document.createElementNS("http://www.w3.org/2000/svg","svg");return re.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+W),re.setAttribute("viewBox","0 0 18 18"),re.setAttribute("xml:space","preserve"),re.setAttribute("width",18),re.setAttribute("height",18),re.innerHTML=J,re},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(W){this._inputEl.value=W,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(W){var J=(W.clipboardData||window.clipboardData).getData("text");J.length>=this.options.minLength&&this._geocode(J)},_onKeyDown:function(W){var J=27,re=9;if(W.keyCode===J&&this.options.clearAndBlurOnEsc)return this._clear(W),this._inputEl.blur();var Y=W.target&&W.target.shadowRoot?W.target.shadowRoot.activeElement:W.target;if(!Y||!Y.value)return this.fresh=!0,W.keyCode!==re&&this.clear(W),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!W.metaKey&&-1===[re,J,37,39,13,38,40].indexOf(W.keyCode)&&Y.value.length>=this.options.minLength&&this._geocode(Y.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(W){this.options.clearOnBlur&&this._clearOnBlur(W),this.options.collapsed&&this._collapse()},_onChange:function(){var W=this._typeahead.selected;W&&JSON.stringify(W)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(W),this.options.marker&&this._mapboxgl&&this._handleMarker(W),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(W),this._eventEmitter.emit("result",{result:W}),this.eventManager.select(W,this))},_fly:function(W){var J;if(W.properties&&H[W.properties.short_code])J=_e({},this.options.flyTo),this._map&&this._map.fitBounds(H[W.properties.short_code].bbox,J);else if(W.bbox){var re=W.bbox;J=_e({},this.options.flyTo),this._map&&this._map.fitBounds([[re[0],re[1]],[re[2],re[3]]],J)}else J=_e({},{zoom:this.options.zoom},this.options.flyTo),W.center?J.center=W.center:W.geometry&&W.geometry.type&&"Point"===W.geometry.type&&W.geometry.coordinates&&(J.center=W.geometry.coordinates),this._map&&this._map.flyTo(J)},_requestType:function(W,J){return W.localGeocoderOnly?1:W.reverseGeocode&&Je.REVERSE_GEOCODE_COORD_RGX.test(J)?2:0},_setupConfig:function(W,J){const Y=/[\s,]+/;var ne=this,ee=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce(function(me,Q){return null==ne.options[Q]||(me[Q]=["countries","types","language"].indexOf(Q)>-1?ne.options[Q].split(Y):ne.options[Q],"proximity"===Q&&"number"==typeof ne.options[Q].longitude&&"number"==typeof ne.options[Q].latitude&&(me[Q]=[ne.options[Q].longitude,ne.options[Q].latitude])),me},{});switch(W){case 2:var Z=J.split(Y).map(function(me){return parseFloat(me,10)});ne.options.flipCoordinates||Z.reverse(),ee=_e(ee,{query:Z,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(me){me in ee&&delete ee[me]});break;case 0:{const me=J.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(me)&&(J=J.replace(/,/g," ")),ee=_e(ee,{query:J})}}return ee},_geocode:function(W){this.inputString=W,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:W});const J=this._requestType(this.options,W),re=this._setupConfig(J,W);var Y;switch(J){case 1:Y=Promise.resolve();break;case 0:Y=this.geocoderService.forwardGeocode(re).send();break;case 2:Y=this.geocoderService.reverseGeocode(re).send()}var ne=this.options.localGeocoder&&this.options.localGeocoder(W)||[],ee=[],Z=null;return Y.catch(function(me){Z=me}.bind(this)).then(function(me){this._hideLoadingIcon();var Q={};return me?"200"==me.statusCode&&((Q=me.body).request=me.request,Q.headers=me.headers):Q={type:"FeatureCollection",features:[]},Q.config=re,this.fresh&&(this.eventManager.start(this),this.fresh=!1),Q.features=Q.features?ne.concat(Q.features):ne,this.options.externalGeocoder?(ee=this.options.externalGeocoder(W,Q.features)||Promise.resolve([])).then(function(qe){return Q.features=Q.features?qe.concat(Q.features):qe,Q},function(){return Q}):Q}.bind(this)).then(function(me){if(Z)throw Z;this.options.filter&&me.features.length&&(me.features=me.features.filter(this.options.filter)),me.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",me),this._typeahead.update(me.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",me))}.bind(this)).catch(function(me){this._hideLoadingIcon(),this._hideAttribution(),ne.length&&this.options.localGeocoder||ee.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(ne)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:ne}),this._eventEmitter.emit("error",{error:me})}.bind(this)),Y},_clear:function(W){W&&W.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(W){this._clear(W),this._inputEl.focus()},_clearOnBlur:function(W){W.relatedTarget&&this._clear(W)},_onQueryResult:function(W){var J=W.body;if(J.features.length){var re=J.features[0];this._typeahead.selected=re,this._inputEl.value=re.place_name,this._onChange()}},_updateProximity:function(){if(this._map&&this.options.trackProximity)if(this._map.getZoom()>9){var W=this._map.getCenter().wrap();this.setProximity({longitude:W.lng,latitude:W.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(W){return this._geocode(W).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderLocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderUserDeniedGeolocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>")},_renderMessage:function(W){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(W)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var W=this.options.language.split(",")[0],J=_t.language(W),re=ze.placeholder[J];if(re)return re}return"Search"},setInput:function(W){return this._inputEl.value=W,this._typeahead.selected=null,this._typeahead.clear(),W.length>=this.options.minLength&&this._geocode(W),this},setProximity:function(W,J=!0){return this.options.proximity=W,J&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(W){return W&&"function"==typeof W&&(this._typeahead.render=W),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(W){var J=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=W||this.options.language||J,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(W){return this.options.zoom=W,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(W){return this.options.flyTo=W,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(W){return this.placeholder=W||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(W){return this.options.bbox=W,this},getCountries:function(){return this.options.countries},setCountries:function(W){return this.options.countries=W,this},getTypes:function(){return this.options.types},setTypes:function(W){return this.options.types=W,this},getMinLength:function(){return this.options.minLength},setMinLength:function(W){return this.options.minLength=W,this._typeahead&&(this._typeahead.options.minLength=W),this},getLimit:function(){return this.options.limit},setLimit:function(W){return this.options.limit=W,this._typeahead&&(this._typeahead.options.limit=W),this},getFilter:function(){return this.options.filter},setFilter:function(W){return this.options.filter=W,this},setOrigin:function(W){return this.options.origin=W,this.geocoderService=ve(fe({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(W){return this.options.accessToken=W,this.geocoderService=ve(fe({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(W){return this.options.autocomplete=W,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(W){return this.options.fuzzyMatch=W,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(W){return this.options.routing=W,this},getRouting:function(){return this.options.routing},setWorldview:function(W){return this.options.worldview=W,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(W){if(this._map){this._removeMarker();var re=_e({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(re),W.center?this.mapMarker.setLngLat(W.center).addTo(this._map):W.geometry&&W.geometry.type&&"Point"===W.geometry.type&&W.geometry.coordinates&&this.mapMarker.setLngLat(W.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(W,J){return this._eventEmitter.on(W,J),this},off:function(W,J){return this._eventEmitter.removeListener(W,J),this.eventManager.remove(),this}},bt.exports=ie},1753:bt=>{"use strict";bt.exports={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05dc\u05d7\u05e4\u05e9",ja:"\u30b5\u30fc\u30c1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041f\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641c\u7d22",cs:"Vyhled\xe1v\xe1n\xed",hu:"Keres\xe9s",ka:"\u10eb\u10d8\u10d4\u10d1\u10d0",nb:"S\xf8ke",sk:"Vyh\u013ead\xe1vanie",th:"\u0e04\u0e49\u0e19\u0e2b\u0e32",fi:"Hae",is:"Leita",ko:"\uc218\uc0c9",pl:"Szukaj",sl:"Iskanje",fa:"\u062c\u0633\u062a\u062c\u0648",ru:"\u041f\u043e\u0438\u0441\u043a"}}},2777:bt=>{function pe(de){const _e=de.address||"",p=de.text||"",H=de.place_name||"",ve={address:H.split(",")[0],houseNumber:_e,street:p,placeName:H};return de.context.forEach(function(Ie){const ze=Ie.id.split(".")[0];ve[ze]=Ie.text}),ve}bt.exports={transformFeatureToGeolocationText:function Qe(de,_e){const p=pe(de),H=["address","street","place","country"];if("function"==typeof _e)return _e(p);const ve=H.indexOf(_e);return(-1===ve?H:H.slice(ve)).reduce(function(Ie,ze){return p[ze]?(""!==Ie&&(Ie+=", "),Ie+p[ze]):Ie},"")},getAddressInfo:pe,REVERSE_GEOCODE_COORD_RGX:/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/}},9471:(bt,Qe,pe)=>{"use strict";var he=pe(7454);bt.exports=he},7454:(bt,Qe,pe)=>{"use strict";var he=pe(753),de=pe(4176);function _e(H){de.call(this,H)}(_e.prototype=Object.create(de.prototype)).constructor=_e,_e.prototype.sendRequest=he.browserSend,_e.prototype.abortRequest=he.browserAbort,bt.exports=function p(H){return new _e(H)}},753:(bt,Qe,pe)=>{"use strict";var he=pe(4332),de=pe(6158),_e=pe(9719),p=pe(8829),H={};function Ie(Je){var ht=Je.total,xt=Je.loaded;return{total:ht,transferred:xt,percent:100*xt/ht}}function ze(Je,ht){return new Promise(function(xt,ie){ht.onprogress=function(re){Je.emitter.emit(_e.EVENT_PROGRESS_DOWNLOAD,Ie(re))};var W=Je.file;W&&(ht.upload.onprogress=function(re){Je.emitter.emit(_e.EVENT_PROGRESS_UPLOAD,Ie(re))}),ht.onerror=function(re){ie(re)},ht.onabort=function(){var re=new de({request:Je,type:_e.ERROR_REQUEST_ABORTED});ie(re)},ht.onload=function(){if(delete H[Je.id],ht.status<200||ht.status>=400){var re=new de({request:Je,body:ht.response,statusCode:ht.status});ie(re)}else xt(ht)};var J=Je.body;"string"==typeof J?ht.send(J):J?ht.send(JSON.stringify(J)):W?ht.send(W):ht.send(),H[Je.id]=ht}).then(function(xt){return function ve(Je,ht){return new he(Je,{body:ht.response,headers:p(ht.getAllResponseHeaders()),statusCode:ht.status})}(Je,xt)})}function _t(Je,ht){var xt=Je.url(ht),ie=new window.XMLHttpRequest;return ie.open(Je.method,xt),Object.keys(Je.headers).forEach(function(W){ie.setRequestHeader(W,Je.headers[W])}),ie}bt.exports={browserAbort:function fe(Je){var ht=H[Je.id];ht&&(ht.abort(),delete H[Je.id])},sendRequestXhr:ze,browserSend:function dt(Je){return Promise.resolve().then(function(){var ht=_t(Je,Je.client.accessToken);return ze(Je,ht)})},createRequestXhr:_t}},4176:(bt,Qe,pe)=>{"use strict";var he=pe(8129),de=pe(4538),_e=pe(9719);function p(H){if(!H||!H.accessToken)throw new Error("Cannot create a client without an access token");he(H.accessToken),this.accessToken=H.accessToken,this.origin=H.origin||_e.API_ORIGIN}p.prototype.createRequest=function(fe){return new de(this,fe)},bt.exports=p},6158:(bt,Qe,pe)=>{"use strict";var he=pe(9719);bt.exports=function de(_e){var H,p=_e.type||he.ERROR_HTTP;if(_e.body)try{H=JSON.parse(_e.body)}catch{H=_e.body}else H=null;var fe=_e.message||null;fe||("string"==typeof H?fe=H:H&&"string"==typeof H.message?fe=H.message:p===he.ERROR_REQUEST_ABORTED&&(fe="Request aborted")),this.message=fe,this.type=p,this.statusCode=_e.statusCode||null,this.request=_e.request,this.body=H}},4538:(bt,Qe,pe)=>{"use strict";var he=pe(8129),de=pe(4703),_e=pe(6661),p=pe(3449),H=pe(9719),fe=1;function ve(Ie,ze){if(!Ie)throw new Error("MapiRequest requires a client");if(!ze||!ze.path||!ze.method)throw new Error("MapiRequest requires an options object with path and method properties");var _t={};ze.body&&(_t["content-type"]="application/json");var dt=de(_t,ze.headers),Je=Object.keys(dt).reduce(function(ht,xt){return ht[xt.toLowerCase()]=dt[xt],ht},{});this.id=fe++,this._options=ze,this.emitter=new _e,this.client=Ie,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=ze.path,this.method=ze.method,this.origin=ze.origin||Ie.origin,this.query=ze.query||{},this.params=ze.params||{},this.body=ze.body||null,this.file=ze.file||null,this.encoding=ze.encoding||"utf8",this.sendFileAs=ze.sendFileAs||null,this.headers=Je}ve.prototype.url=function(ze){var _t=p.prependOrigin(this.path,this.origin);_t=p.appendQueryObject(_t,this.query);var dt=this.params,Je=ze??this.client.accessToken;if(Je){_t=p.appendQueryParam(_t,"access_token",Je);var ht=he(Je).user;dt=de({ownerId:ht},dt)}return p.interpolateRouteParams(_t,dt)},ve.prototype.send=function(){var ze=this;if(ze.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return ze.sent=!0,ze.client.sendRequest(ze).then(function(_t){return ze.response=_t,ze.emitter.emit(H.EVENT_RESPONSE,_t),_t},function(_t){throw ze.error=_t,ze.emitter.emit(H.EVENT_ERROR,_t),_t})},ve.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))},ve.prototype.eachPage=function(ze){var _t=this;function dt(xt){ze(null,xt,function ie(){delete _t._nextPageRequest;var W=xt.nextPage();W&&(_t._nextPageRequest=W,ht(W))})}function Je(xt){ze(xt,null,function(){})}function ht(xt){xt.send().then(dt,Je)}ht(this)},ve.prototype.clone=function(){return this._extend()},ve.prototype._extend=function(ze){var _t=de(this._options,ze);return new ve(this.client,_t)},bt.exports=ve},4332:(bt,Qe,pe)=>{"use strict";var he=pe(5699);function de(_e,p){this.request=_e,this.headers=p.headers,this.rawBody=p.body,this.statusCode=p.statusCode;try{this.body=JSON.parse(p.body||"{}")}catch{this.body=p.body}this.links=he(this.headers.link)}de.prototype.hasNextPage=function(){return!!this.links.next},de.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},bt.exports=de},9719:bt=>{"use strict";bt.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},8829:bt=>{"use strict";bt.exports=function pe(he){var de={};return he&&he.trim().split(/[\r|\n]+/).forEach(function(_e){var p=function Qe(he){var de=he.indexOf(":");return{name:he.substring(0,de).trim().toLowerCase(),value:he.substring(de+1).trim()}}(_e);de[p.name]=p.value}),de}},5699:bt=>{"use strict";bt.exports=function he(de){return de?de.split(/,\s*</).reduce(function(_e,p){var H=function pe(de){var _e=de.match(/<?([^>]*)>(.*)/);if(!_e)return null;var p=_e[1],H=_e[2].split(";"),fe=null,ve=H.reduce(function(Ie,ze){var _t=function Qe(de){var _e=de.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return _e?{key:_e[1],value:_e[2]}:null}(ze);return _t?"rel"===_t.key?(fe||(fe=_t.value),Ie):(Ie[_t.key]=_t.value,Ie):Ie},{});return fe?{url:p,rel:fe,params:ve}:null}(p);return H?(H.rel.split(/\s+/).forEach(function(ve){_e[ve]||(_e[ve]={url:H.url,params:H.params})}),_e):_e},{}):{}}},3449:bt=>{"use strict";function pe(H){return Array.isArray(H)?function Qe(H){return H.map(encodeURIComponent).join(",")}(H):encodeURIComponent(String(H))}function he(H,fe,ve){if(!1===ve||null===ve)return H;var Ie=/\?/.test(H)?"&":"?",ze=encodeURIComponent(fe);return void 0!==ve&&""!==ve&&!0!==ve&&(ze+="="+pe(ve)),""+H+Ie+ze}bt.exports={appendQueryObject:function de(H,fe){if(!fe)return H;var ve=H;return Object.keys(fe).forEach(function(Ie){var ze=fe[Ie];void 0!==ze&&(Array.isArray(ze)&&(ze=ze.filter(function(_t){return null!=_t}).join(",")),ve=he(ve,Ie,ze))}),ve},appendQueryParam:he,prependOrigin:function _e(H,fe){if(!fe||"http"===H.slice(0,4))return H;var ve="/"===H[0]?"":"/";return""+fe.replace(/\/$/,"")+ve+H},interpolateRouteParams:function p(H,fe){return fe?H.replace(/\/:([a-zA-Z0-9]+)/g,function(ve,Ie){var ze=fe[Ie];if(void 0===ze)throw new Error("Unspecified route parameter "+Ie);return"/"+pe(ze)}):H}}},6661:bt=>{"use strict";var Qe=Object.prototype.hasOwnProperty,pe="~";function he(){}function de(fe,ve,Ie){this.fn=fe,this.context=ve,this.once=Ie||!1}function _e(fe,ve,Ie,ze,_t){if("function"!=typeof Ie)throw new TypeError("The listener must be a function");var dt=new de(Ie,ze||fe,_t),Je=pe?pe+ve:ve;return fe._events[Je]?fe._events[Je].fn?fe._events[Je]=[fe._events[Je],dt]:fe._events[Je].push(dt):(fe._events[Je]=dt,fe._eventsCount++),fe}function p(fe,ve){0==--fe._eventsCount?fe._events=new he:delete fe._events[ve]}function H(){this._events=new he,this._eventsCount=0}Object.create&&(he.prototype=Object.create(null),(new he).__proto__||(pe=!1)),H.prototype.eventNames=function(){var Ie,ze,ve=[];if(0===this._eventsCount)return ve;for(ze in Ie=this._events)Qe.call(Ie,ze)&&ve.push(pe?ze.slice(1):ze);return Object.getOwnPropertySymbols?ve.concat(Object.getOwnPropertySymbols(Ie)):ve},H.prototype.listeners=function(ve){var ze=this._events[pe?pe+ve:ve];if(!ze)return[];if(ze.fn)return[ze.fn];for(var _t=0,dt=ze.length,Je=new Array(dt);_t<dt;_t++)Je[_t]=ze[_t].fn;return Je},H.prototype.listenerCount=function(ve){var ze=this._events[pe?pe+ve:ve];return ze?ze.fn?1:ze.length:0},H.prototype.emit=function(ve,Ie,ze,_t,dt,Je){var ht=pe?pe+ve:ve;if(!this._events[ht])return!1;var W,J,xt=this._events[ht],ie=arguments.length;if(xt.fn){switch(xt.once&&this.removeListener(ve,xt.fn,void 0,!0),ie){case 1:return xt.fn.call(xt.context),!0;case 2:return xt.fn.call(xt.context,Ie),!0;case 3:return xt.fn.call(xt.context,Ie,ze),!0;case 4:return xt.fn.call(xt.context,Ie,ze,_t),!0;case 5:return xt.fn.call(xt.context,Ie,ze,_t,dt),!0;case 6:return xt.fn.call(xt.context,Ie,ze,_t,dt,Je),!0}for(J=1,W=new Array(ie-1);J<ie;J++)W[J-1]=arguments[J];xt.fn.apply(xt.context,W)}else{var Y,re=xt.length;for(J=0;J<re;J++)switch(xt[J].once&&this.removeListener(ve,xt[J].fn,void 0,!0),ie){case 1:xt[J].fn.call(xt[J].context);break;case 2:xt[J].fn.call(xt[J].context,Ie);break;case 3:xt[J].fn.call(xt[J].context,Ie,ze);break;case 4:xt[J].fn.call(xt[J].context,Ie,ze,_t);break;default:if(!W)for(Y=1,W=new Array(ie-1);Y<ie;Y++)W[Y-1]=arguments[Y];xt[J].fn.apply(xt[J].context,W)}}return!0},H.prototype.on=function(ve,Ie,ze){return _e(this,ve,Ie,ze,!1)},H.prototype.once=function(ve,Ie,ze){return _e(this,ve,Ie,ze,!0)},H.prototype.removeListener=function(ve,Ie,ze,_t){var dt=pe?pe+ve:ve;if(!this._events[dt])return this;if(!Ie)return p(this,dt),this;var Je=this._events[dt];if(Je.fn)Je.fn===Ie&&(!_t||Je.once)&&(!ze||Je.context===ze)&&p(this,dt);else{for(var ht=0,xt=[],ie=Je.length;ht<ie;ht++)(Je[ht].fn!==Ie||_t&&!Je[ht].once||ze&&Je[ht].context!==ze)&&xt.push(Je[ht]);xt.length?this._events[dt]=1===xt.length?xt[0]:xt:p(this,dt)}return this},H.prototype.removeAllListeners=function(ve){var Ie;return ve?this._events[Ie=pe?pe+ve:ve]&&p(this,Ie):(this._events=new he,this._eventsCount=0),this},H.prototype.off=H.prototype.removeListener,H.prototype.addListener=H.prototype.on,H.prefixed=pe,H.EventEmitter=H,bt.exports=H},7075:(bt,Qe,pe)=>{"use strict";var he=pe(4703),de=pe(9801),_e=pe(4313),p=pe(1836),H=pe(497),fe={},ve=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];fe.forwardGeocode=function(Ie){de.assertShape({query:de.required(de.string),mode:de.oneOf("mapbox.places","mapbox.places-permanent"),countries:de.arrayOf(de.string),proximity:de.oneOf(de.coordinates,"ip"),types:de.arrayOf(de.oneOf(ve)),autocomplete:de.boolean,bbox:de.arrayOf(de.number),limit:de.number,language:de.arrayOf(de.string),routing:de.boolean,fuzzyMatch:de.boolean,worldview:de.string})(Ie),Ie.mode=Ie.mode||"mapbox.places";var ze=p(he({country:Ie.countries},_e(Ie,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:_e(Ie,["mode","query"]),query:ze})},fe.reverseGeocode=function(Ie){de.assertShape({query:de.required(de.coordinates),mode:de.oneOf("mapbox.places","mapbox.places-permanent"),countries:de.arrayOf(de.string),types:de.arrayOf(de.oneOf(ve)),bbox:de.arrayOf(de.number),limit:de.number,language:de.arrayOf(de.string),reverseMode:de.oneOf("distance","score"),routing:de.boolean,worldview:de.string})(Ie),Ie.mode=Ie.mode||"mapbox.places";var ze=p(he({country:Ie.countries},_e(Ie,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:_e(Ie,["mode","query"]),query:ze})},bt.exports=H(fe)},497:(bt,Qe,pe)=>{"use strict";var he=pe(4176),de=pe(7454);bt.exports=function _e(p){return function(H){var fe;fe=he.prototype.isPrototypeOf(H)?H:de(H);var ve=Object.create(p);return ve.client=fe,ve}}},5621:bt=>{"use strict";bt.exports=function Qe(pe,he){return Object.keys(pe).reduce(function(de,_e){return de[_e]=he(_e,pe[_e]),de},{})}},4313:bt=>{"use strict";bt.exports=function Qe(pe,he){var de=function(_e,p){return-1!==he.indexOf(_e)&&void 0!==p};return"function"==typeof he&&(de=he),Object.keys(pe).filter(function(_e){return de(_e,pe[_e])}).reduce(function(_e,p){return _e[p]=pe[p],_e},{})}},1836:(bt,Qe,pe)=>{"use strict";var he=pe(5621);bt.exports=function de(_e){return he(_e,function(p,H){return"boolean"==typeof H?JSON.stringify(H):H})}},9801:(bt,Qe,pe)=>{"use strict";var he=pe(4703),de=pe(6089);bt.exports=he(de,{file:function _e(ve){return typeof window<"u"?ve instanceof global.Blob||ve instanceof global.ArrayBuffer?void 0:"Blob or ArrayBuffer":"string"!=typeof ve&&void 0===ve.pipe?"Filename or Readable stream":void 0},date:function H(ve){var Ie="date";if("boolean"==typeof ve)return Ie;try{var ze=new Date(ve);if(ze.getTime&&isNaN(ze.getTime()))return Ie}catch{return Ie}},coordinates:function fe(ve){return de.tuple(de.number,de.number)(ve)},assertShape:function p(ve,Ie){return de.assert(de.strictShape(ve),Ie)}})},8129:(bt,Qe,pe)=>{"use strict";var he=pe(2049),de={};function H(fe,ve){return Object.prototype.hasOwnProperty.call(fe,ve)}bt.exports=function _e(fe){if(de[fe])return de[fe];var ve=fe.split("."),Ie=ve[0],ze=ve[1];if(!ze)throw new Error("Invalid token");var _t=function p(fe){try{return JSON.parse(he.decode(fe))}catch{throw new Error("Invalid token")}}(ze),dt={usage:Ie,user:_t.u};return H(_t,"a")&&(dt.authorization=_t.a),H(_t,"exp")&&(dt.expires=1e3*_t.exp),H(_t,"iat")&&(dt.created=1e3*_t.iat),H(_t,"scopes")&&(dt.scopes=_t.scopes),H(_t,"client")&&(dt.client=_t.client),H(_t,"ll")&&(dt.lastLogin=_t.ll),H(_t,"iu")&&(dt.impersonator=_t.iu),de[fe]=dt,dt}},6198:(bt,Qe,pe)=>{"use strict";function he(e){return"function"==typeof e}function de(e){const n=e(r=>{Error.call(r),r.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const _e=de(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((r,o)=>`${o+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function p(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class H{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const c of n)c.remove(this);else n.remove(this);const{initialTeardown:r}=this;if(he(r))try{r()}catch(c){t=c instanceof _e?c.errors:[c]}const{_finalizers:o}=this;if(o){this._finalizers=null;for(const c of o)try{Ie(c)}catch(d){t=t??[],d instanceof _e?t=[...t,...d.errors]:t.push(d)}}if(t)throw new _e(t)}}add(t){var n;if(t&&t!==this)if(this.closed)Ie(t);else{if(t instanceof H){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&p(n,t)}remove(t){const{_finalizers:n}=this;n&&p(n,t),t instanceof H&&t._removeParent(this)}}H.EMPTY=(()=>{const e=new H;return e.closed=!0,e})();const fe=H.EMPTY;function ve(e){return e instanceof H||e&&"closed"in e&&he(e.remove)&&he(e.add)&&he(e.unsubscribe)}function Ie(e){he(e)?e():e.unsubscribe()}const ze={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},_t={setTimeout(e,t,...n){const{delegate:r}=_t;return r?.setTimeout?r.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=_t;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function dt(e){_t.setTimeout(()=>{const{onUnhandledError:t}=ze;if(!t)throw e;t(e)})}function Je(){}const ht=W("C",void 0,void 0);function W(e,t,n){return{kind:e,value:t,error:n}}let J=null;function re(e){if(ze.useDeprecatedSynchronousErrorHandling){const t=!J;if(t&&(J={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:r}=J;if(J=null,n)throw r}}else e()}class ne extends H{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,ve(t)&&t.add(this)):this.destination=Ae}static create(t,n,r){return new Q(t,n,r)}next(t){this.isStopped?Ye(function ie(e){return W("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?Ye(function xt(e){return W("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Ye(ht,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const ee=Function.prototype.bind;function Z(e,t){return ee.call(e,t)}class me{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(r){qe(r)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(r){qe(r)}else qe(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){qe(n)}}}class Q extends ne{constructor(t,n,r){let o;if(super(),he(t)||!t)o={next:t??void 0,error:n??void 0,complete:r??void 0};else{let c;this&&ze.useDeprecatedNextContext?(c=Object.create(t),c.unsubscribe=()=>this.unsubscribe(),o={next:t.next&&Z(t.next,c),error:t.error&&Z(t.error,c),complete:t.complete&&Z(t.complete,c)}):o=t}this.destination=new me(o)}}function qe(e){ze.useDeprecatedSynchronousErrorHandling?function Y(e){ze.useDeprecatedSynchronousErrorHandling&&J&&(J.errorThrown=!0,J.error=e)}(e):dt(e)}function Ye(e,t){const{onStoppedNotification:n}=ze;n&&_t.setTimeout(()=>n(e,t))}const Ae={closed:!0,next:Je,error:function Ue(e){throw e},complete:Je},Wt="function"==typeof Symbol&&Symbol.observable||"@@observable";function At(e){return e}function pt(e){return 0===e.length?At:1===e.length?e[0]:function(n){return e.reduce((r,o)=>o(r),n)}}let Fe=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const r=new e;return r.source=this,r.operator=n,r}subscribe(n,r,o){const c=function Le(e){return e&&e instanceof ne||function vt(e){return e&&he(e.next)&&he(e.error)&&he(e.complete)}(e)&&ve(e)}(n)?n:new Q(n,r,o);return re(()=>{const{operator:d,source:_}=this;c.add(d?d.call(c,_):_?this._subscribe(c):this._trySubscribe(c))}),c}_trySubscribe(n){try{return this._subscribe(n)}catch(r){n.error(r)}}forEach(n,r){return new(r=at(r))((o,c)=>{const d=new Q({next:_=>{try{n(_)}catch(b){c(b),d.unsubscribe()}},error:c,complete:o});this.subscribe(d)})}_subscribe(n){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(n)}[Wt](){return this}pipe(...n){return pt(n)(this)}toPromise(n){return new(n=at(n))((r,o)=>{let c;this.subscribe(d=>c=d,d=>o(d),()=>r(c))})}}return e.create=t=>new e(t),e})();function at(e){var t;return null!==(t=e??ze.Promise)&&void 0!==t?t:Promise}const Ut=de(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let zt=(()=>{class e extends Fe{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const r=new gn(this,this);return r.operator=n,r}_throwIfClosed(){if(this.closed)throw new Ut}next(n){re(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(n)}})}error(n){re(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:r}=this;for(;r.length;)r.shift().error(n)}})}complete(){re(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:r,isStopped:o,observers:c}=this;return r||o?fe:(this.currentObservers=null,c.push(n),new H(()=>{this.currentObservers=null,p(c,n)}))}_checkFinalizedStatuses(n){const{hasError:r,thrownError:o,isStopped:c}=this;r?n.error(o):c&&n.complete()}asObservable(){const n=new Fe;return n.source=this,n}}return e.create=(t,n)=>new gn(t,n),e})();class gn extends zt{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===r||r.call(n,t)}error(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===r||r.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,r;return null!==(r=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==r?r:fe}}class Dt extends zt{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:r}=this;if(t)throw n;return this._throwIfClosed(),r}next(t){super.next(this._value=t)}}function Un(e){return he(e?.lift)}function _n(e){return t=>{if(Un(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Cn(e,t,n,r,o){return new cn(e,t,n,r,o)}class cn extends ne{constructor(t,n,r,o,c,d){super(t),this.onFinalize=c,this.shouldUnsubscribe=d,this._next=n?function(_){try{n(_)}catch(b){t.error(b)}}:super._next,this._error=o?function(_){try{o(_)}catch(b){t.error(b)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(_){t.error(_)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function En(e,t){return _n((n,r)=>{let o=0;n.subscribe(Cn(r,c=>{r.next(e.call(t,c,o++))}))})}function si(e){return this instanceof si?(this.v=e,this):new si(e)}function Ii(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function Gt(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(c){n[c]=e[c]&&function(d){return new Promise(function(_,b){!function o(c,d,_,b){Promise.resolve(b).then(function(C){c({value:C,done:_})},d)}(_,b,(d=e[c](d)).done,d.value)})}}}const It=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Ct(e){return he(e?.then)}function tt(e){return he(e[Wt])}function Ft(e){return Symbol.asyncIterator&&he(e?.[Symbol.asyncIterator])}function hn(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const fn=function bn(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Rr(e){return he(e?.[fn])}function Ur(e){return function zr(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,r=n.apply(e,t||[]),c=[];return o={},d("next"),d("throw"),d("return"),o[Symbol.asyncIterator]=function(){return this},o;function d(N){r[N]&&(o[N]=function(B){return new Promise(function(le,se){c.push([N,B,le,se])>1||_(N,B)})})}function _(N,B){try{!function b(N){N.value instanceof si?Promise.resolve(N.value.v).then(C,D):P(c[0][2],N)}(r[N](B))}catch(le){P(c[0][3],le)}}function C(N){_("next",N)}function D(N){_("throw",N)}function P(N,B){N(B),c.shift(),c.length&&_(c[0][0],c[0][1])}}(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:r,done:o}=yield si(n.read());if(o)return yield si(void 0);yield yield si(r)}}finally{n.releaseLock()}})}function Lr(e){return he(e?.getReader)}function ir(e){if(e instanceof Fe)return e;if(null!=e){if(tt(e))return function Zr(e){return new Fe(t=>{const n=e[Wt]();if(he(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(It(e))return function So(e){return new Fe(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(Ct(e))return function Io(e){return new Fe(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,dt)})}(e);if(Ft(e))return Ti(e);if(Rr(e))return function Er(e){return new Fe(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Lr(e))return function Cs(e){return Ti(Ur(e))}(e)}throw hn(e)}function Ti(e){return new Fe(t=>{(function lo(e,t){var n,r,o,c;return function yt(e,t,n,r){return new(n||(n=Promise))(function(c,d){function _(D){try{C(r.next(D))}catch(P){d(P)}}function b(D){try{C(r.throw(D))}catch(P){d(P)}}function C(D){D.done?c(D.value):function o(c){return c instanceof n?c:new n(function(d){d(c)})}(D.value).then(_,b)}C((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=Ii(e);!(r=yield n.next()).done;)if(t.next(r.value),t.closed)return}catch(d){o={error:d}}finally{try{r&&!r.done&&(c=n.return)&&(yield c.call(n))}finally{if(o)throw o.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function ai(e,t,n,r=0,o=!1){const c=t.schedule(function(){n(),o?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(c),!o)return c}function co(e,t,n=1/0){return he(t)?co((r,o)=>En((c,d)=>t(r,c,o,d))(ir(e(r,o))),n):("number"==typeof t&&(n=t),_n((r,o)=>function du(e,t,n,r,o,c,d,_){const b=[];let C=0,D=0,P=!1;const N=()=>{P&&!b.length&&!C&&t.complete()},B=se=>C<r?le(se):b.push(se),le=se=>{c&&t.next(se),C++;let Oe=!1;ir(n(se,D++)).subscribe(Cn(t,Se=>{o?.(Se),c?B(Se):t.next(Se)},()=>{Oe=!0},void 0,()=>{if(Oe)try{for(C--;b.length&&C<r;){const Se=b.shift();d?ai(t,d,()=>le(Se)):le(Se)}N()}catch(Se){t.error(Se)}}))};return e.subscribe(Cn(t,B,()=>{P=!0,N()})),()=>{_?.()}}(r,o,e,n)))}function el(e=1/0){return co(At,e)}const mr=new Fe(e=>e.complete());function tl(e){return e[e.length-1]}function Ss(e){return function To(e){return e&&he(e.schedule)}(tl(e))?e.pop():void 0}function Sl(e,t=0){return _n((n,r)=>{n.subscribe(Cn(r,o=>ai(r,e,()=>r.next(o),t),()=>ai(r,e,()=>r.complete(),t),o=>ai(r,e,()=>r.error(o),t)))})}function ta(e,t=0){return _n((n,r)=>{r.add(e.schedule(()=>n.subscribe(r),t))})}function qo(e,t){if(!e)throw new Error("Iterable cannot be null");return new Fe(n=>{ai(n,t,()=>{const r=e[Symbol.asyncIterator]();ai(n,t,()=>{r.next().then(o=>{o.done?n.complete():n.next(o.value)})},0,!0)})})}function Vo(e,t){return t?function Ho(e,t){if(null!=e){if(tt(e))return function Gs(e,t){return ir(e).pipe(ta(t),Sl(t))}(e,t);if(It(e))return function Ht(e,t){return new Fe(n=>{let r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if(Ct(e))return function na(e,t){return ir(e).pipe(ta(t),Sl(t))}(e,t);if(Ft(e))return qo(e,t);if(Rr(e))return function pu(e,t){return new Fe(n=>{let r;return ai(n,t,()=>{r=e[fn](),ai(n,t,()=>{let o,c;try{({value:o,done:c}=r.next())}catch(d){return void n.error(d)}c?n.complete():n.next(o)},0,!0)}),()=>he(r?.return)&&r.return()})}(e,t);if(Lr(e))return function _s(e,t){return qo(Ur(e),t)}(e,t)}throw hn(e)}(e,t):ir(e)}function Or(...e){return Vo(e,Ss(e))}function Wl(e={}){const{connector:t=(()=>new zt),resetOnError:n=!0,resetOnComplete:r=!0,resetOnRefCountZero:o=!0}=e;return c=>{let d,_,b,C=0,D=!1,P=!1;const N=()=>{_?.unsubscribe(),_=void 0},B=()=>{N(),d=b=void 0,D=P=!1},le=()=>{const se=d;B(),se?.unsubscribe()};return _n((se,Oe)=>{C++,!P&&!D&&N();const Se=b=b??t();Oe.add(()=>{C--,0===C&&!P&&!D&&(_=nn(le,o))}),Se.subscribe(Oe),!d&&C>0&&(d=new Q({next:ae=>Se.next(ae),error:ae=>{P=!0,N(),_=nn(B,n,ae),Se.error(ae)},complete:()=>{D=!0,N(),_=nn(B,r),Se.complete()}}),ir(se).subscribe(d))})(c)}}function nn(e,t,...n){if(!0===t)return void e();if(!1===t)return;const r=new Q({next:()=>{r.unsubscribe(),e()}});return ir(t(...n)).subscribe(r)}function Cr(e,t){return _n((n,r)=>{let o=null,c=0,d=!1;const _=()=>d&&!o&&r.complete();n.subscribe(Cn(r,b=>{o?.unsubscribe();let C=0;const D=c++;ir(e(b,D)).subscribe(o=Cn(r,P=>r.next(t?t(b,P,D,C++):P),()=>{o=null,_()}))},()=>{d=!0,_()}))})}function Va(e,t){return e===t}function Bn(e){for(let t in e)if(e[t]===Bn)return t;throw Error("Could not find renamed property on target object.")}function oo(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(oo).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function nl(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const ra=Bn({__forward_ref__:Bn});function cs(e){return e.__forward_ref__=cs,e.toString=function(){return oo(this())},e}function $n(e){return eh(e)?e():e}function eh(e){return"function"==typeof e&&e.hasOwnProperty(ra)&&e.__forward_ref__===cs}function pn(e){return e&&!!e.\u0275providers}class Dn extends Error{constructor(t,n){super(function Xl(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,n)),this.code=t}}function rr(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():function Yn(e){return"string"==typeof e?e:null==e?"":String(e)}(e)}function Qo(e,t){throw new Dn(-201,!1)}function Ao(e,t){null==e&&function Jr(e,t,n,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${n} ${r} ${t} <=Actual]`))}(t,e,null,"!=")}function Vn(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function yu(e){return{providers:e.providers||[],imports:e.imports||[]}}function rl(e){return cc(e,ya)||cc(e,Tl)}function cc(e,t){return e.hasOwnProperty(t)?e[t]:null}function Ts(e){return e&&(e.hasOwnProperty(as)||e.hasOwnProperty(iu))?e[as]:null}const ya=Bn({\u0275prov:Bn}),as=Bn({\u0275inj:Bn}),Tl=Bn({ngInjectableDef:Bn}),iu=Bn({ngInjectorDef:Bn});var pr=(()=>((pr=pr||{})[pr.Default=0]="Default",pr[pr.Host=1]="Host",pr[pr.Self=2]="Self",pr[pr.SkipSelf=4]="SkipSelf",pr[pr.Optional=8]="Optional",pr))();let vo;function kr(e){const t=vo;return vo=e,t}function Ac(e,t,n){const r=rl(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&pr.Optional?null:void 0!==t?t:void Qo(oo(e))}const di=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),qu={},ri="__NG_DI_FLAG__",ia="ngTempTokenPath",Hu=/\n/gm,Nh="__source";let Dr;function gi(e){const t=Dr;return Dr=e,t}function Zl(e,t=pr.Default){if(void 0===Dr)throw new Dn(-203,!1);return null===Dr?Ac(e,void 0,t):Dr.get(e,t&pr.Optional?null:void 0,t)}function Wn(e,t=pr.Default){return(function Hn(){return vo}()||Zl)($n(e),t)}function In(e,t=pr.Default){return Wn(e,Ga(t))}function Ga(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function ui(e){const t=[];for(let n=0;n<e.length;n++){const r=$n(e[n]);if(Array.isArray(r)){if(0===r.length)throw new Dn(900,!1);let o,c=pr.Default;for(let d=0;d<r.length;d++){const _=r[d],b=hc(_);"number"==typeof b?-1===b?o=_.token:c|=b:o=_}t.push(Wn(o,c))}else t.push(Wn(r))}return t}function Fs(e,t){return e[ri]=t,e.prototype[ri]=t,e}function hc(e){return e[ri]}function jo(e){return{toString:e}.toString()}var sl=(()=>((sl=sl||{})[sl.OnPush=0]="OnPush",sl[sl.Default=1]="Default",sl))(),ou=(()=>{return(e=ou||(ou={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",ou;var e})();const $s={},Wr=[],_u=Bn({\u0275cmp:Bn}),Bs=Bn({\u0275dir:Bn}),$a=Bn({\u0275pipe:Bn}),vu=Bn({\u0275mod:Bn}),Aa=Bn({\u0275fac:Bn}),sa=Bn({__NG_ELEMENT_ID__:Bn}),Wo=Bn({__NG_ENV_ID__:Bn});function rh(e,t,n){let r=e.length;for(;;){const o=e.indexOf(t,n);if(-1===o)return o;if(0===o||e.charCodeAt(o-1)<=32){const c=t.length;if(o+c===r||e.charCodeAt(o+c)<=32)return o}n=o+1}}function al(e,t,n){let r=0;for(;r<n.length;){const o=n[r];if("number"==typeof o){if(0!==o)break;r++;const c=n[r++],d=n[r++],_=n[r++];e.setAttribute(t,d,_,c)}else{const c=o,d=n[++r];qs(c)?e.setProperty(t,c,d):e.setAttribute(t,c,d),r++}}return r}function Ms(e){return 3===e||4===e||6===e}function qs(e){return 64===e.charCodeAt(0)}function Hs(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const o=t[r];"number"==typeof o?n=o:0===n||ih(e,n,o,null,-1===n||2===n?t[++r]:null)}}return e}function ih(e,t,n,r,o){let c=0,d=e.length;if(-1===t)d=-1;else for(;c<e.length;){const _=e[c++];if("number"==typeof _){if(_===t){d=-1;break}if(_>t){d=c-1;break}}}for(;c<e.length;){const _=e[c];if("number"==typeof _)break;if(_===n){if(null===r)return void(null!==o&&(e[c+1]=o));if(r===e[c+1])return void(e[c+2]=o)}c++,null!==r&&c++,null!==o&&c++}-1!==d&&(e.splice(d,0,t),c=d+1),e.splice(c++,0,n),null!==r&&e.splice(c++,0,r),null!==o&&e.splice(c++,0,o)}const Ds="ng-template";function xf(e,t,n){let r=0,o=!0;for(;r<e.length;){let c=e[r++];if("string"==typeof c&&o){const d=e[r++];if(n&&"class"===c&&-1!==rh(d.toLowerCase(),t,0))return!0}else{if(1===c){for(;r<e.length&&"string"==typeof(c=e[r++]);)if(c.toLowerCase()===t)return!0;return!1}"number"==typeof c&&(o=!1)}}return!1}function Yl(e){return 4===e.type&&e.value!==Ds}function Pc(e,t,n){return t===(4!==e.type||n?e.value:Ds)}function kh(e,t,n){let r=4;const o=e.attrs||[],c=function Rc(e){for(let t=0;t<e.length;t++)if(Ms(e[t]))return t;return e.length}(o);let d=!1;for(let _=0;_<t.length;_++){const b=t[_];if("number"!=typeof b){if(!d)if(4&r){if(r=2|1&r,""!==b&&!Pc(e,b,n)||""===b&&1===t.length){if(qa(r))return!1;d=!0}}else{const C=8&r?b:t[++_];if(8&r&&null!==e.attrs){if(!xf(e.attrs,C,n)){if(qa(r))return!1;d=!0}continue}const P=Wu(8&r?"class":b,o,Yl(e),n);if(-1===P){if(qa(r))return!1;d=!0;continue}if(""!==C){let N;N=P>c?"":o[P+1].toLowerCase();const B=8&r?N:null;if(B&&-1!==rh(B,C,0)||2&r&&C!==N){if(qa(r))return!1;d=!0}}}}else{if(!d&&!qa(r)&&!qa(b))return!1;if(d&&qa(b))continue;d=!1,r=b|1&r}}return qa(r)||d}function qa(e){return 0==(1&e)}function Wu(e,t,n,r){if(null===t)return-1;let o=0;if(r||!n){let c=!1;for(;o<t.length;){const d=t[o];if(d===e)return o;if(3===d||6===d)c=!0;else{if(1===d||2===d){let _=t[++o];for(;"string"==typeof _;)_=t[++o];continue}if(4===d)break;if(0===d){o+=4;continue}}o+=c?1:2}return-1}return function zs(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function xu(e,t,n=!1){for(let r=0;r<t.length;r++)if(kh(e,t[r],n))return!0;return!1}function wu(e,t){return e?":not("+t.trim()+")":t}function Fh(e){let t=e[0],n=1,r=2,o="",c=!1;for(;n<e.length;){let d=e[n];if("string"==typeof d)if(2&r){const _=e[++n];o+="["+d+(_.length>0?'="'+_+'"':"")+"]"}else 8&r?o+="."+d:4&r&&(o+=" "+d);else""!==o&&!qa(d)&&(t+=wu(c,o),o=""),r=d,c=c||!qa(r);n++}return""!==o&&(t+=wu(c,o)),t}function Ws(e){return jo(()=>{const t=As(e),n={...t,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===sl.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:null,data:e.data||{},encapsulation:e.encapsulation||ou.Emulated,styles:e.styles||Wr,_:null,schemas:e.schemas||null,tView:null,id:""};oh(n);const r=e.dependencies;return n.directiveDefs=xo(r,!1),n.pipeDefs=xo(r,!0),n.id=function Wa(e){let t=0;const n=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const o of n)t=Math.imul(31,t)+o.charCodeAt(0)<<0;return t+=2147483648,"c"+t}(n),n})}function bu(e){return Qr(e)||ho(e)}function aa(e){return null!==e}function Kl(e){return jo(()=>({type:e.type,bootstrap:e.bootstrap||Wr,declarations:e.declarations||Wr,imports:e.imports||Wr,exports:e.exports||Wr,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function Pl(e,t){if(null==e)return $s;const n={};for(const r in e)if(e.hasOwnProperty(r)){let o=e[r],c=o;Array.isArray(o)&&(c=o[1],o=o[0]),n[o]=r,t&&(t[o]=c)}return n}function mi(e){return jo(()=>{const t=As(e);return oh(t),t})}function Qr(e){return e[_u]||null}function ho(e){return e[Bs]||null}function us(e){return e[$a]||null}function eo(e,t){const n=e[vu]||null;if(!n&&!0===t)throw new Error(`Type ${oo(e)} does not have '\u0275mod' property.`);return n}function As(e){const t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,exportAs:e.exportAs||null,standalone:!0===e.standalone,selectors:e.selectors||Wr,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Pl(e.inputs,t),outputs:Pl(e.outputs)}}function oh(e){e.features?.forEach(t=>t(e))}function xo(e,t){if(!e)return null;const n=t?us:bu;return()=>("function"==typeof e?e():e).map(r=>n(r)).filter(aa)}const ii=0,an=1,vr=2,fo=3,ns=4,ua=5,Mi=6,Xs=7,xr=8,Ql=9,Xu=10,Kn=11,la=12,Lc=13,Pa=14,to=15,Po=16,Xo=17,An=18,po=19,sh=20,Xa=21,no=22,Ps=23,ca=24,li=25,Nc=1,wf=2,hs=7,su=8,Eu=9,fs=11;function Zs(e){return Array.isArray(e)&&"object"==typeof e[Nc]}function Rs(e){return Array.isArray(e)&&!0===e[Nc]}function Ou(e){return 0!=(4&e.flags)}function ur(e){return e.componentOffset>-1}function Ra(e){return 1==(1&e.flags)}function Vs(e){return!!e.template}function Nu(e){return 0!=(512&e[vr])}function qn(e,t){return e.hasOwnProperty(Aa)?e[Aa]:null}let Rl=di.WeakRef??class uu{constructor(t){this.ref=t}deref(){return this.ref}},Wm=0,Ll=null,Bh=!1;function wa(e){const t=Ll;return Ll=e,t}class rp{constructor(){this.id=Wm++,this.ref=function kn(e){return new Rl(e)}(this),this.producers=new Map,this.consumers=new Map,this.trackingVersion=0,this.valueVersion=0}consumerPollProducersForChange(){for(const[t,n]of this.producers){const r=n.producerNode.deref();if(void 0!==r&&n.atTrackingVersion===this.trackingVersion){if(r.producerPollStatus(n.seenValueVersion))return!0}else this.producers.delete(t),r?.consumers.delete(this.id)}return!1}producerMayHaveChanged(){const t=Bh;Bh=!0;try{for(const[n,r]of this.consumers){const o=r.consumerNode.deref();void 0!==o&&o.trackingVersion===r.atTrackingVersion?o.onConsumerDependencyMayHaveChanged():(this.consumers.delete(n),o?.producers.delete(this.id))}}finally{Bh=t}}producerAccessed(){if(Bh)throw new Error("");if(null===Ll)return;let t=Ll.producers.get(this.id);void 0===t?(t={consumerNode:Ll.ref,producerNode:this.ref,seenValueVersion:this.valueVersion,atTrackingVersion:Ll.trackingVersion},Ll.producers.set(this.id,t),this.consumers.set(Ll.id,t)):(t.seenValueVersion=this.valueVersion,t.atTrackingVersion=Ll.trackingVersion)}get hasProducers(){return this.producers.size>0}get producerUpdatesAllowed(){return!1!==Ll?.consumerAllowSignalWrites}producerPollStatus(t){return this.valueVersion!==t||(this.onProducerUpdateValueVersion(),this.valueVersion!==t)}}let v=null;const U=()=>{};class q extends rp{constructor(t,n,r){super(),this.watch=t,this.schedule=n,this.dirty=!1,this.cleanupFn=U,this.registerOnCleanup=o=>{this.cleanupFn=o},this.consumerAllowSignalWrites=r}notify(){this.dirty||this.schedule(this),this.dirty=!0}onConsumerDependencyMayHaveChanged(){this.notify()}onProducerUpdateValueVersion(){}run(){if(this.dirty=!1,0!==this.trackingVersion&&!this.consumerPollProducersForChange())return;const t=wa(this);this.trackingVersion++;try{this.cleanupFn(),this.cleanupFn=U,this.watch(this.registerOnCleanup)}finally{wa(t)}}cleanup(){this.cleanupFn()}}class ${constructor(t,n,r){this.previousValue=t,this.currentValue=n,this.firstChange=r}isFirstChange(){return this.firstChange}}function te(){return Ee}function Ee(e){return e.type.prototype.ngOnChanges&&(e.setInput=Be),Re}function Re(){const e=je(this),t=e?.current;if(t){const n=e.previous;if(n===$s)e.previous=t;else for(let r in t)n[r]=t[r];e.current=null,this.ngOnChanges(t)}}function Be(e,t,n,r){const o=this.declaredInputs[n],c=je(e)||function oe(e,t){return e[Ne]=t}(e,{previous:$s,current:null}),d=c.current||(c.current={}),_=c.previous,b=_[o];d[o]=new $(b&&b.currentValue,t,_===$s),e[r]=t}te.ngInherit=!0;const Ne="__ngSimpleChanges__";function je(e){return e[Ne]||null}const He=function(e,t,n){};function it(e){for(;Array.isArray(e);)e=e[ii];return e}function Tt(e,t){return it(t[e.index])}function Nt(e,t){const n=t[e];return Zs(n)?n:n[ii]}function kt(e){return 128==(128&e[vr])}function un(e,t){return null==t?null:e[t]}function on(e){e[Xo]=0}function vn(e){1024&e[vr]||(e[vr]|=1024,Tr(e,1))}function nr(e){1024&e[vr]&&(e[vr]&=-1025,Tr(e,-1))}function Tr(e,t){let n=e[fo];if(null===n)return;n[ua]+=t;let r=n;for(n=n[fo];null!==n&&(1===t&&1===r[ua]||-1===t&&0===r[ua]);)n[ua]+=t,r=n,n=n[fo]}const Rn={lFrame:sd(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function wo(){return Rn.bindingsEnabled}function Zt(){return Rn.lFrame.lView}function Sr(){return Rn.lFrame.tView}function No(){let e=Sf();for(;null!==e&&64===e.type;)e=e.parent;return e}function Sf(){return Rn.lFrame.currentTNode}function ku(e,t){const n=Rn.lFrame;n.currentTNode=e,n.isParent=t}function Nl(){return Rn.lFrame.isParent}function Ym(e,t){const n=Rn.lFrame;n.bindingIndex=n.bindingRootIndex=e,pc(t)}function pc(e){Rn.lFrame.currentDirectiveIndex=e}function eg(e){Rn.lFrame.currentQueryIndex=e}function zx(e){const t=e[an];return 2===t.type?t.declTNode:1===t.type?e[Mi]:null}function Ov(e,t,n){if(n&pr.SkipSelf){let o=t,c=e;for(;!(o=o.parent,null!==o||n&pr.Host||(o=zx(c),null===o||(c=c[Pa],10&o.type))););if(null===o)return!1;t=o,e=c}const r=Rn.lFrame=tg();return r.currentTNode=t,r.lView=e,!0}function Jm(e){const t=tg(),n=e[an];Rn.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function tg(){const e=Rn.lFrame,t=null===e?null:e.child;return null===t?sd(e):t}function sd(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function If(){const e=Rn.lFrame;return Rn.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Fc=If;function kl(){const e=If();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Tf(e){Rn.lFrame.selectedIndex=e}let Fv=!0;function ng(){return Fv}function Zo(e){Fv=e}function gc(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const c=e.data[n].type.prototype,{ngAfterContentInit:d,ngAfterContentChecked:_,ngAfterViewInit:b,ngAfterViewChecked:C,ngOnDestroy:D}=c;d&&(e.contentHooks??=[]).push(-n,d),_&&((e.contentHooks??=[]).push(n,_),(e.contentCheckHooks??=[]).push(n,_)),b&&(e.viewHooks??=[]).push(-n,b),C&&((e.viewHooks??=[]).push(n,C),(e.viewCheckHooks??=[]).push(n,C)),null!=D&&(e.destroyHooks??=[]).push(n,D)}}function Mf(e,t,n){Qm(e,t,3,n)}function Su(e,t,n,r){(3&e[vr])===n&&Qm(e,t,n,r)}function rg(e,t){let n=e[vr];(3&n)===t&&(n&=4095,n+=1,e[vr]=n)}function Qm(e,t,n,r){const c=r??-1,d=t.length-1;let _=0;for(let b=void 0!==r?65535&e[Xo]:0;b<d;b++)if("number"==typeof t[b+1]){if(_=t[b],null!=r&&_>=r)break}else t[b]<0&&(e[Xo]+=65536),(_<c||-1==c)&&(ey(e,n,t,b),e[Xo]=(4294901760&e[Xo])+b+2),b++}function rc(e,t){He(4,e,t);const n=wa(null);try{t.call(e)}finally{wa(n),He(5,e,t)}}function ey(e,t,n,r){const o=n[r]<0,c=n[r+1],_=e[o?-n[r]:n[r]];o?e[vr]>>12<e[Xo]>>16&&(3&e[vr])===t&&(e[vr]+=4096,rc(_,c)):rc(_,c)}const ic=-1;class lh{constructor(t,n,r){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=r}}function ud(e){return e!==ic}function ch(e){return 32767&e}function ld(e,t){let n=function hh(e){return e>>16}(e),r=t;for(;n>0;)r=r[Pa],n--;return r}let ig=!0;function Gh(e){const t=ig;return ig=e,t}const hl=255,cd=5;let Fu=0;const Ea={};function ds(e,t){const n=hd(e,t);if(-1!==n)return n;const r=t[an];r.firstCreatePass&&(e.injectorIndex=t.length,sg(r.data,e),sg(t,null),sg(r.blueprint,null));const o=Fl(e,t),c=e.injectorIndex;if(ud(o)){const d=ch(o),_=ld(o,t),b=_[an].data;for(let C=0;C<8;C++)t[c+C]=_[d+C]|b[d+C]}return t[c+8]=o,c}function sg(e,t){e.push(0,0,0,0,0,0,0,0,t)}function hd(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function Fl(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,o=t;for(;null!==o;){if(r=Iu(o),null===r)return ic;if(n++,o=o[Pa],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return ic}function ny(e,t,n){!function ty(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(sa)&&(r=n[sa]),null==r&&(r=n[sa]=Fu++);const o=r&hl;t.data[e+(o>>cd)]|=1<<o}(e,t,n)}function ry(e,t,n){if(n&pr.Optional||void 0!==e)return e;Qo()}function iy(e,t,n,r){if(n&pr.Optional&&void 0===r&&(r=null),!(n&(pr.Self|pr.Host))){const o=e[Ql],c=kr(void 0);try{return o?o.get(t,r,n&pr.Optional):Ac(t,r,n&pr.Optional)}finally{kr(c)}}return ry(r,0,n)}function $h(e,t,n,r=pr.Default,o){if(null!==e){if(2048&t[vr]&&!(r&pr.Self)){const d=function ay(e,t,n,r,o){let c=e,d=t;for(;null!==c&&null!==d&&2048&d[vr]&&!(512&d[vr]);){const _=oy(c,d,n,r|pr.Self,Ea);if(_!==Ea)return _;let b=c.parent;if(!b){const C=d[sh];if(C){const D=C.get(n,Ea,r);if(D!==Ea)return D}b=Iu(d),d=d[Pa]}c=b}return o}(e,t,n,r,Ea);if(d!==Ea)return d}const c=oy(e,t,n,r,Ea);if(c!==Ea)return c}return iy(t,n,r,o)}function oy(e,t,n,r,o){const c=function Hx(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(sa)?e[sa]:void 0;return"number"==typeof t?t>=0?t&hl:up:t}(n);if("function"==typeof c){if(!Ov(t,e,r))return r&pr.Host?ry(o,0,r):iy(t,n,r,o);try{const d=c(r);if(null!=d||r&pr.Optional)return d;Qo()}finally{Fc()}}else if("number"==typeof c){let d=null,_=hd(e,t),b=ic,C=r&pr.Host?t[to][Mi]:null;for((-1===_||r&pr.SkipSelf)&&(b=-1===_?Fl(e,t):t[_+8],b!==ic&&sy(r,!1)?(d=t[an],_=ch(b),t=ld(b,t)):_=-1);-1!==_;){const D=t[an];if(jv(c,_,D.data)){const P=Vv(_,t,n,d,r,C);if(P!==Ea)return P}b=t[_+8],b!==ic&&sy(r,t[an].data[_+8]===C)&&jv(c,_,t)?(d=D,_=ch(b),t=ld(b,t)):_=-1}}return o}function Vv(e,t,n,r,o,c){const d=t[an],_=d.data[e+8],D=function ap(e,t,n,r,o){const c=e.providerIndexes,d=t.data,_=1048575&c,b=e.directiveStart,D=c>>20,N=o?_+D:e.directiveEnd;for(let B=r?_:_+D;B<N;B++){const le=d[B];if(B<b&&n===le||B>=b&&le.type===n)return B}if(o){const B=d[b];if(B&&Vs(B)&&B.type===n)return b}return null}(_,d,n,null==r?ur(_)&&ig:r!=d&&0!=(3&_.type),o&pr.Host&&c===_);return null!==D?qh(t,d,D,_):Ea}function qh(e,t,n,r){let o=e[n];const c=t.data;if(function Df(e){return e instanceof lh}(o)){const d=o;d.resolving&&function fi(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new Dn(-200,`Circular dependency in DI detected for ${e}${n}`)}(rr(c[n]));const _=Gh(d.canSeeViewProviders);d.resolving=!0;const b=d.injectImpl?kr(d.injectImpl):null;Ov(e,r,pr.Default);try{o=e[n]=d.factory(void 0,c,e,r),t.firstCreatePass&&n>=r.directiveStart&&function ar(e,t,n){const{ngOnChanges:r,ngOnInit:o,ngDoCheck:c}=t.type.prototype;if(r){const d=Ee(t);(n.preOrderHooks??=[]).push(e,d),(n.preOrderCheckHooks??=[]).push(e,d)}o&&(n.preOrderHooks??=[]).push(0-e,o),c&&((n.preOrderHooks??=[]).push(e,c),(n.preOrderCheckHooks??=[]).push(e,c))}(n,c[n],t)}finally{null!==b&&kr(b),Gh(_),d.resolving=!1,Fc()}}return o}function jv(e,t,n){return!!(n[t+(e>>cd)]&1<<e)}function sy(e,t){return!(e&pr.Self||e&pr.Host&&t)}class Af{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,r){return $h(this._tNode,this._lView,t,Ga(r),n)}}function up(){return new Af(No(),Zt())}function lp(e){return eh(e)?()=>{const t=lp($n(e));return t&&t()}:qn(e)}function Iu(e){const t=e[an],n=t.type;return 2===n?t.declTNode:1===n?e[Mi]:null}const Zu="__parameters__";function Tu(e,t,n){return jo(()=>{const r=function Rf(e){return function(...n){if(e){const r=e(...n);for(const o in r)this[o]=r[o]}}}(t);function o(...c){if(this instanceof o)return r.apply(this,c),this;const d=new o(...c);return _.annotation=d,_;function _(b,C,D){const P=b.hasOwnProperty(Zu)?b[Zu]:Object.defineProperty(b,Zu,{value:[]})[Zu];for(;P.length<=D;)P.push(null);return(P[D]=P[D]||[]).push(d),b}}return n&&(o.prototype=Object.create(n.prototype)),o.prototype.ngMetadataName=e,o.annotationCls=o,o})}function Wh(e,t){e.forEach(n=>Array.isArray(n)?Wh(n,t):t(n))}function cy(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function Xh(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}const Sa=Fs(Tu("Optional"),8),dh=Fs(Tu("SkipSelf"),4);function xg(e){return 128==(128&e.flags)}var pl=(()=>((pl=pl||{})[pl.Important=1]="Important",pl[pl.DashCase=2]="DashCase",pl))();const Of=new Map;let tw=0;const Kh="__ngContext__";function zu(e,t){Zs(t)?(e[Kh]=t[po],function rw(e){Of.set(e[po],e)}(t)):e[Kh]=t}let yp;function Iy(e,t){return yp(e,t)}function ph(e){const t=e[fo];return Rs(t)?t[fo]:t}function My(e){return Cg(e[la])}function _p(e){return Cg(e[ns])}function Cg(e){for(;null!==e&&!Rs(e);)e=e[ns];return e}function gh(e,t,n,r,o){if(null!=r){let c,d=!1;Rs(r)?c=r:Zs(r)&&(d=!0,r=r[ii]);const _=it(r);0===e&&null!==n?null==o?vp(t,n,_):mh(t,n,_,o||null,!0):1===e&&null!==n?mh(t,n,_,o||null,!0):2===e?function Ep(e,t,n){const r=Jh(e,t);r&&function hw(e,t,n,r){e.removeChild(t,n,r)}(e,r,t,n)}(t,_,d):3===e&&t.destroyNode(_),null!=c&&function Uu(e,t,n,r,o){const c=n[hs];c!==it(n)&&gh(t,e,r,c,o);for(let _=fs;_<n.length;_++){const b=n[_];Sd(b[an],b,e,t,r,c)}}(t,e,c,n,o)}}function Ig(e,t,n){return e.createElement(t,n)}function u0(e,t){const n=e[Eu],r=n.indexOf(t);nr(t),n.splice(r,1)}function Ay(e,t){if(e.length<=fs)return;const n=fs+t,r=e[n];if(r){const o=r[Po];null!==o&&o!==e&&u0(o,r),t>0&&(e[n-1][ns]=r[ns]);const c=Xh(e,fs+t);!function aw(e,t){Sd(e,t,t[Kn],2,null,null),t[ii]=null,t[Mi]=null}(r[an],r);const d=c[An];null!==d&&d.detachView(c[an]),r[fo]=null,r[ns]=null,r[vr]&=-129}return r}function l0(e,t){if(!(256&t[vr])){const n=t[Kn];t[Ps]?.destroy(),t[ca]?.destroy(),n.destroyNode&&Sd(e,t,n,3,null,null),function lw(e){let t=e[la];if(!t)return Mg(e[an],e);for(;t;){let n=null;if(Zs(t))n=t[la];else{const r=t[fs];r&&(n=r)}if(!n){for(;t&&!t[ns]&&t!==e;)Zs(t)&&Mg(t[an],t),t=t[fo];null===t&&(t=e),Zs(t)&&Mg(t[an],t),n=t&&t[ns]}t=n}}(t)}}function Mg(e,t){if(!(256&t[vr])){t[vr]&=-129,t[vr]|=256,function cw(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const o=t[n[r]];if(!(o instanceof lh)){const c=n[r+1];if(Array.isArray(c))for(let d=0;d<c.length;d+=2){const _=o[c[d]],b=c[d+1];He(4,_,b);try{b.call(_)}finally{He(5,_,b)}}else{He(4,o,c);try{c.call(o)}finally{He(5,o,c)}}}}}(e,t),function c0(e,t){const n=e.cleanup,r=t[Xs];if(null!==n)for(let c=0;c<n.length-1;c+=2)if("string"==typeof n[c]){const d=n[c+3];d>=0?r[d]():r[-d].unsubscribe(),c+=2}else n[c].call(r[n[c+1]]);null!==r&&(t[Xs]=null);const o=t[Xa];if(null!==o){t[Xa]=null;for(let c=0;c<o.length;c++)(0,o[c])()}}(e,t),1===t[an].type&&t[Kn].destroy();const n=t[Po];if(null!==n&&Rs(t[fo])){n!==t[fo]&&u0(n,t);const r=t[An];null!==r&&r.detachView(e)}!function iw(e){Of.delete(e[po])}(t)}}function Py(e,t,n){return function h0(e,t,n){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[ii];{const{componentOffset:o}=r;if(o>-1){const{encapsulation:c}=e.data[r.directiveStart+o];if(c===ou.None||c===ou.Emulated)return null}return Tt(r,n)}}(e,t.parent,n)}function mh(e,t,n,r,o){e.insertBefore(t,n,r,o)}function vp(e,t,n){e.appendChild(t,n)}function xp(e,t,n,r,o){null!==r?mh(e,t,n,r,o):vp(e,t,n)}function Jh(e,t){return e.parentNode(t)}let Oy,Dd,Ly=function Ed(e,t,n){return 40&e.type?Tt(e,n):null};function bp(e,t,n,r){const o=Py(e,r,t),c=t[Kn],_=function Ry(e,t,n){return Ly(e,t,n)}(r.parent||t[Mi],r,t);if(null!=o)if(Array.isArray(n))for(let b=0;b<n.length;b++)xp(c,o,n[b],_,!1);else xp(c,o,n,_,!1);void 0!==Oy&&Oy(c,r,t,n,o)}function Cd(e,t){if(null!==t){const n=t.type;if(3&n)return Tt(t,e);if(4&n)return Dg(-1,e[t.index]);if(8&n){const r=t.child;if(null!==r)return Cd(e,r);{const o=e[t.index];return Rs(o)?Dg(-1,o):it(o)}}if(32&n)return Iy(t,e)()||it(e[t.index]);{const r=ky(e,t);return null!==r?Array.isArray(r)?r[0]:Cd(ph(e[to]),r):Cd(e,t.next)}}return null}function ky(e,t){return null!==t?e[to][Mi].projection[t.projection]:null}function Dg(e,t){const n=fs+e+1;if(n<t.length){const r=t[n],o=r[an].firstChild;if(null!==o)return Cd(r,o)}return t[hs]}function Fy(e,t,n,r,o,c,d){for(;null!=n;){const _=r[n.index],b=n.type;if(d&&0===t&&(_&&zu(it(_),r),n.flags|=2),32!=(32&n.flags))if(8&b)Fy(e,t,n.child,r,o,c,!1),gh(t,e,o,_,c);else if(32&b){const C=Iy(n,r);let D;for(;D=C();)gh(t,e,o,D,c);gh(t,e,o,_,c)}else 16&b?By(e,t,r,n,o,c):gh(t,e,o,_,c);n=d?n.projectionNext:n.next}}function Sd(e,t,n,r,o,c){Fy(n,r,e.firstChild,t,o,c,!1)}function By(e,t,n,r,o,c){const d=n[to],b=d[Mi].projection[r.projection];if(Array.isArray(b))for(let C=0;C<b.length;C++)gh(t,e,o,b[C],c);else{let C=b;const D=d[fo];xg(r)&&(C.flags|=128),Fy(e,t,C,D,o,c,!0)}}function Td(e,t,n){""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n)}function zy(e,t,n){const{mergedAttrs:r,classes:o,styles:c}=n;null!==r&&al(e,t,r),null!==o&&Td(e,t,o),null!==c&&function Id(e,t,n){e.setAttribute(t,"style",n)}(e,t,c)}class Ar{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=Vn({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Nd=new Ar("ENVIRONMENT_INITIALIZER"),Yy=new Ar("INJECTOR",-1),Bg=new Ar("INJECTOR_DEF_TYPES");class Ky{get(t,n=qu){if(n===qu){const r=new Error(`NullInjectorError: No provider for ${oo(t)}!`);throw r.name="NullInjectorError",r}return n}}function I0(...e){return{\u0275providers:$c(0,e),\u0275fromNgModule:!0}}function $c(e,...t){const n=[],r=new Set;let o;return Wh(t,c=>{const d=c;zg(d,n,[],r)&&(o||=[],o.push(d))}),void 0!==o&&Jy(o,n),n}function Jy(e,t){for(let n=0;n<e.length;n++){const{providers:o}=e[n];Ug(o,c=>{t.push(c)})}}function zg(e,t,n,r){if(!(e=$n(e)))return!1;let o=null,c=Ts(e);const d=!c&&Qr(e);if(c||d){if(d&&!d.standalone)return!1;o=e}else{const b=e.ngModule;if(c=Ts(b),!c)return!1;o=b}const _=r.has(o);if(d){if(_)return!1;if(r.add(o),d.dependencies){const b="function"==typeof d.dependencies?d.dependencies():d.dependencies;for(const C of b)zg(C,t,n,r)}}else{if(!c)return!1;{if(null!=c.imports&&!_){let C;r.add(o);try{Wh(c.imports,D=>{zg(D,t,n,r)&&(C||=[],C.push(D))})}finally{}void 0!==C&&Jy(C,t)}if(!_){const C=qn(o)||(()=>new o);t.push({provide:o,useFactory:C,deps:Wr},{provide:Bg,useValue:o,multi:!0},{provide:Nd,useValue:()=>Wn(o),multi:!0})}const b=c.providers;null==b||_||Ug(b,D=>{t.push(D)})}}return o!==e&&void 0!==e.providers}function Ug(e,t){for(let n of e)pn(n)&&(n=n.\u0275providers),Array.isArray(n)?Ug(n,t):t(n)}const ww=Bn({provide:String,useValue:Bn});function Qy(e){return null!==e&&"object"==typeof e&&ww in e}function xc(e){return"function"==typeof e}const Vg=new Ar("Set Injector scope."),yl={},n_={};let ef;function yh(){return void 0===ef&&(ef=new Ky),ef}class qc{}class kd extends qc{get destroyed(){return this._destroyed}constructor(t,n,r,o){super(),this.parent=n,this.source=r,this.scopes=o,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,tf(t,d=>this.processProvider(d)),this.records.set(Yy,Fd(void 0,this)),o.has("environment")&&this.records.set(qc,Fd(void 0,this));const c=this.records.get(Vg);null!=c&&"string"==typeof c.value&&this.scopes.add(c.value),this.injectorDefTypes=new Set(this.get(Bg.multi,Wr,pr.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const n of this._ngOnDestroyHooks)n.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const n of t)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(t){return this.assertNotDestroyed(),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){this.assertNotDestroyed();const n=gi(this),r=kr(void 0);try{return t()}finally{gi(n),kr(r)}}get(t,n=qu,r=pr.Default){if(this.assertNotDestroyed(),t.hasOwnProperty(Wo))return t[Wo](this);r=Ga(r);const o=gi(this),c=kr(void 0);try{if(!(r&pr.SkipSelf)){let _=this.records.get(t);if(void 0===_){const b=function Cw(e){return"function"==typeof e||"object"==typeof e&&e instanceof Ar}(t)&&rl(t);_=b&&this.injectableDefInScope(b)?Fd(jg(t),yl):null,this.records.set(t,_)}if(null!=_)return this.hydrate(t,_)}return(r&pr.Self?yh():this.parent).get(t,n=r&pr.Optional&&n===qu?null:n)}catch(d){if("NullInjectorError"===d.name){if((d[ia]=d[ia]||[]).unshift(oo(t)),o)throw d;return function va(e,t,n,r){const o=e[ia];throw t[Nh]&&o.unshift(t[Nh]),e.message=function xa(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let o=oo(t);if(Array.isArray(t))o=t.map(oo).join(" -> ");else if("object"==typeof t){let c=[];for(let d in t)if(t.hasOwnProperty(d)){let _=t[d];c.push(d+":"+("string"==typeof _?JSON.stringify(_):oo(_)))}o=`{${c.join(", ")}}`}return`${n}${r?"("+r+")":""}[${o}]: ${e.replace(Hu,"\n  ")}`}("\n"+e.message,o,n,r),e.ngTokenPath=o,e[ia]=null,e}(d,t,"R3InjectorError",this.source)}throw d}finally{kr(c),gi(o)}}resolveInjectorInitializers(){const t=gi(this),n=kr(void 0);try{const r=this.get(Nd.multi,Wr,pr.Self);for(const o of r)o()}finally{gi(t),kr(n)}}toString(){const t=[],n=this.records;for(const r of n.keys())t.push(oo(r));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Dn(205,!1)}processProvider(t){let n=xc(t=$n(t))?t:$n(t&&t.provide);const r=function $g(e){return Qy(e)?Fd(void 0,e.useValue):Fd(function M0(e,t,n){let r;if(xc(e)){const o=$n(e);return qn(o)||jg(o)}if(Qy(e))r=()=>$n(e.useValue);else if(function t_(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...ui(e.deps||[]));else if(function e_(e){return!(!e||!e.useExisting)}(e))r=()=>Wn($n(e.useExisting));else{const o=$n(e&&(e.useClass||e.provide));if(!function bw(e){return!!e.deps}(e))return qn(o)||jg(o);r=()=>new o(...ui(e.deps))}return r}(e),yl)}(t);if(xc(t)||!0!==t.multi)this.records.get(n);else{let o=this.records.get(n);o||(o=Fd(void 0,yl,!0),o.factory=()=>ui(o.multi),this.records.set(n,o)),n=t,o.multi.push(t)}this.records.set(n,r)}hydrate(t,n){return n.value===yl&&(n.value=n_,n.value=n.factory()),"object"==typeof n.value&&n.value&&function Ew(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=$n(t.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}removeOnDestroy(t){const n=this._onDestroyHooks.indexOf(t);-1!==n&&this._onDestroyHooks.splice(n,1)}}function jg(e){const t=rl(e),n=null!==t?t.factory:qn(e);if(null!==n)return n;if(e instanceof Ar)throw new Dn(204,!1);if(e instanceof Function)return function Gg(e){const t=e.length;if(t>0)throw function Lf(e,t){const n=[];for(let r=0;r<e;r++)n.push(t);return n}(t,"?"),new Dn(204,!1);const n=function il(e){return e&&(e[ya]||e[Tl])||null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new Dn(204,!1)}function Fd(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function tf(e,t){for(const n of e)Array.isArray(n)?tf(n,t):n&&pn(n)?tf(n.\u0275providers,t):t(n)}const _h=new Ar("AppId",{providedIn:"root",factory:()=>r_}),r_="ng",D0=new Ar("Platform Initializer"),kf=new Ar("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),P0=new Ar("CSP nonce",{providedIn:"root",factory:()=>function Ad(){if(void 0!==Dd)return Dd;if(typeof document<"u")return document;throw new Dn(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let zf=(e,t)=>null;function l_(e,t){return zf(e,t)}class Zg{}class N0{}class Dw{resolveComponentFactory(t){throw function f_(e){const t=Error(`No component factory found for ${oo(e)}.`);return t.ngComponent=e,t}(t)}}let Vd=(()=>{class e{}return e.NULL=new Dw,e})();function k0(){return wh(No(),Zt())}function wh(e,t){return new rf(Tt(e,t))}let rf=(()=>{class e{constructor(n){this.nativeElement=n}}return e.__NG_ELEMENT_ID__=k0,e})();class F0{}let Pw=(()=>{class e{}return e.\u0275prov=Vn({token:e,providedIn:"root",factory:()=>null}),e})();class sf{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const Rw=new sf("16.0.5"),p_={};function jd(e){for(;e;){e[vr]|=64;const t=ph(e);if(Nu(e)&&!t)return e;e=t}return null}function _l(e){return e.ngOriginalError}class Vu{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t);this._console.error("ERROR",t),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&_l(t);for(;n&&_l(n);)n=_l(n);return n||null}}const bh=new Ar("",{providedIn:"root",factory:()=>!1});function Hc(e){return e instanceof Function?e():e}class Rp extends rp{constructor(){super(...arguments),this.consumerAllowSignalWrites=!1,this._lView=null}set lView(t){this._lView=t}onConsumerDependencyMayHaveChanged(){jd(this._lView)}onProducerUpdateValueVersion(){}get hasReadASignal(){return this.hasProducers}runInContext(t,n,r){const o=wa(this);this.trackingVersion++;try{t(n,r)}finally{wa(o)}}destroy(){this.trackingVersion++}}let Qg=null;function $f(){return Qg??=new Rp,Qg}function em(e,t){return e[t]??$f()}function tm(e,t){const n=$f();n.hasReadASignal&&(e[t]=Qg,n.lView=e,Qg=new Rp)}const Nr={};function b_(e,t=null,n=null,r){const o=W0(e,t,n,r);return o.resolveInjectorInitializers(),o}function W0(e,t=null,n=null,r,o=new Set){const c=[n||Wr,I0(e)];return r=r||("object"==typeof e?void 0:oo(e)),new kd(c,t||yh(),r||null,o)}let Ec=(()=>{class e{static create(n,r){if(Array.isArray(n))return b_({name:""},r,n,"");{const o=n.name??"";return b_({name:o},n.parent,n.providers,o)}}}return e.THROW_IF_NOT_FOUND=qu,e.NULL=new Ky,e.\u0275prov=Vn({token:e,providedIn:"any",factory:()=>Wn(Yy)}),e.__NG_ELEMENT_ID__=-1,e})();function Vr(e,t=pr.Default){const n=Zt();return null===n?Wn(e,t):$h(No(),n,$n(e),t)}function Gd(e,t,n,r,o,c,d,_,b,C,D){const P=t.blueprint.slice();return P[ii]=o,P[vr]=140|r,(null!==C||e&&2048&e[vr])&&(P[vr]|=2048),on(P),P[fo]=P[Pa]=e,P[xr]=n,P[Xu]=d||e&&e[Xu],P[Kn]=_||e&&e[Kn],P[Ql]=b||e&&e[Ql]||null,P[Mi]=c,P[po]=function nw(){return tw++}(),P[no]=D,P[sh]=C,P[to]=2==t.type?e[to]:P,P}function af(e,t,n,r,o){let c=e.data[t];if(null===c)c=function rm(e,t,n,r,o){const c=Sf(),d=Nl(),b=e.data[t]=function V(e,t,n,r,o,c){let d=t?t.injectorIndex:-1,_=0;return function Ys(){return null!==Rn.skipHydrationRootTNode}()&&(_|=128),{type:n,index:r,insertBeforeIndex:null,injectorIndex:d,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:_,providerIndexes:0,value:o,attrs:c,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,d?c:c&&c.parent,n,t,r,o);return null===e.firstChild&&(e.firstChild=b),null!==c&&(d?null==c.child&&null!==b.parent&&(c.child=b):null===c.next&&(c.next=b,b.prev=c)),b}(e,t,n,r,o),function Jp(){return Rn.lFrame.inI18n}()&&(c.flags|=32);else if(64&c.type){c.type=n,c.value=r,c.attrs=o;const d=function Ol(){const e=Rn.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();c.injectorIndex=null===d?-1:d.injectorIndex}return ku(c,!0),c}function Eh(e,t,n,r){if(0===n)return-1;const o=t.length;for(let c=0;c<n;c++)t.push(r),e.blueprint.push(r),e.data.push(null);return o}function im(e,t,n,r,o){const c=em(t,Ps),d=function ba(){return Rn.lFrame.selectedIndex}(),_=2&r;try{if(Tf(-1),_&&t.length>li&&function nm(e,t,n,r){if(!r)if(3==(3&t[vr])){const c=e.preOrderCheckHooks;null!==c&&Mf(t,c,n)}else{const c=e.preOrderHooks;null!==c&&Su(t,c,0,n)}Tf(n)}(e,t,li,!1),He(_?2:0,o),_)c.runInContext(n,r,o);else{const C=wa(null);try{n(r,o)}finally{wa(C)}}}finally{_&&null===t[Ps]&&tm(t,Ps),Tf(d),He(_?3:1,o)}}function om(e,t,n){if(Ou(t)){const r=wa(null);try{const c=t.directiveEnd;for(let d=t.directiveStart;d<c;d++){const _=e.data[d];_.contentQueries&&_.contentQueries(1,n[d],d)}}finally{wa(r)}}}function u(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=f(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}function f(e,t,n,r,o,c,d,_,b,C,D){const P=li+r,N=P+o,B=function m(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:Nr);return n}(P,N),le="function"==typeof C?C():C;return B[an]={type:e,blueprint:B,template:n,queries:null,viewQuery:_,declTNode:t,data:B.slice().fill(null,P),bindingStartIndex:P,expandoStartIndex:N,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof c?c():c,pipeRegistry:"function"==typeof d?d():d,firstChild:null,schemas:b,consts:le,incompleteFirstPass:!1,ssrId:D}}let M=e=>null;function G(e,t,n,r){for(let o in e)if(e.hasOwnProperty(o)){n=null===n?{}:n;const c=e[o];null===r?X(n,t,o,c):r.hasOwnProperty(o)&&X(n,t,r[o],c)}return n}function X(e,t,n,r){e.hasOwnProperty(n)?e[n].push(t,r):e[n]=[t,r]}function ct(e,t,n,r,o,c){for(let C=0;C<r.length;C++)ny(ds(n,t),e,r[C].type);!function xn(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}(n,e.data.length,r.length);for(let C=0;C<r.length;C++){const D=r[C];D.providersResolver&&D.providersResolver(D)}let d=!1,_=!1,b=Eh(e,t,r.length,null);for(let C=0;C<r.length;C++){const D=r[C];n.mergedAttrs=Hs(n.mergedAttrs,D.hostAttrs),Xt(e,n,t,b,D),ln(b,D,o),null!==D.contentQueries&&(n.flags|=4),(null!==D.hostBindings||null!==D.hostAttrs||0!==D.hostVars)&&(n.flags|=64);const P=D.type.prototype;!d&&(P.ngOnChanges||P.ngOnInit||P.ngDoCheck)&&((e.preOrderHooks??=[]).push(n.index),d=!0),!_&&(P.ngOnChanges||P.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(n.index),_=!0),b++}!function K(e,t,n){const o=t.directiveEnd,c=e.data,d=t.attrs,_=[];let b=null,C=null;for(let D=t.directiveStart;D<o;D++){const P=c[D],N=n?n.get(P):null,le=N?N.outputs:null;b=G(P.inputs,D,b,N?N.inputs:null),C=G(P.outputs,D,C,le);const se=null===b||null===d||Yl(t)?null:or(b,D,d);_.push(se)}null!==b&&(b.hasOwnProperty("class")&&(t.flags|=8),b.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=_,t.inputs=b,t.outputs=C}(e,n,c)}function Yt(e,t,n){const r=n.directiveStart,o=n.directiveEnd,c=n.index,d=function Qp(){return Rn.lFrame.currentDirectiveIndex}();try{Tf(c);for(let _=r;_<o;_++){const b=e.data[_],C=t[_];pc(_),(null!==b.hostBindings||0!==b.hostVars||null!==b.hostAttrs)&&yn(b,C)}}finally{Tf(-1),pc(d)}}function yn(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function Qt(e,t,n){t.componentOffset=n,(e.components??=[]).push(t.index)}function ln(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;Vs(t)&&(n[""]=e)}}function Xt(e,t,n,r,o){e.data[r]=o;const c=o.factory||(o.factory=qn(o.type)),d=new lh(c,Vs(o),Vr);e.blueprint[r]=d,n[r]=d,function ut(e,t,n,r,o){const c=o.hostBindings;if(c){let d=e.hostBindingOpCodes;null===d&&(d=e.hostBindingOpCodes=[]);const _=~t.index;(function Bt(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(d)!=_&&d.push(_),d.push(n,r,c)}}(e,t,r,Eh(e,n,o.hostVars,Nr),o)}function jr(e,t,n,r,o,c){const d=c[t];if(null!==d)for(let _=0;_<d.length;)wn(r,n,d[_++],d[_++],d[_++])}function wn(e,t,n,r,o){const c=wa(null);try{null!==e.setInput?e.setInput(t,o,n,r):t[r]=o}finally{wa(c)}}function or(e,t,n){let r=null,o=0;for(;o<n.length;){const c=n[o];if(0!==c)if(5!==c){if("number"==typeof c)break;if(e.hasOwnProperty(c)){null===r&&(r=[]);const d=e[c];for(let _=0;_<d.length;_+=2)if(d[_]===t){r.push(c,d[_+1],n[o+1]);break}}o+=2}else o+=2;else o+=4}return r}function wi(e,t){const n=e.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const c=n[r+1];if(-1!==c){const d=e.data[c];eg(n[r]),d.contentQueries(2,t[c],c)}}}function Pr(e,t){return e[la]?e[Lc][ns]=t:e[la]=t,e[Lc]=t,t}function dr(e,t,n){eg(0);const r=wa(null);try{t(e,n)}finally{wa(r)}}function Fo(e,t){const n=e[Ql],r=n?n.get(Vu,null):null;r&&r.handleError(t)}function Eo(e,t,n,r,o){for(let c=0;c<n.length;){const d=n[c++],_=n[c++];wn(e.data[d],t[d],r,_,o)}}function gs(e,t){const n=Nt(t,e),r=n[an];!function Ls(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])}(r,n);const o=n[ii];null!==o&&null===n[no]&&(n[no]=l_(o,n[Ql])),Os(r,n,n[xr])}function Os(e,t,n){Jm(t);try{const r=e.viewQuery;null!==r&&dr(1,r,n);const o=e.template;null!==o&&im(e,t,o,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&wi(e,t),e.staticViewQueries&&dr(2,e.viewQuery,n);const c=e.components;null!==c&&function Bo(e,t){for(let n=0;n<t.length;n++)gs(e,t[n])}(t,c)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[vr]&=-5,kl()}}let Si=(()=>{class e{constructor(){this.all=new Set,this.queue=new Map}create(n,r,o){const c=typeof Zone>"u"?null:Zone.current,d=new q(n,C=>{this.all.has(C)&&this.queue.set(C,c)},o);let _;this.all.add(d),d.notify();const b=()=>{d.cleanup(),_?.(),this.all.delete(d),this.queue.delete(d)};return _=r?.onDestroy(b),{destroy:b}}flush(){if(0!==this.queue.size)for(const[n,r]of this.queue)this.queue.delete(n),r?r.run(()=>n.run()):n.run()}get isQueueEmpty(){return 0===this.queue.size}}return e.\u0275prov=Vn({token:e,providedIn:"root",factory:()=>new e}),e})();function go(e,t,n){let r=n?e.styles:null,o=n?e.classes:null,c=0;if(null!==t)for(let d=0;d<t.length;d++){const _=t[d];"number"==typeof _?c=_:1==c?o=nl(o,_):2==c&&(r=nl(r,_+": "+t[++d]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=o:e.classesWithoutHost=o}function ka(e,t,n,r,o=!1){for(;null!==n;){const c=t[n.index];if(null!==c&&r.push(it(c)),Rs(c)){for(let _=fs;_<c.length;_++){const b=c[_],C=b[an].firstChild;null!==C&&ka(b[an],b,C,r)}c[hs]!==c[ii]&&r.push(c[hs])}const d=n.type;if(8&d)ka(e,t,n.child,r);else if(32&d){const _=Iy(n,t);let b;for(;b=_();)r.push(b)}else if(16&d){const _=ky(t,n);if(Array.isArray(_))r.push(..._);else{const b=ph(t[to]);ka(b[an],b,_,r,!0)}}n=o?n.projectionNext:n.next}return r}function Es(e,t,n,r=!0){const o=t[Xu].rendererFactory;o.begin&&o.begin();try{Ka(e,t,e.template,n)}catch(d){throw r&&Fo(t,d),d}finally{o.end&&o.end(),t[Xu].effectManager?.flush()}}function Ka(e,t,n,r){const o=t[vr];if(256!=(256&o)){t[Xu].effectManager?.flush(),Jm(t);try{on(t),function Xm(e){return Rn.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&im(e,t,n,2,r);const d=3==(3&o);if(d){const C=e.preOrderCheckHooks;null!==C&&Mf(t,C,null)}else{const C=e.preOrderHooks;null!==C&&Su(t,C,0,null),rg(t,0)}if(function Cc(e){for(let t=My(e);null!==t;t=_p(t)){if(!t[wf])continue;const n=t[Eu];for(let r=0;r<n.length;r++){vn(n[r])}}}(t),function Ba(e){for(let t=My(e);null!==t;t=_p(t))for(let n=fs;n<t.length;n++){const r=t[n],o=r[an];kt(r)&&Ka(o,r,o.template,r[xr])}}(t),null!==e.contentQueries&&wi(e,t),d){const C=e.contentCheckHooks;null!==C&&Mf(t,C)}else{const C=e.contentHooks;null!==C&&Su(t,C,1),rg(t,1)}!function X0(e,t){const n=e.hostBindingOpCodes;if(null===n)return;const r=em(t,ca);try{for(let o=0;o<n.length;o++){const c=n[o];if(c<0)Tf(~c);else{const d=c,_=n[++o],b=n[++o];Ym(_,d),r.runInContext(b,2,t[d])}}}finally{null===t[ca]&&tm(t,ca),Tf(-1)}}(e,t);const _=e.components;null!==_&&function Np(e,t){for(let n=0;n<t.length;n++)$d(e,t[n])}(t,_);const b=e.viewQuery;if(null!==b&&dr(2,b,r),d){const C=e.viewCheckHooks;null!==C&&Mf(t,C)}else{const C=e.viewHooks;null!==C&&Su(t,C,2),rg(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[vr]&=-73,nr(t)}finally{kl()}}}function $d(e,t){const n=Nt(t,e);if(kt(n)){const r=n[an];80&n[vr]?Ka(r,n,r.template,n[xr]):n[ua]>0&&Hf(n)}}function Hf(e){for(let r=My(e);null!==r;r=_p(r))for(let o=fs;o<r.length;o++){const c=r[o];if(kt(c))if(1024&c[vr]){const d=c[an];Ka(d,c,d.template,c[xr])}else c[ua]>0&&Hf(c)}const n=e[an].components;if(null!==n)for(let r=0;r<n.length;r++){const o=Nt(n[r],e);kt(o)&&o[ua]>0&&Hf(o)}}class qd{get rootNodes(){const t=this._lView,n=t[an];return ka(n,t,n.firstChild,[])}constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[xr]}set context(t){this._lView[xr]=t}get destroyed(){return 256==(256&this._lView[vr])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[fo];if(Rs(t)){const n=t[su],r=n?n.indexOf(this):-1;r>-1&&(Ay(t,r),Xh(n,r))}this._attachedToViewContainer=!1}l0(this._lView[an],this._lView)}onDestroy(t){!function jn(e,t){if(256==(256&e[vr]))throw new Dn(911,!1);null===e[Xa]&&(e[Xa]=[]),e[Xa].push(t)}(this._lView,t)}markForCheck(){jd(this._cdRefInjectingView||this._lView)}detach(){this._lView[vr]&=-129}reattach(){this._lView[vr]|=128}detectChanges(){Es(this._lView[an],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Dn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Tg(e,t){Sd(e,t,t[Kn],2,null,null)}(this._lView[an],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Dn(902,!1);this._appRef=t}}class Z0 extends qd{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;Es(t[an],t,t[xr],!1)}checkNoChanges(){}get context(){return null}}class C_ extends Vd{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=Qr(t);return new vl(n,this.ngModule)}}function S_(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}class T_{constructor(t,n){this.injector=t,this.parentInjector=n}get(t,n,r){r=Ga(r);const o=this.injector.get(t,p_,r);return o!==p_||n===p_?o:this.parentInjector.get(t,n,r)}}class vl extends N0{get inputs(){return S_(this.componentDef.inputs)}get outputs(){return S_(this.componentDef.outputs)}constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function ul(e){return e.map(Fh).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}create(t,n,r,o){let c=(o=o||this.ngModule)instanceof qc?o:o?.injector;c&&null!==this.componentDef.getStandaloneInjector&&(c=this.componentDef.getStandaloneInjector(c)||c);const d=c?new T_(t,c):t,_=d.get(F0,null);if(null===_)throw new Dn(407,!1);const D={rendererFactory:_,sanitizer:d.get(Pw,null),effectManager:d.get(Si,null)},P=_.createRenderer(null,this.componentDef),N=this.componentDef.selectors[0][0]||"div",B=r?function w(e,t,n,r){const c=r.get(bh,!1)||n===ou.ShadowDom,d=e.selectRootElement(t,c);return function S(e){M(e)}(d),d}(P,r,this.componentDef.encapsulation,d):Ig(P,N,function I_(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(N)),le=this.componentDef.onPush?576:528,se=f(0,null,null,1,0,null,null,null,null,null,null),Oe=Gd(null,se,null,le,null,null,D,P,d,null,null);let Se,ae;Jm(Oe);try{const Me=this.componentDef;let ot,lt=null;Me.findHostDirectiveDefs?(ot=[],lt=new Map,Me.findHostDirectiveDefs(Me,ot,lt),ot.push(Me)):ot=[Me];const Mt=function M_(e,t){const n=e[an],r=li;return e[r]=t,af(n,r,2,"#host",null)}(Oe,B),Pt=function D_(e,t,n,r,o,c,d){const _=o[an];!function uf(e,t,n,r){for(const o of e)t.mergedAttrs=Hs(t.mergedAttrs,o.hostAttrs);null!==t.mergedAttrs&&(go(t,t.mergedAttrs,!0),null!==n&&zy(r,n,t))}(r,e,t,d);let b=null;null!==t&&(b=l_(t,o[Ql]));const C=c.rendererFactory.createRenderer(t,n),D=Gd(o,u(n),null,n.onPush?64:16,o[e.index],e,c,C,null,null,b);return _.firstCreatePass&&Qt(_,e,r.length-1),Pr(o,D),o[e.index]=D}(Mt,B,Me,ot,Oe,D,P);ae=function Rt(e,t){return e.data[t]}(se,li),B&&function zw(e,t,n,r){if(r)al(e,n,["ng-version",Rw.full]);else{const{attrs:o,classes:c}=function ll(e){const t=[],n=[];let r=1,o=2;for(;r<e.length;){let c=e[r];if("string"==typeof c)2===o?""!==c&&t.push(c,e[++r]):8===o&&n.push(c);else{if(!qa(o))break;o=c}r++}return{attrs:t,classes:n}}(t.selectors[0]);o&&al(e,n,o),c&&c.length>0&&Td(e,n,c.join(" "))}}(P,Me,B,r),void 0!==n&&function xl(e,t,n){const r=e.projection=[];for(let o=0;o<t.length;o++){const c=n[o];r.push(null!=c?Array.from(c):null)}}(ae,this.ngContentSelectors,n),Se=function A_(e,t,n,r,o,c){const d=No(),_=o[an],b=Tt(d,o);ct(_,o,d,n,null,r);for(let D=0;D<n.length;D++)zu(qh(o,_,d.directiveStart+D,d),o);Yt(_,o,d),b&&zu(b,o);const C=qh(o,_,d.directiveStart+d.componentOffset,d);if(e[xr]=o[xr]=C,null!==c)for(const D of c)D(C,t);return om(_,d,e),C}(Pt,Me,ot,lt,Oe,[wl]),Os(se,Oe,null)}finally{kl()}return new Y0(this.componentType,Se,wh(ae,Oe),Oe,ae)}}class Y0 extends Zg{constructor(t,n,r,o,c){super(),this.location=r,this._rootLView=o,this._tNode=c,this.previousInputValues=null,this.instance=n,this.hostView=this.changeDetectorRef=new Z0(o),this.componentType=t}setInput(t,n){const r=this._tNode.inputs;let o;if(null!==r&&(o=r[t])){if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),n))return;const c=this._rootLView;Eo(c[an],c,o,t,n),this.previousInputValues.set(t,n),jd(Nt(this._tNode.index,c))}}get injector(){return new Af(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function wl(){const e=No();gc(Zt()[an],e)}function Ww(e,t,n,r,o){const d=o?"class":"style";Eo(e,n,t.inputs[d],d,r)}function Fp(e,t,n,r){const o=Zt(),c=Sr(),d=li+e,_=o[Kn],b=c.firstCreatePass?function aL(e,t,n,r,o,c){const d=t.consts,b=af(t,e,2,r,un(d,o));return function et(e,t,n,r){if(wo()){const o=null===r?null:{"":-1},c=function jt(e,t){const n=e.directiveRegistry;let r=null,o=null;if(n)for(let c=0;c<n.length;c++){const d=n[c];if(xu(t,d.selectors,!1))if(r||(r=[]),Vs(d))if(null!==d.findHostDirectiveDefs){const _=[];o=o||new Map,d.findHostDirectiveDefs(d,_,o),r.unshift(..._,d),Qt(e,t,_.length)}else r.unshift(d),Qt(e,t,0);else o=o||new Map,d.findHostDirectiveDefs?.(d,r,o),r.push(d)}return null===r?null:[r,o]}(e,n);let d,_;null===c?d=_=null:[d,_]=c,null!==d&&ct(e,t,n,d,o,_),o&&function en(e,t,n){if(t){const r=e.localNames=[];for(let o=0;o<t.length;o+=2){const c=n[t[o+1]];if(null==c)throw new Dn(-301,!1);r.push(t[o],c)}}}(n,r,o)}n.mergedAttrs=Hs(n.mergedAttrs,n.attrs)}(t,n,b,un(d,c)),null!==b.attrs&&go(b,b.attrs,!1),null!==b.mergedAttrs&&go(b,b.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,b),b}(d,c,o,t,n,r):c.data[d],C=WS(c,o,b,_,t,e);o[d]=C;const D=Ra(b);return ku(b,!0),zy(_,C,b),32!=(32&b.flags)&&ng()&&bp(c,o,C,b),0===function ao(){return Rn.lFrame.elementDepthCount}()&&zu(C,o),function Ro(){Rn.lFrame.elementDepthCount++}(),D&&(function s(e,t,n){wo()&&(function Ot(e,t,n,r){const o=n.directiveStart,c=n.directiveEnd;ur(n)&&function Ln(e,t,n){const r=Tt(t,e),d=Pr(e,Gd(e,u(n),null,n.onPush?64:16,r,t,null,e[Xu].rendererFactory.createRenderer(r,n),null,null,null));e[t.index]=d}(t,n,e.data[o+n.componentOffset]),e.firstCreatePass||ds(n,t),zu(r,t);const d=n.initialInputs;for(let _=o;_<c;_++){const b=e.data[_],C=qh(t,e,_,n);zu(C,t),null!==d&&jr(0,_-o,C,b,0,d),Vs(b)&&(Nt(n.index,t)[xr]=qh(t,e,_,n))}}(e,t,n,Tt(n,t)),64==(64&n.flags)&&Yt(e,t,n))}(c,o,b),om(c,b,o)),null!==r&&function i(e,t,n=Tt){const r=t.localNames;if(null!==r){let o=t.index+1;for(let c=0;c<r.length;c+=2){const d=r[c+1],_=-1===d?n(t,e):e[d];e[o++]=_}}}(o,b),Fp}function mm(){let e=No();Nl()?function tc(){Rn.lFrame.isParent=!1}():(e=e.parent,ku(e,!1));const t=e;(function Na(e){return Rn.skipHydrationRootTNode===e})(t)&&function Oo(){Rn.skipHydrationRootTNode=null}(),function Lo(){Rn.lFrame.elementDepthCount--}();const n=Sr();return n.firstCreatePass&&(gc(n,e),Ou(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function zv(e){return 0!=(8&e.flags)}(t)&&Ww(n,t,Zt(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Gx(e){return 0!=(16&e.flags)}(t)&&Ww(n,t,Zt(),t.stylesWithoutHost,!1),mm}function ym(e,t,n,r){return Fp(e,t,n,r),mm(),ym}let WS=(e,t,n,r,o,c)=>(Zo(!0),Ig(r,o,function nc(){return Rn.lFrame.currentNamespace}()));function r1(e){return!!e&&"function"==typeof e.then}function YS(e){return!!e&&"function"==typeof e.subscribe}function i1(e,t,n,r){const o=Zt(),c=Sr(),d=No();return function JS(e,t,n,r,o,c,d){const _=Ra(r),C=e.firstCreatePass&&function $r(e){return e.cleanup||(e.cleanup=[])}(e),D=t[xr],P=function Gr(e){return e[Xs]||(e[Xs]=[])}(t);let N=!0;if(3&r.type||d){const se=Tt(r,t),Oe=d?d(se):se,Se=P.length,ae=d?ot=>d(it(ot[r.index])):r.index;let Me=null;if(!d&&_&&(Me=function pL(e,t,n,r){const o=e.cleanup;if(null!=o)for(let c=0;c<o.length-1;c+=2){const d=o[c];if(d===n&&o[c+1]===r){const _=t[Xs],b=o[c+2];return _.length>b?_[b]:null}"string"==typeof d&&(c+=2)}return null}(e,t,o,r.index)),null!==Me)(Me.__ngLastListenerFn__||Me).__ngNextListenerFn__=c,Me.__ngLastListenerFn__=c,N=!1;else{c=eI(r,t,D,c,!1);const ot=n.listen(Oe,o,c);P.push(c,ot),C&&C.push(o,ae,Se,Se+1)}}else c=eI(r,t,D,c,!1);const B=r.outputs;let le;if(N&&null!==B&&(le=B[o])){const se=le.length;if(se)for(let Oe=0;Oe<se;Oe+=2){const lt=t[le[Oe]][le[Oe+1]].subscribe(c),Mt=P.length;P.push(c,lt),C&&C.push(o,r.index,Mt,-(Mt+1))}}}(c,o,o[Kn],d,e,t,r),i1}function QS(e,t,n,r){try{return He(6,t,n),!1!==n(r)}catch(o){return Fo(e,o),!1}finally{He(7,t,n)}}function eI(e,t,n,r,o){return function c(d){if(d===Function)return r;jd(e.componentOffset>-1?Nt(e.index,t):t);let b=QS(t,n,r,d),C=c.__ngNextListenerFn__;for(;C;)b=QS(t,n,C,d)&&b,C=C.__ngNextListenerFn__;return o&&!1===b&&d.preventDefault(),b}}function a1(e,t=""){const n=Zt(),r=Sr(),o=e+li,c=r.firstCreatePass?af(r,o,1,t,null):r.data[o],d=SI(r,n,c,t,e);n[o]=d,ng()&&bp(r,n,d,c),ku(c,!1)}let SI=(e,t,n,r,o)=>(Zo(!0),function Sg(e,t){return e.createText(t)}(t[Kn],r));const xm="en-US";let XI=xm;class wm{}class xT{}class ub extends wm{constructor(t,n,r){super(),this._parent=n,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new C_(this);const o=eo(t);this._bootstrapComponents=Hc(o.bootstrap),this._r3Injector=W0(t,n,[{provide:wm,useValue:this},{provide:Vd,useValue:this.componentFactoryResolver},...r],oo(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class lb extends xT{constructor(t){super(),this.moduleType=t}create(t){return new ub(this.moduleType,t,[])}}class wT extends wm{constructor(t){super(),this.componentFactoryResolver=new C_(this),this.instance=null;const n=new kd([...t.providers,{provide:wm,useValue:this},{provide:Vd,useValue:this.componentFactoryResolver}],t.parent||yh(),t.debugName,new Set(["environment"]));this.injector=n,t.runEnvironmentInitializers&&n.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function cb(e,t,n=null){return new wT({providers:e,parent:t,debugName:n,runEnvironmentInitializers:!0}).injector}let cN=(()=>{class e{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n.id)){const r=$c(0,n.type),o=r.length>0?cb([r],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n.id,o)}return this.cachedInjectors.get(n.id)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}}return e.\u0275prov=Vn({token:e,providedIn:"environment",factory:()=>new e(Wn(qc))}),e})();function bT(e){e.getStandaloneInjector=t=>t.get(cN).getOrCreateStandaloneInjector(e)}function fb(e){return t=>{setTimeout(e,void 0,t)}}const Ul=class kN extends zt{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,r){let o=t,c=n||(()=>null),d=r;if(t&&"object"==typeof t){const b=t;o=b.next?.bind(b),c=b.error?.bind(b),d=b.complete?.bind(b)}this.__isAsync&&(c=fb(c),o&&(o=fb(o)),d&&(d=fb(d)));const _=super.subscribe({next:o,error:c,complete:d});return t instanceof H&&t.add(_),_}};let Th=(()=>{class e{}return e.__NG_ELEMENT_ID__=WN,e})();function WN(){return function zT(e,t){let n;const r=t[e.index];return Rs(r)?n=r:(n=function Fr(e,t,n,r){return[e,!0,!1,t,null,0,r,n,null,null,null]}(r,t,null,e),t[e.index]=n,Pr(t,n)),UT(n,t,e,r),new FT(n,e,t)}(No(),Zt())}const XN=Th,FT=class extends XN{constructor(t,n,r){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=r}get element(){return wh(this._hostTNode,this._hostLView)}get injector(){return new Af(this._hostTNode,this._hostLView)}get parentInjector(){const t=Fl(this._hostTNode,this._hostLView);if(ud(t)){const n=ld(t,this._hostLView),r=ch(t);return new Af(n[an].data[r+8],n)}return new Af(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=BT(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-fs}createEmbeddedView(t,n,r){let o,c;"number"==typeof r?o=r:null!=r&&(o=r.index,c=r.injector);const _=t.createEmbeddedViewImpl(n||{},c,null);return this.insertImpl(_,o,false),_}createComponent(t,n,r,o,c){const d=t&&!function Bc(e){return"function"==typeof e}(t);let _;if(d)_=n;else{const se=n||{};_=se.index,r=se.injector,o=se.projectableNodes,c=se.environmentInjector||se.ngModuleRef}const b=d?t:new vl(Qr(t)),C=r||this.parentInjector;if(!c&&null==b.ngModule){const Oe=(d?C:this.parentInjector).get(qc,null);Oe&&(c=Oe)}Qr(b.componentType??{});const B=b.create(C,o,null,c);return this.insertImpl(B.hostView,_,false),B}insert(t,n){return this.insertImpl(t,n,!1)}insertImpl(t,n,r){const o=t._lView,c=o[an];if(function Jt(e){return Rs(e[fo])}(o)){const b=this.indexOf(t);if(-1!==b)this.detach(b);else{const C=o[fo],D=new FT(C,C[Mi],C[fo]);D.detach(D.indexOf(t))}}const d=this._adjustIndex(n),_=this._lContainer;if(function a0(e,t,n,r){const o=fs+r,c=n.length;r>0&&(n[o-1][ns]=t),r<c-fs?(t[ns]=n[o],cy(n,fs+r,t)):(n.push(t),t[ns]=null),t[fo]=n;const d=t[Po];null!==d&&n!==d&&function bd(e,t){const n=e[Eu];t[to]!==t[fo][fo][to]&&(e[wf]=!0),null===n?e[Eu]=[t]:n.push(t)}(d,t);const _=t[An];null!==_&&_.insertView(e),t[vr]|=128}(c,o,_,d),!r){const b=Dg(d,_),C=o[Kn],D=Jh(C,_[hs]);null!==D&&function uw(e,t,n,r,o,c){r[ii]=o,r[Mi]=t,Sd(e,r,n,1,o,c)}(c,_[Mi],C,o,D,b)}return t.attachToViewContainerRef(),cy(gb(_),d,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=BT(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),r=Ay(this._lContainer,n);r&&(Xh(gb(this._lContainer),n),l0(r[an],r))}detach(t){const n=this._adjustIndex(t,-1),r=Ay(this._lContainer,n);return r&&null!=Xh(gb(this._lContainer),n)?new qd(r):null}_adjustIndex(t,n=0){return t??this.length+n}};function BT(e){return e[su]}function gb(e){return e[su]||(e[su]=[])}let UT=function VT(e,t,n,r){if(e[hs])return;let o;o=8&n.type?it(r):function ZN(e,t){const n=e[Kn],r=n.createComment(""),o=Tt(t,e);return mh(n,Jh(n,o),r,function wp(e,t){return e.nextSibling(t)}(n,o),!1),r}(t,n),e[hs]=o};const Ib=new Ar("Application Initializer");let Tb=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((n,r)=>{this.resolve=n,this.reject=r}),this.appInits=In(Ib,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const n=[];for(const o of this.appInits){const c=o();if(r1(c))n.push(c);else if(YS(c)){const d=new Promise((_,b)=>{c.subscribe({complete:_,error:b})});n.push(d)}}const r=()=>{this.done=!0,this.resolve()};Promise.all(n).then(()=>{r()}).catch(o=>{this.reject(o)}),0===n.length&&r(),this.initialized=!0}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),fM=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const Xf=new Ar("LocaleId",{providedIn:"root",factory:()=>In(Xf,pr.Optional|pr.SkipSelf)||function Ik(){return typeof $localize<"u"&&$localize.locale||xm}()});let dM=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Dt(!1)}add(){this.hasPendingTasks.next(!0);const n=this.taskId++;return this.pendingTasks.add(n),n}remove(n){this.pendingTasks.delete(n),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class Mk{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let pM=(()=>{class e{compileModuleSync(n){return new lb(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const r=this.compileModuleSync(n),c=Hc(eo(n).declarations).reduce((d,_)=>{const b=Qr(_);return b&&d.push(new vl(b)),d},[]);return new Mk(r,c)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Pk=(()=>Promise.resolve(0))();function Mb(e){typeof Zone>"u"?Pk.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}function yM(...e){}class Ia{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Ul(!1),this.onMicrotaskEmpty=new Ul(!1),this.onStable=new Ul(!1),this.onError=new Ul(!1),typeof Zone>"u")throw new Dn(908,!1);Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!r&&n,o.shouldCoalesceRunChangeDetection=r,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=function Rk(){let e=di.requestAnimationFrame,t=di.cancelAnimationFrame;if(typeof Zone<"u"&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function Nk(e){const t=()=>{!function Ok(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(di,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,Ab(e),e.isCheckStableRunning=!0,Db(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),Ab(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,o,c,d,_)=>{try{return _M(e),n.invokeTask(o,c,d,_)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===c.type||e.shouldCoalesceRunChangeDetection)&&t(),vM(e)}},onInvoke:(n,r,o,c,d,_,b)=>{try{return _M(e),n.invoke(o,c,d,_,b)}finally{e.shouldCoalesceRunChangeDetection&&t(),vM(e)}},onHasTask:(n,r,o,c)=>{n.hasTask(o,c),r===o&&("microTask"==c.change?(e._hasPendingMicrotasks=c.microTask,Ab(e),Db(e)):"macroTask"==c.change&&(e.hasPendingMacrotasks=c.macroTask))},onHandleError:(n,r,o,c)=>(n.handleError(o,c),e.runOutsideAngular(()=>e.onError.emit(c)),!1)})}(o)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ia.isInAngularZone())throw new Dn(909,!1)}static assertNotInAngularZone(){if(Ia.isInAngularZone())throw new Dn(909,!1)}run(t,n,r){return this._inner.run(t,n,r)}runTask(t,n,r,o){const c=this._inner,d=c.scheduleEventTask("NgZoneEvent: "+o,t,Lk,yM,yM);try{return c.runTask(d,n,r)}finally{c.cancelTask(d)}}runGuarded(t,n,r){return this._inner.runGuarded(t,n,r)}runOutsideAngular(t){return this._outer.run(t)}}const Lk={};function Db(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Ab(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function _M(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function vM(e){e._nesting--,Db(e)}class kk{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Ul,this.onMicrotaskEmpty=new Ul,this.onStable=new Ul,this.onError=new Ul}run(t,n,r){return t.apply(n,r)}runGuarded(t,n,r){return t.apply(n,r)}runOutsideAngular(t){return t()}runTask(t,n,r,o){return t.apply(n,r)}}const xM=new Ar("",{providedIn:"root",factory:wM});function wM(){const e=In(Ia);let t=!0;return function gu(...e){const t=Ss(e),n=function Jo(e,t){return"number"==typeof tl(e)?e.pop():t}(e,1/0),r=e;return r.length?1===r.length?ir(r[0]):el(n)(Vo(r,t)):mr}(new Fe(o=>{t=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{o.next(t),o.complete()})}),new Fe(o=>{let c;e.runOutsideAngular(()=>{c=e.onStable.subscribe(()=>{Ia.assertNotInAngularZone(),Mb(()=>{!t&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(t=!0,o.next(!0))})})});const d=e.onUnstable.subscribe(()=>{Ia.assertInAngularZone(),t&&(t=!1,e.runOutsideAngular(()=>{o.next(!1)}))});return()=>{c.unsubscribe(),d.unsubscribe()}}).pipe(Wl()))}const bM=new Ar(""),p1=new Ar("");let Lb,Pb=(()=>{class e{constructor(n,r,o){this._ngZone=n,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Lb||(function Fk(e){Lb=e}(o),o.addToWindow(r)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ia.assertNotInAngularZone(),Mb(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Mb(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(n)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,r,o){let c=-1;r&&r>0&&(c=setTimeout(()=>{this._callbacks=this._callbacks.filter(d=>d.timeoutId!==c),n(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:n,timeoutId:c,updateCb:o})}whenStable(n,r,o){if(o&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,r,o),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,r,o){return[]}}return e.\u0275fac=function(n){return new(n||e)(Wn(Ia),Wn(Rb),Wn(p1))},e.\u0275prov=Vn({token:e,factory:e.\u0275fac}),e})(),Rb=(()=>{class e{constructor(){this._applications=new Map}registerApplication(n,r){this._applications.set(n,r)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,r=!0){return Lb?.findTestabilityInTree(this,n,r)??null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})(),Zd=null;const EM=new Ar("AllowMultipleToken"),Ob=new Ar("PlatformDestroyListeners"),Nb=new Ar("appBootstrapListener");class SM{constructor(t,n){this.name=t,this.token=n}}function TM(e,t,n=[]){const r=`Platform: ${t}`,o=new Ar(r);return(c=[])=>{let d=kb();if(!d||d.injector.get(EM,!1)){const _=[...n,...c,{provide:o,useValue:!0}];e?e(_):function Uk(e){if(Zd&&!Zd.get(EM,!1))throw new Dn(400,!1);(function CM(){!function g(e){v=e}(()=>{throw new Dn(600,!1)})})(),Zd=e;const t=e.get(DM);(function IM(e){e.get(D0,null)?.forEach(n=>n())})(e)}(function MM(e=[],t){return Ec.create({name:t,providers:[{provide:Vg,useValue:"platform"},{provide:Ob,useValue:new Set([()=>Zd=null])},...e]})}(_,r))}return function jk(e){const t=kb();if(!t)throw new Dn(401,!1);return t}()}}function kb(){return Zd?.get(DM)??null}let DM=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,r){const o=function Gk(e="zone.js",t){return"noop"===e?new kk:"zone.js"===e?new Ia(t):e}(r?.ngZone,function AM(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:r?.ngZoneEventCoalescing,runCoalescing:r?.ngZoneRunCoalescing}));return o.run(()=>{const c=function lN(e,t,n){return new ub(e,t,n)}(n.moduleType,this.injector,function NM(e){return[{provide:Ia,useFactory:e},{provide:Nd,multi:!0,useFactory:()=>{const t=In(qk,{optional:!0});return()=>t.initialize()}},{provide:OM,useFactory:$k},{provide:xM,useFactory:wM}]}(()=>o)),d=c.injector.get(Vu,null);return o.runOutsideAngular(()=>{const _=o.onError.subscribe({next:b=>{d.handleError(b)}});c.onDestroy(()=>{g1(this._modules,c),_.unsubscribe()})}),function PM(e,t,n){try{const r=n();return r1(r)?r.catch(o=>{throw t.runOutsideAngular(()=>e.handleError(o)),o}):r}catch(r){throw t.runOutsideAngular(()=>e.handleError(r)),r}}(d,o,()=>{const _=c.injector.get(Tb);return _.runInitializers(),_.donePromise.then(()=>(function ZI(e){Ao(e,"Expected localeId to be defined"),"string"==typeof e&&(XI=e.toLowerCase().replace(/_/g,"-"))}(c.injector.get(Xf,xm)||xm),this._moduleDoBootstrap(c),c))})})}bootstrapModule(n,r=[]){const o=RM({},r);return function Bk(e,t,n){const r=new lb(n);return Promise.resolve(r)}(0,0,n).then(c=>this.bootstrapModuleFactory(c,o))}_moduleDoBootstrap(n){const r=n.injector.get(Cm);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(o=>r.bootstrap(o));else{if(!n.instance.ngDoBootstrap)throw new Dn(-403,!1);n.instance.ngDoBootstrap(r)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Dn(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const n=this._injector.get(Ob,null);n&&(n.forEach(r=>r()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(n){return new(n||e)(Wn(Ec))},e.\u0275prov=Vn({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();function RM(e,t){return Array.isArray(t)?t.reduce(RM,e):{...e,...t}}let Cm=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=In(OM),this.zoneIsStable=In(xM),this.componentTypes=[],this.components=[],this.isStable=In(dM).hasPendingTasks.pipe(Cr(n=>n?Or(!1):this.zoneIsStable),function _r(e,t=At){return e=e??Va,_n((n,r)=>{let o,c=!0;n.subscribe(Cn(r,d=>{const _=t(d);(c||!e(o,_))&&(c=!1,o=_,r.next(d))}))})}(),Wl()),this._injector=In(qc)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,r){const o=n instanceof N0;if(!this._injector.get(Tb).done)throw!o&&function Ha(e){const t=Qr(e)||ho(e)||us(e);return null!==t&&t.standalone}(n),new Dn(405,!1);let d;d=o?n:this._injector.get(Vd).resolveComponentFactory(n),this.componentTypes.push(d.componentType);const _=function zk(e){return e.isBoundToModule}(d)?void 0:this._injector.get(wm),C=d.create(Ec.NULL,[],r||d.selector,_),D=C.location.nativeElement,P=C.injector.get(bM,null);return P?.registerApplication(D),C.onDestroy(()=>{this.detachView(C.hostView),g1(this.components,C),P?.unregisterApplication(D)}),this._loadComponent(C),C}tick(){if(this._runningTick)throw new Dn(101,!1);try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this.internalErrorHandler(n)}finally{this._runningTick=!1}}attachView(n){const r=n;this._views.push(r),r.attachToAppRef(this)}detachView(n){const r=n;g1(this._views,r),r.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);const r=this._injector.get(Nb,[]);r.push(...this._bootstrapListeners),r.forEach(o=>o(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>g1(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new Dn(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function g1(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const OM=new Ar("",{providedIn:"root",factory:()=>In(Vu).handleError.bind(void 0)});function $k(){const e=In(Ia),t=In(Vu);return n=>e.runOutsideAngular(()=>t.handleError(n))}let qk=(()=>{class e{constructor(){this.zone=In(Ia),this.applicationRef=In(Cm)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();let Fb=(()=>{class e{}return e.__NG_ELEMENT_ID__=Wk,e})();function Wk(e){return function Xk(e,t,n){if(ur(e)&&!n){const r=Nt(e.index,t);return new qd(r,r)}return 47&e.type?new qd(t[to],t):null}(No(),Zt(),16==(16&e))}const aF=TM(null,"core",[]);let uF=(()=>{class e{constructor(n){}}return e.\u0275fac=function(n){return new(n||e)(Wn(Cm))},e.\u0275mod=Kl({type:e}),e.\u0275inj=yu({}),e})(),qb=null;function Sm(){return qb}class xF{}const Zc=new Ar("DocumentToken");let Hb=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:function(){return In(bF)},providedIn:"platform"}),e})();const wF=new Ar("Location Initialized");let bF=(()=>{class e extends Hb{constructor(){super(),this._doc=In(Zc),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Sm().getBaseHref(this._doc)}onPopState(n){const r=Sm().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",n,!1),()=>r.removeEventListener("popstate",n)}onHashChange(n){const r=Sm().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",n,!1),()=>r.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,r,o){this._history.pushState(n,r,o)}replaceState(n,r,o){this._history.replaceState(n,r,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:function(){return new e},providedIn:"platform"}),e})();function Wb(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function KM(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Zf(e){return e&&"?"!==e[0]?"?"+e:e}let Vp=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:function(){return In(QM)},providedIn:"root"}),e})();const JM=new Ar("appBaseHref");let QM=(()=>{class e extends Vp{constructor(n,r){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??In(Zc).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return Wb(this._baseHref,n)}path(n=!1){const r=this._platformLocation.pathname+Zf(this._platformLocation.search),o=this._platformLocation.hash;return o&&n?`${r}${o}`:r}pushState(n,r,o,c){const d=this.prepareExternalUrl(o+Zf(c));this._platformLocation.pushState(n,r,d)}replaceState(n,r,o,c){const d=this.prepareExternalUrl(o+Zf(c));this._platformLocation.replaceState(n,r,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(Wn(Hb),Wn(JM,8))},e.\u0275prov=Vn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),EF=(()=>{class e extends Vp{constructor(n,r){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(n){const r=Wb(this._baseHref,n);return r.length>0?"#"+r:r}pushState(n,r,o,c){let d=this.prepareExternalUrl(o+Zf(c));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.pushState(n,r,d)}replaceState(n,r,o,c){let d=this.prepareExternalUrl(o+Zf(c));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.replaceState(n,r,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(Wn(Hb),Wn(JM,8))},e.\u0275prov=Vn({token:e,factory:e.\u0275fac}),e})(),Xb=(()=>{class e{constructor(n){this._subject=new Ul,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const r=this._locationStrategy.getBaseHref();this._basePath=function IF(e){if(new RegExp("^(https?:)?//").test(e)){const[,n]=e.split(/\/\/[^\/]+/);return n}return e}(KM(eD(r))),this._locationStrategy.onPopState(o=>{this._subject.emit({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,r=""){return this.path()==this.normalize(n+Zf(r))}normalize(n){return e.stripTrailingSlash(function SF(e,t){if(!e||!t.startsWith(e))return t;const n=t.substring(e.length);return""===n||["/",";","?","#"].includes(n[0])?n:t}(this._basePath,eD(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,r="",o=null){this._locationStrategy.pushState(o,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Zf(r)),o)}replaceState(n,r="",o=null){this._locationStrategy.replaceState(o,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Zf(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",r){this._urlChangeListeners.forEach(o=>o(n,r))}subscribe(n,r,o){return this._subject.subscribe({next:n,error:r,complete:o})}}return e.normalizeQueryParams=Zf,e.joinWithSlash=Wb,e.stripTrailingSlash=KM,e.\u0275fac=function(n){return new(n||e)(Wn(Vp))},e.\u0275prov=Vn({token:e,factory:function(){return function CF(){return new Xb(Wn(Vp))}()},providedIn:"root"}),e})();function eD(e){return e.replace(/\/index.html$/,"")}let U3=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Kl({type:e}),e.\u0275inj=yu({}),e})();function mD(e){return"server"===e}let $3=(()=>{class e{}return e.\u0275prov=Vn({token:e,providedIn:"root",factory:()=>new q3(Wn(Zc),window)}),e})();class q3{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const n=function H3(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let o=r.currentNode;for(;o;){const c=o.shadowRoot;if(c){const d=c.getElementById(t)||c.querySelector(`[name="${t}"]`);if(d)return d}o=r.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=t)}}scrollToElement(t){const n=t.getBoundingClientRect(),r=n.left+this.window.pageXOffset,o=n.top+this.window.pageYOffset,c=this.offset();this.window.scrollTo(r-c[0],o-c[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=yD(this.window.history)||yD(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function yD(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class xB extends xF{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class hE extends xB{static makeCurrent(){!function vF(e){qb||(qb=e)}(new hE)}onAndCancel(t,n,r){return t.addEventListener(n,r),()=>{t.removeEventListener(n,r)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function wB(){return X_=X_||document.querySelector("base"),X_?X_.getAttribute("href"):null}();return null==n?null:function bB(e){R1=R1||document.createElement("a"),R1.setAttribute("href",e);const t=R1.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){X_=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return function l3(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const r=n.indexOf("="),[o,c]=-1==r?[n,""]:[n.slice(0,r),n.slice(r+1)];if(o.trim()===t)return decodeURIComponent(c)}return null}(document.cookie,t)}}let R1,X_=null,CB=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:e.\u0275fac}),e})();const fE=new Ar("EventManagerPlugins");let bD=(()=>{class e{constructor(n,r){this._zone=r,this._eventNameToPlugin=new Map,n.forEach(o=>{o.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,r,o){return this._findPluginFor(r).addEventListener(n,r,o)}getZone(){return this._zone}_findPluginFor(n){let r=this._eventNameToPlugin.get(n);if(r)return r;if(r=this._plugins.find(c=>c.supports(n)),!r)throw new Dn(5101,!1);return this._eventNameToPlugin.set(n,r),r}}return e.\u0275fac=function(n){return new(n||e)(Wn(fE),Wn(Ia))},e.\u0275prov=Vn({token:e,factory:e.\u0275fac}),e})();class ED{constructor(t){this._doc=t}}const dE="ng-app-id";let CD=(()=>{class e{constructor(n,r,o,c={}){this.doc=n,this.appId=r,this.nonce=o,this.platformId=c,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=mD(c),this.resetHostNodes()}addStyles(n){for(const r of n)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(n){for(const r of n)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){const n=this.styleNodesInDOM;n&&(n.forEach(r=>r.remove()),n.clear());for(const r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(const r of this.getAllStyles())this.addStyleToHost(n,r)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(const r of this.hostNodes)this.addStyleToHost(r,n)}onStyleRemoved(n){const r=this.styleRef;r.get(n)?.elements?.forEach(o=>o.remove()),r.delete(n)}collectServerRenderedStyles(){const n=this.doc.head?.querySelectorAll(`style[${dE}="${this.appId}"]`);if(n?.length){const r=new Map;return n.forEach(o=>{null!=o.textContent&&r.set(o.textContent,o)}),r}return null}changeUsageCount(n,r){const o=this.styleRef;if(o.has(n)){const c=o.get(n);return c.usage+=r,c.usage}return o.set(n,{usage:r,elements:[]}),r}getStyleElement(n,r){const o=this.styleNodesInDOM,c=o?.get(r);if(c?.parentNode===n)return o.delete(r),c.removeAttribute(dE),c;{const d=this.doc.createElement("style");return this.nonce&&d.setAttribute("nonce",this.nonce),d.textContent=r,this.platformIsServer&&d.setAttribute(dE,this.appId),d}}addStyleToHost(n,r){const o=this.getStyleElement(n,r);n.appendChild(o);const c=this.styleRef,d=c.get(r)?.elements;d?d.push(o):c.set(r,{elements:[o],usage:1})}resetHostNodes(){const n=this.hostNodes;n.clear(),n.add(this.doc.head)}}return e.\u0275fac=function(n){return new(n||e)(Wn(Zc),Wn(_h),Wn(P0,8),Wn(kf))},e.\u0275prov=Vn({token:e,factory:e.\u0275fac}),e})();const pE={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},gE=/%COMP%/g,MB=new Ar("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function ID(e,t){return t.map(n=>n.replace(gE,e))}let TD=(()=>{class e{constructor(n,r,o,c,d,_,b,C=null){this.eventManager=n,this.sharedStylesHost=r,this.appId=o,this.removeStylesOnCompDestory=c,this.doc=d,this.platformId=_,this.ngZone=b,this.nonce=C,this.rendererByCompId=new Map,this.platformIsServer=mD(_),this.defaultRenderer=new mE(n,d,b,this.platformIsServer)}createRenderer(n,r){if(!n||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===ou.ShadowDom&&(r={...r,encapsulation:ou.Emulated});const o=this.getOrCreateRenderer(n,r);return o instanceof DD?o.applyToHost(n):o instanceof yE&&o.applyStyles(),o}getOrCreateRenderer(n,r){const o=this.rendererByCompId;let c=o.get(r.id);if(!c){const d=this.doc,_=this.ngZone,b=this.eventManager,C=this.sharedStylesHost,D=this.removeStylesOnCompDestory,P=this.platformIsServer;switch(r.encapsulation){case ou.Emulated:c=new DD(b,C,r,this.appId,D,d,_,P);break;case ou.ShadowDom:return new RB(b,C,n,r,d,_,this.nonce,P);default:c=new yE(b,C,r,D,d,_,P)}c.onDestroy=()=>o.delete(r.id),o.set(r.id,c)}return c}ngOnDestroy(){this.rendererByCompId.clear()}}return e.\u0275fac=function(n){return new(n||e)(Wn(bD),Wn(CD),Wn(_h),Wn(MB),Wn(Zc),Wn(kf),Wn(Ia),Wn(P0))},e.\u0275prov=Vn({token:e,factory:e.\u0275fac}),e})();class mE{constructor(t,n,r,o){this.eventManager=t,this.doc=n,this.ngZone=r,this.platformIsServer=o,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?this.doc.createElementNS(pE[n]||n,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,n){(MD(t)?t.content:t).appendChild(n)}insertBefore(t,n,r){t&&(MD(t)?t.content:t).insertBefore(n,r)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let r="string"==typeof t?this.doc.querySelector(t):t;if(!r)throw new Dn(5104,!1);return n||(r.textContent=""),r}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,r,o){if(o){n=o+":"+n;const c=pE[o];c?t.setAttributeNS(c,n,r):t.setAttribute(n,r)}else t.setAttribute(n,r)}removeAttribute(t,n,r){if(r){const o=pE[r];o?t.removeAttributeNS(o,n):t.removeAttribute(`${r}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,r,o){o&(pl.DashCase|pl.Important)?t.style.setProperty(n,r,o&pl.Important?"important":""):t.style[n]=r}removeStyle(t,n,r){r&pl.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,r){t[n]=r}setValue(t,n){t.nodeValue=n}listen(t,n,r){if("string"==typeof t&&!(t=Sm().getGlobalEventTarget(this.doc,t)))throw new Error(`Unsupported event target ${t} for event ${n}`);return this.eventManager.addEventListener(t,n,this.decoratePreventDefault(r))}decoratePreventDefault(t){return n=>{if("__ngUnwrap__"===n)return t;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>t(n)):t(n))&&n.preventDefault()}}}function MD(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class RB extends mE{constructor(t,n,r,o,c,d,_,b){super(t,c,d,b),this.sharedStylesHost=n,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const C=ID(o.id,o.styles);for(const D of C){const P=document.createElement("style");_&&P.setAttribute("nonce",_),P.textContent=D,this.shadowRoot.appendChild(P)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,r){return super.insertBefore(this.nodeOrShadowRoot(t),n,r)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class yE extends mE{constructor(t,n,r,o,c,d,_,b){super(t,c,d,_),this.sharedStylesHost=n,this.removeStylesOnCompDestory=o,this.rendererUsageCount=0,this.styles=b?ID(b,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class DD extends yE{constructor(t,n,r,o,c,d,_,b){const C=o+"-"+r.id;super(t,n,r,c,d,_,b,C),this.contentAttr=function DB(e){return"_ngcontent-%COMP%".replace(gE,e)}(C),this.hostAttr=function AB(e){return"_nghost-%COMP%".replace(gE,e)}(C)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,n){const r=super.createElement(t,n);return super.setAttribute(r,this.contentAttr,""),r}}let LB=(()=>{class e extends ED{constructor(n){super(n)}supports(n){return!0}addEventListener(n,r,o){return n.addEventListener(r,o,!1),()=>this.removeEventListener(n,r,o)}removeEventListener(n,r,o){return n.removeEventListener(r,o)}}return e.\u0275fac=function(n){return new(n||e)(Wn(Zc))},e.\u0275prov=Vn({token:e,factory:e.\u0275fac}),e})();const AD=["alt","control","meta","shift"],OB={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},NB={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let kB=(()=>{class e extends ED{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,r,o){const c=e.parseEventName(r),d=e.eventCallback(c.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Sm().onAndCancel(n,c.domEventName,d))}static parseEventName(n){const r=n.toLowerCase().split("."),o=r.shift();if(0===r.length||"keydown"!==o&&"keyup"!==o)return null;const c=e._normalizeKey(r.pop());let d="",_=r.indexOf("code");if(_>-1&&(r.splice(_,1),d="code."),AD.forEach(C=>{const D=r.indexOf(C);D>-1&&(r.splice(D,1),d+=C+".")}),d+=c,0!=r.length||0===c.length)return null;const b={};return b.domEventName=o,b.fullKey=d,b}static matchEventFullKeyCode(n,r){let o=OB[n.key]||n.key,c="";return r.indexOf("code.")>-1&&(o=n.code,c="code."),!(null==o||!o)&&(o=o.toLowerCase()," "===o?o="space":"."===o&&(o="dot"),AD.forEach(d=>{d!==o&&(0,NB[d])(n)&&(c+=d+".")}),c+=o,c===r)}static eventCallback(n,r,o){return c=>{e.matchEventFullKeyCode(c,n)&&o.runGuarded(()=>r(c))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return e.\u0275fac=function(n){return new(n||e)(Wn(Zc))},e.\u0275prov=Vn({token:e,factory:e.\u0275fac}),e})();const UB=TM(aF,"browser",[{provide:kf,useValue:"browser"},{provide:D0,useValue:function FB(){hE.makeCurrent()},multi:!0},{provide:Zc,useFactory:function zB(){return function gw(e){Dd=e}(document),document},deps:[]}]),VB=new Ar(""),LD=[{provide:p1,useClass:class EB{addToWindow(t){di.getAngularTestability=(r,o=!0)=>{const c=t.findTestabilityInTree(r,o);if(null==c)throw new Dn(5103,!1);return c},di.getAllAngularTestabilities=()=>t.getAllTestabilities(),di.getAllAngularRootElements=()=>t.getAllRootElements(),di.frameworkStabilizers||(di.frameworkStabilizers=[]),di.frameworkStabilizers.push(r=>{const o=di.getAllAngularTestabilities();let c=o.length,d=!1;const _=function(b){d=d||b,c--,0==c&&r(d)};o.forEach(function(b){b.whenStable(_)})})}findTestabilityInTree(t,n,r){return null==n?null:t.getTestability(n)??(r?Sm().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null)}},deps:[]},{provide:bM,useClass:Pb,deps:[Ia,Rb,p1]},{provide:Pb,useClass:Pb,deps:[Ia,Rb,p1]}],OD=[{provide:Vg,useValue:"root"},{provide:Vu,useFactory:function BB(){return new Vu},deps:[]},{provide:fE,useClass:LB,multi:!0,deps:[Zc,Ia,kf]},{provide:fE,useClass:kB,multi:!0,deps:[Zc]},TD,CD,bD,{provide:F0,useExisting:TD},{provide:class W3{},useClass:CB,deps:[]},[]];let jB=(()=>{class e{constructor(n){}static withServerTransition(n){return{ngModule:e,providers:[{provide:_h,useValue:n.appId}]}}}return e.\u0275fac=function(n){return new(n||e)(Wn(VB,12))},e.\u0275mod=Kl({type:e}),e.\u0275inj=yu({providers:[...OD,...LD],imports:[U3,uF]}),e})(),ND=(()=>{class e{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}}return e.\u0275fac=function(n){return new(n||e)(Wn(Zc))},e.\u0275prov=Vn({token:e,factory:function(n){let r=null;return r=n?new n:function $B(){return new ND(Wn(Zc))}(),r},providedIn:"root"}),e})();typeof window<"u"&&window;const{isArray:YB}=Array,{getPrototypeOf:KB,prototype:JB,keys:QB}=Object;const{isArray:nz}=Array;function vE(...e){const t=Ss(e),n=function Ko(e){return he(tl(e))?e.pop():void 0}(e),{args:r,keys:o}=function ez(e){if(1===e.length){const t=e[0];if(YB(t))return{args:t,keys:null};if(function tz(e){return e&&"object"==typeof e&&KB(e)===JB}(t)){const n=QB(t);return{args:n.map(r=>t[r]),keys:n}}}return{args:e,keys:null}}(e);if(0===r.length)return Vo([],t);const c=new Fe(function sz(e,t,n=At){return r=>{zD(t,()=>{const{length:o}=e,c=new Array(o);let d=o,_=o;for(let b=0;b<o;b++)zD(t,()=>{const C=Vo(e[b],t);let D=!1;C.subscribe(Cn(r,P=>{c[b]=P,D||(D=!0,_--),_||r.next(n(c.slice()))},()=>{--d||r.complete()}))},r)},r)}}(r,t,o?d=>function oz(e,t){return e.reduce((n,r,o)=>(n[r]=t[o],n),{})}(o,d):At));return n?c.pipe(function iz(e){return En(t=>function rz(e,t){return nz(t)?e(...t):e(t)}(e,t))}(n)):c}function zD(e,t,n){e?ai(n,e,t):t()}const L1=de(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function xE(...e){return function az(){return el(1)}()(Vo(e,Ss(e)))}function UD(e){return new Fe(t=>{ir(e()).subscribe(t)})}function Z_(e,t){const n=he(e)?e:()=>e,r=o=>o.error(n());return new Fe(t?o=>t.schedule(r,0,o):r)}function wE(){return _n((e,t)=>{let n=null;e._refCount++;const r=Cn(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const o=e._connection,c=n;n=null,o&&(!c||o===c)&&o.unsubscribe(),t.unsubscribe()});e.subscribe(r),r.closed||(n=e.connect())})}class VD extends Fe{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,Un(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new H;const n=this.getSubject();t.add(this.source.subscribe(Cn(n,void 0,()=>{this._teardown(),n.complete()},r=>{this._teardown(),n.error(r)},()=>this._teardown()))),t.closed&&(this._connection=null,t=H.EMPTY)}return t}refCount(){return wE()(this)}}function Im(e){return e<=0?()=>mr:_n((t,n)=>{let r=0;t.subscribe(Cn(n,o=>{++r<=e&&(n.next(o),e<=r&&n.complete())}))})}function Kd(e,t){return _n((n,r)=>{let o=0;n.subscribe(Cn(r,c=>e.call(t,c,o++)&&r.next(c)))})}function O1(e){return _n((t,n)=>{let r=!1;t.subscribe(Cn(n,o=>{r=!0,n.next(o)},()=>{r||n.next(e),n.complete()}))})}function jD(e=lz){return _n((t,n)=>{let r=!1;t.subscribe(Cn(n,o=>{r=!0,n.next(o)},()=>r?n.complete():n.error(e())))})}function lz(){return new L1}function jp(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Kd((o,c)=>e(o,c,r)):At,Im(1),n?O1(t):jD(()=>new L1))}function Y_(e,t){return he(t)?co(e,t,1):co(e,1)}function jl(e,t,n){const r=he(e)||t||n?{next:e,error:t,complete:n}:e;return r?_n((o,c)=>{var d;null===(d=r.subscribe)||void 0===d||d.call(r);let _=!0;o.subscribe(Cn(c,b=>{var C;null===(C=r.next)||void 0===C||C.call(r,b),c.next(b)},()=>{var b;_=!1,null===(b=r.complete)||void 0===b||b.call(r),c.complete()},b=>{var C;_=!1,null===(C=r.error)||void 0===C||C.call(r,b),c.error(b)},()=>{var b,C;_&&(null===(b=r.unsubscribe)||void 0===b||b.call(r)),null===(C=r.finalize)||void 0===C||C.call(r)}))}):At}function Gp(e){return _n((t,n)=>{let c,r=null,o=!1;r=t.subscribe(Cn(n,void 0,void 0,d=>{c=ir(e(d,Gp(e)(t))),r?(r.unsubscribe(),r=null,c.subscribe(n)):o=!0})),o&&(r.unsubscribe(),r=null,c.subscribe(n))})}function bE(e){return e<=0?()=>mr:_n((t,n)=>{let r=[];t.subscribe(Cn(n,o=>{r.push(o),e<r.length&&r.shift()},()=>{for(const o of r)n.next(o);n.complete()},void 0,()=>{r=null}))})}function EE(e){return _n((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}const xi="primary",K_=Symbol("RouteTitle");class pz{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function Tm(e){return new pz(e)}function gz(e,t,n){const r=n.path.split("/");if(r.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;const o={};for(let c=0;c<r.length;c++){const d=r[c],_=e[c];if(d.startsWith(":"))o[d.substring(1)]=_;else if(d!==_.path)return null}return{consumed:e.slice(0,r.length),posParams:o}}function ff(e,t){const n=e?Object.keys(e):void 0,r=t?Object.keys(t):void 0;if(!n||!r||n.length!=r.length)return!1;let o;for(let c=0;c<n.length;c++)if(o=n[c],!GD(e[o],t[o]))return!1;return!0}function GD(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();return n.every((o,c)=>r[c]===o)}return e===t}function $D(e){return e.length>0?e[e.length-1]:null}function Jd(e){return function ZB(e){return!!e&&(e instanceof Fe||he(e.lift)&&he(e.subscribe))}(e)?e:r1(e)?Vo(Promise.resolve(e)):Or(e)}const yz={exact:function WD(e,t,n){if(!$p(e.segments,t.segments)||!N1(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const r in t.children)if(!e.children[r]||!WD(e.children[r],t.children[r],n))return!1;return!0},subset:XD},qD={exact:function _z(e,t){return ff(e,t)},subset:function vz(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>GD(e[n],t[n]))},ignored:()=>!0};function HD(e,t,n){return yz[n.paths](e.root,t.root,n.matrixParams)&&qD[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function XD(e,t,n){return ZD(e,t,t.segments,n)}function ZD(e,t,n,r){if(e.segments.length>n.length){const o=e.segments.slice(0,n.length);return!(!$p(o,n)||t.hasChildren()||!N1(o,n,r))}if(e.segments.length===n.length){if(!$p(e.segments,n)||!N1(e.segments,n,r))return!1;for(const o in t.children)if(!e.children[o]||!XD(e.children[o],t.children[o],r))return!1;return!0}{const o=n.slice(0,e.segments.length),c=n.slice(e.segments.length);return!!($p(e.segments,o)&&N1(e.segments,o,r)&&e.children[xi])&&ZD(e.children[xi],t,c,r)}}function N1(e,t,n){return t.every((r,o)=>qD[n](e[o].parameters,r.parameters))}class Mm{constructor(t=new ms([],{}),n={},r=null){this.root=t,this.queryParams=n,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Tm(this.queryParams)),this._queryParamMap}toString(){return bz.serialize(this)}}class ms{constructor(t,n){this.segments=t,this.children=n,this.parent=null,Object.values(n).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return k1(this)}}class J_{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=Tm(this.parameters)),this._parameterMap}toString(){return JD(this)}}function $p(e,t){return e.length===t.length&&e.every((n,r)=>n.path===t[r].path)}let Q_=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:function(){return new CE},providedIn:"root"}),e})();class CE{parse(t){const n=new Lz(t);return new Mm(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${ev(t.root,!0)}`,r=function Sz(e){const t=Object.keys(e).map(n=>{const r=e[n];return Array.isArray(r)?r.map(o=>`${F1(n)}=${F1(o)}`).join("&"):`${F1(n)}=${F1(r)}`}).filter(n=>!!n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${r}${"string"==typeof t.fragment?`#${function Ez(e){return encodeURI(e)}(t.fragment)}`:""}`}}const bz=new CE;function k1(e){return e.segments.map(t=>JD(t)).join("/")}function ev(e,t){if(!e.hasChildren())return k1(e);if(t){const n=e.children[xi]?ev(e.children[xi],!1):"",r=[];return Object.entries(e.children).forEach(([o,c])=>{o!==xi&&r.push(`${o}:${ev(c,!1)}`)}),r.length>0?`${n}(${r.join("//")})`:n}{const n=function wz(e,t){let n=[];return Object.entries(e.children).forEach(([r,o])=>{r===xi&&(n=n.concat(t(o,r)))}),Object.entries(e.children).forEach(([r,o])=>{r!==xi&&(n=n.concat(t(o,r)))}),n}(e,(r,o)=>o===xi?[ev(e.children[xi],!1)]:[`${o}:${ev(r,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[xi]?`${k1(e)}/${n[0]}`:`${k1(e)}/(${n.join("//")})`}}function YD(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function F1(e){return YD(e).replace(/%3B/gi,";")}function SE(e){return YD(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function B1(e){return decodeURIComponent(e)}function KD(e){return B1(e.replace(/\+/g,"%20"))}function JD(e){return`${SE(e.path)}${function Cz(e){return Object.keys(e).map(t=>`;${SE(t)}=${SE(e[t])}`).join("")}(e.parameters)}`}const Iz=/^[^\/()?;#]+/;function IE(e){const t=e.match(Iz);return t?t[0]:""}const Tz=/^[^\/()?;=#]+/,Dz=/^[^=?&#]+/,Pz=/^[^&#]+/;class Lz{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new ms([],{}):new ms([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(r[xi]=new ms(t,n)),r}parseSegment(){const t=IE(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Dn(4009,!1);return this.capture(t),new J_(B1(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=function Mz(e){const t=e.match(Tz);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const o=IE(this.remaining);o&&(r=o,this.capture(r))}t[B1(n)]=B1(r)}parseQueryParam(t){const n=function Az(e){const t=e.match(Dz);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const d=function Rz(e){const t=e.match(Pz);return t?t[0]:""}(this.remaining);d&&(r=d,this.capture(r))}const o=KD(n),c=KD(r);if(t.hasOwnProperty(o)){let d=t[o];Array.isArray(d)||(d=[d],t[o]=d),d.push(c)}else t[o]=c}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=IE(this.remaining),o=this.remaining[r.length];if("/"!==o&&")"!==o&&";"!==o)throw new Dn(4010,!1);let c;r.indexOf(":")>-1?(c=r.slice(0,r.indexOf(":")),this.capture(c),this.capture(":")):t&&(c=xi);const d=this.parseChildren();n[c]=1===Object.keys(d).length?d[xi]:new ms([],d),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Dn(4011,!1)}}function QD(e){return e.segments.length>0?new ms([],{[xi]:e}):e}function eA(e){const t={};for(const r of Object.keys(e.children)){const c=eA(e.children[r]);if(r===xi&&0===c.segments.length&&c.hasChildren())for(const[d,_]of Object.entries(c.children))t[d]=_;else(c.segments.length>0||c.hasChildren())&&(t[r]=c)}return function Oz(e){if(1===e.numberOfChildren&&e.children[xi]){const t=e.children[xi];return new ms(e.segments.concat(t.segments),t.children)}return e}(new ms(e.segments,t))}function qp(e){return e instanceof Mm}function tA(e){let t;const o=QD(function n(c){const d={};for(const b of c.children){const C=n(b);d[b.outlet]=C}const _=new ms(c.url,d);return c===e&&(t=_),_}(e.root));return t??o}function nA(e,t,n,r){let o=e;for(;o.parent;)o=o.parent;if(0===t.length)return TE(o,o,o,n,r);const c=function kz(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new iA(!0,0,e);let t=0,n=!1;const r=e.reduce((o,c,d)=>{if("object"==typeof c&&null!=c){if(c.outlets){const _={};return Object.entries(c.outlets).forEach(([b,C])=>{_[b]="string"==typeof C?C.split("/"):C}),[...o,{outlets:_}]}if(c.segmentPath)return[...o,c.segmentPath]}return"string"!=typeof c?[...o,c]:0===d?(c.split("/").forEach((_,b)=>{0==b&&"."===_||(0==b&&""===_?n=!0:".."===_?t++:""!=_&&o.push(_))}),o):[...o,c]},[]);return new iA(n,t,r)}(t);if(c.toRoot())return TE(o,o,new ms([],{}),n,r);const d=function Fz(e,t,n){if(e.isAbsolute)return new U1(t,!0,0);if(!n)return new U1(t,!1,NaN);if(null===n.parent)return new U1(n,!0,0);const r=z1(e.commands[0])?0:1;return function Bz(e,t,n){let r=e,o=t,c=n;for(;c>o;){if(c-=o,r=r.parent,!r)throw new Dn(4005,!1);o=r.segments.length}return new U1(r,!1,o-c)}(n,n.segments.length-1+r,e.numberOfDoubleDots)}(c,o,e),_=d.processChildren?nv(d.segmentGroup,d.index,c.commands):oA(d.segmentGroup,d.index,c.commands);return TE(o,d.segmentGroup,_,n,r)}function z1(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function tv(e){return"object"==typeof e&&null!=e&&e.outlets}function TE(e,t,n,r,o){let d,c={};r&&Object.entries(r).forEach(([b,C])=>{c[b]=Array.isArray(C)?C.map(D=>`${D}`):`${C}`}),d=e===t?n:rA(e,t,n);const _=QD(eA(d));return new Mm(_,c,o)}function rA(e,t,n){const r={};return Object.entries(e.children).forEach(([o,c])=>{r[o]=c===t?n:rA(c,t,n)}),new ms(e.segments,r)}class iA{constructor(t,n,r){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=r,t&&r.length>0&&z1(r[0]))throw new Dn(4003,!1);const o=r.find(tv);if(o&&o!==$D(r))throw new Dn(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class U1{constructor(t,n,r){this.segmentGroup=t,this.processChildren=n,this.index=r}}function oA(e,t,n){if(e||(e=new ms([],{})),0===e.segments.length&&e.hasChildren())return nv(e,t,n);const r=function Uz(e,t,n){let r=0,o=t;const c={match:!1,pathIndex:0,commandIndex:0};for(;o<e.segments.length;){if(r>=n.length)return c;const d=e.segments[o],_=n[r];if(tv(_))break;const b=`${_}`,C=r<n.length-1?n[r+1]:null;if(o>0&&void 0===b)break;if(b&&C&&"object"==typeof C&&void 0===C.outlets){if(!aA(b,C,d))return c;r+=2}else{if(!aA(b,{},d))return c;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}(e,t,n),o=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const c=new ms(e.segments.slice(0,r.pathIndex),{});return c.children[xi]=new ms(e.segments.slice(r.pathIndex),e.children),nv(c,0,o)}return r.match&&0===o.length?new ms(e.segments,{}):r.match&&!e.hasChildren()?ME(e,t,n):r.match?nv(e,0,o):ME(e,t,n)}function nv(e,t,n){if(0===n.length)return new ms(e.segments,{});{const r=function zz(e){return tv(e[0])?e[0].outlets:{[xi]:e}}(n),o={};if(!r[xi]&&e.children[xi]&&1===e.numberOfChildren&&0===e.children[xi].segments.length){const c=nv(e.children[xi],t,n);return new ms(e.segments,c.children)}return Object.entries(r).forEach(([c,d])=>{"string"==typeof d&&(d=[d]),null!==d&&(o[c]=oA(e.children[c],t,d))}),Object.entries(e.children).forEach(([c,d])=>{void 0===r[c]&&(o[c]=d)}),new ms(e.segments,o)}}function ME(e,t,n){const r=e.segments.slice(0,t);let o=0;for(;o<n.length;){const c=n[o];if(tv(c)){const b=Vz(c.outlets);return new ms(r,b)}if(0===o&&z1(n[0])){r.push(new J_(e.segments[t].path,sA(n[0]))),o++;continue}const d=tv(c)?c.outlets[xi]:`${c}`,_=o<n.length-1?n[o+1]:null;d&&_&&z1(_)?(r.push(new J_(d,sA(_))),o+=2):(r.push(new J_(d,{})),o++)}return new ms(r,{})}function Vz(e){const t={};return Object.entries(e).forEach(([n,r])=>{"string"==typeof r&&(r=[r]),null!==r&&(t[n]=ME(new ms([],{}),0,r))}),t}function sA(e){const t={};return Object.entries(e).forEach(([n,r])=>t[n]=`${r}`),t}function aA(e,t,n){return e==n.path&&ff(t,n.parameters)}const rv="imperative";class df{constructor(t,n){this.id=t,this.url=n}}class DE extends df{constructor(t,n,r="imperative",o=null){super(t,n),this.type=0,this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Hp extends df{constructor(t,n,r){super(t,n),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class V1 extends df{constructor(t,n,r,o){super(t,n),this.reason=r,this.code=o,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class iv extends df{constructor(t,n,r,o){super(t,n),this.reason=r,this.code=o,this.type=16}}class AE extends df{constructor(t,n,r,o){super(t,n),this.error=r,this.target=o,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class jz extends df{constructor(t,n,r,o){super(t,n),this.urlAfterRedirects=r,this.state=o,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Gz extends df{constructor(t,n,r,o){super(t,n),this.urlAfterRedirects=r,this.state=o,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class $z extends df{constructor(t,n,r,o,c){super(t,n),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=c,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class qz extends df{constructor(t,n,r,o){super(t,n),this.urlAfterRedirects=r,this.state=o,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Hz extends df{constructor(t,n,r,o){super(t,n),this.urlAfterRedirects=r,this.state=o,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Wz{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Xz{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Zz{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Yz{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Kz{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Jz{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class uA{constructor(t,n,r){this.routerEvent=t,this.position=n,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class Qz{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new ov,this.attachRef=null}}let ov=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(n,r){const o=this.getOrCreateContext(n);o.outlet=r,this.contexts.set(n,o)}onChildOutletDestroyed(n){const r=this.getContext(n);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let r=this.getContext(n);return r||(r=new Qz,this.contexts.set(n,r)),r}getContext(n){return this.contexts.get(n)||null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class lA{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=PE(t,this._root);return n?n.children.map(r=>r.value):[]}firstChild(t){const n=PE(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=RE(t,this._root);return n.length<2?[]:n[n.length-2].children.map(o=>o.value).filter(o=>o!==t)}pathFromRoot(t){return RE(t,this._root).map(n=>n.value)}}function PE(e,t){if(e===t.value)return t;for(const n of t.children){const r=PE(e,n);if(r)return r}return null}function RE(e,t){if(e===t.value)return[t];for(const n of t.children){const r=RE(e,n);if(r.length)return r.unshift(t),r}return[]}class Kf{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function Dm(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class cA extends lA{constructor(t,n){super(t),this.snapshot=n,LE(this,t)}toString(){return this.snapshot.toString()}}function hA(e,t){const n=function e4(e,t){const d=new j1([],{},{},"",{},xi,t,null,{});return new dA("",new Kf(d,[]))}(0,t),r=new Dt([new J_("",{})]),o=new Dt({}),c=new Dt({}),d=new Dt({}),_=new Dt(""),b=new Am(r,o,d,_,c,xi,t,n.root);return b.snapshot=n.root,new cA(new Kf(b,[]),n)}class Am{constructor(t,n,r,o,c,d,_,b){this.urlSubject=t,this.paramsSubject=n,this.queryParamsSubject=r,this.fragmentSubject=o,this.dataSubject=c,this.outlet=d,this.component=_,this._futureSnapshot=b,this.title=this.dataSubject?.pipe(En(C=>C[K_]))??Or(void 0),this.url=t,this.params=n,this.queryParams=r,this.fragment=o,this.data=c}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(En(t=>Tm(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(En(t=>Tm(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function fA(e,t="emptyOnly"){const n=e.pathFromRoot;let r=0;if("always"!==t)for(r=n.length-1;r>=1;){const o=n[r],c=n[r-1];if(o.routeConfig&&""===o.routeConfig.path)r--;else{if(c.component)break;r--}}return function t4(e){return e.reduce((t,n)=>({params:{...t.params,...n.params},data:{...t.data,...n.data},resolve:{...n.data,...t.resolve,...n.routeConfig?.data,...n._resolvedData}}),{params:{},data:{},resolve:{}})}(n.slice(r))}class j1{get title(){return this.data?.[K_]}constructor(t,n,r,o,c,d,_,b,C){this.url=t,this.params=n,this.queryParams=r,this.fragment=o,this.data=c,this.outlet=d,this.component=_,this.routeConfig=b,this._resolve=C}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Tm(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Tm(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class dA extends lA{constructor(t,n){super(n),this.url=t,LE(this,n)}toString(){return pA(this._root)}}function LE(e,t){t.value._routerState=e,t.children.forEach(n=>LE(e,n))}function pA(e){const t=e.children.length>0?` { ${e.children.map(pA).join(", ")} } `:"";return`${e.value}${t}`}function OE(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,ff(t.queryParams,n.queryParams)||e.queryParamsSubject.next(n.queryParams),t.fragment!==n.fragment&&e.fragmentSubject.next(n.fragment),ff(t.params,n.params)||e.paramsSubject.next(n.params),function mz(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!ff(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.urlSubject.next(n.url),ff(t.data,n.data)||e.dataSubject.next(n.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function NE(e,t){const n=ff(e.params,t.params)&&function xz(e,t){return $p(e,t)&&e.every((n,r)=>ff(n.parameters,t[r].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||NE(e.parent,t.parent))}let kE=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=xi,this.activateEvents=new Ul,this.deactivateEvents=new Ul,this.attachEvents=new Ul,this.detachEvents=new Ul,this.parentContexts=In(ov),this.location=In(Th),this.changeDetector=In(Fb),this.environmentInjector=In(qc),this.inputBinder=In(G1,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(n){if(n.name){const{firstChange:r,previousValue:o}=n.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Dn(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Dn(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Dn(4012,!1);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,r){this.activated=n,this._activatedRoute=r,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,r){if(this.isActivated)throw new Dn(4013,!1);this._activatedRoute=n;const o=this.location,d=n.snapshot.component,_=this.parentContexts.getOrCreateContext(this.name).children,b=new n4(n,_,o.injector);this.activated=o.createComponent(d,{index:o.length,injector:b,environmentInjector:r??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=mi({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[te]}),e})();class n4{constructor(t,n,r){this.route=t,this.childContexts=n,this.parent=r}get(t,n){return t===Am?this.route:t===ov?this.childContexts:this.parent.get(t,n)}}const G1=new Ar("");let gA=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(n){this.unsubscribeFromRouteData(n),this.subscribeToRouteData(n)}unsubscribeFromRouteData(n){this.outletDataSubscriptions.get(n)?.unsubscribe(),this.outletDataSubscriptions.delete(n)}subscribeToRouteData(n){const{activatedRoute:r}=n,o=vE([r.queryParams,r.params,r.data]).pipe(Cr(([c,d,_],b)=>(_={...c,...d,..._},0===b?Or(_):Promise.resolve(_)))).subscribe(c=>{if(!n.isActivated||!n.activatedComponentRef||n.activatedRoute!==r||null===r.component)return void this.unsubscribeFromRouteData(n);const d=function _F(e){const t=Qr(e);if(!t)return null;const n=new vl(t);return{get selector(){return n.selector},get type(){return n.componentType},get inputs(){return n.inputs},get outputs(){return n.outputs},get ngContentSelectors(){return n.ngContentSelectors},get isStandalone(){return t.standalone}}}(r.component);if(d)for(const{templateName:_}of d.inputs)n.activatedComponentRef.setInput(_,c[_]);else this.unsubscribeFromRouteData(n)});this.outletDataSubscriptions.set(n,o)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:e.\u0275fac}),e})();function sv(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=t.value;const o=function i4(e,t,n){return t.children.map(r=>{for(const o of n.children)if(e.shouldReuseRoute(r.value,o.value.snapshot))return sv(e,r,o);return sv(e,r)})}(e,t,n);return new Kf(r,o)}{if(e.shouldAttach(t.value)){const c=e.retrieve(t.value);if(null!==c){const d=c.route;return d.value._futureSnapshot=t.value,d.children=t.children.map(_=>sv(e,_)),d}}const r=function o4(e){return new Am(new Dt(e.url),new Dt(e.params),new Dt(e.queryParams),new Dt(e.fragment),new Dt(e.data),e.outlet,e.component,e)}(t.value),o=t.children.map(c=>sv(e,c));return new Kf(r,o)}}const FE="ngNavigationCancelingError";function mA(e,t){const{redirectTo:n,navigationBehaviorOptions:r}=qp(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,o=yA(!1,0,t);return o.url=n,o.navigationBehaviorOptions=r,o}function yA(e,t,n){const r=new Error("NavigationCancelingError: "+(e||""));return r[FE]=!0,r.cancellationCode=t,n&&(r.url=n),r}function _A(e){return vA(e)&&qp(e.url)}function vA(e){return e&&e[FE]}let xA=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Ws({type:e,selectors:[["ng-component"]],standalone:!0,features:[bT],decls:1,vars:0,template:function(n,r){1&n&&ym(0,"router-outlet")},dependencies:[kE],encapsulation:2}),e})();function BE(e){const t=e.children&&e.children.map(BE),n=t?{...e,children:t}:{...e};return!n.component&&!n.loadComponent&&(t||n.loadChildren)&&n.outlet&&n.outlet!==xi&&(n.component=xA),n}function Ph(e){return e.outlet||xi}function av(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}class f4{constructor(t,n,r,o,c){this.routeReuseStrategy=t,this.futureState=n,this.currState=r,this.forwardEvent=o,this.inputBindingEnabled=c}activate(t){const n=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,r,t),OE(this.futureState.root),this.activateChildRoutes(n,r,t)}deactivateChildRoutes(t,n,r){const o=Dm(n);t.children.forEach(c=>{const d=c.value.outlet;this.deactivateRoutes(c,o[d],r),delete o[d]}),Object.values(o).forEach(c=>{this.deactivateRouteAndItsChildren(c,r)})}deactivateRoutes(t,n,r){const o=t.value,c=n?n.value:null;if(o===c)if(o.component){const d=r.getContext(o.outlet);d&&this.deactivateChildRoutes(t,n,d.children)}else this.deactivateChildRoutes(t,n,r);else c&&this.deactivateRouteAndItsChildren(n,r)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const r=n.getContext(t.value.outlet),o=r&&t.value.component?r.children:n,c=Dm(t);for(const d of Object.keys(c))this.deactivateRouteAndItsChildren(c[d],o);if(r&&r.outlet){const d=r.outlet.detach(),_=r.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:d,route:t,contexts:_})}}deactivateRouteAndOutlet(t,n){const r=n.getContext(t.value.outlet),o=r&&t.value.component?r.children:n,c=Dm(t);for(const d of Object.keys(c))this.deactivateRouteAndItsChildren(c[d],o);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(t,n,r){const o=Dm(n);t.children.forEach(c=>{this.activateRoutes(c,o[c.value.outlet],r),this.forwardEvent(new Jz(c.value.snapshot))}),t.children.length&&this.forwardEvent(new Yz(t.value.snapshot))}activateRoutes(t,n,r){const o=t.value,c=n?n.value:null;if(OE(o),o===c)if(o.component){const d=r.getOrCreateContext(o.outlet);this.activateChildRoutes(t,n,d.children)}else this.activateChildRoutes(t,n,r);else if(o.component){const d=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){const _=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),d.children.onOutletReAttached(_.contexts),d.attachRef=_.componentRef,d.route=_.route.value,d.outlet&&d.outlet.attach(_.componentRef,_.route.value),OE(_.route.value),this.activateChildRoutes(t,null,d.children)}else{const _=av(o.snapshot);d.attachRef=null,d.route=o,d.injector=_,d.outlet&&d.outlet.activateWith(o,d.injector),this.activateChildRoutes(t,null,d.children)}}else this.activateChildRoutes(t,null,r)}}class wA{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class $1{constructor(t,n){this.component=t,this.route=n}}function d4(e,t,n){const r=e._root;return uv(r,t?t._root:null,n,[r.value])}function Pm(e,t){const n=Symbol(),r=t.get(e,n);return r===n?"function"!=typeof e||function ru(e){return null!==rl(e)}(e)?t.get(e):e:r}function uv(e,t,n,r,o={canDeactivateChecks:[],canActivateChecks:[]}){const c=Dm(t);return e.children.forEach(d=>{(function g4(e,t,n,r,o={canDeactivateChecks:[],canActivateChecks:[]}){const c=e.value,d=t?t.value:null,_=n?n.getContext(e.value.outlet):null;if(d&&c.routeConfig===d.routeConfig){const b=function m4(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!$p(e.url,t.url);case"pathParamsOrQueryParamsChange":return!$p(e.url,t.url)||!ff(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!NE(e,t)||!ff(e.queryParams,t.queryParams);default:return!NE(e,t)}}(d,c,c.routeConfig.runGuardsAndResolvers);b?o.canActivateChecks.push(new wA(r)):(c.data=d.data,c._resolvedData=d._resolvedData),uv(e,t,c.component?_?_.children:null:n,r,o),b&&_&&_.outlet&&_.outlet.isActivated&&o.canDeactivateChecks.push(new $1(_.outlet.component,d))}else d&&lv(t,_,o),o.canActivateChecks.push(new wA(r)),uv(e,null,c.component?_?_.children:null:n,r,o)})(d,c[d.value.outlet],n,r.concat([d.value]),o),delete c[d.value.outlet]}),Object.entries(c).forEach(([d,_])=>lv(_,n.getContext(d),o)),o}function lv(e,t,n){const r=Dm(e),o=e.value;Object.entries(r).forEach(([c,d])=>{lv(d,o.component?t?t.children.getContext(c):null:t,n)}),n.canDeactivateChecks.push(new $1(o.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,o))}function cv(e){return"function"==typeof e}function bA(e){return e instanceof L1||"EmptyError"===e?.name}const q1=Symbol("INITIAL_VALUE");function Rm(){return Cr(e=>vE(e.map(t=>t.pipe(Im(1),function uz(...e){const t=Ss(e);return _n((n,r)=>{(t?xE(e,n,t):xE(e,n)).subscribe(r)})}(q1)))).pipe(En(t=>{for(const n of t)if(!0!==n){if(n===q1)return q1;if(!1===n||n instanceof Mm)return n}return!0}),Kd(t=>t!==q1),Im(1)))}function EA(e){return function De(...e){return pt(e)}(jl(t=>{if(qp(t))throw mA(0,t)}),En(t=>!0===t))}class H1{constructor(t){this.segmentGroup=t||null}}class CA{constructor(t){this.urlTree=t}}function Lm(e){return Z_(new H1(e))}function SA(e){return Z_(new CA(e))}class k4{constructor(t,n){this.urlSerializer=t,this.urlTree=n}noMatchError(t){return new Dn(4002,!1)}lineralizeSegments(t,n){let r=[],o=n.root;for(;;){if(r=r.concat(o.segments),0===o.numberOfChildren)return Or(r);if(o.numberOfChildren>1||!o.children[xi])return Z_(new Dn(4e3,!1));o=o.children[xi]}}applyRedirectCommands(t,n,r){return this.applyRedirectCreateUrlTree(n,this.urlSerializer.parse(n),t,r)}applyRedirectCreateUrlTree(t,n,r,o){const c=this.createSegmentGroup(t,n.root,r,o);return new Mm(c,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const r={};return Object.entries(t).forEach(([o,c])=>{if("string"==typeof c&&c.startsWith(":")){const _=c.substring(1);r[o]=n[_]}else r[o]=c}),r}createSegmentGroup(t,n,r,o){const c=this.createSegments(t,n.segments,r,o);let d={};return Object.entries(n.children).forEach(([_,b])=>{d[_]=this.createSegmentGroup(t,b,r,o)}),new ms(c,d)}createSegments(t,n,r,o){return n.map(c=>c.path.startsWith(":")?this.findPosParam(t,c,o):this.findOrReturn(c,r))}findPosParam(t,n,r){const o=r[n.path.substring(1)];if(!o)throw new Dn(4001,!1);return o}findOrReturn(t,n){let r=0;for(const o of n){if(o.path===t.path)return n.splice(r),o;r++}return t}}const zE={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function F4(e,t,n,r,o){const c=UE(e,t,n);return c.matched?(r=function s4(e,t){return e.providers&&!e._injector&&(e._injector=cb(e.providers,t,`Route: ${e.path}`)),e._injector??t}(t,r),function L4(e,t,n,r){const o=t.canMatch;return o&&0!==o.length?Or(o.map(d=>{const _=Pm(d,e);return Jd(function b4(e){return e&&cv(e.canMatch)}(_)?_.canMatch(t,n):e.runInContext(()=>_(t,n)))})).pipe(Rm(),EA()):Or(!0)}(r,t,n).pipe(En(d=>!0===d?c:{...zE}))):Or(c)}function UE(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{...zE}:{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const o=(t.matcher||gz)(n,e,t);if(!o)return{...zE};const c={};Object.entries(o.posParams??{}).forEach(([_,b])=>{c[_]=b.path});const d=o.consumed.length>0?{...c,...o.consumed[o.consumed.length-1].parameters}:c;return{matched:!0,consumedSegments:o.consumed,remainingSegments:n.slice(o.consumed.length),parameters:d,positionalParamSegments:o.posParams??{}}}function IA(e,t,n,r){return n.length>0&&function U4(e,t,n){return n.some(r=>W1(e,t,r)&&Ph(r)!==xi)}(e,n,r)?{segmentGroup:new ms(t,z4(r,new ms(n,e.children))),slicedSegments:[]}:0===n.length&&function V4(e,t,n){return n.some(r=>W1(e,t,r))}(e,n,r)?{segmentGroup:new ms(e.segments,B4(e,0,n,r,e.children)),slicedSegments:n}:{segmentGroup:new ms(e.segments,e.children),slicedSegments:n}}function B4(e,t,n,r,o){const c={};for(const d of r)if(W1(e,n,d)&&!o[Ph(d)]){const _=new ms([],{});c[Ph(d)]=_}return{...o,...c}}function z4(e,t){const n={};n[xi]=t;for(const r of e)if(""===r.path&&Ph(r)!==xi){const o=new ms([],{});n[Ph(r)]=o}return n}function W1(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}class q4{constructor(t,n,r,o,c,d,_){this.injector=t,this.configLoader=n,this.rootComponentType=r,this.config=o,this.urlTree=c,this.paramsInheritanceStrategy=d,this.urlSerializer=_,this.allowRedirects=!0,this.applyRedirects=new k4(this.urlSerializer,this.urlTree)}noMatchError(t){return new Dn(4002,!1)}recognize(){const t=IA(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,xi).pipe(Gp(n=>{if(n instanceof CA)return this.allowRedirects=!1,this.urlTree=n.urlTree,this.match(n.urlTree);throw n instanceof H1?this.noMatchError(n):n}),En(n=>{const r=new j1([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},xi,this.rootComponentType,null,{}),o=new Kf(r,n),c=new dA("",o),d=function Nz(e,t,n=null,r=null){return nA(tA(e),t,n,r)}(r,[],this.urlTree.queryParams,this.urlTree.fragment);return d.queryParams=this.urlTree.queryParams,c.url=this.urlSerializer.serialize(d),this.inheritParamsAndData(c._root),{state:c,tree:d}}))}match(t){return this.processSegmentGroup(this.injector,this.config,t.root,xi).pipe(Gp(r=>{throw r instanceof H1?this.noMatchError(r):r}))}inheritParamsAndData(t){const n=t.value,r=fA(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),t.children.forEach(o=>this.inheritParamsAndData(o))}processSegmentGroup(t,n,r,o){return 0===r.segments.length&&r.hasChildren()?this.processChildren(t,n,r):this.processSegment(t,n,r,r.segments,o,!0)}processChildren(t,n,r){const o=[];for(const c of Object.keys(r.children))"primary"===c?o.unshift(c):o.push(c);return Vo(o).pipe(Y_(c=>{const d=r.children[c],_=function c4(e,t){const n=e.filter(r=>Ph(r)===t);return n.push(...e.filter(r=>Ph(r)!==t)),n}(n,c);return this.processSegmentGroup(t,_,d,c)}),function hz(e,t){return _n(function cz(e,t,n,r,o){return(c,d)=>{let _=n,b=t,C=0;c.subscribe(Cn(d,D=>{const P=C++;b=_?e(b,D,P):(_=!0,D),r&&d.next(b)},o&&(()=>{_&&d.next(b),d.complete()})))}}(e,t,arguments.length>=2,!0))}((c,d)=>(c.push(...d),c)),O1(null),function fz(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Kd((o,c)=>e(o,c,r)):At,bE(1),n?O1(t):jD(()=>new L1))}(),co(c=>{if(null===c)return Lm(r);const d=TA(c);return function H4(e){e.sort((t,n)=>t.value.outlet===xi?-1:n.value.outlet===xi?1:t.value.outlet.localeCompare(n.value.outlet))}(d),Or(d)}))}processSegment(t,n,r,o,c,d){return Vo(n).pipe(Y_(_=>this.processSegmentAgainstRoute(_._injector??t,n,_,r,o,c,d).pipe(Gp(b=>{if(b instanceof H1)return Or(null);throw b}))),jp(_=>!!_),Gp(_=>{if(bA(_))return function G4(e,t,n){return 0===t.length&&!e.children[n]}(r,o,c)?Or([]):Lm(r);throw _}))}processSegmentAgainstRoute(t,n,r,o,c,d,_){return function j4(e,t,n,r){return!!(Ph(e)===r||r!==xi&&W1(t,n,e))&&("**"===e.path||UE(t,e,n).matched)}(r,o,c,d)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,o,r,c,d,_):_&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,o,n,r,c,d):Lm(o):Lm(o)}expandSegmentAgainstRouteUsingRedirect(t,n,r,o,c,d){return"**"===o.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,r,o,d):this.expandRegularSegmentAgainstRouteUsingRedirect(t,n,r,o,c,d)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,r,o){const c=this.applyRedirects.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?SA(c):this.applyRedirects.lineralizeSegments(r,c).pipe(co(d=>{const _=new ms(d,{});return this.processSegment(t,n,_,d,o,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,n,r,o,c,d){const{matched:_,consumedSegments:b,remainingSegments:C,positionalParamSegments:D}=UE(n,o,c);if(!_)return Lm(n);const P=this.applyRedirects.applyRedirectCommands(b,o.redirectTo,D);return o.redirectTo.startsWith("/")?SA(P):this.applyRedirects.lineralizeSegments(o,P).pipe(co(N=>this.processSegment(t,r,n,N.concat(C),d,!1)))}matchSegmentAgainstRoute(t,n,r,o,c,d){let _;if("**"===r.path){const b=o.length>0?$D(o).parameters:{};_=Or({snapshot:new j1(o,b,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,MA(r),Ph(r),r.component??r._loadedComponent??null,r,DA(r)),consumedSegments:[],remainingSegments:[]}),n.children={}}else _=F4(n,r,o,t).pipe(En(({matched:b,consumedSegments:C,remainingSegments:D,parameters:P})=>b?{snapshot:new j1(C,P,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,MA(r),Ph(r),r.component??r._loadedComponent??null,r,DA(r)),consumedSegments:C,remainingSegments:D}:null));return _.pipe(Cr(b=>null===b?Lm(n):this.getChildConfig(t=r._injector??t,r,o).pipe(Cr(({routes:C})=>{const D=r._loadedInjector??t,{snapshot:P,consumedSegments:N,remainingSegments:B}=b,{segmentGroup:le,slicedSegments:se}=IA(n,N,B,C);if(0===se.length&&le.hasChildren())return this.processChildren(D,C,le).pipe(En(Se=>null===Se?null:[new Kf(P,Se)]));if(0===C.length&&0===se.length)return Or([new Kf(P,[])]);const Oe=Ph(r)===c;return this.processSegment(D,C,le,se,Oe?xi:c,!0).pipe(En(Se=>[new Kf(P,Se)]))}))))}getChildConfig(t,n,r){return n.children?Or({routes:n.children,injector:t}):n.loadChildren?void 0!==n._loadedRoutes?Or({routes:n._loadedRoutes,injector:n._loadedInjector}):function R4(e,t,n,r){const o=t.canLoad;return void 0===o||0===o.length?Or(!0):Or(o.map(d=>{const _=Pm(d,e);return Jd(function _4(e){return e&&cv(e.canLoad)}(_)?_.canLoad(t,n):e.runInContext(()=>_(t,n)))})).pipe(Rm(),EA())}(t,n,r).pipe(co(o=>o?this.configLoader.loadChildren(t,n).pipe(jl(c=>{n._loadedRoutes=c.routes,n._loadedInjector=c.injector})):function N4(e){return Z_(yA(!1,3))}())):Or({routes:[],injector:t})}}function W4(e){const t=e.value.routeConfig;return t&&""===t.path}function TA(e){const t=[],n=new Set;for(const r of e){if(!W4(r)){t.push(r);continue}const o=t.find(c=>r.value.routeConfig===c.value.routeConfig);void 0!==o?(o.children.push(...r.children),n.add(o)):t.push(r)}for(const r of n){const o=TA(r.children);t.push(new Kf(r.value,o))}return t.filter(r=>!n.has(r))}function MA(e){return e.data||{}}function DA(e){return e.resolve||{}}function AA(e){return"string"==typeof e.title||null===e.title}function VE(e){return Cr(t=>{const n=e(t);return n?Vo(n).pipe(En(()=>t)):Or(t)})}const Om=new Ar("ROUTES");let jE=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=In(pM)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Or(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const r=Jd(n.loadComponent()).pipe(En(PA),jl(c=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=c}),EE(()=>{this.componentLoaders.delete(n)})),o=new VD(r,()=>new zt).pipe(wE());return this.componentLoaders.set(n,o),o}loadChildren(n,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Or({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const c=this.loadModuleFactoryOrRoutes(r.loadChildren).pipe(En(_=>{this.onLoadEndListener&&this.onLoadEndListener(r);let b,C;return Array.isArray(_)?C=_:(b=_.create(n).injector,C=b.get(Om,[],pr.Self|pr.Optional).flat()),{routes:C.map(BE),injector:b}}),EE(()=>{this.childrenLoaders.delete(r)})),d=new VD(c,()=>new zt).pipe(wE());return this.childrenLoaders.set(r,d),d}loadModuleFactoryOrRoutes(n){return Jd(n()).pipe(En(PA),co(r=>r instanceof xT||Array.isArray(r)?Or(r):Vo(this.compiler.compileModuleAsync(r))))}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function PA(e){return function e5(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let X1=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new zt,this.configLoader=In(jE),this.environmentInjector=In(qc),this.urlSerializer=In(Q_),this.rootContexts=In(ov),this.inputBindingEnabled=null!==In(G1,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Or(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=o=>this.events.next(new Xz(o)),this.configLoader.onLoadStartListener=o=>this.events.next(new Wz(o))}complete(){this.transitions?.complete()}handleNavigationRequest(n){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...n,id:r})}setupNavigations(n){return this.transitions=new Dt({id:0,currentUrlTree:n.currentUrlTree,currentRawUrl:n.currentUrlTree,extractedUrl:n.urlHandlingStrategy.extract(n.currentUrlTree),urlAfterRedirects:n.urlHandlingStrategy.extract(n.currentUrlTree),rawUrl:n.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:rv,restoredState:null,currentSnapshot:n.routerState.snapshot,targetSnapshot:null,currentRouterState:n.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Kd(r=>0!==r.id),En(r=>({...r,extractedUrl:n.urlHandlingStrategy.extract(r.rawUrl)})),Cr(r=>{let o=!1,c=!1;return Or(r).pipe(jl(d=>{this.currentNavigation={id:d.id,initialUrl:d.rawUrl,extractedUrl:d.extractedUrl,trigger:d.source,extras:d.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Cr(d=>{const _=n.browserUrlTree.toString(),b=!n.navigated||d.extractedUrl.toString()!==_||_!==n.currentUrlTree.toString();if(!b&&"reload"!==(d.extras.onSameUrlNavigation??n.onSameUrlNavigation)){const D="";return this.events.next(new iv(d.id,n.serializeUrl(r.rawUrl),D,0)),n.rawUrlTree=d.rawUrl,d.resolve(null),mr}if(n.urlHandlingStrategy.shouldProcessUrl(d.rawUrl))return RA(d.source)&&(n.browserUrlTree=d.extractedUrl),Or(d).pipe(Cr(D=>{const P=this.transitions?.getValue();return this.events.next(new DE(D.id,this.urlSerializer.serialize(D.extractedUrl),D.source,D.restoredState)),P!==this.transitions?.getValue()?mr:Promise.resolve(D)}),function X4(e,t,n,r,o,c){return co(d=>function $4(e,t,n,r,o,c,d="emptyOnly"){return new q4(e,t,n,r,o,d,c).recognize()}(e,t,n,r,d.extractedUrl,o,c).pipe(En(({state:_,tree:b})=>({...d,targetSnapshot:_,urlAfterRedirects:b}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,n.paramsInheritanceStrategy),jl(D=>{if(r.targetSnapshot=D.targetSnapshot,r.urlAfterRedirects=D.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:D.urlAfterRedirects},"eager"===n.urlUpdateStrategy){if(!D.extras.skipLocationChange){const N=n.urlHandlingStrategy.merge(D.urlAfterRedirects,D.rawUrl);n.setBrowserUrl(N,D)}n.browserUrlTree=D.urlAfterRedirects}const P=new jz(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects),D.targetSnapshot);this.events.next(P)}));if(b&&n.urlHandlingStrategy.shouldProcessUrl(n.rawUrlTree)){const{id:D,extractedUrl:P,source:N,restoredState:B,extras:le}=d,se=new DE(D,this.urlSerializer.serialize(P),N,B);this.events.next(se);const Oe=hA(0,this.rootComponentType).snapshot;return Or(r={...d,targetSnapshot:Oe,urlAfterRedirects:P,extras:{...le,skipLocationChange:!1,replaceUrl:!1}})}{const D="";return this.events.next(new iv(d.id,n.serializeUrl(r.extractedUrl),D,1)),n.rawUrlTree=d.rawUrl,d.resolve(null),mr}}),jl(d=>{const _=new Gz(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(_)}),En(d=>r={...d,guards:d4(d.targetSnapshot,d.currentSnapshot,this.rootContexts)}),function C4(e,t){return co(n=>{const{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:c,canDeactivateChecks:d}}=n;return 0===d.length&&0===c.length?Or({...n,guardsResult:!0}):function S4(e,t,n,r){return Vo(e).pipe(co(o=>function P4(e,t,n,r,o){const c=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return c&&0!==c.length?Or(c.map(_=>{const b=av(t)??o,C=Pm(_,b);return Jd(function w4(e){return e&&cv(e.canDeactivate)}(C)?C.canDeactivate(e,t,n,r):b.runInContext(()=>C(e,t,n,r))).pipe(jp())})).pipe(Rm()):Or(!0)}(o.component,o.route,n,t,r)),jp(o=>!0!==o,!0))}(d,r,o,e).pipe(co(_=>_&&function y4(e){return"boolean"==typeof e}(_)?function I4(e,t,n,r){return Vo(t).pipe(Y_(o=>xE(function M4(e,t){return null!==e&&t&&t(new Zz(e)),Or(!0)}(o.route.parent,r),function T4(e,t){return null!==e&&t&&t(new Kz(e)),Or(!0)}(o.route,r),function A4(e,t,n){const r=t[t.length-1],c=t.slice(0,t.length-1).reverse().map(d=>function p4(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(d)).filter(d=>null!==d).map(d=>UD(()=>Or(d.guards.map(b=>{const C=av(d.node)??n,D=Pm(b,C);return Jd(function x4(e){return e&&cv(e.canActivateChild)}(D)?D.canActivateChild(r,e):C.runInContext(()=>D(r,e))).pipe(jp())})).pipe(Rm())));return Or(c).pipe(Rm())}(e,o.path,n),function D4(e,t,n){const r=t.routeConfig?t.routeConfig.canActivate:null;if(!r||0===r.length)return Or(!0);const o=r.map(c=>UD(()=>{const d=av(t)??n,_=Pm(c,d);return Jd(function v4(e){return e&&cv(e.canActivate)}(_)?_.canActivate(t,e):d.runInContext(()=>_(t,e))).pipe(jp())}));return Or(o).pipe(Rm())}(e,o.route,n))),jp(o=>!0!==o,!0))}(r,c,e,t):Or(_)),En(_=>({...n,guardsResult:_})))})}(this.environmentInjector,d=>this.events.next(d)),jl(d=>{if(r.guardsResult=d.guardsResult,qp(d.guardsResult))throw mA(0,d.guardsResult);const _=new $z(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot,!!d.guardsResult);this.events.next(_)}),Kd(d=>!!d.guardsResult||(n.restoreHistory(d),this.cancelNavigationTransition(d,"",3),!1)),VE(d=>{if(d.guards.canActivateChecks.length)return Or(d).pipe(jl(_=>{const b=new qz(_.id,this.urlSerializer.serialize(_.extractedUrl),this.urlSerializer.serialize(_.urlAfterRedirects),_.targetSnapshot);this.events.next(b)}),Cr(_=>{let b=!1;return Or(_).pipe(function Z4(e,t){return co(n=>{const{targetSnapshot:r,guards:{canActivateChecks:o}}=n;if(!o.length)return Or(n);let c=0;return Vo(o).pipe(Y_(d=>function Y4(e,t,n,r){const o=e.routeConfig,c=e._resolve;return void 0!==o?.title&&!AA(o)&&(c[K_]=o.title),function K4(e,t,n,r){const o=function J4(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===o.length)return Or({});const c={};return Vo(o).pipe(co(d=>function Q4(e,t,n,r){const o=av(t)??r,c=Pm(e,o);return Jd(c.resolve?c.resolve(t,n):o.runInContext(()=>c(t,n)))}(e[d],t,n,r).pipe(jp(),jl(_=>{c[d]=_}))),bE(1),function dz(e){return En(()=>e)}(c),Gp(d=>bA(d)?mr:Z_(d)))}(c,e,t,r).pipe(En(d=>(e._resolvedData=d,e.data=fA(e,n).resolve,o&&AA(o)&&(e.data[K_]=o.title),null)))}(d.route,r,e,t)),jl(()=>c++),bE(1),co(d=>c===o.length?Or(n):mr))})}(n.paramsInheritanceStrategy,this.environmentInjector),jl({next:()=>b=!0,complete:()=>{b||(n.restoreHistory(_),this.cancelNavigationTransition(_,"",2))}}))}),jl(_=>{const b=new Hz(_.id,this.urlSerializer.serialize(_.extractedUrl),this.urlSerializer.serialize(_.urlAfterRedirects),_.targetSnapshot);this.events.next(b)}))}),VE(d=>{const _=b=>{const C=[];b.routeConfig?.loadComponent&&!b.routeConfig._loadedComponent&&C.push(this.configLoader.loadComponent(b.routeConfig).pipe(jl(D=>{b.component=D}),En(()=>{})));for(const D of b.children)C.push(..._(D));return C};return vE(_(d.targetSnapshot.root)).pipe(O1(),Im(1))}),VE(()=>this.afterPreactivation()),En(d=>{const _=function r4(e,t,n){const r=sv(e,t._root,n?n._root:void 0);return new cA(r,t)}(n.routeReuseStrategy,d.targetSnapshot,d.currentRouterState);return r={...d,targetRouterState:_}}),jl(d=>{n.currentUrlTree=d.urlAfterRedirects,n.rawUrlTree=n.urlHandlingStrategy.merge(d.urlAfterRedirects,d.rawUrl),n.routerState=d.targetRouterState,"deferred"===n.urlUpdateStrategy&&(d.extras.skipLocationChange||n.setBrowserUrl(n.rawUrlTree,d),n.browserUrlTree=d.urlAfterRedirects)}),((e,t,n,r)=>En(o=>(new f4(t,o.targetRouterState,o.currentRouterState,n,r).activate(e),o)))(this.rootContexts,n.routeReuseStrategy,d=>this.events.next(d),this.inputBindingEnabled),Im(1),jl({next:d=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,n.navigated=!0,this.events.next(new Hp(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(n.currentUrlTree))),n.titleStrategy?.updateTitle(d.targetRouterState.snapshot),d.resolve(!0)},complete:()=>{o=!0}}),EE(()=>{o||c||this.cancelNavigationTransition(r,"",1),this.currentNavigation?.id===r.id&&(this.currentNavigation=null)}),Gp(d=>{if(c=!0,vA(d)){_A(d)||(n.navigated=!0,n.restoreHistory(r,!0));const _=new V1(r.id,this.urlSerializer.serialize(r.extractedUrl),d.message,d.cancellationCode);if(this.events.next(_),_A(d)){const b=n.urlHandlingStrategy.merge(d.url,n.rawUrlTree),C={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===n.urlUpdateStrategy||RA(r.source)};n.scheduleNavigation(b,rv,null,C,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{n.restoreHistory(r,!0);const _=new AE(r.id,this.urlSerializer.serialize(r.extractedUrl),d,r.targetSnapshot??void 0);this.events.next(_);try{r.resolve(n.errorHandler(d))}catch(b){r.reject(b)}}return mr}))}))}cancelNavigationTransition(n,r,o){const c=new V1(n.id,this.urlSerializer.serialize(n.extractedUrl),r,o);this.events.next(c),n.resolve(!1)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function RA(e){return e!==rv}let LA=(()=>{class e{buildTitle(n){let r,o=n.root;for(;void 0!==o;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(c=>c.outlet===xi);return r}getResolvedTitleForRoute(n){return n.data[K_]}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:function(){return In(t5)},providedIn:"root"}),e})(),t5=(()=>{class e extends LA{constructor(n){super(),this.title=n}updateTitle(n){const r=this.buildTitle(n);void 0!==r&&this.title.setTitle(r)}}return e.\u0275fac=function(n){return new(n||e)(Wn(ND))},e.\u0275prov=Vn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),n5=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:function(){return In(i5)},providedIn:"root"}),e})();class r5{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}let i5=(()=>{class e extends r5{}return e.\u0275fac=function(){let t;return function(r){return(t||(t=function ag(e){return jo(()=>{const t=e.prototype.constructor,n=t[Aa]||lp(t),r=Object.prototype;let o=Object.getPrototypeOf(e.prototype).constructor;for(;o&&o!==r;){const c=o[Aa]||lp(o);if(c&&c!==n)return c;o=Object.getPrototypeOf(o)}return c=>new c})}(e)))(r||e)}}(),e.\u0275prov=Vn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Z1=new Ar("",{providedIn:"root",factory:()=>({})});let o5=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:function(){return In(s5)},providedIn:"root"}),e})(),s5=(()=>{class e{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,r){return n}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var Sc=(()=>((Sc=Sc||{})[Sc.COMPLETE=0]="COMPLETE",Sc[Sc.FAILED=1]="FAILED",Sc[Sc.REDIRECTING=2]="REDIRECTING",Sc))();function OA(e,t){e.events.pipe(Kd(n=>n instanceof Hp||n instanceof V1||n instanceof AE||n instanceof iv),En(n=>n instanceof Hp||n instanceof iv?Sc.COMPLETE:n instanceof V1&&(0===n.code||1===n.code)?Sc.REDIRECTING:Sc.FAILED),Kd(n=>n!==Sc.REDIRECTING),Im(1)).subscribe(()=>{t()})}function a5(e){throw e}function u5(e,t,n){return t.parse("/")}const l5={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},c5={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Ic=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=In(fM),this.isNgZoneEnabled=!1,this.options=In(Z1,{optional:!0})||{},this.pendingTasks=In(dM),this.errorHandler=this.options.errorHandler||a5,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||u5,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=In(o5),this.routeReuseStrategy=In(n5),this.titleStrategy=In(LA),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=In(Om,{optional:!0})?.flat()??[],this.navigationTransitions=In(X1),this.urlSerializer=In(Q_),this.location=In(Xb),this.componentInputBindingEnabled=!!In(G1,{optional:!0}),this.isNgZoneEnabled=In(Ia)instanceof Ia&&Ia.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Mm,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=hA(0,null),this.navigationTransitions.setupNavigations(this).subscribe(n=>{this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId??0},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const n=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),rv,n)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const r="popstate"===n.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{this.navigateToSyncWithBrowser(n.url,r,n.state)},0)}))}navigateToSyncWithBrowser(n,r,o){const c={replaceUrl:!0},d=o?.navigationId?o:null;if(o){const b={...o};delete b.navigationId,delete b.\u0275routerPageId,0!==Object.keys(b).length&&(c.state=b)}const _=this.parseUrl(n);this.scheduleNavigation(_,r,d,c)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(BE),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,r={}){const{relativeTo:o,queryParams:c,fragment:d,queryParamsHandling:_,preserveFragment:b}=r,C=b?this.currentUrlTree.fragment:d;let P,D=null;switch(_){case"merge":D={...this.currentUrlTree.queryParams,...c};break;case"preserve":D=this.currentUrlTree.queryParams;break;default:D=c||null}null!==D&&(D=this.removeEmptyProps(D));try{P=tA(o?o.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof n[0]||!n[0].startsWith("/"))&&(n=[]),P=this.currentUrlTree.root}return nA(P,n,D,C??null)}navigateByUrl(n,r={skipLocationChange:!1}){const o=qp(n)?n:this.parseUrl(n),c=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(c,rv,null,r)}navigate(n,r={skipLocationChange:!1}){return function h5(e){for(let t=0;t<e.length;t++)if(null==e[t])throw new Dn(4008,!1)}(n),this.navigateByUrl(this.createUrlTree(n,r),r)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let r;try{r=this.urlSerializer.parse(n)}catch(o){r=this.malformedUriErrorHandler(o,this.urlSerializer,n)}return r}isActive(n,r){let o;if(o=!0===r?{...l5}:!1===r?{...c5}:r,qp(n))return HD(this.currentUrlTree,n,o);const c=this.parseUrl(n);return HD(this.currentUrlTree,c,o)}removeEmptyProps(n){return Object.keys(n).reduce((r,o)=>{const c=n[o];return null!=c&&(r[o]=c),r},{})}scheduleNavigation(n,r,o,c,d){if(this.disposed)return Promise.resolve(!1);let _,b,C;d?(_=d.resolve,b=d.reject,C=d.promise):C=new Promise((P,N)=>{_=P,b=N});const D=this.pendingTasks.add();return OA(this,()=>{Promise.resolve().then(()=>this.pendingTasks.remove(D))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:c,resolve:_,reject:b,promise:C,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),C.catch(P=>Promise.reject(P))}setBrowserUrl(n,r){const o=this.urlSerializer.serialize(n);if(this.location.isCurrentPathEqualTo(o)||r.extras.replaceUrl){const d={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId)};this.location.replaceState(o,"",d)}else{const c={...r.extras.state,...this.generateNgRouterState(r.id,(this.browserPageId??0)+1)};this.location.go(o,"",c)}}restoreHistory(n,r=!1){if("computed"===this.canceledNavigationResolution){const c=this.currentPageId-(this.browserPageId??this.currentPageId);0!==c?this.location.historyGo(c):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===c&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,r){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:r}:{navigationId:n}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Vn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class NA{}let p5=(()=>{class e{constructor(n,r,o,c,d){this.router=n,this.injector=o,this.preloadingStrategy=c,this.loader=d}setUpPreloading(){this.subscription=this.router.events.pipe(Kd(n=>n instanceof Hp),Y_(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,r){const o=[];for(const c of r){c.providers&&!c._injector&&(c._injector=cb(c.providers,n,`Route: ${c.path}`));const d=c._injector??n,_=c._loadedInjector??d;(c.loadChildren&&!c._loadedRoutes&&void 0===c.canLoad||c.loadComponent&&!c._loadedComponent)&&o.push(this.preloadConfig(d,c)),(c.children||c._loadedRoutes)&&o.push(this.processRoutes(_,c.children??c._loadedRoutes))}return Vo(o).pipe(el())}preloadConfig(n,r){return this.preloadingStrategy.preload(r,()=>{let o;o=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(n,r):Or(null);const c=o.pipe(co(d=>null===d?Or(void 0):(r._loadedRoutes=d.routes,r._loadedInjector=d.injector,this.processRoutes(d.injector??n,d.routes))));return r.loadComponent&&!r._loadedComponent?Vo([c,this.loader.loadComponent(r)]).pipe(el()):c})}}return e.\u0275fac=function(n){return new(n||e)(Wn(Ic),Wn(pM),Wn(qc),Wn(NA),Wn(jE))},e.\u0275prov=Vn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const $E=new Ar("");let kA=(()=>{class e{constructor(n,r,o,c,d={}){this.urlSerializer=n,this.transitions=r,this.viewportScroller=o,this.zone=c,this.options=d,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},d.scrollPositionRestoration=d.scrollPositionRestoration||"disabled",d.anchorScrolling=d.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof DE?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof Hp?(this.lastId=n.id,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.urlAfterRedirects).fragment)):n instanceof iv&&0===n.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof uA&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new uA(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return e.\u0275fac=function(n){!function E_(){throw new Error("invalid")}()},e.\u0275prov=Vn({token:e,factory:e.\u0275fac}),e})();function Jf(e,t){return{\u0275kind:e,\u0275providers:t}}function BA(){const e=In(Ec);return t=>{const n=e.get(Cm);if(t!==n.components[0])return;const r=e.get(Ic),o=e.get(zA);1===e.get(qE)&&r.initialNavigation(),e.get(UA,null,pr.Optional)?.setUpPreloading(),e.get($E,null,pr.Optional)?.init(),r.resetRootComponentType(n.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}const zA=new Ar("",{factory:()=>new zt}),qE=new Ar("",{providedIn:"root",factory:()=>1}),UA=new Ar("");function _5(e){return Jf(0,[{provide:UA,useExisting:p5},{provide:NA,useExisting:e}])}const VA=new Ar("ROUTER_FORROOT_GUARD"),x5=[Xb,{provide:Q_,useClass:CE},Ic,ov,{provide:Am,useFactory:function FA(e){return e.routerState.root},deps:[Ic]},jE,[]];function w5(){return new SM("Router",Ic)}let jA=(()=>{class e{constructor(n){}static forRoot(n,r){return{ngModule:e,providers:[x5,[],{provide:Om,multi:!0,useValue:n},{provide:VA,useFactory:S5,deps:[[Ic,new Sa,new dh]]},{provide:Z1,useValue:r||{}},r?.useHash?{provide:Vp,useClass:EF}:{provide:Vp,useClass:QM},{provide:$E,useFactory:()=>{const e=In($3),t=In(Ia),n=In(Z1),r=In(X1),o=In(Q_);return n.scrollOffset&&e.setOffset(n.scrollOffset),new kA(o,r,e,t,n)}},r?.preloadingStrategy?_5(r.preloadingStrategy).\u0275providers:[],{provide:SM,multi:!0,useFactory:w5},r?.initialNavigation?I5(r):[],r?.bindToComponentInputs?Jf(8,[gA,{provide:G1,useExisting:gA}]).\u0275providers:[],[{provide:GA,useFactory:BA},{provide:Nb,multi:!0,useExisting:GA}]]}}static forChild(n){return{ngModule:e,providers:[{provide:Om,multi:!0,useValue:n}]}}}return e.\u0275fac=function(n){return new(n||e)(Wn(VA,8))},e.\u0275mod=Kl({type:e}),e.\u0275inj=yu({}),e})();function S5(e){return"guarded"}function I5(e){return["disabled"===e.initialNavigation?Jf(3,[{provide:Ib,multi:!0,useFactory:()=>{const t=In(Ic);return()=>{t.setUpLocationChangeListener()}}},{provide:qE,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?Jf(2,[{provide:qE,useValue:0},{provide:Ib,multi:!0,deps:[Ec],useFactory:t=>{const n=t.get(wF,Promise.resolve());return()=>n.then(()=>new Promise(r=>{const o=t.get(Ic),c=t.get(zA);OA(o,()=>{r(!0)}),t.get(X1).afterPreactivation=()=>(r(!0),c.closed?Or(void 0):c),o.initialNavigation()}))}}]).\u0275providers:[]]}const GA=new Ar("");function $A(e,t,n,r,o,c,d){try{var _=e[c](d),b=_.value}catch(C){return void n(C)}_.done?t(b):Promise.resolve(b).then(r,o)}var Qd=pe(9898),qA=pe(8545);const D5_mapbox_accessToken="pk.eyJ1IjoiYWhtZWRtb2hzZW4wOCIsImEiOiJjbGl1MzE5cDEwZW04M2ptOHlvd250cjdoIn0.DxhNH0Z2Qg1ARqOgx9rQqw";var Gl=6371008.8,HA={centimeters:100*Gl,centimetres:100*Gl,degrees:Gl/111325,feet:3.28084*Gl,inches:39.37*Gl,kilometers:Gl/1e3,kilometres:Gl/1e3,meters:Gl,metres:Gl,miles:Gl/1609.344,millimeters:1e3*Gl,millimetres:1e3*Gl,nauticalmiles:Gl/1852,radians:1,yards:1.0936*Gl};function Qf(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function Y1(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!XE(e[0])||!XE(e[1]))throw new Error("coordinates must contain numbers");return Qf({type:"Point",coordinates:e},t,n)}function K1(e,t,n){void 0===n&&(n={});for(var r=0,o=e;r<o.length;r++){var c=o[r];if(c.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var d=0;d<c[c.length-1].length;d++)if(c[c.length-1][d]!==c[0][d])throw new Error("First and last Position are not equivalent.")}return Qf({type:"Polygon",coordinates:e},t,n)}function J1(e){return e%360*Math.PI/180}function XE(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function hv(e,t,n){if(null!==e)for(var r,o,c,d,_,b,C,N,D=0,P=0,B=e.type,le="FeatureCollection"===B,se="Feature"===B,Oe=le?e.features.length:1,Se=0;Se<Oe;Se++){_=(N=!!(C=le?e.features[Se].geometry:se?e.geometry:e)&&"GeometryCollection"===C.type)?C.geometries.length:1;for(var ae=0;ae<_;ae++){var Me=0,ot=0;if(null!==(d=N?C.geometries[ae]:C)){b=d.coordinates;var lt=d.type;switch(D=!n||"Polygon"!==lt&&"MultiPolygon"!==lt?0:1,lt){case null:break;case"Point":if(!1===t(b,P,Se,Me,ot))return!1;P++,Me++;break;case"LineString":case"MultiPoint":for(r=0;r<b.length;r++){if(!1===t(b[r],P,Se,Me,ot))return!1;P++,"MultiPoint"===lt&&Me++}"LineString"===lt&&Me++;break;case"Polygon":case"MultiLineString":for(r=0;r<b.length;r++){for(o=0;o<b[r].length-D;o++){if(!1===t(b[r][o],P,Se,Me,ot))return!1;P++}"MultiLineString"===lt&&Me++,"Polygon"===lt&&ot++}"Polygon"===lt&&Me++;break;case"MultiPolygon":for(r=0;r<b.length;r++){for(ot=0,o=0;o<b[r].length;o++){for(c=0;c<b[r][o].length-D;c++){if(!1===t(b[r][o][c],P,Se,Me,ot))return!1;P++}ot++}Me++}break;case"GeometryCollection":for(r=0;r<d.geometries.length;r++)if(!1===hv(d.geometries[r],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Q1(e,t){!function KA(e,t){var n,r,o,c,d,_,b,C,D,P,N=0,B="FeatureCollection"===e.type,le="Feature"===e.type,se=B?e.features.length:1;for(n=0;n<se;n++){for(C=B?e.features[n].properties:le?e.properties:{},D=B?e.features[n].bbox:le?e.bbox:void 0,P=B?e.features[n].id:le?e.id:void 0,d=(b=!!(_=B?e.features[n].geometry:le?e.geometry:e)&&"GeometryCollection"===_.type)?_.geometries.length:1,o=0;o<d;o++)if(null!==(c=b?_.geometries[o]:_))switch(c.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(c,N,C,D,P))return!1;break;case"GeometryCollection":for(r=0;r<c.geometries.length;r++)if(!1===t(c.geometries[r],N,C,D,P))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,N,C,D,P))return!1;N++}}(e,function(n,r,o,c,d){var b,_=null===n?null:n.type;switch(_){case null:case"Point":case"LineString":case"Polygon":return!1!==t(Qf(n,o,{bbox:c,id:d}),r,0)&&void 0}switch(_){case"MultiPoint":b="Point";break;case"MultiLineString":b="LineString";break;case"MultiPolygon":b="Polygon"}for(var C=0;C<n.coordinates.length;C++)if(!1===t(Qf({type:b,coordinates:n.coordinates[C]},o),r,C))return!1})}function ZE(e){var t=[1/0,1/0,-1/0,-1/0];return hv(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}ZE.default=ZE;const B5=ZE;function YE(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function tP(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var r=YE(e),o=function V5(e){return"Feature"===e.type?e.geometry:e}(t),c=o.type,d=t.bbox,_=o.coordinates;if(d&&!1===function K5(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(r,d))return!1;"Polygon"===c&&(_=[_]);for(var b=!1,C=0;C<_.length&&!b;C++)if(nP(r,_[C][0],n.ignoreBoundary)){for(var D=!1,P=1;P<_[C].length&&!D;)nP(r,_[C][P],!n.ignoreBoundary)&&(D=!0),P++;D||(b=!0)}return b}function nP(e,t,n){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var o=0,c=t.length-1;o<t.length;c=o++){var d=t[o][0],_=t[o][1],b=t[c][0],C=t[c][1];if(e[1]*(d-b)+_*(b-e[0])+C*(e[0]-d)==0&&(d-e[0])*(b-e[0])<=0&&(_-e[1])*(C-e[1])<=0)return!n;_>e[1]!=C>e[1]&&e[0]<(b-d)*(e[1]-_)/(C-_)+d&&(r=!r)}return r}pe(5943),pe(1335);const rP=function J5(e,t,n){void 0===n&&(n={});var r=YE(e),o=YE(t),c=J1(o[1]-r[1]),d=J1(o[0]-r[0]),_=J1(r[1]),b=J1(o[1]),C=Math.pow(Math.sin(c/2),2)+Math.pow(Math.sin(d/2),2)*Math.cos(_)*Math.cos(b);return function ZA(e,t){void 0===t&&(t="kilometers");var n=HA[t];if(!n)throw new Error(t+" units is invalid");return e*n}(2*Math.atan2(Math.sqrt(C),Math.sqrt(1-C)),n.units)};var oP=new ArrayBuffer(16);new Float64Array(oP),new Uint32Array(oP),pe(3544),function(){function e(t){this.points=t.points||[],this.duration=t.duration||1e4,this.sharpness=t.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=t.stepLength||60,this.length=this.points.length,this.delay=0;for(var n=0;n<this.length;n++)this.points[n].z=this.points[n].z||0;for(n=0;n<this.length-1;n++){var r=this.points[n],o=this.points[n+1];this.centers.push({x:(r.x+o.x)/2,y:(r.y+o.y)/2,z:(r.z+o.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),n=0;n<this.centers.length-1;n++){var c=this.points[n+1].x-(this.centers[n].x+this.centers[n+1].x)/2,d=this.points[n+1].y-(this.centers[n].y+this.centers[n+1].y)/2,_=this.points[n+1].z-(this.centers[n].y+this.centers[n+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[n+1].x+this.sharpness*(this.centers[n].x+c),y:(1-this.sharpness)*this.points[n+1].y+this.sharpness*(this.centers[n].y+d),z:(1-this.sharpness)*this.points[n+1].z+this.sharpness*(this.centers[n].z+_)},{x:(1-this.sharpness)*this.points[n+1].x+this.sharpness*(this.centers[n+1].x+c),y:(1-this.sharpness)*this.points[n+1].y+this.sharpness*(this.centers[n+1].y+d),z:(1-this.sharpness)*this.points[n+1].z+this.sharpness*(this.centers[n+1].z+_)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}e.prototype.cacheSteps=function(t){var n=[],r=this.pos(0);n.push(0);for(var o=0;o<this.duration;o+=10){var c=this.pos(o);Math.sqrt((c.x-r.x)*(c.x-r.x)+(c.y-r.y)*(c.y-r.y)+(c.z-r.z)*(c.z-r.z))>t&&(n.push(o),r=c)}return n},e.prototype.vector=function(t){var n=this.pos(t+10),r=this.pos(t-10);return{angle:180*Math.atan2(n.y-r.y,n.x-r.x)/3.14,speed:Math.sqrt((r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y)+(r.z-n.z)*(r.z-n.z))}},e.prototype.pos=function(t){var n=t-this.delay;n<0&&(n=0),n>this.duration&&(n=this.duration-1);var r=n/this.duration;if(r>=1)return this.points[this.length-1];var o=Math.floor((this.points.length-1)*r);return function pU(e,t,n,r,o){var c=function gU(e){var t=e*e;return[t*e,3*t*(1-e),3*e*(1-e)*(1-e),(1-e)*(1-e)*(1-e)]}(e);return{x:o.x*c[0]+r.x*c[1]+n.x*c[2]+t.x*c[3],y:o.y*c[0]+r.y*c[1]+n.y*c[2]+t.y*c[3],z:o.z*c[0]+r.z*c[1]+n.z*c[2]+t.z*c[3]}}((this.length-1)*r-o,this.points[o],this.controls[o][1],this.controls[o+1][0],this.points[o+1])}}();pe(5469),pe(5406);var bP=Math.PI/180,EP=180/Math.PI,pv=function(e,t){this.lon=e,this.lat=t,this.x=bP*e,this.y=bP*t};pv.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},pv.prototype.antipode=function(){return new pv(this.lon<0?180+this.lon:-1*(180-this.lon),-1*this.lat)};var CP=function(){this.coords=[],this.length=0};CP.prototype.move_to=function(e){this.length++,this.coords.push(e)};var iC=function(e){this.properties=e||{},this.geometries=[]};iC.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var e=[],t=0;t<this.geometries.length;t++)e.push(this.geometries[t].coords);return{geometry:{type:"MultiLineString",coordinates:e},type:"Feature",properties:this.properties}},iC.prototype.wkt=function(){for(var e="",t="LINESTRING(",n=function(c){t+=c[0]+" "+c[1]+","},r=0;r<this.geometries.length;r++){if(0===this.geometries[r].coords.length)return"LINESTRING(empty)";this.geometries[r].coords.forEach(n),e+=t.substring(0,t.length-1)+")"}return e};var oC=function(e,t,n){if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new pv(e.x,e.y),this.end=new pv(t.x,t.y),this.properties=n||{};var r=this.start.x-this.end.x,c=Math.pow(Math.sin((this.start.y-this.end.y)/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(r/2),2);if(this.g=2*Math.asin(Math.sqrt(c)),this.g===Math.PI)throw new Error("it appears "+e.view()+" and "+t.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+e+" and "+t)};oC.prototype.interpolate=function(e){var t=Math.sin((1-e)*this.g)/Math.sin(this.g),n=Math.sin(e*this.g)/Math.sin(this.g),r=t*Math.cos(this.start.y)*Math.cos(this.start.x)+n*Math.cos(this.end.y)*Math.cos(this.end.x),o=t*Math.cos(this.start.y)*Math.sin(this.start.x)+n*Math.cos(this.end.y)*Math.sin(this.end.x),c=t*Math.sin(this.start.y)+n*Math.sin(this.end.y),d=EP*Math.atan2(c,Math.sqrt(Math.pow(r,2)+Math.pow(o,2)));return[EP*Math.atan2(o,r),d]},oC.prototype.Arc=function(e,t){var n=[];if(!e||e<=2)n.push([this.start.lon,this.start.lat]),n.push([this.end.lon,this.end.lat]);else for(var r=1/(e-1),o=0;o<e;++o){var d=this.interpolate(r*o);n.push(d)}for(var _=!1,b=0,C=t&&t.offset?t.offset:10,D=180-C,P=-180+C,N=360-C,B=1;B<n.length;++B){var le=n[B-1][0],se=n[B][0],Oe=Math.abs(se-le);Oe>N&&(se>D&&le<P||le>D&&se<P)?_=!0:Oe>b&&(b=Oe)}var Se=[];if(_&&b<C){var ae=[];Se.push(ae);for(var Me=0;Me<n.length;++Me){var ot=parseFloat(n[Me][0]);if(Me>0&&Math.abs(ot-n[Me-1][0])>N){var lt=parseFloat(n[Me-1][0]),Mt=parseFloat(n[Me-1][1]),Pt=parseFloat(n[Me][0]),qt=parseFloat(n[Me][1]);if(lt>-180&&lt<P&&180===Pt&&Me+1<n.length&&n[Me-1][0]>-180&&n[Me-1][0]<P){ae.push([-180,n[Me][1]]),Me++,ae.push([n[Me][0],n[Me][1]]);continue}if(lt>D&&lt<180&&-180===Pt&&Me+1<n.length&&n[Me-1][0]>D&&n[Me-1][0]<180){ae.push([180,n[Me][1]]),Me++,ae.push([n[Me][0],n[Me][1]]);continue}if(lt<P&&Pt>D){var st=lt;lt=Pt,Pt=st;var Mr=Mt;Mt=qt,qt=Mr}if(lt>D&&Pt<P&&(Pt+=360),lt<=180&&Pt>=180&&lt<Pt){var Xn=(180-lt)/(Pt-lt),Yr=Xn*qt+(1-Xn)*Mt;ae.push([n[Me-1][0]>D?180:-180,Yr]),(ae=[]).push([n[Me-1][0]>D?-180:180,Yr]),Se.push(ae)}else Se.push(ae=[]);ae.push([ot,n[Me][1]])}else ae.push([n[Me][0],n[Me][1]])}}else{var ci=[];Se.push(ci);for(var Nn=0;Nn<n.length;++Nn)ci.push([n[Nn][0],n[Nn][1]])}for(var Ir=new iC(this.properties),lr=0;lr<Se.length;++lr){var zo=new CP;Ir.geometries.push(zo);for(var Co=Se[lr],_i=0;_i<Co.length;++_i)zo.move_to(Co[_i])}return Ir},pe(6952);var Di=[],Ai=[],Pi=[],Ri=[],Li=[],Oi=[],Ni=[],ki=[],Fi=[],Bi=[],zi=[],Ui=[],Vi=[],ji=[],Gi=[],$i=[],qi=[],Hi=[],Wi=[],Xi=[],Zi=[],Yi=[],Ki=[],Ji=[];Ni[85]=Bi[85]=-1,ki[85]=zi[85]=0,Fi[85]=Ui[85]=1,Wi[85]=Yi[85]=1,Xi[85]=Ki[85]=0,Zi[85]=Ji[85]=1,Di[85]=Ri[85]=0,Ai[85]=Li[85]=-1,Pi[85]=Gi[85]=0,$i[85]=Vi[85]=0,qi[85]=ji[85]=1,Oi[85]=Hi[85]=1,Yi[1]=Yi[169]=0,Ki[1]=Ki[169]=-1,Ji[1]=Ji[169]=0,Vi[1]=Vi[169]=-1,ji[1]=ji[169]=0,Gi[1]=Gi[169]=0,Bi[4]=Bi[166]=0,zi[4]=zi[166]=-1,Ui[4]=Ui[166]=1,$i[4]=$i[166]=1,qi[4]=qi[166]=0,Hi[4]=Hi[166]=0,Ni[16]=Ni[154]=0,ki[16]=ki[154]=1,Fi[16]=Fi[154]=1,Ri[16]=Ri[154]=1,Li[16]=Li[154]=0,Oi[16]=Oi[154]=1,Wi[64]=Wi[106]=0,Xi[64]=Xi[106]=1,Zi[64]=Zi[106]=0,Di[64]=Di[106]=-1,Ai[64]=Ai[106]=0,Pi[64]=Pi[106]=1,Wi[2]=Wi[168]=0,Xi[2]=Xi[168]=-1,Zi[2]=Zi[168]=1,Yi[2]=Yi[168]=0,Ki[2]=Ki[168]=-1,Ji[2]=Ji[168]=0,Vi[2]=Vi[168]=-1,ji[2]=ji[168]=0,Gi[2]=Gi[168]=0,$i[2]=$i[168]=-1,qi[2]=qi[168]=0,Hi[2]=Hi[168]=1,Ni[8]=Ni[162]=0,ki[8]=ki[162]=-1,Fi[8]=Fi[162]=0,Bi[8]=Bi[162]=0,zi[8]=zi[162]=-1,Ui[8]=Ui[162]=1,Vi[8]=Vi[162]=1,ji[8]=ji[162]=0,Gi[8]=Gi[162]=1,$i[8]=$i[162]=1,qi[8]=qi[162]=0,Hi[8]=Hi[162]=0,Ni[32]=Ni[138]=0,ki[32]=ki[138]=1,Fi[32]=Fi[138]=1,Bi[32]=Bi[138]=0,zi[32]=zi[138]=1,Ui[32]=Ui[138]=0,Di[32]=Di[138]=1,Ai[32]=Ai[138]=0,Pi[32]=Pi[138]=0,Ri[32]=Ri[138]=1,Li[32]=Li[138]=0,Oi[32]=Oi[138]=1,Yi[128]=Yi[42]=0,Ki[128]=Ki[42]=1,Ji[128]=Ji[42]=1,Wi[128]=Wi[42]=0,Xi[128]=Xi[42]=1,Zi[128]=Zi[42]=0,Di[128]=Di[42]=-1,Ai[128]=Ai[42]=0,Pi[128]=Pi[42]=1,Ri[128]=Ri[42]=-1,Li[128]=Li[42]=0,Oi[128]=Oi[42]=0,Bi[5]=Bi[165]=-1,zi[5]=zi[165]=0,Ui[5]=Ui[165]=0,Yi[5]=Yi[165]=1,Ki[5]=Ki[165]=0,Ji[5]=Ji[165]=0,$i[20]=$i[150]=0,qi[20]=qi[150]=1,Hi[20]=Hi[150]=1,Ri[20]=Ri[150]=0,Li[20]=Li[150]=-1,Oi[20]=Oi[150]=1,Ni[80]=Ni[90]=-1,ki[80]=ki[90]=0,Fi[80]=Fi[90]=1,Wi[80]=Wi[90]=1,Xi[80]=Xi[90]=0,Zi[80]=Zi[90]=1,Vi[65]=Vi[105]=0,ji[65]=ji[105]=1,Gi[65]=Gi[105]=0,Di[65]=Di[105]=0,Ai[65]=Ai[105]=-1,Pi[65]=Pi[105]=0,Ni[160]=Ni[10]=-1,ki[160]=ki[10]=0,Fi[160]=Fi[10]=1,Bi[160]=Bi[10]=-1,zi[160]=zi[10]=0,Ui[160]=Ui[10]=0,Yi[160]=Yi[10]=1,Ki[160]=Ki[10]=0,Ji[160]=Ji[10]=0,Wi[160]=Wi[10]=1,Xi[160]=Xi[10]=0,Zi[160]=Zi[10]=1,$i[130]=$i[40]=0,qi[130]=qi[40]=1,Hi[130]=Hi[40]=1,Vi[130]=Vi[40]=0,ji[130]=ji[40]=1,Gi[130]=Gi[40]=0,Di[130]=Di[40]=0,Ai[130]=Ai[40]=-1,Pi[130]=Pi[40]=0,Ri[130]=Ri[40]=0,Li[130]=Li[40]=-1,Oi[130]=Oi[40]=1,Bi[37]=Bi[133]=0,zi[37]=zi[133]=1,Ui[37]=Ui[133]=1,Yi[37]=Yi[133]=0,Ki[37]=Ki[133]=1,Ji[37]=Ji[133]=0,Di[37]=Di[133]=-1,Ai[37]=Ai[133]=0,Pi[37]=Pi[133]=0,Ri[37]=Ri[133]=1,Li[37]=Li[133]=0,Oi[37]=Oi[133]=0,$i[148]=$i[22]=-1,qi[148]=qi[22]=0,Hi[148]=Hi[22]=0,Yi[148]=Yi[22]=0,Ki[148]=Ki[22]=-1,Ji[148]=Ji[22]=1,Wi[148]=Wi[22]=0,Xi[148]=Xi[22]=1,Zi[148]=Zi[22]=1,Ri[148]=Ri[22]=-1,Li[148]=Li[22]=0,Oi[148]=Oi[22]=1,Ni[82]=Ni[88]=0,ki[82]=ki[88]=-1,Fi[82]=Fi[88]=1,$i[82]=$i[88]=1,qi[82]=qi[88]=0,Hi[82]=Hi[88]=1,Vi[82]=Vi[88]=-1,ji[82]=ji[88]=0,Gi[82]=Gi[88]=1,Wi[82]=Wi[88]=0,Xi[82]=Xi[88]=-1,Zi[82]=Zi[88]=0,Ni[73]=Ni[97]=0,ki[73]=ki[97]=1,Fi[73]=Fi[97]=0,Bi[73]=Bi[97]=0,zi[73]=zi[97]=-1,Ui[73]=Ui[97]=0,Vi[73]=Vi[97]=1,ji[73]=ji[97]=0,Gi[73]=Gi[97]=0,Di[73]=Di[97]=1,Ai[73]=Ai[97]=0,Pi[73]=Pi[97]=1,Ni[145]=Ni[25]=0,ki[145]=ki[25]=-1,Fi[145]=Fi[25]=0,Vi[145]=Vi[25]=1,ji[145]=ji[25]=0,Gi[145]=Gi[25]=1,Yi[145]=Yi[25]=0,Ki[145]=Ki[25]=1,Ji[145]=Ji[25]=1,Ri[145]=Ri[25]=-1,Li[145]=Li[25]=0,Oi[145]=Oi[25]=0,Bi[70]=Bi[100]=0,zi[70]=zi[100]=1,Ui[70]=Ui[100]=0,$i[70]=$i[100]=-1,qi[70]=qi[100]=0,Hi[70]=Hi[100]=1,Wi[70]=Wi[100]=0,Xi[70]=Xi[100]=-1,Zi[70]=Zi[100]=1,Di[70]=Di[100]=1,Ai[70]=Ai[100]=0,Pi[70]=Pi[100]=0,Bi[101]=Bi[69]=0,zi[101]=zi[69]=1,Ui[101]=Ui[69]=0,Di[101]=Di[69]=1,Ai[101]=Ai[69]=0,Pi[101]=Pi[69]=0,Yi[149]=Yi[21]=0,Ki[149]=Ki[21]=1,Ji[149]=Ji[21]=1,Ri[149]=Ri[21]=-1,Li[149]=Li[21]=0,Oi[149]=Oi[21]=0,$i[86]=$i[84]=-1,qi[86]=qi[84]=0,Hi[86]=Hi[84]=1,Wi[86]=Wi[84]=0,Xi[86]=Xi[84]=-1,Zi[86]=Zi[84]=1,Ni[89]=Ni[81]=0,ki[89]=ki[81]=-1,Fi[89]=Fi[81]=0,Vi[89]=Vi[81]=1,ji[89]=ji[81]=0,Gi[89]=Gi[81]=1,Ni[96]=Ni[74]=0,ki[96]=ki[74]=1,Fi[96]=Fi[74]=0,Bi[96]=Bi[74]=-1,zi[96]=zi[74]=0,Ui[96]=Ui[74]=1,Wi[96]=Wi[74]=1,Xi[96]=Xi[74]=0,Zi[96]=Zi[74]=0,Di[96]=Di[74]=1,Ai[96]=Ai[74]=0,Pi[96]=Pi[74]=1,Ni[24]=Ni[146]=0,ki[24]=ki[146]=-1,Fi[24]=Fi[146]=1,$i[24]=$i[146]=1,qi[24]=qi[146]=0,Hi[24]=Hi[146]=1,Vi[24]=Vi[146]=0,ji[24]=ji[146]=1,Gi[24]=Gi[146]=1,Ri[24]=Ri[146]=0,Li[24]=Li[146]=-1,Oi[24]=Oi[146]=0,Bi[6]=Bi[164]=-1,zi[6]=zi[164]=0,Ui[6]=Ui[164]=1,$i[6]=$i[164]=-1,qi[6]=qi[164]=0,Hi[6]=Hi[164]=0,Yi[6]=Yi[164]=0,Ki[6]=Ki[164]=-1,Ji[6]=Ji[164]=1,Wi[6]=Wi[164]=1,Xi[6]=Xi[164]=0,Zi[6]=Zi[164]=0,Vi[129]=Vi[41]=0,ji[129]=ji[41]=1,Gi[129]=Gi[41]=1,Yi[129]=Yi[41]=0,Ki[129]=Ki[41]=1,Ji[129]=Ji[41]=0,Di[129]=Di[41]=-1,Ai[129]=Ai[41]=0,Pi[129]=Pi[41]=0,Ri[129]=Ri[41]=0,Li[129]=Li[41]=-1,Oi[129]=Oi[41]=0,$i[66]=$i[104]=0,qi[66]=qi[104]=1,Hi[66]=Hi[104]=0,Vi[66]=Vi[104]=-1,ji[66]=ji[104]=0,Gi[66]=Gi[104]=1,Wi[66]=Wi[104]=0,Xi[66]=Xi[104]=-1,Zi[66]=Zi[104]=0,Di[66]=Di[104]=0,Ai[66]=Ai[104]=-1,Pi[66]=Pi[104]=1,Ni[144]=Ni[26]=-1,ki[144]=ki[26]=0,Fi[144]=Fi[26]=0,Yi[144]=Yi[26]=1,Ki[144]=Ki[26]=0,Ji[144]=Ji[26]=1,Wi[144]=Wi[26]=0,Xi[144]=Xi[26]=1,Zi[144]=Zi[26]=1,Ri[144]=Ri[26]=-1,Li[144]=Li[26]=0,Oi[144]=Oi[26]=1,Bi[36]=Bi[134]=0,zi[36]=zi[134]=1,Ui[36]=Ui[134]=1,$i[36]=$i[134]=0,qi[36]=qi[134]=1,Hi[36]=Hi[134]=0,Di[36]=Di[134]=0,Ai[36]=Ai[134]=-1,Pi[36]=Pi[134]=1,Ri[36]=Ri[134]=1,Li[36]=Li[134]=0,Oi[36]=Oi[134]=0,Ni[9]=Ni[161]=-1,ki[9]=ki[161]=0,Fi[9]=Fi[161]=0,Bi[9]=Bi[161]=0,zi[9]=zi[161]=-1,Ui[9]=Ui[161]=0,Vi[9]=Vi[161]=1,ji[9]=ji[161]=0,Gi[9]=Gi[161]=0,Yi[9]=Yi[161]=1,Ki[9]=Ki[161]=0,Ji[9]=Ji[161]=1,Ni[136]=0,ki[136]=1,Fi[136]=1,Bi[136]=0,zi[136]=1,Ui[136]=0,$i[136]=-1,qi[136]=0,Hi[136]=1,Vi[136]=-1,ji[136]=0,Gi[136]=0,Yi[136]=0,Ki[136]=-1,Ji[136]=0,Wi[136]=0,Xi[136]=-1,Zi[136]=1,Di[136]=1,Ai[136]=0,Pi[136]=0,Ri[136]=1,Li[136]=0,Oi[136]=1,Ni[34]=0,ki[34]=-1,Fi[34]=0,Bi[34]=0,zi[34]=-1,Ui[34]=1,$i[34]=1,qi[34]=0,Hi[34]=0,Vi[34]=1,ji[34]=0,Gi[34]=1,Yi[34]=0,Ki[34]=1,Ji[34]=1,Wi[34]=0,Xi[34]=1,Zi[34]=0,Di[34]=-1,Ai[34]=0,Pi[34]=1,Ri[34]=-1,Li[34]=0,Oi[34]=0,Ni[35]=0,ki[35]=1,Fi[35]=1,Bi[35]=0,zi[35]=-1,Ui[35]=1,$i[35]=1,qi[35]=0,Hi[35]=0,Vi[35]=-1,ji[35]=0,Gi[35]=0,Yi[35]=0,Ki[35]=-1,Ji[35]=0,Wi[35]=0,Xi[35]=1,Zi[35]=0,Di[35]=-1,Ai[35]=0,Pi[35]=1,Ri[35]=1,Li[35]=0,Oi[35]=1,Ni[153]=0,ki[153]=1,Fi[153]=1,Vi[153]=-1,ji[153]=0,Gi[153]=0,Yi[153]=0,Ki[153]=-1,Ji[153]=0,Ri[153]=1,Li[153]=0,Oi[153]=1,Bi[102]=0,zi[102]=-1,Ui[102]=1,$i[102]=1,qi[102]=0,Hi[102]=0,Wi[102]=0,Xi[102]=1,Zi[102]=0,Di[102]=-1,Ai[102]=0,Pi[102]=1,Ni[155]=0,ki[155]=-1,Fi[155]=0,Vi[155]=1,ji[155]=0,Gi[155]=1,Yi[155]=0,Ki[155]=1,Ji[155]=1,Ri[155]=-1,Li[155]=0,Oi[155]=0,Bi[103]=0,zi[103]=1,Ui[103]=0,$i[103]=-1,qi[103]=0,Hi[103]=1,Wi[103]=0,Xi[103]=-1,Zi[103]=1,Di[103]=1,Ai[103]=0,Pi[103]=0,Ni[152]=0,ki[152]=1,Fi[152]=1,$i[152]=-1,qi[152]=0,Hi[152]=1,Vi[152]=-1,ji[152]=0,Gi[152]=0,Yi[152]=0,Ki[152]=-1,Ji[152]=0,Wi[152]=0,Xi[152]=-1,Zi[152]=1,Ri[152]=1,Li[152]=0,Oi[152]=1,Ni[156]=0,ki[156]=-1,Fi[156]=1,$i[156]=1,qi[156]=0,Hi[156]=1,Vi[156]=-1,ji[156]=0,Gi[156]=0,Yi[156]=0,Ki[156]=-1,Ji[156]=0,Wi[156]=0,Xi[156]=1,Zi[156]=1,Ri[156]=-1,Li[156]=0,Oi[156]=1,Ni[137]=0,ki[137]=1,Fi[137]=1,Bi[137]=0,zi[137]=1,Ui[137]=0,Vi[137]=-1,ji[137]=0,Gi[137]=0,Yi[137]=0,Ki[137]=-1,Ji[137]=0,Di[137]=1,Ai[137]=0,Pi[137]=0,Ri[137]=1,Li[137]=0,Oi[137]=1,Ni[139]=0,ki[139]=1,Fi[139]=1,Bi[139]=0,zi[139]=-1,Ui[139]=0,Vi[139]=1,ji[139]=0,Gi[139]=0,Yi[139]=0,Ki[139]=1,Ji[139]=0,Di[139]=-1,Ai[139]=0,Pi[139]=0,Ri[139]=1,Li[139]=0,Oi[139]=1,Ni[98]=0,ki[98]=-1,Fi[98]=0,Bi[98]=0,zi[98]=-1,Ui[98]=1,$i[98]=1,qi[98]=0,Hi[98]=0,Vi[98]=1,ji[98]=0,Gi[98]=1,Wi[98]=0,Xi[98]=1,Zi[98]=0,Di[98]=-1,Ai[98]=0,Pi[98]=1,Ni[99]=0,ki[99]=1,Fi[99]=0,Bi[99]=0,zi[99]=-1,Ui[99]=1,$i[99]=1,qi[99]=0,Hi[99]=0,Vi[99]=-1,ji[99]=0,Gi[99]=1,Wi[99]=0,Xi[99]=-1,Zi[99]=0,Di[99]=1,Ai[99]=0,Pi[99]=1,Bi[38]=0,zi[38]=-1,Ui[38]=1,$i[38]=1,qi[38]=0,Hi[38]=0,Yi[38]=0,Ki[38]=1,Ji[38]=1,Wi[38]=0,Xi[38]=1,Zi[38]=0,Di[38]=-1,Ai[38]=0,Pi[38]=1,Ri[38]=-1,Li[38]=0,Oi[38]=0,Bi[39]=0,zi[39]=1,Ui[39]=1,$i[39]=-1,qi[39]=0,Hi[39]=0,Yi[39]=0,Ki[39]=-1,Ji[39]=1,Wi[39]=0,Xi[39]=1,Zi[39]=0,Di[39]=-1,Ai[39]=0,Pi[39]=1,Ri[39]=1,Li[39]=0,Oi[39]=0;var lC=function(e){return[[e.bottomleft,0],[0,0],[0,e.leftbottom]]},cC=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0]]},hC=function(e){return[[e.topright,1],[1,1],[1,e.righttop]]},fC=function(e){return[[0,e.lefttop],[0,1],[e.topleft,1]]},dC=function(e){return[[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop]]},pC=function(e){return[[e.bottomright,0],[e.bottomleft,0],[1,e.righttop],[1,e.rightbottom]]},gC=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.topleft,1],[e.topright,1]]},mC=function(e){return[[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},er=[],Zn=[],wr=[],gr=[],qr=[],Br=[],Qi=[],ro=[];gr[1]=qr[1]=18,gr[169]=qr[169]=18,wr[4]=Zn[4]=12,wr[166]=Zn[166]=12,er[16]=ro[16]=4,er[154]=ro[154]=4,Br[64]=Qi[64]=22,Br[106]=Qi[106]=22,wr[2]=Br[2]=17,gr[2]=qr[2]=18,wr[168]=Br[168]=17,gr[168]=qr[168]=18,er[8]=gr[8]=9,Zn[8]=wr[8]=12,er[162]=gr[162]=9,Zn[162]=wr[162]=12,er[32]=ro[32]=4,Zn[32]=Qi[32]=1,er[138]=ro[138]=4,Zn[138]=Qi[138]=1,qr[128]=ro[128]=21,Br[128]=Qi[128]=22,qr[42]=ro[42]=21,Br[42]=Qi[42]=22,Zn[5]=qr[5]=14,Zn[165]=qr[165]=14,wr[20]=ro[20]=6,wr[150]=ro[150]=6,er[80]=Br[80]=11,er[90]=Br[90]=11,gr[65]=Qi[65]=3,gr[105]=Qi[105]=3,er[160]=Br[160]=11,Zn[160]=qr[160]=14,er[10]=Br[10]=11,Zn[10]=qr[10]=14,wr[130]=ro[130]=6,gr[130]=Qi[130]=3,wr[40]=ro[40]=6,gr[40]=Qi[40]=3,Zn[101]=Qi[101]=1,Zn[69]=Qi[69]=1,qr[149]=ro[149]=21,qr[21]=ro[21]=21,wr[86]=Br[86]=17,wr[84]=Br[84]=17,er[89]=gr[89]=9,er[81]=gr[81]=9,er[96]=Qi[96]=0,Zn[96]=Br[96]=15,er[74]=Qi[74]=0,Zn[74]=Br[74]=15,er[24]=wr[24]=8,gr[24]=ro[24]=7,er[146]=wr[146]=8,gr[146]=ro[146]=7,Zn[6]=Br[6]=15,wr[6]=qr[6]=16,Zn[164]=Br[164]=15,wr[164]=qr[164]=16,gr[129]=ro[129]=7,qr[129]=Qi[129]=20,gr[41]=ro[41]=7,qr[41]=Qi[41]=20,wr[66]=Qi[66]=2,gr[66]=Br[66]=19,wr[104]=Qi[104]=2,gr[104]=Br[104]=19,er[144]=qr[144]=10,Br[144]=ro[144]=23,er[26]=qr[26]=10,Br[26]=ro[26]=23,Zn[36]=ro[36]=5,wr[36]=Qi[36]=2,Zn[134]=ro[134]=5,wr[134]=Qi[134]=2,er[9]=qr[9]=10,Zn[9]=gr[9]=13,er[161]=qr[161]=10,Zn[161]=gr[161]=13,Zn[37]=ro[37]=5,qr[37]=Qi[37]=20,Zn[133]=ro[133]=5,qr[133]=Qi[133]=20,wr[148]=qr[148]=16,Br[148]=ro[148]=23,wr[22]=qr[22]=16,Br[22]=ro[22]=23,er[82]=wr[82]=8,gr[82]=Br[82]=19,er[88]=wr[88]=8,gr[88]=Br[88]=19,er[73]=Qi[73]=0,Zn[73]=gr[73]=13,er[97]=Qi[97]=0,Zn[97]=gr[97]=13,er[145]=gr[145]=9,qr[145]=ro[145]=21,er[25]=gr[25]=9,qr[25]=ro[25]=21,Zn[70]=Qi[70]=1,wr[70]=Br[70]=17,Zn[100]=Qi[100]=1,wr[100]=Br[100]=17,er[34]=gr[34]=9,Zn[34]=wr[34]=12,qr[34]=ro[34]=21,Br[34]=Qi[34]=22,er[136]=ro[136]=4,Zn[136]=Qi[136]=1,wr[136]=Br[136]=17,gr[136]=qr[136]=18,er[35]=ro[35]=4,Zn[35]=wr[35]=12,gr[35]=qr[35]=18,Br[35]=Qi[35]=22,er[153]=ro[153]=4,gr[153]=qr[153]=18,Zn[102]=wr[102]=12,Br[102]=Qi[102]=22,er[155]=gr[155]=9,qr[155]=ro[155]=23,Zn[103]=Qi[103]=1,wr[103]=Br[103]=17,er[152]=ro[152]=4,wr[152]=Br[152]=17,gr[152]=qr[152]=18,er[156]=wr[156]=8,gr[156]=qr[156]=18,Br[156]=ro[156]=23,er[137]=ro[137]=4,Zn[137]=Qi[137]=1,gr[137]=qr[137]=18,er[139]=ro[139]=4,Zn[139]=gr[139]=13,qr[139]=Qi[139]=20,er[98]=gr[98]=9,Zn[98]=wr[98]=12,Br[98]=Qi[98]=22,er[99]=Qi[99]=0,Zn[99]=wr[99]=12,gr[99]=Br[99]=19,Zn[38]=wr[38]=12,qr[38]=ro[38]=21,Br[38]=Qi[38]=22,Zn[39]=ro[39]=5,wr[39]=qr[39]=16,Br[39]=Qi[39]=22;var Gn=[];function vC(e,t,n){return function rV(e){return(e>0)-(e<0)||+e}((t[0]-e[0])*(n[1]-t[1])-(n[0]-t[0])*(t[1]-e[1]))}function UP(e,t){return t.geometry.coordinates[0].every(function(n){return tP(Y1(n),e)})}Gn[1]=Gn[169]=lC,Gn[4]=Gn[166]=cC,Gn[16]=Gn[154]=hC,Gn[64]=Gn[106]=fC,Gn[168]=Gn[2]=dC,Gn[162]=Gn[8]=pC,Gn[138]=Gn[32]=gC,Gn[42]=Gn[128]=mC,Gn[5]=Gn[165]=function(e){return[[0,0],[0,e.leftbottom],[1,e.rightbottom],[1,0]]},Gn[20]=Gn[150]=function(e){return[[1,0],[e.bottomright,0],[e.topright,1],[1,1]]},Gn[80]=Gn[90]=function(e){return[[1,1],[1,e.righttop],[0,e.lefttop],[0,1]]},Gn[65]=Gn[105]=function(e){return[[e.bottomleft,0],[0,0],[0,1],[e.topleft,1]]},Gn[160]=Gn[10]=function(e){return[[1,e.righttop],[1,e.rightbottom],[0,e.leftbottom],[0,e.lefttop]]},Gn[130]=Gn[40]=function(e){return[[e.topleft,1],[e.topright,1],[e.bottomright,0],[e.bottomleft,0]]},Gn[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},Gn[101]=Gn[69]=function(e){return[[1,e.rightbottom],[1,0],[0,0],[0,1],[e.topleft,1]]},Gn[149]=Gn[21]=function(e){return[[e.topright,1],[1,1],[1,0],[0,0],[0,e.leftbottom]]},Gn[86]=Gn[84]=function(e){return[[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[1,1]]},Gn[89]=Gn[81]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,1]]},Gn[96]=Gn[74]=function(e){return[[1,e.righttop],[1,e.rightbottom],[0,e.lefttop],[0,1],[e.topleft,1]]},Gn[24]=Gn[146]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[e.topright,1]]},Gn[6]=Gn[164]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop]]},Gn[129]=Gn[41]=function(e){return[[e.topright,1],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topleft,1]]},Gn[66]=Gn[104]=function(e){return[[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1],[e.topleft,1]]},Gn[144]=Gn[26]=function(e){return[[1,1],[1,e.righttop],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},Gn[36]=Gn[134]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[e.topleft,1],[e.topright,1]]},Gn[9]=Gn[161]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,e.leftbottom]]},Gn[37]=Gn[133]=function(e){return[[1,e.rightbottom],[1,0],[0,0],[0,e.leftbottom],[e.topleft,1],[e.topright,1]]},Gn[148]=Gn[22]=function(e){return[[1,1],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},Gn[82]=Gn[88]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1]]},Gn[73]=Gn[97]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,1],[e.topleft,1]]},Gn[145]=Gn[25]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topright,1]]},Gn[70]=Gn[100]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[e.topleft,1]]},Gn[34]=function(e){return[mC(e),pC(e)]},Gn[35]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},Gn[136]=function(e){return[gC(e),dC(e)]},Gn[153]=function(e){return[hC(e),lC(e)]},Gn[102]=function(e){return[cC(e),fC(e)]},Gn[155]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topright,1]]},Gn[103]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[e.topleft,1]]},Gn[152]=function(e){return[hC(e),dC(e)]},Gn[156]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},Gn[137]=function(e){return[gC(e),lC(e)]},Gn[139]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topleft,1],[e.topright,1]]},Gn[98]=function(e){return[pC(e),fC(e)]},Gn[99]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1],[e.topleft,1]]},Gn[38]=function(e){return[cC(e),mC(e)]},Gn[39]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]};const VP=function(){function e(t){this.id=e.buildId(t),this.coordinates=t,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return e.buildId=function(t){return t.join(",")},e.prototype.removeInnerEdge=function(t){this.innerEdges=this.innerEdges.filter(function(n){return n.from.id!==t.from.id})},e.prototype.removeOuterEdge=function(t){this.outerEdges=this.outerEdges.filter(function(n){return n.to.id!==t.to.id})},e.prototype.addOuterEdge=function(t){this.outerEdges.push(t),this.outerEdgesSorted=!1},e.prototype.sortOuterEdges=function(){var t=this;this.outerEdgesSorted||(this.outerEdges.sort(function(n,r){var o=n.to,c=r.to;if(o.coordinates[0]-t.coordinates[0]>=0&&c.coordinates[0]-t.coordinates[0]<0)return 1;if(o.coordinates[0]-t.coordinates[0]<0&&c.coordinates[0]-t.coordinates[0]>=0)return-1;if(o.coordinates[0]-t.coordinates[0]==0&&c.coordinates[0]-t.coordinates[0]==0)return o.coordinates[1]-t.coordinates[1]>=0||c.coordinates[1]-t.coordinates[1]>=0?o.coordinates[1]-c.coordinates[1]:c.coordinates[1]-o.coordinates[1];var d=vC(t.coordinates,o.coordinates,c.coordinates);return d<0?1:d>0?-1:Math.pow(o.coordinates[0]-t.coordinates[0],2)+Math.pow(o.coordinates[1]-t.coordinates[1],2)-(Math.pow(c.coordinates[0]-t.coordinates[0],2)+Math.pow(c.coordinates[1]-t.coordinates[1],2))}),this.outerEdgesSorted=!0)},e.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},e.prototype.getOuterEdge=function(t){return this.sortOuterEdges(),this.outerEdges[t]},e.prototype.addInnerEdge=function(t){this.innerEdges.push(t)},e}(),uV=function(){function e(t,n){this.from=t,this.to=n,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return e.prototype.getSymetric=function(){return this.symetric||(this.symetric=new e(this.to,this.from),this.symetric.symetric=this),this.symetric},e.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},e.prototype.isEqual=function(t){return this.from.id===t.from.id&&this.to.id===t.to.id},e.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},e.prototype.toLineString=function(){return function HE(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return Qf({type:"LineString",coordinates:e},t,n)}([this.from.coordinates,this.to.coordinates])},e.prototype.compareTo=function(t){return vC(t.from.coordinates,t.to.coordinates,this.to.coordinates)},e}(),cV=function(){function e(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return e.prototype.push=function(t){this.edges.push(t),this.polygon=this.envelope=void 0},e.prototype.get=function(t){return this.edges[t]},Object.defineProperty(e.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),e.prototype.forEach=function(t){this.edges.forEach(t)},e.prototype.map=function(t){return this.edges.map(t)},e.prototype.some=function(t){return this.edges.some(t)},e.prototype.isValid=function(){return!0},e.prototype.isHole=function(){var t=this,n=this.edges.reduce(function(d,_,b){return _.from.coordinates[1]>t.edges[d].from.coordinates[1]&&(d=b),d},0),r=(0===n?this.length:n)-1,o=(n+1)%this.length,c=vC(this.edges[r].from.coordinates,this.edges[n].from.coordinates,this.edges[o].from.coordinates);return 0===c?this.edges[r].from.coordinates[0]>this.edges[o].from.coordinates[0]:c>0},e.prototype.toMultiPoint=function(){return function XA(e,t,n){return void 0===n&&(n={}),Qf({type:"MultiPoint",coordinates:e},t,n)}(this.edges.map(function(t){return t.from.coordinates}))},e.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var t=this.edges.map(function(n){return n.from.coordinates});return t.push(this.edges[0].from.coordinates),this.polygon=K1([t])},e.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=function _U(e){return function yU(e,t){void 0===t&&(t={});var n=Number(e[0]),r=Number(e[1]),o=Number(e[2]),c=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var d=[n,r];return K1([[d,[o,r],[o,c],[n,c],d]],t.properties,{bbox:e,id:t.id})}(B5(e))}(this.toPolygon())},e.findEdgeRingContaining=function(t,n){var o,c,r=t.getEnvelope();return n.forEach(function(d){var _=d.getEnvelope();if(c&&(o=c.getEnvelope()),!function iV(e,t){var n=e.geometry.coordinates[0].map(function(d){return d[0]}),r=e.geometry.coordinates[0].map(function(d){return d[1]}),o=t.geometry.coordinates[0].map(function(d){return d[0]}),c=t.geometry.coordinates[0].map(function(d){return d[1]});return Math.max.apply(null,n)===Math.max.apply(null,o)&&Math.max.apply(null,r)===Math.max.apply(null,c)&&Math.min.apply(null,n)===Math.min.apply(null,o)&&Math.min.apply(null,r)===Math.min.apply(null,c)}(_,r)&&UP(_,r)){for(var b=t.map(function(le){return le.from.coordinates}),C=void 0,D=function(le){d.some(function(se){return function oV(e,t){return e[0]===t[0]&&e[1]===t[1]}(le,se.from.coordinates)})||(C=le)},P=0,N=b;P<N.length;P++)D(N[P]);C&&d.inside(Y1(C))&&(!c||UP(o,_))&&(c=d)}}),c},e.prototype.inside=function(t){return tP(t,this.toPolygon())},e}();function YP(e){for(var t=e,n=[];t.parent;)n.unshift(t),t=t.parent;return n}!function(){function e(){this.edges=[],this.nodes={}}e.fromGeoJson=function(t){!function hV(e){if(!e)throw new Error("No geojson passed");if("FeatureCollection"!==e.type&&"GeometryCollection"!==e.type&&"MultiLineString"!==e.type&&"LineString"!==e.type&&"Feature"!==e.type)throw new Error("Invalid input type '"+e.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(t);var n=new e;return Q1(t,function(r){(function U5(e,t,n){if(!e)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!e||"Feature"!==e.type||!e.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+e.geometry.type)})(r,"LineString","Graph::fromGeoJson"),function L5(e,t,n,r){var o=n;hv(e,function(c,d,_,b,C){o=0===d&&void 0===n?c:t(o,c,d,_,b,C)},r)}(r,function(o,c){if(o){var d=n.getNode(o),_=n.getNode(c);n.addEdge(d,_)}return c})}),n},e.prototype.getNode=function(t){var n=VP.buildId(t),r=this.nodes[n];return r||(r=this.nodes[n]=new VP(t)),r},e.prototype.addEdge=function(t,n){var r=new uV(t,n),o=r.getSymetric();this.edges.push(r),this.edges.push(o)},e.prototype.deleteDangles=function(){var t=this;Object.keys(this.nodes).map(function(n){return t.nodes[n]}).forEach(function(n){return t._removeIfDangle(n)})},e.prototype._removeIfDangle=function(t){var n=this;if(t.innerEdges.length<=1){var r=t.getOuterEdges().map(function(o){return o.to});this.removeNode(t),r.forEach(function(o){return n._removeIfDangle(o)})}},e.prototype.deleteCutEdges=function(){var t=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(n){n.label===n.symetric.label&&(t.removeEdge(n.symetric),t.removeEdge(n))})},e.prototype._computeNextCWEdges=function(t){var n=this;typeof t>"u"?Object.keys(this.nodes).forEach(function(r){return n._computeNextCWEdges(n.nodes[r])}):t.getOuterEdges().forEach(function(r,o){t.getOuterEdge((0===o?t.getOuterEdges().length:o)-1).symetric.next=r})},e.prototype._computeNextCCWEdges=function(t,n){for(var o,c,r=t.getOuterEdges(),d=r.length-1;d>=0;--d){var _=r[d],b=_.symetric,C=void 0,D=void 0;_.label===n&&(C=_),b.label===n&&(D=b),C&&D&&(D&&(c=D),C&&(c&&(c.next=C,c=void 0),o||(o=C)))}c&&(c.next=o)},e.prototype._findLabeledEdgeRings=function(){var t=[],n=0;return this.edges.forEach(function(r){if(!(r.label>=0)){t.push(r);var o=r;do{o.label=n,o=o.next}while(!r.isEqual(o));n++}}),t},e.prototype.getEdgeRings=function(){var t=this;this._computeNextCWEdges(),this.edges.forEach(function(r){r.label=void 0}),this._findLabeledEdgeRings().forEach(function(r){t._findIntersectionNodes(r).forEach(function(o){t._computeNextCCWEdges(o,r.label)})});var n=[];return this.edges.forEach(function(r){r.ring||n.push(t._findEdgeRing(r))}),n},e.prototype._findIntersectionNodes=function(t){var n=[],r=t,o=function(){var c=0;r.from.getOuterEdges().forEach(function(d){d.label===t.label&&++c}),c>1&&n.push(r.from),r=r.next};do{o()}while(!t.isEqual(r));return n},e.prototype._findEdgeRing=function(t){var n=t,r=new cV;do{r.push(n),n.ring=r,n=n.next}while(!t.isEqual(n));return r},e.prototype.removeNode=function(t){var n=this;t.getOuterEdges().forEach(function(r){return n.removeEdge(r)}),t.innerEdges.forEach(function(r){return n.removeEdge(r)}),delete this.nodes[t.id]},e.prototype.removeEdge=function(t){this.edges=this.edges.filter(function(n){return!n.isEqual(t)}),t.deleteEdge()}}(),pe(5013),pe(7470),pe(9475);var sx={search:function(e,t,n,r){e.cleanDirty();var o=(r=r||{}).heuristic||sx.heuristics.manhattan,c=r.closest||!1,d=function TV(){return new KP(function(e){return e.f})}(),_=t;for(t.h=o(t,n),d.push(t);d.size()>0;){var b=d.pop();if(b===n)return YP(b);b.closed=!0;for(var C=e.neighbors(b),D=0,P=C.length;D<P;++D){var N=C[D];if(!N.closed&&!N.isWall()){var B=b.g+N.getCost(b),le=N.visited;(!le||B<N.g)&&(N.visited=!0,N.parent=b,N.h=N.h||o(N,n),N.g=B,N.f=N.g+N.h,e.markDirty(N),c&&(N.h<_.h||N.h===_.h&&N.g<_.g)&&(_=N),le?d.rescoreElement(N):d.push(N))}}}return c?YP(_):[]},heuristics:{manhattan:function(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},diagonal:function(e,t){var r=Math.sqrt(2),o=Math.abs(t.x-e.x),c=Math.abs(t.y-e.y);return 1*(o+c)+(r-2)*Math.min(o,c)}},cleanNode:function(e){e.f=0,e.g=0,e.h=0,e.visited=!1,e.closed=!1,e.parent=null}};function km(e,t){t=t||{},this.nodes=[],this.diagonal=!!t.diagonal,this.grid=[];for(var n=0;n<e.length;n++){this.grid[n]=[];for(var r=0,o=e[n];r<o.length;r++){var c=new ax(n,r,o[r]);this.grid[n][r]=c,this.nodes.push(c)}}this.init()}function ax(e,t,n){this.x=e,this.y=t,this.weight=n}function KP(e){this.content=[],this.scoreFunction=e}function wC(){this._=null}function ux(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function mv(e,t){var n=t,r=t.R,o=n.U;o?o.L===n?o.L=r:o.R=r:e._=r,r.U=o,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function yv(e,t){var n=t,r=t.L,o=n.U;o?o.L===n?o.L=r:o.R=r:e._=r,r.U=o,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function JP(e){for(;e.L;)e=e.L;return e}km.prototype.init=function(){this.dirtyNodes=[];for(var e=0;e<this.nodes.length;e++)sx.cleanNode(this.nodes[e])},km.prototype.cleanDirty=function(){for(var e=0;e<this.dirtyNodes.length;e++)sx.cleanNode(this.dirtyNodes[e]);this.dirtyNodes=[]},km.prototype.markDirty=function(e){this.dirtyNodes.push(e)},km.prototype.neighbors=function(e){var t=[],n=e.x,r=e.y,o=this.grid;return o[n-1]&&o[n-1][r]&&t.push(o[n-1][r]),o[n+1]&&o[n+1][r]&&t.push(o[n+1][r]),o[n]&&o[n][r-1]&&t.push(o[n][r-1]),o[n]&&o[n][r+1]&&t.push(o[n][r+1]),this.diagonal&&(o[n-1]&&o[n-1][r-1]&&t.push(o[n-1][r-1]),o[n+1]&&o[n+1][r-1]&&t.push(o[n+1][r-1]),o[n-1]&&o[n-1][r+1]&&t.push(o[n-1][r+1]),o[n+1]&&o[n+1][r+1]&&t.push(o[n+1][r+1])),t},km.prototype.toString=function(){for(var n,r,o,c,e=[],t=this.grid,d=0,_=t.length;d<_;d++){for(n=[],o=0,c=(r=t[d]).length;o<c;o++)n.push(r[o].weight);e.push(n.join(" "))}return e.join("\n")},ax.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},ax.prototype.getCost=function(e){return e&&e.x!==this.x&&e.y!==this.y?1.41421*this.weight:this.weight},ax.prototype.isWall=function(){return 0===this.weight},KP.prototype={push:function(e){this.content.push(e),this.sinkDown(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e},remove:function(e){var t=this.content.indexOf(e),n=this.content.pop();t!==this.content.length-1&&(this.content[t]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))},size:function(){return this.content.length},rescoreElement:function(e){this.sinkDown(this.content.indexOf(e))},sinkDown:function(e){for(var t=this.content[e];e>0;){var n=(e+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[n]=t,this.content[e]=r,e=n}},bubbleUp:function(e){for(var t=this.content.length,n=this.content[e],r=this.scoreFunction(n);;){var _,o=e+1<<1,c=o-1,d=null;if(c<t&&(_=this.scoreFunction(this.content[c]))<r&&(d=c),o<t&&this.scoreFunction(this.content[o])<(null===d?r:_)&&(d=o),null===d)break;this.content[e]=this.content[d],this.content[d]=n,e=d}}},wC.prototype={constructor:wC,insert:function(e,t){var n,r,o;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=JP(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)n===(r=n.U).L?(o=r.R)&&o.C?(n.C=o.C=!1,r.C=!0,e=r):(e===n.R&&(mv(this,n),n=(e=n).U),n.C=!1,r.C=!0,yv(this,r)):(o=r.L)&&o.C?(n.C=o.C=!1,r.C=!0,e=r):(e===n.L&&(yv(this,n),n=(e=n).U),n.C=!1,r.C=!0,mv(this,r)),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var n,c,d,t=e.U,r=e.L,o=e.R;if(c=r?o?JP(o):r:o,t?t.L===e?t.L=c:t.R=c:this._=c,r&&o?(d=c.C,c.C=e.C,c.L=r,r.U=c,c!==o?(t=c.U,c.U=e.U,t.L=e=c.R,c.R=o,o.U=c):(c.U=t,t=c,e=c.R)):(d=e.C,e=c),e&&(e.U=t),!d){if(e&&e.C)return void(e.C=!1);do{if(e===this._)break;if(e===t.L){if((n=t.R).C&&(n.C=!1,t.C=!0,mv(this,t),n=t.R),n.L&&n.L.C||n.R&&n.R.C){(!n.R||!n.R.C)&&(n.L.C=!1,n.C=!0,yv(this,n),n=t.R),n.C=t.C,t.C=n.R.C=!1,mv(this,t),e=this._;break}}else if((n=t.L).C&&(n.C=!1,t.C=!0,yv(this,t),n=t.L),n.L&&n.L.C||n.R&&n.R.C){(!n.L||!n.L.C)&&(n.R.C=!1,n.C=!0,mv(this,n),n=t.L),n.C=t.C,t.C=n.L.C=!1,yv(this,t),e=this._;break}n.C=!0,e=t,t=t.U}while(!e.C);e&&(e.C=!1)}}};const QP=wC;function _v(e,t,n,r){var o=[null,null],c=El.push(o)-1;return o.left=e,o.right=t,n&&lx(o,e,t,n),r&&lx(o,t,e,r),Tc[e.index].halfedges.push(c),Tc[t.index].halfedges.push(c),o}function vv(e,t,n){var r=[t,n];return r.left=e,r}function lx(e,t,n,r){e[0]||e[1]?e.left===n?e[1]=r:e[0]=r:(e[0]=r,e.left=t,e.right=n)}function DV(e,t,n,r,o){var se,c=e[0],d=e[1],_=c[0],b=c[1],P=0,N=1,B=d[0]-_,le=d[1]-b;if(se=t-_,B||!(se>0)){if(se/=B,B<0){if(se<P)return;se<N&&(N=se)}else if(B>0){if(se>N)return;se>P&&(P=se)}if(se=r-_,B||!(se<0)){if(se/=B,B<0){if(se>N)return;se>P&&(P=se)}else if(B>0){if(se<P)return;se<N&&(N=se)}if(se=n-b,le||!(se>0)){if(se/=le,le<0){if(se<P)return;se<N&&(N=se)}else if(le>0){if(se>N)return;se>P&&(P=se)}if(se=o-b,le||!(se<0)){if(se/=le,le<0){if(se>N)return;se>P&&(P=se)}else if(le>0){if(se<P)return;se<N&&(N=se)}return!(P>0)&&!(N<1)||(P>0&&(e[0]=[_+P*B,b+P*le]),N<1&&(e[1]=[_+N*B,b+N*le])),!0}}}}}function AV(e,t,n,r,o){var c=e[1];if(c)return!0;var se,Oe,d=e[0],_=e.left,b=e.right,C=_[0],D=_[1],P=b[0],N=b[1],B=(C+P)/2;if(N===D){if(B<t||B>=r)return;if(C>P){if(d){if(d[1]>=o)return}else d=[B,n];c=[B,o]}else{if(d){if(d[1]<n)return}else d=[B,o];c=[B,n]}}else if(Oe=(D+N)/2-(se=(C-P)/(N-D))*B,se<-1||se>1)if(C>P){if(d){if(d[1]>=o)return}else d=[(n-Oe)/se,n];c=[(o-Oe)/se,o]}else{if(d){if(d[1]<n)return}else d=[(o-Oe)/se,o];c=[(n-Oe)/se,n]}else if(D<N){if(d){if(d[0]>=r)return}else d=[t,se*t+Oe];c=[r,se*r+Oe]}else{if(d){if(d[0]<t)return}else d=[r,se*r+Oe];c=[t,se*t+Oe]}return e[0]=d,e[1]=c,!0}function LV(e,t){var n=e.site,r=t.left,o=t.right;return n===o&&(o=r,r=n),o?Math.atan2(o[1]-r[1],o[0]-r[0]):(n===r?(r=t[1],o=t[0]):(r=t[0],o=t[1]),Math.atan2(r[0]-o[0],o[1]-r[1]))}function e2(e,t){return t[+(t.left!==e.site)]}function OV(e,t){return t[+(t.left===e.site)]}var bC,t2=[];function FV(){ux(this),this.x=this.y=this.arc=this.site=this.cy=null}function Fm(e){var t=e.P,n=e.N;if(t&&n){var r=t.site,o=e.site,c=n.site;if(r!==c){var d=o[0],_=o[1],b=r[0]-d,C=r[1]-_,D=c[0]-d,P=c[1]-_,N=2*(b*P-C*D);if(!(N>=-jV)){var B=b*b+C*C,le=D*D+P*P,se=(P*B-C*le)/N,Oe=(b*le-D*B)/N,Se=t2.pop()||new FV;Se.arc=e,Se.site=o,Se.x=se+d,Se.y=(Se.cy=Oe+_)+Math.sqrt(se*se+Oe*Oe),e.circle=Se;for(var ae=null,Me=xv._;Me;)if(Se.y<Me.y||Se.y===Me.y&&Se.x<=Me.x){if(!Me.L){ae=Me.P;break}Me=Me.L}else{if(!Me.R){ae=Me;break}Me=Me.R}xv.insert(ae,Se),ae||(bC=Se)}}}}function Bm(e){var t=e.circle;t&&(t.P||(bC=t.N),xv.remove(t),t2.push(t),ux(t),e.circle=null)}var n2=[];function BV(){ux(this),this.edge=this.site=this.circle=null}function r2(e){var t=n2.pop()||new BV;return t.site=e,t}function EC(e){Bm(e),zm.remove(e),n2.push(e),ux(e)}function zV(e){var t=e.circle,n=t.x,r=t.cy,o=[n,r],c=e.P,d=e.N,_=[e];EC(e);for(var b=c;b.circle&&Math.abs(n-b.circle.x)<pa&&Math.abs(r-b.circle.cy)<pa;)c=b.P,_.unshift(b),EC(b),b=c;_.unshift(b),Bm(b);for(var C=d;C.circle&&Math.abs(n-C.circle.x)<pa&&Math.abs(r-C.circle.cy)<pa;)d=C.N,_.push(C),EC(C),C=d;_.push(C),Bm(C);var P,D=_.length;for(P=1;P<D;++P)lx((C=_[P]).edge,(b=_[P-1]).site,C.site,o);(C=_[D-1]).edge=_v((b=_[0]).site,C.site,null,o),Fm(b),Fm(C)}function UV(e){for(var r,o,c,d,t=e[0],n=e[1],_=zm._;_;)if((c=i2(_,n)-t)>pa)_=_.L;else{if(!((d=t-VV(_,n))>pa)){c>-pa?(r=_.P,o=_):d>-pa?(r=_,o=_.N):r=o=_;break}if(!_.R){r=_;break}_=_.R}!function RV(e){Tc[e.index]={site:e,halfedges:[]}}(e);var b=r2(e);if(zm.insert(r,b),r||o){if(r===o)return Bm(r),o=r2(r.site),zm.insert(b,o),b.edge=o.edge=_v(r.site,b.site),Fm(r),void Fm(o);if(!o)return void(b.edge=_v(r.site,b.site));Bm(r),Bm(o);var C=r.site,D=C[0],P=C[1],N=e[0]-D,B=e[1]-P,le=o.site,se=le[0]-D,Oe=le[1]-P,Se=2*(N*Oe-B*se),ae=N*N+B*B,Me=se*se+Oe*Oe,ot=[(Oe*ae-B*Me)/Se+D,(N*Me-se*ae)/Se+P];lx(o.edge,C,le,ot),b.edge=_v(C,e,null,ot),o.edge=_v(e,le,null,ot),Fm(r),Fm(o)}}function i2(e,t){var n=e.site,r=n[0],o=n[1],c=o-t;if(!c)return r;var d=e.P;if(!d)return-1/0;var _=(n=d.site)[0],b=n[1],C=b-t;if(!C)return _;var D=_-r,P=1/c-1/C,N=D/C;return P?(-N+Math.sqrt(N*N-2*P*(D*D/(-2*C)-b+C/2+o-c/2)))/P+r:(r+_)/2}function VV(e,t){var n=e.N;if(n)return i2(n,t);var r=e.site;return r[1]===t?r[0]:1/0}var zm,Tc,xv,El,pa=1e-6,jV=1e-12;function GV(e,t,n){return(e[0]-n[0])*(t[1]-e[1])-(e[0]-t[0])*(n[1]-e[1])}function $V(e,t){return t[1]-e[1]||t[0]-e[0]}function o2(e,t){var r,o,c,n=e.sort($V).pop();for(El=[],Tc=new Array(e.length),zm=new QP,xv=new QP;;)if(c=bC,n&&(!c||n[1]<c.y||n[1]===c.y&&n[0]<c.x))(n[0]!==r||n[1]!==o)&&(UV(n),r=n[0],o=n[1]),n=e.pop();else{if(!c)break;zV(c.arc)}if(function NV(){for(var n,r,o,c,e=0,t=Tc.length;e<t;++e)if((n=Tc[e])&&(c=(r=n.halfedges).length)){var d=new Array(c),_=new Array(c);for(o=0;o<c;++o)d[o]=o,_[o]=LV(n,El[r[o]]);for(d.sort(function(b,C){return _[C]-_[b]}),o=0;o<c;++o)_[o]=r[d[o]];for(o=0;o<c;++o)r[o]=_[o]}}(),t){var d=+t[0][0],_=+t[0][1],b=+t[1][0],C=+t[1][1];(function PV(e,t,n,r){for(var c,o=El.length;o--;)AV(c=El[o],e,t,n,r)&&DV(c,e,t,n,r)&&(Math.abs(c[0][0]-c[1][0])>pa||Math.abs(c[0][1]-c[1][1])>pa)||delete El[o]})(d,_,b,C),function kV(e,t,n,r){var c,d,_,b,C,D,P,N,B,le,se,Oe,o=Tc.length,Se=!0;for(c=0;c<o;++c)if(d=Tc[c]){for(_=d.site,b=(C=d.halfedges).length;b--;)El[C[b]]||C.splice(b,1);for(b=0,D=C.length;b<D;)se=(le=OV(d,El[C[b]]))[0],Oe=le[1],N=(P=e2(d,El[C[++b%D]]))[0],B=P[1],(Math.abs(se-N)>pa||Math.abs(Oe-B)>pa)&&(C.splice(b,0,El.push(vv(_,le,Math.abs(se-e)<pa&&r-Oe>pa?[e,Math.abs(N-e)<pa?B:r]:Math.abs(Oe-r)<pa&&n-se>pa?[Math.abs(B-r)<pa?N:n,r]:Math.abs(se-n)<pa&&Oe-t>pa?[n,Math.abs(N-n)<pa?B:t]:Math.abs(Oe-t)<pa&&se-e>pa?[Math.abs(B-t)<pa?N:e,t]:null))-1),++D);D&&(Se=!1)}if(Se){var ae,Me,ot,lt=1/0;for(c=0,Se=null;c<o;++c)(d=Tc[c])&&(ot=(ae=(_=d.site)[0]-e)*ae+(Me=_[1]-t)*Me)<lt&&(lt=ot,Se=d);if(Se){var Mt=[e,t],Pt=[e,r],qt=[n,r],st=[n,t];Se.halfedges.push(El.push(vv(_=Se.site,Mt,Pt))-1,El.push(vv(_,Pt,qt))-1,El.push(vv(_,qt,st))-1,El.push(vv(_,st,Mt))-1)}}for(c=0;c<o;++c)(d=Tc[c])&&(d.halfedges.length||delete Tc[c])}(d,_,b,C)}this.edges=El,this.cells=Tc,zm=xv=El=Tc=null}function ep(){return new cx}function cx(){this.reset()}o2.prototype={constructor:o2,polygons:function(){var e=this.edges;return this.cells.map(function(t){var n=t.halfedges.map(function(r){return e2(t,e[r])});return n.data=t.site.data,n})},triangles:function(){var e=[],t=this.edges;return this.cells.forEach(function(n,r){if(_=(c=n.halfedges).length)for(var c,_,b,o=n.site,d=-1,C=t[c[_-1]],D=C.left===o?C.right:C.left;++d<_;)b=D,D=(C=t[c[d]]).left===o?C.right:C.left,b&&D&&r<b.index&&r<D.index&&GV(o,b,D)<0&&e.push([o.data,b.data,D.data])}),e},links:function(){return this.edges.filter(function(e){return e.right}).map(function(e){return{source:e.left.data,target:e.right.data}})},find:function(e,t,n){for(var o,_,r=this,c=r._found||0,d=r.cells.length;!(_=r.cells[c]);)if(++c>=d)return null;var b=e-_.site[0],C=t-_.site[1],D=b*b+C*C;do{_=r.cells[o=c],c=null,_.halfedges.forEach(function(P){var N=r.edges[P],B=N.left;if(B!==_.site&&B||(B=N.right)){var le=e-B[0],se=t-B[1],Oe=le*le+se*se;Oe<D&&(D=Oe,c=B.index)}})}while(null!==c);return r._found=o,null==n||D<=n*n?_.site:null}},pe(9855),pe(770),cx.prototype={constructor:cx,reset:function(){this.s=this.t=0},add:function(e){m2(hx,e,this.t),m2(this,hx.s,this.s),this.s?this.t+=hx.t:this.s=hx.t},valueOf:function(){return this.s}};var hx=new cx;function m2(e,t,n){var r=e.s=t+n,o=r-t;e.t=t-(r-o)+(n-o)}var Ma=Math.PI,ac=Ma/2,Um=2*Ma,ea=Ma/180,wv=(Math,Math.atan),Vm=Math.atan2,$o=Math.cos,io=(Math,Math,Math,Math,Math,Math.sin),ed=(Math,Math.sqrt);Math;function jm(e){return e>1?ac:e<-1?-ac:Math.asin(e)}function FC(e,t){return[e>Ma?e-Um:e<-Ma?e+Um:e,t]}function G2(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}ep(),ep(),ep(),FC.invert=FC,function bj(e){1===e.length&&(e=function Ej(e){return function(t,n){return G2(e(t),n)}}(e))}(G2),Math.sqrt(50),Math.sqrt(10),Math.sqrt(2);ep();function nS(){}function gR(e){return function(t,n){var r=$o(t),o=$o(n),c=e(r*o);return[c*o*io(t),c*io(n)]}}function Pv(e){return function(t,n){var r=ed(t*t+n*n),o=e(r),c=io(o),d=$o(o);return[Vm(t*c,r*d),jm(r&&n*c/r)]}}function iS(e,t){return[e,t]}ep(),ep(),ep(),ep(),function fR(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}(4.5),nS.prototype={constructor:nS,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},$o(30*ea),function dR(e){return function(t){var n=new nS;for(var r in e)n[r]=e[r];return n.stream=t,n}}({point:function(e,t){this.stream.point(e*ea,t*ea)}}),gR(function(e){return ed(2/(1+e))}).invert=Pv(function(e){return 2*jm(e/2)}),gR(function(e){return(e=function ij(e){return e>1?0:e<-1?Ma:Math.acos(e)}(e))&&e/io(e)}).invert=Pv(function(e){return e}),iS.invert=iS,Pv(wv),Pv(jm),Pv(function(e){return 2*wv(e)});const m8=[{path:"",redirectTo:"/welcome",pathMatch:"full"},{path:"welcome",component:(()=>{class e{constructor(n){this.router=n}navigateToMap(){this.router.navigate(["/map"])}}return e.\u0275fac=function(n){return new(n||e)(Vr(Ic))},e.\u0275cmp=Ws({type:e,selectors:[["app-welcome"]],decls:8,vars:0,consts:[[1,"container"],["src","../../assets/luxoft-logo.png","alt","Luxoft Logo",1,"logo"],[3,"click"]],template:function(n,r){1&n&&(Fp(0,"div",0),ym(1,"img",1),Fp(2,"h1"),a1(3,"Welcome to the Automotive ACU Demo"),mm(),Fp(4,"p"),a1(5,"Our system provides comprehensive assistance to make your driving experience safer and more convenient."),mm(),Fp(6,"button",2),i1("click",function(){return r.navigateToMap()}),a1(7,"Proceed to Map"),mm()())},styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;font-family:Arial,sans-serif;background-color:#fff}h1[_ngcontent-%COMP%]{color:#0033a1;font-weight:600}p[_ngcontent-%COMP%]{color:#4d4d4d;max-width:600px;text-align:center}button[_ngcontent-%COMP%]{margin-top:20px;padding:10px 20px;background-color:#0033a1;color:#fff;border:none;border-radius:4px;cursor:pointer;transition:background-color .3s ease-in-out}button[_ngcontent-%COMP%]:hover{background-color:#0052cc}.logo[_ngcontent-%COMP%]{width:200px;margin-bottom:20px}"]}),e})()},{path:"map",component:(()=>{class e{constructor(){this.currentStepIndex=0,this.currentStepGeometryIndex=0,this.numDeltas=100,this.i=0,this.accessToken=D5_mapbox_accessToken,this.timeouts=[],this.startPoint=[],this.endPoint=[],this.animationReferences=[],this.recommendationCounter=0}ngOnInit(){this.map=new Qd.Map({accessToken:this.accessToken,container:"map",style:"mapbox://styles/mapbox/streets-v12",center:[31.233334,30.033333],zoom:12}),this.map.addControl(new Qd.NavigationControl({visualizePitch:!0}),"top-left");var n=new qA({accessToken:this.accessToken,mapboxgl:Qd,placeholder:"From: "}).on("result",c=>{this.startPoint=c.result.geometry.coordinates,null!=this.startPoint&&0!=this.startPoint.length&&null!=this.endPoint&&0!=this.endPoint.length&&this.getRoute(this.startPoint,this.endPoint)});this.map.addControl(n,"top-left");var r=new qA({accessToken:this.accessToken,mapboxgl:Qd,placeholder:"To: "}).on("result",c=>{this.endPoint=c.result.geometry.coordinates,null!=this.startPoint&&0!=this.startPoint.length&&null!=this.endPoint&&0!=this.endPoint.length&&this.getRoute(this.startPoint,this.endPoint)});this.map.addControl(r,"top-left"),new Qd.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0}).on("geolocate",c=>{console.log(Object.prototype.toString.call(c)+" "+c.coords.longitude+" "+c.coords.latitude)}),this.map.addControl(new Qd.ScaleControl,"bottom-right")}getRoute(n,r){var o=this;return function M5(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var c=e.apply(t,n);function d(b){$A(c,r,o,d,_,"next",b)}function _(b){$A(c,r,o,d,_,"throw",b)}d(void 0)})}}(function*(){o.mapClear(),yield fetch(`https://api.mapbox.com/directions/v5/mapbox/driving/${n[0]},${n[1]};${r[0]},${r[1]}?steps=true&geometries=geojson&annotations=distance,speed,duration&overview=full&continue_straight=false&notifications=none&roundabout_exits=false&access_token=${o.accessToken}`,{method:"GET"}).then(d=>d.json()).then(d=>{const b=(d=d.routes[0]).legs[0].annotation.speed;o.addRoute(d.geometry.coordinates,"route","#3887be");const C=d.legs[0].steps,D=new Set;for(let le of C)D.add(le.maneuver.type);console.log(D),o.settingMarker(d.geometry.coordinates[0]),o.map.zoomIn();var B=requestAnimationFrame(()=>{o.animateMarker2(C,b,1)});o.animationReferences.push(B)})})()}recommendationSystem(n,r,o){const c=n.maneuver.instruction;return r>o?`Slow speed down ..., ${c}`:r<o?`Speed  up ..., ${c}`:c}animateMarker(n,r,o,c){this.instructions=document.getElementById("instructions")||{};const d=r[n];if(d){let C=setTimeout(()=>{const D=c[this.currentStepIndex]?.geometry.coordinates,P=c[this.currentStepIndex]?.maneuver.modifier;this.marker.setLngLat(D[n]).addTo(this.map),this.map.jumpTo({center:[d[0],d[1]]}),++n===D.length&&(this.currentStepIndex++,n=0);const N=c[this.currentStepIndex]?.duration/3600|0,B=c[this.currentStepIndex]?.distance/1e3|0,le=c[this.currentStepIndex-1]?.duration/3600|0,ae=this.recommendationSystem(c[this.currentStepIndex],(c[this.currentStepIndex-1]?.distance/1e3|0)/le|0,B/N|0);this.currentStepIndex<c.length&&0===n&&this.popup.setHTML(`<div><span class="direction-guide-text">${ae}</span>  <i class="direction-guide-icon fas fa-arrow-${P}"></i> </div> <div class="centered-speed colored-speed">${c[this.currentStepIndex].speed_limit.toFixed(2)} km/h </div>`);let Me=requestAnimationFrame(()=>{this.animateMarker(n,D,o,c)});this.animationReferences.push(Me)},1e3/o[n]*3.6);this.timeouts.push(C)}}animateMarker2(n,r,o){let c=0,d=0;const _=()=>{if(c<n.length){const b=n[c].geometry.coordinates;if(this.marker.setLngLat(b[d]),this.map.jumpTo({center:[b[d][0],b[d][1]]}),d++,d===b.length&&(c++,d=0),c<n.length){const C=Number.isNaN(n[c].speed_limit??0)?0:n[c].speed_limit,D=n[c].duration/3600,P=n[c].distance/1e3,N=Number.isNaN(P/D)?C:P/D,B=n[c-1]?.duration/3600,le=n[c-1]?.distance/1e3,se=Number.isNaN(le/B)?C:le/B,Oe=this.extractArcs(n[c]?.maneuver.modifier,["right","left"]),Se=this.recommendationSystem(n[c],se,N);this.popup.setHTML(`<div><span class="direction-guide-text">${Se}</span> \n              <i class="direction-guide-icon fas fa-arrow-${Oe}"></i>\n              </div> <div class="centered-speed colored-speed">${(3.6*r[o-1]).toFixed(2)} km/h </div>`),console.log(`index: ${c}, point index: ${o}, instruction: ${n[c].maneuver.instruction}`),o++,setTimeout(_,1e3/r[o-1]*3.6*.8)}}};_()}animateMarker3(n,r){var o=n[r];if(this.marker.setLngLat(o),this.map.jumpTo({center:[o[0],o[1]]}),r<n.length-1){var _=rP(n[r],n[r+1]);setTimeout(()=>{this.animateMarker3(n,r+1)},1e3*_)}}searchLocation(n,r){var o=!1;for(let c=0;c<n.length;c++){const d=n[c];if(r&&(o=r.every(_=>d.maneuver.location.includes(_))),o)return c}return-1}settingMarker(n){const r=[n[0],n[1]],o=document.createElement("div");o.className="marker",this.popup=new Qd.Popup({closeButton:!1,closeOnClick:!1,offset:25,focusAfterOpen:!1}).setText("0 km/h"),this.marker=new Qd.Marker(o).setLngLat(r).setPopup(this.popup).addTo(this.map),this.marker.togglePopup()}mapClear(){null!=this.marker&&this.marker.remove(),this.clearAnimations(),this.map.getSource("route")&&(this.map.removeLayer("route"),this.map.removeSource("route"))}calculateDelay(n){return 3.6*n>=60?60:120}clearAnimations(){for(const n of this.timeouts)clearTimeout(n);for(const n of this.animationReferences)cancelAnimationFrame(n)}addRoute(n,r,o){this.map.getSource(r)?this.map.getSource(r).setData(n):this.map.addLayer({id:r,type:"line",source:{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:n}}},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":o,"line-width":8,"line-opacity":.8}})}extractArcs(n,r){if(!n)return null;var o="",c=0;for(const d of r){const _=n.indexOf(d);if(-1!==_&&(o=n.slice(_,_+d.length),1==++c)||1===c)break}return o}interpolateCoordinates(n){let r=[];for(let o=0;o<n.length-1;o++){let c=n[o],d=n[o+1],_=rP(c,d),b=Math.floor(10*_);for(let C=0;C<=b;C++){let D=C/b;r.push([c[0]+(d[0]-c[0])*D,c[1]+(d[1]-c[1])*D])}}return r}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Ws({type:e,selectors:[["app-map"]],decls:1,vars:0,consts:[["id","map"]],template:function(n,r){1&n&&ym(0,"div",0)},styles:["body[_ngcontent-%COMP%]{margin:0;padding:0}#map[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:100%}#instructions[_ngcontent-%COMP%]{position:absolute;margin:10px;width:20%;top:0;bottom:75%;padding:10px;background-color:#fff;font-family:sans-serif;right:1%}"]}),e})()}];let y8=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Kl({type:e}),e.\u0275inj=yu({imports:[jA.forRoot(m8),jA]}),e})(),_8=(()=>{class e{constructor(){this.title="map-app"}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Ws({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(n,r){1&n&&ym(0,"router-outlet")},dependencies:[kE]}),e})(),v8=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Kl({type:e,bootstrap:[_8]}),e.\u0275inj=yu({imports:[jB,y8]}),e})();UB().bootstrapModule(v8).catch(e=>console.error(e))},1503:(bt,Qe,pe)=>{"use strict";var de=pe(3269);function _e(p){var H=[1/0,1/0,-1/0,-1/0];return de.coordEach(p,function(fe){H[0]>fe[0]&&(H[0]=fe[0]),H[1]>fe[1]&&(H[1]=fe[1]),H[2]<fe[0]&&(H[2]=fe[0]),H[3]<fe[1]&&(H[3]=fe[1])}),H}_e.default=_e,Qe.Z=_e},8275:(bt,Qe)=>{"use strict";function pe(Ue,Ye,Ae){void 0===Ae&&(Ae={});var Wt={type:"Feature"};return(0===Ae.id||Ae.id)&&(Wt.id=Ae.id),Ae.bbox&&(Wt.bbox=Ae.bbox),Wt.properties=Ye||{},Wt.geometry=Ue,Wt}function de(Ue,Ye,Ae){if(void 0===Ae&&(Ae={}),!Ue)throw new Error("coordinates is required");if(!Array.isArray(Ue))throw new Error("coordinates must be an Array");if(Ue.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Z(Ue[0])||!Z(Ue[1]))throw new Error("coordinates must contain numbers");return pe({type:"Point",coordinates:Ue},Ye,Ae)}function p(Ue,Ye,Ae){void 0===Ae&&(Ae={});for(var Wt=0,At=Ue;Wt<At.length;Wt++){var De=At[Wt];if(De.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var pt=0;pt<De[De.length-1].length;pt++)if(De[De.length-1][pt]!==De[0][pt])throw new Error("First and last Position are not equivalent.")}return pe({type:"Polygon",coordinates:Ue},Ye,Ae)}function fe(Ue,Ye,Ae){if(void 0===Ae&&(Ae={}),Ue.length<2)throw new Error("coordinates must be an array of two or more positions");return pe({type:"LineString",coordinates:Ue},Ye,Ae)}function Ie(Ue,Ye){void 0===Ye&&(Ye={});var Ae={type:"FeatureCollection"};return Ye.id&&(Ae.id=Ye.id),Ye.bbox&&(Ae.bbox=Ye.bbox),Ae.features=Ue,Ae}function ze(Ue,Ye,Ae){return void 0===Ae&&(Ae={}),pe({type:"MultiLineString",coordinates:Ue},Ye,Ae)}function _t(Ue,Ye,Ae){return void 0===Ae&&(Ae={}),pe({type:"MultiPoint",coordinates:Ue},Ye,Ae)}function dt(Ue,Ye,Ae){return void 0===Ae&&(Ae={}),pe({type:"MultiPolygon",coordinates:Ue},Ye,Ae)}function xt(Ue,Ye){void 0===Ye&&(Ye="kilometers");var Ae=Qe.factors[Ye];if(!Ae)throw new Error(Ye+" units is invalid");return Ue*Ae}function ie(Ue,Ye){void 0===Ye&&(Ye="kilometers");var Ae=Qe.factors[Ye];if(!Ae)throw new Error(Ye+" units is invalid");return Ue/Ae}function re(Ue){return Ue%(2*Math.PI)*180/Math.PI}function Z(Ue){return!isNaN(Ue)&&null!==Ue&&!Array.isArray(Ue)}Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.earthRadius=6371008.8,Qe.factors={centimeters:100*Qe.earthRadius,centimetres:100*Qe.earthRadius,degrees:Qe.earthRadius/111325,feet:3.28084*Qe.earthRadius,inches:39.37*Qe.earthRadius,kilometers:Qe.earthRadius/1e3,kilometres:Qe.earthRadius/1e3,meters:Qe.earthRadius,metres:Qe.earthRadius,miles:Qe.earthRadius/1609.344,millimeters:1e3*Qe.earthRadius,millimetres:1e3*Qe.earthRadius,nauticalmiles:Qe.earthRadius/1852,radians:1,yards:1.0936*Qe.earthRadius},Qe.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Qe.earthRadius,yards:1.0936133},Qe.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},Qe.feature=pe,Qe.geometry=function he(Ue,Ye,Ae){switch(void 0===Ae&&(Ae={}),Ue){case"Point":return de(Ye).geometry;case"LineString":return fe(Ye).geometry;case"Polygon":return p(Ye).geometry;case"MultiPoint":return _t(Ye).geometry;case"MultiLineString":return ze(Ye).geometry;case"MultiPolygon":return dt(Ye).geometry;default:throw new Error(Ue+" is invalid")}},Qe.point=de,Qe.points=function _e(Ue,Ye,Ae){return void 0===Ae&&(Ae={}),Ie(Ue.map(function(Wt){return de(Wt,Ye)}),Ae)},Qe.polygon=p,Qe.polygons=function H(Ue,Ye,Ae){return void 0===Ae&&(Ae={}),Ie(Ue.map(function(Wt){return p(Wt,Ye)}),Ae)},Qe.lineString=fe,Qe.lineStrings=function ve(Ue,Ye,Ae){return void 0===Ae&&(Ae={}),Ie(Ue.map(function(Wt){return fe(Wt,Ye)}),Ae)},Qe.featureCollection=Ie,Qe.multiLineString=ze,Qe.multiPoint=_t,Qe.multiPolygon=dt,Qe.geometryCollection=function Je(Ue,Ye,Ae){return void 0===Ae&&(Ae={}),pe({type:"GeometryCollection",geometries:Ue},Ye,Ae)},Qe.round=function ht(Ue,Ye){if(void 0===Ye&&(Ye=0),Ye&&!(Ye>=0))throw new Error("precision must be a positive number");var Ae=Math.pow(10,Ye||0);return Math.round(Ue*Ae)/Ae},Qe.radiansToLength=xt,Qe.lengthToRadians=ie,Qe.lengthToDegrees=function W(Ue,Ye){return re(ie(Ue,Ye))},Qe.bearingToAzimuth=function J(Ue){var Ye=Ue%360;return Ye<0&&(Ye+=360),Ye},Qe.radiansToDegrees=re,Qe.degreesToRadians=function Y(Ue){return Ue%360*Math.PI/180},Qe.convertLength=function ne(Ue,Ye,Ae){if(void 0===Ye&&(Ye="kilometers"),void 0===Ae&&(Ae="kilometers"),!(Ue>=0))throw new Error("length must be a positive number");return xt(ie(Ue,Ye),Ae)},Qe.convertArea=function ee(Ue,Ye,Ae){if(void 0===Ye&&(Ye="meters"),void 0===Ae&&(Ae="kilometers"),!(Ue>=0))throw new Error("area must be a positive number");var Wt=Qe.areaFactors[Ye];if(!Wt)throw new Error("invalid original units");var At=Qe.areaFactors[Ae];if(!At)throw new Error("invalid final units");return Ue/Wt*At},Qe.isNumber=Z,Qe.isObject=function me(Ue){return!!Ue&&Ue.constructor===Object},Qe.validateBBox=function Q(Ue){if(!Ue)throw new Error("bbox is required");if(!Array.isArray(Ue))throw new Error("bbox must be an Array");if(4!==Ue.length&&6!==Ue.length)throw new Error("bbox must be an Array of 4 or 6 numbers");Ue.forEach(function(Ye){if(!Z(Ye))throw new Error("bbox must only contain numbers")})},Qe.validateId=function qe(Ue){if(!Ue)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof Ue))throw new Error("id must be a number or a string")}},3269:(bt,Qe,pe)=>{"use strict";Object.defineProperty(Qe,"__esModule",{value:!0});var he=pe(8275);function de(Y,ne,ee){if(null!==Y)for(var Z,me,Q,qe,Ue,Ye,Ae,De,Wt=0,At=0,pt=Y.type,Fe="FeatureCollection"===pt,at="Feature"===pt,vt=Fe?Y.features.length:1,Le=0;Le<vt;Le++){Ue=(De=!!(Ae=Fe?Y.features[Le].geometry:at?Y.geometry:Y)&&"GeometryCollection"===Ae.type)?Ae.geometries.length:1;for(var Ut=0;Ut<Ue;Ut++){var zt=0,gn=0;if(null!==(qe=De?Ae.geometries[Ut]:Ae)){Ye=qe.coordinates;var Dt=qe.type;switch(Wt=!ee||"Polygon"!==Dt&&"MultiPolygon"!==Dt?0:1,Dt){case null:break;case"Point":if(!1===ne(Ye,At,Le,zt,gn))return!1;At++,zt++;break;case"LineString":case"MultiPoint":for(Z=0;Z<Ye.length;Z++){if(!1===ne(Ye[Z],At,Le,zt,gn))return!1;At++,"MultiPoint"===Dt&&zt++}"LineString"===Dt&&zt++;break;case"Polygon":case"MultiLineString":for(Z=0;Z<Ye.length;Z++){for(me=0;me<Ye[Z].length-Wt;me++){if(!1===ne(Ye[Z][me],At,Le,zt,gn))return!1;At++}"MultiLineString"===Dt&&zt++,"Polygon"===Dt&&gn++}"Polygon"===Dt&&zt++;break;case"MultiPolygon":for(Z=0;Z<Ye.length;Z++){for(gn=0,me=0;me<Ye[Z].length;me++){for(Q=0;Q<Ye[Z][me].length-Wt;Q++){if(!1===ne(Ye[Z][me][Q],At,Le,zt,gn))return!1;At++}gn++}zt++}break;case"GeometryCollection":for(Z=0;Z<qe.geometries.length;Z++)if(!1===de(qe.geometries[Z],ne,ee))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function p(Y,ne){var ee;switch(Y.type){case"FeatureCollection":for(ee=0;ee<Y.features.length&&!1!==ne(Y.features[ee].properties,ee);ee++);break;case"Feature":ne(Y.properties,0)}}function fe(Y,ne){if("Feature"===Y.type)ne(Y,0);else if("FeatureCollection"===Y.type)for(var ee=0;ee<Y.features.length&&!1!==ne(Y.features[ee],ee);ee++);}function ze(Y,ne){var ee,Z,me,Q,qe,Ue,Ye,Ae,Wt,At,De=0,pt="FeatureCollection"===Y.type,Fe="Feature"===Y.type,at=pt?Y.features.length:1;for(ee=0;ee<at;ee++){for(Ae=pt?Y.features[ee].properties:Fe?Y.properties:{},Wt=pt?Y.features[ee].bbox:Fe?Y.bbox:void 0,At=pt?Y.features[ee].id:Fe?Y.id:void 0,qe=(Ye=!!(Ue=pt?Y.features[ee].geometry:Fe?Y.geometry:Y)&&"GeometryCollection"===Ue.type)?Ue.geometries.length:1,me=0;me<qe;me++)if(null!==(Q=Ye?Ue.geometries[me]:Ue))switch(Q.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===ne(Q,De,Ae,Wt,At))return!1;break;case"GeometryCollection":for(Z=0;Z<Q.geometries.length;Z++)if(!1===ne(Q.geometries[Z],De,Ae,Wt,At))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===ne(null,De,Ae,Wt,At))return!1;De++}}function dt(Y,ne){ze(Y,function(ee,Z,me,Q,qe){var Ye,Ue=null===ee?null:ee.type;switch(Ue){case null:case"Point":case"LineString":case"Polygon":return!1!==ne(he.feature(ee,me,{bbox:Q,id:qe}),Z,0)&&void 0}switch(Ue){case"MultiPoint":Ye="Point";break;case"MultiLineString":Ye="LineString";break;case"MultiPolygon":Ye="Polygon"}for(var Ae=0;Ae<ee.coordinates.length;Ae++)if(!1===ne(he.feature({type:Ye,coordinates:ee.coordinates[Ae]},me),Z,Ae))return!1})}function ht(Y,ne){dt(Y,function(ee,Z,me){var Q=0;if(ee.geometry){var qe=ee.geometry.type;if("Point"!==qe&&"MultiPoint"!==qe){var Ue,Ye=0,Ae=0,Wt=0;if(!1===de(ee,function(At,De,pt,Fe,at){if(void 0===Ue||Z>Ye||Fe>Ae||at>Wt)return Ue=At,Ye=Z,Ae=Fe,Wt=at,void(Q=0);var vt=he.lineString([Ue,At],ee.properties);if(!1===ne(vt,Z,me,at,Q))return!1;Q++,Ue=At}))return!1}}})}function ie(Y,ne){if(!Y)throw new Error("geojson is required");dt(Y,function(ee,Z,me){if(null!==ee.geometry){var qe=ee.geometry.coordinates;switch(ee.geometry.type){case"LineString":if(!1===ne(ee,Z,me,0,0))return!1;break;case"Polygon":for(var Ue=0;Ue<qe.length;Ue++)if(!1===ne(he.lineString(qe[Ue],ee.properties),Z,me,Ue))return!1}}})}Qe.coordAll=function Ie(Y){var ne=[];return de(Y,function(ee){ne.push(ee)}),ne},Qe.coordEach=de,Qe.coordReduce=function _e(Y,ne,ee,Z){var me=ee;return de(Y,function(Q,qe,Ue,Ye,Ae){me=0===qe&&void 0===ee?Q:ne(me,Q,qe,Ue,Ye,Ae)},Z),me},Qe.featureEach=fe,Qe.featureReduce=function ve(Y,ne,ee){var Z=ee;return fe(Y,function(me,Q){Z=0===Q&&void 0===ee?me:ne(Z,me,Q)}),Z},Qe.findPoint=function re(Y,ne){if(!he.isObject(ne=ne||{}))throw new Error("options is invalid");var Ue,ee=ne.featureIndex||0,Z=ne.multiFeatureIndex||0,me=ne.geometryIndex||0,Q=ne.coordIndex||0,qe=ne.properties;switch(Y.type){case"FeatureCollection":ee<0&&(ee=Y.features.length+ee),qe=qe||Y.features[ee].properties,Ue=Y.features[ee].geometry;break;case"Feature":qe=qe||Y.properties,Ue=Y.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":Ue=Y;break;default:throw new Error("geojson is invalid")}if(null===Ue)return null;var Ye=Ue.coordinates;switch(Ue.type){case"Point":return he.point(Ye,qe,ne);case"MultiPoint":return Z<0&&(Z=Ye.length+Z),he.point(Ye[Z],qe,ne);case"LineString":return Q<0&&(Q=Ye.length+Q),he.point(Ye[Q],qe,ne);case"Polygon":return me<0&&(me=Ye.length+me),Q<0&&(Q=Ye[me].length+Q),he.point(Ye[me][Q],qe,ne);case"MultiLineString":return Z<0&&(Z=Ye.length+Z),Q<0&&(Q=Ye[Z].length+Q),he.point(Ye[Z][Q],qe,ne);case"MultiPolygon":return Z<0&&(Z=Ye.length+Z),me<0&&(me=Ye[Z].length+me),Q<0&&(Q=Ye[Z][me].length-Q),he.point(Ye[Z][me][Q],qe,ne)}throw new Error("geojson is invalid")},Qe.findSegment=function J(Y,ne){if(!he.isObject(ne=ne||{}))throw new Error("options is invalid");var Ue,ee=ne.featureIndex||0,Z=ne.multiFeatureIndex||0,me=ne.geometryIndex||0,Q=ne.segmentIndex||0,qe=ne.properties;switch(Y.type){case"FeatureCollection":ee<0&&(ee=Y.features.length+ee),qe=qe||Y.features[ee].properties,Ue=Y.features[ee].geometry;break;case"Feature":qe=qe||Y.properties,Ue=Y.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":Ue=Y;break;default:throw new Error("geojson is invalid")}if(null===Ue)return null;var Ye=Ue.coordinates;switch(Ue.type){case"Point":case"MultiPoint":return null;case"LineString":return Q<0&&(Q=Ye.length+Q-1),he.lineString([Ye[Q],Ye[Q+1]],qe,ne);case"Polygon":return me<0&&(me=Ye.length+me),Q<0&&(Q=Ye[me].length+Q-1),he.lineString([Ye[me][Q],Ye[me][Q+1]],qe,ne);case"MultiLineString":return Z<0&&(Z=Ye.length+Z),Q<0&&(Q=Ye[Z].length+Q-1),he.lineString([Ye[Z][Q],Ye[Z][Q+1]],qe,ne);case"MultiPolygon":return Z<0&&(Z=Ye.length+Z),me<0&&(me=Ye[Z].length+me),Q<0&&(Q=Ye[Z][me].length-Q-1),he.lineString([Ye[Z][me][Q],Ye[Z][me][Q+1]],qe,ne)}throw new Error("geojson is invalid")},Qe.flattenEach=dt,Qe.flattenReduce=function Je(Y,ne,ee){var Z=ee;return dt(Y,function(me,Q,qe){Z=0===Q&&0===qe&&void 0===ee?me:ne(Z,me,Q,qe)}),Z},Qe.geomEach=ze,Qe.geomReduce=function _t(Y,ne,ee){var Z=ee;return ze(Y,function(me,Q,qe,Ue,Ye){Z=0===Q&&void 0===ee?me:ne(Z,me,Q,qe,Ue,Ye)}),Z},Qe.lineEach=ie,Qe.lineReduce=function W(Y,ne,ee){var Z=ee;return ie(Y,function(me,Q,qe,Ue){Z=0===Q&&void 0===ee?me:ne(Z,me,Q,qe,Ue)}),Z},Qe.propEach=p,Qe.propReduce=function H(Y,ne,ee){var Z=ee;return p(Y,function(me,Q){Z=0===Q&&void 0===ee?me:ne(Z,me,Q)}),Z},Qe.segmentEach=ht,Qe.segmentReduce=function xt(Y,ne,ee){var Z=ee,me=!1;return ht(Y,function(Q,qe,Ue,Ye,Ae){Z=!1===me&&void 0===ee?Q:ne(Z,Q,qe,Ue,Ye,Ae),me=!0}),Z}},2049:function(bt,Qe,pe){var he;bt=pe.nmd(bt),function(de){"object"==typeof global&&global;var fe=function(xt){this.message=xt};(fe.prototype=new Error).name="InvalidCharacterError";var ve=function(xt){throw new fe(xt)},Ie="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ze=/[\t\n\f\r ]/g,Je={encode:function(xt){xt=String(xt),/[^\0-\xFF]/.test(xt)&&ve("The string to be encoded contains characters outside of the Latin1 range.");for(var re,Y,ne,Z,ie=xt.length%3,W="",J=-1,me=xt.length-ie;++J<me;)re=xt.charCodeAt(J)<<16,Y=xt.charCodeAt(++J)<<8,ne=xt.charCodeAt(++J),W+=Ie.charAt((Z=re+Y+ne)>>18&63)+Ie.charAt(Z>>12&63)+Ie.charAt(Z>>6&63)+Ie.charAt(63&Z);return 2==ie?(re=xt.charCodeAt(J)<<8,Y=xt.charCodeAt(++J),W+=Ie.charAt((Z=re+Y)>>10)+Ie.charAt(Z>>4&63)+Ie.charAt(Z<<2&63)+"="):1==ie&&(Z=xt.charCodeAt(J),W+=Ie.charAt(Z>>2)+Ie.charAt(Z<<4&63)+"=="),W},decode:function(xt){var ie=(xt=String(xt).replace(ze,"")).length;ie%4==0&&(ie=(xt=xt.replace(/==?$/,"")).length),(ie%4==1||/[^+a-zA-Z0-9/]/.test(xt))&&ve("Invalid character: the string to be decoded is not correctly encoded.");for(var J,re,W=0,Y="",ne=-1;++ne<ie;)re=Ie.indexOf(xt.charAt(ne)),J=W%4?64*J+re:re,W++%4&&(Y+=String.fromCharCode(255&J>>(-2*W&6)));return Y},version:"0.1.0"};void 0!==(he=function(){return Je}.call(Qe,pe,Qe,bt))&&(bt.exports=he)}()},5834:(bt,Qe,pe)=>{"use strict";var he=pe(5203),de=pe(5685),_e=de(he("String.prototype.indexOf"));bt.exports=function(H,fe){var ve=he(H,!!fe);return"function"==typeof ve&&_e(H,".prototype.")>-1?de(ve):ve}},5685:(bt,Qe,pe)=>{"use strict";var he=pe(4444),de=pe(5203),_e=de("%Function.prototype.apply%"),p=de("%Function.prototype.call%"),H=de("%Reflect.apply%",!0)||he.call(p,_e),fe=de("%Object.getOwnPropertyDescriptor%",!0),ve=de("%Object.defineProperty%",!0),Ie=de("%Math.max%");if(ve)try{ve({},"a",{value:1})}catch{ve=null}bt.exports=function(dt){var Je=H(he,p,arguments);return fe&&ve&&fe(Je,"length").configurable&&ve(Je,"length",{value:1+Ie(0,dt.length-(arguments.length-1))}),Je};var ze=function(){return H(he,_e,arguments)};ve?ve(bt.exports,"apply",{value:ze}):bt.exports.apply=ze},1335:(bt,Qe,pe)=>{"use strict";var he=pe(3156),de=pe(7253),_e=pe(3870),p=pe(7563).orient2d;function H(ee,Z,me){Z=Math.max(0,void 0===Z?2:Z),me=me||0;var Q=function xt(ee){for(var Z=ee[0],me=ee[0],Q=ee[0],qe=ee[0],Ue=0;Ue<ee.length;Ue++){var Ye=ee[Ue];Ye[0]<Z[0]&&(Z=Ye),Ye[0]>Q[0]&&(Q=Ye),Ye[1]<me[1]&&(me=Ye),Ye[1]>qe[1]&&(qe=Ye)}var Ae=[Z,me,Q,qe],Wt=Ae.slice();for(Ue=0;Ue<ee.length;Ue++)_e(ee[Ue],Ae)||Wt.push(ee[Ue]);return function ne(ee){ee.sort(Y);for(var Z=[],me=0;me<ee.length;me++){for(;Z.length>=2&&dt(Z[Z.length-2],Z[Z.length-1],ee[me])<=0;)Z.pop();Z.push(ee[me])}for(var Q=[],qe=ee.length-1;qe>=0;qe--){for(;Q.length>=2&&dt(Q[Q.length-2],Q[Q.length-1],ee[qe])<=0;)Q.pop();Q.push(ee[qe])}return Q.pop(),Z.pop(),Z.concat(Q)}(Wt)}(ee),qe=new he(16);qe.toBBox=function(gn){return{minX:gn[0],minY:gn[1],maxX:gn[0],maxY:gn[1]}},qe.compareMinX=function(gn,Dt){return gn[0]-Dt[0]},qe.compareMinY=function(gn,Dt){return gn[1]-Dt[1]},qe.load(ee);for(var Ae,Ue=[],Ye=0;Ye<Q.length;Ye++){var Wt=Q[Ye];qe.remove(Wt),Ae=ie(Wt,Ae),Ue.push(Ae)}var At=new he(16);for(Ye=0;Ye<Ue.length;Ye++)At.insert(ht(Ue[Ye]));for(var De=Z*Z,pt=me*me;Ue.length;){var Fe=Ue.shift(),at=Fe.p,vt=Fe.next.p,Le=W(at,vt);if(!(Le<pt)){var Ut=Le/De;(Wt=fe(qe,Fe.prev.p,at,vt,Fe.next.next.p,Ut,At))&&Math.min(W(Wt,at),W(Wt,vt))<=Ut&&(Ue.push(Fe),Ue.push(ie(Wt,Fe)),qe.remove(Wt),At.remove(Fe),At.insert(ht(Fe)),At.insert(ht(Fe.next)))}}Fe=Ae;var zt=[];do{zt.push(Fe.p),Fe=Fe.next}while(Fe!==Ae);return zt.push(Fe.p),zt}function fe(ee,Z,me,Q,qe,Ue,Ye){for(var Ae=new de([],ve),Wt=ee.data;Wt;){for(var At=0;At<Wt.children.length;At++){var De=Wt.children[At],pt=Wt.leaf?J(De,me,Q):Ie(me,Q,De);pt>Ue||Ae.push({node:De,dist:pt})}for(;Ae.length&&!Ae.peek().node.children;){var Fe=Ae.pop(),at=Fe.node,vt=J(at,Z,me),Le=J(at,Q,qe);if(Fe.dist<vt&&Fe.dist<Le&&_t(me,at,Ye)&&_t(Q,at,Ye))return at}(Wt=Ae.pop())&&(Wt=Wt.node)}return null}function ve(ee,Z){return ee.dist-Z.dist}function Ie(ee,Z,me){if(ze(ee,me)||ze(Z,me))return 0;var Q=re(ee[0],ee[1],Z[0],Z[1],me.minX,me.minY,me.maxX,me.minY);if(0===Q)return 0;var qe=re(ee[0],ee[1],Z[0],Z[1],me.minX,me.minY,me.minX,me.maxY);if(0===qe)return 0;var Ue=re(ee[0],ee[1],Z[0],Z[1],me.maxX,me.minY,me.maxX,me.maxY);if(0===Ue)return 0;var Ye=re(ee[0],ee[1],Z[0],Z[1],me.minX,me.maxY,me.maxX,me.maxY);return 0===Ye?0:Math.min(Q,qe,Ue,Ye)}function ze(ee,Z){return ee[0]>=Z.minX&&ee[0]<=Z.maxX&&ee[1]>=Z.minY&&ee[1]<=Z.maxY}function _t(ee,Z,me){for(var Q=Math.min(ee[0],Z[0]),qe=Math.min(ee[1],Z[1]),Ue=Math.max(ee[0],Z[0]),Ye=Math.max(ee[1],Z[1]),Ae=me.search({minX:Q,minY:qe,maxX:Ue,maxY:Ye}),Wt=0;Wt<Ae.length;Wt++)if(Je(Ae[Wt].p,Ae[Wt].next.p,ee,Z))return!1;return!0}function dt(ee,Z,me){return p(ee[0],ee[1],Z[0],Z[1],me[0],me[1])}function Je(ee,Z,me,Q){return ee!==Q&&Z!==me&&dt(ee,Z,me)>0!=dt(ee,Z,Q)>0&&dt(me,Q,ee)>0!=dt(me,Q,Z)>0}function ht(ee){var Z=ee.p,me=ee.next.p;return ee.minX=Math.min(Z[0],me[0]),ee.minY=Math.min(Z[1],me[1]),ee.maxX=Math.max(Z[0],me[0]),ee.maxY=Math.max(Z[1],me[1]),ee}function ie(ee,Z){var me={p:ee,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return Z?(me.next=Z.next,me.prev=Z,Z.next.prev=me,Z.next=me):(me.prev=me,me.next=me),me}function W(ee,Z){var me=ee[0]-Z[0],Q=ee[1]-Z[1];return me*me+Q*Q}function J(ee,Z,me){var Q=Z[0],qe=Z[1],Ue=me[0]-Q,Ye=me[1]-qe;if(0!==Ue||0!==Ye){var Ae=((ee[0]-Q)*Ue+(ee[1]-qe)*Ye)/(Ue*Ue+Ye*Ye);Ae>1?(Q=me[0],qe=me[1]):Ae>0&&(Q+=Ue*Ae,qe+=Ye*Ae)}return(Ue=ee[0]-Q)*Ue+(Ye=ee[1]-qe)*Ye}function re(ee,Z,me,Q,qe,Ue,Ye,Ae){var Un,_n,Cn,cn,Wt=me-ee,At=Q-Z,De=Ye-qe,pt=Ae-Ue,Fe=ee-qe,at=Z-Ue,vt=Wt*Wt+At*At,Le=Wt*De+At*pt,Ut=De*De+pt*pt,zt=Wt*Fe+At*at,gn=De*Fe+pt*at,Dt=vt*Ut-Le*Le,En=Dt,sn=Dt;0===Dt?(_n=0,En=1,cn=gn,sn=Ut):(cn=vt*gn-Le*zt,(_n=Le*gn-Ut*zt)<0?(_n=0,cn=gn,sn=Ut):_n>En&&(_n=En,cn=gn+Le,sn=Ut)),cn<0?(cn=0,-zt<0?_n=0:-zt>vt?_n=En:(_n=-zt,En=vt)):cn>sn&&(cn=sn,-zt+Le<0?_n=0:-zt+Le>vt?_n=En:(_n=-zt+Le,En=vt));var sr=(1-(Cn=0===cn?0:cn/sn))*qe+Cn*Ye-((1-(Un=0===_n?0:_n/En))*ee+Un*me),wt=(1-Cn)*Ue+Cn*Ae-((1-Un)*Z+Un*Q);return sr*sr+wt*wt}function Y(ee,Z){return ee[0]===Z[0]?ee[1]-Z[1]:ee[0]-Z[0]}de.default&&(de=de.default),bt.exports=H,bt.exports.default=H},3156:function(bt){bt.exports=function(){"use strict";function Qe(ie,W,J,re,Y){!function ne(ee,Z,me,Q,qe){for(;Q>me;){if(Q-me>600){var Ue=Q-me+1,Ye=Z-me+1,Ae=Math.log(Ue),Wt=.5*Math.exp(2*Ae/3),At=.5*Math.sqrt(Ae*Wt*(Ue-Wt)/Ue)*(Ye-Ue/2<0?-1:1);ne(ee,Z,Math.max(me,Math.floor(Z-Ye*Wt/Ue+At)),Math.min(Q,Math.floor(Z+(Ue-Ye)*Wt/Ue+At)),qe)}var Fe=ee[Z],at=me,vt=Q;for(pe(ee,me,Z),qe(ee[Q],Fe)>0&&pe(ee,me,Q);at<vt;){for(pe(ee,at,vt),at++,vt--;qe(ee[at],Fe)<0;)at++;for(;qe(ee[vt],Fe)>0;)vt--}0===qe(ee[me],Fe)?pe(ee,me,vt):pe(ee,++vt,Q),vt<=Z&&(me=vt+1),Z<=vt&&(Q=vt-1)}}(ie,W,J||0,re||ie.length-1,Y||he)}function pe(ie,W,J){var re=ie[W];ie[W]=ie[J],ie[J]=re}function he(ie,W){return ie<W?-1:ie>W?1:0}var de=function(ie){void 0===ie&&(ie=9),this._maxEntries=Math.max(4,ie),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function _e(ie,W,J){if(!J)return W.indexOf(ie);for(var re=0;re<W.length;re++)if(J(ie,W[re]))return re;return-1}function p(ie,W){H(ie,0,ie.children.length,W,ie)}function H(ie,W,J,re,Y){Y||(Y=ht(null)),Y.minX=1/0,Y.minY=1/0,Y.maxX=-1/0,Y.maxY=-1/0;for(var ne=W;ne<J;ne++){var ee=ie.children[ne];fe(Y,ie.leaf?re(ee):ee)}return Y}function fe(ie,W){return ie.minX=Math.min(ie.minX,W.minX),ie.minY=Math.min(ie.minY,W.minY),ie.maxX=Math.max(ie.maxX,W.maxX),ie.maxY=Math.max(ie.maxY,W.maxY),ie}function ve(ie,W){return ie.minX-W.minX}function Ie(ie,W){return ie.minY-W.minY}function ze(ie){return(ie.maxX-ie.minX)*(ie.maxY-ie.minY)}function _t(ie){return ie.maxX-ie.minX+(ie.maxY-ie.minY)}function dt(ie,W){return ie.minX<=W.minX&&ie.minY<=W.minY&&W.maxX<=ie.maxX&&W.maxY<=ie.maxY}function Je(ie,W){return W.minX<=ie.maxX&&W.minY<=ie.maxY&&W.maxX>=ie.minX&&W.maxY>=ie.minY}function ht(ie){return{children:ie,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function xt(ie,W,J,re,Y){for(var ne=[W,J];ne.length;)if(!((J=ne.pop())-(W=ne.pop())<=re)){var ee=W+Math.ceil((J-W)/re/2)*re;Qe(ie,ee,W,J,Y),ne.push(W,ee,ee,J)}}return de.prototype.all=function(){return this._all(this.data,[])},de.prototype.search=function(ie){var W=this.data,J=[];if(!Je(ie,W))return J;for(var re=this.toBBox,Y=[];W;){for(var ne=0;ne<W.children.length;ne++){var ee=W.children[ne],Z=W.leaf?re(ee):ee;Je(ie,Z)&&(W.leaf?J.push(ee):dt(ie,Z)?this._all(ee,J):Y.push(ee))}W=Y.pop()}return J},de.prototype.collides=function(ie){var W=this.data;if(!Je(ie,W))return!1;for(var J=[];W;){for(var re=0;re<W.children.length;re++){var Y=W.children[re],ne=W.leaf?this.toBBox(Y):Y;if(Je(ie,ne)){if(W.leaf||dt(ie,ne))return!0;J.push(Y)}}W=J.pop()}return!1},de.prototype.load=function(ie){if(!ie||!ie.length)return this;if(ie.length<this._minEntries){for(var W=0;W<ie.length;W++)this.insert(ie[W]);return this}var J=this._build(ie.slice(),0,ie.length-1,0);if(this.data.children.length)if(this.data.height===J.height)this._splitRoot(this.data,J);else{if(this.data.height<J.height){var re=this.data;this.data=J,J=re}this._insert(J,this.data.height-J.height-1,!0)}else this.data=J;return this},de.prototype.insert=function(ie){return ie&&this._insert(ie,this.data.height-1),this},de.prototype.clear=function(){return this.data=ht([]),this},de.prototype.remove=function(ie,W){if(!ie)return this;for(var J,re,Y,ne=this.data,ee=this.toBBox(ie),Z=[],me=[];ne||Z.length;){if(ne||(ne=Z.pop(),re=Z[Z.length-1],J=me.pop(),Y=!0),ne.leaf){var Q=_e(ie,ne.children,W);if(-1!==Q)return ne.children.splice(Q,1),Z.push(ne),this._condense(Z),this}Y||ne.leaf||!dt(ne,ee)?re?(J++,ne=re.children[J],Y=!1):ne=null:(Z.push(ne),me.push(J),J=0,re=ne,ne=ne.children[0])}return this},de.prototype.toBBox=function(ie){return ie},de.prototype.compareMinX=function(ie,W){return ie.minX-W.minX},de.prototype.compareMinY=function(ie,W){return ie.minY-W.minY},de.prototype.toJSON=function(){return this.data},de.prototype.fromJSON=function(ie){return this.data=ie,this},de.prototype._all=function(ie,W){for(var J=[];ie;)ie.leaf?W.push.apply(W,ie.children):J.push.apply(J,ie.children),ie=J.pop();return W},de.prototype._build=function(ie,W,J,re){var Y,ne=J-W+1,ee=this._maxEntries;if(ne<=ee)return p(Y=ht(ie.slice(W,J+1)),this.toBBox),Y;re||(re=Math.ceil(Math.log(ne)/Math.log(ee)),ee=Math.ceil(ne/Math.pow(ee,re-1))),(Y=ht([])).leaf=!1,Y.height=re;var Z=Math.ceil(ne/ee),me=Z*Math.ceil(Math.sqrt(ee));xt(ie,W,J,me,this.compareMinX);for(var Q=W;Q<=J;Q+=me){var qe=Math.min(Q+me-1,J);xt(ie,Q,qe,Z,this.compareMinY);for(var Ue=Q;Ue<=qe;Ue+=Z){var Ye=Math.min(Ue+Z-1,qe);Y.children.push(this._build(ie,Ue,Ye,re-1))}}return p(Y,this.toBBox),Y},de.prototype._chooseSubtree=function(ie,W,J,re){for(;re.push(W),!W.leaf&&re.length-1!==J;){for(var Y=1/0,ne=1/0,ee=void 0,Z=0;Z<W.children.length;Z++){var me=W.children[Z],Q=ze(me),qe=(Ue=ie,Ye=me,(Math.max(Ye.maxX,Ue.maxX)-Math.min(Ye.minX,Ue.minX))*(Math.max(Ye.maxY,Ue.maxY)-Math.min(Ye.minY,Ue.minY))-Q);qe<ne?(ne=qe,Y=Q<Y?Q:Y,ee=me):qe===ne&&Q<Y&&(Y=Q,ee=me)}W=ee||W.children[0]}var Ue,Ye;return W},de.prototype._insert=function(ie,W,J){var re=J?ie:this.toBBox(ie),Y=[],ne=this._chooseSubtree(re,this.data,W,Y);for(ne.children.push(ie),fe(ne,re);W>=0&&Y[W].children.length>this._maxEntries;)this._split(Y,W),W--;this._adjustParentBBoxes(re,Y,W)},de.prototype._split=function(ie,W){var J=ie[W],re=J.children.length,Y=this._minEntries;this._chooseSplitAxis(J,Y,re);var ne=this._chooseSplitIndex(J,Y,re),ee=ht(J.children.splice(ne,J.children.length-ne));ee.height=J.height,ee.leaf=J.leaf,p(J,this.toBBox),p(ee,this.toBBox),W?ie[W-1].children.push(ee):this._splitRoot(J,ee)},de.prototype._splitRoot=function(ie,W){this.data=ht([ie,W]),this.data.height=ie.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},de.prototype._chooseSplitIndex=function(ie,W,J){for(var re,Y,ne,ee,Z,me,Q,qe=1/0,Ue=1/0,Ye=W;Ye<=J-W;Ye++){var Ae=H(ie,0,Ye,this.toBBox),Wt=H(ie,Ye,J,this.toBBox),At=(Y=Ae,ne=Wt,void 0,void 0,void 0,void 0,ee=Math.max(Y.minX,ne.minX),Z=Math.max(Y.minY,ne.minY),me=Math.min(Y.maxX,ne.maxX),Q=Math.min(Y.maxY,ne.maxY),Math.max(0,me-ee)*Math.max(0,Q-Z)),De=ze(Ae)+ze(Wt);At<qe?(qe=At,re=Ye,Ue=De<Ue?De:Ue):At===qe&&De<Ue&&(Ue=De,re=Ye)}return re||J-W},de.prototype._chooseSplitAxis=function(ie,W,J){var re=ie.leaf?this.compareMinX:ve,Y=ie.leaf?this.compareMinY:Ie;this._allDistMargin(ie,W,J,re)<this._allDistMargin(ie,W,J,Y)&&ie.children.sort(re)},de.prototype._allDistMargin=function(ie,W,J,re){ie.children.sort(re);for(var Y=this.toBBox,ne=H(ie,0,W,Y),ee=H(ie,J-W,J,Y),Z=_t(ne)+_t(ee),me=W;me<J-W;me++){var Q=ie.children[me];fe(ne,ie.leaf?Y(Q):Q),Z+=_t(ne)}for(var qe=J-W-1;qe>=W;qe--){var Ue=ie.children[qe];fe(ee,ie.leaf?Y(Ue):Ue),Z+=_t(ee)}return Z},de.prototype._adjustParentBBoxes=function(ie,W,J){for(var re=J;re>=0;re--)fe(W[re],ie)},de.prototype._condense=function(ie){for(var W=ie.length-1,J=void 0;W>=0;W--)0===ie[W].children.length?W>0?(J=ie[W-1].children).splice(J.indexOf(ie[W]),1):this.clear():p(ie[W],this.toBBox)},de}()},6952:(bt,Qe,pe)=>{var he=pe(1356),de=pe(3407),_e=pe(2e3),p=pe(2342),H=pe(9235),fe=pe(2374),ve=Date.prototype.getTime;function ze(Je){return null==Je}function _t(Je){return!(!Je||"object"!=typeof Je||"number"!=typeof Je.length||"function"!=typeof Je.copy||"function"!=typeof Je.slice||Je.length>0&&"number"!=typeof Je[0])}bt.exports=function Ie(Je,ht,xt){var ie=xt||{};return!!(ie.strict?_e(Je,ht):Je===ht)||(!Je||!ht||"object"!=typeof Je&&"object"!=typeof ht?ie.strict?_e(Je,ht):Je==ht:function dt(Je,ht,xt){var ie,W;if(typeof Je!=typeof ht||ze(Je)||ze(ht)||Je.prototype!==ht.prototype||de(Je)!==de(ht))return!1;var J=p(Je),re=p(ht);if(J!==re)return!1;if(J||re)return Je.source===ht.source&&H(Je)===H(ht);if(fe(Je)&&fe(ht))return ve.call(Je)===ve.call(ht);var Y=_t(Je),ne=_t(ht);if(Y!==ne)return!1;if(Y||ne){if(Je.length!==ht.length)return!1;for(ie=0;ie<Je.length;ie++)if(Je[ie]!==ht[ie])return!1;return!0}if(typeof Je!=typeof ht)return!1;try{var ee=he(Je),Z=he(ht)}catch{return!1}if(ee.length!==Z.length)return!1;for(ee.sort(),Z.sort(),ie=ee.length-1;ie>=0;ie--)if(ee[ie]!=Z[ie])return!1;for(ie=ee.length-1;ie>=0;ie--)if(!Ie(Je[W=ee[ie]],ht[W],xt))return!1;return!0}(Je,ht,ie))}},2358:(bt,Qe,pe)=>{"use strict";var he=pe(1356),de="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),_e=Object.prototype.toString,p=Array.prototype.concat,H=Object.defineProperty,ve=pe(7027)(),Ie=H&&ve,ze=function(dt,Je,ht,xt){if(Je in dt)if(!0===xt){if(dt[Je]===ht)return}else if(!function(dt){return"function"==typeof dt&&"[object Function]"===_e.call(dt)}(xt)||!xt())return;Ie?H(dt,Je,{configurable:!0,enumerable:!1,value:ht,writable:!0}):dt[Je]=ht},_t=function(dt,Je){var ht=arguments.length>2?arguments[2]:{},xt=he(Je);de&&(xt=p.call(xt,Object.getOwnPropertySymbols(Je)));for(var ie=0;ie<xt.length;ie+=1)ze(dt,xt[ie],Je[xt[ie]],ht[xt[ie]])};_t.supportsDescriptors=!!Ie,bt.exports=_t},1817:bt=>{function Qe(pe,he,de,_e){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(pe,he,de,_e)}Qe.prototype.run=function(pe,he,de,_e){this._init(pe,he,de,_e);for(var p=0;p<this._datasetLength;p++)if(1!==this._visited[p]){this._visited[p]=1;var H=this._regionQuery(p);if(H.length<this.minPts)this.noise.push(p);else{var fe=this.clusters.length;this.clusters.push([]),this._addToCluster(p,fe),this._expandCluster(fe,H)}}return this.clusters},Qe.prototype._init=function(pe,he,de,_e){if(pe){if(!(pe instanceof Array))throw Error("Dataset must be of type array, "+typeof pe+" given");this.dataset=pe,this.clusters=[],this.noise=[],this._datasetLength=pe.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}he&&(this.epsilon=he),de&&(this.minPts=de),_e&&(this.distance=_e)},Qe.prototype._expandCluster=function(pe,he){for(var de=0;de<he.length;de++){var _e=he[de];if(1!==this._visited[_e]){this._visited[_e]=1;var p=this._regionQuery(_e);p.length>=this.minPts&&(he=this._mergeArrays(he,p))}1!==this._assigned[_e]&&this._addToCluster(_e,pe)}},Qe.prototype._addToCluster=function(pe,he){this.clusters[he].push(pe),this._assigned[pe]=1},Qe.prototype._regionQuery=function(pe){for(var he=[],de=0;de<this._datasetLength;de++)this.distance(this.dataset[pe],this.dataset[de])<this.epsilon&&he.push(de);return he},Qe.prototype._mergeArrays=function(pe,he){for(var de=he.length,_e=0;_e<de;_e++){var p=he[_e];pe.indexOf(p)<0&&pe.push(p)}return pe},Qe.prototype._euclideanDistance=function(pe,he){for(var de=0,_e=Math.min(pe.length,he.length);_e--;)de+=(pe[_e]-he[_e])*(pe[_e]-he[_e]);return Math.sqrt(de)},bt.exports&&(bt.exports=Qe)},4273:bt=>{function Qe(pe,he,de){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(pe,he,de)}Qe.prototype.init=function(pe,he,de){this.assignments=[],this.centroids=[],typeof pe<"u"&&(this.dataset=pe),typeof he<"u"&&(this.k=he),typeof de<"u"&&(this.distance=de)},Qe.prototype.run=function(pe,he){this.init(pe,he);for(var de=this.dataset.length,_e=0;_e<this.k;_e++)this.centroids[_e]=this.randomCentroid();for(var p=!0;p;){p=this.assign();for(var H=0;H<this.k;H++){for(var fe=new Array(_t),ve=0,Ie=0;Ie<_t;Ie++)fe[Ie]=0;for(var ze=0;ze<de;ze++){var _t=this.dataset[ze].length;if(H===this.assignments[ze]){for(Ie=0;Ie<_t;Ie++)fe[Ie]+=this.dataset[ze][Ie];ve++}}if(ve>0){for(Ie=0;Ie<_t;Ie++)fe[Ie]/=ve;this.centroids[H]=fe}else this.centroids[H]=this.randomCentroid(),p=!0}}return this.getClusters()},Qe.prototype.randomCentroid=function(){var he,de,pe=this.dataset.length-1;do{de=Math.round(Math.random()*pe),he=this.dataset[de]}while(this.centroids.indexOf(he)>=0);return he},Qe.prototype.assign=function(){for(var de,pe=!1,he=this.dataset.length,_e=0;_e<he;_e++)(de=this.argmin(this.dataset[_e],this.centroids,this.distance))!=this.assignments[_e]&&(this.assignments[_e]=de,pe=!0);return pe},Qe.prototype.getClusters=function(){for(var he,pe=new Array(this.k),de=0;de<this.assignments.length;de++)typeof pe[he=this.assignments[de]]>"u"&&(pe[he]=[]),pe[he].push(de);return pe},Qe.prototype.argmin=function(pe,he,de){for(var fe,_e=Number.MAX_VALUE,p=0,H=he.length,ve=0;ve<H;ve++)(fe=de(pe,he[ve]))<_e&&(_e=fe,p=ve);return p},Qe.prototype.distance=function(pe,he){for(var de=0,_e=Math.min(pe.length,he.length);_e--;){var p=pe[_e]-he[_e];de+=p*p}return Math.sqrt(de)},bt.exports&&(bt.exports=Qe)},8680:(bt,Qe,pe)=>{if(bt.exports)var he=pe(8759);function de(_e,p,H,fe){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(_e,p,H,fe)}de.prototype.run=function(_e,p,H,fe){this._init(_e,p,H,fe);for(var ve=0,Ie=this.dataset.length;ve<Ie;ve++)if(1!==this._processed[ve]){this._processed[ve]=1,this.clusters.push([ve]);var ze=this.clusters.length-1;this._orderedList.push(ve);var _t=new he(null,null,"asc"),dt=this._regionQuery(ve);void 0!==this._distanceToCore(ve)&&(this._updateQueue(ve,dt,_t),this._expandCluster(ze,_t))}return this.clusters},de.prototype.getReachabilityPlot=function(){for(var _e=[],p=0,H=this._orderedList.length;p<H;p++){var fe=this._orderedList[p];_e.push([fe,this._reachability[fe]])}return _e},de.prototype._init=function(_e,p,H,fe){if(_e){if(!(_e instanceof Array))throw Error("Dataset must be of type array, "+typeof _e+" given");this.dataset=_e,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}p&&(this.epsilon=p),H&&(this.minPts=H),fe&&(this.distance=fe)},de.prototype._updateQueue=function(_e,p,H){var fe=this;this._coreDistance=this._distanceToCore(_e),p.forEach(function(ve){if(void 0===fe._processed[ve]){var Ie=fe.distance(fe.dataset[_e],fe.dataset[ve]),ze=Math.max(fe._coreDistance,Ie);void 0===fe._reachability[ve]?(fe._reachability[ve]=ze,H.insert(ve,ze)):ze<fe._reachability[ve]&&(fe._reachability[ve]=ze,H.remove(ve),H.insert(ve,ze))}})},de.prototype._expandCluster=function(_e,p){for(var H=p.getElements(),fe=0,ve=H.length;fe<ve;fe++){var Ie=H[fe];if(void 0===this._processed[Ie]){var ze=this._regionQuery(Ie);this._processed[Ie]=1,this.clusters[_e].push(Ie),this._orderedList.push(Ie),void 0!==this._distanceToCore(Ie)&&(this._updateQueue(Ie,ze,p),this._expandCluster(_e,p))}}},de.prototype._distanceToCore=function(_e){for(var p=this.epsilon,H=0;H<p;H++)if(this._regionQuery(_e,H).length>=this.minPts)return H},de.prototype._regionQuery=function(_e,p){p=p||this.epsilon;for(var H=[],fe=0,ve=this.dataset.length;fe<ve;fe++)this.distance(this.dataset[_e],this.dataset[fe])<p&&H.push(fe);return H},de.prototype._euclideanDistance=function(_e,p){for(var H=0,fe=Math.min(_e.length,p.length);fe--;)H+=(_e[fe]-p[fe])*(_e[fe]-p[fe]);return Math.sqrt(H)},bt.exports&&(bt.exports=de)},8759:bt=>{function Qe(pe,he,de){this._queue=[],this._priorities=[],this._sorting="desc",this._init(pe,he,de)}Qe.prototype.insert=function(pe,he){for(var de=this._queue.length,_e=de;_e--;){var p=this._priorities[_e];"desc"===this._sorting?he>p&&(de=_e):he<p&&(de=_e)}this._insertAt(pe,he,de)},Qe.prototype.remove=function(pe){for(var he=this._queue.length;he--;)if(pe===this._queue[he]){this._queue.splice(he,1),this._priorities.splice(he,1);break}},Qe.prototype.forEach=function(pe){this._queue.forEach(pe)},Qe.prototype.getElements=function(){return this._queue},Qe.prototype.getElementPriority=function(pe){return this._priorities[pe]},Qe.prototype.getPriorities=function(){return this._priorities},Qe.prototype.getElementsWithPriorities=function(){for(var pe=[],he=0,de=this._queue.length;he<de;he++)pe.push([this._queue[he],this._priorities[he]]);return pe},Qe.prototype._init=function(pe,he,de){if(pe&&he){if(this._queue=[],this._priorities=[],pe.length!==he.length)throw new Error("Arrays must have the same length");for(var _e=0;_e<pe.length;_e++)this.insert(pe[_e],he[_e])}de&&(this._sorting=de)},Qe.prototype._insertAt=function(pe,he,de){this._queue.length===de?(this._queue.push(pe),this._priorities.push(he)):(this._queue.splice(de,0,pe),this._priorities.splice(de,0,he))},bt.exports&&(bt.exports=Qe)},7470:(bt,Qe,pe)=>{bt.exports&&(bt.exports={DBSCAN:pe(1817),KMEANS:pe(4273),OPTICS:pe(8680),PriorityQueue:pe(8759)})},5469:bt=>{"use strict";function Qe(De,pt,Fe){Fe=Fe||2;var zt,gn,Dt,Un,_n,Cn,cn,at=pt&&pt.length,vt=at?pt[0]*Fe:De.length,Le=pe(De,0,vt,Fe,!0),Ut=[];if(!Le||Le.next===Le.prev)return Ut;if(at&&(Le=function ve(De,pt,Fe,at){var Le,Ut,Dt,vt=[];for(Le=0,Ut=pt.length;Le<Ut;Le++)(Dt=pe(De,pt[Le]*at,Le<Ut-1?pt[Le+1]*at:De.length,at,!1))===Dt.next&&(Dt.steiner=!0),vt.push(ie(Dt));for(vt.sort(Ie),Le=0;Le<vt.length;Le++)Fe=ze(vt[Le],Fe);return Fe}(De,pt,Le,Fe)),De.length>80*Fe){zt=Dt=De[0],gn=Un=De[1];for(var En=Fe;En<vt;En+=Fe)(_n=De[En])<zt&&(zt=_n),(Cn=De[En+1])<gn&&(gn=Cn),_n>Dt&&(Dt=_n),Cn>Un&&(Un=Cn);cn=0!==(cn=Math.max(Dt-zt,Un-gn))?32767/cn:0}return de(Le,Ut,Fe,zt,gn,cn,0),Ut}function pe(De,pt,Fe,at,vt){var Le,Ut;if(vt===At(De,pt,Fe,at)>0)for(Le=pt;Le<Fe;Le+=at)Ut=Ye(Le,De[Le],De[Le+1],Ut);else for(Le=Fe-at;Le>=pt;Le-=at)Ut=Ye(Le,De[Le],De[Le+1],Ut);return Ut&&Y(Ut,Ut.next)&&(Ae(Ut),Ut=Ut.next),Ut}function he(De,pt){if(!De)return De;pt||(pt=De);var at,Fe=De;do{if(at=!1,Fe.steiner||!Y(Fe,Fe.next)&&0!==re(Fe.prev,Fe,Fe.next))Fe=Fe.next;else{if(Ae(Fe),(Fe=pt=Fe.prev)===Fe.next)break;at=!0}}while(at||Fe!==pt);return pt}function de(De,pt,Fe,at,vt,Le,Ut){if(De){!Ut&&Le&&function Je(De,pt,Fe,at){var vt=De;do{0===vt.z&&(vt.z=xt(vt.x,vt.y,pt,Fe,at)),vt.prevZ=vt.prev,vt.nextZ=vt.next,vt=vt.next}while(vt!==De);vt.prevZ.nextZ=null,vt.prevZ=null,function ht(De){var pt,Fe,at,vt,Le,Ut,zt,gn,Dt=1;do{for(Fe=De,De=null,Le=null,Ut=0;Fe;){for(Ut++,at=Fe,zt=0,pt=0;pt<Dt&&(zt++,at=at.nextZ);pt++);for(gn=Dt;zt>0||gn>0&&at;)0!==zt&&(0===gn||!at||Fe.z<=at.z)?(vt=Fe,Fe=Fe.nextZ,zt--):(vt=at,at=at.nextZ,gn--),Le?Le.nextZ=vt:De=vt,vt.prevZ=Le,Le=vt;Fe=at}Le.nextZ=null,Dt*=2}while(Ut>1)}(vt)}(De,at,vt,Le);for(var gn,Dt,zt=De;De.prev!==De.next;)if(gn=De.prev,Dt=De.next,Le?p(De,at,vt,Le):_e(De))pt.push(gn.i/Fe|0),pt.push(De.i/Fe|0),pt.push(Dt.i/Fe|0),Ae(De),De=Dt.next,zt=Dt.next;else if((De=Dt)===zt){Ut?1===Ut?de(De=H(he(De),pt,Fe),pt,Fe,at,vt,Le,2):2===Ut&&fe(De,pt,Fe,at,vt,Le):de(he(De),pt,Fe,at,vt,Le,1);break}}}function _e(De){var pt=De.prev,Fe=De,at=De.next;if(re(pt,Fe,at)>=0)return!1;for(var vt=pt.x,Le=Fe.x,Ut=at.x,zt=pt.y,gn=Fe.y,Dt=at.y,Un=vt<Le?vt<Ut?vt:Ut:Le<Ut?Le:Ut,_n=zt<gn?zt<Dt?zt:Dt:gn<Dt?gn:Dt,Cn=vt>Le?vt>Ut?vt:Ut:Le>Ut?Le:Ut,cn=zt>gn?zt>Dt?zt:Dt:gn>Dt?gn:Dt,En=at.next;En!==pt;){if(En.x>=Un&&En.x<=Cn&&En.y>=_n&&En.y<=cn&&W(vt,zt,Le,gn,Ut,Dt,En.x,En.y)&&re(En.prev,En,En.next)>=0)return!1;En=En.next}return!0}function p(De,pt,Fe,at){var vt=De.prev,Le=De,Ut=De.next;if(re(vt,Le,Ut)>=0)return!1;for(var zt=vt.x,gn=Le.x,Dt=Ut.x,Un=vt.y,_n=Le.y,Cn=Ut.y,cn=zt<gn?zt<Dt?zt:Dt:gn<Dt?gn:Dt,En=Un<_n?Un<Cn?Un:Cn:_n<Cn?_n:Cn,sn=zt>gn?zt>Dt?zt:Dt:gn>Dt?gn:Dt,Ei=Un>_n?Un>Cn?Un:Cn:_n>Cn?_n:Cn,cr=xt(cn,En,pt,Fe,at),oi=xt(sn,Ei,pt,Fe,at),tr=De.prevZ,sr=De.nextZ;tr&&tr.z>=cr&&sr&&sr.z<=oi;){if(tr.x>=cn&&tr.x<=sn&&tr.y>=En&&tr.y<=Ei&&tr!==vt&&tr!==Ut&&W(zt,Un,gn,_n,Dt,Cn,tr.x,tr.y)&&re(tr.prev,tr,tr.next)>=0||(tr=tr.prevZ,sr.x>=cn&&sr.x<=sn&&sr.y>=En&&sr.y<=Ei&&sr!==vt&&sr!==Ut&&W(zt,Un,gn,_n,Dt,Cn,sr.x,sr.y)&&re(sr.prev,sr,sr.next)>=0))return!1;sr=sr.nextZ}for(;tr&&tr.z>=cr;){if(tr.x>=cn&&tr.x<=sn&&tr.y>=En&&tr.y<=Ei&&tr!==vt&&tr!==Ut&&W(zt,Un,gn,_n,Dt,Cn,tr.x,tr.y)&&re(tr.prev,tr,tr.next)>=0)return!1;tr=tr.prevZ}for(;sr&&sr.z<=oi;){if(sr.x>=cn&&sr.x<=sn&&sr.y>=En&&sr.y<=Ei&&sr!==vt&&sr!==Ut&&W(zt,Un,gn,_n,Dt,Cn,sr.x,sr.y)&&re(sr.prev,sr,sr.next)>=0)return!1;sr=sr.nextZ}return!0}function H(De,pt,Fe){var at=De;do{var vt=at.prev,Le=at.next.next;!Y(vt,Le)&&ne(vt,at,at.next,Le)&&Q(vt,Le)&&Q(Le,vt)&&(pt.push(vt.i/Fe|0),pt.push(at.i/Fe|0),pt.push(Le.i/Fe|0),Ae(at),Ae(at.next),at=De=Le),at=at.next}while(at!==De);return he(at)}function fe(De,pt,Fe,at,vt,Le){var Ut=De;do{for(var zt=Ut.next.next;zt!==Ut.prev;){if(Ut.i!==zt.i&&J(Ut,zt)){var gn=Ue(Ut,zt);return Ut=he(Ut,Ut.next),gn=he(gn,gn.next),de(Ut,pt,Fe,at,vt,Le,0),void de(gn,pt,Fe,at,vt,Le,0)}zt=zt.next}Ut=Ut.next}while(Ut!==De)}function Ie(De,pt){return De.x-pt.x}function ze(De,pt){var Fe=function _t(De,pt){var Ut,Fe=pt,at=De.x,vt=De.y,Le=-1/0;do{if(vt<=Fe.y&&vt>=Fe.next.y&&Fe.next.y!==Fe.y){var zt=Fe.x+(vt-Fe.y)*(Fe.next.x-Fe.x)/(Fe.next.y-Fe.y);if(zt<=at&&zt>Le&&(Le=zt,Ut=Fe.x<Fe.next.x?Fe:Fe.next,zt===at))return Ut}Fe=Fe.next}while(Fe!==pt);if(!Ut)return null;var Cn,gn=Ut,Dt=Ut.x,Un=Ut.y,_n=1/0;Fe=Ut;do{at>=Fe.x&&Fe.x>=Dt&&at!==Fe.x&&W(vt<Un?at:Le,vt,Dt,Un,vt<Un?Le:at,vt,Fe.x,Fe.y)&&(Cn=Math.abs(vt-Fe.y)/(at-Fe.x),Q(Fe,De)&&(Cn<_n||Cn===_n&&(Fe.x>Ut.x||Fe.x===Ut.x&&dt(Ut,Fe)))&&(Ut=Fe,_n=Cn)),Fe=Fe.next}while(Fe!==gn);return Ut}(De,pt);if(!Fe)return pt;var at=Ue(Fe,De);return he(at,at.next),he(Fe,Fe.next)}function dt(De,pt){return re(De.prev,De,pt.prev)<0&&re(pt.next,De,De.next)<0}function xt(De,pt,Fe,at,vt){return(De=1431655765&((De=858993459&((De=252645135&((De=16711935&((De=(De-Fe)*vt|0)|De<<8))|De<<4))|De<<2))|De<<1))|(pt=1431655765&((pt=858993459&((pt=252645135&((pt=16711935&((pt=(pt-at)*vt|0)|pt<<8))|pt<<4))|pt<<2))|pt<<1))<<1}function ie(De){var pt=De,Fe=De;do{(pt.x<Fe.x||pt.x===Fe.x&&pt.y<Fe.y)&&(Fe=pt),pt=pt.next}while(pt!==De);return Fe}function W(De,pt,Fe,at,vt,Le,Ut,zt){return(vt-Ut)*(pt-zt)>=(De-Ut)*(Le-zt)&&(De-Ut)*(at-zt)>=(Fe-Ut)*(pt-zt)&&(Fe-Ut)*(Le-zt)>=(vt-Ut)*(at-zt)}function J(De,pt){return De.next.i!==pt.i&&De.prev.i!==pt.i&&!function me(De,pt){var Fe=De;do{if(Fe.i!==De.i&&Fe.next.i!==De.i&&Fe.i!==pt.i&&Fe.next.i!==pt.i&&ne(Fe,Fe.next,De,pt))return!0;Fe=Fe.next}while(Fe!==De);return!1}(De,pt)&&(Q(De,pt)&&Q(pt,De)&&function qe(De,pt){var Fe=De,at=!1,vt=(De.x+pt.x)/2,Le=(De.y+pt.y)/2;do{Fe.y>Le!=Fe.next.y>Le&&Fe.next.y!==Fe.y&&vt<(Fe.next.x-Fe.x)*(Le-Fe.y)/(Fe.next.y-Fe.y)+Fe.x&&(at=!at),Fe=Fe.next}while(Fe!==De);return at}(De,pt)&&(re(De.prev,De,pt.prev)||re(De,pt.prev,pt))||Y(De,pt)&&re(De.prev,De,De.next)>0&&re(pt.prev,pt,pt.next)>0)}function re(De,pt,Fe){return(pt.y-De.y)*(Fe.x-pt.x)-(pt.x-De.x)*(Fe.y-pt.y)}function Y(De,pt){return De.x===pt.x&&De.y===pt.y}function ne(De,pt,Fe,at){var vt=Z(re(De,pt,Fe)),Le=Z(re(De,pt,at)),Ut=Z(re(Fe,at,De)),zt=Z(re(Fe,at,pt));return!!(vt!==Le&&Ut!==zt||0===vt&&ee(De,Fe,pt)||0===Le&&ee(De,at,pt)||0===Ut&&ee(Fe,De,at)||0===zt&&ee(Fe,pt,at))}function ee(De,pt,Fe){return pt.x<=Math.max(De.x,Fe.x)&&pt.x>=Math.min(De.x,Fe.x)&&pt.y<=Math.max(De.y,Fe.y)&&pt.y>=Math.min(De.y,Fe.y)}function Z(De){return De>0?1:De<0?-1:0}function Q(De,pt){return re(De.prev,De,De.next)<0?re(De,pt,De.next)>=0&&re(De,De.prev,pt)>=0:re(De,pt,De.prev)<0||re(De,De.next,pt)<0}function Ue(De,pt){var Fe=new Wt(De.i,De.x,De.y),at=new Wt(pt.i,pt.x,pt.y),vt=De.next,Le=pt.prev;return De.next=pt,pt.prev=De,Fe.next=vt,vt.prev=Fe,at.next=Fe,Fe.prev=at,Le.next=at,at.prev=Le,at}function Ye(De,pt,Fe,at){var vt=new Wt(De,pt,Fe);return at?(vt.next=at.next,vt.prev=at,at.next.prev=vt,at.next=vt):(vt.prev=vt,vt.next=vt),vt}function Ae(De){De.next.prev=De.prev,De.prev.next=De.next,De.prevZ&&(De.prevZ.nextZ=De.nextZ),De.nextZ&&(De.nextZ.prevZ=De.prevZ)}function Wt(De,pt,Fe){this.i=De,this.x=pt,this.y=Fe,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function At(De,pt,Fe,at){for(var vt=0,Le=pt,Ut=Fe-at;Le<Fe;Le+=at)vt+=(De[Ut]-De[Le])*(De[Le+1]+De[Ut+1]),Ut=Le;return vt}bt.exports=Qe,bt.exports.default=Qe,Qe.deviation=function(De,pt,Fe,at){var vt=pt&&pt.length,Ut=Math.abs(At(De,0,vt?pt[0]*Fe:De.length,Fe));if(vt)for(var zt=0,gn=pt.length;zt<gn;zt++)Ut-=Math.abs(At(De,pt[zt]*Fe,zt<gn-1?pt[zt+1]*Fe:De.length,Fe));var _n=0;for(zt=0;zt<at.length;zt+=3){var Cn=at[zt]*Fe,cn=at[zt+1]*Fe,En=at[zt+2]*Fe;_n+=Math.abs((De[Cn]-De[En])*(De[cn+1]-De[Cn+1])-(De[Cn]-De[cn])*(De[En+1]-De[Cn+1]))}return 0===Ut&&0===_n?0:Math.abs((_n-Ut)/Ut)},Qe.flatten=function(De){for(var pt=De[0][0].length,Fe={vertices:[],holes:[],dimensions:pt},at=0,vt=0;vt<De.length;vt++){for(var Le=0;Le<De[vt].length;Le++)for(var Ut=0;Ut<pt;Ut++)Fe.vertices.push(De[vt][Le][Ut]);vt>0&&Fe.holes.push(at+=De[vt-1].length)}return Fe}},9069:bt=>{"use strict";var he,Qe="object"==typeof Reflect?Reflect:null,pe=Qe&&"function"==typeof Qe.apply?Qe.apply:function(ne,ee,Z){return Function.prototype.apply.call(ne,ee,Z)};he=Qe&&"function"==typeof Qe.ownKeys?Qe.ownKeys:Object.getOwnPropertySymbols?function(ne){return Object.getOwnPropertyNames(ne).concat(Object.getOwnPropertySymbols(ne))}:function(ne){return Object.getOwnPropertyNames(ne)};var _e=Number.isNaN||function(ne){return ne!=ne};function p(){p.init.call(this)}bt.exports=p,bt.exports.once=function W(Y,ne){return new Promise(function(ee,Z){function me(qe){Y.removeListener(ne,Q),Z(qe)}function Q(){"function"==typeof Y.removeListener&&Y.removeListener("error",me),ee([].slice.call(arguments))}re(Y,ne,Q,{once:!0}),"error"!==ne&&function J(Y,ne,ee){"function"==typeof Y.on&&re(Y,"error",ne,ee)}(Y,me,{once:!0})})},p.EventEmitter=p,p.prototype._events=void 0,p.prototype._eventsCount=0,p.prototype._maxListeners=void 0;var H=10;function fe(Y){if("function"!=typeof Y)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Y)}function ve(Y){return void 0===Y._maxListeners?p.defaultMaxListeners:Y._maxListeners}function Ie(Y,ne,ee,Z){var me,Q,qe;if(fe(ee),void 0===(Q=Y._events)?(Q=Y._events=Object.create(null),Y._eventsCount=0):(void 0!==Q.newListener&&(Y.emit("newListener",ne,ee.listener?ee.listener:ee),Q=Y._events),qe=Q[ne]),void 0===qe)qe=Q[ne]=ee,++Y._eventsCount;else if("function"==typeof qe?qe=Q[ne]=Z?[ee,qe]:[qe,ee]:Z?qe.unshift(ee):qe.push(ee),(me=ve(Y))>0&&qe.length>me&&!qe.warned){qe.warned=!0;var Ue=new Error("Possible EventEmitter memory leak detected. "+qe.length+" "+String(ne)+" listeners added. Use emitter.setMaxListeners() to increase limit");Ue.name="MaxListenersExceededWarning",Ue.emitter=Y,Ue.type=ne,Ue.count=qe.length,function de(Y){console&&console.warn&&console.warn(Y)}(Ue)}return Y}function ze(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _t(Y,ne,ee){var Z={fired:!1,wrapFn:void 0,target:Y,type:ne,listener:ee},me=ze.bind(Z);return me.listener=ee,Z.wrapFn=me,me}function dt(Y,ne,ee){var Z=Y._events;if(void 0===Z)return[];var me=Z[ne];return void 0===me?[]:"function"==typeof me?ee?[me.listener||me]:[me]:ee?function ie(Y){for(var ne=new Array(Y.length),ee=0;ee<ne.length;++ee)ne[ee]=Y[ee].listener||Y[ee];return ne}(me):ht(me,me.length)}function Je(Y){var ne=this._events;if(void 0!==ne){var ee=ne[Y];if("function"==typeof ee)return 1;if(void 0!==ee)return ee.length}return 0}function ht(Y,ne){for(var ee=new Array(ne),Z=0;Z<ne;++Z)ee[Z]=Y[Z];return ee}function re(Y,ne,ee,Z){if("function"==typeof Y.on)Z.once?Y.once(ne,ee):Y.on(ne,ee);else{if("function"!=typeof Y.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Y);Y.addEventListener(ne,function me(Q){Z.once&&Y.removeEventListener(ne,me),ee(Q)})}}Object.defineProperty(p,"defaultMaxListeners",{enumerable:!0,get:function(){return H},set:function(Y){if("number"!=typeof Y||Y<0||_e(Y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Y+".");H=Y}}),p.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},p.prototype.setMaxListeners=function(ne){if("number"!=typeof ne||ne<0||_e(ne))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+ne+".");return this._maxListeners=ne,this},p.prototype.getMaxListeners=function(){return ve(this)},p.prototype.emit=function(ne){for(var ee=[],Z=1;Z<arguments.length;Z++)ee.push(arguments[Z]);var me="error"===ne,Q=this._events;if(void 0!==Q)me=me&&void 0===Q.error;else if(!me)return!1;if(me){var qe;if(ee.length>0&&(qe=ee[0]),qe instanceof Error)throw qe;var Ue=new Error("Unhandled error."+(qe?" ("+qe.message+")":""));throw Ue.context=qe,Ue}var Ye=Q[ne];if(void 0===Ye)return!1;if("function"==typeof Ye)pe(Ye,this,ee);else{var Ae=Ye.length,Wt=ht(Ye,Ae);for(Z=0;Z<Ae;++Z)pe(Wt[Z],this,ee)}return!0},p.prototype.on=p.prototype.addListener=function(ne,ee){return Ie(this,ne,ee,!1)},p.prototype.prependListener=function(ne,ee){return Ie(this,ne,ee,!0)},p.prototype.once=function(ne,ee){return fe(ee),this.on(ne,_t(this,ne,ee)),this},p.prototype.prependOnceListener=function(ne,ee){return fe(ee),this.prependListener(ne,_t(this,ne,ee)),this},p.prototype.off=p.prototype.removeListener=function(ne,ee){var Z,me,Q,qe,Ue;if(fe(ee),void 0===(me=this._events))return this;if(void 0===(Z=me[ne]))return this;if(Z===ee||Z.listener===ee)0==--this._eventsCount?this._events=Object.create(null):(delete me[ne],me.removeListener&&this.emit("removeListener",ne,Z.listener||ee));else if("function"!=typeof Z){for(Q=-1,qe=Z.length-1;qe>=0;qe--)if(Z[qe]===ee||Z[qe].listener===ee){Ue=Z[qe].listener,Q=qe;break}if(Q<0)return this;0===Q?Z.shift():function xt(Y,ne){for(;ne+1<Y.length;ne++)Y[ne]=Y[ne+1];Y.pop()}(Z,Q),1===Z.length&&(me[ne]=Z[0]),void 0!==me.removeListener&&this.emit("removeListener",ne,Ue||ee)}return this},p.prototype.removeAllListeners=function(ne){var ee,Z,me;if(void 0===(Z=this._events))return this;if(void 0===Z.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==Z[ne]&&(0==--this._eventsCount?this._events=Object.create(null):delete Z[ne]),this;if(0===arguments.length){var qe,Q=Object.keys(Z);for(me=0;me<Q.length;++me)"removeListener"!==(qe=Q[me])&&this.removeAllListeners(qe);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(ee=Z[ne]))this.removeListener(ne,ee);else if(void 0!==ee)for(me=ee.length-1;me>=0;me--)this.removeListener(ne,ee[me]);return this},p.prototype.listeners=function(ne){return dt(this,ne,!0)},p.prototype.rawListeners=function(ne){return dt(this,ne,!1)},p.listenerCount=function(Y,ne){return"function"==typeof Y.listenerCount?Y.listenerCount(ne):Je.call(Y,ne)},p.prototype.listenerCount=Je,p.prototype.eventNames=function(){return this._eventsCount>0?he(this._events):[]}},3457:bt=>{"use strict";var pe=Array.prototype.slice,he=Object.prototype.toString;bt.exports=function(p){var H=this;if("function"!=typeof H||"[object Function]"!==he.call(H))throw new TypeError("Function.prototype.bind called on incompatible "+H);for(var ve,fe=pe.call(arguments,1),ze=Math.max(0,H.length-fe.length),_t=[],dt=0;dt<ze;dt++)_t.push("$"+dt);if(ve=Function("binder","return function ("+_t.join(",")+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof ve){var ht=H.apply(this,fe.concat(pe.call(arguments)));return Object(ht)===ht?ht:this}return H.apply(p,fe.concat(pe.call(arguments)))}),H.prototype){var Je=function(){};Je.prototype=H.prototype,ve.prototype=new Je,Je.prototype=null}return ve}},4444:(bt,Qe,pe)=>{"use strict";var he=pe(3457);bt.exports=Function.prototype.bind||he},9582:bt=>{"use strict";var Qe=function(){return"string"==typeof function(){}.name},pe=Object.getOwnPropertyDescriptor;if(pe)try{pe([],"length")}catch{pe=null}Qe.functionsHaveConfigurableNames=function(){if(!Qe()||!pe)return!1;var _e=pe(function(){},"name");return!!_e&&!!_e.configurable};var he=Function.prototype.bind;Qe.boundFunctionsHaveNames=function(){return Qe()&&"function"==typeof he&&""!==function(){}.bind().name},bt.exports=Qe},5780:bt=>{var pe;bt.exports=pe={},pe.simpleFilter=function(he,de){return de.filter(function(_e){return pe.test(he,_e)})},pe.test=function(he,de){return null!==pe.match(he,de)},pe.match=function(he,de,_e){var Je,p=0,H=[],fe=de.length,ve=0,Ie=0,ze=(_e=_e||{}).pre||"",_t=_e.post||"",dt=_e.caseSensitive&&de||de.toLowerCase();he=_e.caseSensitive&&he||he.toLowerCase();for(var ht=0;ht<fe;ht++)Je=de[ht],dt[ht]===he[p]?(Je=ze+Je+_t,p+=1,Ie+=1+Ie):Ie=0,ve+=Ie,H[H.length]=Je;return p===he.length?(ve=dt===he?1/0:ve,{rendered:H.join(""),score:ve}):null},pe.filter=function(he,de,_e){return de&&0!==de.length?"string"!=typeof he?de:(_e=_e||{},de.reduce(function(p,H,fe,ve){var Ie=H;_e.extract&&(Ie=_e.extract(H));var ze=pe.match(he,Ie,_e);return null!=ze&&(p[p.length]={string:ze.rendered,score:ze.score,index:fe,original:H}),p},[]).sort(function(p,H){return H.score-p.score||p.index-H.index})):[]}},5013:(bt,Qe,pe)=>{var he=pe(6952),de=function(fe){this.precision=fe&&fe.precision?fe.precision:17,this.direction=!(!fe||!fe.direction)&&fe.direction,this.pseudoNode=!(!fe||!fe.pseudoNode)&&fe.pseudoNode,this.objectComparator=fe&&fe.objectComparator?fe.objectComparator:H};function _e(fe){return fe.coordinates.map(function(ve){return{type:fe.type.replace("Multi",""),coordinates:ve}})}function p(fe,ve){return fe.hasOwnProperty("coordinates")?fe.coordinates.length===ve.coordinates.length:fe.length===ve.length}function H(fe,ve){return he(fe,ve,{strict:!0})}de.prototype.compare=function(fe,ve){if(fe.type!==ve.type||!p(fe,ve))return!1;switch(fe.type){case"Point":return this.compareCoord(fe.coordinates,ve.coordinates);case"LineString":return this.compareLine(fe.coordinates,ve.coordinates,0,!1);case"Polygon":return this.comparePolygon(fe,ve);case"Feature":return this.compareFeature(fe,ve);default:if(0===fe.type.indexOf("Multi")){var Ie=this,ze=_e(fe),_t=_e(ve);return ze.every(function(dt){return this.some(function(Je){return Ie.compare(dt,Je)})},_t)}}return!1},de.prototype.compareCoord=function(fe,ve){if(fe.length!==ve.length)return!1;for(var Ie=0;Ie<fe.length;Ie++)if(fe[Ie].toFixed(this.precision)!==ve[Ie].toFixed(this.precision))return!1;return!0},de.prototype.compareLine=function(fe,ve,Ie,ze){if(!p(fe,ve))return!1;var _t=this.pseudoNode?fe:this.removePseudo(fe),dt=this.pseudoNode?ve:this.removePseudo(ve);if(!ze||this.compareCoord(_t[0],dt[0])||(dt=this.fixStartIndex(dt,_t))){var Je=this.compareCoord(_t[Ie],dt[Ie]);return this.direction||Je?this.comparePath(_t,dt):!!this.compareCoord(_t[Ie],dt[dt.length-(1+Ie)])&&this.comparePath(_t.slice().reverse(),dt)}},de.prototype.fixStartIndex=function(fe,ve){for(var Ie,ze=-1,_t=0;_t<fe.length;_t++)if(this.compareCoord(fe[_t],ve[0])){ze=_t;break}return ze>=0&&(Ie=[].concat(fe.slice(ze,fe.length),fe.slice(1,ze+1))),Ie},de.prototype.comparePath=function(fe,ve){var Ie=this;return fe.every(function(ze,_t){return Ie.compareCoord(ze,this[_t])},ve)},de.prototype.comparePolygon=function(fe,ve){if(this.compareLine(fe.coordinates[0],ve.coordinates[0],1,!0)){var Ie=fe.coordinates.slice(1,fe.coordinates.length),ze=ve.coordinates.slice(1,ve.coordinates.length),_t=this;return Ie.every(function(dt){return this.some(function(Je){return _t.compareLine(dt,Je,1,!0)})},ze)}return!1},de.prototype.compareFeature=function(fe,ve){return!(fe.id!==ve.id||!this.objectComparator(fe.properties,ve.properties)||!this.compareBBox(fe,ve))&&this.compare(fe.geometry,ve.geometry)},de.prototype.compareBBox=function(fe,ve){return!!(!fe.bbox&&!ve.bbox||fe.bbox&&ve.bbox&&this.compareCoord(fe.bbox,ve.bbox))},de.prototype.removePseudo=function(fe){return fe},bt.exports=de},5406:(bt,Qe,pe)=>{var he=pe(7192),de=pe(8275),_e=pe(3269),p=pe(1503).Z,H=_e.featureEach,Ie=de.featureCollection;function ze(_t){var dt=new he(_t);return dt.insert=function(Je){if("Feature"!==Je.type)throw new Error("invalid feature");return Je.bbox=Je.bbox?Je.bbox:p(Je),he.prototype.insert.call(this,Je)},dt.load=function(Je){var ht=[];return Array.isArray(Je)?Je.forEach(function(xt){if("Feature"!==xt.type)throw new Error("invalid features");xt.bbox=xt.bbox?xt.bbox:p(xt),ht.push(xt)}):H(Je,function(xt){if("Feature"!==xt.type)throw new Error("invalid features");xt.bbox=xt.bbox?xt.bbox:p(xt),ht.push(xt)}),he.prototype.load.call(this,ht)},dt.remove=function(Je,ht){if("Feature"!==Je.type)throw new Error("invalid feature");return Je.bbox=Je.bbox?Je.bbox:p(Je),he.prototype.remove.call(this,Je,ht)},dt.clear=function(){return he.prototype.clear.call(this)},dt.search=function(Je){var ht=he.prototype.search.call(this,this.toBBox(Je));return Ie(ht)},dt.collides=function(Je){return he.prototype.collides.call(this,this.toBBox(Je))},dt.all=function(){var Je=he.prototype.all.call(this);return Ie(Je)},dt.toJSON=function(){return he.prototype.toJSON.call(this)},dt.fromJSON=function(Je){return he.prototype.fromJSON.call(this,Je)},dt.toBBox=function(Je){var ht;if(Je.bbox)ht=Je.bbox;else if(Array.isArray(Je)&&4===Je.length)ht=Je;else if(Array.isArray(Je)&&6===Je.length)ht=[Je[0],Je[1],Je[3],Je[4]];else if("Feature"===Je.type)ht=p(Je);else{if("FeatureCollection"!==Je.type)throw new Error("invalid geojson");ht=p(Je)}return{minX:ht[0],minY:ht[1],maxX:ht[2],maxY:ht[3]}},dt}bt.exports=ze,bt.exports.default=ze},7192:function(bt){bt.exports=function(){"use strict";function Qe(ie,W,J,re,Y){!function ne(ee,Z,me,Q,qe){for(;Q>me;){if(Q-me>600){var Ue=Q-me+1,Ye=Z-me+1,Ae=Math.log(Ue),Wt=.5*Math.exp(2*Ae/3),At=.5*Math.sqrt(Ae*Wt*(Ue-Wt)/Ue)*(Ye-Ue/2<0?-1:1);ne(ee,Z,Math.max(me,Math.floor(Z-Ye*Wt/Ue+At)),Math.min(Q,Math.floor(Z+(Ue-Ye)*Wt/Ue+At)),qe)}var Fe=ee[Z],at=me,vt=Q;for(pe(ee,me,Z),qe(ee[Q],Fe)>0&&pe(ee,me,Q);at<vt;){for(pe(ee,at,vt),at++,vt--;qe(ee[at],Fe)<0;)at++;for(;qe(ee[vt],Fe)>0;)vt--}0===qe(ee[me],Fe)?pe(ee,me,vt):pe(ee,++vt,Q),vt<=Z&&(me=vt+1),Z<=vt&&(Q=vt-1)}}(ie,W,J||0,re||ie.length-1,Y||he)}function pe(ie,W,J){var re=ie[W];ie[W]=ie[J],ie[J]=re}function he(ie,W){return ie<W?-1:ie>W?1:0}var de=function(ie){void 0===ie&&(ie=9),this._maxEntries=Math.max(4,ie),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function _e(ie,W,J){if(!J)return W.indexOf(ie);for(var re=0;re<W.length;re++)if(J(ie,W[re]))return re;return-1}function p(ie,W){H(ie,0,ie.children.length,W,ie)}function H(ie,W,J,re,Y){Y||(Y=ht(null)),Y.minX=1/0,Y.minY=1/0,Y.maxX=-1/0,Y.maxY=-1/0;for(var ne=W;ne<J;ne++){var ee=ie.children[ne];fe(Y,ie.leaf?re(ee):ee)}return Y}function fe(ie,W){return ie.minX=Math.min(ie.minX,W.minX),ie.minY=Math.min(ie.minY,W.minY),ie.maxX=Math.max(ie.maxX,W.maxX),ie.maxY=Math.max(ie.maxY,W.maxY),ie}function ve(ie,W){return ie.minX-W.minX}function Ie(ie,W){return ie.minY-W.minY}function ze(ie){return(ie.maxX-ie.minX)*(ie.maxY-ie.minY)}function _t(ie){return ie.maxX-ie.minX+(ie.maxY-ie.minY)}function dt(ie,W){return ie.minX<=W.minX&&ie.minY<=W.minY&&W.maxX<=ie.maxX&&W.maxY<=ie.maxY}function Je(ie,W){return W.minX<=ie.maxX&&W.minY<=ie.maxY&&W.maxX>=ie.minX&&W.maxY>=ie.minY}function ht(ie){return{children:ie,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function xt(ie,W,J,re,Y){for(var ne=[W,J];ne.length;)if(!((J=ne.pop())-(W=ne.pop())<=re)){var ee=W+Math.ceil((J-W)/re/2)*re;Qe(ie,ee,W,J,Y),ne.push(W,ee,ee,J)}}return de.prototype.all=function(){return this._all(this.data,[])},de.prototype.search=function(ie){var W=this.data,J=[];if(!Je(ie,W))return J;for(var re=this.toBBox,Y=[];W;){for(var ne=0;ne<W.children.length;ne++){var ee=W.children[ne],Z=W.leaf?re(ee):ee;Je(ie,Z)&&(W.leaf?J.push(ee):dt(ie,Z)?this._all(ee,J):Y.push(ee))}W=Y.pop()}return J},de.prototype.collides=function(ie){var W=this.data;if(!Je(ie,W))return!1;for(var J=[];W;){for(var re=0;re<W.children.length;re++){var Y=W.children[re],ne=W.leaf?this.toBBox(Y):Y;if(Je(ie,ne)){if(W.leaf||dt(ie,ne))return!0;J.push(Y)}}W=J.pop()}return!1},de.prototype.load=function(ie){if(!ie||!ie.length)return this;if(ie.length<this._minEntries){for(var W=0;W<ie.length;W++)this.insert(ie[W]);return this}var J=this._build(ie.slice(),0,ie.length-1,0);if(this.data.children.length)if(this.data.height===J.height)this._splitRoot(this.data,J);else{if(this.data.height<J.height){var re=this.data;this.data=J,J=re}this._insert(J,this.data.height-J.height-1,!0)}else this.data=J;return this},de.prototype.insert=function(ie){return ie&&this._insert(ie,this.data.height-1),this},de.prototype.clear=function(){return this.data=ht([]),this},de.prototype.remove=function(ie,W){if(!ie)return this;for(var J,re,Y,ne=this.data,ee=this.toBBox(ie),Z=[],me=[];ne||Z.length;){if(ne||(ne=Z.pop(),re=Z[Z.length-1],J=me.pop(),Y=!0),ne.leaf){var Q=_e(ie,ne.children,W);if(-1!==Q)return ne.children.splice(Q,1),Z.push(ne),this._condense(Z),this}Y||ne.leaf||!dt(ne,ee)?re?(J++,ne=re.children[J],Y=!1):ne=null:(Z.push(ne),me.push(J),J=0,re=ne,ne=ne.children[0])}return this},de.prototype.toBBox=function(ie){return ie},de.prototype.compareMinX=function(ie,W){return ie.minX-W.minX},de.prototype.compareMinY=function(ie,W){return ie.minY-W.minY},de.prototype.toJSON=function(){return this.data},de.prototype.fromJSON=function(ie){return this.data=ie,this},de.prototype._all=function(ie,W){for(var J=[];ie;)ie.leaf?W.push.apply(W,ie.children):J.push.apply(J,ie.children),ie=J.pop();return W},de.prototype._build=function(ie,W,J,re){var Y,ne=J-W+1,ee=this._maxEntries;if(ne<=ee)return p(Y=ht(ie.slice(W,J+1)),this.toBBox),Y;re||(re=Math.ceil(Math.log(ne)/Math.log(ee)),ee=Math.ceil(ne/Math.pow(ee,re-1))),(Y=ht([])).leaf=!1,Y.height=re;var Z=Math.ceil(ne/ee),me=Z*Math.ceil(Math.sqrt(ee));xt(ie,W,J,me,this.compareMinX);for(var Q=W;Q<=J;Q+=me){var qe=Math.min(Q+me-1,J);xt(ie,Q,qe,Z,this.compareMinY);for(var Ue=Q;Ue<=qe;Ue+=Z){var Ye=Math.min(Ue+Z-1,qe);Y.children.push(this._build(ie,Ue,Ye,re-1))}}return p(Y,this.toBBox),Y},de.prototype._chooseSubtree=function(ie,W,J,re){for(;re.push(W),!W.leaf&&re.length-1!==J;){for(var Y=1/0,ne=1/0,ee=void 0,Z=0;Z<W.children.length;Z++){var me=W.children[Z],Q=ze(me),qe=(Ue=ie,Ye=me,(Math.max(Ye.maxX,Ue.maxX)-Math.min(Ye.minX,Ue.minX))*(Math.max(Ye.maxY,Ue.maxY)-Math.min(Ye.minY,Ue.minY))-Q);qe<ne?(ne=qe,Y=Q<Y?Q:Y,ee=me):qe===ne&&Q<Y&&(Y=Q,ee=me)}W=ee||W.children[0]}var Ue,Ye;return W},de.prototype._insert=function(ie,W,J){var re=J?ie:this.toBBox(ie),Y=[],ne=this._chooseSubtree(re,this.data,W,Y);for(ne.children.push(ie),fe(ne,re);W>=0&&Y[W].children.length>this._maxEntries;)this._split(Y,W),W--;this._adjustParentBBoxes(re,Y,W)},de.prototype._split=function(ie,W){var J=ie[W],re=J.children.length,Y=this._minEntries;this._chooseSplitAxis(J,Y,re);var ne=this._chooseSplitIndex(J,Y,re),ee=ht(J.children.splice(ne,J.children.length-ne));ee.height=J.height,ee.leaf=J.leaf,p(J,this.toBBox),p(ee,this.toBBox),W?ie[W-1].children.push(ee):this._splitRoot(J,ee)},de.prototype._splitRoot=function(ie,W){this.data=ht([ie,W]),this.data.height=ie.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},de.prototype._chooseSplitIndex=function(ie,W,J){for(var re,Y,ne,ee,Z,me,Q,qe=1/0,Ue=1/0,Ye=W;Ye<=J-W;Ye++){var Ae=H(ie,0,Ye,this.toBBox),Wt=H(ie,Ye,J,this.toBBox),At=(Y=Ae,ne=Wt,void 0,void 0,void 0,void 0,ee=Math.max(Y.minX,ne.minX),Z=Math.max(Y.minY,ne.minY),me=Math.min(Y.maxX,ne.maxX),Q=Math.min(Y.maxY,ne.maxY),Math.max(0,me-ee)*Math.max(0,Q-Z)),De=ze(Ae)+ze(Wt);At<qe?(qe=At,re=Ye,Ue=De<Ue?De:Ue):At===qe&&De<Ue&&(Ue=De,re=Ye)}return re||J-W},de.prototype._chooseSplitAxis=function(ie,W,J){var re=ie.leaf?this.compareMinX:ve,Y=ie.leaf?this.compareMinY:Ie;this._allDistMargin(ie,W,J,re)<this._allDistMargin(ie,W,J,Y)&&ie.children.sort(re)},de.prototype._allDistMargin=function(ie,W,J,re){ie.children.sort(re);for(var Y=this.toBBox,ne=H(ie,0,W,Y),ee=H(ie,J-W,J,Y),Z=_t(ne)+_t(ee),me=W;me<J-W;me++){var Q=ie.children[me];fe(ne,ie.leaf?Y(Q):Q),Z+=_t(ne)}for(var qe=J-W-1;qe>=W;qe--){var Ue=ie.children[qe];fe(ee,ie.leaf?Y(Ue):Ue),Z+=_t(ee)}return Z},de.prototype._adjustParentBBoxes=function(ie,W,J){for(var re=J;re>=0;re--)fe(W[re],ie)},de.prototype._condense=function(ie){for(var W=ie.length-1,J=void 0;W>=0;W--)0===ie[W].children.length?W>0?(J=ie[W-1].children).splice(J.indexOf(ie[W]),1):this.clear():p(ie[W],this.toBBox)},de}()},5203:(bt,Qe,pe)=>{"use strict";var he,de=SyntaxError,_e=Function,p=TypeError,H=function(Wt){try{return _e('"use strict"; return ('+Wt+").constructor;")()}catch{}},fe=Object.getOwnPropertyDescriptor;if(fe)try{fe({},"")}catch{fe=null}var ve=function(){throw new p},Ie=fe?function(){try{return ve}catch{try{return fe(arguments,"callee").get}catch{return ve}}}():ve,ze=pe(2969)(),_t=pe(9757)(),dt=Object.getPrototypeOf||(_t?function(Wt){return Wt.__proto__}:null),Je={},ht=typeof Uint8Array>"u"||!dt?he:dt(Uint8Array),xt={"%AggregateError%":typeof AggregateError>"u"?he:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?he:ArrayBuffer,"%ArrayIteratorPrototype%":ze&&dt?dt([][Symbol.iterator]()):he,"%AsyncFromSyncIteratorPrototype%":he,"%AsyncFunction%":Je,"%AsyncGenerator%":Je,"%AsyncGeneratorFunction%":Je,"%AsyncIteratorPrototype%":Je,"%Atomics%":typeof Atomics>"u"?he:Atomics,"%BigInt%":typeof BigInt>"u"?he:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?he:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?he:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?he:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?he:Float32Array,"%Float64Array%":typeof Float64Array>"u"?he:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?he:FinalizationRegistry,"%Function%":_e,"%GeneratorFunction%":Je,"%Int8Array%":typeof Int8Array>"u"?he:Int8Array,"%Int16Array%":typeof Int16Array>"u"?he:Int16Array,"%Int32Array%":typeof Int32Array>"u"?he:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":ze&&dt?dt(dt([][Symbol.iterator]())):he,"%JSON%":"object"==typeof JSON?JSON:he,"%Map%":typeof Map>"u"?he:Map,"%MapIteratorPrototype%":typeof Map>"u"||!ze||!dt?he:dt((new Map)[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?he:Promise,"%Proxy%":typeof Proxy>"u"?he:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?he:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?he:Set,"%SetIteratorPrototype%":typeof Set>"u"||!ze||!dt?he:dt((new Set)[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?he:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":ze&&dt?dt(""[Symbol.iterator]()):he,"%Symbol%":ze?Symbol:he,"%SyntaxError%":de,"%ThrowTypeError%":Ie,"%TypedArray%":ht,"%TypeError%":p,"%Uint8Array%":typeof Uint8Array>"u"?he:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?he:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?he:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?he:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?he:WeakMap,"%WeakRef%":typeof WeakRef>"u"?he:WeakRef,"%WeakSet%":typeof WeakSet>"u"?he:WeakSet};if(dt)try{null.error}catch(Wt){var ie=dt(dt(Wt));xt["%Error.prototype%"]=ie}var W=function Wt(At){var De;if("%AsyncFunction%"===At)De=H("async function () {}");else if("%GeneratorFunction%"===At)De=H("function* () {}");else if("%AsyncGeneratorFunction%"===At)De=H("async function* () {}");else if("%AsyncGenerator%"===At){var pt=Wt("%AsyncGeneratorFunction%");pt&&(De=pt.prototype)}else if("%AsyncIteratorPrototype%"===At){var Fe=Wt("%AsyncGenerator%");Fe&&dt&&(De=dt(Fe.prototype))}return xt[At]=De,De},J={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},re=pe(4444),Y=pe(3164),ne=re.call(Function.call,Array.prototype.concat),ee=re.call(Function.apply,Array.prototype.splice),Z=re.call(Function.call,String.prototype.replace),me=re.call(Function.call,String.prototype.slice),Q=re.call(Function.call,RegExp.prototype.exec),qe=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Ue=/\\(\\)?/g,Ae=function(At,De){var Fe,pt=At;if(Y(J,pt)&&(pt="%"+(Fe=J[pt])[0]+"%"),Y(xt,pt)){var at=xt[pt];if(at===Je&&(at=W(pt)),typeof at>"u"&&!De)throw new p("intrinsic "+At+" exists, but is not available. Please file an issue!");return{alias:Fe,name:pt,value:at}}throw new de("intrinsic "+At+" does not exist!")};bt.exports=function(At,De){if("string"!=typeof At||0===At.length)throw new p("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof De)throw new p('"allowMissing" argument must be a boolean');if(null===Q(/^%?[^%]*%?$/,At))throw new de("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var pt=function(At){var De=me(At,0,1),pt=me(At,-1);if("%"===De&&"%"!==pt)throw new de("invalid intrinsic syntax, expected closing `%`");if("%"===pt&&"%"!==De)throw new de("invalid intrinsic syntax, expected opening `%`");var Fe=[];return Z(At,qe,function(at,vt,Le,Ut){Fe[Fe.length]=Le?Z(Ut,Ue,"$1"):vt||at}),Fe}(At),Fe=pt.length>0?pt[0]:"",at=Ae("%"+Fe+"%",De),vt=at.name,Le=at.value,Ut=!1,zt=at.alias;zt&&(Fe=zt[0],ee(pt,ne([0,1],zt)));for(var gn=1,Dt=!0;gn<pt.length;gn+=1){var Un=pt[gn],_n=me(Un,0,1),Cn=me(Un,-1);if(('"'===_n||"'"===_n||"`"===_n||'"'===Cn||"'"===Cn||"`"===Cn)&&_n!==Cn)throw new de("property names with quotes must have matching quotes");if(("constructor"===Un||!Dt)&&(Ut=!0),Y(xt,vt="%"+(Fe+="."+Un)+"%"))Le=xt[vt];else if(null!=Le){if(!(Un in Le)){if(!De)throw new p("base intrinsic for "+At+" exists, but the property is not available.");return}if(fe&&gn+1>=pt.length){var cn=fe(Le,Un);Le=(Dt=!!cn)&&"get"in cn&&!("originalValue"in cn.get)?cn.get:Le[Un]}else Dt=Y(Le,Un),Le=Le[Un];Dt&&!Ut&&(xt[vt]=Le)}}return Le}},7027:(bt,Qe,pe)=>{"use strict";var de=pe(5203)("%Object.defineProperty%",!0),_e=function(){if(de)try{return de({},"a",{value:1}),!0}catch{return!1}return!1};_e.hasArrayLengthDefineBug=function(){if(!_e())return null;try{return 1!==de([],"length",{value:1}).length}catch{return!0}},bt.exports=_e},9757:bt=>{"use strict";var Qe={foo:{}},pe=Object;bt.exports=function(){return{__proto__:Qe}.foo===Qe.foo&&!({__proto__:null}instanceof pe)}},2969:(bt,Qe,pe)=>{"use strict";var he=typeof Symbol<"u"&&Symbol,de=pe(1983);bt.exports=function(){return"function"==typeof he&&"function"==typeof Symbol&&"symbol"==typeof he("foo")&&"symbol"==typeof Symbol("bar")&&de()}},1983:bt=>{"use strict";bt.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var pe={},he=Symbol("test"),de=Object(he);if("string"==typeof he||"[object Symbol]"!==Object.prototype.toString.call(he)||"[object Symbol]"!==Object.prototype.toString.call(de))return!1;for(he in pe[he]=42,pe)return!1;if("function"==typeof Object.keys&&0!==Object.keys(pe).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(pe).length)return!1;var p=Object.getOwnPropertySymbols(pe);if(1!==p.length||p[0]!==he||!Object.prototype.propertyIsEnumerable.call(pe,he))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var H=Object.getOwnPropertyDescriptor(pe,he);if(42!==H.value||!0!==H.enumerable)return!1}return!0}},6259:(bt,Qe,pe)=>{"use strict";var he=pe(1983);bt.exports=function(){return he()&&!!Symbol.toStringTag}},3164:(bt,Qe,pe)=>{"use strict";var he=pe(4444);bt.exports=he.call(Function.call,Object.prototype.hasOwnProperty)},3407:(bt,Qe,pe)=>{"use strict";var he=pe(6259)(),_e=pe(5834)("Object.prototype.toString"),p=function(Ie){return!(he&&Ie&&"object"==typeof Ie&&Symbol.toStringTag in Ie)&&"[object Arguments]"===_e(Ie)},H=function(Ie){return!!p(Ie)||null!==Ie&&"object"==typeof Ie&&"number"==typeof Ie.length&&Ie.length>=0&&"[object Array]"!==_e(Ie)&&"[object Function]"===_e(Ie.callee)},fe=function(){return p(arguments)}();p.isLegacyArguments=H,bt.exports=fe?p:H},2374:(bt,Qe,pe)=>{"use strict";var he=Date.prototype.getDay,_e=Object.prototype.toString,H=pe(6259)();bt.exports=function(ve){return"object"==typeof ve&&null!==ve&&(H?function(ve){try{return he.call(ve),!0}catch{return!1}}(ve):"[object Date]"===_e.call(ve))}},2342:(bt,Qe,pe)=>{"use strict";var _e,p,H,fe,he=pe(5834),de=pe(6259)();if(de){_e=he("Object.prototype.hasOwnProperty"),p=he("RegExp.prototype.exec"),H={};var ve=function(){throw H};fe={toString:ve,valueOf:ve},"symbol"==typeof Symbol.toPrimitive&&(fe[Symbol.toPrimitive]=ve)}var Ie=he("Object.prototype.toString"),ze=Object.getOwnPropertyDescriptor;bt.exports=de?function(Je){if(!Je||"object"!=typeof Je)return!1;var ht=ze(Je,"lastIndex");if(!ht||!_e(ht,"value"))return!1;try{p(Je,fe)}catch(ie){return ie===H}}:function(Je){return!(!Je||"object"!=typeof Je&&"function"!=typeof Je)&&"[object RegExp]"===Ie(Je)}},3082:bt=>{var de=/^\s+|\s+$/g,_e=/^[-+]0x[0-9a-f]+$/i,p=/^0b[01]+$/i,H=/^0o[0-7]+$/i,fe=parseInt,ve="object"==typeof global&&global&&global.Object===Object&&global,Ie="object"==typeof self&&self&&self.Object===Object&&self,ze=ve||Ie||Function("return this")(),dt=Object.prototype.toString,Je=Math.max,ht=Math.min,xt=function(){return ze.Date.now()};function W(ne){var ee=typeof ne;return!!ne&&("object"==ee||"function"==ee)}function Y(ne){if("number"==typeof ne)return ne;if(function re(ne){return"symbol"==typeof ne||function J(ne){return!!ne&&"object"==typeof ne}(ne)&&"[object Symbol]"==dt.call(ne)}(ne))return NaN;if(W(ne)){var ee="function"==typeof ne.valueOf?ne.valueOf():ne;ne=W(ee)?ee+"":ee}if("string"!=typeof ne)return 0===ne?ne:+ne;ne=ne.replace(de,"");var Z=p.test(ne);return Z||H.test(ne)?fe(ne.slice(2),Z?2:8):_e.test(ne)?NaN:+ne}bt.exports=function ie(ne,ee,Z){var me,Q,qe,Ue,Ye,Ae,Wt=0,At=!1,De=!1,pt=!0;if("function"!=typeof ne)throw new TypeError("Expected a function");function Fe(_n){var Cn=me,cn=Q;return me=Q=void 0,Wt=_n,Ue=ne.apply(cn,Cn)}function Le(_n){var Cn=_n-Ae;return void 0===Ae||Cn>=ee||Cn<0||De&&_n-Wt>=qe}function Ut(){var _n=xt();if(Le(_n))return zt(_n);Ye=setTimeout(Ut,function vt(_n){var En=ee-(_n-Ae);return De?ht(En,qe-(_n-Wt)):En}(_n))}function zt(_n){return Ye=void 0,pt&&me?Fe(_n):(me=Q=void 0,Ue)}function Un(){var _n=xt(),Cn=Le(_n);if(me=arguments,Q=this,Ae=_n,Cn){if(void 0===Ye)return function at(_n){return Wt=_n,Ye=setTimeout(Ut,ee),At?Fe(_n):Ue}(Ae);if(De)return Ye=setTimeout(Ut,ee),Fe(Ae)}return void 0===Ye&&(Ye=setTimeout(Ut,ee)),Ue}return ee=Y(ee)||0,W(Z)&&(At=!!Z.leading,qe=(De="maxWait"in Z)?Je(Y(Z.maxWait)||0,ee):qe,pt="trailing"in Z?!!Z.trailing:pt),Un.cancel=function gn(){void 0!==Ye&&clearTimeout(Ye),Wt=0,me=Ae=Q=Ye=void 0},Un.flush=function Dt(){return void 0===Ye?Ue:zt(xt())},Un}},9898:function(bt){bt.exports=function(){"use strict";var Qe,pe,he;function de(p,H){if(Qe)if(pe){var fe="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Qe+")(sharedChunk); ("+pe+")(sharedChunk); self.onerror = null;",ve={};Qe(ve),he=H(ve),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(he.workerUrl=window.URL.createObjectURL(new Blob([fe],{type:"text/javascript"})))}else pe=H;else Qe=H}return de(0,function(p){var H=typeof self<"u"?self:{},fe="2.15.0";let ve;const Ie={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ve){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ve=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):s}catch{ve=s}}return ve},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ie.API_URL)return null;try{const s=new URL(Ie.API_URL);return"api.mapbox.cn"===s.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===s.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ze={supported:!1,testSupport:function(s){!Je&&dt&&(ht?xt(s):_t=s)}};let _t,dt,Je=!1,ht=!1;function xt(s){const i=s.createTexture();s.bindTexture(s.TEXTURE_2D,i);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,dt),s.isContextLost())return;ze.supported=!0}catch{}s.deleteTexture(i),Je=!0}H.document&&(dt=H.document.createElement("img"),dt.onload=function(){_t&&xt(_t),_t=null,ht=!0},dt.onerror=function(){Je=!0,_t=null},dt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ie="01";function W(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var J=re;function re(s,i,u,f){this.cx=3*s,this.bx=3*(u-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=u,this.p2y=f}re.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(void 0===i&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var u=s,f=0;f<8;f++){var m=this.sampleCurveX(u)-s;if(Math.abs(m)<i)return u;var w=this.sampleCurveDerivativeX(u);if(Math.abs(w)<1e-6)break;u-=m/w}var S=0,M=1;for(u=s,f=0;f<20&&(m=this.sampleCurveX(u),!(Math.abs(m-s)<i));f++)s>m?S=u:M=u,u=.5*(M-S)+S;return u},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var Y=W(J),ne=ee;function ee(s,i){this.x=s,this.y=i}ee.prototype={clone:function(){return new ee(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,i){return this.clone()._rotateAround(s,i)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var i=s.x-this.x,u=s.y-this.y;return i*i+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,i){return Math.atan2(this.x*i-this.y*s,this.x*s+this.y*i)},_matMult:function(s){var i=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=i,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var i=Math.cos(s),u=Math.sin(s),f=u*this.x+i*this.y;return this.x=i*this.x-u*this.y,this.y=f,this},_rotateAround:function(s,i){var u=Math.cos(s),f=Math.sin(s),m=i.y+f*(this.x-i.x)+u*(this.y-i.y);return this.x=i.x+u*(this.x-i.x)-f*(this.y-i.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ee.convert=function(s){return s instanceof ee?s:Array.isArray(s)?new ee(s[0],s[1]):s};var Z=W(ne);const me=Math.PI/180,Q=180/Math.PI;function qe(s){return s*me}function Ue(s){return s*Q}const Ye=[[0,0],[1,0],[1,1],[0,1]];function Ae(s){if(s<=0)return 0;if(s>=1)return 1;const i=s*s,u=i*s;return 4*(s<.5?u:3*(s-i)+u-.75)}function Wt(s,i,u,f){const m=new Y(s,i,u,f);return function(w){return m.solve(w)}}const At=Wt(.25,.1,.25,1);function De(s,i,u){return Math.min(u,Math.max(i,s))}function pt(s,i,u){return(u=De((u-s)/(i-s),0,1))*u*(3-2*u)}function Fe(s,i,u){const f=u-i,m=((s-i)%f+f)%f+i;return m===i?u:m}function at(s,i,u){if(!s.length)return u(null,[]);let f=s.length;const m=new Array(s.length);let w=null;s.forEach((S,M)=>{i(S,(R,L)=>{R&&(w=R),m[M]=L,0==--f&&u(w,m)})})}function vt(s){const i=[];for(const u in s)i.push(s[u]);return i}function Le(s,...i){for(const u of i)for(const f in u)s[f]=u[f];return s}let Ut=1;function zt(){return Ut++}function gn(){return function s(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function Dt(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Un(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function _n(s,i){s.forEach(u=>{i[u]&&(i[u]=i[u].bind(i))})}function Cn(s,i){return-1!==s.indexOf(i,s.length-i.length)}function cn(s,i,u){const f={};for(const m in s)f[m]=i.call(u||this,s[m],m,s);return f}function En(s,i,u){const f={};for(const m in s)i.call(u||this,s[m],m,s)&&(f[m]=s[m]);return f}function sn(s){return Array.isArray(s)?s.map(sn):"object"==typeof s&&s?cn(s,sn):s}const Ei={};function cr(s){Ei[s]||(typeof console<"u"&&console.warn(s),Ei[s]=!0)}function oi(s,i,u){return(u.y-s.y)*(i.x-s.x)>(i.y-s.y)*(u.x-s.x)}function tr(s){let i=0;for(let u,f,m=0,w=s.length,S=w-1;m<w;S=m++)u=s[m],f=s[S],i+=(f.x-u.x)*(u.y+f.y);return i}function sr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function wt(s){const i={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,f,m,w)=>{const S=m||w;return i[f]=!S||S.toLowerCase(),""}),i["max-age"]){const u=parseInt(i["max-age"],10);isNaN(u)?delete i["max-age"]:i["max-age"]=u}return i}let Te=null;function we(s){if(null==Te){const i=s.navigator?s.navigator.userAgent:null;Te=!!s.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Te}function xe(s){try{const i=H[s];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ze(s,i){return[s[4*i],s[4*i+1],s[4*i+2],s[4*i+3]]}const yt="mapbox-tiles";let tn,Gt,Vt=500,rn=50;function hr(){try{return H.caches}catch{}}function yr(){hr()&&!tn&&(tn=H.caches.open(yt))}function Tn(s){const i=s.indexOf("?");if(i<0)return s;const f=function(m){const w=m.indexOf("?");return w>0?m.slice(w+1).split("&"):[]}(s).filter(m=>{const w=m.split("=");return"language"===w[0]||"worldview"===w[0]});return f.length?`${s.slice(0,i)}?${f.join("&")}`:s.slice(0,i)}let br=1/0;const si={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(si);class zr extends Error{constructor(i,u,f){401===u&&It(f)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=u,this.url=f}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ni=sr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===H.location.protocol?H.parent:H).location.href,Ii=function(s,i){if(!(/^file:/.test(u=s.url)||/^file:/.test(ni())&&!/^\w+:/.test(u))){if(H.fetch&&H.Request&&H.AbortController&&H.Request.prototype.hasOwnProperty("signal"))return function(f,m){const w=new H.AbortController,S=new H.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:ni(),referrerPolicy:f.referrerPolicy,signal:w.signal});let M=!1,R=!1;const L=(z=S.url).indexOf("sku=")>0&&It(z);var z;"json"===f.type&&S.headers.set("Accept","application/json");const V=(X,K,ue)=>{if(R)return;if(X&&"SecurityError"!==X.message&&cr(X.toString()),K&&ue)return G(K);const Ce=Date.now();H.fetch(S).then(Ge=>{if(Ge.ok){const nt=L?Ge.clone():null;return G(Ge,nt,Ce)}return m(new zr(Ge.statusText,Ge.status,f.url))}).catch(Ge=>{"AbortError"!==Ge.name&&m(new Error(`${Ge.message} ${f.url}`))})},G=(X,K,ue)=>{("arrayBuffer"===f.type?X.arrayBuffer():"json"===f.type?X.json():X.text()).then(Ce=>{R||(K&&ue&&function(Ge,nt,$e){if(yr(),!tn)return;const et={status:nt.status,statusText:nt.statusText,headers:new H.Headers};nt.headers.forEach((Bt,Ot)=>et.headers.set(Ot,Bt));const ct=wt(nt.headers.get("Cache-Control")||"");if(ct["no-store"])return;ct["max-age"]&&et.headers.set("Expires",new Date($e+1e3*ct["max-age"]).toUTCString());const ut=et.headers.get("Expires");ut&&(new Date(ut).getTime()-$e<42e4||function(Bt,Ot){if(void 0===Gt)try{new Response(new ReadableStream),Gt=!0}catch{Gt=!1}Gt?Ot(Bt.body):Bt.blob().then(Ot)}(nt,Bt=>{const Ot=new H.Response(Bt,et);yr(),tn&&tn.then(Yt=>Yt.put(Tn(Ge.url),Ot)).catch(Yt=>cr(Yt.message))}))}(S,K,ue),M=!0,m(null,Ce,X.headers.get("Cache-Control"),X.headers.get("Expires")))}).catch(Ce=>{R||m(new Error(Ce.message))})};return L?function(X,K){if(yr(),!tn)return K(null);const ue=Tn(X.url);tn.then(Ce=>{Ce.match(ue).then(Ge=>{const nt=function($e){if(!$e)return!1;const et=new Date($e.headers.get("Expires")||0),ct=wt($e.headers.get("Cache-Control")||"");return et>Date.now()&&!ct["no-cache"]}(Ge);Ce.delete(ue),nt&&Ce.put(ue,Ge.clone()),K(null,Ge,nt)}).catch(K)}).catch(K)}(S,V):V(null,null),{cancel:()=>{R=!0,M||w.abort()}}}(s,i);if(sr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,i,void 0,!0)}var u;return function(f,m){const w=new H.XMLHttpRequest;w.open(f.method||"GET",f.url,!0),"arrayBuffer"===f.type&&(w.responseType="arraybuffer");for(const S in f.headers)w.setRequestHeader(S,f.headers[S]);return"json"===f.type&&(w.responseType="text",w.setRequestHeader("Accept","application/json")),w.withCredentials="include"===f.credentials,w.onerror=()=>{m(new Error(w.statusText))},w.onload=()=>{if((w.status>=200&&w.status<300||0===w.status)&&null!==w.response){let S=w.response;if("json"===f.type)try{S=JSON.parse(w.response)}catch(M){return m(M)}m(null,S,w.getResponseHeader("Cache-Control"),w.getResponseHeader("Expires"))}else m(new zr(w.statusText,w.status,f.url))},w.send(f.body),{cancel:()=>w.abort()}}(s,i)},Uo=function(s,i){return Ii(Le(s,{type:"arrayBuffer"}),i)};function ys(s){const i=H.document.createElement("a");return i.href=s,i.protocol===H.document.location.protocol&&i.host===H.document.location.host}const Ke="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ge,ye;ge=[],ye=0;const We=function(s,i){if(ze.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),ye>=Ie.MAX_PARALLEL_IMAGE_REQUESTS){const w={requestParameters:s,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return ge.push(w),w}ye++;let u=!1;const f=()=>{if(!u)for(u=!0,ye--;ge.length&&ye<Ie.MAX_PARALLEL_IMAGE_REQUESTS;){const w=ge.shift(),{requestParameters:S,callback:M,cancelled:R}=w;R||(w.cancel=We(S,M).cancel)}},m=Uo(s,(w,S,M,R)=>{f(),w?i(w):S&&(H.createImageBitmap?function(L,z){const V=new H.Blob([new Uint8Array(L)],{type:"image/png"});H.createImageBitmap(V).then(G=>{z(null,G)}).catch(G=>{z(new Error(`Could not load image because of ${G.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(S,(L,z)=>i(L,z,M,R)):function(L,z){const V=new H.Image,G=H.URL;V.onload=()=>{z(null,V),G.revokeObjectURL(V.src),V.onload=null,H.requestAnimationFrame(()=>{V.src=Ke})},V.onerror=()=>z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const X=new H.Blob([new Uint8Array(L)],{type:"image/png"});V.src=L.byteLength?G.createObjectURL(X):Ke}(S,(L,z)=>i(L,z,M,R)))});return{cancel:()=>{m.cancel(),f()}}},rt="NO_ACCESS_TOKEN";function Ve(s){return 0===s.indexOf("mapbox:")}function It(s){return Ie.API_URL_REGEX.test(s)}function Ct(s){return Ie.API_CDN_URL_REGEX.test(s)}function tt(s){return Ie.API_STYLE_REGEX.test(s)&&!Ft(s)}function Ft(s){return Ie.API_SPRITE_REGEX.test(s)}const hn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function bn(s){const i=s.match(hn);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function fn(s){const i=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${i}`}const Rr="mapbox.eventData";function Ur(s){if(!s)return null;const i=s.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(H.atob(i[1]).split("").map(u=>"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Lr{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const u=Ur(Ie.ACCESS_TOKEN);let f="";return f=u&&u.u?H.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,(m,w)=>String.fromCharCode(+("0x"+w)))):Ie.ACCESS_TOKEN||"",i?`${Rr}.${i}:${f}`:`${Rr}:${f}`}fetchEventData(){const i=xe("localStorage"),u=this.getStorageKey(),f=this.getStorageKey("uuid");if(i)try{const m=H.localStorage.getItem(u);m&&(this.eventData=JSON.parse(m));const w=H.localStorage.getItem(f);w&&(this.anonId=w)}catch{cr("Unable to read from LocalStorage")}}saveEventData(){const i=xe("localStorage"),u=this.getStorageKey(),f=this.getStorageKey("uuid");if(i)try{H.localStorage.setItem(f,this.anonId),Object.keys(this.eventData).length>=1&&H.localStorage.setItem(u,JSON.stringify(this.eventData))}catch{cr("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,u,f,m){if(!Ie.EVENTS_URL)return;const w=bn(Ie.EVENTS_URL);w.params.push(`access_token=${m||Ie.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(i).toISOString()},M=u?Le(S,u):S,R={url:fn(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};var z;this.pendingRequest=(z=L=>{this.pendingRequest=null,f(L),this.saveEventData(),this.processRequests(m)},Ii(Le(R,{method:"POST"}),z))}queueRequest(i,u){this.queue.push(i),this.processRequests(u)}}const ir=new class extends Lr{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,i){Ie.EVENTS_URL&&Ie.ACCESS_TOKEN&&Array.isArray(s)&&s.some(u=>Ve(u)||It(u))&&this.queueRequest(Date.now(),i)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Ur(Ie.ACCESS_TOKEN),u=i?i.u:Ie.ACCESS_TOKEN;let f=u!==this.eventData.tokenU;Un(this.anonId)||(this.anonId=gn(),f=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),S=new Date(m),M=(m-this.eventData.lastSuccess)/864e5;f=f||M>=1||M<-1||w.getDate()!==S.getDate()}else f=!0;f?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:fe,skuId:ie,"enabled.telemetry":!1,userId:this.anonId},w=>{w||(this.eventData.lastSuccess=m,this.eventData.tokenU=u)},s):this.processRequests()}},Zr=ir.postTurnstileEvent.bind(ir),So=new class extends Lr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,i,u,f){this.skuToken=i,this.errorCb=f,Ie.EVENTS_URL&&(u||Ie.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},u):this.errorCb(new Error(rt)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:u}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),Un(this.anonId)||(this.anonId=gn()),this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:fe,skuId:ie,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):i&&(this.success[i]=!0)},s))}},Io=So.postMapLoadEvent.bind(So),Er=new class extends Lr{constructor(){super("gljs.performance")}postPerformanceEvent(s,i){Ie.EVENTS_URL&&(s||Ie.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},s)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:u}=this.queue.shift(),f=function(m){const w=H.performance.getEntriesByType("resource"),S=H.performance.getEntriesByType("mark"),M=function(G){const X={};if(G)for(const K in G)if("other"!==K)for(const ue of G[K]){const Ce=`${K}ResolveRangeMin`,Ge=`${K}ResolveRangeMax`,nt=`${K}RequestCount`,$e=`${K}RequestCachedCount`;X[Ce]=Math.min(X[Ce]||1/0,ue.startTime),X[Ge]=Math.max(X[Ge]||-1/0,ue.responseEnd);const et=ct=>{void 0===X[ct]&&(X[ct]=0),++X[ct]};void 0!==ue.transferSize&&0===ue.transferSize&&et($e),et(nt)}return X}(function(G,X){const K={};if(G)for(const ue of G){const Ce=X(ue);void 0===K[Ce]&&(K[Ce]=[]),K[Ce].push(ue)}return K}(w,el)),R=H.devicePixelRatio,L=H.navigator.connection||H.navigator.mozConnection||H.navigator.webkitConnection,z={counters:[],metadata:[],attributes:[]},V=(G,X,K)=>{null!=K&&G.push({name:X,value:K.toString()})};for(const G in M)V(z.counters,G,M[G]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(V(z.counters,"interactionRangeMin",m.interactionRange[0]),V(z.counters,"interactionRangeMax",m.interactionRange[1])),S)for(const G of Object.keys(du)){const X=du[G],K=S.find(ue=>ue.name===X);K&&V(z.counters,X,K.startTime)}return V(z.counters,"visibilityHidden",m.visibilityHidden),V(z.attributes,"style",function(G){if(G)for(const X of G){const K=X.name.split("?")[0];if(tt(K)){const ue=K.split("/").slice(-2);if(2===ue.length)return`mapbox://styles/${ue[0]}/${ue[1]}`}}}(w)),V(z.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),V(z.attributes,"fogEnabled",m.fogEnabled?"true":"false"),V(z.attributes,"projection",m.projection),V(z.attributes,"zoom",m.zoom),V(z.metadata,"devicePixelRatio",R),V(z.metadata,"connectionEffectiveType",L?L.effectiveType:void 0),V(z.metadata,"navigatorUserAgent",H.navigator.userAgent),V(z.metadata,"screenWidth",H.screen.width),V(z.metadata,"screenHeight",H.screen.height),V(z.metadata,"windowWidth",H.innerWidth),V(z.metadata,"windowHeight",H.innerHeight),V(z.metadata,"mapWidth",m.width/R),V(z.metadata,"mapHeight",m.height/R),V(z.metadata,"webglRenderer",m.renderer),V(z.metadata,"webglVendor",m.vendor),V(z.metadata,"sdkVersion",fe),V(z.metadata,"sdkIdentifier","mapbox-gl-js"),z}(u);for(const m of f.metadata);for(const m of f.counters);for(const m of f.attributes);this.postEvent(i,f,()=>{},s)}},Ti=Er.postPerformanceEvent.bind(Er),Cs=new class extends Lr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,i,u,f){if(!Ie.API_URL||!Ie.SESSION_PATH)return;const m=bn(Ie.API_URL+Ie.SESSION_PATH);m.params.push(`sku=${i||""}`),m.params.push(`access_token=${f||Ie.ACCESS_TOKEN||""}`);const w={url:fn(m),headers:{"Content-Type":"text/plain"}};var M;this.pendingRequest=(M=S=>{this.pendingRequest=null,u(S),this.saveEventData(),this.processRequests(f)},Ii(Le(w,{method:"GET"}),M))}getSessionAPI(s,i,u,f){this.skuToken=i,this.errorCb=f,Ie.SESSION_PATH&&Ie.API_URL&&(u||Ie.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},u):this.errorCb(new Error(rt)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:u}=this.queue.shift();i&&this.success[i]||this.getSession(u,this.skuToken,f=>{f?this.errorCb(f):i&&(this.success[i]=!0)},s)}},lo=Cs.getSessionAPI.bind(Cs),ai=new Set,du={create:"create",load:"load",fullLoad:"fullLoad"},co={mark(s){H.performance.mark(s)},measure(s,i,u){H.performance.measure(s,i,u)}};function el(s){const i=s.name.split("?")[0];return Ct(i)&&i.includes("mapbox-gl.js")?"javascript":Ct(i)&&i.includes("mapbox-gl.css")?"css":Ie.API_FONTS_REGEX.test(i)?"fontRange":Ft(i)?"sprite":tt(i)?"style":Ie.API_TILEJSON_REGEX.test(i)?"tilejson":"other"}const mr=H.performance;function Lh(s){const i=s?s.url.toString():void 0;return mr.getEntriesByName(i)}let mo,To,tl,Ko;const Ss={now:()=>void 0!==tl?tl:H.performance.now(),setNow(s){tl=s},restoreNow(){tl=void 0},frame(s){const i=H.requestAnimationFrame(s);return{cancel:()=>H.cancelAnimationFrame(i)}},getImageData(s,i=0){const{width:u,height:f}=s;Ko||(Ko=H.document.createElement("canvas"));const m=Ko.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(u>Ko.width||f>Ko.height)&&(Ko.width=u,Ko.height=f),m.clearRect(-i,-i,u+2*i,f+2*i),m.drawImage(s,0,0,u,f),m.getImageData(-i,-i,u+2*i,f+2*i)},resolveURL:s=>(mo||(mo=H.document.createElement("a")),mo.href=s,mo.href),get devicePixelRatio(){return H.devicePixelRatio},get prefersReducedMotion(){return!!H.matchMedia&&(null==To&&(To=H.matchMedia("(prefers-reduced-motion: reduce)")),To.matches)}};function Jo(s,i,u){u[s]&&-1!==u[s].indexOf(i)||(u[s]=u[s]||[],u[s].push(i))}function Sl(s,i,u){if(u&&u[s]){const f=u[s].indexOf(i);-1!==f&&u[s].splice(f,1)}}class ta{constructor(i,u={}){Le(this,u),this.type=i}}class Gs extends ta{constructor(i,u={}){super("error",Le({error:i},u))}}class na{on(i,u){return this._listeners=this._listeners||{},Jo(i,u,this._listeners),this}off(i,u){return Sl(i,u,this._listeners),Sl(i,u,this._oneTimeListeners),this}once(i,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},Jo(i,u,this._oneTimeListeners),this):new Promise(f=>this.once(i,f))}fire(i,u){"string"==typeof i&&(i=new ta(i,u||{}));const f=i.type;if(this.listens(f)){i.target=this;const m=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const M of m)M.call(this,i);const w=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const M of w)Sl(f,M,this._oneTimeListeners),M.call(this,i);const S=this._eventedParent;S&&(Le(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),S.fire(i))}else i instanceof Gs&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,u){return this._eventedParent=i,this._eventedParentData=u,this}}var Ht=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function pu(s,...i){for(const u of i)for(const f in u)s[f]=u[f];return s}function qo(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function _s(s){if(Array.isArray(s))return s.map(_s);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const i={};for(const u in s)i[u]=_s(s[u]);return i}return qo(s)}class Ho extends Error{constructor(i,u){super(u),this.message=u,this.key=i}}var Vo=Ho;class gu{constructor(i,u=[]){this.parent=i,this.bindings={};for(const[f,m]of u)this.bindings[f]=m}concat(i){return new gu(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}var Or=gu;const Wl={kind:"null"},nn={kind:"number"},Cr={kind:"string"},_r={kind:"boolean"},Va={kind:"color"},Bn={kind:"object"},Hr={kind:"value"},oo={kind:"collator"},nl={kind:"formatted"},ra={kind:"resolvedImage"};function cs(s,i){return{kind:"array",itemType:s,N:i}}function $n(s){if("array"===s.kind){const i=$n(s.itemType);return"number"==typeof s.N?`array<${i}, ${s.N}>`:"value"===s.itemType.kind?"array":`array<${i}>`}return s.kind}const eh=[Wl,nn,Cr,_r,Va,nl,Bn,cs(Hr),ra];function pn(s,i){if("error"===i.kind)return null;if("array"===s.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!pn(s.itemType,i.itemType))&&("number"!=typeof s.N||s.N===i.N))return null}else{if(s.kind===i.kind)return null;if("value"===s.kind)for(const u of eh)if(!pn(u,i))return null}return`Expected ${$n(s)} but found ${$n(i)} instead.`}function lc(s,i){return i.some(u=>u.kind===s.kind)}function ma(s,i){return i.some(u=>"null"===u?null===s:"array"===u?Array.isArray(s):"object"===u?s&&!Array.isArray(s)&&"object"==typeof s:u===typeof s)}var Dn,Xl={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Yn(s){return(s=Math.round(s))<0?0:s>255?255:s}function rr(s){return Yn("%"===s[s.length-1]?parseFloat(s)/100*255:parseInt(s))}function fi(s){return(i="%"===s[s.length-1]?parseFloat(s)/100:parseFloat(s))<0?0:i>1?1:i;var i}function Mo(s,i,u){return u<0?u+=1:u>1&&(u-=1),6*u<1?s+(i-s)*u*6:2*u<1?i:3*u<2?s+(i-s)*(2/3-u)*6:s}try{Dn={}.parseCSSColor=function(s){var i,u=s.replace(/ /g,"").toLowerCase();if(u in Xl)return Xl[u].slice();if("#"===u[0])return 4===u.length?(i=parseInt(u.substr(1),16))>=0&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null:7===u.length&&(i=parseInt(u.substr(1),16))>=0&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null;var f=u.indexOf("("),m=u.indexOf(")");if(-1!==f&&m+1===u.length){var w=u.substr(0,f),S=u.substr(f+1,m-(f+1)).split(","),M=1;switch(w){case"rgba":if(4!==S.length)return null;M=fi(S.pop());case"rgb":return 3!==S.length?null:[rr(S[0]),rr(S[1]),rr(S[2]),M];case"hsla":if(4!==S.length)return null;M=fi(S.pop());case"hsl":if(3!==S.length)return null;var R=(parseFloat(S[0])%360+360)%360/360,L=fi(S[1]),z=fi(S[2]),V=z<=.5?z*(L+1):z+L-z*L,G=2*z-V;return[Yn(255*Mo(G,V,R+1/3)),Yn(255*Mo(G,V,R)),Yn(255*Mo(G,V,R-1/3)),M];default:return null}}return null}}catch{}class tu{constructor(i,u,f,m=1){this.r=i,this.g=u,this.b=f,this.a=m}static parse(i){if(!i)return;if(i instanceof tu)return i;if("string"!=typeof i)return;const u=Dn(i);return u?new tu(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3]):void 0}toString(){const[i,u,f,m]=this.toArray();return`rgba(${Math.round(i)},${Math.round(u)},${Math.round(f)},${m})`}toArray(){const{r:i,g:u,b:f,a:m}=this;return 0===m?[0,0,0,0]:[255*i/m,255*u/m,255*f/m,m]}toArray01(){const{r:i,g:u,b:f,a:m}=this;return 0===m?[0,0,0,0]:[i/m,u/m,f/m,m]}toArray01PremultipliedAlpha(){const{r:i,g:u,b:f,a:m}=this;return[i,u,f,m]}}tu.black=new tu(0,0,0,1),tu.white=new tu(1,1,1,1),tu.transparent=new tu(0,0,0,0),tu.red=new tu(1,0,0,1),tu.blue=new tu(0,0,1,1);var Qo=tu;class yo{constructor(i,u,f){this.sensitivity=i?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,u){return this.collator.compare(i,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class th{constructor(i,u,f,m,w){this.text=i.normalize?i.normalize():i,this.image=u,this.scale=f,this.fontStack=m,this.textColor=w}}class es{constructor(i){this.sections=i}static fromString(i){return new es([new th(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.name.length)}static factory(i){return i instanceof es?i:es.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const u of this.sections){if(u.image){i.push(["image",u.image.name]);continue}i.push(u.text);const f={};u.fontStack&&(f["text-font"]=["literal",u.fontStack.split(",")]),u.scale&&(f["font-scale"]=u.scale),u.textColor&&(f["text-color"]=["rgba"].concat(u.textColor.toArray())),i.push(f)}return i}}class Kr{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Kr({name:i,available:!1}):null}serialize(){return["image",this.name]}}function mu(s,i,u,f){return"number"==typeof s&&s>=0&&s<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof u&&u>=0&&u<=255?void 0===f||"number"==typeof f&&f>=0&&f<=1?null:`Invalid rgba value [${[s,i,u,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof f?[s,i,u,f]:[s,i,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function vs(s){if(null===s||"string"==typeof s||"boolean"==typeof s||"number"==typeof s||s instanceof Qo||s instanceof yo||s instanceof es||s instanceof Kr)return!0;if(Array.isArray(s)){for(const i of s)if(!vs(i))return!1;return!0}if("object"==typeof s){for(const i in s)if(!vs(s[i]))return!1;return!0}return!1}function ss(s){if(null===s)return Wl;if("string"==typeof s)return Cr;if("boolean"==typeof s)return _r;if("number"==typeof s)return nn;if(s instanceof Qo)return Va;if(s instanceof yo)return oo;if(s instanceof es)return nl;if(s instanceof Kr)return ra;if(Array.isArray(s)){const i=s.length;let u;for(const f of s){const m=ss(f);if(u){if(u===m)continue;u=Hr;break}u=m}return cs(u||Hr,i)}return Bn}function Il(s){const i=typeof s;return null===s?"":"string"===i||"number"===i||"boolean"===i?String(s):s instanceof Qo||s instanceof es||s instanceof Kr?s.toString():JSON.stringify(s)}class Do{constructor(i,u){this.type=i,this.value=u}static parse(i,u){if(2!==i.length)return u.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!vs(i[1]))return u.error("invalid value");const f=i[1];let m=ss(f);const w=u.expectedType;return"array"!==m.kind||0!==m.N||!w||"array"!==w.kind||"number"==typeof w.N&&0!==w.N||(m=w),new Do(m,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Qo?["rgba"].concat(this.value.toArray()):this.value instanceof es?this.value.serialize():this.value}}var xs=Do,Is=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const ja={string:Cr,number:nn,boolean:_r,object:Bn};class $u{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");let f,m=1;const w=i[0];if("array"===w){let M,R;if(i.length>2){const L=i[1];if("string"!=typeof L||!(L in ja)||"object"===L)return u.error('The item type argument of "array" must be one of string, number, boolean',1);M=ja[L],m++}else M=Hr;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return u.error('The length argument to "array" must be a positive integer literal',2);R=i[2],m++}f=cs(M,R)}else f=ja[w];const S=[];for(;m<i.length;m++){const M=u.parse(i[m],m,Hr);if(!M)return null;S.push(M)}return new $u(f,S)}evaluate(i){for(let u=0;u<this.args.length;u++){const f=this.args[u].evaluate(i);if(!pn(this.type,ss(f)))return f;if(u===this.args.length-1)throw new Is(`Expected value to be of type ${$n(this.type)}, but found ${$n(ss(f))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,u=[i.kind];if("array"===i.kind){const f=i.itemType;if("string"===f.kind||"number"===f.kind||"boolean"===f.kind){u.push(f.kind);const m=i.N;("number"==typeof m||this.args.length>1)&&u.push(m)}}return u.concat(this.args.map(f=>f.serialize()))}}var Ao=$u;class Jr{constructor(i){this.type=nl,this.sections=i}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");const f=i[1];if(!Array.isArray(f)&&"object"==typeof f)return u.error("First argument must be an image or text section.");const m=[];let w=!1;for(let S=1;S<=i.length-1;++S){const M=i[S];if(w&&"object"==typeof M&&!Array.isArray(M)){w=!1;let R=null;if(M["font-scale"]&&(R=u.parse(M["font-scale"],1,nn),!R))return null;let L=null;if(M["text-font"]&&(L=u.parse(M["text-font"],1,cs(Cr)),!L))return null;let z=null;if(M["text-color"]&&(z=u.parse(M["text-color"],1,Va),!z))return null;const V=m[m.length-1];V.scale=R,V.font=L,V.textColor=z}else{const R=u.parse(i[S],1,Hr);if(!R)return null;const L=R.type.kind;if("string"!==L&&"value"!==L&&"null"!==L&&"resolvedImage"!==L)return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,m.push({content:R,scale:null,font:null,textColor:null})}}return new Jr(m)}evaluate(i){return new es(this.sections.map(u=>{const f=u.content.evaluate(i);return ss(f)===ra?new th("",f,null,null,null):new th(Il(f),null,u.scale?u.scale.evaluate(i):null,u.font?u.font.evaluate(i).join(","):null,u.textColor?u.textColor.evaluate(i):null)}))}eachChild(i){for(const u of this.sections)i(u.content),u.scale&&i(u.scale),u.font&&i(u.font),u.textColor&&i(u.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const u of this.sections){i.push(u.content.serialize());const f={};u.scale&&(f["font-scale"]=u.scale.serialize()),u.font&&(f["text-font"]=u.font.serialize()),u.textColor&&(f["text-color"]=u.textColor.serialize()),i.push(f)}return i}}class ts{constructor(i){this.type=ra,this.input=i}static parse(i,u){if(2!==i.length)return u.error("Expected two arguments.");const f=u.parse(i[1],1,Cr);return f?new ts(f):u.error("No image name provided.")}evaluate(i){const u=this.input.evaluate(i),f=Kr.fromString(u);return f&&i.availableImages&&(f.available=i.availableImages.indexOf(u)>-1),f}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const np={"to-boolean":_r,"to-color":Va,"to-number":nn,"to-string":Cr};class nu{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");const f=i[0];if(("to-boolean"===f||"to-string"===f)&&2!==i.length)return u.error("Expected one argument.");const m=np[f],w=[];for(let S=1;S<i.length;S++){const M=u.parse(i[S],S,Hr);if(!M)return null;w.push(M)}return new nu(m,w)}evaluate(i){if("boolean"===this.type.kind)return!!this.args[0].evaluate(i);if("color"===this.type.kind){let u,f;for(const m of this.args){if(u=m.evaluate(i),f=null,u instanceof Qo)return u;if("string"==typeof u){const w=i.parseColor(u);if(w)return w}else if(Array.isArray(u)&&(f=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:mu(u[0],u[1],u[2],u[3]),!f))return new Qo(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new Is(f||`Could not parse color from value '${"string"==typeof u?u:String(JSON.stringify(u))}'`)}if("number"===this.type.kind){let u=null;for(const f of this.args){if(u=f.evaluate(i),null===u)return 0;const m=Number(u);if(!isNaN(m))return m}throw new Is(`Could not convert ${JSON.stringify(u)} to number.`)}return"formatted"===this.type.kind?es.fromString(Il(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?Kr.fromString(Il(this.args[0].evaluate(i))):Il(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Jr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ts(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(u=>{i.push(u.serialize())}),i}}var Vn=nu;const _o=["Unknown","Point","LineString","Polygon"];var yu=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?_o[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:u,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*i-s[0])+this.featureDistanceData.bearing[1]*(f*i-s[1])}return 0}parseColor(s){let i=this._parseColorCache[s];return i||(i=this._parseColorCache[s]=Qo.parse(s)),i}};class rl{constructor(i,u,f,m){this.name=i,this.type=u,this._evaluate=f,this.args=m}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,u){const f=i[0],m=rl.definitions[f];if(!m)return u.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(m)?m[0]:m.type,S=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,M=S.filter(([L])=>!Array.isArray(L)||L.length===i.length-1);let R=null;for(const[L,z]of M){R=new Dl(u.registry,u.path,null,u.scope);const V=[];let G=!1;for(let X=1;X<i.length;X++){const K=i[X],ue=Array.isArray(L)?L[X-1]:L.type,Ce=R.parse(K,1+V.length,ue);if(!Ce){G=!0;break}V.push(Ce)}if(!G)if(Array.isArray(L)&&L.length!==V.length)R.error(`Expected ${L.length} arguments, but found ${V.length} instead.`);else{for(let X=0;X<V.length;X++){const K=Array.isArray(L)?L[X]:L.type,ue=V[X];R.concat(X+1).checkSubtype(K,ue.type)}if(0===R.errors.length)return new rl(f,w,z,V)}}if(1===M.length)u.errors.push(...R.errors);else{const L=(M.length?M:S).map(([V])=>{return G=V,Array.isArray(G)?`(${G.map($n).join(", ")})`:`(${$n(G.type)}...)`;var G}).join(" | "),z=[];for(let V=1;V<i.length;V++){const G=u.parse(i[V],1+z.length);if(!G)return null;z.push($n(G.type))}u.error(`Expected arguments of type ${L}, but found (${z.join(", ")}) instead.`)}return null}static register(i,u){rl.definitions=u;for(const f in u)i[f]=rl}}var ru=rl;class cc{constructor(i,u,f){this.type=oo,this.locale=f,this.caseSensitive=i,this.diacriticSensitive=u}static parse(i,u){if(2!==i.length)return u.error("Expected one argument.");const f=i[1];if("object"!=typeof f||Array.isArray(f))return u.error("Collator options argument must be an object.");const m=u.parse(void 0!==f["case-sensitive"]&&f["case-sensitive"],1,_r);if(!m)return null;const w=u.parse(void 0!==f["diacritic-sensitive"]&&f["diacritic-sensitive"],1,_r);if(!w)return null;let S=null;return f.locale&&(S=u.parse(f.locale,1,Cr),!S)?null:new cc(m,w,S)}evaluate(i){return new yo(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const il=8192;function Ts(s,i){s[0]=Math.min(s[0],i[0]),s[1]=Math.min(s[1],i[1]),s[2]=Math.max(s[2],i[0]),s[3]=Math.max(s[3],i[1])}function ya(s,i){return!(s[0]<=i[0]||s[2]>=i[2]||s[1]<=i[1]||s[3]>=i[3])}function as(s,i){const u=(180+s[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,m=Math.pow(2,i.z);return[Math.round(u*m*il),Math.round(f*m*il)]}function Tl(s,i,u){const f=s[0]-i[0],m=s[1]-i[1],w=s[0]-u[0],S=s[1]-u[1];return f*S-w*m==0&&f*w<=0&&m*S<=0}function iu(s,i){let u=!1;for(let S=0,M=i.length;S<M;S++){const R=i[S];for(let L=0,z=R.length;L<z-1;L++){if(Tl(s,R[L],R[L+1]))return!1;(m=R[L])[1]>(f=s)[1]!=(w=R[L+1])[1]>f[1]&&f[0]<(w[0]-m[0])*(f[1]-m[1])/(w[1]-m[1])+m[0]&&(u=!u)}}var f,m,w;return u}function pr(s,i){for(let u=0;u<i.length;u++)if(iu(s,i[u]))return!0;return!1}function vo(s,i,u,f){const m=f[0]-u[0],w=f[1]-u[1],S=(s[0]-u[0])*w-m*(s[1]-u[1]),M=(i[0]-u[0])*w-m*(i[1]-u[1]);return S>0&&M<0||S<0&&M>0}function Hn(s,i,u){for(const L of u)for(let z=0;z<L.length-1;++z)if((M=[(S=L[z+1])[0]-(w=L[z])[0],S[1]-w[1]])[0]*(R=[(m=i)[0]-(f=s)[0],m[1]-f[1]])[1]-M[1]*R[0]!=0&&vo(f,m,w,S)&&vo(w,S,f,m))return!0;var f,m,w,S,M,R;return!1}function kr(s,i){for(let u=0;u<s.length;++u)if(!iu(s[u],i))return!1;for(let u=0;u<s.length-1;++u)if(Hn(s[u],s[u+1],i))return!1;return!0}function Ac(s,i){for(let u=0;u<i.length;u++)if(kr(s,i[u]))return!0;return!1}function _a(s,i,u){const f=[];for(let m=0;m<s.length;m++){const w=[];for(let S=0;S<s[m].length;S++){const M=as(s[m][S],u);Ts(i,M),w.push(M)}f.push(w)}return f}function di(s,i,u){const f=[];for(let m=0;m<s.length;m++){const w=_a(s[m],i,u);f.push(w)}return f}function Ml(s,i,u,f){if(s[0]<u[0]||s[0]>u[2]){const m=.5*f;let w=s[0]-u[0]>m?-f:u[0]-s[0]>m?f:0;0===w&&(w=s[0]-u[2]>m?-f:u[2]-s[0]>m?f:0),s[0]+=w}Ts(i,s)}function nh(s,i,u,f){const m=Math.pow(2,f.z)*il,w=[f.x*il,f.y*il],S=[];if(!s)return S;for(const M of s)for(const R of M){const L=[R.x+w[0],R.y+w[1]];Ml(L,i,u,m),S.push(L)}return S}function Oh(s,i,u,f){const m=Math.pow(2,f.z)*il,w=[f.x*il,f.y*il],S=[];if(!s)return S;for(const R of s){const L=[];for(const z of R){const V=[z.x+w[0],z.y+w[1]];Ts(i,V),L.push(V)}S.push(L)}if(i[2]-i[0]<=m/2){(M=i)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const R of S)for(const L of R)Ml(L,i,u,m)}var M;return S}class qu{constructor(i,u){this.type=_r,this.geojson=i,this.geometries=u}static parse(i,u){if(2!==i.length)return u.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(vs(i[1])){const f=i[1];if("FeatureCollection"===f.type)for(let m=0;m<f.features.length;++m){const w=f.features[m].geometry.type;if("Polygon"===w||"MultiPolygon"===w)return new qu(f,f.features[m].geometry)}else if("Feature"===f.type){const m=f.geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new qu(f,f.geometry)}else if("Polygon"===f.type||"MultiPolygon"===f.type)return new qu(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(u,f){const m=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],S=u.canonicalID();if(!S)return!1;if("Polygon"===f.type){const M=_a(f.coordinates,w,S),R=nh(u.geometry(),m,w,S);if(!ya(m,w))return!1;for(const L of R)if(!iu(L,M))return!1}if("MultiPolygon"===f.type){const M=di(f.coordinates,w,S),R=nh(u.geometry(),m,w,S);if(!ya(m,w))return!1;for(const L of R)if(!pr(L,M))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(u,f){const m=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],S=u.canonicalID();if(!S)return!1;if("Polygon"===f.type){const M=_a(f.coordinates,w,S),R=Oh(u.geometry(),m,w,S);if(!ya(m,w))return!1;for(const L of R)if(!kr(L,M))return!1}if("MultiPolygon"===f.type){const M=di(f.coordinates,w,S),R=Oh(u.geometry(),m,w,S);if(!ya(m,w))return!1;for(const L of R)if(!Ac(L,M))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var ri=qu;function ia(s){if(s instanceof ru&&("get"===s.name&&1===s.args.length||"feature-state"===s.name||"has"===s.name&&1===s.args.length||"properties"===s.name||"geometry-type"===s.name||"id"===s.name||/^filter-/.test(s.name))||s instanceof ri)return!1;let i=!0;return s.eachChild(u=>{i&&!ia(u)&&(i=!1)}),i}function Ci(s){if(s instanceof ru&&"feature-state"===s.name)return!1;let i=!0;return s.eachChild(u=>{i&&!Ci(u)&&(i=!1)}),i}function Hu(s,i){if(s instanceof ru&&i.indexOf(s.name)>=0)return!1;let u=!0;return s.eachChild(f=>{u&&!Hu(f,i)&&(u=!1)}),u}class oa{constructor(i,u){this.type=u.type,this.name=i,this.boundExpression=u}static parse(i,u){if(2!==i.length||"string"!=typeof i[1])return u.error("'var' expression requires exactly one string literal argument.");const f=i[1];return u.scope.has(f)?new oa(f,u.scope.get(f)):u.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Nh=oa;class Dr{constructor(i,u=[],f,m=new Or,w=[]){this.registry=i,this.path=u,this.key=u.map(S=>`[${S}]`).join(""),this.scope=m,this.errors=w,this.expectedType=f}parse(i,u,f,m,w={}){return u?this.concat(u,f,m)._parse(i,w):this._parse(i,w)}_parse(i,u){function f(m,w,S){return"assert"===S?new Ao(w,[m]):"coerce"===S?new Vn(w,[m]):m}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=i[0];if("string"!=typeof m)return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[m];if(w){let S=w.parse(i,this);if(!S)return null;if(this.expectedType){const M=this.expectedType,R=S.type;if("string"!==M.kind&&"number"!==M.kind&&"boolean"!==M.kind&&"object"!==M.kind&&"array"!==M.kind||"value"!==R.kind)if("color"!==M.kind&&"formatted"!==M.kind&&"resolvedImage"!==M.kind||"value"!==R.kind&&"string"!==R.kind){if(this.checkSubtype(M,R))return null}else S=f(S,M,u.typeAnnotation||"coerce");else S=f(S,M,u.typeAnnotation||"assert")}if(!(S instanceof xs)&&"resolvedImage"!==S.type.kind&&gi(S)){const M=new yu;try{S=new xs(S.type,S.evaluate(M))}catch(R){return this.error(R.message),null}}return S}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,u,f){const m="number"==typeof i?this.path.concat(i):this.path,w=f?this.scope.concat(f):this.scope;return new Dr(this.registry,m,u||null,w,this.errors)}error(i,...u){const f=`${this.key}${u.map(m=>`[${m}]`).join("")}`;this.errors.push(new Vo(f,i))}checkSubtype(i,u){const f=pn(i,u);return f&&this.error(f),f}}var Dl=Dr;function gi(s){if(s instanceof Nh)return gi(s.boundExpression);if(s instanceof ru&&"error"===s.name||s instanceof cc||s instanceof ri)return!1;const i=s instanceof Vn||s instanceof Ao;let u=!0;return s.eachChild(f=>{u=i?u&&gi(f):u&&f instanceof xs}),!!u&&ia(s)&&Hu(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Zl(s,i){const u=s.length-1;let f,m,w=0,S=u,M=0;for(;w<=S;)if(M=Math.floor((w+S)/2),f=s[M],m=s[M+1],f<=i){if(M===u||i<m)return M;w=M+1}else{if(!(f>i))throw new Is("Input is not a number.");S=M-1}return 0}class Wn{constructor(i,u,f){this.type=i,this.input=u,this.labels=[],this.outputs=[];for(const[m,w]of f)this.labels.push(m),this.outputs.push(w)}static parse(i,u){if(i.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return u.error("Expected an even number of arguments.");const f=u.parse(i[1],1,nn);if(!f)return null;const m=[];let w=null;u.expectedType&&"value"!==u.expectedType.kind&&(w=u.expectedType);for(let S=1;S<i.length;S+=2){const M=1===S?-1/0:i[S],R=i[S+1],L=S,z=S+1;if("number"!=typeof M)return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(m.length&&m[m.length-1][0]>=M)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const V=u.parse(R,z,w);if(!V)return null;w=w||V.type,m.push([M,V])}return new Wn(w,f,m)}evaluate(i){const u=this.labels,f=this.outputs;if(1===u.length)return f[0].evaluate(i);const m=this.input.evaluate(i);if(m<=u[0])return f[0].evaluate(i);const w=u.length;return m>=u[w-1]?f[w-1].evaluate(i):f[Zl(u,m)].evaluate(i)}eachChild(i){i(this.input);for(const u of this.outputs)i(u)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let u=0;u<this.labels.length;u++)u>0&&i.push(this.labels[u]),i.push(this.outputs[u].serialize());return i}}var ol=Wn;function In(s,i,u){return s*(1-u)+i*u}var Ga=Object.freeze({__proto__:null,array:function(s,i,u){return s.map((f,m)=>In(f,i[m],u))},color:function(s,i,u){return new Qo(In(s.r,i.r,u),In(s.g,i.g,u),In(s.b,i.b,u),In(s.a,i.a,u))},number:In});const hc=4/29,va=6/29,xa=3*va*va,jo=va*va*va,sl=Math.PI/180,ou=180/Math.PI;function $s(s){return s>jo?Math.pow(s,1/3):s/xa+hc}function Wr(s){return s>va?s*s*s:xa*(s-hc)}function _u(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Bs(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function $a(s){const i=Bs(s.r),u=Bs(s.g),f=Bs(s.b),m=$s((.4124564*i+.3575761*u+.1804375*f)/.95047),w=$s((.2126729*i+.7151522*u+.072175*f)/1);return{l:116*w-16,a:500*(m-w),b:200*(w-$s((.0193339*i+.119192*u+.9503041*f)/1.08883)),alpha:s.a}}function vu(s){let i=(s.l+16)/116,u=isNaN(s.a)?i:i+s.a/500,f=isNaN(s.b)?i:i-s.b/200;return i=1*Wr(i),u=.95047*Wr(u),f=1.08883*Wr(f),new Qo(_u(3.2404542*u-1.5371385*i-.4985314*f),_u(-.969266*u+1.8760108*i+.041556*f),_u(.0556434*u-.2040259*i+1.0572252*f),s.alpha)}function Aa(s,i,u){const f=i-s;return s+u*(f>180||f<-180?f-360*Math.round(f/360):f)}const sa={forward:$a,reverse:vu,interpolate:function(s,i,u){return{l:In(s.l,i.l,u),a:In(s.a,i.a,u),b:In(s.b,i.b,u),alpha:In(s.alpha,i.alpha,u)}}},Wo={forward:function(s){const{l:i,a:u,b:f}=$a(s),m=Math.atan2(f,u)*ou;return{h:m<0?m+360:m,c:Math.sqrt(u*u+f*f),l:i,alpha:s.a}},reverse:function(s){const i=s.h*sl,u=s.c;return vu({l:s.l,a:Math.cos(i)*u,b:Math.sin(i)*u,alpha:s.alpha})},interpolate:function(s,i,u){return{h:Aa(s.h,i.h,u),c:In(s.c,i.c,u),l:In(s.l,i.l,u),alpha:In(s.alpha,i.alpha,u)}}};var rh=Object.freeze({__proto__:null,hcl:Wo,lab:sa});class al{constructor(i,u,f,m,w){this.type=i,this.operator=u,this.interpolation=f,this.input=m,this.labels=[],this.outputs=[];for(const[S,M]of w)this.labels.push(S),this.outputs.push(M)}static interpolationFactor(i,u,f,m){let w=0;if("exponential"===i.name)w=Ms(u,i.base,f,m);else if("linear"===i.name)w=Ms(u,1,f,m);else if("cubic-bezier"===i.name){const S=i.controlPoints;w=new Y(S[0],S[1],S[2],S[3]).solve(Ms(u,1,f,m))}return w}static parse(i,u){let[f,m,w,...S]=i;if(!Array.isArray(m)||0===m.length)return u.error("Expected an interpolation type expression.",1);if("linear"===m[0])m={name:"linear"};else if("exponential"===m[0]){const L=m[1];if("number"!=typeof L)return u.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:L}}else{if("cubic-bezier"!==m[0])return u.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const L=m.slice(1);if(4!==L.length||L.some(z=>"number"!=typeof z||z<0||z>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:L}}}if(i.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(w=u.parse(w,2,nn),!w)return null;const M=[];let R=null;"interpolate-hcl"===f||"interpolate-lab"===f?R=Va:u.expectedType&&"value"!==u.expectedType.kind&&(R=u.expectedType);for(let L=0;L<S.length;L+=2){const z=S[L],V=S[L+1],G=L+3,X=L+4;if("number"!=typeof z)return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(M.length&&M[M.length-1][0]>=z)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',G);const K=u.parse(V,X,R);if(!K)return null;R=R||K.type,M.push([z,K])}return"number"===R.kind||"color"===R.kind||"array"===R.kind&&"number"===R.itemType.kind&&"number"==typeof R.N?new al(R,f,m,w,M):u.error(`Type ${$n(R)} is not interpolatable.`)}evaluate(i){const u=this.labels,f=this.outputs;if(1===u.length)return f[0].evaluate(i);const m=this.input.evaluate(i);if(m<=u[0])return f[0].evaluate(i);const w=u.length;if(m>=u[w-1])return f[w-1].evaluate(i);const S=Zl(u,m),M=al.interpolationFactor(this.interpolation,m,u[S],u[S+1]),R=f[S].evaluate(i),L=f[S+1].evaluate(i);return"interpolate"===this.operator?Ga[this.type.kind.toLowerCase()](R,L,M):"interpolate-hcl"===this.operator?Wo.reverse(Wo.interpolate(Wo.forward(R),Wo.forward(L),M)):sa.reverse(sa.interpolate(sa.forward(R),sa.forward(L),M))}eachChild(i){i(this.input);for(const u of this.outputs)i(u)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const u=[this.operator,i,this.input.serialize()];for(let f=0;f<this.labels.length;f++)u.push(this.labels[f],this.outputs[f].serialize());return u}}function Ms(s,i,u,f){const m=f-u,w=s-u;return 0===m?0:1===i?w/m:(Math.pow(i,w)-1)/(Math.pow(i,m)-1)}var qs=al;class Hs{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expectected at least one argument.");let f=null;const m=u.expectedType;m&&"value"!==m.kind&&(f=m);const w=[];for(const M of i.slice(1)){const R=u.parse(M,1+w.length,f,void 0,{typeAnnotation:"omit"});if(!R)return null;f=f||R.type,w.push(R)}const S=m&&w.some(M=>pn(m,M.type));return new Hs(S?Hr:f,w)}evaluate(i){let u,f=null,m=0;for(const w of this.args){if(m++,f=w.evaluate(i),f&&f instanceof Kr&&!f.available&&(u||(u=f),f=null,m===this.args.length))return u;if(null!==f)break}return f}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(u=>{i.push(u.serialize())}),i}}var ih=Hs;class Ds{constructor(i,u){this.type=u.type,this.bindings=[].concat(i),this.result=u}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const u of this.bindings)i(u[1]);i(this.result)}static parse(i,u){if(i.length<4)return u.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const f=[];for(let w=1;w<i.length-1;w+=2){const S=i[w];if("string"!=typeof S)return u.error(`Expected string, but found ${typeof S} instead.`,w);if(/[^a-zA-Z0-9_]/.test(S))return u.error("Variable names must contain only alphanumeric characters or '_'.",w);const M=u.parse(i[w+1],w+1);if(!M)return null;f.push([S,M])}const m=u.parse(i[i.length-1],i.length-1,u.expectedType,f);return m?new Ds(f,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[u,f]of this.bindings)i.push(u,f.serialize());return i.push(this.result.serialize()),i}}var xf=Ds;class Yl{constructor(i,u,f){this.type=i,this.index=u,this.input=f}static parse(i,u){if(3!==i.length)return u.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=u.parse(i[1],1,nn),m=u.parse(i[2],2,cs(u.expectedType||Hr));return f&&m?new Yl(m.type.itemType,f,m):null}evaluate(i){const u=this.index.evaluate(i),f=this.input.evaluate(i);if(u<0)throw new Is(`Array index out of bounds: ${u} < 0.`);if(u>=f.length)throw new Is(`Array index out of bounds: ${u} > ${f.length-1}.`);if(u!==Math.floor(u))throw new Is(`Array index must be an integer, but found ${u} instead.`);return f[u]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Pc=Yl;class kh{constructor(i,u){this.type=_r,this.needle=i,this.haystack=u}static parse(i,u){if(3!==i.length)return u.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=u.parse(i[1],1,Hr),m=u.parse(i[2],2,Hr);return f&&m?lc(f.type,[_r,Cr,nn,Wl,Hr])?new kh(f,m):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${$n(f.type)} instead`):null}evaluate(i){const u=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(null==f)return!1;if(!ma(u,["boolean","string","number","null"]))throw new Is(`Expected first argument to be of type boolean, string, number or null, but found ${$n(ss(u))} instead.`);if(!ma(f,["string","array"]))throw new Is(`Expected second argument to be of type array or string, but found ${$n(ss(f))} instead.`);return f.indexOf(u)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var qa=kh;class Wu{constructor(i,u,f){this.type=nn,this.needle=i,this.haystack=u,this.fromIndex=f}static parse(i,u){if(i.length<=2||i.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=u.parse(i[1],1,Hr),m=u.parse(i[2],2,Hr);if(!f||!m)return null;if(!lc(f.type,[_r,Cr,nn,Wl,Hr]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${$n(f.type)} instead`);if(4===i.length){const w=u.parse(i[3],3,nn);return w?new Wu(f,m,w):null}return new Wu(f,m)}evaluate(i){const u=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!ma(u,["boolean","string","number","null"]))throw new Is(`Expected first argument to be of type boolean, string, number or null, but found ${$n(ss(u))} instead.`);if(!ma(f,["string","array"]))throw new Is(`Expected second argument to be of type array or string, but found ${$n(ss(f))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(i);return f.indexOf(u,m)}return f.indexOf(u)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var xu=Wu;class ws{constructor(i,u,f,m,w,S){this.inputType=i,this.type=u,this.input=f,this.cases=m,this.outputs=w,this.otherwise=S}static parse(i,u){if(i.length<5)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return u.error("Expected an even number of arguments.");let f,m;u.expectedType&&"value"!==u.expectedType.kind&&(m=u.expectedType);const w={},S=[];for(let L=2;L<i.length-1;L+=2){let z=i[L];const V=i[L+1];Array.isArray(z)||(z=[z]);const G=u.concat(L);if(0===z.length)return G.error("Expected at least one branch label.");for(const K of z){if("number"!=typeof K&&"string"!=typeof K)return G.error("Branch labels must be numbers or strings.");if("number"==typeof K&&Math.abs(K)>Number.MAX_SAFE_INTEGER)return G.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof K&&Math.floor(K)!==K)return G.error("Numeric branch labels must be integer values.");if(f){if(G.checkSubtype(f,ss(K)))return null}else f=ss(K);if(void 0!==w[String(K)])return G.error("Branch labels must be unique.");w[String(K)]=S.length}const X=u.parse(V,L,m);if(!X)return null;m=m||X.type,S.push(X)}const M=u.parse(i[1],1,Hr);if(!M)return null;const R=u.parse(i[i.length-1],i.length-1,m);return R?"value"!==M.type.kind&&u.concat(1).checkSubtype(f,M.type)?null:new ws(f,m,M,w,S,R):null}evaluate(i){const u=this.input.evaluate(i);return(ss(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],u=Object.keys(this.cases).sort(),f=[],m={};for(const S of u){const M=m[this.cases[S]];void 0===M?(m[this.cases[S]]=f.length,f.push([this.cases[S],[S]])):f[M][1].push(S)}const w=S=>"number"===this.inputType.kind?Number(S):S;for(const[S,M]of f)i.push(1===M.length?w(M[0]):M.map(w)),i.push(this.outputs[S].serialize());return i.push(this.otherwise.serialize()),i}}var Rc=ws;class zs{constructor(i,u,f){this.type=i,this.branches=u,this.otherwise=f}static parse(i,u){if(i.length<4)return u.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return u.error("Expected an odd number of arguments.");let f;u.expectedType&&"value"!==u.expectedType.kind&&(f=u.expectedType);const m=[];for(let S=1;S<i.length-1;S+=2){const M=u.parse(i[S],S,_r);if(!M)return null;const R=u.parse(i[S+1],S+1,f);if(!R)return null;m.push([M,R]),f=f||R.type}const w=u.parse(i[i.length-1],i.length-1,f);return w?new zs(f,m,w):null}evaluate(i){for(const[u,f]of this.branches)if(u.evaluate(i))return f.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[u,f]of this.branches)i(u),i(f);i(this.otherwise)}outputDefined(){return this.branches.every(([i,u])=>u.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(u=>{i.push(u.serialize())}),i}}var Ru=zs;class wu{constructor(i,u,f,m){this.type=i,this.input=u,this.beginIndex=f,this.endIndex=m}static parse(i,u){if(i.length<=2||i.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=u.parse(i[1],1,Hr),m=u.parse(i[2],2,nn);if(!f||!m)return null;if(!lc(f.type,[cs(Hr),Cr,Hr]))return u.error(`Expected first argument to be of type array or string, but found ${$n(f.type)} instead`);if(4===i.length){const w=u.parse(i[3],3,nn);return w?new wu(f.type,f,m,w):null}return new wu(f.type,f,m)}evaluate(i){const u=this.input.evaluate(i),f=this.beginIndex.evaluate(i);if(!ma(u,["string","array"]))throw new Is(`Expected first argument to be of type array or string, but found ${$n(ss(u))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(i);return u.slice(f,m)}return u.slice(f)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Fh=wu;function ul(s,i){return"=="===s||"!="===s?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function ll(s,i,u,f){return 0===f.compare(i,u)}function Ws(s,i,u){const f="=="!==s&&"!="!==s;return class TR{constructor(w,S,M){this.type=_r,this.lhs=w,this.rhs=S,this.collator=M,this.hasUntypedArgument="value"===w.type.kind||"value"===S.type.kind}static parse(w,S){if(3!==w.length&&4!==w.length)return S.error("Expected two or three arguments.");const M=w[0];let R=S.parse(w[1],1,Hr);if(!R)return null;if(!ul(M,R.type))return S.concat(1).error(`"${M}" comparisons are not supported for type '${$n(R.type)}'.`);let L=S.parse(w[2],2,Hr);if(!L)return null;if(!ul(M,L.type))return S.concat(2).error(`"${M}" comparisons are not supported for type '${$n(L.type)}'.`);if(R.type.kind!==L.type.kind&&"value"!==R.type.kind&&"value"!==L.type.kind)return S.error(`Cannot compare types '${$n(R.type)}' and '${$n(L.type)}'.`);f&&("value"===R.type.kind&&"value"!==L.type.kind?R=new Ao(L.type,[R]):"value"!==R.type.kind&&"value"===L.type.kind&&(L=new Ao(R.type,[L])));let z=null;if(4===w.length){if("string"!==R.type.kind&&"string"!==L.type.kind&&"value"!==R.type.kind&&"value"!==L.type.kind)return S.error("Cannot use collator to compare non-string types.");if(z=S.parse(w[3],3,oo),!z)return null}return new TR(R,L,z)}evaluate(w){const S=this.lhs.evaluate(w),M=this.rhs.evaluate(w);if(f&&this.hasUntypedArgument){const R=ss(S),L=ss(M);if(R.kind!==L.kind||"string"!==R.kind&&"number"!==R.kind)throw new Is(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${R.kind}, ${L.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const R=ss(S),L=ss(M);if("string"!==R.kind||"string"!==L.kind)return i(w,S,M)}return this.collator?u(w,S,M,this.collator.evaluate(w)):i(w,S,M)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}serialize(){const w=[s];return this.eachChild(S=>{w.push(S.serialize())}),w}}}const Us=Ws("==",function(s,i,u){return i===u},ll),bu=Ws("!=",function(s,i,u){return i!==u},function(s,i,u,f){return!ll(0,i,u,f)}),aa=Ws("<",function(s,i,u){return i<u},function(s,i,u,f){return f.compare(i,u)<0}),Kl=Ws(">",function(s,i,u){return i>u},function(s,i,u,f){return f.compare(i,u)>0}),Al=Ws("<=",function(s,i,u){return i<=u},function(s,i,u,f){return f.compare(i,u)<=0}),Pl=Ws(">=",function(s,i,u){return i>=u},function(s,i,u,f){return f.compare(i,u)>=0});class mi{constructor(i,u,f,m,w,S){this.type=Cr,this.number=i,this.locale=u,this.currency=f,this.unit=m,this.minFractionDigits=w,this.maxFractionDigits=S}static parse(i,u){if(3!==i.length)return u.error("Expected two arguments.");const f=u.parse(i[1],1,nn);if(!f)return null;const m=i[2];if("object"!=typeof m||Array.isArray(m))return u.error("NumberFormat options argument must be an object.");let w=null;if(m.locale&&(w=u.parse(m.locale,1,Cr),!w))return null;let S=null;if(m.currency&&(S=u.parse(m.currency,1,Cr),!S))return null;let M=null;if(m.unit&&(M=u.parse(m.unit,1,Cr),!M))return null;let R=null;if(m["min-fraction-digits"]&&(R=u.parse(m["min-fraction-digits"],1,nn),!R))return null;let L=null;return m["max-fraction-digits"]&&(L=u.parse(m["max-fraction-digits"],1,nn),!L)?null:new mi(f,w,S,M,R,L)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class yi{constructor(i){this.type=nn,this.input=i}static parse(i,u){if(2!==i.length)return u.error(`Expected 1 argument, but found ${i.length-1} instead.`);const f=u.parse(i[1],1);return f?"array"!==f.type.kind&&"string"!==f.type.kind&&"value"!==f.type.kind?u.error(`Expected argument of type string or array, but found ${$n(f.type)} instead.`):new yi(f):null}evaluate(i){const u=this.input.evaluate(i);if("string"==typeof u||Array.isArray(u))return u.length;throw new Is(`Expected value to be of type string or array, but found ${$n(ss(u))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(u=>{i.push(u.serialize())}),i}}const Qr={"==":Us,"!=":bu,">":Kl,"<":aa,">=":Pl,"<=":Al,array:Ao,at:Pc,boolean:Ao,case:Ru,coalesce:ih,collator:cc,format:Jr,image:ts,in:qa,"index-of":xu,interpolate:qs,"interpolate-hcl":qs,"interpolate-lab":qs,length:yi,let:xf,literal:xs,match:Rc,number:Ao,"number-format":mi,object:Ao,slice:Fh,step:ol,string:Ao,"to-boolean":Vn,"to-color":Vn,"to-number":Vn,"to-string":Vn,var:Nh,within:ri};function ho(s,[i,u,f,m]){i=i.evaluate(s),u=u.evaluate(s),f=f.evaluate(s);const w=m?m.evaluate(s):1,S=mu(i,u,f,w);if(S)throw new Is(S);return new Qo(i/255*w,u/255*w,f/255*w,w)}function us(s,i){return s in i}function Ha(s,i){const u=i[s];return void 0===u?null:u}function eo(s){return{type:s}}ru.register(Qr,{error:[{kind:"error"},[Cr],(s,[i])=>{throw new Is(i.evaluate(s))}],typeof:[Cr,[Hr],(s,[i])=>$n(ss(i.evaluate(s)))],"to-rgba":[cs(nn,4),[Va],(s,[i])=>i.evaluate(s).toArray()],rgb:[Va,[nn,nn,nn],ho],rgba:[Va,[nn,nn,nn,nn],ho],has:{type:_r,overloads:[[[Cr],(s,[i])=>us(i.evaluate(s),s.properties())],[[Cr,Bn],(s,[i,u])=>us(i.evaluate(s),u.evaluate(s))]]},get:{type:Hr,overloads:[[[Cr],(s,[i])=>Ha(i.evaluate(s),s.properties())],[[Cr,Bn],(s,[i,u])=>Ha(i.evaluate(s),u.evaluate(s))]]},"feature-state":[Hr,[Cr],(s,[i])=>Ha(i.evaluate(s),s.featureState||{})],properties:[Bn,[],s=>s.properties()],"geometry-type":[Cr,[],s=>s.geometryType()],id:[Hr,[],s=>s.id()],zoom:[nn,[],s=>s.globals.zoom],pitch:[nn,[],s=>s.globals.pitch||0],"distance-from-center":[nn,[],s=>s.distanceFromCenter()],"heatmap-density":[nn,[],s=>s.globals.heatmapDensity||0],"line-progress":[nn,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[nn,[],s=>s.globals.skyRadialProgress||0],accumulated:[Hr,[],s=>void 0===s.globals.accumulated?null:s.globals.accumulated],"+":[nn,eo(nn),(s,i)=>{let u=0;for(const f of i)u+=f.evaluate(s);return u}],"*":[nn,eo(nn),(s,i)=>{let u=1;for(const f of i)u*=f.evaluate(s);return u}],"-":{type:nn,overloads:[[[nn,nn],(s,[i,u])=>i.evaluate(s)-u.evaluate(s)],[[nn],(s,[i])=>-i.evaluate(s)]]},"/":[nn,[nn,nn],(s,[i,u])=>i.evaluate(s)/u.evaluate(s)],"%":[nn,[nn,nn],(s,[i,u])=>i.evaluate(s)%u.evaluate(s)],ln2:[nn,[],()=>Math.LN2],pi:[nn,[],()=>Math.PI],e:[nn,[],()=>Math.E],"^":[nn,[nn,nn],(s,[i,u])=>Math.pow(i.evaluate(s),u.evaluate(s))],sqrt:[nn,[nn],(s,[i])=>Math.sqrt(i.evaluate(s))],log10:[nn,[nn],(s,[i])=>Math.log(i.evaluate(s))/Math.LN10],ln:[nn,[nn],(s,[i])=>Math.log(i.evaluate(s))],log2:[nn,[nn],(s,[i])=>Math.log(i.evaluate(s))/Math.LN2],sin:[nn,[nn],(s,[i])=>Math.sin(i.evaluate(s))],cos:[nn,[nn],(s,[i])=>Math.cos(i.evaluate(s))],tan:[nn,[nn],(s,[i])=>Math.tan(i.evaluate(s))],asin:[nn,[nn],(s,[i])=>Math.asin(i.evaluate(s))],acos:[nn,[nn],(s,[i])=>Math.acos(i.evaluate(s))],atan:[nn,[nn],(s,[i])=>Math.atan(i.evaluate(s))],min:[nn,eo(nn),(s,i)=>Math.min(...i.map(u=>u.evaluate(s)))],max:[nn,eo(nn),(s,i)=>Math.max(...i.map(u=>u.evaluate(s)))],abs:[nn,[nn],(s,[i])=>Math.abs(i.evaluate(s))],round:[nn,[nn],(s,[i])=>{const u=i.evaluate(s);return u<0?-Math.round(-u):Math.round(u)}],floor:[nn,[nn],(s,[i])=>Math.floor(i.evaluate(s))],ceil:[nn,[nn],(s,[i])=>Math.ceil(i.evaluate(s))],"filter-==":[_r,[Cr,Hr],(s,[i,u])=>s.properties()[i.value]===u.value],"filter-id-==":[_r,[Hr],(s,[i])=>s.id()===i.value],"filter-type-==":[_r,[Cr],(s,[i])=>s.geometryType()===i.value],"filter-<":[_r,[Cr,Hr],(s,[i,u])=>{const f=s.properties()[i.value],m=u.value;return typeof f==typeof m&&f<m}],"filter-id-<":[_r,[Hr],(s,[i])=>{const u=s.id(),f=i.value;return typeof u==typeof f&&u<f}],"filter->":[_r,[Cr,Hr],(s,[i,u])=>{const f=s.properties()[i.value],m=u.value;return typeof f==typeof m&&f>m}],"filter-id->":[_r,[Hr],(s,[i])=>{const u=s.id(),f=i.value;return typeof u==typeof f&&u>f}],"filter-<=":[_r,[Cr,Hr],(s,[i,u])=>{const f=s.properties()[i.value],m=u.value;return typeof f==typeof m&&f<=m}],"filter-id-<=":[_r,[Hr],(s,[i])=>{const u=s.id(),f=i.value;return typeof u==typeof f&&u<=f}],"filter->=":[_r,[Cr,Hr],(s,[i,u])=>{const f=s.properties()[i.value],m=u.value;return typeof f==typeof m&&f>=m}],"filter-id->=":[_r,[Hr],(s,[i])=>{const u=s.id(),f=i.value;return typeof u==typeof f&&u>=f}],"filter-has":[_r,[Hr],(s,[i])=>i.value in s.properties()],"filter-has-id":[_r,[],s=>null!==s.id()&&void 0!==s.id()],"filter-type-in":[_r,[cs(Cr)],(s,[i])=>i.value.indexOf(s.geometryType())>=0],"filter-id-in":[_r,[cs(Hr)],(s,[i])=>i.value.indexOf(s.id())>=0],"filter-in-small":[_r,[Cr,cs(Hr)],(s,[i,u])=>u.value.indexOf(s.properties()[i.value])>=0],"filter-in-large":[_r,[Cr,cs(Hr)],(s,[i,u])=>function(f,m,w,S){for(;w<=S;){const M=w+S>>1;if(m[M]===f)return!0;m[M]>f?S=M-1:w=M+1}return!1}(s.properties()[i.value],u.value,0,u.value.length-1)],all:{type:_r,overloads:[[[_r,_r],(s,[i,u])=>i.evaluate(s)&&u.evaluate(s)],[eo(_r),(s,i)=>{for(const u of i)if(!u.evaluate(s))return!1;return!0}]]},any:{type:_r,overloads:[[[_r,_r],(s,[i,u])=>i.evaluate(s)||u.evaluate(s)],[eo(_r),(s,i)=>{for(const u of i)if(u.evaluate(s))return!0;return!1}]]},"!":[_r,[_r],(s,[i])=>!i.evaluate(s)],"is-supported-script":[_r,[Cr],(s,[i])=>{const u=s.globals&&s.globals.isSupportedScript;return!u||u(i.evaluate(s))}],upcase:[Cr,[Cr],(s,[i])=>i.evaluate(s).toUpperCase()],downcase:[Cr,[Cr],(s,[i])=>i.evaluate(s).toLowerCase()],concat:[Cr,eo(Hr),(s,i)=>i.map(u=>Il(u.evaluate(s))).join("")],"resolved-locale":[Cr,[oo],(s,[i])=>i.evaluate(s).resolvedLocale()]});var As=Qr;function oh(s){return{result:"success",value:s}}function xo(s){return{result:"error",value:s}}function Jl(s){return"data-driven"===s["property-type"]}function Wa(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function ii(s){return!!s.expression&&s.expression.interpolated}function an(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":null===s?"null":typeof s}function vr(s){return"object"==typeof s&&null!==s&&!Array.isArray(s)}function fo(s){return s}function ns(s,i){const u="color"===i.type,f=s.stops&&"object"==typeof s.stops[0][0],m=f||!(f||void 0!==s.property),w=s.type||(ii(i)?"exponential":"interval");if(u&&((s=pu({},s)).stops&&(s.stops=s.stops.map(L=>[L[0],Qo.parse(L[1])])),s.default=Qo.parse(s.default?s.default:i.default)),s.colorSpace&&"rgb"!==s.colorSpace&&!rh[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let S,M,R;if("exponential"===w)S=xr;else if("interval"===w)S=Xs;else if("categorical"===w){S=Mi,M=Object.create(null);for(const L of s.stops)M[L[0]]=L[1];R=typeof s.stops[0][0]}else{if("identity"!==w)throw new Error(`Unknown function type "${w}"`);S=Ql}if(f){const L={},z=[];for(let X=0;X<s.stops.length;X++){const K=s.stops[X],ue=K[0].zoom;void 0===L[ue]&&(L[ue]={zoom:ue,type:s.type,property:s.property,default:s.default,stops:[]},z.push(ue)),L[ue].stops.push([K[0].value,K[1]])}const V=[];for(const X of z)V.push([L[X].zoom,ns(L[X],i)]);const G={name:"linear"};return{kind:"composite",interpolationType:G,interpolationFactor:qs.interpolationFactor.bind(void 0,G),zoomStops:V.map(X=>X[0]),evaluate:({zoom:X},K)=>xr({stops:V,base:s.base},i,X).evaluate(X,K)}}if(m){const L="exponential"===w?{name:"exponential",base:void 0!==s.base?s.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:qs.interpolationFactor.bind(void 0,L),zoomStops:s.stops.map(z=>z[0]),evaluate:({zoom:z})=>S(s,i,z,M,R)}}return{kind:"source",evaluate(L,z){const V=z&&z.properties?z.properties[s.property]:void 0;return void 0===V?ua(s.default,i.default):S(s,i,V,M,R)}}}function ua(s,i,u){return void 0!==s?s:void 0!==i?i:void 0!==u?u:void 0}function Mi(s,i,u,f,m){return ua(typeof u===m?f[u]:void 0,s.default,i.default)}function Xs(s,i,u){if("number"!==an(u))return ua(s.default,i.default);const f=s.stops.length;if(1===f||u<=s.stops[0][0])return s.stops[0][1];if(u>=s.stops[f-1][0])return s.stops[f-1][1];const m=Zl(s.stops.map(w=>w[0]),u);return s.stops[m][1]}function xr(s,i,u){const f=void 0!==s.base?s.base:1;if("number"!==an(u))return ua(s.default,i.default);const m=s.stops.length;if(1===m||u<=s.stops[0][0])return s.stops[0][1];if(u>=s.stops[m-1][0])return s.stops[m-1][1];const w=Zl(s.stops.map(z=>z[0]),u),S=function(z,V,G,X){const K=X-G,ue=z-G;return 0===K?0:1===V?ue/K:(Math.pow(V,ue)-1)/(Math.pow(V,K)-1)}(u,f,s.stops[w][0],s.stops[w+1][0]),M=s.stops[w][1],R=s.stops[w+1][1];let L=Ga[i.type]||fo;if(s.colorSpace&&"rgb"!==s.colorSpace){const z=rh[s.colorSpace];L=(V,G)=>z.reverse(z.interpolate(z.forward(V),z.forward(G),S))}return"function"==typeof M.evaluate?{evaluate(...z){const V=M.evaluate.apply(void 0,z),G=R.evaluate.apply(void 0,z);if(void 0!==V&&void 0!==G)return L(V,G,S)}}:L(M,R,S)}function Ql(s,i,u){return"color"===i.type?u=Qo.parse(u):"formatted"===i.type?u=es.fromString(u.toString()):"resolvedImage"===i.type?u=Kr.fromString(u.toString()):an(u)===i.type||"enum"===i.type&&i.values[u]||(u=void 0),ua(u,s.default,i.default)}class Xu{constructor(i,u){var f;this.expression=i,this._warningHistory={},this._evaluator=new yu,this._defaultValue=u?"color"===(f=u).type&&(vr(f.default)||Array.isArray(f.default))?new Qo(0,0,0,0):"color"===f.type?Qo.parse(f.default)||null:void 0===f.default?null:f.default:null,this._enumValues=u&&"enum"===u.type?u.values:null}evaluateWithoutErrorHandling(i,u,f,m,w,S,M,R){return this._evaluator.globals=i,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=m||null,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=S,this._evaluator.featureTileCoord=M||null,this._evaluator.featureDistanceData=R||null,this.expression.evaluate(this._evaluator)}evaluate(i,u,f,m,w,S,M,R){this._evaluator.globals=i,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=S||null,this._evaluator.featureTileCoord=M||null,this._evaluator.featureDistanceData=R||null;try{const L=this.expression.evaluate(this._evaluator);if(null==L||"number"==typeof L&&L!=L)return this._defaultValue;if(this._enumValues&&!(L in this._enumValues))throw new Is(`Expected value to be one of ${Object.keys(this._enumValues).map(z=>JSON.stringify(z)).join(", ")}, but found ${JSON.stringify(L)} instead.`);return L}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(L.message)),this._defaultValue}}}function Kn(s){return Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0]in As}function la(s,i){const u=new Dl(As,[],i?function(m){const w={color:Va,string:Cr,number:nn,enum:Cr,boolean:_r,formatted:nl,resolvedImage:ra};return"array"===m.type?cs(w[m.value]||Hr,m.length):w[m.type]}(i):void 0),f=u.parse(s,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return f?oh(new Xu(f,i)):xo(u.errors)}class Lc{constructor(i,u){this.kind=i,this._styleExpression=u,this.isStateDependent="constant"!==i&&!Ci(u.expression)}evaluateWithoutErrorHandling(i,u,f,m,w,S){return this._styleExpression.evaluateWithoutErrorHandling(i,u,f,m,w,S)}evaluate(i,u,f,m,w,S){return this._styleExpression.evaluate(i,u,f,m,w,S)}}class Pa{constructor(i,u,f,m){this.kind=i,this.zoomStops=f,this._styleExpression=u,this.isStateDependent="camera"!==i&&!Ci(u.expression),this.interpolationType=m}evaluateWithoutErrorHandling(i,u,f,m,w,S){return this._styleExpression.evaluateWithoutErrorHandling(i,u,f,m,w,S)}evaluate(i,u,f,m,w,S){return this._styleExpression.evaluate(i,u,f,m,w,S)}interpolationFactor(i,u,f){return this.interpolationType?qs.interpolationFactor(this.interpolationType,i,u,f):0}}function to(s,i){if("error"===(s=la(s,i)).result)return s;const u=s.value.expression,f=ia(u);if(!f&&!Jl(i))return xo([new Vo("","data expressions not supported")]);const m=Hu(u,["zoom","pitch","distance-from-center"]);if(!m&&!Wa(i))return xo([new Vo("","zoom expressions not supported")]);const w=Xo(u);return w||m?w instanceof Vo?xo([w]):w instanceof qs&&!ii(i)?xo([new Vo("",'"interpolate" expressions cannot be used with this property')]):oh(w?new Pa(f?"camera":"composite",s.value,w.labels,w instanceof qs?w.interpolation:void 0):new Lc(f?"constant":"source",s.value)):xo([new Vo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Po{constructor(i,u){this._parameters=i,this._specification=u,pu(this,ns(this._parameters,this._specification))}static deserialize(i){return new Po(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Xo(s){let i=null;if(s instanceof xf)i=Xo(s.result);else if(s instanceof ih){for(const u of s.args)if(i=Xo(u),i)break}else(s instanceof ol||s instanceof qs)&&s.input instanceof ru&&"zoom"===s.input.name&&(i=s);return i instanceof Vo||s.eachChild(u=>{const f=Xo(u);f instanceof Vo?i=f:!i&&f?i=new Vo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&f&&i!==f&&(i=new Vo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}class An{constructor(i,u,f,m){this.message=(i?`${i}: `:"")+f,m&&(this.identifier=m),null!=u&&u.__line__&&(this.line=u.__line__)}}function po(s){const i=s.key,u=s.value,f=s.valueSpec||{},m=s.objectElementValidators||{},w=s.style,S=s.styleSpec;let M=[];const R=an(u);if("object"!==R)return[new An(i,u,`object expected, ${R} found`)];for(const L in u){const z=L.split(".")[0];let V;m[z]?V=m[z]:f[z]?V=F:m["*"]?V=m["*"]:f["*"]&&(V=F),V?M=M.concat(V({key:(i&&`${i}.`)+L,value:u[L],valueSpec:f[z]||f["*"],style:w,styleSpec:S,object:u,objectKey:L},u)):M.push(new An(i,u[L],`unknown property "${L}"`))}for(const L in f)m[L]||f[L].required&&void 0===f[L].default&&void 0===u[L]&&M.push(new An(i,u,`missing required property "${L}"`));return M}function sh(s){const i=s.value,u=s.valueSpec,f=s.style,m=s.styleSpec,w=s.key,S=s.arrayElementValidator||F;if("array"!==an(i))return[new An(w,i,`array expected, ${an(i)} found`)];if(u.length&&i.length!==u.length)return[new An(w,i,`array length ${u.length} expected, length ${i.length} found`)];if(u["min-length"]&&i.length<u["min-length"])return[new An(w,i,`array length at least ${u["min-length"]} expected, length ${i.length} found`)];let M={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};m.$version<7&&(M.function=u.function),"object"===an(u.value)&&(M=u.value);let R=[];for(let L=0;L<i.length;L++)R=R.concat(S({array:i,arrayIndex:L,value:i[L],valueSpec:M,style:f,styleSpec:m,key:`${w}[${L}]`}));return R}function Xa(s){const i=s.key,u=s.value,f=s.valueSpec;let m=an(u);if("number"===m&&u!=u&&(m="NaN"),"number"!==m)return[new An(i,u,`number expected, ${m} found`)];if("minimum"in f){let w=f.minimum;if("array"===an(f.minimum)&&(w=f.minimum[s.arrayIndex]),u<w)return[new An(i,u,`${u} is less than the minimum value ${w}`)]}if("maximum"in f){let w=f.maximum;if("array"===an(f.maximum)&&(w=f.maximum[s.arrayIndex]),u>w)return[new An(i,u,`${u} is greater than the maximum value ${w}`)]}return[]}function no(s){const i=s.valueSpec,u=qo(s.value.type);let f,m,w,S={};const M="categorical"!==u&&void 0===s.value.property,R=!M,L="array"===an(s.value.stops)&&"array"===an(s.value.stops[0])&&"object"===an(s.value.stops[0][0]),z=po({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(X){if("identity"===u)return[new An(X.key,X.value,'identity function may not have a "stops" property')];let K=[];const ue=X.value;return K=K.concat(sh({key:X.key,value:ue,valueSpec:X.valueSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:V})),"array"===an(ue)&&0===ue.length&&K.push(new An(X.key,ue,"array must have at least one stop")),K},default:function(X){return F({key:X.key,value:X.value,valueSpec:i,style:X.style,styleSpec:X.styleSpec})}}});return"identity"===u&&M&&z.push(new An(s.key,s.value,'missing required property "property"')),"identity"===u||s.value.stops||z.push(new An(s.key,s.value,'missing required property "stops"')),"exponential"===u&&s.valueSpec.expression&&!ii(s.valueSpec)&&z.push(new An(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(R&&!Jl(s.valueSpec)?z.push(new An(s.key,s.value,"property functions not supported")):M&&!Wa(s.valueSpec)&&z.push(new An(s.key,s.value,"zoom functions not supported"))),"categorical"!==u&&!L||void 0!==s.value.property||z.push(new An(s.key,s.value,'"property" property is required')),z;function V(X){let K=[];const ue=X.value,Ce=X.key;if("array"!==an(ue))return[new An(Ce,ue,`array expected, ${an(ue)} found`)];if(2!==ue.length)return[new An(Ce,ue,`array length 2 expected, length ${ue.length} found`)];if(L){if("object"!==an(ue[0]))return[new An(Ce,ue,`object expected, ${an(ue[0])} found`)];if(void 0===ue[0].zoom)return[new An(Ce,ue,"object stop key must have zoom")];if(void 0===ue[0].value)return[new An(Ce,ue,"object stop key must have value")];const Ge=qo(ue[0].zoom);if("number"!=typeof Ge)return[new An(Ce,ue[0].zoom,"stop zoom values must be numbers")];if(w&&w>Ge)return[new An(Ce,ue[0].zoom,"stop zoom values must appear in ascending order")];Ge!==w&&(w=Ge,m=void 0,S={}),K=K.concat(po({key:`${Ce}[0]`,value:ue[0],valueSpec:{zoom:{}},style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:Xa,value:G}}))}else K=K.concat(G({key:`${Ce}[0]`,value:ue[0],valueSpec:{},style:X.style,styleSpec:X.styleSpec},ue));return Kn(_s(ue[1]))?K.concat([new An(`${Ce}[1]`,ue[1],"expressions are not allowed in function stops.")]):K.concat(F({key:`${Ce}[1]`,value:ue[1],valueSpec:i,style:X.style,styleSpec:X.styleSpec}))}function G(X,K){const ue=an(X.value),Ce=qo(X.value),Ge=null!==X.value?X.value:K;if(f){if(ue!==f)return[new An(X.key,Ge,`${ue} stop domain type must match previous stop domain type ${f}`)]}else f=ue;if("number"!==ue&&"string"!==ue&&"boolean"!==ue&&"number"!=typeof Ce&&"string"!=typeof Ce&&"boolean"!=typeof Ce)return[new An(X.key,Ge,"stop domain value must be a number, string, or boolean")];if("number"!==ue&&"categorical"!==u){let nt=`number expected, ${ue} found`;return Jl(i)&&void 0===u&&(nt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new An(X.key,Ge,nt)]}return"categorical"!==u||"number"!==ue||"number"==typeof Ce&&isFinite(Ce)&&Math.floor(Ce)===Ce?"categorical"!==u&&"number"===ue&&"number"==typeof Ce&&"number"==typeof m&&void 0!==m&&Ce<m?[new An(X.key,Ge,"stop domain values must appear in ascending order")]:(m=Ce,"categorical"===u&&Ce in S?[new An(X.key,Ge,"stop domain values must be unique")]:(S[Ce]=!0,[])):[new An(X.key,Ge,`integer expected, found ${String(Ce)}`)]}}function Ps(s){const i=("property"===s.expressionContext?to:la)(_s(s.value),s.valueSpec);if("error"===i.result)return i.value.map(f=>new An(`${s.key}${f.key}`,s.value,f.message));const u=i.value.expression||i.value._styleExpression.expression;if("property"===s.expressionContext&&"text-font"===s.propertyKey&&!u.outputDefined())return[new An(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===s.expressionContext&&"layout"===s.propertyType&&!Ci(u))return[new An(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===s.expressionContext)return ca(u,s);if(s.expressionContext&&0===s.expressionContext.indexOf("cluster")){if(!Hu(u,["zoom","feature-state"]))return[new An(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===s.expressionContext&&!ia(u))return[new An(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ca(s,i){const u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const m of i.valueSpec.expression.parameters)u.delete(m);if(0===u.size)return[];const f=[];return s instanceof ru&&u.has(s.name)?[new An(i.key,i.value,`["${s.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(s.eachChild(m=>{f.push(...ca(m,i))}),f)}function li(s){const i=s.key,u=s.value,f=s.valueSpec,m=[];return Array.isArray(f.values)?-1===f.values.indexOf(qo(u))&&m.push(new An(i,u,`expected one of [${f.values.join(", ")}], ${JSON.stringify(u)} found`)):-1===Object.keys(f.values).indexOf(qo(u))&&m.push(new An(i,u,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(u)} found`)),m}function Oc(s){if(!0===s||!1===s)return!0;if(!Array.isArray(s)||0===s.length)return!1;switch(s[0]){case"has":return s.length>=2&&"$id"!==s[1]&&"$type"!==s[1];case"in":return s.length>=3&&("string"!=typeof s[1]||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==s.length||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const i of s.slice(1))if(!Oc(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}function Nc(s,i="fill"){if(null==s)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Oc(s)||(s=Lu(s));const u=s;let f=!0;try{f=function(L){if(!su(L))return L;let z=_s(L);return hs(z),z=wf(z),z}(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(u,null,2)}\n        `)}const m=Ht[`filter_${i}`],w=la(f,m);let S=null;if("error"===w.result)throw new Error(w.value.map(L=>`${L.key}: ${L.message}`).join(", "));S=(L,z,V)=>w.value.evaluate(L,z,{},V);let M=null,R=null;if(f!==u){const L=la(u,m);if("error"===L.result)throw new Error(L.value.map(z=>`${z.key}: ${z.message}`).join(", "));M=(z,V,G,X,K)=>L.value.evaluate(z,V,{},G,void 0,void 0,X,K),R=!ia(L.value.expression)}return{filter:S,dynamicFilter:M||void 0,needGeometry:fs(f),needFeature:!!R}}function wf(s){if(!Array.isArray(s))return s;const i=function(u){if(Eu.has(u[0]))for(let f=1;f<u.length;f++)if(su(u[f]))return!0;return u}(s);return!0===i?i:i.map(u=>wf(u))}function hs(s){let i=!1;const u=[];if("case"===s[0]){for(let f=1;f<s.length-1;f+=2)i=i||su(s[f]),u.push(s[f+1]);u.push(s[s.length-1])}else if("match"===s[0]){i=i||su(s[1]);for(let f=2;f<s.length-1;f+=2)u.push(s[f+1]);u.push(s[s.length-1])}else if("step"===s[0]){i=i||su(s[1]);for(let f=1;f<s.length-1;f+=2)u.push(s[f+1])}i&&(s.length=0,s.push("any",...u));for(let f=1;f<s.length;f++)hs(s[f])}function su(s){if(!Array.isArray(s))return!1;if("pitch"===(i=s[0])||"distance-from-center"===i)return!0;var i;for(let u=1;u<s.length;u++)if(su(s[u]))return!0;return!1}const Eu=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fc(s,i){return s<i?-1:s>i?1:0}function fs(s){if(!Array.isArray(s))return!1;if("within"===s[0])return!0;for(let i=1;i<s.length;i++)if(fs(s[i]))return!0;return!1}function Lu(s){if(!s)return!0;const i=s[0];return s.length<=1?"any"!==i:"=="===i?Zs(s[1],s[2],"=="):"!="===i?ur(Zs(s[1],s[2],"==")):"<"===i||">"===i||"<="===i||">="===i?Zs(s[1],s[2],i):"any"===i?(u=s.slice(1),["any"].concat(u.map(Lu))):"all"===i?["all"].concat(s.slice(1).map(Lu)):"none"===i?["all"].concat(s.slice(1).map(Lu).map(ur)):"in"===i?Rs(s[1],s.slice(2)):"!in"===i?ur(Rs(s[1],s.slice(2))):"has"===i?Ou(s[1]):"!has"===i?ur(Ou(s[1])):"within"!==i||s;var u}function Zs(s,i,u){switch(s){case"$type":return[`filter-type-${u}`,i];case"$id":return[`filter-id-${u}`,i];default:return[`filter-${u}`,s,i]}}function Rs(s,i){if(0===i.length)return!1;switch(s){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(u=>typeof u!=typeof i[0])?["filter-in-large",s,["literal",i.sort(fc)]]:["filter-in-small",s,["literal",i]]}}function Ou(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function ur(s){return["!",s]}function Ra(s){return Oc(_s(s.value))?Ps(pu({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):Vs(s)}function Vs(s){const i=s.value,u=s.key;if("array"!==an(i))return[new An(u,i,`array expected, ${an(i)} found`)];const f=s.styleSpec;let m,w=[];if(i.length<1)return[new An(u,i,"filter array must have at least 1 element")];switch(w=w.concat(li({key:`${u}[0]`,value:i[0],valueSpec:f.filter_operator,style:s.style,styleSpec:s.styleSpec})),qo(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===qo(i[1])&&w.push(new An(u,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&w.push(new An(u,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(m=an(i[1]),"string"!==m&&w.push(new An(`${u}[1]`,i[1],`string expected, ${m} found`)));for(let S=2;S<i.length;S++)m=an(i[S]),"$type"===qo(i[1])?w=w.concat(li({key:`${u}[${S}]`,value:i[S],valueSpec:f.geometry_type,style:s.style,styleSpec:s.styleSpec})):"string"!==m&&"number"!==m&&"boolean"!==m&&w.push(new An(`${u}[${S}]`,i[S],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let S=1;S<i.length;S++)w=w.concat(Vs({key:`${u}[${S}]`,value:i[S],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":m=an(i[1]),2!==i.length?w.push(new An(u,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==m&&w.push(new An(`${u}[1]`,i[1],`string expected, ${m} found`));break;case"within":m=an(i[1]),2!==i.length?w.push(new An(u,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==m&&w.push(new An(`${u}[1]`,i[1],`object expected, ${m} found`))}return w}function Nu(s,i){const u=s.key,f=s.style,m=s.styleSpec,w=s.value,S=s.objectKey,M=m[`${i}_${s.layerType}`];if(!M)return[];const R=S.match(/^(.*)-transition$/);if("paint"===i&&R&&M[R[1]]&&M[R[1]].transition)return F({key:u,value:w,valueSpec:m.transition,style:f,styleSpec:m});const L=s.valueSpec||M[S];if(!L)return[new An(u,w,`unknown property "${S}"`)];let z;if("string"===an(w)&&Jl(L)&&!L.tokens&&(z=/^{([^}]+)}$/.exec(w))){const G=`\`{ "type": "identity", "property": ${z?JSON.stringify(z[1]):'"_"'} }\``;return[new An(u,w,`"${S}" does not support interpolation syntax\nUse an identity property function instead: ${G}.`)]}const V=[];return"symbol"===s.layerType&&("text-field"===S&&f&&!f.glyphs&&V.push(new An(u,w,'use of "text-field" requires a style "glyphs" property')),"text-font"===S&&vr(_s(w))&&"identity"===qo(w.type)&&V.push(new An(u,w,'"text-font" does not support identity functions'))),V.concat(F({key:s.key,value:w,valueSpec:L,style:f,styleSpec:m,expressionContext:"property",propertyType:i,propertyKey:S}))}function La(s){return Nu(s,"paint")}function bf(s){return Nu(s,"layout")}function Oa(s){let i=[];const u=s.value,f=s.key,m=s.style,w=s.styleSpec;u.type||u.ref||i.push(new An(f,u,'either "type" or "ref" is required'));let S=qo(u.type);const M=qo(u.ref);if(u.id){const R=qo(u.id);for(let L=0;L<s.arrayIndex;L++){const z=m.layers[L];qo(z.id)===R&&i.push(new An(f,u.id,`duplicate layer id "${u.id}", previously used at line ${z.id.__line__}`))}}if("ref"in u){let R;["type","source","source-layer","filter","layout"].forEach(L=>{L in u&&i.push(new An(f,u[L],`"${L}" is prohibited for ref layers`))}),m.layers.forEach(L=>{qo(L.id)===M&&(R=L)}),R?R.ref?i.push(new An(f,u.ref,"ref cannot reference another ref layer")):S=qo(R.type):"string"==typeof M&&i.push(new An(f,u.ref,`ref layer "${M}" not found`))}else if("background"!==S&&"sky"!==S)if(u.source){const R=m.sources&&m.sources[u.source],L=R&&qo(R.type);R?"vector"===L&&"raster"===S?i.push(new An(f,u.source,`layer "${u.id}" requires a raster source`)):"raster"===L&&"raster"!==S?i.push(new An(f,u.source,`layer "${u.id}" requires a vector source`)):"vector"!==L||u["source-layer"]?"raster-dem"===L&&"hillshade"!==S?i.push(new An(f,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==S||!u.paint||!u.paint["line-gradient"]&&!u.paint["line-trim-offset"]||"geojson"===L&&R.lineMetrics||i.push(new An(f,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new An(f,u,`layer "${u.id}" must specify a "source-layer"`)):i.push(new An(f,u.source,`source "${u.source}" not found`))}else i.push(new An(f,u,'missing required property "source"'));return i=i.concat(po({key:f,value:u,valueSpec:w.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>F({key:`${f}.type`,value:u.type,valueSpec:w.layer.type,style:s.style,styleSpec:s.styleSpec,object:u,objectKey:"type"}),filter:R=>Ra(pu({layerType:S},R)),layout:R=>po({layer:u,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":L=>bf(pu({layerType:S},L))}}),paint:R=>po({layer:u,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":L=>La(pu({layerType:S},L))}})}})),i}function so(s){const i=s.value,u=s.key,f=an(i);return"string"!==f?[new An(u,i,`string expected, ${f} found`)]:[]}const rd={promoteId:function({key:s,value:i}){if("string"===an(i))return so({key:s,value:i});{const u=[];for(const f in i)u.push(...so({key:`${s}.${f}`,value:i[f]}));return u}}};function ah(s){const i=s.value,u=s.key,f=s.styleSpec,m=s.style;if(!i.type)return[new An(u,i,'"type" is required')];const w=qo(i.type);let S;switch(w){case"vector":case"raster":case"raster-dem":return S=po({key:u,value:i,valueSpec:f[`source_${w.replace("-","_")}`],style:s.style,styleSpec:f,objectElementValidators:rd}),S;case"geojson":if(S=po({key:u,value:i,valueSpec:f.source_geojson,style:m,styleSpec:f,objectElementValidators:rd}),i.cluster)for(const M in i.clusterProperties){const[R,L]=i.clusterProperties[M],z="string"==typeof R?[R,["accumulated"],["get",M]]:R;S.push(...Ps({key:`${u}.${M}.map`,value:L,expressionContext:"cluster-map"})),S.push(...Ps({key:`${u}.${M}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return S;case"video":return po({key:u,value:i,valueSpec:f.source_video,style:m,styleSpec:f});case"image":return po({key:u,value:i,valueSpec:f.source_image,style:m,styleSpec:f});case"canvas":return[new An(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return li({key:`${u}.type`,value:i.type,valueSpec:{values:a(f)},style:m,styleSpec:f})}}function a(s){return s.source.reduce((i,u)=>{const f=s[u];return"enum"===f.type.type&&(i=i.concat(Object.keys(f.type.values))),i},[])}function h(s){const i=s.value,u=s.styleSpec,f=u.light,m=s.style;let w=[];const S=an(i);if(void 0===i)return w;if("object"!==S)return w=w.concat([new An("light",i,`object expected, ${S} found`)]),w;for(const M in i){const R=M.match(/^(.*)-transition$/);w=w.concat(R&&f[R[1]]&&f[R[1]].transition?F({key:M,value:i[M],valueSpec:u.transition,style:m,styleSpec:u}):f[M]?F({key:M,value:i[M],valueSpec:f[M],style:m,styleSpec:u}):[new An(M,i[M],`unknown property "${M}"`)])}return w}function y(s){const i=s.value,u=s.key,f=s.style,m=s.styleSpec,w=m.terrain;let S=[];const M=an(i);if(void 0===i)return S;if("object"!==M)return S=S.concat([new An("terrain",i,`object expected, ${M} found`)]),S;for(const R in i){const L=R.match(/^(.*)-transition$/);S=S.concat(L&&w[L[1]]&&w[L[1]].transition?F({key:R,value:i[R],valueSpec:m.transition,style:f,styleSpec:m}):w[R]?F({key:R,value:i[R],valueSpec:w[R],style:f,styleSpec:m}):[new An(R,i[R],`unknown property "${R}"`)])}if(i.source){const R=f.sources&&f.sources[i.source],L=R&&qo(R.type);R?"raster-dem"!==L&&S.push(new An(u,i.source,`terrain cannot be used with a source of type ${String(L)}, it only be used with a "raster-dem" source type`)):S.push(new An(u,i.source,`source "${i.source}" not found`))}else S.push(new An(u,i,'terrain is missing required property "source"'));return S}function x(s){const i=s.value,u=s.style,f=s.styleSpec,m=f.fog;let w=[];const S=an(i);if(void 0===i)return w;if("object"!==S)return w=w.concat([new An("fog",i,`object expected, ${S} found`)]),w;for(const M in i){const R=M.match(/^(.*)-transition$/);w=w.concat(R&&m[R[1]]&&m[R[1]].transition?F({key:M,value:i[M],valueSpec:f.transition,style:u,styleSpec:f}):m[M]?F({key:M,value:i[M],valueSpec:m[M],style:u,styleSpec:f}):[new An(M,i[M],`unknown property "${M}"`)])}return w}const T={"*":()=>[],array:sh,boolean:function(s){const i=s.value,u=s.key,f=an(i);return"boolean"!==f?[new An(u,i,`boolean expected, ${f} found`)]:[]},number:Xa,color:function(s){const i=s.key,u=s.value,f=an(u);return"string"!==f?[new An(i,u,`color expected, ${f} found`)]:null===Dn(u)?[new An(i,u,`color expected, "${u}" found`)]:[]},enum:li,filter:Ra,function:no,layer:Oa,object:po,source:ah,light:h,terrain:y,fog:x,string:so,formatted:function(s){return 0===so(s).length?[]:Ps(s)},resolvedImage:function(s){return 0===so(s).length?[]:Ps(s)},projection:function(s){const i=s.value,u=s.styleSpec,f=u.projection,m=s.style;let w=[];const S=an(i);if("object"===S)for(const M in i)w=w.concat(F({key:M,value:i[M],valueSpec:f[M],style:m,styleSpec:u}));else"string"!==S&&(w=w.concat([new An("projection",i,`object or string expected, ${S} found`)]));return w}};function F(s){const i=s.value,u=s.valueSpec,f=s.styleSpec;return u.expression&&vr(qo(i))?no(s):u.expression&&Kn(_s(i))?Ps(s):u.type&&T[u.type]?T[u.type](s):po(pu({},s,{valueSpec:u.type?f[u.type]:u}))}function j(s){const i=s.value,u=s.key,f=so(s);return f.length||(-1===i.indexOf("{fontstack}")&&f.push(new An(u,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&f.push(new An(u,i,'"glyphs" url must include a "{range}" token'))),f}function ce(s,i=Ht){return Lt(F({key:"",value:s,valueSpec:i.$root,styleSpec:i,style:s,objectElementValidators:{glyphs:j,"*":()=>[]}}))}const ke=s=>Lt(La(s)),ft=s=>Lt(bf(s));function Lt(s){return s.slice().sort((i,u)=>i.line&&u.line?i.line-u.line:0)}function $t(s,i){let u=!1;if(i&&i.length)for(const f of i)s.fire(new Gs(new Error(f.message))),u=!0;return u}var Pn=zn,Mn=3;function zn(s,i,u){var f=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var m=new Int32Array(this.arrayBuffer);s=m[0],this.d=(i=m[1])+2*(u=m[2]);for(var w=0;w<this.d*this.d;w++){var S=m[Mn+w],M=m[Mn+w+1];f.push(S===M?null:m.subarray(S,M))}var R=m[Mn+f.length+1];this.keys=m.subarray(m[Mn+f.length],R),this.bboxes=m.subarray(R),this.insert=this._insertReadonly}else{this.d=i+2*u;for(var L=0;L<this.d*this.d;L++)f.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=s,this.padding=u,this.scale=i/s,this.uid=0;var z=u/i*s;this.min=-z,this.max=s+z}zn.prototype.insert=function(s,i,u,f,m){this._forEachCell(i,u,f,m,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(i),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(m)},zn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},zn.prototype._insertCell=function(s,i,u,f,m,w){this.cells[m].push(w)},zn.prototype.query=function(s,i,u,f,m){var w=this.min,S=this.max;if(s<=w&&i<=w&&S<=u&&S<=f&&!m)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(s,i,u,f,this._queryCell,M,{},m),M},zn.prototype._queryCell=function(s,i,u,f,m,w,S,M){var R=this.cells[m];if(null!==R)for(var L=this.keys,z=this.bboxes,V=0;V<R.length;V++){var G=R[V];if(void 0===S[G]){var X=4*G;(M?M(z[X+0],z[X+1],z[X+2],z[X+3]):s<=z[X+2]&&i<=z[X+3]&&u>=z[X+0]&&f>=z[X+1])?(S[G]=!0,w.push(L[G])):S[G]=!1}}},zn.prototype._forEachCell=function(s,i,u,f,m,w,S,M){for(var R=this._convertToCellCoord(s),L=this._convertToCellCoord(i),z=this._convertToCellCoord(u),V=this._convertToCellCoord(f),G=R;G<=z;G++)for(var X=L;X<=V;X++){var K=this.d*X+G;if((!M||M(this._convertFromCellCoord(G),this._convertFromCellCoord(X),this._convertFromCellCoord(G+1),this._convertFromCellCoord(X+1)))&&m.call(this,s,i,u,f,K,w,S,M))return}},zn.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},zn.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},zn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,i=Mn+this.cells.length+1+1,u=0,f=0;f<this.cells.length;f++)u+=this.cells[f].length;var m=new Int32Array(i+u+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var w=i,S=0;S<s.length;S++){var M=s[S];m[Mn+S]=w,m.set(M,w),w+=M.length}return m[Mn+s.length]=w,m.set(this.keys,w),m[Mn+s.length+1]=w+=this.keys.length,m.set(this.bboxes,w),w+=this.bboxes.length,m.buffer};var qn=W(Pn);const hi={};function Sn(s,i,u={}){Object.defineProperty(s,"_classRegistryKey",{value:i,writeable:!1}),hi[i]={klass:s,omit:u.omit||[]}}Sn(Object,"Object"),qn.serialize=function(s,i){const u=s.toArrayBuffer();return i&&i.push(u),{buffer:u}},qn.deserialize=function(s){return new qn(s.buffer)},Object.defineProperty(qn,"name",{value:"Grid"}),Sn(qn,"Grid"),Sn(Qo,"Color"),Sn(Error,"Error"),Sn(zr,"AJAXError"),Sn(Kr,"ResolvedImage"),Sn(Po,"StylePropertyFunction"),Sn(Xu,"StyleExpression",{omit:["_evaluator"]}),Sn(Pa,"ZoomDependentExpression"),Sn(Lc,"ZoomConstantExpression"),Sn(ru,"CompoundExpression",{omit:["_evaluate"]});for(const s in As)hi[As[s]._classRegistryKey]||Sn(As[s],`Expression${s}`);function bs(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&"ArrayBuffer"===s.constructor.name)}function au(s){return H.ImageBitmap&&s instanceof H.ImageBitmap}function uu(s,i){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(bs(s)||au(s))return i&&i.push(s),s;if(ArrayBuffer.isView(s)){const u=s;return i&&i.push(u.buffer),u}if(s instanceof H.ImageData)return i&&i.push(s.data.buffer),s;if(Array.isArray(s)){const u=[];for(const f of s)u.push(uu(f,i));return u}if("object"==typeof s){const u=s.constructor,f=u._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${f}`);const m=u.serialize?u.serialize(s,i):{};if(!u.serialize){for(const w in s)s.hasOwnProperty(w)&&(hi[f].omit.indexOf(w)>=0||(m[w]=uu(s[w],i)));s instanceof Error&&(m.message=s.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==f&&(m.$name=f),m}throw new Error("can't serialize object of type "+typeof s)}function Rl(s){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||bs(s)||au(s)||ArrayBuffer.isView(s)||s instanceof H.ImageData)return s;if(Array.isArray(s))return s.map(Rl);if("object"==typeof s){const i=s.$name||"Object",{klass:u}=hi[i];if(!u)throw new Error(`can't deserialize unregistered class ${i}`);if(u.deserialize)return u.deserialize(s);const f=Object.create(u.prototype);for(const m of Object.keys(s))"$name"!==m&&(f[m]=Rl(s[m]));return f}throw new Error("can't deserialize object of type "+typeof s)}const kn={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Kp(s){for(const i of s)if(Bh(i.charCodeAt(0)))return!0;return!1}function Wm(s){for(const i of s)if(!Ll(i.charCodeAt(0)))return!1;return!0}function Ll(s){return!(kn.Arabic(s)||kn["Arabic Supplement"](s)||kn["Arabic Extended-A"](s)||kn["Arabic Presentation Forms-A"](s)||kn["Arabic Presentation Forms-B"](s))}function Bh(s){return!(746!==s&&747!==s&&(s<4352||!(kn["Bopomofo Extended"](s)||kn.Bopomofo(s)||kn["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||kn["CJK Compatibility Ideographs"](s)||kn["CJK Compatibility"](s)||kn["CJK Radicals Supplement"](s)||kn["CJK Strokes"](s)||!(!kn["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||12336===s)||kn["CJK Unified Ideographs Extension A"](s)||kn["CJK Unified Ideographs"](s)||kn["Enclosed CJK Letters and Months"](s)||kn["Hangul Compatibility Jamo"](s)||kn["Hangul Jamo Extended-A"](s)||kn["Hangul Jamo Extended-B"](s)||kn["Hangul Jamo"](s)||kn["Hangul Syllables"](s)||kn.Hiragana(s)||kn["Ideographic Description Characters"](s)||kn.Kanbun(s)||kn["Kangxi Radicals"](s)||kn["Katakana Phonetic Extensions"](s)||kn.Katakana(s)&&12540!==s||!(!kn["Halfwidth and Fullwidth Forms"](s)||65288===s||65289===s||65293===s||s>=65306&&s<=65310||65339===s||65341===s||65343===s||s>=65371&&s<=65503||65507===s||s>=65512&&s<=65519)||!(!kn["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||kn["Unified Canadian Aboriginal Syllabics"](s)||kn["Unified Canadian Aboriginal Syllabics Extended"](s)||kn["Vertical Forms"](s)||kn["Yijing Hexagram Symbols"](s)||kn["Yi Syllables"](s)||kn["Yi Radicals"](s))))}function wa(s){return!(Bh(s)||(i=s,kn["Latin-1 Supplement"](i)&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||kn["General Punctuation"](i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||kn["Letterlike Symbols"](i)||kn["Number Forms"](i)||kn["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||kn["Control Pictures"](i)&&9251!==i||kn["Optical Character Recognition"](i)||kn["Enclosed Alphanumerics"](i)||kn["Geometric Shapes"](i)||kn["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||kn["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||kn["CJK Symbols and Punctuation"](i)||kn.Katakana(i)||kn["Private Use Area"](i)||kn["CJK Compatibility Forms"](i)||kn["Small Form Variants"](i)||kn["Halfwidth and Fullwidth Forms"](i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i}function rp(s){return s>=1424&&s<=2303||kn["Arabic Presentation Forms-A"](s)||kn["Arabic Presentation Forms-B"](s)}function Lv(s,i){return!(!i&&rp(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||kn.Khmer(s))}function ip(s){for(const i of s)if(rp(i.charCodeAt(0)))return!0;return!1}const Ef="deferred",zh="loading",op="loaded";let Cf=null,v="unavailable",l=null;const g=function(s){s&&"string"==typeof s&&s.indexOf("NetworkError")>-1&&(v="error"),Cf&&Cf(s)};function E(){I.fire(new ta("pluginStateChange",{pluginStatus:v,pluginURL:l}))}const I=new na,A=function(){return v},O=function(){if(v!==Ef||!l)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");v=zh,E(),l&&Uo({url:l},s=>{s?g(s):(v=op,E())})},k={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>v===op||null!=k.applyArabicShaping,isLoading:()=>v===zh,setState(s){v=s.pluginStatus,l=s.pluginURL},isParsed:()=>null!=k.applyArabicShaping&&null!=k.processBidirectionalText&&null!=k.processStyledBidirectionalText,getPluginURL:()=>l};class U{constructor(i,u){this.zoom=i,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.transition=u.transition,this.pitch=u.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(i){return function(u,f){for(const m of u)if(!Lv(m.charCodeAt(0),f))return!1;return!0}(i,k.isLoaded())}}class q{constructor(i,u){this.property=i,this.value=u,this.expression=function(f,m){if(vr(f))return new Po(f,m);if(Kn(f)){const w=to(f,m);if("error"===w.result)throw new Error(w.value.map(S=>`${S.key}: ${S.message}`).join(", "));return w.value}{let w=f;return"string"==typeof f&&"color"===m.type&&(w=Qo.parse(f)),{kind:"constant",evaluate:()=>w}}}(void 0===u?i.specification.default:u,i.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,u,f){return this.property.possiblyEvaluate(this,i,u,f)}}class ${constructor(i){this.property=i,this.value=new q(i,void 0)}transitioned(i,u){return new Ee(this.property,this.value,u,Le({},i.transition,this.transition),i.now)}untransitioned(){return new Ee(this.property,this.value,null,{},0)}}class te{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return sn(this._values[i].value.value)}setValue(i,u){this._values.hasOwnProperty(i)||(this._values[i]=new $(this._values[i].property)),this._values[i].value=new q(this._values[i].property,null===u?void 0:sn(u))}getTransition(i){return sn(this._values[i].transition)}setTransition(i,u){this._values.hasOwnProperty(i)||(this._values[i]=new $(this._values[i].property)),this._values[i].transition=sn(u)||void 0}serialize(){const i={};for(const u of Object.keys(this._values)){const f=this.getValue(u);void 0!==f&&(i[u]=f);const m=this.getTransition(u);void 0!==m&&(i[`${u}-transition`]=m)}return i}transitioned(i,u){const f=new Re(this._properties);for(const m of Object.keys(this._values))f._values[m]=this._values[m].transitioned(i,u._values[m]);return f}untransitioned(){const i=new Re(this._properties);for(const u of Object.keys(this._values))i._values[u]=this._values[u].untransitioned();return i}}class Ee{constructor(i,u,f,m,w){const S=m.delay||0,M=m.duration||0;w=w||0,this.property=i,this.value=u,this.begin=w+S,this.end=this.begin+M,i.specification.transition&&(m.delay||m.duration)&&(this.prior=f)}possiblyEvaluate(i,u,f){const m=i.now||0,w=this.value.possiblyEvaluate(i,u,f),S=this.prior;if(S){if(m>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(m<this.begin)return S.possiblyEvaluate(i,u,f);{const M=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(i,u,f),w,Ae(M))}}return w}}class Re{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,u,f){const m=new je(this._properties);for(const w of Object.keys(this._values))m._values[w]=this._values[w].possiblyEvaluate(i,u,f);return m}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Be{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return sn(this._values[i].value)}setValue(i,u){this._values[i]=new q(this._values[i].property,null===u?void 0:sn(u))}serialize(){const i={};for(const u of Object.keys(this._values)){const f=this.getValue(u);void 0!==f&&(i[u]=f)}return i}possiblyEvaluate(i,u,f){const m=new je(this._properties);for(const w of Object.keys(this._values))m._values[w]=this._values[w].possiblyEvaluate(i,u,f);return m}}class Ne{constructor(i,u,f){this.property=i,this.value=u,this.parameters=f}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,u,f,m){return this.property.evaluate(this.value,this.parameters,i,u,f,m)}}class je{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class oe{constructor(i){this.specification=i}possiblyEvaluate(i,u){return i.expression.evaluate(u)}interpolate(i,u,f){const m=Ga[this.specification.type];return m?m(i,u,f):i}}class Pe{constructor(i,u){this.specification=i,this.overrides=u}possiblyEvaluate(i,u,f,m){return new Ne(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(u,null,{},f,m)}:i.expression,u)}interpolate(i,u,f){if("constant"!==i.value.kind||"constant"!==u.value.kind)return i;if(void 0===i.value.value||void 0===u.value.value)return new Ne(this,{kind:"constant",value:void 0},i.parameters);const m=Ga[this.specification.type];return m?new Ne(this,{kind:"constant",value:m(i.value.value,u.value.value,f)},i.parameters):i}evaluate(i,u,f,m,w,S){return"constant"===i.kind?i.value:i.evaluate(u,f,m,w,S)}}class Xe{constructor(i){this.specification=i}possiblyEvaluate(i,u,f,m){return!!i.expression.evaluate(u,null,{},f,m)}interpolate(){return!1}}class He{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const u=new U(0,{});for(const f in i){const m=i[f];m.specification.overridable&&this.overridableProperties.push(f);const w=this.defaultPropertyValues[f]=new q(m,void 0),S=this.defaultTransitionablePropertyValues[f]=new $(m);this.defaultTransitioningPropertyValues[f]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=w.possiblyEvaluate(u)}}}function gt(s,i){return 256*(s=De(Math.floor(s),0,255))+De(Math.floor(i),0,255)}Sn(Pe,"DataDrivenProperty"),Sn(oe,"DataConstantProperty"),Sn(Xe,"ColorRampProperty");const mt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class it{constructor(i,u){this._structArray=i,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class St{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,u){return i._trim(),u&&(i.isTransferred=!0,u.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const u=Object.create(this.prototype);return u.arrayBuffer=i.arrayBuffer,u.length=i.length,u.capacity=i.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Et(s,i=1){let u=0,f=0;return{members:s.map(m=>{const w=mt[m.type].BYTES_PER_ELEMENT,S=u=Tt(u,Math.max(i,w)),M=m.components||1;return f=Math.max(f,w),u+=w*M,{name:m.name,type:m.type,components:M,offset:S}}),size:Tt(u,Math.max(f,i)),alignment:i}}function Tt(s,i){return Math.ceil(s/i)*i}class mn extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,u)}emplace(i,u,f){const m=2*i;return this.int16[m+0]=u,this.int16[m+1]=f,i}}mn.prototype.bytesPerElement=4,Sn(mn,"StructArrayLayout2i4");class Rt extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,i,u,f)}emplace(i,u,f,m){const w=3*i;return this.int16[w+0]=u,this.int16[w+1]=f,this.int16[w+2]=m,i}}Rt.prototype.bytesPerElement=6,Sn(Rt,"StructArrayLayout3i6");class Kt extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,f,m){const w=this.length;return this.resize(w+1),this.emplace(w,i,u,f,m)}emplace(i,u,f,m,w){const S=4*i;return this.int16[S+0]=u,this.int16[S+1]=f,this.int16[S+2]=m,this.int16[S+3]=w,i}}Kt.prototype.bytesPerElement=8,Sn(Kt,"StructArrayLayout4i8");class Nt extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f,m,w,S,M){const R=this.length;return this.resize(R+1),this.emplace(R,i,u,f,m,w,S,M)}emplace(i,u,f,m,w,S,M,R){const L=6*i,z=12*i,V=3*i;return this.int16[L+0]=u,this.int16[L+1]=f,this.uint8[z+4]=m,this.uint8[z+5]=w,this.uint8[z+6]=S,this.uint8[z+7]=M,this.float32[V+2]=R,i}}Nt.prototype.bytesPerElement=12,Sn(Nt,"StructArrayLayout2i4ub1f12");class dn extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f,m){const w=this.length;return this.resize(w+1),this.emplace(w,i,u,f,m)}emplace(i,u,f,m,w){const S=4*i;return this.float32[S+0]=u,this.float32[S+1]=f,this.float32[S+2]=m,this.float32[S+3]=w,i}}dn.prototype.bytesPerElement=16,Sn(dn,"StructArrayLayout4f16");class kt extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f,m,w){const S=this.length;return this.resize(S+1),this.emplace(S,i,u,f,m,w)}emplace(i,u,f,m,w,S){const M=6*i,R=3*i;return this.uint16[M+0]=u,this.uint16[M+1]=f,this.uint16[M+2]=m,this.uint16[M+3]=w,this.float32[R+2]=S,i}}kt.prototype.bytesPerElement=12,Sn(kt,"StructArrayLayout4ui1f12");class Jt extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,f,m){const w=this.length;return this.resize(w+1),this.emplace(w,i,u,f,m)}emplace(i,u,f,m,w){const S=4*i;return this.uint16[S+0]=u,this.uint16[S+1]=f,this.uint16[S+2]=m,this.uint16[S+3]=w,i}}Jt.prototype.bytesPerElement=8,Sn(Jt,"StructArrayLayout4ui8");class un extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,f,m,w,S){const M=this.length;return this.resize(M+1),this.emplace(M,i,u,f,m,w,S)}emplace(i,u,f,m,w,S,M){const R=6*i;return this.int16[R+0]=u,this.int16[R+1]=f,this.int16[R+2]=m,this.int16[R+3]=w,this.int16[R+4]=S,this.int16[R+5]=M,i}}un.prototype.bytesPerElement=12,Sn(un,"StructArrayLayout6i12");class on extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,f,m,w,S,M,R,L,z,V,G){const X=this.length;return this.resize(X+1),this.emplace(X,i,u,f,m,w,S,M,R,L,z,V,G)}emplace(i,u,f,m,w,S,M,R,L,z,V,G,X){const K=12*i;return this.int16[K+0]=u,this.int16[K+1]=f,this.int16[K+2]=m,this.int16[K+3]=w,this.uint16[K+4]=S,this.uint16[K+5]=M,this.uint16[K+6]=R,this.uint16[K+7]=L,this.int16[K+8]=z,this.int16[K+9]=V,this.int16[K+10]=G,this.int16[K+11]=X,i}}on.prototype.bytesPerElement=24,Sn(on,"StructArrayLayout4i4ui4i24");class vn extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f,m,w,S){const M=this.length;return this.resize(M+1),this.emplace(M,i,u,f,m,w,S)}emplace(i,u,f,m,w,S,M){const R=10*i,L=5*i;return this.int16[R+0]=u,this.int16[R+1]=f,this.int16[R+2]=m,this.float32[L+2]=w,this.float32[L+3]=S,this.float32[L+4]=M,i}}vn.prototype.bytesPerElement=20,Sn(vn,"StructArrayLayout3i3f20");class nr extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.uint32[1*i+0]=u,i}}nr.prototype.bytesPerElement=4,Sn(nr,"StructArrayLayout1ul4");class Tr extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,f,m,w,S,M,R,L,z,V,G,X){const K=this.length;return this.resize(K+1),this.emplace(K,i,u,f,m,w,S,M,R,L,z,V,G,X)}emplace(i,u,f,m,w,S,M,R,L,z,V,G,X,K){const ue=20*i,Ce=10*i;return this.int16[ue+0]=u,this.int16[ue+1]=f,this.int16[ue+2]=m,this.int16[ue+3]=w,this.int16[ue+4]=S,this.float32[Ce+3]=M,this.float32[Ce+4]=R,this.float32[Ce+5]=L,this.float32[Ce+6]=z,this.int16[ue+14]=V,this.uint32[Ce+8]=G,this.uint16[ue+18]=X,this.uint16[ue+19]=K,i}}Tr.prototype.bytesPerElement=40,Sn(Tr,"StructArrayLayout5i4f1i1ul2ui40");class jn extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,f,m,w,S,M){const R=this.length;return this.resize(R+1),this.emplace(R,i,u,f,m,w,S,M)}emplace(i,u,f,m,w,S,M,R){const L=8*i;return this.int16[L+0]=u,this.int16[L+1]=f,this.int16[L+2]=m,this.int16[L+4]=w,this.int16[L+5]=S,this.int16[L+6]=M,this.int16[L+7]=R,i}}jn.prototype.bytesPerElement=16,Sn(jn,"StructArrayLayout3i2i2i16");class fr extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,f,m,w){const S=this.length;return this.resize(S+1),this.emplace(S,i,u,f,m,w)}emplace(i,u,f,m,w,S){const M=4*i,R=8*i;return this.float32[M+0]=u,this.float32[M+1]=f,this.float32[M+2]=m,this.int16[R+6]=w,this.int16[R+7]=S,i}}fr.prototype.bytesPerElement=16,Sn(fr,"StructArrayLayout2f1f2i16");class Rn extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f,m){const w=this.length;return this.resize(w+1),this.emplace(w,i,u,f,m)}emplace(i,u,f,m,w){const S=12*i,M=3*i;return this.uint8[S+0]=u,this.uint8[S+1]=f,this.float32[M+1]=m,this.float32[M+2]=w,i}}Rn.prototype.bytesPerElement=12,Sn(Rn,"StructArrayLayout2ub2f12");class ei extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,i,u,f)}emplace(i,u,f,m){const w=3*i;return this.float32[w+0]=u,this.float32[w+1]=f,this.float32[w+2]=m,i}}ei.prototype.bytesPerElement=12,Sn(ei,"StructArrayLayout3f12");class Jn extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,i,u,f)}emplace(i,u,f,m){const w=3*i;return this.uint16[w+0]=u,this.uint16[w+1]=f,this.uint16[w+2]=m,i}}Jn.prototype.bytesPerElement=6,Sn(Jn,"StructArrayLayout3ui6");class ao extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,u,f,m,w,S,M,R,L,z,V,G,X,K,ue,Ce,Ge,nt,$e,et,ct){const ut=this.length;return this.resize(ut+1),this.emplace(ut,i,u,f,m,w,S,M,R,L,z,V,G,X,K,ue,Ce,Ge,nt,$e,et,ct)}emplace(i,u,f,m,w,S,M,R,L,z,V,G,X,K,ue,Ce,Ge,nt,$e,et,ct,ut){const Bt=30*i,Ot=15*i,Yt=60*i;return this.int16[Bt+0]=u,this.int16[Bt+1]=f,this.int16[Bt+2]=m,this.float32[Ot+2]=w,this.float32[Ot+3]=S,this.uint16[Bt+8]=M,this.uint16[Bt+9]=R,this.uint32[Ot+5]=L,this.uint32[Ot+6]=z,this.uint32[Ot+7]=V,this.uint16[Bt+16]=G,this.uint16[Bt+17]=X,this.uint16[Bt+18]=K,this.float32[Ot+10]=ue,this.float32[Ot+11]=Ce,this.uint8[Yt+48]=Ge,this.uint8[Yt+49]=nt,this.uint8[Yt+50]=$e,this.uint32[Ot+13]=et,this.int16[Bt+28]=ct,this.uint8[Yt+58]=ut,i}}ao.prototype.bytesPerElement=60,Sn(ao,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ro extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,u,f,m,w,S,M,R,L,z,V,G,X,K,ue,Ce,Ge,nt,$e,et,ct,ut,Bt,Ot,Yt,yn,jt,Qt,en,ln){const xn=this.length;return this.resize(xn+1),this.emplace(xn,i,u,f,m,w,S,M,R,L,z,V,G,X,K,ue,Ce,Ge,nt,$e,et,ct,ut,Bt,Ot,Yt,yn,jt,Qt,en,ln)}emplace(i,u,f,m,w,S,M,R,L,z,V,G,X,K,ue,Ce,Ge,nt,$e,et,ct,ut,Bt,Ot,Yt,yn,jt,Qt,en,ln,xn){const Xt=38*i,Ln=19*i;return this.int16[Xt+0]=u,this.int16[Xt+1]=f,this.int16[Xt+2]=m,this.float32[Ln+2]=w,this.float32[Ln+3]=S,this.int16[Xt+8]=M,this.int16[Xt+9]=R,this.int16[Xt+10]=L,this.int16[Xt+11]=z,this.int16[Xt+12]=V,this.int16[Xt+13]=G,this.uint16[Xt+14]=X,this.uint16[Xt+15]=K,this.uint16[Xt+16]=ue,this.uint16[Xt+17]=Ce,this.uint16[Xt+18]=Ge,this.uint16[Xt+19]=nt,this.uint16[Xt+20]=$e,this.uint16[Xt+21]=et,this.uint16[Xt+22]=ct,this.uint16[Xt+23]=ut,this.uint16[Xt+24]=Bt,this.uint16[Xt+25]=Ot,this.uint16[Xt+26]=Yt,this.uint16[Xt+27]=yn,this.uint16[Xt+28]=jt,this.uint32[Ln+15]=Qt,this.float32[Ln+16]=en,this.float32[Ln+17]=ln,this.float32[Ln+18]=xn,i}}Ro.prototype.bytesPerElement=76,Sn(Ro,"StructArrayLayout3i2f6i15ui1ul3f76");class Lo extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.float32[1*i+0]=u,i}}Lo.prototype.bytesPerElement=4,Sn(Lo,"StructArrayLayout1f4");class wo extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f,m,w){const S=this.length;return this.resize(S+1),this.emplace(S,i,u,f,m,w)}emplace(i,u,f,m,w,S){const M=5*i;return this.float32[M+0]=u,this.float32[M+1]=f,this.float32[M+2]=m,this.float32[M+3]=w,this.float32[M+4]=S,i}}wo.prototype.bytesPerElement=20,Sn(wo,"StructArrayLayout5f20");class Ys extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,f,m){const w=this.length;return this.resize(w+1),this.emplace(w,i,u,f,m)}emplace(i,u,f,m,w){const S=6*i;return this.uint32[3*i+0]=u,this.uint16[S+2]=f,this.uint16[S+3]=m,this.uint16[S+4]=w,i}}Ys.prototype.bytesPerElement=12,Sn(Ys,"StructArrayLayout1ul3ui12");class Na extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,u)}emplace(i,u,f){const m=2*i;return this.uint16[m+0]=u,this.uint16[m+1]=f,i}}Na.prototype.bytesPerElement=4,Sn(Na,"StructArrayLayout2ui4");class cl extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.uint16[1*i+0]=u,i}}cl.prototype.bytesPerElement=2,Sn(cl,"StructArrayLayout1ui2");class ec extends St{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,u)}emplace(i,u,f){const m=2*i;return this.float32[m+0]=u,this.float32[m+1]=f,i}}ec.prototype.bytesPerElement=8,Sn(ec,"StructArrayLayout2f8");class ls extends it{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ls.prototype.size=40;class Oo extends Tr{get(i){return new ls(this,i)}}Sn(Oo,"CollisionBoxArray");class Zt extends it{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}Zt.prototype.size=60;class Sr extends ao{get(i){return new Zt(this,i)}}Sn(Sr,"PlacedSymbolArray");class Cu extends it{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(i){this._structArray.uint32[this._pos4+15]=i}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Cu.prototype.size=76;class rs extends Ro{get(i){return new Cu(this,i)}}Sn(rs,"SymbolInstanceArray");class No extends Lo{getoffsetX(i){return this.float32[1*i+0]}}Sn(No,"GlyphOffsetArray");class Sf extends mn{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}Sn(Sf,"SymbolLineVertexArray");class Ol extends it{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ol.prototype.size=12;class ku extends Ys{get(i){return new Ol(this,i)}}Sn(ku,"FeatureIndexArray");class Nl extends Na{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}Sn(Nl,"FillExtrusionCentroidArray");const tc=Et([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),uh=Et([{name:"a_dash",components:4,type:"Uint16"}]);var sp={exports:{}},Xm=function(s,i){var u,f,m,w,S,M,R,L;for(f=s.length-(u=3&s.length),m=i,S=3432918353,M=461845907,L=0;L<f;)R=255&s.charCodeAt(L)|(255&s.charCodeAt(++L))<<8|(255&s.charCodeAt(++L))<<16|(255&s.charCodeAt(++L))<<24,++L,m=27492+(65535&(w=5*(65535&(m=(m^=R=(65535&(R=(R=(65535&R)*S+(((R>>>16)*S&65535)<<16)&4294967295)<<15|R>>>17))*M+(((R>>>16)*M&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(R=0,u){case 3:R^=(255&s.charCodeAt(L+2))<<16;case 2:R^=(255&s.charCodeAt(L+1))<<8;case 1:m^=R=(65535&(R=(R=(65535&(R^=255&s.charCodeAt(L)))*S+(((R>>>16)*S&65535)<<16)&4294967295)<<15|R>>>17))*M+(((R>>>16)*M&65535)<<16)&4294967295}return m^=s.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0},id=function(s,i){for(var u,f=s.length,m=i^f,w=0;f>=4;)u=1540483477*(65535&(u=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(u>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++w;switch(f){case 3:m^=(255&s.charCodeAt(w+2))<<16;case 2:m^=(255&s.charCodeAt(w+1))<<8;case 1:m=1540483477*(65535&(m^=255&s.charCodeAt(w)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};sp.exports=Xm,sp.exports.murmur3=Xm,sp.exports.murmur2=id;var dc=W(sp.exports);class Jp{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,u,f,m){this.ids.push(Zm(i)),this.positions.push(u,f,m)}getPositions(i){const u=Zm(i);let f=0,m=this.ids.length-1;for(;f<m;){const S=f+m>>1;this.ids[S]>=u?m=S:f=S+1}const w=[];for(;this.ids[f]===u;)w.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return w}static serialize(i,u){const f=new Float64Array(i.ids),m=new Uint32Array(i.positions);return Ym(f,m,0,f.length-1),u&&u.push(f.buffer,m.buffer),{ids:f,positions:m}}static deserialize(i){const u=new Jp;return u.ids=i.ids,u.positions=i.positions,u.indexed=!0,u}}function Zm(s){const i=+s;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:dc(String(s))}function Ym(s,i,u,f){for(;u<f;){const m=s[u+f>>1];let w=u-1,S=f+1;for(;;){do{w++}while(s[w]<m);do{S--}while(s[S]>m);if(w>=S)break;Qp(s,w,S),Qp(i,3*w,3*S),Qp(i,3*w+1,3*S+1),Qp(i,3*w+2,3*S+2)}S-u<f-S?(Ym(s,i,u,S),u=S+1):(Ym(s,i,S+1,f),f=S)}}function Qp(s,i,u){const f=s[i];s[i]=s[u],s[u]=f}Sn(Jp,"FeaturePositionMap");class pc{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,u){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,u),this.initialized=!0),!!this.location}}class od extends pc{constructor(i){super(i),this.current=0}set(i,u,f){this.fetchUniformLocation(i,u)&&this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))}}class Km extends pc{constructor(i){super(i),this.current=[0,0,0,0]}set(i,u,f){this.fetchUniformLocation(i,u)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3])))}}class eg extends pc{constructor(i){super(i),this.current=Qo.transparent}set(i,u,f){this.fetchUniformLocation(i,u)&&(f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a)))}}const zx=new Float32Array(16),Ov=new Float32Array(9),Jm=new Float32Array(4);function tg(s){return[gt(255*s.r,255*s.g),gt(255*s.b,255*s.a)]}class sd{constructor(i,u,f){this.value=i,this.uniformNames=u.map(m=>`u_${m}`),this.type=f}setUniform(i,u,f,m,w){u.set(i,w,m.constantOr(this.value))}getBinding(i,u){return"color"===this.type?new eg(i):new od(i)}}class If{constructor(i,u){this.uniformNames=u.map(f=>`u_${f}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(i){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br)}setUniform(i,u,f,m,w){const S="u_pattern"===w||"u_dash"===w?this.pattern:"u_pixel_ratio"===w?this.pixelRatio:null;S&&u.set(i,w,S)}getBinding(i,u){return"u_pattern"===u||"u_dash"===u?new Km(i):new od(i)}}class Fc{constructor(i,u,f,m){this.expression=i,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===f?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(i,u,f,m,w,S){const M=this.paintVertexArray.length,R=this.expression.evaluate(new U(0),u,{},w,m,S);this.paintVertexArray.resize(i),this._setPaintValue(M,i,R)}updatePaintArray(i,u,f,m,w){const S=this.expression.evaluate({zoom:0},f,m,void 0,w);this._setPaintValue(i,u,S)}_setPaintValue(i,u,f){if("color"===this.type){const m=tg(f);for(let w=i;w<u;w++)this.paintVertexArray.emplace(w,m[0],m[1])}else{for(let m=i;m<u;m++)this.paintVertexArray.emplace(m,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class kl{constructor(i,u,f,m,w,S){this.expression=i,this.uniformNames=u.map(M=>`u_${M}_t`),this.type=f,this.useIntegerZoom=m,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=u.map(M=>({name:`a_${M}`,type:"Float32",components:"color"===f?4:2,offset:0})),this.paintVertexArray=new S}populatePaintArray(i,u,f,m,w,S){const M=this.expression.evaluate(new U(this.zoom),u,{},w,m,S),R=this.expression.evaluate(new U(this.zoom+1),u,{},w,m,S),L=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(L,i,M,R)}updatePaintArray(i,u,f,m,w){const S=this.expression.evaluate({zoom:this.zoom},f,m,void 0,w),M=this.expression.evaluate({zoom:this.zoom+1},f,m,void 0,w);this._setPaintValue(i,u,S,M)}_setPaintValue(i,u,f,m){if("color"===this.type){const w=tg(f),S=tg(m);for(let M=i;M<u;M++)this.paintVertexArray.emplace(M,w[0],w[1],S[0],S[1])}else{for(let w=i;w<u;w++)this.paintVertexArray.emplace(w,f,m);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(m))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,u,f,m,w){const S=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,M=De(this.expression.interpolationFactor(S,this.zoom,this.zoom+1),0,1);u.set(i,w,M)}getBinding(i,u){return new od(i)}}class Vh{constructor(i,u,f,m,w){this.expression=i,this.layerId=w,this.paintVertexAttributes=("array"===f?uh:tc).members;for(let S=0;S<u.length;++S);this.paintVertexArray=new m}populatePaintArray(i,u,f){const m=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(m,i,u.patterns&&u.patterns[this.layerId],f)}updatePaintArray(i,u,f,m,w,S){this._setPaintValues(i,u,f.patterns&&f.patterns[this.layerId],S)}_setPaintValues(i,u,f,m){if(!m||!f)return;const w=m[f];if(!w)return;const{tl:S,br:M,pixelRatio:R}=w;for(let L=i;L<u;L++)this.paintVertexArray.emplace(L,S[0],S[1],M[0],M[1],R)}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class jh{constructor(i,u,f=(()=>!0)){this.binders={},this._buffers=[];const m=[];for(const w in i.paint._values){if(!f(w))continue;const S=i.paint.get(w);if(!(S instanceof Ne&&Jl(S.property.specification)))continue;const M=Ks(w,i.type),R=S.value,L=S.property.specification.type,z=!!S.property.useIntegerZoom,V="line-dasharray"===w||w.endsWith("pattern"),G="line-dasharray"===w&&"constant"!==i.layout.get("line-cap").value.kind;if("constant"!==R.kind||G)if("source"===R.kind||G||V){const X=Nv(w,L,"source");this.binders[w]=V?new Vh(R,M,L,X,i.id):new Fc(R,M,L,X),m.push(`/a_${w}`)}else{const X=Nv(w,L,"composite");this.binders[w]=new kl(R,M,L,z,u,X),m.push(`/z_${w}`)}else this.binders[w]=V?new If(R.value,M):new sd(R.value,M,L),m.push(`/u_${w}`)}this.cacheKey=m.sort().join("")}getMaxValue(i){const u=this.binders[i];return u instanceof Fc||u instanceof kl?u.maxValue:0}populatePaintArrays(i,u,f,m,w,S){for(const M in this.binders){const R=this.binders[M];(R instanceof Fc||R instanceof kl||R instanceof Vh)&&R.populatePaintArray(i,u,f,m,w,S)}}setConstantPatternPositions(i){for(const u in this.binders){const f=this.binders[u];f instanceof If&&f.setConstantPatternPositions(i)}}updatePaintArrays(i,u,f,m,w,S){let M=!1;for(const R in i){const L=u.getPositions(R);for(const z of L){const V=f.feature(z.index);for(const G in this.binders){const X=this.binders[G];if((X instanceof Fc||X instanceof kl||X instanceof Vh)&&!0===X.expression.isStateDependent){const K=m.paint.get(G);X.expression=K.value,X.updatePaintArray(z.start,z.end,V,i[R],w,S),M=!0}}}}return M}defines(){const i=[];for(const u in this.binders){const f=this.binders[u];(f instanceof sd||f instanceof If)&&i.push(...f.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return i}getBinderAttributes(){const i=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Fc||f instanceof kl||f instanceof Vh)for(let m=0;m<f.paintVertexAttributes.length;m++)i.push(f.paintVertexAttributes[m].name)}return i}getBinderUniforms(){const i=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof sd||f instanceof If||f instanceof kl)for(const m of f.uniformNames)i.push(m)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const u=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof sd||m instanceof If||m instanceof kl)for(const w of m.uniformNames)u.push({name:w,property:f,binding:m.getBinding(i,w)})}return u}setUniforms(i,u,f,m,w){for(const{name:S,property:M,binding:R}of f)this.binders[M].setUniform(i,R,w,m.get(M),S)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const u=this.binders[i];(u instanceof Fc||u instanceof kl||u instanceof Vh)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(i){for(const u in this.binders){const f=this.binders[u];(f instanceof Fc||f instanceof kl||f instanceof Vh)&&f.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const u=this.binders[i];(u instanceof Fc||u instanceof kl||u instanceof Vh)&&u.destroy()}}}class ba{constructor(i,u,f=(()=>!0)){this.programConfigurations={};for(const m of i)this.programConfigurations[m.id]=new jh(m,u,f);this.needsUpload=!1,this._featureMap=new Jp,this._bufferOffset=0}populatePaintArrays(i,u,f,m,w,S,M){for(const R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(i,u,m,w,S,M);void 0!==u.id&&this._featureMap.add(u.id,f,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,u,f,m,w){for(const S of f)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(i,this._featureMap,u,S,m,w)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const Tf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ks(s,i){return Tf[s]||[s.replace(`${i}-`,"").replace(/-/g,"_")]}const Ux={"line-pattern":{source:kt,composite:kt},"fill-pattern":{source:kt,composite:kt},"fill-extrusion-pattern":{source:kt,composite:kt},"line-dasharray":{source:Jt,composite:Jt}},Vx={color:{source:ec,composite:dn},number:{source:Lo,composite:ec}};function Nv(s,i,u){const f=Ux[s];return f&&f[u]||Vx[i][u]}Sn(sd,"ConstantBinder"),Sn(If,"PatternConstantBinder"),Sn(Fc,"SourceExpressionBinder"),Sn(Vh,"PatternCompositeBinder"),Sn(kl,"CompositeExpressionBinder"),Sn(jh,"ProgramConfiguration",{omit:["_buffers"]}),Sn(ba,"ProgramConfigurationSet");const kv="-transition";class nc extends na{constructor(i,u){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==i.type&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&"sky"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),u.layout&&(this._unevaluatedLayout=new Be(u.layout)),u.paint)){this._transitionablePaint=new te(u.paint);for(const f in i.paint)this.setPaintProperty(f,i.paint[f],{validate:!1});for(const f in i.layout)this.setLayoutProperty(f,i.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new je(u.paint)}}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,u,f={}){null!=u&&this._validate(ft,`layers.${this.id}.layout.${i}`,i,u,f)||("visibility"!==i?this._unevaluatedLayout.setValue(i,u):this.visibility=u)}getPaintProperty(i){return Cn(i,kv)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,u,f={}){if(null!=u&&this._validate(ke,`layers.${this.id}.paint.${i}`,i,u,f))return!1;if(Cn(i,kv))return this._transitionablePaint.setTransition(i.slice(0,-11),u||void 0),!1;{const m=this._transitionablePaint._values[i],w=m.value.isDataDriven(),S=m.value;this._transitionablePaint.setValue(i,u),this._handleSpecialPaintPropertyUpdate(i);const M=this._transitionablePaint._values[i].value,R=M.isDataDriven(),L=Cn(i,"pattern")||"line-dasharray"===i;return R||w||L||this._handleOverridablePaintPropertyUpdate(i,S,M)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,u,f){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,u){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,u)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),En(i,(u,f)=>!(void 0===u||"layout"===f&&!Object.keys(u).length||"paint"===f&&!Object.keys(u).length))}_validate(i,u,f,m,w={}){return(!w||!1!==w.validate)&&$t(this,i.call(ce,{key:u,layerType:this.type,objectKey:f,value:m,styleSpec:Ht,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const u=this.paint.get(i);if(u instanceof Ne&&Jl(u.property.specification)&&("source"===u.value.kind||"composite"===u.value.kind)&&u.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Nc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Fv=Et([{name:"a_pos",components:2,type:"Int16"}],4),ng=Et([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Zo{constructor(i=[]){this.segments=i}prepareSegment(i,u,f,m){let w=this.segments[this.segments.length-1];return i>Zo.MAX_VERTEX_ARRAY_LENGTH&&cr(`Max vertices per segment is ${Zo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!w||w.vertexLength+i>Zo.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==m)&&(w={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},void 0!==m&&(w.sortKey=m),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const i of this.segments)for(const u in i.vaos)i.vaos[u].destroy()}static simpleSegment(i,u,f,m){return new Zo([{vertexOffset:i,primitiveOffset:u,vertexLength:f,primitiveLength:m,vaos:{},sortKey:0}])}}Zo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Sn(Zo,"SegmentVector");var ar=8192;class gc{constructor(i,u){i&&(u?this.setSouthWest(i).setNorthEast(u):4===i.length?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof ko?new ko(i.lng,i.lat):ko.convert(i),this}setSouthWest(i){return this._sw=i instanceof ko?new ko(i.lng,i.lat):ko.convert(i),this}extend(i){const u=this._sw,f=this._ne;let m,w;if(i instanceof ko)m=i,w=i;else{if(!(i instanceof gc))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(gc.convert(i)):this.extend(ko.convert(i)):"object"==typeof i&&null!==i&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(ko.convert(i)):this;if(m=i._sw,w=i._ne,!m||!w)return this}return u||f?(u.lng=Math.min(m.lng,u.lng),u.lat=Math.min(m.lat,u.lat),f.lng=Math.max(w.lng,f.lng),f.lat=Math.max(w.lat,f.lat)):(this._sw=new ko(m.lng,m.lat),this._ne=new ko(w.lng,w.lat)),this}getCenter(){return new ko((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ko(this.getWest(),this.getNorth())}getSouthEast(){return new ko(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:u,lat:f}=ko.convert(i);let m=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&m}static convert(i){return!i||i instanceof gc?i:new gc(i)}}var Mf=1e-6,Su=typeof Float32Array<"u"?Float32Array:Array;function rg(){var s=new Su(9);return Su!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function Qm(s,i,u){var f=i[0],m=i[1],w=i[2],S=i[3],M=i[4],R=i[5],L=i[6],z=i[7],V=i[8],G=u[0],X=u[1],K=u[2],ue=u[3],Ce=u[4],Ge=u[5],nt=u[6],$e=u[7],et=u[8];return s[0]=G*f+X*S+K*L,s[1]=G*m+X*M+K*z,s[2]=G*w+X*R+K*V,s[3]=ue*f+Ce*S+Ge*L,s[4]=ue*m+Ce*M+Ge*z,s[5]=ue*w+Ce*R+Ge*V,s[6]=nt*f+$e*S+et*L,s[7]=nt*m+$e*M+et*z,s[8]=nt*w+$e*R+et*V,s}function rc(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function ey(s,i){var u=i[0],f=i[1],m=i[2],w=i[3],S=i[4],M=i[5],R=i[6],L=i[7],z=i[8],V=i[9],G=i[10],X=i[11],K=i[12],ue=i[13],Ce=i[14],Ge=i[15],nt=u*M-f*S,$e=u*R-m*S,et=u*L-w*S,ct=f*R-m*M,ut=f*L-w*M,Bt=m*L-w*R,Ot=z*ue-V*K,Yt=z*Ce-G*K,yn=z*Ge-X*K,jt=V*Ce-G*ue,Qt=V*Ge-X*ue,en=G*Ge-X*Ce,ln=nt*en-$e*Qt+et*jt+ct*yn-ut*Yt+Bt*Ot;return ln?(s[0]=(M*en-R*Qt+L*jt)*(ln=1/ln),s[1]=(m*Qt-f*en-w*jt)*ln,s[2]=(ue*Bt-Ce*ut+Ge*ct)*ln,s[3]=(G*ut-V*Bt-X*ct)*ln,s[4]=(R*yn-S*en-L*Yt)*ln,s[5]=(u*en-m*yn+w*Yt)*ln,s[6]=(Ce*et-K*Bt-Ge*$e)*ln,s[7]=(z*Bt-G*et+X*$e)*ln,s[8]=(S*Qt-M*yn+L*Ot)*ln,s[9]=(f*yn-u*Qt-w*Ot)*ln,s[10]=(K*ut-ue*et+Ge*nt)*ln,s[11]=(V*et-z*ut-X*nt)*ln,s[12]=(M*Yt-S*jt-R*Ot)*ln,s[13]=(u*jt-f*Yt+m*Ot)*ln,s[14]=(ue*$e-K*ct-Ce*nt)*ln,s[15]=(z*ct-V*$e+G*nt)*ln,s):null}function ic(s,i,u){var f=i[0],m=i[1],w=i[2],S=i[3],M=i[4],R=i[5],L=i[6],z=i[7],V=i[8],G=i[9],X=i[10],K=i[11],ue=i[12],Ce=i[13],Ge=i[14],nt=i[15],$e=u[0],et=u[1],ct=u[2],ut=u[3];return s[0]=$e*f+et*M+ct*V+ut*ue,s[1]=$e*m+et*R+ct*G+ut*Ce,s[2]=$e*w+et*L+ct*X+ut*Ge,s[3]=$e*S+et*z+ct*K+ut*nt,s[4]=($e=u[4])*f+(et=u[5])*M+(ct=u[6])*V+(ut=u[7])*ue,s[5]=$e*m+et*R+ct*G+ut*Ce,s[6]=$e*w+et*L+ct*X+ut*Ge,s[7]=$e*S+et*z+ct*K+ut*nt,s[8]=($e=u[8])*f+(et=u[9])*M+(ct=u[10])*V+(ut=u[11])*ue,s[9]=$e*m+et*R+ct*G+ut*Ce,s[10]=$e*w+et*L+ct*X+ut*Ge,s[11]=$e*S+et*z+ct*K+ut*nt,s[12]=($e=u[12])*f+(et=u[13])*M+(ct=u[14])*V+(ut=u[15])*ue,s[13]=$e*m+et*R+ct*G+ut*Ce,s[14]=$e*w+et*L+ct*X+ut*Ge,s[15]=$e*S+et*z+ct*K+ut*nt,s}function lh(s,i,u){var f,m,w,S,M,R,L,z,V,G,X,K,ue=u[0],Ce=u[1],Ge=u[2];return i===s?(s[12]=i[0]*ue+i[4]*Ce+i[8]*Ge+i[12],s[13]=i[1]*ue+i[5]*Ce+i[9]*Ge+i[13],s[14]=i[2]*ue+i[6]*Ce+i[10]*Ge+i[14],s[15]=i[3]*ue+i[7]*Ce+i[11]*Ge+i[15]):(m=i[1],w=i[2],S=i[3],M=i[4],R=i[5],L=i[6],z=i[7],V=i[8],G=i[9],X=i[10],K=i[11],s[0]=f=i[0],s[1]=m,s[2]=w,s[3]=S,s[4]=M,s[5]=R,s[6]=L,s[7]=z,s[8]=V,s[9]=G,s[10]=X,s[11]=K,s[12]=f*ue+M*Ce+V*Ge+i[12],s[13]=m*ue+R*Ce+G*Ge+i[13],s[14]=w*ue+L*Ce+X*Ge+i[14],s[15]=S*ue+z*Ce+K*Ge+i[15]),s}function Df(s,i,u){var f=u[0],m=u[1],w=u[2];return s[0]=i[0]*f,s[1]=i[1]*f,s[2]=i[2]*f,s[3]=i[3]*f,s[4]=i[4]*m,s[5]=i[5]*m,s[6]=i[6]*m,s[7]=i[7]*m,s[8]=i[8]*w,s[9]=i[9]*w,s[10]=i[10]*w,s[11]=i[11]*w,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s}function Bv(s,i,u){var f=Math.sin(u),m=Math.cos(u),w=i[4],S=i[5],M=i[6],R=i[7],L=i[8],z=i[9],V=i[10],G=i[11];return i!==s&&(s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[4]=w*m+L*f,s[5]=S*m+z*f,s[6]=M*m+V*f,s[7]=R*m+G*f,s[8]=L*m-w*f,s[9]=z*m-S*f,s[10]=V*m-M*f,s[11]=G*m-R*f,s}function ad(s,i,u){var f=Math.sin(u),m=Math.cos(u),w=i[0],S=i[1],M=i[2],R=i[3],L=i[8],z=i[9],V=i[10],G=i[11];return i!==s&&(s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=w*m-L*f,s[1]=S*m-z*f,s[2]=M*m-V*f,s[3]=R*m-G*f,s[8]=w*f+L*m,s[9]=S*f+z*m,s[10]=M*f+V*m,s[11]=R*f+G*m,s}function jx(s,i){return s[0]=i[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=i[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function zv(s,i,u){var f,m,w,S=u[0],M=u[1],R=u[2],L=Math.hypot(S,M,R);return L<Mf?null:(S*=L=1/L,M*=L,R*=L,f=Math.sin(i),m=Math.cos(i),s[0]=S*S*(w=1-m)+m,s[1]=M*S*w+R*f,s[2]=R*S*w-M*f,s[3]=0,s[4]=S*M*w-R*f,s[5]=M*M*w+m,s[6]=R*M*w+S*f,s[7]=0,s[8]=S*R*w+M*f,s[9]=M*R*w-S*f,s[10]=R*R*w+m,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,i=arguments.length;i--;)s+=arguments[i]*arguments[i];return Math.sqrt(s)});var Gx=ic;function Uv(){var s=new Su(3);return Su!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function $x(s){var i=new Su(3);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i}function ud(s){return Math.hypot(s[0],s[1],s[2])}function ch(s,i,u){var f=new Su(3);return f[0]=s,f[1]=i,f[2]=u,f}function hh(s,i,u){return s[0]=i[0]+u[0],s[1]=i[1]+u[1],s[2]=i[2]+u[2],s}function ld(s,i,u){return s[0]=i[0]-u[0],s[1]=i[1]-u[1],s[2]=i[2]-u[2],s}function ig(s,i,u){return s[0]=i[0]*u[0],s[1]=i[1]*u[1],s[2]=i[2]*u[2],s}function Gh(s,i,u){return s[0]=Math.min(i[0],u[0]),s[1]=Math.min(i[1],u[1]),s[2]=Math.min(i[2],u[2]),s}function og(s,i,u){return s[0]=Math.max(i[0],u[0]),s[1]=Math.max(i[1],u[1]),s[2]=Math.max(i[2],u[2]),s}function hl(s,i,u){return s[0]=i[0]*u,s[1]=i[1]*u,s[2]=i[2]*u,s}function cd(s,i,u,f){return s[0]=i[0]+u[0]*f,s[1]=i[1]+u[1]*f,s[2]=i[2]+u[2]*f,s}function Fu(s,i){var u=i[0],f=i[1],m=i[2],w=u*u+f*f+m*m;return w>0&&(w=1/Math.sqrt(w)),s[0]=i[0]*w,s[1]=i[1]*w,s[2]=i[2]*w,s}function Ea(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]}function ty(s,i,u){var f=i[0],m=i[1],w=i[2],S=u[0],M=u[1],R=u[2];return s[0]=m*R-w*M,s[1]=w*S-f*R,s[2]=f*M-m*S,s}function ds(s,i,u){var f=i[0],m=i[1],w=i[2],S=u[3]*f+u[7]*m+u[11]*w+u[15];return s[0]=(u[0]*f+u[4]*m+u[8]*w+u[12])/(S=S||1),s[1]=(u[1]*f+u[5]*m+u[9]*w+u[13])/S,s[2]=(u[2]*f+u[6]*m+u[10]*w+u[14])/S,s}function sg(s,i,u){var f=u[0],m=u[1],w=u[2],S=i[0],M=i[1],R=i[2],L=m*R-w*M,z=w*S-f*R,V=f*M-m*S,G=m*V-w*z,X=w*L-f*V,K=f*z-m*L,ue=2*u[3];return z*=ue,V*=ue,X*=2,K*=2,s[0]=S+(L*=ue)+(G*=2),s[1]=M+z+X,s[2]=R+V+K,s}var hd,Fl=ld,ny=ig,qx=ud;function ry(s,i,u){return s[0]=i[0]*u,s[1]=i[1]*u,s[2]=i[2]*u,s[3]=i[3]*u,s}function iy(s,i){var u=i[0],f=i[1],m=i[2],w=i[3],S=u*u+f*f+m*m+w*w;return S>0&&(S=1/Math.sqrt(S)),s[0]=u*S,s[1]=f*S,s[2]=m*S,s[3]=w*S,s}function $h(s,i,u){var f=i[0],m=i[1],w=i[2],S=i[3];return s[0]=u[0]*f+u[4]*m+u[8]*w+u[12]*S,s[1]=u[1]*f+u[5]*m+u[9]*w+u[13]*S,s[2]=u[2]*f+u[6]*m+u[10]*w+u[14]*S,s[3]=u[3]*f+u[7]*m+u[11]*w+u[15]*S,s}function oy(){var s=new Su(4);return Su!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function Vv(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function ap(s,i,u){u*=.5;var f=i[0],m=i[1],w=i[2],S=i[3],M=Math.sin(u),R=Math.cos(u);return s[0]=f*R+S*M,s[1]=m*R+w*M,s[2]=w*R-m*M,s[3]=S*R-f*M,s}function qh(s,i,u){u*=.5;var f=i[0],m=i[1],w=i[2],S=i[3],M=Math.sin(u),R=Math.cos(u);return s[0]=f*R-w*M,s[1]=m*R+S*M,s[2]=w*R+f*M,s[3]=S*R-m*M,s}Uv(),hd=new Su(4),Su!=Float32Array&&(hd[0]=0,hd[1]=0,hd[2]=0,hd[3]=0);var Hx=iy;Uv(),ch(1,0,0),ch(0,1,0),oy(),oy(),rg();const jv=Et([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:sy}=jv,Af=Et([{name:"a_pos_3",components:3,type:"Int16"}]);var up=Et([{name:"a_pos",type:"Int16",components:2}]);class ag{constructor(i,u){this.pos=i,this.dir=u}intersectsPlane(i,u,f){const m=Ea(u,this.dir);if(Math.abs(m)<1e-6)return!1;const w=((i[0]-this.pos[0])*u[0]+(i[1]-this.pos[1])*u[1]+(i[2]-this.pos[2])*u[2])/m;return f[0]=this.pos[0]+this.dir[0]*w,f[1]=this.pos[1]+this.dir[1]*w,f[2]=this.pos[2]+this.dir[2]*w,!0}closestPointOnSphere(i,u,f){if(ue=(X=this.pos)[0],Ce=X[1],Ge=X[2],nt=(K=i)[0],$e=K[1],et=K[2],Math.abs(ue-nt)<=Mf*Math.max(1,Math.abs(ue),Math.abs(nt))&&Math.abs(Ce-$e)<=Mf*Math.max(1,Math.abs(Ce),Math.abs($e))&&Math.abs(Ge-et)<=Mf*Math.max(1,Math.abs(Ge),Math.abs(et))||0===u)return f[0]=f[1]=f[2]=0,!1;var X,K,ue,Ce,Ge,nt,$e,et;const[m,w,S]=this.dir,M=this.pos[0]-i[0],R=this.pos[1]-i[1],L=this.pos[2]-i[2],z=m*m+w*w+S*S,V=2*(M*m+R*w+L*S),G=V*V-4*z*(M*M+R*R+L*L-u*u);if(G<0){const X=Math.max(-V/2,0),K=M+m*X,ue=R+w*X,Ce=L+S*X,Ge=Math.hypot(K,ue,Ce);return f[0]=K*u/Ge,f[1]=ue*u/Ge,f[2]=Ce*u/Ge,!1}{const X=(-V-Math.sqrt(G))/(2*z);if(X<0){const K=Math.hypot(M,R,L);return f[0]=M*u/K,f[1]=R*u/K,f[2]=L*u/K,!1}return f[0]=M+m*X,f[1]=R+w*X,f[2]=L+S*X,!0}}}class lp{constructor(i,u,f,m,w){this.TL=i,this.TR=u,this.BR=f,this.BL=m,this.horizon=w}static fromInvProjectionMatrix(i,u,f){const m=[-1,1,1],w=[1,1,1],S=[1,-1,1],M=[-1,-1,1],R=ds(m,m,i),L=ds(w,w,i),z=ds(S,S,i),V=ds(M,M,i);return new lp(R,L,z,V,u/f)}}class ay{constructor(i,u){this.points=i,this.planes=u}static fromInvProjectionMatrix(i,u,f,m){const w=Math.pow(2,f),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(R=>{const L=$h([],R,i),z=1/L[3]/u*w;return(V=L)[0]=(G=L)[0]*(X=[z,z,m?1/L[3]:z,z])[0],V[1]=G[1]*X[1],V[2]=G[2]*X[2],V[3]=G[3]*X[3],V;var V,G,X}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(R=>{const L=Fu([],ty([],Fl([],S[R[0]],S[R[1]]),Fl([],S[R[2]],S[R[1]]))),z=-Ea(L,S[R[1]]);return L.concat(z)});return new ay(S,M)}}class Iu{static fromPoints(i){const u=[1/0,1/0,1/0],f=[-1/0,-1/0,-1/0];for(const m of i)Gh(u,u,m),og(f,f,m);return new Iu(u,f)}static applyTransform(i,u){const f=i.getCorners();for(let m=0;m<f.length;++m)ds(f[m],f[m],u);return Iu.fromPoints(f)}constructor(i,u){this.min=i,this.max=u,this.center=hl([],hh([],this.min,this.max),.5)}quadrant(i){const u=[i%2==0,i<2],f=$x(this.min),m=$x(this.max);for(let w=0;w<u.length;w++)f[w]=u[w]?this.min[w]:this.center[w],m[w]=u[w]?this.center[w]:this.max[w];return m[2]=this.max[2],new Iu(f,m)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,u=this.max;return[[i[0],i[1],i[2]],[u[0],i[1],i[2]],[u[0],u[1],i[2]],[i[0],u[1],i[2]],[i[0],i[1],u[2]],[u[0],i[1],u[2]],[u[0],u[1],u[2]],[i[0],u[1],u[2]]]}intersects(i){const u=this.getCorners();let f=!0;for(let m=0;m<i.planes.length;m++){const w=i.planes[m];let S=0;for(let M=0;M<u.length;M++)S+=Ea(w,u[M])+w[3]>=0;if(0===S)return 0;S!==u.length&&(f=!1)}if(f)return 2;for(let m=0;m<3;m++){let w=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let M=0;M<i.points.length;M++){const R=i.points[M][m]-this.min[m];w=Math.min(w,R),S=Math.max(S,R)}if(S<0||w>this.max[m]-this.min[m])return 0}return 1}}const fd=5,Pf=6,Zu=ar/Math.PI/2,dd=16383,Rf=[64,32,16],Tu=-Zu,mc=Zu,Wx=[new Iu([Tu,Tu,Tu],[mc,mc,mc]),new Iu([Tu,Tu,Tu],[0,0,mc]),new Iu([0,Tu,Tu],[mc,0,mc]),new Iu([Tu,0,Tu],[0,mc,mc]),new Iu([0,0,Tu],[mc,mc,mc])];function uy(s){return s*Zu/ug}function Xx(s,i,u,f=!0){const m=hl([],s._camera.position,s.worldSize),w=[i,u,1,1];$h(w,w,s.pixelMatrixInverse),ry(w,w,1/w[3]);const S=Fu([],Fl([],w,m)),M=s.globeMatrix,R=[M[12],M[13],M[14]],L=Fl([],R,m),z=ud(L),V=Fu([],L),G=s.worldSize/(2*Math.PI),X=Ea(V,S),K=Math.asin(G/z);if(K<Math.acos(X)){if(!f)return null;const yn=[],jt=[];hl(yn,S,z/X),Fu(jt,Fl(jt,yn,L)),Fu(S,hh(S,L,hl(S,jt,Math.tan(K)*z)))}const ue=[];new ag(m,S).closestPointOnSphere(R,G,ue);const Ce=Fu([],Ze(M,0)),Ge=Fu([],Ze(M,1)),nt=Fu([],Ze(M,2)),$e=Ea(Ce,ue),et=Ea(Ge,ue),ct=Ea(nt,ue),ut=Ue(Math.asin(-et/G));let Bt=Ue(Math.atan2($e,ct));Bt=s.center.lng+function(yn,jt){const Qt=(jt-yn+180)%360-180;return Qt<-180?Qt+360:Qt}(s.center.lng,Bt);const Ot=zc(Bt),Yt=De(Uc(ut),0,1);return new dh(Ot,Yt)}class sS{constructor(i,u,f){this.a=Fl([],i,f),this.b=Fl([],u,f),this.center=f;const m=Fu([],this.a),w=Fu([],this.b);this.angle=Math.acos(Ea(m,w))}}function Gv(s,i){if(0===s.angle)return null;let u;return u=0===s.a[i]?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[i]/s.a[i]/Math.sin(s.angle)-1/Math.tan(s.angle)),u<0||u>1?null:function(f,m,w,S){const M=Math.sin(w);return f*(Math.sin((1-S)*w)/M)+m*(Math.sin(S*w)/M)}(s.a[i],s.b[i],s.angle,De(u,0,1))+s.center[i]}function fh(s){if(s.z<=1)return Wx[s.z+2*s.y+s.x];const i=ly(ha(s));return Iu.fromPoints(i)}function pd(s,i,u){return hl(s,s,1-u),cd(s,s,i,u)}function gd(s,i){const u=cp(i.zoom);if(0===u)return fh(s);const f=ha(s),m=ly(f),w=zc(f.getWest())*i.worldSize,S=zc(f.getEast())*i.worldSize,M=Uc(f.getNorth())*i.worldSize,R=Uc(f.getSouth())*i.worldSize,L=[w,M,0],z=[S,M,0],V=[w,R,0],G=[S,R,0],X=ey([],i.globeMatrix);return ds(L,L,X),ds(z,z,X),ds(V,V,X),ds(G,G,X),m[0]=pd(m[0],V,u),m[1]=pd(m[1],G,u),m[2]=pd(m[2],z,u),m[3]=pd(m[3],L,u),Iu.fromPoints(m)}function Zx(s,i,u){for(const f of s)ds(f,f,i),hl(f,f,u)}function ha({x:s,y:i,z:u}){const f=1/(1<<u),m=new ko(Yu(s*f),Ca((i+1)*f)),w=new ko(Yu((s+1)*f),Ca(i*f));return new gc(m,w)}function ly(s){const i=qe(s.getNorth()),u=qe(s.getSouth()),f=Math.cos(i),m=Math.cos(u),w=Math.sin(i),S=Math.sin(u),M=s.getWest(),R=s.getEast();return[Bc(m,S,M),Bc(m,S,R),Bc(f,w,R),Bc(f,w,M)]}function Bc(s,i,u,f=Zu){return u=qe(u),[s*Math.sin(u)*f,-i*f,s*Math.cos(u)*f]}function md(s,i,u){return Bc(Math.cos(qe(s)),Math.sin(qe(s)),i,u)}function Bu(s,i,u,f){const m=1<<u.z,w=(s/ar+u.x)/m;return md(Ca((i/ar+u.y)/m),Yu(w),f)}function Wh({min:s,max:i}){return dd/Math.max(i[0]-s[0],i[1]-s[1],i[2]-s[2])}const cy=new Float64Array(16);function Xh(s){const i=Wh(s),u=jx(cy,[i,i,i]);return lh(u,u,((f=[])[0]=-(m=s.min)[0],f[1]=-m[1],f[2]=-m[2],f));var f,m}function Lf(s){const i=(f=s.min,(u=cy)[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=f[0],u[13]=f[1],u[14]=f[2],u[15]=1,u);var u,f;const m=1/Wh(s);return Df(i,i,[m,m,m])}function $v(s,i,u,f,m){const w=function(R){const L=ar/(2*Math.PI);return R/(2*Math.PI)/L}(u),S=[s,i,-u/(2*Math.PI)],M=rc(new Float64Array(16));return lh(M,M,S),Df(M,M,[w,w,w]),Bv(M,M,qe(-m)),ad(M,M,qe(-f)),M}function cp(s){return pt(fd,Pf,s)}function qv(s,i){const u=md(i.lat,i.lng);return S=(m=ld([],function(K){const ue=md(K._center.lat,K._center.lng);let Ce=ty([],ch(0,1,0),ue);const Ge=zv([],-K.angle,ue);Ce=ds(Ce,Ce,Ge),zv(Ge,-K._pitch,Ce);const nt=Fu([],ue);return hl(nt,nt,uy(K.cameraToCenterDistance/K.pixelsPerMeter)),ds(nt,nt,Ge),hh([],ue,nt)}(s),u))[0],M=m[1],R=m[2],L=(w=u)[0],z=w[1],V=w[2],X=(G=Math.sqrt(S*S+M*M+R*R)*Math.sqrt(L*L+z*z+V*V))&&Ea(m,w)/G,Math.acos(Math.min(Math.max(X,-1),1));var m,w,S,M,R,L,z,V,G,X}function Hv(s,i){return qv(s,i)>Math.PI/2*1.01}const fl=qe(85),hy=Math.cos(fl),yd=Math.sin(fl),ug=6371008.8,fy=2*Math.PI*ug;class Zh{constructor(i,u){if(isNaN(i)||isNaN(u))throw new Error(`Invalid LngLat object: (${i}, ${u})`);if(this.lng=+i,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Zh(Fe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const u=Math.PI/180,f=this.lat*u,m=i.lat*u,w=Math.sin(f)*Math.sin(m)+Math.cos(f)*Math.cos(m)*Math.cos((i.lng-this.lng)*u);return ug*Math.acos(Math.min(w,1))}toBounds(i=0){const u=360*i/40075017,f=u/Math.cos(Math.PI/180*this.lat);return new gc(new Zh(this.lng-f,this.lat-u),new Zh(this.lng+f,this.lat+u))}toEcef(i){const u=uy(i);return md(this.lat,this.lng,Zu+u)}static convert(i){if(i instanceof Zh)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new Zh(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new Zh(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var ko=Zh;function dy(s){return fy*Math.cos(s*Math.PI/180)}function zc(s){return(180+s)/360}function Uc(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function yc(s,i){return s/dy(i)}function Yu(s){return 360*s-180}function Ca(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Wv(s,i){return s*dy(Ca(i))}const Sa=85.051129;function Xv(s){return 1/Math.cos(s*Math.PI/180)}class dh{constructor(i,u,f=0){this.x=+i,this.y=+u,this.z=+f}static fromLngLat(i,u=0){const f=ko.convert(i);return new dh(zc(f.lng),Uc(f.lat),yc(u,f.lat))}toLngLat(){return new ko(Yu(this.x),Ca(this.y))}toAltitude(){return Wv(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/fy*Xv(Ca(this.y))}}function py(s,i,u,f,m,w,S,M,R){const L=(i+f)/2,z=(u+m)/2,V=new Z(L,z);M(V),function(G,X,K,ue,Ce,Ge){const nt=K-Ce,$e=ue-Ge;return Math.abs((ue-X)*nt-(K-G)*$e)/Math.hypot(nt,$e)}(V.x,V.y,w.x,w.y,S.x,S.y)>=R?(py(s,i,u,L,z,w,V,M,R),py(s,L,z,f,m,V,S,M,R)):s.push(S)}function gy(s,i,u){let f=s[0],m=f.x,w=f.y;i(f);const S=[f];for(let M=1;M<s.length;M++){const R=s[M],{x:L,y:z}=R;i(R),py(S,m,w,L,z,f,R,i,u),m=L,w=z,f=R}return S}function hp(s,i,u,f){if(f(i,u)){const m=i.add(u)._mult(.5);hp(s,i,m,f),hp(s,m,u,f)}else s.push(u)}function lg(s,i){let u=s[0];const f=[u];for(let m=1;m<s.length;m++){const w=s[m];hp(f,u,w,i),u=w}return f}const cg=Math.pow(2,14)-1,Zv=-cg-1;function Yx(s,i){const u=Math.round(s.x*i),f=Math.round(s.y*i);return s.x=De(u,Zv,cg),s.y=De(f,Zv,cg),(u<s.x||u>s.x+1||f<s.y||f>s.y+1)&&cr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function dl(s,i,u){const f=s.loadGeometry(),m=s.extent,w=ar/m;if(i&&u&&u.projection.isReprojectedInTileSpace){const S=1<<i.z,{scale:M,x:R,y:L,projection:z}=u,V=G=>{const X=Yu((i.x+G.x/m)/S),K=Ca((i.y+G.y/m)/S),ue=z.project(X,K);G.x=(ue.x*M-R)*m,G.y=(ue.y*M-L)*m};for(let G=0;G<f.length;G++)if(1!==s.type)f[G]=gy(f[G],V,1);else{const X=[];for(const K of f[G])K.x<0||K.x>=m||K.y<0||K.y>=m||(V(K),X.push(K));f[G]=X}}for(const S of f)for(const M of S)Yx(M,w);return f}function _c(s,i){return{type:s.type,id:s.id,properties:s.properties,geometry:i?dl(s):[]}}function hg(s,i,u,f,m){s.emplaceBack(2*i+(f+1)/2,2*u+(m+1)/2)}function my(s,i,u){s.emplaceBack(i.x,i.y,i.z,16384*u[0],16384*u[1],16384*u[2])}class fg{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new mn,this.indexArray=new Jn,this.segments=new Zo,this.programConfigurations=new ba(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,f,m){const w=this.layers[0],S=[];let M=null;"circle"===w.type&&(M=w.layout.get("circle-sort-key"));for(const{feature:L,id:z,index:V,sourceLayerIndex:G}of i){const X=this.layers[0]._featureFilter.needGeometry,K=_c(L,X);if(!this.layers[0]._featureFilter.filter(new U(this.zoom),K,f))continue;const ue=M?M.evaluate(K,{},f):void 0,Ce={id:z,properties:L.properties,type:L.type,sourceLayerIndex:G,index:V,geometry:X?K.geometry:dl(L,f,m),patterns:{},sortKey:ue};S.push(Ce)}M&&S.sort((L,z)=>L.sortKey-z.sortKey);let R=null;"globe"===m.projection.name&&(this.globeExtVertexArray=new un,R=m.projection);for(const L of S){const{geometry:z,index:V,sourceLayerIndex:G}=L,X=i[V].feature;this.addFeature(L,z,V,u.availableImages,f,R),u.featureIndex.insert(X,z,V,G,this.index)}}update(i,u,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,f,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Fv.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,ng.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,u,f,m,w,S){for(const M of u)for(const R of M){const L=R.x,z=R.y;if(L<0||L>=ar||z<0||z>=ar)continue;if(S){const X=S.projectTilePoint(L,z,w),K=S.upVector(w,L,z),ue=this.globeExtVertexArray;my(ue,X,K),my(ue,X,K),my(ue,X,K),my(ue,X,K)}const V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),G=V.vertexLength;hg(this.layoutVertexArray,L,z,-1,-1),hg(this.layoutVertexArray,L,z,1,-1),hg(this.layoutVertexArray,L,z,1,1),hg(this.layoutVertexArray,L,z,-1,1),this.indexArray.emplaceBack(G,G+1,G+2),this.indexArray.emplaceBack(G,G+2,G+3),V.vertexLength+=4,V.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,{},m,w)}}function Yv(s,i){for(let u=0;u<s.length;u++)if(_d(i,s[u]))return!0;for(let u=0;u<i.length;u++)if(_d(s,i[u]))return!0;return!!yy(s,i)}function uS(s,i,u){return!!_d(s,i)||!!pg(i,s,u)}function Kv(s,i){if(1===s.length)return _y(i,s[0]);for(let u=0;u<i.length;u++){const f=i[u];for(let m=0;m<f.length;m++)if(_d(s,f[m]))return!0}for(let u=0;u<s.length;u++)if(_y(i,s[u]))return!0;for(let u=0;u<i.length;u++)if(yy(s,i[u]))return!0;return!1}function Kx(s,i,u){if(s.length>1){if(yy(s,i))return!0;for(let f=0;f<i.length;f++)if(pg(i[f],s,u))return!0}for(let f=0;f<s.length;f++)if(pg(s[f],i,u))return!0;return!1}function yy(s,i){if(0===s.length||0===i.length)return!1;for(let u=0;u<s.length-1;u++){const f=s[u],m=s[u+1];for(let w=0;w<i.length-1;w++)if(dg(f,m,i[w],i[w+1]))return!0}return!1}function dg(s,i,u,f){return oi(s,u,f)!==oi(i,u,f)&&oi(s,i,u)!==oi(s,i,f)}function pg(s,i,u){const f=u*u;if(1===i.length)return s.distSqr(i[0])<f;for(let m=1;m<i.length;m++)if(Jv(s,i[m-1],i[m])<f)return!0;return!1}function Jv(s,i,u){const f=i.distSqr(u);if(0===f)return s.distSqr(i);const m=((s.x-i.x)*(u.x-i.x)+(s.y-i.y)*(u.y-i.y))/f;return s.distSqr(m<0?i:m>1?u:u.sub(i)._mult(m)._add(i))}function _y(s,i){let u,f,m,w=!1;for(let S=0;S<s.length;S++){u=s[S];for(let M=0,R=u.length-1;M<u.length;R=M++)f=u[M],m=u[R],f.y>i.y!=m.y>i.y&&i.x<(m.x-f.x)*(i.y-f.y)/(m.y-f.y)+f.x&&(w=!w)}return w}function _d(s,i){let u=!1;for(let f=0,m=s.length-1;f<s.length;m=f++){const w=s[f],S=s[m];w.y>i.y!=S.y>i.y&&i.x<(S.x-w.x)*(i.y-w.y)/(S.y-w.y)+w.x&&(u=!u)}return u}function vy(s,i,u,f,m){for(const S of s)if(i<=S.x&&u<=S.y&&f>=S.x&&m>=S.y)return!0;const w=[new Z(i,u),new Z(i,m),new Z(f,m),new Z(f,u)];if(s.length>2)for(const S of w)if(_d(s,S))return!0;for(let S=0;S<s.length-1;S++)if(lS(s[S],s[S+1],w))return!0;return!1}function lS(s,i,u){const f=u[0],m=u[2];if(s.x<f.x&&i.x<f.x||s.x>m.x&&i.x>m.x||s.y<f.y&&i.y<f.y||s.y>m.y&&i.y>m.y)return!1;const w=oi(s,i,u[0]);return w!==oi(s,i,u[1])||w!==oi(s,i,u[2])||w!==oi(s,i,u[3])}function vd(s,i,u){const f=i.paint.get(s).value;return"constant"===f.kind?f.value:u.programConfigurations.get(i.id).getMaxValue(s)}function gg(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function mg(s,i,u,f,m){if(!i[0]&&!i[1])return s;const w=Z.convert(i)._mult(m);"viewport"===u&&w._rotate(-f);const S=[];for(let M=0;M<s.length;M++)S.push(s[M].sub(w));return S}function Jx(s,i,u,f){const m=Z.convert(s)._mult(f);return"viewport"===i&&m._rotate(-u),m}Sn(fg,"CircleBucket",{omit:["layers"]});const cS=new He({"circle-sort-key":new Pe(Ht.layout_circle["circle-sort-key"])});var xy={paint:new He({"circle-radius":new Pe(Ht.paint_circle["circle-radius"]),"circle-color":new Pe(Ht.paint_circle["circle-color"]),"circle-blur":new Pe(Ht.paint_circle["circle-blur"]),"circle-opacity":new Pe(Ht.paint_circle["circle-opacity"]),"circle-translate":new oe(Ht.paint_circle["circle-translate"]),"circle-translate-anchor":new oe(Ht.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new oe(Ht.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new oe(Ht.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Pe(Ht.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Pe(Ht.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Pe(Ht.paint_circle["circle-stroke-opacity"])}),layout:cS};function Qx(s,i,u,f,m,w,S,M,R){if(w&&s.queryGeometry.isAboveHorizon)return!1;w&&(R*=s.pixelToTileUnitsFactor);const L=s.tileID.canonical,z=u.projection.upVectorScale(L,u.center.lat,u.worldSize).metersToTile;for(const V of i)for(const G of V){const X=G.add(M),K=m&&u.elevation?u.elevation.exaggeration()*m.getElevationAt(X.x,X.y,!0):0,ue=u.projection.projectTilePoint(X.x,X.y,L);if(K>0){const $e=u.projection.upVector(L,X.x,X.y);ue.x+=$e[0]*z*K,ue.y+=$e[1]*z*K,ue.z+=$e[2]*z*K}const Ce=w?X:hS(ue.x,ue.y,ue.z,f),Ge=w?s.tilespaceRays.map($e=>dS($e,K)):s.queryGeometry.screenGeometry,nt=$h([],[ue.x,ue.y,ue.z,1],f);if(!S&&w?R*=nt[3]/u.cameraToCenterDistance:S&&!w&&(R*=u.cameraToCenterDistance/nt[3]),w){const $e=Ca((G.y/ar+L.y)/(1<<L.z));R/=u.projection.pixelsPerMeter($e,1)/yc(1,$e)}if(uS(Ge,Ce,R))return!0}return!1}function hS(s,i,u,f){const m=$h([],[s,i,u,1],f);return new Z(m[0]/m[3],m[1]/m[3])}const ew=ch(0,0,0),fS=ch(0,0,1);function dS(s,i){const u=Uv();return ew[2]=i,s.intersectsPlane(ew,fS,u),new Z(u[0],u[1])}class Qv extends fg{}function fp(s,{width:i,height:u},f,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==i*u*f)throw new RangeError("mismatched image size")}else m=new Uint8Array(i*u*f);return s.width=i,s.height=u,s.data=m,s}function yg(s,i,u){const{width:f,height:m}=i;f===s.width&&m===s.height||(_g(s,i,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,f),height:Math.min(s.height,m)},u),s.width=f,s.height=m,s.data=i.data)}function _g(s,i,u,f,m,w){if(0===m.width||0===m.height)return i;if(m.width>s.width||m.height>s.height||u.x>s.width-m.width||u.y>s.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>i.width||m.height>i.height||f.x>i.width-m.width||f.y>i.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const S=s.data,M=i.data;for(let R=0;R<m.height;R++){const L=((u.y+R)*s.width+u.x)*w,z=((f.y+R)*i.width+f.x)*w;for(let V=0;V<m.width*w;V++)M[z+V]=S[L+V]}return i}Sn(Qv,"HeatmapBucket",{omit:["layers"]});class Vc{constructor(i,u){fp(this,i,1,u)}resize(i){yg(this,new Vc(i),1)}clone(){return new Vc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,u,f,m,w){_g(i,u,f,m,w,1)}}class Ku{constructor(i,u){fp(this,i,4,u)}resize(i){yg(this,new Ku(i),4)}replace(i,u){u?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Ku({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,u,f,m,w){_g(i,u,f,m,w,4)}}Sn(Vc,"AlphaImage"),Sn(Ku,"RGBAImage");var xd={paint:new He({"heatmap-radius":new Pe(Ht.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Pe(Ht.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new oe(Ht.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Xe(Ht.paint_heatmap["heatmap-color"]),"heatmap-opacity":new oe(Ht.paint_heatmap["heatmap-opacity"])})};function vg(s){const i={},u=s.resolution||256,f=s.clips?s.clips.length:1,m=s.image||new Ku({width:u,height:f}),w=(S,M,R)=>{i[s.evaluationKey]=R;const L=s.expression.evaluate(i);m.data[S+M+0]=Math.floor(255*L.r/L.a),m.data[S+M+1]=Math.floor(255*L.g/L.a),m.data[S+M+2]=Math.floor(255*L.b/L.a),m.data[S+M+3]=Math.floor(255*L.a)};if(s.clips)for(let S=0,M=0;S<f;++S,M+=4*u)for(let R=0,L=0;R<u;R++,L+=4){const z=R/(u-1),{start:V,end:G}=s.clips[S];w(M,L,V*(1-z)+G*z)}else for(let S=0,M=0;S<u;S++,M+=4)w(0,M,S/(u-1));return m}var xg={paint:new He({"hillshade-illumination-direction":new oe(Ht.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new oe(Ht.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new oe(Ht.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new oe(Ht.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new oe(Ht.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new oe(Ht.paint_hillshade["hillshade-accent-color"])})};const wg=Et([{name:"a_pos",components:2,type:"Int16"}],4),{members:pl}=wg;var wy={exports:{}};function bg(s,i,u){u=u||2;var f,m,w,S,M,R,L,z=i&&i.length,V=z?i[0]*u:s.length,G=e0(s,0,V,u,!0),X=[];if(!G||G.next===G.prev)return X;if(z&&(G=function(ue,Ce,Ge,nt){var $e,et,ct,ut=[];for($e=0,et=Ce.length;$e<et;$e++)(ct=e0(ue,Ce[$e]*nt,$e<et-1?Ce[$e+1]*nt:ue.length,nt,!1))===ct.next&&(ct.steiner=!0),ut.push(n0(ct));for(ut.sort(iw),$e=0;$e<ut.length;$e++)Ge=ow(ut[$e],Ge);return Ge}(s,i,G,u)),s.length>80*u){f=w=s[0],m=S=s[1];for(var K=u;K<V;K+=u)(M=s[K])<f&&(f=M),(R=s[K+1])<m&&(m=R),M>w&&(w=M),R>S&&(S=R);L=0!==(L=Math.max(w-f,S-m))?32767/L:0}return Of(G,X,u,f,m,L,0),X}function e0(s,i,u,f,m){var w,S;if(m===Sy(s,i,u,f)>0)for(w=i;w<u;w+=f)S=r0(w,s[w],s[w+1],S);else for(w=u-f;w>=i;w-=f)S=r0(w,s[w],s[w+1],S);return S&&pp(S,S.next)&&(wd(S),S=S.next),S}function Yh(s,i){if(!s)return s;i||(i=s);var u,f=s;do{if(u=!1,f.steiner||!pp(f,f.next)&&0!==ps(f.prev,f,f.next))f=f.next;else{if(wd(f),(f=i=f.prev)===f.next)break;u=!0}}while(u||f!==i);return i}function Of(s,i,u,f,m,w,S){if(s){!S&&w&&function(z,V,G,X){var K=z;do{0===K.z&&(K.z=dp(K.x,K.y,V,G,X)),K.prevZ=K.prev,K.nextZ=K.next,K=K.next}while(K!==z);K.prevZ.nextZ=null,K.prevZ=null,function(ue){var Ce,Ge,nt,$e,et,ct,ut,Bt,Ot=1;do{for(Ge=ue,ue=null,et=null,ct=0;Ge;){for(ct++,nt=Ge,ut=0,Ce=0;Ce<Ot&&(ut++,nt=nt.nextZ);Ce++);for(Bt=Ot;ut>0||Bt>0&&nt;)0!==ut&&(0===Bt||!nt||Ge.z<=nt.z)?($e=Ge,Ge=Ge.nextZ,ut--):($e=nt,nt=nt.nextZ,Bt--),et?et.nextZ=$e:ue=$e,$e.prevZ=et,et=$e;Ge=nt}et.nextZ=null,Ot*=2}while(ct>1)}(K)}(s,f,m,w);for(var M,R,L=s;s.prev!==s.next;)if(M=s.prev,R=s.next,w?nw(s,f,m,w):tw(s))i.push(M.i/u|0),i.push(s.i/u|0),i.push(R.i/u|0),wd(s),s=R.next,L=R.next;else if((s=R)===L){S?1===S?Of(s=rw(Yh(s),i,u),i,u,f,m,w,2):2===S&&t0(s,i,u,f,m,w):Of(Yh(s),i,u,f,m,w,1);break}}}function tw(s){var i=s.prev,u=s,f=s.next;if(ps(i,u,f)>=0)return!1;for(var m=i.x,w=u.x,S=f.x,M=i.y,R=u.y,L=f.y,z=m<w?m<S?m:S:w<S?w:S,V=M<R?M<L?M:L:R<L?R:L,G=m>w?m>S?m:S:w>S?w:S,X=M>R?M>L?M:L:R>L?R:L,K=f.next;K!==i;){if(K.x>=z&&K.x<=G&&K.y>=V&&K.y<=X&&Kh(m,M,w,R,S,L,K.x,K.y)&&ps(K.prev,K,K.next)>=0)return!1;K=K.next}return!0}function nw(s,i,u,f){var m=s.prev,w=s,S=s.next;if(ps(m,w,S)>=0)return!1;for(var M=m.x,R=w.x,L=S.x,z=m.y,V=w.y,G=S.y,X=M<R?M<L?M:L:R<L?R:L,K=z<V?z<G?z:G:V<G?V:G,ue=M>R?M>L?M:L:R>L?R:L,Ce=z>V?z>G?z:G:V>G?V:G,Ge=dp(X,K,i,u,f),nt=dp(ue,Ce,i,u,f),$e=s.prevZ,et=s.nextZ;$e&&$e.z>=Ge&&et&&et.z<=nt;){if($e.x>=X&&$e.x<=ue&&$e.y>=K&&$e.y<=Ce&&$e!==m&&$e!==S&&Kh(M,z,R,V,L,G,$e.x,$e.y)&&ps($e.prev,$e,$e.next)>=0||($e=$e.prevZ,et.x>=X&&et.x<=ue&&et.y>=K&&et.y<=Ce&&et!==m&&et!==S&&Kh(M,z,R,V,L,G,et.x,et.y)&&ps(et.prev,et,et.next)>=0))return!1;et=et.nextZ}for(;$e&&$e.z>=Ge;){if($e.x>=X&&$e.x<=ue&&$e.y>=K&&$e.y<=Ce&&$e!==m&&$e!==S&&Kh(M,z,R,V,L,G,$e.x,$e.y)&&ps($e.prev,$e,$e.next)>=0)return!1;$e=$e.prevZ}for(;et&&et.z<=nt;){if(et.x>=X&&et.x<=ue&&et.y>=K&&et.y<=Ce&&et!==m&&et!==S&&Kh(M,z,R,V,L,G,et.x,et.y)&&ps(et.prev,et,et.next)>=0)return!1;et=et.nextZ}return!0}function rw(s,i,u){var f=s;do{var m=f.prev,w=f.next.next;!pp(m,w)&&by(m,f,f.next,w)&&mp(m,w)&&mp(w,m)&&(i.push(m.i/u|0),i.push(f.i/u|0),i.push(w.i/u|0),wd(f),wd(f.next),f=s=w),f=f.next}while(f!==s);return Yh(f)}function t0(s,i,u,f,m,w){var S=s;do{for(var M=S.next.next;M!==S.prev;){if(S.i!==M.i&&zu(S,M)){var R=Ey(S,M);return S=Yh(S,S.next),R=Yh(R,R.next),Of(S,i,u,f,m,w,0),void Of(R,i,u,f,m,w,0)}M=M.next}S=S.next}while(S!==s)}function iw(s,i){return s.x-i.x}function ow(s,i){var u=function(m,w){var S,M=w,R=m.x,L=m.y,z=-1/0;do{if(L<=M.y&&L>=M.next.y&&M.next.y!==M.y){var V=M.x+(L-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(V<=R&&V>z&&(z=V,S=M.x<M.next.x?M:M.next,V===R))return S}M=M.next}while(M!==w);if(!S)return null;var G,X=S,K=S.x,ue=S.y,Ce=1/0;M=S;do{R>=M.x&&M.x>=K&&R!==M.x&&Kh(L<ue?R:z,L,K,ue,L<ue?z:R,L,M.x,M.y)&&(G=Math.abs(L-M.y)/(R-M.x),mp(M,m)&&(G<Ce||G===Ce&&(M.x>S.x||M.x===S.x&&gl(S,M)))&&(S=M,Ce=G)),M=M.next}while(M!==X);return S}(s,i);if(!u)return i;var f=Ey(u,s);return Yh(f,f.next),Yh(u,u.next)}function gl(s,i){return ps(s.prev,s,i.prev)<0&&ps(i.next,s,s.next)<0}function dp(s,i,u,f,m){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-u)*m|0)|s<<8))|s<<4))|s<<2))|s<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-f)*m|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function n0(s){var i=s,u=s;do{(i.x<u.x||i.x===u.x&&i.y<u.y)&&(u=i),i=i.next}while(i!==s);return u}function Kh(s,i,u,f,m,w,S,M){return(m-S)*(i-M)>=(s-S)*(w-M)&&(s-S)*(f-M)>=(u-S)*(i-M)&&(u-S)*(w-M)>=(m-S)*(f-M)}function zu(s,i){return s.next.i!==i.i&&s.prev.i!==i.i&&!function(u,f){var m=u;do{if(m.i!==u.i&&m.next.i!==u.i&&m.i!==f.i&&m.next.i!==f.i&&by(m,m.next,u,f))return!0;m=m.next}while(m!==u);return!1}(s,i)&&(mp(s,i)&&mp(i,s)&&function(u,f){var m=u,w=!1,S=(u.x+f.x)/2,M=(u.y+f.y)/2;do{m.y>M!=m.next.y>M&&m.next.y!==m.y&&S<(m.next.x-m.x)*(M-m.y)/(m.next.y-m.y)+m.x&&(w=!w),m=m.next}while(m!==u);return w}(s,i)&&(ps(s.prev,s,i.prev)||ps(s,i.prev,i))||pp(s,i)&&ps(s.prev,s,s.next)>0&&ps(i.prev,i,i.next)>0)}function ps(s,i,u){return(i.y-s.y)*(u.x-i.x)-(i.x-s.x)*(u.y-i.y)}function pp(s,i){return s.x===i.x&&s.y===i.y}function by(s,i,u,f){var m=gp(ps(s,i,u)),w=gp(ps(s,i,f)),S=gp(ps(u,f,s)),M=gp(ps(u,f,i));return m!==w&&S!==M||!(0!==m||!Eg(s,u,i))||!(0!==w||!Eg(s,f,i))||!(0!==S||!Eg(u,s,f))||!(0!==M||!Eg(u,i,f))}function Eg(s,i,u){return i.x<=Math.max(s.x,u.x)&&i.x>=Math.min(s.x,u.x)&&i.y<=Math.max(s.y,u.y)&&i.y>=Math.min(s.y,u.y)}function gp(s){return s>0?1:s<0?-1:0}function mp(s,i){return ps(s.prev,s,s.next)<0?ps(s,i,s.next)>=0&&ps(s,s.prev,i)>=0:ps(s,i,s.prev)<0||ps(s,s.next,i)<0}function Ey(s,i){var u=new Cy(s.i,s.x,s.y),f=new Cy(i.i,i.x,i.y),m=s.next,w=i.prev;return s.next=i,i.prev=s,u.next=m,m.prev=u,f.next=u,u.prev=f,w.next=f,f.prev=w,f}function r0(s,i,u,f){var m=new Cy(s,i,u);return f?(m.next=f.next,m.prev=f,f.next.prev=m,f.next=m):(m.prev=m,m.next=m),m}function wd(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Cy(s,i,u){this.i=s,this.x=i,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Sy(s,i,u,f){for(var m=0,w=i,S=u-f;w<u;w+=f)m+=(s[S]-s[w])*(s[w+1]+s[S+1]),S=w;return m}wy.exports=bg,wy.exports.default=bg,bg.deviation=function(s,i,u,f){var m=i&&i.length,w=Math.abs(Sy(s,0,m?i[0]*u:s.length,u));if(m)for(var S=0,M=i.length;S<M;S++)w-=Math.abs(Sy(s,i[S]*u,S<M-1?i[S+1]*u:s.length,u));var R=0;for(S=0;S<f.length;S+=3){var L=f[S]*u,z=f[S+1]*u,V=f[S+2]*u;R+=Math.abs((s[L]-s[V])*(s[z+1]-s[L+1])-(s[L]-s[z])*(s[V+1]-s[L+1]))}return 0===w&&0===R?0:Math.abs((R-w)/w)},bg.flatten=function(s){for(var i=s[0][0].length,u={vertices:[],holes:[],dimensions:i},f=0,m=0;m<s.length;m++){for(var w=0;w<s[m].length;w++)for(var S=0;S<i;S++)u.vertices.push(s[m][w][S]);m>0&&u.holes.push(f+=s[m-1].length)}return u};var yp=W(wy.exports);function Iy(s,i,u,f,m){o0(s,i,u||0,f||s.length-1,m||sw)}function o0(s,i,u,f,m){for(;f>u;){if(f-u>600){var w=f-u+1,S=i-u+1,M=Math.log(w),R=.5*Math.exp(2*M/3),L=.5*Math.sqrt(M*R*(w-R)/w)*(S-w/2<0?-1:1);o0(s,i,Math.max(u,Math.floor(i-S*R/w+L)),Math.min(f,Math.floor(i+(w-S)*R/w+L)),m)}var z=s[i],V=u,G=f;for(ph(s,u,i),m(s[f],z)>0&&ph(s,u,f);V<G;){for(ph(s,V,G),V++,G--;m(s[V],z)<0;)V++;for(;m(s[G],z)>0;)G--}0===m(s[u],z)?ph(s,u,G):ph(s,++G,f),G<=i&&(u=G+1),i<=G&&(f=G-1)}}function ph(s,i,u){var f=s[i];s[i]=s[u],s[u]=f}function sw(s,i){return s<i?-1:s>i?1:0}function Ty(s,i){const u=s.length;if(u<=1)return[s];const f=[];let m,w;for(let S=0;S<u;S++){const M=tr(s[S]);0!==M&&(s[S].area=Math.abs(M),void 0===w&&(w=M<0),w===M<0?(m&&f.push(m),m=[s[S]]):m.push(s[S]))}if(m&&f.push(m),i>1)for(let S=0;S<f.length;S++)f[S].length<=i||(Iy(f[S],i,1,f[S].length-1,My),f[S]=f[S].slice(0,i));return f}function My(s,i){return i.area-s.area}function _p(s,i,u){const f=u.patternDependencies;let m=!1;for(const w of i){const S=w.paint.get(`${s}-pattern`);S.isConstant()||(m=!0);const M=S.constantOr(null);M&&(m=!0,f[M]=!0)}return m}function Cg(s,i,u,f,m){const w=m.patternDependencies;for(const S of i){const M=S.paint.get(`${s}-pattern`).value;if("constant"!==M.kind){let R=M.evaluate({zoom:f},u,{},m.availableImages);R=R&&R.name?R.name:R,w[R]=!0,u.patterns[S.id]=R}}return u}class gh{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new mn,this.indexArray=new Jn,this.indexArray2=new Na,this.programConfigurations=new ba(i.layers,i.zoom),this.segments=new Zo,this.segments2=new Zo,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.projection=i.projection}populate(i,u,f,m){this.hasPattern=_p("fill",this.layers,u);const w=this.layers[0].layout.get("fill-sort-key"),S=[];for(const{feature:M,id:R,index:L,sourceLayerIndex:z}of i){const V=this.layers[0]._featureFilter.needGeometry,G=_c(M,V);if(!this.layers[0]._featureFilter.filter(new U(this.zoom),G,f))continue;const X=w?w.evaluate(G,{},f,u.availableImages):void 0,K={id:R,properties:M.properties,type:M.type,sourceLayerIndex:z,index:L,geometry:V?G.geometry:dl(M,f,m),patterns:{},sortKey:X};S.push(K)}w&&S.sort((M,R)=>M.sortKey-R.sortKey);for(const M of S){const{geometry:R,index:L,sourceLayerIndex:z}=M;if(this.hasPattern){const V=Cg("fill",this.layers,M,this.zoom,u);this.patternFeatures.push(V)}else this.addFeature(M,R,L,f,{},u.availableImages);u.featureIndex.insert(i[L].feature,R,L,z,this.index)}}update(i,u,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,f,m)}addFeatures(i,u,f,m,w){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,u,f,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,pl),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,u,f,m,w,S=[]){for(const M of Ty(u,500)){let R=0;for(const K of M)R+=K.length;const L=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray),z=L.vertexLength,V=[],G=[];for(const K of M){if(0===K.length)continue;K!==M[0]&&G.push(V.length/2);const ue=this.segments2.prepareSegment(K.length,this.layoutVertexArray,this.indexArray2),Ce=ue.vertexLength;this.layoutVertexArray.emplaceBack(K[0].x,K[0].y),this.indexArray2.emplaceBack(Ce+K.length-1,Ce),V.push(K[0].x),V.push(K[0].y);for(let Ge=1;Ge<K.length;Ge++)this.layoutVertexArray.emplaceBack(K[Ge].x,K[Ge].y),this.indexArray2.emplaceBack(Ce+Ge-1,Ce+Ge),V.push(K[Ge].x),V.push(K[Ge].y);ue.vertexLength+=K.length,ue.primitiveLength+=K.length}const X=yp(V,G);for(let K=0;K<X.length;K+=3)this.indexArray.emplaceBack(z+X[K],z+X[K+1],z+X[K+2]);L.vertexLength+=R,L.primitiveLength+=X.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,w,S,m)}}Sn(gh,"FillBucket",{omit:["layers","patternFeatures"]});const Sg=new He({"fill-sort-key":new Pe(Ht.layout_fill["fill-sort-key"])});var s0={paint:new He({"fill-antialias":new oe(Ht.paint_fill["fill-antialias"]),"fill-opacity":new Pe(Ht.paint_fill["fill-opacity"]),"fill-color":new Pe(Ht.paint_fill["fill-color"]),"fill-outline-color":new Pe(Ht.paint_fill["fill-outline-color"]),"fill-translate":new oe(Ht.paint_fill["fill-translate"]),"fill-translate-anchor":new oe(Ht.paint_fill["fill-translate-anchor"]),"fill-pattern":new Pe(Ht.paint_fill["fill-pattern"])}),layout:Sg};const Dy=Et([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ig=Et([{name:"a_centroid_pos",components:2,type:"Uint16"}]),aw=Et([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:uw}=Dy;var Tg={},lw=ne,a0=bd;function bd(s,i,u,f,m){this.properties={},this.extent=u,this.type=0,this._pbf=s,this._geometry=-1,this._keys=f,this._values=m,s.readFields(u0,this,i)}function u0(s,i,u){1==s?i.id=u.readVarint():2==s?function(f,m){for(var w=f.readVarint()+f.pos;f.pos<w;){var S=m._keys[f.readVarint()],M=m._values[f.readVarint()];m.properties[S]=M}}(u,i):3==s?i.type=u.readVarint():4==s&&(i._geometry=u.pos)}function Ay(s){for(var i,u,f=0,m=0,w=s.length,S=w-1;m<w;S=m++)f+=((u=s[S]).x-(i=s[m]).x)*(i.y+u.y);return f}bd.types=["Unknown","Point","LineString","Polygon"],bd.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var i,u=s.readVarint()+s.pos,f=1,m=0,w=0,S=0,M=[];s.pos<u;){if(m<=0){var R=s.readVarint();f=7&R,m=R>>3}if(m--,1===f||2===f)w+=s.readSVarint(),S+=s.readSVarint(),1===f&&(i&&M.push(i),i=[]),i.push(new lw(w,S));else{if(7!==f)throw new Error("unknown command "+f);i&&i.push(i[0].clone())}}return i&&M.push(i),M},bd.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var i=s.readVarint()+s.pos,u=1,f=0,m=0,w=0,S=1/0,M=-1/0,R=1/0,L=-1/0;s.pos<i;){if(f<=0){var z=s.readVarint();u=7&z,f=z>>3}if(f--,1===u||2===u)(m+=s.readSVarint())<S&&(S=m),m>M&&(M=m),(w+=s.readSVarint())<R&&(R=w),w>L&&(L=w);else if(7!==u)throw new Error("unknown command "+u)}return[S,R,M,L]},bd.prototype.toGeoJSON=function(s,i,u){var f,m,w=this.extent*Math.pow(2,u),S=this.extent*s,M=this.extent*i,R=this.loadGeometry(),L=bd.types[this.type];function z(X){for(var K=0;K<X.length;K++){var ue=X[K];X[K]=[360*(ue.x+S)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(ue.y+M)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var V=[];for(f=0;f<R.length;f++)V[f]=R[f][0];z(R=V);break;case 2:for(f=0;f<R.length;f++)z(R[f]);break;case 3:for(R=function(X){var K=X.length;if(K<=1)return[X];for(var ue,Ce,Ge=[],nt=0;nt<K;nt++){var $e=Ay(X[nt]);0!==$e&&(void 0===Ce&&(Ce=$e<0),Ce===$e<0?(ue&&Ge.push(ue),ue=[X[nt]]):ue.push(X[nt]))}return ue&&Ge.push(ue),Ge}(R),f=0;f<R.length;f++)for(m=0;m<R[f].length;m++)z(R[f][m])}1===R.length?R=R[0]:L="Multi"+L;var G={type:"Feature",geometry:{type:L,coordinates:R},properties:this.properties};return"id"in this&&(G.id=this.id),G};var l0=a0,Mg=c0;function c0(s,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(cw,this,i),this.length=this._features.length}function cw(s,i,u){15===s?i.version=u.readVarint():1===s?i.name=u.readString():5===s?i.extent=u.readVarint():2===s?i._features.push(u.pos):3===s?i._keys.push(u.readString()):4===s&&i._values.push(function(f){for(var m=null,w=f.readVarint()+f.pos;f.pos<w;){var S=f.readVarint()>>3;m=1===S?f.readString():2===S?f.readFloat():3===S?f.readDouble():4===S?f.readVarint64():5===S?f.readVarint():6===S?f.readSVarint():7===S?f.readBoolean():null}return m}(u))}c0.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var i=this._pbf.readVarint()+this._pbf.pos;return new l0(this._pbf,i,this.extent,this._keys,this._values)};var Py=Mg;function h0(s,i,u){if(3===s){var f=new Py(u,u.readVarint()+u.pos);f.length&&(i[f.name]=f)}}var mh=Tg.VectorTile=function(s,i){this.layers=s.readFields(h0,{},i)},vp=Tg.VectorTileFeature=a0;function xp(s,i,u,f){const m=[],w=0===f?(S,M,R,L,z,V)=>{S.push(new Z(V,R+(V-M)/(L-M)*(z-R)))}:(S,M,R,L,z,V)=>{S.push(new Z(M+(V-R)/(z-R)*(L-M),V))};for(const S of s){const M=[];for(const R of S){if(R.length<=2)continue;const L=[];for(let G=0;G<R.length-1;G++){const X=R[G].x,K=R[G].y,ue=R[G+1].x,Ce=R[G+1].y,Ge=0===f?X:K,nt=0===f?ue:Ce;Ge<i?nt>i&&w(L,X,K,ue,Ce,i):Ge>u?nt<u&&w(L,X,K,ue,Ce,u):L.push(R[G]),nt<i&&Ge>=i&&w(L,X,K,ue,Ce,i),nt>u&&Ge<=u&&w(L,X,K,ue,Ce,u)}let z=R[R.length-1];const V=0===f?z.x:z.y;V>=i&&V<=u&&L.push(z),L.length&&(z=L[L.length-1],L[0].x===z.x&&L[0].y===z.y||L.push(L[0]),M.push(L))}M.length&&m.push(M)}return m}Tg.VectorTileLayer=Mg;const hw=vp.types,pS=Math.pow(2,13);function Jh(s,i,u,f,m,w,S,M){s.emplaceBack((i<<1)+S,(u<<1)+w,(Math.floor(f*pS)<<1)+m,Math.round(M))}function wp(s,i,u){s.emplaceBack(i.x,i.y,i.z,16384*u[0],16384*u[1],16384*u[2])}class Ry{constructor(){this.acc=new Z(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Z(i.x,i.y),this.max=new Z(i.x,i.y))}append(i,u){this.currentPolyCount.edges++,this.acc._add(i);const f=this.min,m=this.max;i.x<f.x?f.x=i.x:i.x>m.x&&(m.x=i.x),i.y<f.y?f.y=i.y:i.y>m.y&&(m.y=i.y),((0===i.x||i.x===ar)&&i.x===u.x)!=((0===i.y||i.y===ar)&&i.y===u.y)&&this.processBorderOverlap(i,u),u.x<0!=i.x<0&&this.addBorderIntersection(0,In(u.y,i.y,(0-u.x)/(i.x-u.x))),u.x>ar!=i.x>ar&&this.addBorderIntersection(1,In(u.y,i.y,(ar-u.x)/(i.x-u.x))),u.y<0!=i.y<0&&this.addBorderIntersection(2,In(u.x,i.x,(0-u.y)/(i.y-u.y))),u.y>ar!=i.y>ar&&this.addBorderIntersection(3,In(u.x,i.x,(ar-u.y)/(i.y-u.y)))}addBorderIntersection(i,u){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const f=this.borders[i];u<f[0]&&(f[0]=u),u>f[1]&&(f[1]=u)}processBorderOverlap(i,u){if(i.x===u.x){if(i.y===u.y)return;const f=0===i.x?0:1;this.addBorderIntersection(f,u.y),this.addBorderIntersection(f,i.y)}else{const f=0===i.y?2:3;this.addBorderIntersection(f,u.x),this.addBorderIntersection(f,i.x)}}centroid(){const i=this.polyCount.reduce((u,f)=>u+f.edges,0);return 0!==i?this.acc.div(i)._round():new Z(0,0)}span(){return new Z(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,u)=>i+ +(u[0]!==Number.MAX_VALUE),0)}}class Ed{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.layoutVertexArray=new Kt,this.centroidVertexArray=new Nl,this.indexArray=new Jn,this.programConfigurations=new ba(i.layers,i.zoom),this.segments=new Zo,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.enableTerrain=i.enableTerrain}populate(i,u,f,m){this.features=[],this.hasPattern=_p("fill-extrusion",this.layers,u),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(w){const S=Math.exp(Math.PI*(1-w.y/(1<<w.z)*2));return 80150034*S/(S*S+1)/ar/(1<<w.z)}(f),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:w,id:S,index:M,sourceLayerIndex:R}of i){const L=this.layers[0]._featureFilter.needGeometry,z=_c(w,L);if(!this.layers[0]._featureFilter.filter(new U(this.zoom),z,f))continue;const V={id:S,sourceLayerIndex:R,index:M,geometry:L?z.geometry:dl(w,f,m),properties:w.properties,type:w.type,patterns:{}},G=this.layoutVertexArray.length;this.hasPattern?this.features.push(Cg("fill-extrusion",this.layers,V,this.zoom,u)):this.addFeature(V,V.geometry,M,f,{},u.availableImages,m),u.featureIndex.insert(w,V.geometry,M,R,this.index,G)}this.sortBorders()}addFeatures(i,u,f,m,w){for(const S of this.features){const{geometry:M}=S;this.addFeature(S,M,S.index,u,f,m,w)}this.sortBorders()}update(i,u,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,f,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,uw),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,aw.members,!0))),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,Ig.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,u,f,m,w,S,M){const R=[new Z(0,0),new Z(ar,ar)],L=M.projection,z="globe"===L.name,V=this.enableTerrain&&!z?new Ry:null,G="Polygon"===hw[i.type];z&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new un);const X=Ty(u,500);for(let Ge=X.length-1;Ge>=0;Ge--){const nt=X[Ge];(0===nt.length||(K=nt[0]).every($e=>$e.x<=0)||K.every($e=>$e.x>=ar)||K.every($e=>$e.y<=0)||K.every($e=>$e.y>=ar))&&X.splice(Ge,1)}var K;let ue;if(z)ue=Ep(X,R,m);else{ue=[];for(const Ge of X)ue.push({polygon:Ge,bounds:R})}const Ce=G?this.edgeRadius:0;for(const{polygon:Ge,bounds:nt}of ue){let $e=0,et=0;for(const ut of Ge)G&&!ut[0].equals(ut[ut.length-1])&&ut.push(ut[0]),et+=G?ut.length-1:ut.length;const ct=this.segments.prepareSegment((G?5:4)*et,this.layoutVertexArray,this.indexArray);if(G){const ut=[],Bt=[];$e=ct.vertexLength;for(const Yt of Ge){let yn,jt;Yt.length&&Yt!==Ge[0]&&Bt.push(ut.length/2),yn=Yt[1].sub(Yt[0])._perp()._unit();for(let Qt=1;Qt<Yt.length;Qt++){const en=Yt[Qt],ln=Yt[Qt===Yt.length-1?1:Qt+1];let{x:xn,y:Xt}=en;if(Ce){jt=ln.sub(en)._perp()._unit();const Ln=yn.add(jt)._unit(),Fn=Ce*Math.min(4,1/(yn.x*Ln.x+yn.y*Ln.y));xn+=Fn*Ln.x,Xt+=Fn*Ln.y,yn=jt}Jh(this.layoutVertexArray,xn,Xt,0,0,1,1,0),ct.vertexLength++,ut.push(en.x,en.y),z&&wp(this.layoutVertexExtArray,L.projectTilePoint(xn,Xt,m),L.upVector(m,xn,Xt))}}const Ot=yp(ut,Bt);for(let Yt=0;Yt<Ot.length;Yt+=3)this.indexArray.emplaceBack($e+Ot[Yt],$e+Ot[Yt+2],$e+Ot[Yt+1]),ct.primitiveLength++}for(const ut of Ge){V&&ut.length&&V.startRing(ut[0]);let Bt,Ot,Yt,yn=ut.length>4&&Cd(ut[ut.length-2],ut[0],ut[1]),jt=Ce?Oy(ut[ut.length-2],ut[0],ut[1],Ce):0;Ot=ut[1].sub(ut[0])._perp()._unit();let Qt=!0;for(let en=1,ln=0;en<ut.length;en++){let xn=ut[en-1],Xt=ut[en];const Ln=ut[en===ut.length-1?1:en+1];if(V&&G&&V.currentPolyCount.top++,bp(Xt,xn,nt)){Ce&&(Ot=Ln.sub(Xt)._perp()._unit(),Qt=!Qt);continue}V&&V.append(Xt,xn);const Fn=Xt.sub(xn)._perp(),On=Fn.x/(Math.abs(Fn.x)+Math.abs(Fn.y)),jr=Fn.y>0?1:0,wn=xn.dist(Xt);if(ln+wn>32768&&(ln=0),Ce){Yt=Ln.sub(Xt)._perp()._unit();let Pr=Ny(xn,Xt,Ln,Ly(Ot,Yt),Ce);isNaN(Pr)&&(Pr=0);const dr=Xt.sub(xn)._unit();xn=xn.add(dr.mult(jt))._round(),Xt=Xt.add(dr.mult(-Pr))._round(),jt=Pr,Ot=Yt}const or=ct.vertexLength,Fr=ut.length>4&&Cd(xn,Xt,Ln);let wi=ky(ln,yn,Qt);if(Jh(this.layoutVertexArray,xn.x,xn.y,On,jr,0,0,wi),Jh(this.layoutVertexArray,xn.x,xn.y,On,jr,0,1,wi),ln+=wn,wi=ky(ln,Fr,!Qt),yn=Fr,Jh(this.layoutVertexArray,Xt.x,Xt.y,On,jr,0,0,wi),Jh(this.layoutVertexArray,Xt.x,Xt.y,On,jr,0,1,wi),ct.vertexLength+=4,this.indexArray.emplaceBack(or+0,or+1,or+2),this.indexArray.emplaceBack(or+1,or+3,or+2),ct.primitiveLength+=2,Ce){const Pr=$e+(1===en?ut.length-2:en-2),dr=1===en?$e:Pr+1;if(this.indexArray.emplaceBack(or+1,Pr,or+3),this.indexArray.emplaceBack(Pr,dr,or+3),ct.primitiveLength+=2,void 0===Bt&&(Bt=or),!bp(Ln,ut[en],nt)){const is=en===ut.length-1?Bt:ct.vertexLength;this.indexArray.emplaceBack(or+2,or+3,is),this.indexArray.emplaceBack(or+3,is+1,is),this.indexArray.emplaceBack(or+3,dr,is+1),ct.primitiveLength+=3}Qt=!Qt}if(z){const Pr=this.layoutVertexExtArray,dr=L.projectTilePoint(xn.x,xn.y,m),is=L.projectTilePoint(Xt.x,Xt.y,m),Gr=L.upVector(m,xn.x,xn.y),$r=L.upVector(m,Xt.x,Xt.y);wp(Pr,dr,Gr),wp(Pr,dr,Gr),wp(Pr,is,$r),wp(Pr,is,$r)}}G&&($e+=ut.length-1)}}if(V&&V.polyCount.length>0){if(V.borders){V.vertexArrayOffset=this.centroidVertexArray.length;const Ge=V.borders,nt=this.featuresOnBorder.push(V)-1;for(let $e=0;$e<4;$e++)Ge[$e][0]!==Number.MAX_VALUE&&this.borders[$e].push(nt)}this.encodeCentroid(V.borders?void 0:V.centroid(),V)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,w,S,m)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((u,f)=>this.featuresOnBorder[u].borders[i][0]-this.featuresOnBorder[f].borders[i][0])}encodeCentroid(i,u,f=!0){let m,w;if(i)if(0!==i.y){const M=u.span()._mult(this.tileToMeter);m=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(M.x/10)),w=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(M.y/10))}else m=Math.ceil(7*(i.x+450)),w=0;else m=0,w=+f;let S=f?this.centroidVertexArray.length:u.vertexArrayOffset;for(const M of u.polyCount){f&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*M.edges+M.top);for(let R=0;R<M.top;R++)this.centroidVertexArray.emplace(S++,m,w);for(let R=0;R<2*M.edges;R++)this.centroidVertexArray.emplace(S++,0,w),this.centroidVertexArray.emplace(S++,m,w)}}}function Ly(s,i){const u=s.add(i)._unit();return s.x*u.x+s.y*u.y}function Oy(s,i,u,f){const m=i.sub(s)._perp()._unit(),w=u.sub(i)._perp()._unit();return Ny(s,i,u,Ly(m,w),f)}function Ny(s,i,u,f,m){const w=Math.sqrt(1-f*f);return Math.min(s.dist(i)/3,i.dist(u)/3,m*w/f)}function bp(s,i,u){return s.x<u[0].x&&i.x<u[0].x||s.x>u[1].x&&i.x>u[1].x||s.y<u[0].y&&i.y<u[0].y||s.y>u[1].y&&i.y>u[1].y}function Cd(s,i,u){if(s.x<0||s.x>=ar||i.x<0||i.x>=ar||u.x<0||u.x>=ar)return!1;const f=u.sub(i),m=f.perp(),w=s.sub(i);return(f.x*w.x+f.y*w.y)/Math.sqrt((f.x*f.x+f.y*f.y)*(w.x*w.x+w.y*w.y))>-.866&&m.x*w.x+m.y*w.y<0}function ky(s,i,u){const f=i?2|s:-3&s;return u?1|f:-2&f}function Dg(){const s=Math.PI/32,i=Math.tan(s),u=ug;return u*Math.sqrt(1+2*i*i)-u}function Ep(s,i,u){const f=1<<u.z,m=Yu(u.x/f),w=Yu((u.x+1)/f),S=Ca(u.y/f),M=Ca((u.y+1)/f);return function(R,L,z,V,G=0,X){const K=[];if(!R.length||!z||!V)return K;const ue=(ut,Bt)=>{for(const Ot of ut)K.push({polygon:Ot,bounds:Bt})},Ce=Math.ceil(Math.log2(z)),Ge=Math.ceil(Math.log2(V)),nt=Ce-Ge,$e=[];for(let ut=0;ut<Math.abs(nt);ut++)$e.push(nt>0?0:1);for(let ut=0;ut<Math.min(Ce,Ge);ut++)$e.push(0),$e.push(1);let et=R;if(et=xp(et,L[0].y-G,L[1].y+G,1),et=xp(et,L[0].x-G,L[1].x+G,0),!et.length)return K;const ct=[];for($e.length?ct.push({polygons:et,bounds:L,depth:0}):ue(et,L);ct.length;){const ut=ct.pop(),Bt=ut.depth,Ot=$e[Bt],Yt=ut.bounds[0],yn=ut.bounds[1],jt=0===Ot?Yt.x:Yt.y,Qt=0===Ot?yn.x:yn.y,en=X?X(Ot,jt,Qt):.5*(jt+Qt),ln=xp(ut.polygons,jt-G,en+G,Ot),xn=xp(ut.polygons,en-G,Qt+G,Ot);if(ln.length){const Xt=[Yt,new Z(0===Ot?en:yn.x,1===Ot?en:yn.y)];$e.length>Bt+1?ct.push({polygons:ln,bounds:Xt,depth:Bt+1}):ue(ln,Xt)}if(xn.length){const Xt=[new Z(0===Ot?en:Yt.x,1===Ot?en:Yt.y),yn];$e.length>Bt+1?ct.push({polygons:xn,bounds:Xt,depth:Bt+1}):ue(xn,Xt)}}return K}(s,i,Math.ceil((w-m)/11.25),Math.ceil((S-M)/11.25),1,(R,L,z)=>{if(0===R)return.5*(L+z);{const V=Ca((u.y+L/ar)/f);return(Uc(.5*(Ca((u.y+z/ar)/f)+V))*f-u.y)*ar}})}Sn(Ed,"FillExtrusionBucket",{omit:["layers","features"]}),Sn(Ry,"PartMetadata");const f0=new He({"fill-extrusion-edge-radius":new oe(Ht["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Fy={paint:new He({"fill-extrusion-opacity":new oe(Ht["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Pe(Ht["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new oe(Ht["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new oe(Ht["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Pe(Ht["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Pe(Ht["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Pe(Ht["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new oe(Ht["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new oe(Ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new oe(Ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new oe(Ht["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:f0};function Sd(s,i,u){var f=2*Math.PI*6378137/256/Math.pow(2,u);return[s*f-2*Math.PI*6378137/2,i*f-2*Math.PI*6378137/2]}class Ag{constructor(i,u,f){this.z=i,this.x=u,this.y=f,this.key=Cp(0,i,i,u,f)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,u){const f=(S=this.y,M=this.z,R=Sd(256*(w=this.x),256*(S=Math.pow(2,M)-S-1),M),L=Sd(256*(w+1),256*(S+1),M),R[0]+","+R[1]+","+L[0]+","+L[1]),m=function(w,S,M){let R,L="";for(let z=w;z>0;z--)R=1<<z-1,L+=(S&R?1:0)+(M&R?2:0);return L}(this.z,this.x,this.y);var w,S,M,R,L;return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===u?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",f)}toString(){return`${this.z}/${this.x}/${this.y}`}}class By{constructor(i,u){this.wrap=i,this.canonical=u,this.key=Cp(i,u.z,u.z,u.x,u.y)}}class Uu{constructor(i,u,f,m,w){this.overscaledZ=i,this.wrap=u,this.canonical=new Ag(f,+m,+w),this.key=0===u&&i===f?this.canonical.key:Cp(u,i,f,m,w)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const u=this.canonical.z-i;return i>this.canonical.z?new Uu(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Uu(i,this.wrap,i,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(i,u=!0){if(this.overscaledZ===i&&u)return this.key;if(i>this.canonical.z)return Cp(this.wrap*+u,i,this.canonical.z,this.canonical.x,this.canonical.y);{const f=this.canonical.z-i;return Cp(this.wrap*+u,i,i,this.canonical.x>>f,this.canonical.y>>f)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const u=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>u&&i.canonical.y===this.canonical.y>>u}children(i){if(this.overscaledZ>=i)return[new Uu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,f=2*this.canonical.x,m=2*this.canonical.y;return[new Uu(u,this.wrap,u,f,m),new Uu(u,this.wrap,u,f+1,m),new Uu(u,this.wrap,u,f,m+1),new Uu(u,this.wrap,u,f+1,m+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Uu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Uu(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new By(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Cp(s,i,u,f,m){const w=1<<Math.min(u,22);let S=w*(m%w)+f%w;return s&&u<22&&(S+=w*w*((s<0?-2*s-1:2*s)%(1<<2*(22-u)))),16*(32*S+u)+(i-u)}Sn(Ag,"CanonicalTileID"),Sn(Uu,"OverscaledTileID",{omit:["projMatrix"]});class Id extends Z{constructor(i,u,f){super(i,u),this.z=f}}function Td(s,i){return s.x*i.x+s.y*i.y}function zy(s,i){if(1===s.length){let u=0;const f=i[u++];let m;for(;!m||f.equals(m);)if(m=i[u++],!m)return 1/0;for(;u<i.length;u++){const w=i[u],S=s[0],M=m.sub(f),R=w.sub(f),L=S.sub(f),z=Td(M,M),V=Td(M,R),G=Td(R,R),X=Td(L,M),K=Td(L,R),ue=z*G-V*V,Ce=(G*X-V*K)/ue,Ge=(z*K-V*X)/ue,nt=f.z*(1-Ce-Ge)+m.z*Ce+w.z*Ge;if(isFinite(nt))return nt}return 1/0}{let u=1/0;for(const f of i)u=Math.min(u,f.z);return u}}function Sp(s,i,u,f,m,w,S,M){const R=S*m.getElevationAt(s,i,!0,!0),L=0!==w[0],z=L?0===w[1]?S*(w[0]/7-450):S*function(V,G,X){const K=Math.floor(G[0]/8),ue=Math.floor(G[1]/8),Ce=10*(G[0]-8*K),Ge=10*(G[1]-8*ue),nt=V.getElevationAt(K,ue,!0,!0),$e=V.getMeterToDEM(X),et=Math.floor(.5*(Ce*$e-1)),ct=Math.floor(.5*(Ge*$e-1)),ut=V.tileCoordToPixel(K,ue),Bt=2*et+1,Ot=2*ct+1,Yt=(Fn=Bt,On=Ot,[(xn=V).getElevationAtPixel(Xt=ut.x-et,Ln=ut.y-ct,!0),xn.getElevationAtPixel(Xt+On,Ln,!0),xn.getElevationAtPixel(Xt,Ln+On,!0),xn.getElevationAtPixel(Xt+Fn,Ln+On,!0)]),yn=Math.abs(Yt[0]-Yt[1]),jt=Math.abs(Yt[2]-Yt[3]),Qt=Math.abs(Yt[0]-Yt[2])+Math.abs(Yt[1]-Yt[3]),en=Math.min(.25,.5*$e*(yn+jt)/Bt),ln=Math.min(.25,.5*$e*Qt/Ot);var xn,Xt,Ln,Fn,On;return nt+Math.max(en*Ce,ln*Ge)}(m,w,M):R;return{base:R+(0===u)?-1:u,top:L?Math.max(z+f,R+u+2):R+f}}const Uy=Et([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Md}=Uy,fw=Et([{name:"a_packed",components:4,type:"Float32"}]),{members:dw}=fw,gS=vp.types,pw=Math.cos(Math.PI/180*37.5);class Dd{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Nt,this.layoutVertexArray2=new dn,this.indexArray=new Jn,this.programConfigurations=new ba(i.layers,i.zoom),this.segments=new Zo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,f,m){this.hasPattern=_p("line",this.layers,u);const w=this.layers[0].layout.get("line-sort-key"),S=[];for(const{feature:z,id:V,index:G,sourceLayerIndex:X}of i){const K=this.layers[0]._featureFilter.needGeometry,ue=_c(z,K);if(!this.layers[0]._featureFilter.filter(new U(this.zoom),ue,f))continue;const Ce=w?w.evaluate(ue,{},f):void 0,Ge={id:V,properties:z.properties,type:z.type,sourceLayerIndex:X,index:G,geometry:K?ue.geometry:dl(z,f,m),patterns:{},sortKey:Ce};S.push(Ge)}w&&S.sort((z,V)=>z.sortKey-V.sortKey);const{lineAtlas:M,featureIndex:R}=u,L=this.addConstantDashes(M);for(const z of S){const{geometry:V,index:G,sourceLayerIndex:X}=z;if(L&&this.addFeatureDashes(z,M),this.hasPattern){const K=Cg("line",this.layers,z,this.zoom,u);this.patternFeatures.push(K)}else this.addFeature(z,V,G,f,M.positions,u.availableImages);R.insert(i[G].feature,V,G,X,this.index)}}addConstantDashes(i){let u=!1;for(const f of this.layers){const m=f.paint.get("line-dasharray").value,w=f.layout.get("line-cap").value;if("constant"!==m.kind||"constant"!==w.kind)u=!0;else{const S=w.value,M=m.value;if(!M)continue;i.addDash(M,S)}}return u}addFeatureDashes(i,u){const f=this.zoom;for(const m of this.layers){const w=m.paint.get("line-dasharray").value,S=m.layout.get("line-cap").value;if("constant"===w.kind&&"constant"===S.kind)continue;let M,R;if("constant"===w.kind){if(M=w.value,!M)continue}else M=w.evaluate({zoom:f},i);R="constant"===S.kind?S.value:S.evaluate({zoom:f},i),u.addDash(M,R),i.patterns[m.id]=u.getKey(M,R)}}update(i,u,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,f,m)}addFeatures(i,u,f,m,w){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,u,f,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,dw)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Md),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,u,f,m,w,S){const M=this.layers[0].layout,R=M.get("line-join").evaluate(i,{}),L=M.get("line-cap").evaluate(i,{}),z=M.get("line-miter-limit"),V=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const G of u)this.addLine(G,i,R,L,z,V);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,w,S,m)}addLine(i,u,f,m,w,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ge=0;Ge<i.length-1;Ge++)this.totalDistance+=i[Ge].dist(i[Ge+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M="Polygon"===gS[u.type];let R=i.length;for(;R>=2&&i[R-1].equals(i[R-2]);)R--;let L=0;for(;L<R-1&&i[L].equals(i[L+1]);)L++;if(R<(M?3:2))return;"bevel"===f&&(w=1.05);const z=this.overscaling<=16?15*ar/(512*this.overscaling):0,V=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let G,X,K,ue,Ce;this.e1=this.e2=-1,M&&(G=i[R-2],Ce=i[L].sub(G)._unit()._perp());for(let Ge=L;Ge<R;Ge++){if(K=Ge===R-1?M?i[L+1]:void 0:i[Ge+1],K&&i[Ge].equals(K))continue;Ce&&(ue=Ce),G&&(X=G),G=i[Ge],Ce=K?K.sub(G)._unit()._perp():ue,ue=ue||Ce;let nt=ue.add(Ce);0===nt.x&&0===nt.y||nt._unit();const $e=ue.x*Ce.x+ue.y*Ce.y,et=nt.x*Ce.x+nt.y*Ce.y,ct=0!==et?1/et:1/0,ut=2*Math.sqrt(2-2*et),Bt=et<pw&&X&&K,Ot=ue.x*Ce.y-ue.y*Ce.x>0;if(Bt&&Ge>L){const jt=G.dist(X);if(jt>2*z){const Qt=G.sub(G.sub(X)._mult(z/jt)._round());this.updateDistance(X,Qt),this.addCurrentVertex(Qt,ue,0,0,V),X=Qt}}const Yt=X&&K;let yn=Yt?f:M?"butt":m;if(Yt&&"round"===yn&&(ct<S?yn="miter":ct<=2&&(yn="fakeround")),"miter"===yn&&ct>w&&(yn="bevel"),"bevel"===yn&&(ct>2&&(yn="flipbevel"),ct<w&&(yn="miter")),X&&this.updateDistance(X,G),"miter"===yn)nt._mult(ct),this.addCurrentVertex(G,nt,0,0,V);else if("flipbevel"===yn){if(ct>100)nt=Ce.mult(-1);else{const jt=ct*ue.add(Ce).mag()/ue.sub(Ce).mag();nt._perp()._mult(jt*(Ot?-1:1))}this.addCurrentVertex(G,nt,0,0,V),this.addCurrentVertex(G,nt.mult(-1),0,0,V)}else if("bevel"===yn||"fakeround"===yn){const jt=-Math.sqrt(ct*ct-1),Qt=Ot?jt:0,en=Ot?0:jt;if(X&&this.addCurrentVertex(G,ue,Qt,en,V),"fakeround"===yn){const ln=Math.round(180*ut/Math.PI/20);for(let xn=1;xn<ln;xn++){let Xt=xn/ln;if(.5!==Xt){const Fn=Xt-.5;Xt+=Xt*Fn*(Xt-1)*((1.0904+$e*($e*(3.55645-1.43519*$e)-3.2452))*Fn*Fn+(.848013+$e*(.215638*$e-1.06021)))}const Ln=Ce.sub(ue)._mult(Xt)._add(ue)._unit()._mult(Ot?-1:1);this.addHalfVertex(G,Ln.x,Ln.y,!1,Ot,0,V)}}K&&this.addCurrentVertex(G,Ce,-Qt,-en,V)}else if("butt"===yn)this.addCurrentVertex(G,nt,0,0,V);else if("square"===yn){const jt=X?1:-1;X||this.addCurrentVertex(G,nt,jt,jt,V),this.addCurrentVertex(G,nt,0,0,V),X&&this.addCurrentVertex(G,nt,jt,jt,V)}else"round"===yn&&(X&&(this.addCurrentVertex(G,ue,0,0,V),this.addCurrentVertex(G,ue,1,1,V,!0)),K&&(this.addCurrentVertex(G,Ce,-1,-1,V,!0),this.addCurrentVertex(G,Ce,0,0,V)));if(Bt&&Ge<R-1){const jt=G.dist(K);if(jt>2*z){const Qt=G.add(K.sub(G)._mult(z/jt)._round());this.updateDistance(G,Qt),this.addCurrentVertex(Qt,Ce,0,0,V),G=Qt}}}}addCurrentVertex(i,u,f,m,w,S=!1){const M=u.y*m-u.x,R=-u.y-u.x*m;this.addHalfVertex(i,u.x+u.y*f,u.y-u.x*f,S,!1,f,w),this.addHalfVertex(i,M,R,S,!0,-m,w)}addHalfVertex({x:i,y:u},f,m,w,S,M,R){this.layoutVertexArray.emplaceBack((i<<1)+(w?1:0),(u<<1)+(S?1:0),Math.round(63*f)+128,Math.round(63*m)+128,1+(0===M?0:M<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const L=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),R.primitiveLength++),S?this.e2=L:this.e1=L}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,u){this.distance+=i.dist(u),this.updateScaledDistance()}}Sn(Dd,"LineBucket",{omit:["layers","patternFeatures"]});const gw=new He({"line-cap":new Pe(Ht.layout_line["line-cap"]),"line-join":new Pe(Ht.layout_line["line-join"]),"line-miter-limit":new oe(Ht.layout_line["line-miter-limit"]),"line-round-limit":new oe(Ht.layout_line["line-round-limit"]),"line-sort-key":new Pe(Ht.layout_line["line-sort-key"])});var Ad={paint:new He({"line-opacity":new Pe(Ht.paint_line["line-opacity"]),"line-color":new Pe(Ht.paint_line["line-color"]),"line-translate":new oe(Ht.paint_line["line-translate"]),"line-translate-anchor":new oe(Ht.paint_line["line-translate-anchor"]),"line-width":new Pe(Ht.paint_line["line-width"]),"line-gap-width":new Pe(Ht.paint_line["line-gap-width"]),"line-offset":new Pe(Ht.paint_line["line-offset"]),"line-blur":new Pe(Ht.paint_line["line-blur"]),"line-dasharray":new Pe(Ht.paint_line["line-dasharray"]),"line-pattern":new Pe(Ht.paint_line["line-pattern"]),"line-gradient":new Xe(Ht.paint_line["line-gradient"]),"line-trim-offset":new oe(Ht.paint_line["line-trim-offset"])}),layout:gw};const Ip=new class extends Pe{possiblyEvaluate(s,i){return i=new U(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(s,i)}evaluate(s,i,u,f){return i=Le({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(s,i,u,f)}}(Ad.paint.properties["line-width"].specification);function Pg(s,i){return i>0?i+2*s:s}Ip.useIntegerZoom=!0;const d0=Et([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),p0=Et([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),g0=Et([{name:"a_projected_pos",components:4,type:"Float32"}],4);Et([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const m0=Et([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),mw=Et([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Et([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const y0=Et([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),yw=Et([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Et([{name:"triangle",components:3,type:"Uint16"}]),Et([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Et([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Et([{type:"Float32",name:"offsetX"}]),Et([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ya=24;const vc=128;function jc(s,i){const{expression:u}=i;if("constant"===u.kind)return{kind:"constant",layoutSize:u.evaluate(new U(s+1))};if("source"===u.kind)return{kind:"source"};{const{zoomStops:f,interpolationType:m}=u;let w=0;for(;w<f.length&&f[w]<=s;)w++;w=Math.max(0,w-1);let S=w;for(;S<f.length&&f[S]<s+1;)S++;S=Math.min(f.length-1,S);const M=f[w],R=f[S];return"composite"===u.kind?{kind:"composite",minZoom:M,maxZoom:R,interpolationType:m}:{kind:"camera",minZoom:M,maxZoom:R,minSize:u.evaluate(new U(M)),maxSize:u.evaluate(new U(R)),interpolationType:m}}}function Qh(s,{uSize:i,uSizeT:u},{lowerSize:f,upperSize:m}){return"source"===s.kind?f/vc:"composite"===s.kind?In(f/vc,m/vc,u):i}function Pd(s,i){let u=0,f=0;if("constant"===s.kind)f=s.layoutSize;else if("source"!==s.kind){const{interpolationType:m,minZoom:w,maxZoom:S}=s,M=m?De(qs.interpolationFactor(m,i,w,S),0,1):0;"camera"===s.kind?f=In(s.minSize,s.maxSize,M):u=M}return{uSizeT:u,uSize:f}}var mS=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:vc,evaluateSizeForFeature:Qh,evaluateSizeForZoom:Pd,getSizeData:jc});function yS(s,i,u){return s.sections.forEach(f=>{f.text=function(m,w,S){const M=w.layout.get("text-transform").evaluate(S,{});return"uppercase"===M?m=m.toLocaleUpperCase():"lowercase"===M&&(m=m.toLocaleLowerCase()),k.applyArabicShaping&&(m=k.applyArabicShaping(m)),m}(f.text,i,u)}),s}const Rg={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function _S(s){return"\ufe36"===s||"\ufe48"===s||"\ufe38"===s||"\ufe44"===s||"\ufe42"===s||"\ufe3e"===s||"\ufe3c"===s||"\ufe3a"===s||"\ufe18"===s||"\ufe40"===s||"\ufe10"===s||"\ufe13"===s||"\ufe14"===s||"\uff40"===s||"\uffe3"===s||"\ufe11"===s||"\ufe12"===s}function vS(s){return"\ufe35"===s||"\ufe47"===s||"\ufe37"===s||"\ufe43"===s||"\ufe41"===s||"\ufe3d"===s||"\ufe3b"===s||"\ufe39"===s||"\ufe17"===s||"\ufe3f"===s}var Vy=Go,_0=function(s,i,u,f,m){var w,S,M=8*m-f-1,R=(1<<M)-1,L=R>>1,z=-7,V=u?m-1:0,G=u?-1:1,X=s[i+V];for(V+=G,w=X&(1<<-z)-1,X>>=-z,z+=M;z>0;w=256*w+s[i+V],V+=G,z-=8);for(S=w&(1<<-z)-1,w>>=-z,z+=f;z>0;S=256*S+s[i+V],V+=G,z-=8);if(0===w)w=1-L;else{if(w===R)return S?NaN:1/0*(X?-1:1);S+=Math.pow(2,f),w-=L}return(X?-1:1)*S*Math.pow(2,w-f)},v0=function(s,i,u,f,m,w){var S,M,R,L=8*w-m-1,z=(1<<L)-1,V=z>>1,G=23===m?Math.pow(2,-24)-Math.pow(2,-77):0,X=f?0:w-1,K=f?1:-1,ue=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(M=isNaN(i)?1:0,S=z):(S=Math.floor(Math.log(i)/Math.LN2),i*(R=Math.pow(2,-S))<1&&(S--,R*=2),(i+=S+V>=1?G/R:G*Math.pow(2,1-V))*R>=2&&(S++,R/=2),S+V>=z?(M=0,S=z):S+V>=1?(M=(i*R-1)*Math.pow(2,m),S+=V):(M=i*Math.pow(2,V-1)*Math.pow(2,m),S=0));m>=8;s[u+X]=255&M,X+=K,M/=256,m-=8);for(S=S<<m|M,L+=m;L>0;s[u+X]=255&S,X+=K,S/=256,L-=8);s[u+X-K]|=128*ue};function Go(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Go.Varint=0,Go.Fixed64=1,Go.Bytes=2,Go.Fixed32=5;var jy=4294967296,Lg=1/jy,Gc=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Bl(s){return s.type===Go.Bytes?s.readVarint()+s.pos:s.pos+1}function Gy(s,i,u){var f=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));u.realloc(f);for(var m=u.pos-1;m>=s;m--)u.buf[m+f]=u.buf[m]}function x0(s,i){for(var u=0;u<s.length;u++)i.writeVarint(s[u])}function xS(s,i){for(var u=0;u<s.length;u++)i.writeSVarint(s[u])}function wS(s,i){for(var u=0;u<s.length;u++)i.writeFloat(s[u])}function bS(s,i){for(var u=0;u<s.length;u++)i.writeDouble(s[u])}function $y(s,i){for(var u=0;u<s.length;u++)i.writeBoolean(s[u])}function qy(s,i){for(var u=0;u<s.length;u++)i.writeFixed32(s[u])}function ES(s,i){for(var u=0;u<s.length;u++)i.writeSFixed32(s[u])}function CS(s,i){for(var u=0;u<s.length;u++)i.writeFixed64(s[u])}function w0(s,i){for(var u=0;u<s.length;u++)i.writeSFixed64(s[u])}function Og(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+16777216*s[i+3]}function Rd(s,i,u){s[u]=i,s[u+1]=i>>>8,s[u+2]=i>>>16,s[u+3]=i>>>24}function b0(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+(s[i+3]<<24)}Go.prototype={destroy:function(){this.buf=null},readFields:function(s,i,u){for(u=u||this.length;this.pos<u;){var f=this.readVarint(),m=f>>3,w=this.pos;this.type=7&f,s(m,i,this),this.pos===w&&this.skip(f)}return i},readMessage:function(s,i){return this.readFields(s,i,this.readVarint()+this.pos)},readFixed32:function(){var s=Og(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=b0(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Og(this.buf,this.pos)+Og(this.buf,this.pos+4)*jy;return this.pos+=8,s},readSFixed64:function(){var s=Og(this.buf,this.pos)+b0(this.buf,this.pos+4)*jy;return this.pos+=8,s},readFloat:function(){var s=_0(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=_0(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var i,u,f=this.buf;return i=127&(u=f[this.pos++]),u<128?i:(i|=(127&(u=f[this.pos++]))<<7,u<128?i:(i|=(127&(u=f[this.pos++]))<<14,u<128?i:(i|=(127&(u=f[this.pos++]))<<21,u<128?i:function(m,w,S){var M,R,L=S.buf;if(M=(112&(R=L[S.pos++]))>>4,R<128||(M|=(127&(R=L[S.pos++]))<<3,R<128)||(M|=(127&(R=L[S.pos++]))<<10,R<128)||(M|=(127&(R=L[S.pos++]))<<17,R<128)||(M|=(127&(R=L[S.pos++]))<<24,R<128)||(M|=(1&(R=L[S.pos++]))<<31,R<128))return function Nf(s,i,u){return u?4294967296*i+(s>>>0):4294967296*(i>>>0)+(s>>>0)}(m,M,w);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(u=f[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,i=this.pos;return this.pos=s,s-i>=12&&Gc?Gc.decode(this.buf.subarray(i,s)):function(u,f,m){for(var w="",S=f;S<m;){var M,R,L,z=u[S],V=null,G=z>239?4:z>223?3:z>191?2:1;if(S+G>m)break;1===G?z<128&&(V=z):2===G?128==(192&(M=u[S+1]))&&(V=(31&z)<<6|63&M)<=127&&(V=null):3===G?(R=u[S+2],128==(192&(M=u[S+1]))&&128==(192&R)&&((V=(15&z)<<12|(63&M)<<6|63&R)<=2047||V>=55296&&V<=57343)&&(V=null)):4===G&&(R=u[S+2],L=u[S+3],128==(192&(M=u[S+1]))&&128==(192&R)&&128==(192&L)&&((V=(15&z)<<18|(63&M)<<12|(63&R)<<6|63&L)<=65535||V>=1114112)&&(V=null)),null===V?(V=65533,G=1):V>65535&&(V-=65536,w+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),w+=String.fromCharCode(V),S+=G}return w}(this.buf,i,s)},readBytes:function(){var s=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,s);return this.pos=s,i},readPackedVarint:function(s,i){if(this.type!==Go.Bytes)return s.push(this.readVarint(i));var u=Bl(this);for(s=s||[];this.pos<u;)s.push(this.readVarint(i));return s},readPackedSVarint:function(s){if(this.type!==Go.Bytes)return s.push(this.readSVarint());var i=Bl(this);for(s=s||[];this.pos<i;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Go.Bytes)return s.push(this.readBoolean());var i=Bl(this);for(s=s||[];this.pos<i;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Go.Bytes)return s.push(this.readFloat());var i=Bl(this);for(s=s||[];this.pos<i;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Go.Bytes)return s.push(this.readDouble());var i=Bl(this);for(s=s||[];this.pos<i;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Go.Bytes)return s.push(this.readFixed32());var i=Bl(this);for(s=s||[];this.pos<i;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Go.Bytes)return s.push(this.readSFixed32());var i=Bl(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Go.Bytes)return s.push(this.readFixed64());var i=Bl(this);for(s=s||[];this.pos<i;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Go.Bytes)return s.push(this.readSFixed64());var i=Bl(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed64());return s},skip:function(s){var i=7&s;if(i===Go.Varint)for(;this.buf[this.pos++]>127;);else if(i===Go.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Go.Fixed32)this.pos+=4;else{if(i!==Go.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(s,i){this.writeVarint(s<<3|i)},realloc:function(s){for(var i=this.length||16;i<this.pos+s;)i*=2;if(i!==this.length){var u=new Uint8Array(i);u.set(this.buf),this.buf=u,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Rd(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Rd(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Rd(this.buf,-1&s,this.pos),Rd(this.buf,Math.floor(s*Lg),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Rd(this.buf,-1&s,this.pos),Rd(this.buf,Math.floor(s*Lg),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(i,u){var f,m,w,M;if(i>=0?(f=i%4294967296|0,m=i/4294967296|0):(m=~(-i/4294967296),4294967295^(f=~(-i%4294967296))?f=f+1|0:(f=0,m=m+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),w=f,(M=u).buf[M.pos++]=127&w|128,w>>>=7,M.buf[M.pos++]=127&w|128,w>>>=7,M.buf[M.pos++]=127&w|128,w>>>=7,M.buf[M.pos++]=127&w|128,M.buf[M.pos]=127&(w>>>=7),function(w,S){var M=(7&w)<<4;S.buf[S.pos++]|=M|((w>>>=3)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w)))))}(m,u)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var i=this.pos;this.pos=function(f,m,w){for(var S,M,R=0;R<m.length;R++){if((S=m.charCodeAt(R))>55295&&S<57344){if(!M){S>56319||R+1===m.length?(f[w++]=239,f[w++]=191,f[w++]=189):M=S;continue}if(S<56320){f[w++]=239,f[w++]=191,f[w++]=189,M=S;continue}S=M-55296<<10|S-56320|65536,M=null}else M&&(f[w++]=239,f[w++]=191,f[w++]=189,M=null);S<128?f[w++]=S:(S<2048?f[w++]=S>>6|192:(S<65536?f[w++]=S>>12|224:(f[w++]=S>>18|240,f[w++]=S>>12&63|128),f[w++]=S>>6&63|128),f[w++]=63&S|128)}return w}(this.buf,s,this.pos);var u=this.pos-i;u>=128&&Gy(i,u,this),this.pos=i-1,this.writeVarint(u),this.pos+=u},writeFloat:function(s){this.realloc(4),v0(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),v0(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var i=s.length;this.writeVarint(i),this.realloc(i);for(var u=0;u<i;u++)this.buf[this.pos++]=s[u]},writeRawMessage:function(s,i){this.pos++;var u=this.pos;s(i,this);var f=this.pos-u;f>=128&&Gy(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeMessage:function(s,i,u){this.writeTag(s,Go.Bytes),this.writeRawMessage(i,u)},writePackedVarint:function(s,i){i.length&&this.writeMessage(s,x0,i)},writePackedSVarint:function(s,i){i.length&&this.writeMessage(s,xS,i)},writePackedBoolean:function(s,i){i.length&&this.writeMessage(s,$y,i)},writePackedFloat:function(s,i){i.length&&this.writeMessage(s,wS,i)},writePackedDouble:function(s,i){i.length&&this.writeMessage(s,bS,i)},writePackedFixed32:function(s,i){i.length&&this.writeMessage(s,qy,i)},writePackedSFixed32:function(s,i){i.length&&this.writeMessage(s,ES,i)},writePackedFixed64:function(s,i){i.length&&this.writeMessage(s,CS,i)},writePackedSFixed64:function(s,i){i.length&&this.writeMessage(s,w0,i)},writeBytesField:function(s,i){this.writeTag(s,Go.Bytes),this.writeBytes(i)},writeFixed32Field:function(s,i){this.writeTag(s,Go.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(s,i){this.writeTag(s,Go.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(s,i){this.writeTag(s,Go.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(s,i){this.writeTag(s,Go.Fixed64),this.writeSFixed64(i)},writeVarintField:function(s,i){this.writeTag(s,Go.Varint),this.writeVarint(i)},writeSVarintField:function(s,i){this.writeTag(s,Go.Varint),this.writeSVarint(i)},writeStringField:function(s,i){this.writeTag(s,Go.Bytes),this.writeString(i)},writeFloatField:function(s,i){this.writeTag(s,Go.Fixed32),this.writeFloat(i)},writeDoubleField:function(s,i){this.writeTag(s,Go.Fixed64),this.writeDouble(i)},writeBooleanField:function(s,i){this.writeVarintField(s,!!i)}};var Ng=W(Vy);const kg=3;function Fg(s,i,u){i.glyphs=[],1===s&&u.readMessage(_w,i)}function _w(s,i,u){if(3===s){const{id:f,bitmap:m,width:w,height:S,left:M,top:R,advance:L}=u.readMessage(Hy,{});i.glyphs.push({id:f,bitmap:new Vc({width:w+2*kg,height:S+2*kg},m),metrics:{width:w,height:S,left:M,top:R,advance:L}})}else 4===s?i.ascender=u.readSVarint():5===s&&(i.descender=u.readSVarint())}function Hy(s,i,u){1===s?i.id=u.readVarint():2===s?i.bitmap=u.readBytes():3===s?i.width=u.readVarint():4===s?i.height=u.readVarint():5===s?i.left=u.readSVarint():6===s?i.top=u.readSVarint():7===s&&(i.advance=u.readVarint())}const E0=kg;function fa(s){let i=0,u=0;for(const S of s)i+=S.w*S.h,u=Math.max(u,S.w);s.sort((S,M)=>M.h-S.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),u),h:1/0}];let m=0,w=0;for(const S of s)for(let M=f.length-1;M>=0;M--){const R=f[M];if(!(S.w>R.w||S.h>R.h)){if(S.x=R.x,S.y=R.y,w=Math.max(w,S.y+S.h),m=Math.max(m,S.x+S.w),S.w===R.w&&S.h===R.h){const L=f.pop();M<f.length&&(f[M]=L)}else S.h===R.h?(R.x+=S.w,R.w-=S.w):S.w===R.w?(R.y+=S.h,R.h-=S.h):(f.push({x:R.x+S.w,y:R.y,w:R.w-S.w,h:S.h}),R.y+=S.h,R.h-=S.h);break}}return{w:m,h:w,fill:i/(m*w)||0}}const Ju=1;class Wy{constructor(i,{pixelRatio:u,version:f,stretchX:m,stretchY:w,content:S}){this.paddedRect=i,this.pixelRatio=u,this.stretchX=m,this.stretchY=w,this.content=S,this.version=f}get tl(){return[this.paddedRect.x+Ju,this.paddedRect.y+Ju]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ju,this.paddedRect.y+this.paddedRect.h-Ju]}get displaySize(){return[(this.paddedRect.w-2*Ju)/this.pixelRatio,(this.paddedRect.h-2*Ju)/this.pixelRatio]}}class Xy{constructor(i,u){const f={},m={};this.haveRenderCallbacks=[];const w=[];this.addImages(i,f,w),this.addImages(u,m,w);const{w:S,h:M}=fa(w),R=new Ku({width:S||1,height:M||1});for(const L in i){const z=i[L],V=f[L].paddedRect;Ku.copy(z.data,R,{x:0,y:0},{x:V.x+Ju,y:V.y+Ju},z.data)}for(const L in u){const z=u[L],V=m[L].paddedRect,G=V.x+Ju,X=V.y+Ju,K=z.data.width,ue=z.data.height;Ku.copy(z.data,R,{x:0,y:0},{x:G,y:X},z.data),Ku.copy(z.data,R,{x:0,y:ue-1},{x:G,y:X-1},{width:K,height:1}),Ku.copy(z.data,R,{x:0,y:0},{x:G,y:X+ue},{width:K,height:1}),Ku.copy(z.data,R,{x:K-1,y:0},{x:G-1,y:X},{width:1,height:ue}),Ku.copy(z.data,R,{x:0,y:0},{x:G+K,y:X},{width:1,height:ue})}this.image=R,this.iconPositions=f,this.patternPositions=m}addImages(i,u,f){for(const m in i){const w=i[m],S={x:0,y:0,w:w.data.width+2*Ju,h:w.data.height+2*Ju};f.push(S),u[m]=new Wy(S,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(i,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>i.hasImage(f)),i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in i.updatedImages)this.patchUpdatedImage(this.iconPositions[f],i.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],i.getImage(f),u)}patchUpdatedImage(i,u,f){if(!i||!u||i.version===u.version)return;i.version=u.version;const[m,w]=i.tl;f.update(u.data,void 0,{x:m,y:w})}}Sn(Wy,"ImagePosition"),Sn(Xy,"ImageAtlas");const ml={horizontal:1,vertical:2,horizontalOnly:3},C0=-17;class Tp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,u){const f=new Tp;return f.scale=i||1,f.fontStack=u,f}static forImage(i){const u=new Tp;return u.imageName=i,u}}class Ld{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,u){const f=new Ld;for(let m=0;m<i.sections.length;m++){const w=i.sections[m];w.image?f.addImageSection(w):f.addTextSection(w,u)}return f}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(i){this.text=function(u,f){let m="";for(let w=0;w<u.length;w++){const S=u.charCodeAt(w+1)||null,M=u.charCodeAt(w-1)||null;m+=!f&&(S&&wa(S)&&!Rg[u[w+1]]||M&&wa(M)&&!Rg[u[w-1]])||!Rg[u[w]]?u[w]:Rg[u[w]]}return m}(this.text,i)}trim(){let i=0;for(let f=0;f<this.text.length&&Mp[this.text.charCodeAt(f)];f++)i++;let u=this.text.length;for(let f=this.text.length-1;f>=0&&f>=i&&Mp[this.text.charCodeAt(f)];f--)u--;this.text=this.text.substring(i,u),this.sectionIndex=this.sectionIndex.slice(i,u)}substring(i,u){const f=new Ld;return f.text=this.text.substring(i,u),f.sectionIndex=this.sectionIndex.slice(i,u),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,u)=>Math.max(i,this.sections[u].scale),0)}addTextSection(i,u){this.text+=i.text,this.sections.push(Tp.forText(i.scale,i.fontStack||u));const f=this.sections.length-1;for(let m=0;m<i.text.length;++m)this.sectionIndex.push(f)}addImageSection(i){const u=i.image?i.image.name:"";if(0===u.length)return void cr("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Tp.forImage(u)),this.sectionIndex.push(this.sections.length-1)):cr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zy(s,i,u,f,m,w,S,M,R,L,z,V,G,X,K){const ue=Ld.fromFeature(s,m);V===ml.vertical&&ue.verticalizePunctuation(G);let Ce=[];const Ge=function(ut,Bt,Ot,Yt,yn,jt){if(!ut)return[];const Qt=[],en=function(Ln,Fn,On,jr,wn,or){let Fr=0;for(let wi=0;wi<Ln.length();wi++){const Pr=Ln.getSection(wi);Fr+=vw(Ln.getCharCode(wi),Pr,jr,wn,Fn,or)}return Fr/Math.max(1,Math.ceil(Fr/On))}(ut,Bt,Ot,Yt,yn,jt),ln=ut.text.indexOf("\u200b")>=0;let xn=0;for(let Ln=0;Ln<ut.length();Ln++){const Fn=ut.getSection(Ln),On=ut.getCharCode(Ln);if(Mp[On]||(xn+=vw(On,Fn,Yt,yn,Bt,jt)),Ln<ut.length()-1){const jr=!((Xt=On)<11904||!(kn["Bopomofo Extended"](Xt)||kn.Bopomofo(Xt)||kn["CJK Compatibility Forms"](Xt)||kn["CJK Compatibility Ideographs"](Xt)||kn["CJK Compatibility"](Xt)||kn["CJK Radicals Supplement"](Xt)||kn["CJK Strokes"](Xt)||kn["CJK Symbols and Punctuation"](Xt)||kn["CJK Unified Ideographs Extension A"](Xt)||kn["CJK Unified Ideographs"](Xt)||kn["Enclosed CJK Letters and Months"](Xt)||kn["Halfwidth and Fullwidth Forms"](Xt)||kn.Hiragana(Xt)||kn["Ideographic Description Characters"](Xt)||kn["Kangxi Radicals"](Xt)||kn["Katakana Phonetic Extensions"](Xt)||kn.Katakana(Xt)||kn["Vertical Forms"](Xt)||kn["Yi Radicals"](Xt)||kn["Yi Syllables"](Xt)));(SS[On]||jr||Fn.imageName)&&Qt.push(Nd(Ln+1,xn,en,Qt,Ar(On,ut.getCharCode(Ln+1),jr&&ln),!1))}}var Xt;return Yy(Nd(ut.length(),xn,en,Qt,0,!0))}(ue,L,w,i,f,X),{processBidirectionalText:nt,processStyledBidirectionalText:$e}=k;if(nt&&1===ue.sections.length){const ut=nt(ue.toString(),Ge);for(const Bt of ut){const Ot=new Ld;Ot.text=Bt,Ot.sections=ue.sections;for(let Yt=0;Yt<Bt.length;Yt++)Ot.sectionIndex.push(0);Ce.push(Ot)}}else if($e){const ut=$e(ue.text,ue.sectionIndex,Ge);for(const Bt of ut){const Ot=new Ld;Ot.text=Bt[0],Ot.sectionIndex=Bt[1],Ot.sections=ue.sections,Ce.push(Ot)}}else Ce=function(ut,Bt){const Ot=[],Yt=ut.text;let yn=0;for(const jt of Bt)Ot.push(ut.substring(yn,jt)),yn=jt;return yn<Yt.length&&Ot.push(ut.substring(yn,Yt.length)),Ot}(ue,Ge);const et=[],ct={positionedLines:et,text:ue.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:V,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ut,Bt,Ot,Yt,yn,jt,Qt,en,ln,xn,Xt,Ln){let Fn=0,On=0,jr=0;const wn="right"===en?1:"left"===en?0:.5;let or=!1;for(const Gr of yn){const $r=Gr.getSections();for(const bo of $r){if(bo.imageName)continue;const Fo=Bt[bo.fontStack];if(Fo&&(or=void 0!==Fo.ascender&&void 0!==Fo.descender,!or))break}if(!or)break}let Fr=0;for(const Gr of yn){Gr.trim();const $r=Gr.getMaxScale(),bo=($r-1)*Ya,Fo={positionedGlyphs:[],lineOffset:0};ut.positionedLines[Fr]=Fo;const Eo=Fo.positionedGlyphs;let vi=0;if(!Gr.length()){On+=jt,++Fr;continue}let gs=0,Ls=0;for(let Bo=0;Bo<Gr.length();Bo++){const da=Gr.getSection(Bo),Js=Gr.getSectionIndex(Bo),Ns=Gr.getCharCode(Bo);let Si=da.scale,Qs=null,go=null,ka=null,Es=Ya,lu=0;const Fa=!(ln===ml.horizontal||!Xt&&!Bh(Ns)||Xt&&(Mp[Ns]||(wi=Ns,kn.Arabic(wi)||kn["Arabic Supplement"](wi)||kn["Arabic Extended-A"](wi)||kn["Arabic Presentation Forms-A"](wi)||kn["Arabic Presentation Forms-B"](wi))));if(da.imageName){const Ka=Yt[da.imageName];if(!Ka)continue;ka=da.imageName,ut.iconsInText=ut.iconsInText||!0,go=Ka.paddedRect;const Ba=Ka.displaySize;Si=Si*Ya/Ln,Qs={width:Ba[0],height:Ba[1],left:Ju,top:-E0,advance:Fa?Ba[1]:Ba[0],localGlyph:!1},lu=or?-Qs.height*Si:C0+$r*Ya-Ba[1]*Si,Es=Qs.advance;const Cc=(Fa?Ba[0]:Ba[1])*Si-Ya*$r;Cc>0&&Cc>vi&&(vi=Cc)}else{const Ka=Ot[da.fontStack];if(!Ka)continue;Ka[Ns]&&(go=Ka[Ns]);const Ba=Bt[da.fontStack];if(!Ba)continue;const Cc=Ba.glyphs[Ns];if(!Cc)continue;if(Qs=Cc.metrics,Es=8203!==Ns?Ya:0,or){const $d=void 0!==Ba.ascender?Math.abs(Ba.ascender):0,Hf=void 0!==Ba.descender?Math.abs(Ba.descender):0,Np=($d+Hf)*Si;gs<Np&&(gs=Np,Ls=($d-Hf)/2*Si),lu=-$d*Si}else lu=C0+($r-Si)*Ya}Fa?(ut.verticalizable=!0,Eo.push({glyph:Ns,imageName:ka,x:Fn,y:On+lu,vertical:Fa,scale:Si,localGlyph:Qs.localGlyph,fontStack:da.fontStack,sectionIndex:Js,metrics:Qs,rect:go}),Fn+=Es*Si+xn):(Eo.push({glyph:Ns,imageName:ka,x:Fn,y:On+lu,vertical:Fa,scale:Si,localGlyph:Qs.localGlyph,fontStack:da.fontStack,sectionIndex:Js,metrics:Qs,rect:go}),Fn+=Qs.advance*Si+xn)}0!==Eo.length&&(jr=Math.max(Fn-xn,jr),or?Ky(Eo,wn,vi,Ls,jt*$r/2):Ky(Eo,wn,vi,0,jt/2)),Fn=0;const Os=jt*$r+vi;Fo.lineOffset=Math.max(vi,bo),On+=Os,++Fr}var wi;const Pr=On,{horizontalAlign:dr,verticalAlign:is}=Bg(Qt);(function(Gr,$r,bo,Fo,Eo,vi){const gs=($r-bo)*Eo,Ls=-vi*Fo;for(const Os of Gr)for(const Bo of Os.positionedGlyphs)Bo.x+=gs,Bo.y+=Ls})(ut.positionedLines,wn,dr,is,jr,Pr),ut.top+=-is*Pr,ut.bottom=ut.top+Pr,ut.left+=-dr*jr,ut.right=ut.left+jr,ut.hasBaseline=or}(ct,i,u,f,Ce,S,M,R,V,L,G,K),!function(ut){for(const Bt of ut)if(0!==Bt.positionedGlyphs.length)return!1;return!0}(et)&&ct}const Mp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},SS={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function vw(s,i,u,f,m,w){if(i.imageName){const S=f[i.imageName];return S?S.displaySize[0]*i.scale*Ya/w+m:0}{const S=u[i.fontStack],M=S&&S.glyphs[s];return M?M.metrics.advance*i.scale+m:0}}function Od(s,i,u,f){const m=Math.pow(s-i,2);return f?s<i?m/2:2*m:m+Math.abs(u)*u}function Ar(s,i,u){let f=0;return 10===s&&(f-=1e4),u&&(f+=150),40!==s&&65288!==s||(f+=50),41!==i&&65289!==i||(f+=50),f}function Nd(s,i,u,f,m,w){let S=null,M=Od(i,u,m,w);for(const R of f){const L=Od(i-R.x,u,m,w)+R.badness;L<=M&&(S=R,M=L)}return{index:s,x:i,priorBreak:S,badness:M}}function Yy(s){return s?Yy(s.priorBreak).concat(s.index):[]}function Bg(s){let i=.5,u=.5;switch(s){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:i,verticalAlign:u}}function Ky(s,i,u,f,m){if(!(i||u||f||m))return;const w=s.length-1,S=s[w],M=(S.x+S.metrics.advance*S.scale)*i;for(let R=0;R<=w;R++)s[R].x-=M,s[R].y+=u+f+m}function S0(s,i,u){const{horizontalAlign:f,verticalAlign:m}=Bg(u),w=i[0]-s.displaySize[0]*f,S=i[1]-s.displaySize[1]*m;return{image:s,top:S,bottom:S+s.displaySize[1],left:w,right:w+s.displaySize[0]}}function I0(s,i,u,f,m,w){const S=s.image;let M;if(S.content){const Ce=S.content,Ge=S.pixelRatio||1;M=[Ce[0]/Ge,Ce[1]/Ge,S.displaySize[0]-Ce[2]/Ge,S.displaySize[1]-Ce[3]/Ge]}const R=i.left*w,L=i.right*w;let z,V,G,X;"width"===u||"both"===u?(X=m[0]+R-f[3],V=m[0]+L+f[1]):(X=m[0]+(R+L-S.displaySize[0])/2,V=X+S.displaySize[0]);const K=i.top*w,ue=i.bottom*w;return"height"===u||"both"===u?(z=m[1]+K-f[0],G=m[1]+ue+f[2]):(z=m[1]+(K+ue-S.displaySize[1])/2,G=z+S.displaySize[1]),{image:S,top:z,right:V,bottom:G,left:X,collisionPadding:M}}class $c extends Z{constructor(i,u,f,m,w){super(i,u),this.angle=m,this.z=f,void 0!==w&&(this.segment=w)}clone(){return new $c(this.x,this.y,this.z,this.angle,this.segment)}}function Jy(s,i,u,f,m){if(void 0===i.segment)return!0;let w=i,S=i.segment+1,M=0;for(;M>-u/2;){if(S--,S<0)return!1;M-=s[S].dist(w),w=s[S]}M+=s[S].dist(s[S+1]),S++;const R=[];let L=0;for(;M<u/2;){const z=s[S],V=s[S+1];if(!V)return!1;let G=s[S-1].angleTo(z)-z.angleTo(V);for(G=Math.abs((G+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:M,angleDelta:G}),L+=G;M-R[0].distance>f;)L-=R.shift().angleDelta;if(L>m)return!1;S++,M+=z.dist(V)}return!0}function zg(s){let i=0;for(let u=0;u<s.length-1;u++)i+=s[u].dist(s[u+1]);return i}function xw(s,i,u){return s?.6*i*u:0}function Ug(s,i){return Math.max(s?s.right-s.left:0,i?i.right-i.left:0)}function ww(s,i,u,f,m,w){const S=xw(u,m,w),M=Ug(u,f)*w;let R=0;const L=zg(s)/2;for(let z=0;z<s.length-1;z++){const V=s[z],G=s[z+1],X=V.dist(G);if(R+X>L){const K=(L-R)/X,ue=In(V.x,G.x,K),Ce=In(V.y,G.y,K),Ge=new $c(ue,Ce,0,G.angleTo(V),z);return!S||Jy(s,Ge,M,S,i)?Ge:void 0}R+=X}}function Qy(s,i,u,f,m,w,S,M,R){const L=xw(f,w,S),z=Ug(f,m),V=z*S,G=0===s[0].x||s[0].x===R||0===s[0].y||s[0].y===R;return i-V<i/4&&(i=V+i/4),e_(s,G?i/2*M%i:(z/2+2*w)*S*M%i,i,L,u,V,G,!1,R)}function e_(s,i,u,f,m,w,S,M,R){const L=w/2,z=zg(s);let V=0,G=i-u,X=[];for(let K=0;K<s.length-1;K++){const ue=s[K],Ce=s[K+1],Ge=ue.dist(Ce),nt=Ce.angleTo(ue);for(;G+u<V+Ge;){G+=u;const $e=(G-V)/Ge,et=In(ue.x,Ce.x,$e),ct=In(ue.y,Ce.y,$e);if(et>=0&&et<R&&ct>=0&&ct<R&&G-L>=0&&G+L<=z){const ut=new $c(et,ct,0,nt,K);ut._round(),f&&!Jy(s,ut,w,f,m)||X.push(ut)}}V+=Ge}return M||X.length||S||(X=e_(s,V/2,u,f,m,w,S,!0,R)),X}function t_(s,i,u,f,m){const w=[];for(let S=0;S<s.length;S++){const M=s[S];let R;for(let L=0;L<M.length-1;L++){let z=M[L],V=M[L+1];z.x<i&&V.x<i||(z.x<i?z=new Z(i,z.y+(i-z.x)/(V.x-z.x)*(V.y-z.y))._round():V.x<i&&(V=new Z(i,z.y+(i-z.x)/(V.x-z.x)*(V.y-z.y))._round()),z.y<u&&V.y<u||(z.y<u?z=new Z(z.x+(u-z.y)/(V.y-z.y)*(V.x-z.x),u)._round():V.y<u&&(V=new Z(z.x+(u-z.y)/(V.y-z.y)*(V.x-z.x),u)._round()),z.x>=f&&V.x>=f||(z.x>=f?z=new Z(f,z.y+(f-z.x)/(V.x-z.x)*(V.y-z.y))._round():V.x>=f&&(V=new Z(f,z.y+(f-z.x)/(V.x-z.x)*(V.y-z.y))._round()),z.y>=m&&V.y>=m||(z.y>=m?z=new Z(z.x+(m-z.y)/(V.y-z.y)*(V.x-z.x),m)._round():V.y>=m&&(V=new Z(z.x+(m-z.y)/(V.y-z.y)*(V.x-z.x),m)._round()),R&&z.equals(R[R.length-1])||(R=[z],w.push(R)),R.push(V)))))}}return w}Sn($c,"Anchor");const xc=1e20;function T0(s,i,u,f,m,w,S,M,R){for(let L=i;L<i+f;L++)Vg(s,u*w+L,w,m,S,M,R);for(let L=u;L<u+m;L++)Vg(s,L*w+i,1,f,S,M,R)}function Vg(s,i,u,f,m,w,S){w[0]=0,S[0]=-xc,S[1]=xc,m[0]=s[i];for(let M=1,R=0,L=0;M<f;M++){m[M]=s[i+M*u];const z=M*M;do{const V=w[R];L=(m[M]-m[V]+z-V*V)/(M-V)/2}while(L<=S[R]&&--R>-1);R++,w[R]=M,S[R]=L,S[R+1]=xc}for(let M=0,R=0;M<f;M++){for(;S[R+1]<M;)R++;const L=w[R],z=M-L;s[i+M*u]=m[L]+z*z}}const yl=2,n_={none:0,ideographs:1,all:2};class ef{constructor(i,u,f){this.requestManager=i,this.localGlyphMode=u,this.localFontFamily=f,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,u){const f=[];for(const m in i)for(const w of i[m])f.push({stack:m,id:w});at(f,({stack:m,id:w},S)=>{let M=this.entries[m];M||(M=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let R=M.glyphs[w];if(void 0!==R)return void S(null,{stack:m,id:w,glyph:R});if(R=this._tinySDF(M,m,w),R)return M.glyphs[w]=R,void S(null,{stack:m,id:w,glyph:R});const L=Math.floor(w/256);if(256*L>65535)return void S(new Error("glyphs > 65535 not supported"));if(M.ranges[L])return void S(null,{stack:m,id:w,glyph:R});let z=M.requests[L];z||(z=M.requests[L]=[],ef.loadGlyphRange(m,L,this.url,this.requestManager,(V,G)=>{if(G){M.ascender=G.ascender,M.descender=G.descender;for(const X in G.glyphs)this._doesCharSupportLocalGlyph(+X)||(M.glyphs[+X]=G.glyphs[+X]);M.ranges[L]=!0}for(const X of z)X(V,G);delete M.requests[L]})),z.push((V,G)=>{V?S(V):G&&S(null,{stack:m,id:w,glyph:G.glyphs[w]||null})})},(m,w)=>{if(m)u(m);else if(w){const S={};for(const{stack:M,id:R,glyph:L}of w)void 0===S[M]&&(S[M]={}),void 0===S[M].glyphs&&(S[M].glyphs={}),S[M].glyphs[R]=L&&{id:L.id,bitmap:L.bitmap.clone(),metrics:L.metrics},S[M].ascender=this.entries[M].ascender,S[M].descender=this.entries[M].descender;u(null,S)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==n_.none&&(this.localGlyphMode===n_.all?!!this.localFontFamily:!!this.localFontFamily&&(kn["CJK Unified Ideographs"](i)||kn["Hangul Syllables"](i)||kn.Hiragana(i)||kn.Katakana(i)||kn["CJK Symbols and Punctuation"](i)))}_tinySDF(i,u,f){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(f))return;let w=i.tinySDF;if(!w){let ue="400";/bold/i.test(u)?ue="900":/medium/i.test(u)?ue="500":/light/i.test(u)&&(ue="200"),w=i.tinySDF=new ef.TinySDF({fontFamily:m,fontWeight:ue,fontSize:24*yl,buffer:3*yl,radius:8*yl}),w.fontWeight=ue}if(this.localGlyphs[w.fontWeight][f])return this.localGlyphs[w.fontWeight][f];const S=String.fromCharCode(f),{data:M,width:R,height:L,glyphWidth:z,glyphHeight:V,glyphLeft:G,glyphTop:X,glyphAdvance:K}=w.draw(S);return this.localGlyphs[w.fontWeight][f]={id:f,bitmap:new Vc({width:R,height:L},M),metrics:{width:z/yl,height:V/yl,left:G/yl,top:X/yl-27,advance:K/yl,localGlyph:!0}}}}ef.loadGlyphRange=function(s,i,u,f,m){const w=256*i,S=w+255,M=f.transformRequest(f.normalizeGlyphsURL(u).replace("{fontstack}",s).replace("{range}",`${w}-${S}`),si.Glyphs);Uo(M,(R,L)=>{if(R)m(R);else if(L){const z={},V=new Ng(L).readFields(Fg,{});for(const G of V.glyphs)z[G.id]=G;m(null,{glyphs:z,ascender:V.ascender,descender:V.descender})}})},ef.TinySDF=class{constructor({fontSize:s=24,buffer:i=3,radius:u=8,cutoff:f=.25,fontFamily:m="sans-serif",fontWeight:w="normal",fontStyle:S="normal"}={}){this.buffer=i,this.cutoff=f,this.radius=u;const M=this.size=s+4*i,R=this._createCanvas(M),L=this.ctx=R.getContext("2d",{willReadFrequently:!0});L.font=`${S} ${w} ${s}px ${m}`,L.textBaseline="alphabetic",L.textAlign="left",L.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(s){const i=document.createElement("canvas");return i.width=i.height=s,i}draw(s){const{width:i,actualBoundingBoxAscent:u,actualBoundingBoxDescent:f,actualBoundingBoxLeft:m,actualBoundingBoxRight:w}=this.ctx.measureText(s),S=Math.ceil(u),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(w-m))),R=Math.min(this.size-this.buffer,S+Math.ceil(f)),L=M+2*this.buffer,z=R+2*this.buffer,V=Math.max(L*z,0),G=new Uint8ClampedArray(V),X={data:G,width:L,height:z,glyphWidth:M,glyphHeight:R,glyphTop:S,glyphLeft:0,glyphAdvance:i};if(0===M||0===R)return X;const{ctx:K,buffer:ue,gridInner:Ce,gridOuter:Ge}=this;K.clearRect(ue,ue,M,R),K.fillText(s,ue,ue+S);const nt=K.getImageData(ue,ue,M,R);Ge.fill(xc,0,V),Ce.fill(0,0,V);for(let $e=0;$e<R;$e++)for(let et=0;et<M;et++){const ct=nt.data[4*($e*M+et)+3]/255;if(0===ct)continue;const ut=($e+ue)*L+et+ue;if(1===ct)Ge[ut]=0,Ce[ut]=xc;else{const Bt=.5-ct;Ge[ut]=Bt>0?Bt*Bt:0,Ce[ut]=Bt<0?Bt*Bt:0}}T0(Ge,0,0,L,z,L,this.f,this.v,this.z),T0(Ce,ue,ue,M,R,L,this.f,this.v,this.z);for(let $e=0;$e<V;$e++){const et=Math.sqrt(Ge[$e])-Math.sqrt(Ce[$e]);G[$e]=Math.round(255-255*(et/this.radius+this.cutoff))}return X}};const yh=Ju;function qc(s,i,u,f){const m=[],w=s.image,S=w.pixelRatio,M=w.paddedRect.w-2*yh,R=w.paddedRect.h-2*yh,L=s.right-s.left,z=s.bottom-s.top,V=w.stretchX||[[0,M]],G=w.stretchY||[[0,R]],X=(jt,Qt)=>jt+Qt[1]-Qt[0],K=V.reduce(X,0),ue=G.reduce(X,0),Ce=M-K,Ge=R-ue;let nt=0,$e=K,et=0,ct=ue,ut=0,Bt=Ce,Ot=0,Yt=Ge;if(w.content&&f){const jt=w.content;nt=kd(V,0,jt[0]),et=kd(G,0,jt[1]),$e=kd(V,jt[0],jt[2]),ct=kd(G,jt[1],jt[3]),ut=jt[0]-nt,Ot=jt[1]-et,Bt=jt[2]-jt[0]-$e,Yt=jt[3]-jt[1]-ct}const yn=(jt,Qt,en,ln)=>{const xn=Gg(jt.stretch-nt,$e,L,s.left),Xt=$g(jt.fixed-ut,Bt,jt.stretch,K),Ln=Gg(Qt.stretch-et,ct,z,s.top),Fn=$g(Qt.fixed-Ot,Yt,Qt.stretch,ue),On=Gg(en.stretch-nt,$e,L,s.left),jr=$g(en.fixed-ut,Bt,en.stretch,K),wn=Gg(ln.stretch-et,ct,z,s.top),or=$g(ln.fixed-Ot,Yt,ln.stretch,ue),Fr=new Z(xn,Ln),wi=new Z(On,Ln),Pr=new Z(On,wn),dr=new Z(xn,wn),is=new Z(Xt/S,Fn/S),Gr=new Z(jr/S,or/S),$r=i*Math.PI/180;if($r){const Eo=Math.sin($r),vi=Math.cos($r),gs=[vi,-Eo,Eo,vi];Fr._matMult(gs),wi._matMult(gs),dr._matMult(gs),Pr._matMult(gs)}const bo=jt.stretch+jt.fixed,Fo=Qt.stretch+Qt.fixed;return{tl:Fr,tr:wi,bl:dr,br:Pr,tex:{x:w.paddedRect.x+yh+bo,y:w.paddedRect.y+yh+Fo,w:en.stretch+en.fixed-bo,h:ln.stretch+ln.fixed-Fo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:is,pixelOffsetBR:Gr,minFontScaleX:Bt/S/L,minFontScaleY:Yt/S/z,isSDF:u}};if(f&&(w.stretchX||w.stretchY)){const jt=jg(V,Ce,K),Qt=jg(G,Ge,ue);for(let en=0;en<jt.length-1;en++){const ln=jt[en],xn=jt[en+1];for(let Xt=0;Xt<Qt.length-1;Xt++)m.push(yn(ln,Qt[Xt],xn,Qt[Xt+1]))}}else m.push(yn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:R+1}));return m}function kd(s,i,u){let f=0;for(const m of s)f+=Math.max(i,Math.min(u,m[1]))-Math.max(i,Math.min(u,m[0]));return f}function jg(s,i,u){const f=[{fixed:-yh,stretch:0}];for(const[m,w]of s){const S=f[f.length-1];f.push({fixed:m-S.stretch,stretch:S.stretch}),f.push({fixed:m-S.stretch,stretch:S.stretch+(w-m)})}return f.push({fixed:i+yh,stretch:u}),f}function Gg(s,i,u,f){return s/i*u+f}function $g(s,i,u,f){return s-i*u/f}function M0(s,i,u,f){const m=i+s.positionedLines[f].lineOffset;return 0===f?u+m/2:u+(m+(i+s.positionedLines[f-1].lineOffset))/2}class Fd{constructor(i=[],u=bw){if(this.data=i,this.length=this.data.length,this.compare=u,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const i=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:u,compare:f}=this,m=u[i];for(;i>0;){const w=i-1>>1,S=u[w];if(f(m,S)>=0)break;u[i]=S,i=w}u[i]=m}_down(i){const{data:u,compare:f}=this,m=this.length>>1,w=u[i];for(;i<m;){let S=1+(i<<1),M=u[S];const R=S+1;if(R<this.length&&f(u[R],M)<0&&(S=R,M=u[R]),f(M,w)>=0)break;u[i]=M,i=S}u[i]=w}}function bw(s,i){return s<i?-1:s>i?1:0}function Ew(s,i=1,u=!1){let f=1/0,m=1/0,w=-1/0,S=-1/0;const M=s[0];for(let X=0;X<M.length;X++){const K=M[X];(!X||K.x<f)&&(f=K.x),(!X||K.y<m)&&(m=K.y),(!X||K.x>w)&&(w=K.x),(!X||K.y>S)&&(S=K.y)}const R=Math.min(w-f,S-m);let L=R/2;const z=new Fd([],Cw);if(0===R)return new Z(f,m);for(let X=f;X<w;X+=R)for(let K=m;K<S;K+=R)z.push(new tf(X+L,K+L,L,s));let V=function(X){let K=0,ue=0,Ce=0;const Ge=X[0];for(let nt=0,$e=Ge.length,et=$e-1;nt<$e;et=nt++){const ct=Ge[nt],ut=Ge[et],Bt=ct.x*ut.y-ut.x*ct.y;ue+=(ct.x+ut.x)*Bt,Ce+=(ct.y+ut.y)*Bt,K+=3*Bt}return new tf(ue/K,Ce/K,0,X)}(s),G=z.length;for(;z.length;){const X=z.pop();(X.d>V.d||!V.d)&&(V=X,u&&console.log("found best %d after %d probes",Math.round(1e4*X.d)/1e4,G)),X.max-V.d<=i||(L=X.h/2,z.push(new tf(X.p.x-L,X.p.y-L,L,s)),z.push(new tf(X.p.x+L,X.p.y-L,L,s)),z.push(new tf(X.p.x-L,X.p.y+L,L,s)),z.push(new tf(X.p.x+L,X.p.y+L,L,s)),G+=4)}return u&&(console.log(`num probes: ${G}`),console.log(`best distance: ${V.d}`)),V.p}function Cw(s,i){return i.max-s.max}class tf{constructor(i,u,f,m){this.p=new Z(i,u),this.h=f,this.d=function(w,S){let M=!1,R=1/0;for(let L=0;L<S.length;L++){const z=S[L];for(let V=0,G=z.length,X=G-1;V<G;X=V++){const K=z[V],ue=z[X];K.y>w.y!=ue.y>w.y&&w.x<(ue.x-K.x)*(w.y-K.y)/(ue.y-K.y)+K.x&&(M=!M),R=Math.min(R,Jv(w,K,ue))}}return(M?1:-1)*Math.sqrt(R)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}}const _h=7,r_=Number.POSITIVE_INFINITY,D0=Math.sqrt(2);function kf(s,[i,u]){let f=0,m=0;if(u===r_){i<0&&(i=0);const w=i/D0;switch(s){case"top-right":case"top-left":m=w-_h;break;case"bottom-right":case"bottom-left":m=-w+_h;break;case"bottom":m=-i+_h;break;case"top":m=i-_h}switch(s){case"top-right":case"bottom-right":f=-w;break;case"top-left":case"bottom-left":f=w;break;case"left":f=i;break;case"right":f=-i}}else{switch(i=Math.abs(i),u=Math.abs(u),s){case"top-right":case"top-left":case"top":m=u-_h;break;case"bottom-right":case"bottom-left":case"bottom":m=-u+_h}switch(s){case"top-right":case"bottom-right":case"right":f=-i;break;case"top-left":case"bottom-left":case"left":f=i}}return[f,m]}function IS(s,i,u,f,m,w,S,M,R,L){s.createArrays(),s.tilePixelRatio=ar/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const z=s.layers[0].layout,V=s.layers[0]._unevaluatedLayout._values,G={};if("composite"===s.textSizeData.kind){const{minZoom:ue,maxZoom:Ce}=s.textSizeData;G.compositeTextSizes=[V["text-size"].possiblyEvaluate(new U(ue),M),V["text-size"].possiblyEvaluate(new U(Ce),M)]}if("composite"===s.iconSizeData.kind){const{minZoom:ue,maxZoom:Ce}=s.iconSizeData;G.compositeIconSizes=[V["icon-size"].possiblyEvaluate(new U(ue),M),V["icon-size"].possiblyEvaluate(new U(Ce),M)]}G.layoutTextSize=V["text-size"].possiblyEvaluate(new U(R+1),M),G.layoutIconSize=V["icon-size"].possiblyEvaluate(new U(R+1),M),G.textMaxSize=V["text-size"].possiblyEvaluate(new U(18),M);const X="map"===z.get("text-rotation-alignment")&&"point"!==z.get("symbol-placement"),K=z.get("text-size");for(const ue of s.features){const Ce=z.get("text-font").evaluate(ue,{},M).join(","),Ge=K.evaluate(ue,{},M),nt=G.layoutTextSize.evaluate(ue,{},M),$e=(G.layoutIconSize.evaluate(ue,{},M),{horizontal:{},vertical:void 0}),et=ue.text;let ct,ut=[0,0];if(et){const Yt=et.toString(),yn=z.get("text-letter-spacing").evaluate(ue,{},M)*Ya,jt=z.get("text-line-height").evaluate(ue,{},M)*Ya,Qt=Wm(Yt)?yn:0,en=z.get("text-anchor").evaluate(ue,{},M),ln=z.get("text-variable-anchor");if(!ln){const On=z.get("text-radial-offset").evaluate(ue,{},M);ut=On?kf(en,[On*Ya,r_]):z.get("text-offset").evaluate(ue,{},M).map(jr=>jr*Ya)}let xn=X?"center":z.get("text-justify").evaluate(ue,{},M);const Xt="point"===z.get("symbol-placement"),Ln=Xt?z.get("text-max-width").evaluate(ue,{},M)*Ya:1/0,Fn=On=>{s.allowVerticalPlacement&&Kp(Yt)&&($e.vertical=Zy(et,i,u,m,Ce,Ln,jt,en,On,Qt,ut,ml.vertical,!0,nt,Ge))};if(!X&&ln){const On="auto"===xn?ln.map(wn=>A0(wn)):[xn];let jr=!1;for(let wn=0;wn<On.length;wn++){const or=On[wn];if(!$e.horizontal[or])if(jr)$e.horizontal[or]=$e.horizontal[0];else{const Fr=Zy(et,i,u,m,Ce,Ln,jt,"center",or,Qt,ut,ml.horizontal,!1,nt,Ge);Fr&&($e.horizontal[or]=Fr,jr=1===Fr.positionedLines.length)}}Fn("left")}else{if("auto"===xn&&(xn=A0(en)),Xt||z.get("text-writing-mode").indexOf("horizontal")>=0||!Kp(Yt)){const On=Zy(et,i,u,m,Ce,Ln,jt,en,xn,Qt,ut,ml.horizontal,!1,nt,Ge);On&&($e.horizontal[xn]=On)}Fn(Xt?"left":xn)}}let Bt=!1;if(ue.icon&&ue.icon.name){const Yt=f[ue.icon.name];Yt&&(ct=S0(m[ue.icon.name],z.get("icon-offset").evaluate(ue,{},M),z.get("icon-anchor").evaluate(ue,{},M)),Bt=Yt.sdf,void 0===s.sdfIcons?s.sdfIcons=Yt.sdf:s.sdfIcons!==Yt.sdf&&cr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Yt.pixelRatio!==s.pixelRatio||0!==z.get("icon-rotate").constantOr(1))&&(s.iconsNeedLinear=!0))}const Ot=Ap($e.horizontal)||$e.vertical;s.iconsInText||(s.iconsInText=!!Ot&&Ot.iconsInText),(Ot||ct)&&P0(s,ue,$e,ct,f,G,nt,0,ut,Bt,S,M,L)}w&&s.generateCollisionDebugBuffers(R,s.collisionBoxArray)}function A0(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function P0(s,i,u,f,m,w,S,M,R,L,z,V,G){let X=w.textMaxSize.evaluate(i,{},V);void 0===X&&(X=S);const K=s.layers[0].layout,ue=K.get("icon-offset").evaluate(i,{},V),Ce=Ap(u.horizontal)||u.vertical,Ge="globe"===G.name,nt=Ya,$e=S/nt,et=s.tilePixelRatio*X/nt,ct=(en=s.overscaling,s.zoom>18&&en>2&&(en>>=1),Math.max(ar/(512*en),1)*K.get("symbol-spacing")),ut=K.get("text-padding")*s.tilePixelRatio,Bt=K.get("icon-padding")*s.tilePixelRatio,Ot=qe(K.get("text-max-angle")),Yt="map"===K.get("text-rotation-alignment")&&"point"!==K.get("symbol-placement"),yn="map"===K.get("icon-rotation-alignment")&&"point"!==K.get("symbol-placement"),jt=K.get("symbol-placement"),Qt=ct/2;var en;const ln=K.get("icon-text-fit");let xn;f&&"none"!==ln&&(s.allowVerticalPlacement&&u.vertical&&(xn=I0(f,u.vertical,ln,K.get("icon-text-fit-padding"),ue,$e)),Ce&&(f=I0(f,Ce,ln,K.get("icon-text-fit-padding"),ue,$e)));const Xt=(Ln,Fn,On)=>{if(Fn.x<0||Fn.x>=ar||Fn.y<0||Fn.y>=ar)return;let jr=null;if(Ge){const{x:wn,y:or,z:Fr}=G.projectTilePoint(Fn.x,Fn.y,On);jr={anchor:new $c(wn,or,Fr,0,void 0),up:G.upVector(On,Fn.x,Fn.y)}}!function(wn,or,Fr,wi,Pr,dr,is,Gr,$r,bo,Fo,Eo,vi,gs,Ls,Os,Bo,da,Js,Ns,Si,Qs,go,ka,Es){const lu=wn.addToLineVertexArray(or,wi);let Fa,Ka,Ba,Cc,$d,Hf,Np,qd=0,Z0=0,C_=0,S_=0,I_=-1,T_=-1;const vl={};let Y0=dc("");const Hd=Fr?Fr.anchor:or;let M_=0,D_=0;if(void 0===$r._unevaluatedLayout.getValue("text-radial-offset")?[M_,D_]=$r.layout.get("text-offset").evaluate(Si,{},Es).map(xl=>xl*Ya):(M_=$r.layout.get("text-radial-offset").evaluate(Si,{},Es)*Ya,D_=r_),wn.allowVerticalPlacement&&Pr.vertical){const xl=Pr.vertical;if(Ls)Hf=Pp(xl),Gr&&(Np=Pp(Gr));else{const wl=$r.layout.get("text-rotate").evaluate(Si,{},Es)+90;Ba=qg(bo,Hd,or,Fo,Eo,vi,xl,gs,wl,Os),Gr&&(Cc=qg(bo,Hd,or,Fo,Eo,vi,Gr,da,wl))}}if(dr){const xl=$r.layout.get("icon-rotate").evaluate(Si,{},Es),wl="none"!==$r.layout.get("icon-text-fit"),Wd=qc(dr,xl,go,wl),sm=Gr?qc(Gr,xl,go,wl):void 0;Ka=qg(bo,Hd,or,Fo,Eo,vi,dr,da,xl),qd=4*Wd.length;const K0=wn.iconSizeData;let Ch=null;"source"===K0.kind?(Ch=[vc*$r.layout.get("icon-size").evaluate(Si,{},Es)],Ch[0]>Ff&&cr(`${wn.layerIds[0]}: Value for "icon-size" is >= ${Dp}. Reduce your "icon-size".`)):"composite"===K0.kind&&(Ch=[vc*Qs.compositeIconSizes[0].evaluate(Si,{},Es),vc*Qs.compositeIconSizes[1].evaluate(Si,{},Es)],(Ch[0]>Ff||Ch[1]>Ff)&&cr(`${wn.layerIds[0]}: Value for "icon-size" is >= ${Dp}. Reduce your "icon-size".`)),wn.addSymbols(wn.icon,Wd,Ch,Ns,Js,Si,!1,Fr,or,lu.lineStartIndex,lu.lineLength,-1,ka,Es),I_=wn.icon.placedSymbolArray.length-1,sm&&(Z0=4*sm.length,wn.addSymbols(wn.icon,sm,Ch,Ns,Js,Si,ml.vertical,Fr,or,lu.lineStartIndex,lu.lineLength,-1,ka,Es),T_=wn.icon.placedSymbolArray.length-1)}for(const xl in Pr.horizontal){const wl=Pr.horizontal[xl];Fa||(Y0=dc(wl.text),Ls?$d=Pp(wl):Fa=qg(bo,Hd,or,Fo,Eo,vi,wl,gs,$r.layout.get("text-rotate").evaluate(Si,{},Es),Os));const Wd=1===wl.positionedLines.length;if(C_+=Sw(wn,Fr,or,wl,is,$r,Ls,Si,Os,lu,Pr.vertical?ml.horizontal:ml.horizontalOnly,Wd?Object.keys(Pr.horizontal):[xl],vl,I_,Qs,ka,Es),Wd)break}Pr.vertical&&(S_+=Sw(wn,Fr,or,Pr.vertical,is,$r,Ls,Si,Os,lu,ml.vertical,["vertical"],vl,T_,Qs,ka,Es));let uf=-1;const A_=(xl,wl)=>xl?Math.max(xl,wl):wl;uf=A_($d,uf),uf=A_(Hf,uf),uf=A_(Np,uf);const zw=uf>-1?1:0;wn.glyphOffsetArray.length>=Vf.MAX_GLYPHS&&cr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Si.sortKey&&wn.addToSortKeyRanges(wn.symbolInstances.length,Si.sortKey),wn.symbolInstances.emplaceBack(Hd.x,Hd.y,Hd.z,or.x,or.y,vl.right>=0?vl.right:-1,vl.center>=0?vl.center:-1,vl.left>=0?vl.left:-1,vl.vertical>=0?vl.vertical:-1,I_,T_,Y0,void 0!==Fa?Fa:wn.collisionBoxArray.length,void 0!==Fa?Fa+1:wn.collisionBoxArray.length,void 0!==Ba?Ba:wn.collisionBoxArray.length,void 0!==Ba?Ba+1:wn.collisionBoxArray.length,void 0!==Ka?Ka:wn.collisionBoxArray.length,void 0!==Ka?Ka+1:wn.collisionBoxArray.length,Cc||wn.collisionBoxArray.length,Cc?Cc+1:wn.collisionBoxArray.length,Fo,C_,S_,qd,Z0,zw,0,M_,D_,uf)}(s,Fn,jr,Ln,u,f,m,xn,s.layers[0],s.collisionBoxArray,i.index,i.sourceLayerIndex,s.index,ut,Yt,R,0,Bt,yn,ue,i,w,L,z,V)};if("line"===jt)for(const Ln of t_(i.geometry,0,0,ar,ar)){const Fn=Qy(Ln,ct,Ot,u.vertical||Ce,f,nt,et,s.overscaling,ar);for(const On of Fn)Ce&&i_(s,Ce.text,Qt,On)||Xt(Ln,On,V)}else if("line-center"===jt){for(const Ln of i.geometry)if(Ln.length>1){const Fn=ww(Ln,Ot,u.vertical||Ce,f,nt,et);Fn&&Xt(Ln,Fn,V)}}else if("Polygon"===i.type)for(const Ln of Ty(i.geometry,0)){const Fn=Ew(Ln,16);Xt(Ln[0],new $c(Fn.x,Fn.y,0,0,void 0),V)}else if("LineString"===i.type)for(const Ln of i.geometry)Xt(Ln,new $c(Ln[0].x,Ln[0].y,0,0,void 0),V);else if("Point"===i.type)for(const Ln of i.geometry)for(const Fn of Ln)Xt([Fn],new $c(Fn.x,Fn.y,0,0,void 0),V)}const Dp=255,Ff=Dp*vc;function Sw(s,i,u,f,m,w,S,M,R,L,z,V,G,X,K,ue,Ce){const Ge=function(et,ct,ut,Bt,Ot,Yt,yn,jt){const Qt=[];if(0===ct.positionedLines.length)return Qt;const en=Bt.layout.get("text-rotate").evaluate(Yt,{})*Math.PI/180,ln=function(On){const jr=On[0],wn=On[1],or=jr*wn;return or>0?[jr,-wn]:or<0?[-jr,wn]:0===jr?[wn,jr]:[wn,-jr]}(ut);let xn=Math.abs(ct.top-ct.bottom);for(const On of ct.positionedLines)xn-=On.lineOffset;const Xt=ct.positionedLines.length,Ln=xn/Xt;let Fn=ct.top-ut[1];for(let On=0;On<Xt;++On){const jr=ct.positionedLines[On];Fn=M0(ct,Ln,Fn,On);for(const wn of jr.positionedGlyphs){if(!wn.rect)continue;const or=wn.rect||{};let Fr=E0+1,wi=!0,Pr=1,dr=0;if(wn.imageName){const go=yn[wn.imageName];if(!go)continue;if(go.sdf){cr("SDF images are not supported in formatted text and will be ignored.");continue}wi=!1,Pr=go.pixelRatio,Fr=Ju/Pr}const is=(Ot||jt)&&wn.vertical,Gr=wn.metrics.advance*wn.scale/2,$r=wn.metrics,bo=wn.rect;if(null===bo)continue;jt&&ct.verticalizable&&(dr=wn.imageName?Gr-wn.metrics.width*wn.scale/2:0);const Fo=Ot?[wn.x+Gr,wn.y]:[0,0];let Eo=[0,0],vi=[0,0],gs=!1;Ot||(is?(vi=[wn.x+Gr+ln[0],wn.y+ln[1]-dr],gs=!0):Eo=[wn.x+Gr+ut[0],wn.y+ut[1]-dr]);const Ls=bo.w*wn.scale/(Pr*(wn.localGlyph?yl:1)),Os=bo.h*wn.scale/(Pr*(wn.localGlyph?yl:1));let Bo,da,Js,Ns;if(is){const go=wn.y-Fn,ka=new Z(-Gr,Gr-go),Es=-Math.PI/2,lu=new Z(...vi);Bo=new Z(-Gr+Eo[0],Eo[1]),Bo._rotateAround(Es,ka)._add(lu),Bo.x+=-go+Gr,Bo.y-=($r.left-Fr)*wn.scale;const Fa=wn.imageName?$r.advance*wn.scale:Ya*wn.scale,Ka=String.fromCharCode(wn.glyph);_S(Ka)?Bo.x+=(1-Fr)*wn.scale:vS(Ka)?Bo.x+=Fa-$r.height*wn.scale+(-Fr-1)*wn.scale:Bo.x+=wn.imageName||$r.width+2*Fr===bo.w&&$r.height+2*Fr===bo.h?(Fa-Os)/2:(Fa-($r.height+2*Fr)*wn.scale)/2,da=new Z(Bo.x,Bo.y-Ls),Js=new Z(Bo.x+Os,Bo.y),Ns=new Z(Bo.x+Os,Bo.y-Ls)}else{const go=($r.left-Fr)*wn.scale-Gr+Eo[0],ka=(-$r.top-Fr)*wn.scale+Eo[1],Es=go+Ls,lu=ka+Os;Bo=new Z(go,ka),da=new Z(Es,ka),Js=new Z(go,lu),Ns=new Z(Es,lu)}if(en){let go;go=Ot?new Z(0,0):gs?new Z(ln[0],ln[1]):new Z(ut[0],ut[1]),Bo._rotateAround(en,go),da._rotateAround(en,go),Js._rotateAround(en,go),Ns._rotateAround(en,go)}const Si=new Z(0,0),Qs=new Z(0,0);Qt.push({tl:Bo,tr:da,bl:Js,br:Ns,tex:or,writingMode:ct.writingMode,glyphOffset:Fo,sectionIndex:wn.sectionIndex,isSDF:wi,pixelOffsetTL:Si,pixelOffsetBR:Qs,minFontScaleX:0,minFontScaleY:0})}}return Qt}(0,f,R,w,S,M,m,s.allowVerticalPlacement),nt=s.textSizeData;let $e=null;"source"===nt.kind?($e=[vc*w.layout.get("text-size").evaluate(M,{},Ce)],$e[0]>Ff&&cr(`${s.layerIds[0]}: Value for "text-size" is >= ${Dp}. Reduce your "text-size".`)):"composite"===nt.kind&&($e=[vc*K.compositeTextSizes[0].evaluate(M,{},Ce),vc*K.compositeTextSizes[1].evaluate(M,{},Ce)],($e[0]>Ff||$e[1]>Ff)&&cr(`${s.layerIds[0]}: Value for "text-size" is >= ${Dp}. Reduce your "text-size".`)),s.addSymbols(s.text,Ge,$e,R,S,M,z,i,u,L.lineStartIndex,L.lineLength,X,ue,Ce);for(const et of V)G[et]=s.text.placedSymbolArray.length-1;return 4*Ge.length}function Ap(s){for(const i in s)return s[i];return null}function qg(s,i,u,f,m,w,S,M,R,L){let z=S.top,V=S.bottom,G=S.left,X=S.right;const K=S.collisionPadding;if(K&&(G-=K[0],z-=K[1],X+=K[2],V+=K[3]),R){const ue=new Z(G,z),Ce=new Z(X,z),Ge=new Z(G,V),nt=new Z(X,V),$e=qe(R);let et=new Z(0,0);L&&(et=new Z(L[0],L[1])),ue._rotateAround($e,et),Ce._rotateAround($e,et),Ge._rotateAround($e,et),nt._rotateAround($e,et),G=Math.min(ue.x,Ce.x,Ge.x,nt.x),X=Math.max(ue.x,Ce.x,Ge.x,nt.x),z=Math.min(ue.y,Ce.y,Ge.y,nt.y),V=Math.max(ue.y,Ce.y,Ge.y,nt.y)}return s.emplaceBack(i.x,i.y,i.z,u.x,u.y,G,z,X,V,M,f,m,w),s.length-1}function Pp(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const i=s.bottom-s.top;return i>0?Math.max(10,i):null}function i_(s,i,u,f){const m=s.compareText;if(i in m){const w=m[i];for(let S=w.length-1;S>=0;S--)if(f.dist(w[S])<u)return!0}else m[i]=[];return m[i].push(f),!1}function Bd(s,i){const u=s.fovAboveCenter,f=s.elevation?s.elevation.getMinElevationBelowMSL()*i:0,m=(s._camera.position[2]*s.worldSize-f)/Math.cos(s._pitch),w=Math.sin(u)*m/Math.sin(Math.max(Math.PI/2-s._pitch-u,.01)),S=Math.sin(s._pitch)*w+m;return Math.min(1.01*S,m*(1/s._horizonShift))}function vh(s,i){if(!i.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:i};const u=Math.pow(2,-s.z),f=s.x*u,m=(s.x+1)*u,w=s.y*u,S=(s.y+1)*u,M=Yu(f),R=Yu(m),L=Ca(w),z=Ca(S),V=i.project(M,L),G=i.project(R,L),X=i.project(R,z),K=i.project(M,z);let ue=Math.min(V.x,G.x,X.x,K.x),Ce=Math.min(V.y,G.y,X.y,K.y),Ge=Math.max(V.x,G.x,X.x,K.x),nt=Math.max(V.y,G.y,X.y,K.y);const $e=u/16;function et(ut,Bt,Ot,Yt,yn,jt){const Qt=(Ot+yn)/2,en=(Yt+jt)/2,ln=i.project(Yu(Qt),Ca(en)),xn=Math.max(0,ue-ln.x,Ce-ln.y,ln.x-Ge,ln.y-nt);ue=Math.min(ue,ln.x),Ge=Math.max(Ge,ln.x),Ce=Math.min(Ce,ln.y),nt=Math.max(nt,ln.y),xn>$e&&(et(ut,ln,Ot,Yt,Qt,en),et(ln,Bt,Qt,en,yn,jt))}et(V,G,f,w,m,w),et(G,X,m,w,m,S),et(X,K,m,S,f,S),et(K,V,f,S,f,w),ue-=$e,Ce-=$e,Ge+=$e,nt+=$e;const ct=1/Math.max(Ge-ue,nt-Ce);return{scale:ct,x:ue*ct,y:Ce*ct,x2:Ge*ct,y2:nt*ct,projection:i}}const o_=rc(new Float32Array(16));class oc{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,u){return{x:0,y:0,z:0}}unproject(i,u){return new ko(0,0)}projectTilePoint(i,u,f){return{x:i,y:u,z:0}}locationPoint(i,u,f=!0){return i._coordinatePoint(i.locationCoordinate(u),f)}pixelsPerMeter(i,u){return yc(1,i)*u}pixelSpaceConversion(i,u,f){return 1}farthestPixelDistance(i){return Bd(i,i.pixelsPerMeter)}pointCoordinate(i,u,f,m){const w=i.horizonLineFromTop(!1),S=new Z(u,Math.max(w,f));return i.rayIntersectionCoordinate(i.pointRayIntersection(S,m))}pointCoordinate3D(i,u,f){const m=new Z(u,f);if(i.elevation)return i.elevation.pointCoordinate(m);{const w=this.pointCoordinate(i,m.x,m.y,0);return[w.x,w.y,w.z]}}isPointAboveHorizon(i,u){if(i.elevation)return!this.pointCoordinate3D(i,u.x,u.y);const f=i.horizonLineFromTop();return u.y<f}createInversionMatrix(i,u){return o_}createTileMatrix(i,u,f){let m,w,S;const M=f.canonical,R=rc(new Float64Array(16));if(this.isReprojectedInTileSpace){const L=vh(M,this);m=1,w=L.x+f.wrap*L.scale,S=L.y,Df(R,R,[m/L.scale,m/L.scale,i.pixelsPerMeter/u])}else m=u/i.zoomScale(M.z),w=(M.x+Math.pow(2,M.z)*f.wrap)*m,S=M.y*m;return lh(R,R,[w,S,0]),Df(R,R,[m/ar,m/ar,1]),R}upVector(i,u,f){return[0,0,1]}upVectorScale(i,u,f){return{metersToTile:1}}}class Hg extends oc{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[u,f]=this.parallels=i.parallels||[29.5,45.5],m=Math.sin(qe(u));this.n=(m+Math.sin(qe(f)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(i,u){const{n:f,c:m,r0:w}=this,S=qe(i-this.center[0]),M=qe(u),R=Math.sqrt(m-2*f*Math.sin(M))/f;return{x:R*Math.sin(S*f),y:R*Math.cos(S*f)-w,z:0}}unproject(i,u){const{n:f,c:m,r0:w}=this,S=w+u;let M=Math.atan2(i,Math.abs(S))*Math.sign(S);S*f<0&&(M-=Math.PI*Math.sign(i)*Math.sign(S));const R=qe(this.center[0])*f;M=Fe(M,-Math.PI-R,Math.PI-R);const L=De(Ue(M/f)+this.center[0],-180,180),z=Math.asin(De((m-(i*i+S*S)*f*f)/(2*f),-1,1)),V=De(Ue(z),-Sa,Sa);return new ko(L,V)}}const xh=1.340264,zd=-.081106,Bf=893e-6,nf=.003796,s_=Math.sqrt(3)/2;class a_ extends oc{project(i,u){u=u/180*Math.PI,i=i/180*Math.PI;const f=Math.asin(s_*Math.sin(u)),m=f*f,w=m*m*m;return{x:.5*(i*Math.cos(f)/(s_*(xh+3*zd*m+w*(7*Bf+9*nf*m)))/Math.PI+.5),y:1-.5*(f*(xh+zd*m+w*(Bf+nf*m))/Math.PI+1),z:0}}unproject(i,u){i=(2*i-.5)*Math.PI;let f=u=(2*(1-u)-1)*Math.PI,m=f*f,w=m*m*m;for(let z,V,G,X=0;X<12&&(V=f*(xh+zd*m+w*(Bf+nf*m))-u,G=xh+3*zd*m+w*(7*Bf+9*nf*m),z=V/G,f=De(f-z,-Math.PI/3,Math.PI/3),m=f*f,w=m*m*m,!(Math.abs(z)<1e-12));++X);const S=s_*i*(xh+3*zd*m+w*(7*Bf+9*nf*m))/Math.cos(f),M=Math.asin(Math.sin(f)/s_),R=De(180*S/Math.PI,-180,180),L=De(180*M/Math.PI,-Sa,Sa);return new ko(R,L)}}class u_ extends oc{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,u){return{x:.5+i/360,y:.5-u/360,z:0}}unproject(i,u){const f=360*(i-.5),m=De(360*(.5-u),-Sa,Sa);return new ko(f,m)}}const zf=Math.PI/2;function Wg(s){return Math.tan((zf+s)/2)}class Iw extends oc{constructor(i){super(i),this.center=i.center||[0,30];const[u,f]=this.parallels=i.parallels||[30,30];let m=qe(u),w=qe(f);this.southernCenter=m+w<0,this.southernCenter&&(m=-m,w=-w);const S=Math.cos(m),M=Wg(m);this.n=m===w?Math.sin(m):Math.log(S/Math.cos(w))/Math.log(Wg(w)/M),this.f=S*Math.pow(Wg(m),this.n)/this.n}project(i,u){u=qe(u),this.southernCenter&&(u=-u),i=qe(i-this.center[0]);const f=1e-6,{n:m,f:w}=this;w>0?u<-zf+f&&(u=-zf+f):u>zf-f&&(u=zf-f);const S=w/Math.pow(Wg(u),m);let M=S*Math.sin(m*i),R=w-S*Math.cos(m*i);return M=.5*(M/Math.PI+.5),R=.5*(R/Math.PI+.5),{x:M,y:this.southernCenter?R:1-R,z:0}}unproject(i,u){i=(2*i-.5)*Math.PI,this.southernCenter&&(u=1-u),u=(2*(1-u)-.5)*Math.PI;const{n:f,f:m}=this,w=m-u,S=Math.sign(w),M=Math.sign(f)*Math.sqrt(i*i+w*w);let R=Math.atan2(i,Math.abs(w))*S;w*f<0&&(R-=Math.PI*Math.sign(i)*S);const L=De(Ue(R/f)+this.center[0],-180,180),z=De(Ue(2*Math.atan(Math.pow(m/M,1/f))-zf),-Sa,Sa);return new ko(L,this.southernCenter?-z:z)}}class l_ extends oc{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,u){return{x:zc(i),y:Uc(u),z:0}}unproject(i,u){const f=Yu(i),m=Ca(u);return new ko(f,m)}}const c_=qe(Sa);class Tw extends oc{project(i,u){const f=(u=qe(u))*u,m=f*f;return{x:.5*((i=qe(i))*(.8707-.131979*f+m*(m*(.003971*f-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(u*(1.007226+f*(.015085+m*(.028874*f-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(i,u){i=(2*i-.5)*Math.PI;let f=u=(2*(1-u)-1)*Math.PI,m=25,w=0,S=f*f;do{S=f*f;const L=S*S;w=(f*(1.007226+S*(.015085+L*(.028874*S-.044475-.005916*L)))-u)/(1.007226+S*(.045255+L*(.259866*S-.311325-.005916*11*L))),f=De(f-w,-c_,c_)}while(Math.abs(w)>1e-6&&--m>0);S=f*f;const M=De(Ue(i/(.8707+S*(S*(S*S*S*(.003971-.001529*S)-.013791)-.131979))),-180,180),R=Ue(f);return new ko(M,R)}}const R0=qe(Sa);class TS extends oc{project(i,u){u=qe(u),i=qe(i);const f=Math.cos(u),m=2/Math.PI,w=Math.acos(f*Math.cos(i/2)),S=Math.sin(w)/w,M=.5*(i*m+2*f*Math.sin(i/2)/S)||0,R=.5*(u+Math.sin(u)/S)||0;return{x:.5*(M/Math.PI+.5),y:1-.5*(R/Math.PI+1),z:0}}unproject(i,u){let f=i=(2*i-.5)*Math.PI,m=u=(2*(1-u)-1)*Math.PI,w=25;const S=1e-6;let M=0,R=0;do{const L=Math.cos(m),z=Math.sin(m),V=2*z*L,G=z*z,X=L*L,K=Math.cos(f/2),ue=Math.sin(f/2),Ce=2*K*ue,Ge=ue*ue,nt=1-X*K*K,$e=nt?1/nt:0,et=nt?Math.acos(L*K)*Math.sqrt(1/nt):0,ct=.5*(2*et*L*ue+2*f/Math.PI)-i,ut=.5*(et*z+m)-u,Bt=.5*$e*(X*Ge+et*L*K*G)+1/Math.PI,Ot=$e*(Ce*V/4-et*z*ue),Yt=.125*$e*(V*ue-et*z*X*Ce),yn=.5*$e*(G*K+et*Ge*L)+.5,jt=Ot*Yt-yn*Bt;M=(ut*Ot-ct*yn)/jt,R=(ct*Yt-ut*Bt)/jt,f=De(f-M,-Math.PI,Math.PI),m=De(m-R,-R0,R0)}while((Math.abs(M)>S||Math.abs(R)>S)&&--w>0);return new ko(Ue(f),Ue(m))}}class L0 extends oc{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(qe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,u){const{scale:f,cosPhi:m}=this;return{x:qe(i)*m*f+.5,y:-Math.sin(qe(u))/m*f+.5,z:0}}unproject(i,u){const{scale:f,cosPhi:m}=this,w=-(u-.5)/f,S=De(Ue((i-.5)/f)/m,-180,180),M=Math.asin(De(w*m,-1,1)),R=De(Ue(M),-Sa,Sa);return new ko(S,R)}}class h_ extends l_{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,u,f){const m=Bu(i,u,f);return ds(m,m,Xh(fh(f))),{x:m[0],y:m[1],z:m[2]}}locationPoint(i,u){const f=md(u.lat,u.lng),m=Fu([],f),w=i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(u),i._centerAltitude):i._centerAltitude;cd(f,f,m,yc(1,0)*ar*w);const S=rc(new Float64Array(16));return ic(S,i.pixelMatrix,i.globeMatrix),ds(f,f,S),new Z(f[0],f[1])}pixelsPerMeter(i,u){return yc(1,0)*u}pixelSpaceConversion(i,u,f){const m=yc(1,i)*u,w=In(yc(1,45)*u,m,f);return this.pixelsPerMeter(i,u)/w}createTileMatrix(i,u,f){const m=Lf(fh(f.canonical));return ic(new Float64Array(16),i.globeMatrix,m)}createInversionMatrix(i,u){const{center:f}=i,m=Xh(fh(u));return ad(m,m,qe(f.lng)),Bv(m,m,qe(f.lat)),Df(m,m,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(i,u,f,m){return Xx(i,u,f,!0)||new dh(0,0)}pointCoordinate3D(i,u,f){const m=this.pointCoordinate(i,u,f,0);return[m.x,m.y,m.z]}isPointAboveHorizon(i,u){return!Xx(i,u.x,u.y,!1)}farthestPixelDistance(i){const u=function(m,w){const S=m.cameraToCenterDistance,M=m._centerAltitude*w,R=m._camera,L=m._camera.forward(),z=hh([],hl([],L,-S),[0,0,M]),V=m.worldSize/(2*Math.PI),G=[0,0,-V],X=m.width/m.height,K=Math.tan(m.fovAboveCenter),ue=hl([],R.up(),K),Ce=hl([],R.right(),K*X),Ge=Fu([],hh([],hh([],L,ue),Ce)),nt=[];let $e;if(new ag(z,Ge).closestPointOnSphere(G,V,nt)){const et=hh([],nt,G),ct=Fl([],et,z);$e=Math.cos(m.fovAboveCenter)*ud(ct)}else{const et=Fl([],z,G),ct=Fl([],G,z);Fu(ct,ct);const ut=ud(et)-V;$e=Math.sqrt(ut*(ut+2*V));const Bt=Math.acos($e/(V+ut))-Math.acos(Ea(L,ct));$e*=Math.cos(Bt)}return 1.01*$e}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),f=cp(i.zoom);if(f>0){const m=Bd(i,yc(1,i.center.lat)*i.worldSize),w=i.worldSize/(2*Math.PI),S=Math.max(i.width,i.height)/i.worldSize*Math.PI;return In(u,m+w*(1-Math.cos(S)),Math.pow(f,10))}return u}upVector(i,u,f){return Bu(u,f,i,1)}upVectorScale(i){return{metersToTile:uy(Wh(fh(i)))}}}function Xg(s){const i=s.parallels,u=!!i&&Math.abs(i[0]+i[1])<.01;switch(s.name){case"mercator":return new l_(s);case"equirectangular":return new u_(s);case"naturalEarth":return new Tw(s);case"equalEarth":return new a_(s);case"winkelTripel":return new TS(s);case"albers":return u?new L0(s):new Hg(s);case"lambertConformalConic":return u?new L0(s):new Iw(s);case"globe":return new h_(s)}throw new Error(`Invalid projection name: ${s.name}`)}const Mw=vp.types,O0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ud(s,i,u,f,m,w,S,M,R,L,z,V,G){const X=M?Math.min(Ff,Math.round(M[0])):0,K=M?Math.min(Ff,Math.round(M[1])):0;s.emplaceBack(i,u,Math.round(32*f),Math.round(32*m),w,S,(X<<1)+(R?1:0),K,16*L,16*z,256*V,256*G)}function Uf(s,i,u,f,m,w,S){s.emplaceBack(i,u,f,m,w,S)}function Zg(s,i,u,f,m){s.emplaceBack(i,u,f,m),s.emplaceBack(i,u,f,m),s.emplaceBack(i,u,f,m),s.emplaceBack(i,u,f,m)}function N0(s){for(const i of s.sections)if(ip(i.text))return!0;return!1}class f_{constructor(i){this.layoutVertexArray=new on,this.indexArray=new Jn,this.programConfigurations=i,this.segments=new Zo,this.dynamicLayoutVertexArray=new dn,this.opacityVertexArray=new nr,this.placedSymbolArray=new Sr,this.globeExtVertexArray=new vn}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(i,u,f,m){this.isEmpty()||(f&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,d0.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,g0.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,O0,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,p0.members,!0)),this.opacityVertexBuffer.itemSize=1),(f||m)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Sn(f_,"SymbolBuffers");class Yg{constructor(i,u,f){this.layoutVertexArray=new i,this.layoutAttributes=u,this.indexArray=new f,this.segments=new Zo,this.collisionVertexArray=new Rn,this.collisionVertexArrayExt=new ei}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,m0.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,mw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Sn(Yg,"CollisionBuffers");class Vf{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(S=>S.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=rc([]),this.placementViewportMatrix=rc([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=jc(this.zoom,u["text-size"]),this.iconSizeData=jc(this.zoom,u["icon-size"]);const f=this.layers[0].layout,m=f.get("symbol-sort-key"),w=f.get("symbol-z-order");this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==w&&void 0!==m.constantOr(1),this.sortFeaturesByY=("viewport-y"===w||"auto"===w&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=f.get("text-writing-mode").map(S=>ml[S]),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.sourceID=i.sourceID,this.projection=i.projection}createArrays(){this.text=new f_(new ba(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new f_(new ba(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new No,this.lineVertexArray=new Sf,this.symbolInstances=new rs}calculateGlyphDependencies(i,u,f,m,w){for(let S=0;S<i.length;S++)if(u[i.charCodeAt(S)]=!0,m&&w){const M=Rg[i.charAt(S)];M&&(u[M.charCodeAt(0)]=!0)}}populate(i,u,f,m){const w=this.layers[0],S=w.layout,M="globe"===this.projection.name,R=S.get("text-font"),L=S.get("text-field"),z=S.get("icon-image"),V=("constant"!==L.value.kind||L.value.value instanceof es&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&("constant"!==R.value.kind||R.value.value.length>0),G="constant"!==z.value.kind||!!z.value.value||Object.keys(z.parameters).length>0,X=S.get("symbol-sort-key");if(this.features=[],!V&&!G)return;const K=u.iconDependencies,ue=u.glyphDependencies,Ce=u.availableImages,Ge=new U(this.zoom);for(const{feature:nt,id:$e,index:et,sourceLayerIndex:ct}of i){const ut=w._featureFilter.needGeometry,Bt=_c(nt,ut);if(!w._featureFilter.filter(Ge,Bt,f))continue;if(ut||(Bt.geometry=dl(nt,f,m)),M&&1!==nt.type&&f.z<=5){const jt=Bt.geometry,Qt=.98078528056,en=(ln,xn)=>Ea(Bu(ln.x,ln.y,f,1),Bu(xn.x,xn.y,f,1))<Qt;for(let ln=0;ln<jt.length;ln++)jt[ln]=lg(jt[ln],en)}let Ot,Yt;if(V){const jt=w.getValueAndResolveTokens("text-field",Bt,f,Ce),Qt=es.factory(jt);N0(Qt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===A()||this.hasRTLText&&k.isParsed())&&(Ot=yS(Qt,w,Bt))}if(G){const jt=w.getValueAndResolveTokens("icon-image",Bt,f,Ce);Yt=jt instanceof Kr?jt:Kr.fromString(jt)}if(!Ot&&!Yt)continue;const yn=this.sortFeaturesByKey?X.evaluate(Bt,{},f):void 0;if(this.features.push({id:$e,text:Ot,icon:Yt,index:et,sourceLayerIndex:ct,geometry:Bt.geometry,properties:nt.properties,type:Mw[nt.type],sortKey:yn}),Yt&&(K[Yt.name]=!0),Ot){const jt=R.evaluate(Bt,{},f).join(","),Qt="map"===S.get("text-rotation-alignment")&&"point"!==S.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ml.vertical)>=0;for(const en of Ot.sections)if(en.image)K[en.image.name]=!0;else{const ln=Kp(Ot.toString()),xn=en.fontStack||jt,Xt=ue[xn]=ue[xn]||{};this.calculateGlyphDependencies(en.text,Xt,Qt,this.allowVerticalPlacement,ln)}}}"line"===S.get("symbol-placement")&&(this.features=function(nt){const $e={},et={},ct=[];let ut=0;function Bt(jt){ct.push(nt[jt]),ut++}function Ot(jt,Qt,en){const ln=et[jt];return delete et[jt],et[Qt]=ln,ct[ln].geometry[0].pop(),ct[ln].geometry[0]=ct[ln].geometry[0].concat(en[0]),ln}function Yt(jt,Qt,en){const ln=$e[Qt];return delete $e[Qt],$e[jt]=ln,ct[ln].geometry[0].shift(),ct[ln].geometry[0]=en[0].concat(ct[ln].geometry[0]),ln}function yn(jt,Qt,en){const ln=en?Qt[0][Qt[0].length-1]:Qt[0][0];return`${jt}:${ln.x}:${ln.y}`}for(let jt=0;jt<nt.length;jt++){const Qt=nt[jt],en=Qt.geometry,ln=Qt.text?Qt.text.toString():null;if(!ln){Bt(jt);continue}const xn=yn(ln,en),Xt=yn(ln,en,!0);if(xn in et&&Xt in $e&&et[xn]!==$e[Xt]){const Ln=Yt(xn,Xt,en),Fn=Ot(xn,Xt,ct[Ln].geometry);delete $e[xn],delete et[Xt],et[yn(ln,ct[Fn].geometry,!0)]=Fn,ct[Ln].geometry=null}else xn in et?Ot(xn,Xt,en):Xt in $e?Yt(xn,Xt,en):(Bt(jt),$e[xn]=ut-1,et[Xt]=ut-1)}return ct.filter(jt=>jt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((nt,$e)=>nt.sortKey-$e.sortKey)}update(i,u,f,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,u,this.layers,f,m),this.icon.programConfigurations.updatePaintArrays(i,u,this.layers,f,m))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Xg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,u){const f=this.lineVertexArray.length;if(void 0!==i.segment)for(const{x:m,y:w}of u)this.lineVertexArray.emplaceBack(m,w);return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(i,u,f,m,w,S,M,R,L,z,V,G,X,K){const ue=i.indexArray,Ce=i.layoutVertexArray,Ge=i.globeExtVertexArray,nt=i.segments.prepareSegment(4*u.length,Ce,ue,this.canOverlap?S.sortKey:void 0),$e=this.glyphOffsetArray.length,et=nt.vertexLength,ct=this.allowVerticalPlacement&&M===ml.vertical?Math.PI/2:0,ut=S.text&&S.text.sections;for(let Ot=0;Ot<u.length;Ot++){const{tl:Yt,tr:yn,bl:jt,br:Qt,tex:en,pixelOffsetTL:ln,pixelOffsetBR:xn,minFontScaleX:Xt,minFontScaleY:Ln,glyphOffset:Fn,isSDF:On,sectionIndex:jr}=u[Ot],wn=nt.vertexLength,or=Fn[1];if(Ud(Ce,L.x,L.y,Yt.x,or+Yt.y,en.x,en.y,f,On,ln.x,ln.y,Xt,Ln),Ud(Ce,L.x,L.y,yn.x,or+yn.y,en.x+en.w,en.y,f,On,xn.x,ln.y,Xt,Ln),Ud(Ce,L.x,L.y,jt.x,or+jt.y,en.x,en.y+en.h,f,On,ln.x,xn.y,Xt,Ln),Ud(Ce,L.x,L.y,Qt.x,or+Qt.y,en.x+en.w,en.y+en.h,f,On,xn.x,xn.y,Xt,Ln),R){const{x:Fr,y:wi,z:Pr}=R.anchor,[dr,is,Gr]=R.up;Uf(Ge,Fr,wi,Pr,dr,is,Gr),Uf(Ge,Fr,wi,Pr,dr,is,Gr),Uf(Ge,Fr,wi,Pr,dr,is,Gr),Uf(Ge,Fr,wi,Pr,dr,is,Gr),Zg(i.dynamicLayoutVertexArray,Fr,wi,Pr,ct)}else Zg(i.dynamicLayoutVertexArray,L.x,L.y,L.z,ct);ue.emplaceBack(wn,wn+1,wn+2),ue.emplaceBack(wn+1,wn+2,wn+3),nt.vertexLength+=4,nt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Fn[0]),Ot!==u.length-1&&jr===u[Ot+1].sectionIndex||i.programConfigurations.populatePaintArrays(Ce.length,S,S.index,{},X,K,ut&&ut[jr])}const Bt=R?R.anchor:L;i.placedSymbolArray.emplaceBack(Bt.x,Bt.y,Bt.z,L.x,L.y,$e,this.glyphOffsetArray.length-$e,et,z,V,L.segment,f?f[0]:0,f?f[1]:0,m[0],m[1],M,0,!1,0,G,0)}_commitLayoutVertex(i,u,f,m,w,S,M){i.emplaceBack(u,f,m,w,S,Math.round(M.x),Math.round(M.y))}_addCollisionDebugVertices(i,u,f,m,w,S,M){const R=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),L=R.vertexLength,z=M.tileAnchorX,V=M.tileAnchorY;for(let X=0;X<4;X++)f.collisionVertexArray.emplaceBack(0,0,0,0);f.collisionVertexArrayExt.emplaceBack(u,-i.padding,-i.padding),f.collisionVertexArrayExt.emplaceBack(u,i.padding,-i.padding),f.collisionVertexArrayExt.emplaceBack(u,i.padding,i.padding),f.collisionVertexArrayExt.emplaceBack(u,-i.padding,i.padding),this._commitLayoutVertex(f.layoutVertexArray,m,w,S,z,V,new Z(i.x1,i.y1)),this._commitLayoutVertex(f.layoutVertexArray,m,w,S,z,V,new Z(i.x2,i.y1)),this._commitLayoutVertex(f.layoutVertexArray,m,w,S,z,V,new Z(i.x2,i.y2)),this._commitLayoutVertex(f.layoutVertexArray,m,w,S,z,V,new Z(i.x1,i.y2)),R.vertexLength+=4;const G=f.indexArray;G.emplaceBack(L,L+1),G.emplaceBack(L+1,L+2),G.emplaceBack(L+2,L+3),G.emplaceBack(L+3,L),R.primitiveLength+=4}_addTextDebugCollisionBoxes(i,u,f,m,w,S){for(let M=m;M<w;M++){const R=f.get(M),L=this.getSymbolInstanceTextSize(i,S,u,M);this._addCollisionDebugVertices(R,L,this.textCollisionBox,R.projectedAnchorX,R.projectedAnchorY,R.projectedAnchorZ,S)}}_addIconDebugCollisionBoxes(i,u,f,m,w,S){for(let M=m;M<w;M++){const R=f.get(M),L=this.getSymbolInstanceIconSize(i,u,S.placedIconSymbolIndex);this._addCollisionDebugVertices(R,L,this.iconCollisionBox,R.projectedAnchorX,R.projectedAnchorY,R.projectedAnchorZ,S)}}generateCollisionDebugBuffers(i,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Yg(jn,y0.members,Na),this.iconCollisionBox=new Yg(jn,y0.members,Na);const f=Pd(this.iconSizeData,i),m=Pd(this.textSizeData,i);for(let w=0;w<this.symbolInstances.length;w++){const S=this.symbolInstances.get(w);this._addTextDebugCollisionBoxes(m,i,u,S.textBoxStartIndex,S.textBoxEndIndex,S),this._addTextDebugCollisionBoxes(m,i,u,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S),this._addIconDebugCollisionBoxes(f,i,u,S.iconBoxStartIndex,S.iconBoxEndIndex,S),this._addIconDebugCollisionBoxes(f,i,u,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S)}}getSymbolInstanceTextSize(i,u,f,m){const w=this.text.placedSymbolArray.get(u.rightJustifiedTextSymbolIndex>=0?u.rightJustifiedTextSymbolIndex:u.centerJustifiedTextSymbolIndex>=0?u.centerJustifiedTextSymbolIndex:u.leftJustifiedTextSymbolIndex>=0?u.leftJustifiedTextSymbolIndex:u.verticalPlacedTextSymbolIndex>=0?u.verticalPlacedTextSymbolIndex:m),S=Qh(this.textSizeData,i,w)/Ya;return this.tilePixelRatio*S}getSymbolInstanceIconSize(i,u,f){const m=this.icon.placedSymbolArray.get(f),w=Qh(this.iconSizeData,i,m);return this.tilePixelRatio*w}_commitDebugCollisionVertexUpdate(i,u,f){i.emplaceBack(u,-f,-f),i.emplaceBack(u,f,-f),i.emplaceBack(u,f,f),i.emplaceBack(u,-f,f)}_updateTextDebugCollisionBoxes(i,u,f,m,w,S){for(let M=m;M<w;M++){const R=f.get(M),L=this.getSymbolInstanceTextSize(i,S,u,M);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,L,R.padding)}}_updateIconDebugCollisionBoxes(i,u,f,m,w,S){for(let M=m;M<w;M++){const R=f.get(M),L=this.getSymbolInstanceIconSize(i,u,S);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,L,R.padding)}}updateCollisionDebugBuffers(i,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=Pd(this.iconSizeData,i),m=Pd(this.textSizeData,i);for(let w=0;w<this.symbolInstances.length;w++){const S=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(m,i,u,S.textBoxStartIndex,S.textBoxEndIndex,S),this._updateTextDebugCollisionBoxes(m,i,u,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S),this._updateIconDebugCollisionBoxes(f,i,u,S.iconBoxStartIndex,S.iconBoxEndIndex,S.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(f,i,u,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,u,f,m,w,S,M,R,L){const z={};if(u<f){const{x1:V,y1:G,x2:X,y2:K,padding:ue,projectedAnchorX:Ce,projectedAnchorY:Ge,projectedAnchorZ:nt,tileAnchorX:$e,tileAnchorY:et,featureIndex:ct}=i.get(u);z.textBox={x1:V,y1:G,x2:X,y2:K,padding:ue,projectedAnchorX:Ce,projectedAnchorY:Ge,projectedAnchorZ:nt,tileAnchorX:$e,tileAnchorY:et},z.textFeatureIndex=ct}if(m<w){const{x1:V,y1:G,x2:X,y2:K,padding:ue,projectedAnchorX:Ce,projectedAnchorY:Ge,projectedAnchorZ:nt,tileAnchorX:$e,tileAnchorY:et,featureIndex:ct}=i.get(m);z.verticalTextBox={x1:V,y1:G,x2:X,y2:K,padding:ue,projectedAnchorX:Ce,projectedAnchorY:Ge,projectedAnchorZ:nt,tileAnchorX:$e,tileAnchorY:et},z.verticalTextFeatureIndex=ct}if(S<M){const{x1:V,y1:G,x2:X,y2:K,padding:ue,projectedAnchorX:Ce,projectedAnchorY:Ge,projectedAnchorZ:nt,tileAnchorX:$e,tileAnchorY:et,featureIndex:ct}=i.get(S);z.iconBox={x1:V,y1:G,x2:X,y2:K,padding:ue,projectedAnchorX:Ce,projectedAnchorY:Ge,projectedAnchorZ:nt,tileAnchorX:$e,tileAnchorY:et},z.iconFeatureIndex=ct}if(R<L){const{x1:V,y1:G,x2:X,y2:K,padding:ue,projectedAnchorX:Ce,projectedAnchorY:Ge,projectedAnchorZ:nt,tileAnchorX:$e,tileAnchorY:et,featureIndex:ct}=i.get(R);z.verticalIconBox={x1:V,y1:G,x2:X,y2:K,padding:ue,projectedAnchorX:Ce,projectedAnchorY:Ge,projectedAnchorZ:nt,tileAnchorX:$e,tileAnchorY:et},z.verticalIconFeatureIndex=ct}return z}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,u){const f=i.placedSymbolArray.get(u),m=f.vertexStartIndex+4*f.numGlyphs;for(let w=f.vertexStartIndex;w<m;w+=4)i.indexArray.emplaceBack(w,w+1,w+2),i.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const u=Math.sin(i),f=Math.cos(i),m=[],w=[],S=[];for(let M=0;M<this.symbolInstances.length;++M){S.push(M);const R=this.symbolInstances.get(M);m.push(0|Math.round(u*R.tileAnchorX+f*R.tileAnchorY)),w.push(R.featureIndex)}return S.sort((M,R)=>m[M]-m[R]||w[R]-w[M]),S}addToSortKeyRanges(i,u){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const f=this.symbolInstances.get(u);this.featureSortOrder.push(f.featureIndex);const{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:w,leftJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:M,placedIconSymbolIndex:R,verticalPlacedIconSymbolIndex:L}=f;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),w>=0&&w!==m&&this.addIndicesForPlacedSymbol(this.text,w),S>=0&&S!==w&&S!==m&&this.addIndicesForPlacedSymbol(this.text,S),M>=0&&this.addIndicesForPlacedSymbol(this.text,M),R>=0&&this.addIndicesForPlacedSymbol(this.icon,R),L>=0&&this.addIndicesForPlacedSymbol(this.icon,L)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Sn(Vf,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Vf.MAX_GLYPHS=65535,Vf.addDynamicAttributes=Zg;const Dw=new He({"symbol-placement":new oe(Ht.layout_symbol["symbol-placement"]),"symbol-spacing":new oe(Ht.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new oe(Ht.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Pe(Ht.layout_symbol["symbol-sort-key"]),"symbol-z-order":new oe(Ht.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new oe(Ht.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new oe(Ht.layout_symbol["icon-ignore-placement"]),"icon-optional":new oe(Ht.layout_symbol["icon-optional"]),"icon-rotation-alignment":new oe(Ht.layout_symbol["icon-rotation-alignment"]),"icon-size":new Pe(Ht.layout_symbol["icon-size"]),"icon-text-fit":new oe(Ht.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new oe(Ht.layout_symbol["icon-text-fit-padding"]),"icon-image":new Pe(Ht.layout_symbol["icon-image"]),"icon-rotate":new Pe(Ht.layout_symbol["icon-rotate"]),"icon-padding":new oe(Ht.layout_symbol["icon-padding"]),"icon-keep-upright":new oe(Ht.layout_symbol["icon-keep-upright"]),"icon-offset":new Pe(Ht.layout_symbol["icon-offset"]),"icon-anchor":new Pe(Ht.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new oe(Ht.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new oe(Ht.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new oe(Ht.layout_symbol["text-rotation-alignment"]),"text-field":new Pe(Ht.layout_symbol["text-field"]),"text-font":new Pe(Ht.layout_symbol["text-font"]),"text-size":new Pe(Ht.layout_symbol["text-size"]),"text-max-width":new Pe(Ht.layout_symbol["text-max-width"]),"text-line-height":new Pe(Ht.layout_symbol["text-line-height"]),"text-letter-spacing":new Pe(Ht.layout_symbol["text-letter-spacing"]),"text-justify":new Pe(Ht.layout_symbol["text-justify"]),"text-radial-offset":new Pe(Ht.layout_symbol["text-radial-offset"]),"text-variable-anchor":new oe(Ht.layout_symbol["text-variable-anchor"]),"text-anchor":new Pe(Ht.layout_symbol["text-anchor"]),"text-max-angle":new oe(Ht.layout_symbol["text-max-angle"]),"text-writing-mode":new oe(Ht.layout_symbol["text-writing-mode"]),"text-rotate":new Pe(Ht.layout_symbol["text-rotate"]),"text-padding":new oe(Ht.layout_symbol["text-padding"]),"text-keep-upright":new oe(Ht.layout_symbol["text-keep-upright"]),"text-transform":new Pe(Ht.layout_symbol["text-transform"]),"text-offset":new Pe(Ht.layout_symbol["text-offset"]),"text-allow-overlap":new oe(Ht.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new oe(Ht.layout_symbol["text-ignore-placement"]),"text-optional":new oe(Ht.layout_symbol["text-optional"])});var Vd={paint:new He({"icon-opacity":new Pe(Ht.paint_symbol["icon-opacity"]),"icon-color":new Pe(Ht.paint_symbol["icon-color"]),"icon-halo-color":new Pe(Ht.paint_symbol["icon-halo-color"]),"icon-halo-width":new Pe(Ht.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Pe(Ht.paint_symbol["icon-halo-blur"]),"icon-translate":new oe(Ht.paint_symbol["icon-translate"]),"icon-translate-anchor":new oe(Ht.paint_symbol["icon-translate-anchor"]),"text-opacity":new Pe(Ht.paint_symbol["text-opacity"]),"text-color":new Pe(Ht.paint_symbol["text-color"],{runtimeType:Va,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Pe(Ht.paint_symbol["text-halo-color"]),"text-halo-width":new Pe(Ht.paint_symbol["text-halo-width"]),"text-halo-blur":new Pe(Ht.paint_symbol["text-halo-blur"]),"text-translate":new oe(Ht.paint_symbol["text-translate"]),"text-translate-anchor":new oe(Ht.paint_symbol["text-translate-anchor"])}),layout:Dw};class k0{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Wl,this.defaultValue=i}evaluate(i){if(i.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(i.formattedSection))return u.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Sn(k0,"FormatSectionOverride",{omit:["defaultValue"]});class wh extends nc{constructor(i){super(i,Vd)}recalculate(i,u){super.recalculate(i,u),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const f=this.layout.get("text-writing-mode");if(f){const m=[];for(const w of f)m.indexOf(w)<0&&m.push(w);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(i,u,f,m){const w=this.layout.get(i).evaluate(u,{},f,m),S=this._unevaluatedLayout._values[i];return S.isDataDriven()||Kn(S.value)||!w?w:(M=u.properties,w.replace(/{([^{}]+)}/g,(L,z)=>z in M?String(M[z]):""));var M}createBucket(i){return new Vf(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of Vd.paint.overridableProperties){if(!wh.hasPaintOverride(this.layout,i))continue;const u=this.paint.get(i),f=new k0(u),m=new Xu(f,u.property.specification);let w=null;w="constant"===u.value.kind||"source"===u.value.kind?new Lc("source",m):new Pa("composite",m,u.value.zoomStops,u.value._interpolationType),this.paint._values[i]=new Ne(u.property,w,u.parameters)}}_handleOverridablePaintPropertyUpdate(i,u,f){return!(!this.layout||u.isDataDriven()||f.isDataDriven())&&wh.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,u){const f=i.get("text-field"),m=Vd.paint.properties[u];let w=!1;const S=M=>{for(const R of M)if(m.overrides&&m.overrides.hasOverride(R))return void(w=!0)};if("constant"===f.value.kind&&f.value.value instanceof es)S(f.value.value.sections);else if("source"===f.value.kind){const M=L=>{w||(L instanceof xs&&ss(L.value)===nl?S(L.value.sections):L instanceof Jr?S(L.sections):L.eachChild(M))},R=f.value;R._styleExpression&&M(R._styleExpression.expression)}return w}getProgramConfiguration(i){return new jh(this,i)}}var rf={paint:new He({"background-color":new oe(Ht.paint_background["background-color"]),"background-pattern":new oe(Ht.paint_background["background-pattern"]),"background-opacity":new oe(Ht.paint_background["background-opacity"])})},Aw={paint:new He({"raster-opacity":new oe(Ht.paint_raster["raster-opacity"]),"raster-hue-rotate":new oe(Ht.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new oe(Ht.paint_raster["raster-brightness-min"]),"raster-brightness-max":new oe(Ht.paint_raster["raster-brightness-max"]),"raster-saturation":new oe(Ht.paint_raster["raster-saturation"]),"raster-contrast":new oe(Ht.paint_raster["raster-contrast"]),"raster-resampling":new oe(Ht.paint_raster["raster-resampling"]),"raster-fade-duration":new oe(Ht.paint_raster["raster-fade-duration"])})};class F0 extends nc{constructor(i){super(i,{}),this.implementation=i}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var Kg={paint:new He({"sky-type":new oe(Ht.paint_sky["sky-type"]),"sky-atmosphere-sun":new oe(Ht.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new oe(Ht.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new oe(Ht.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new oe(Ht.paint_sky["sky-gradient-radius"]),"sky-gradient":new Xe(Ht.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new oe(Ht.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new oe(Ht.paint_sky["sky-atmosphere-color"]),"sky-opacity":new oe(Ht.paint_sky["sky-opacity"])})};function d_(s,i,u){const f=[0,0,1],m=Vv([]);return qh(m,m,u?-qe(s)+Math.PI:qe(s)),ap(m,m,-qe(i)),sg(f,f,m),Fu(f,f)}const Pw={circle:class extends nc{constructor(s){super(s,xy)}createBucket(s){return new fg(s)}queryRadius(s){const i=s;return vd("circle-radius",this,i)+vd("circle-stroke-width",this,i)+gg(this.paint.get("circle-translate"))}queryIntersectsFeature(s,i,u,f,m,w,S,M){const R=Jx(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,s.pixelToTileUnitsFactor),L=this.paint.get("circle-radius").evaluate(i,u)+this.paint.get("circle-stroke-width").evaluate(i,u);return Qx(s,f,w,S,M,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),R,L)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new jh(this,s)}},heatmap:class extends nc{createBucket(s){return new Qv(s)}constructor(s){super(s,xd),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"heatmap-color"===s&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return vd("heatmap-radius",this,s)}queryIntersectsFeature(s,i,u,f,m,w,S,M){const R=this.paint.get("heatmap-radius").evaluate(i,u);return Qx(s,f,w,S,M,!0,!0,new Z(0,0),R)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new jh(this,s)}},hillshade:class extends nc{constructor(s){super(s,xg)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends nc{constructor(s){super(s,s0)}getProgramIds(){const s=this.paint.get("fill-pattern"),i=s&&s.constantOr(1),u=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&u.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),u}getProgramConfiguration(s){return new jh(this,s)}recalculate(s,i){super.recalculate(s,i);const u=this.paint._values["fill-outline-color"];"constant"===u.value.kind&&void 0===u.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new gh(s)}queryRadius(){return gg(this.paint.get("fill-translate"))}queryIntersectsFeature(s,i,u,f,m,w){return!s.queryGeometry.isAboveHorizon&&Kv(mg(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,s.pixelToTileUnitsFactor),f)}isTileClipped(){return!0}},"fill-extrusion":class extends nc{constructor(s){super(s,Fy)}createBucket(s){return new Ed(s)}queryRadius(){return gg(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new jh(this,s)}queryIntersectsFeature(s,i,u,f,m,w,S,M,R){const L=Jx(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,s.pixelToTileUnitsFactor),z=this.paint.get("fill-extrusion-height").evaluate(i,u),V=this.paint.get("fill-extrusion-base").evaluate(i,u),G=[0,0],X=M&&w.elevation,K=w.elevation?w.elevation.exaggeration():1,ue=s.tile.getBucket(this);if(X&&ue instanceof Ed){const et=ue.centroidVertexArray,ct=R+1;ct<et.length&&(G[0]=et.geta_centroid_pos0(ct),G[1]=et.geta_centroid_pos1(ct))}if(0===G[0]&&1===G[1])return!1;"globe"===w.projection.name&&(f=Ep([f],[new Z(0,0),new Z(ar,ar)],s.tileID.canonical).map(et=>et.polygon).flat());const Ce=X?M:null,[Ge,nt]=(ct=f,ut=V,Bt=z,Ot=L,Yt=S,yn=Ce,jt=G,Qt=K,en=w.center.lat,"globe"===(et=w).projection.name?function(xn,Xt,Ln,Fn,On,jr,wn,or,Fr,wi,Pr){const dr=[],is=[],Gr=xn.projection.upVectorScale(Pr,xn.center.lat,xn.worldSize).metersToTile,$r=[0,0,0,1],bo=[0,0,0,1],Fo=(vi,gs,Ls,Os)=>{vi[0]=gs,vi[1]=Ls,vi[2]=Os,vi[3]=1},Eo=Dg();Ln>0&&(Ln+=Eo),Fn+=Eo;for(const vi of Xt){const gs=[],Ls=[];for(const Os of vi){const Bo=Os.x+On.x,da=Os.y+On.y,Js=xn.projection.projectTilePoint(Bo,da,Pr),Ns=xn.projection.upVector(Pr,Os.x,Os.y);let Si=Ln,Qs=Fn;if(wn){const go=Sp(Bo,da,Ln,Fn,wn,or,Fr,wi);Si+=go.base,Qs+=go.top}0!==Ln?Fo($r,Js.x+Ns[0]*Gr*Si,Js.y+Ns[1]*Gr*Si,Js.z+Ns[2]*Gr*Si):Fo($r,Js.x,Js.y,Js.z),Fo(bo,Js.x+Ns[0]*Gr*Qs,Js.y+Ns[1]*Gr*Qs,Js.z+Ns[2]*Gr*Qs),ds($r,$r,jr),ds(bo,bo,jr),gs.push(new Id($r[0],$r[1],$r[2])),Ls.push(new Id(bo[0],bo[1],bo[2]))}dr.push(gs),is.push(Ls)}return[dr,is]}(et,ct,ut,Bt,Ot,Yt,yn,jt,Qt,en,s.tileID.canonical):yn?function(xn,Xt,Ln,Fn,On,jr,wn,or,Fr){const wi=[],Pr=[],dr=[0,0,0,1];for(const is of xn){const Gr=[],$r=[];for(const bo of is){const Fo=bo.x+Fn.x,Eo=bo.y+Fn.y,vi=Sp(Fo,Eo,Xt,Ln,jr,wn,or,Fr);dr[0]=Fo,dr[1]=Eo,dr[2]=vi.base,dr[3]=1,$h(dr,dr,On),dr[3]=Math.max(dr[3],1e-5);const gs=new Id(dr[0]/dr[3],dr[1]/dr[3],dr[2]/dr[3]);dr[0]=Fo,dr[1]=Eo,dr[2]=vi.top,dr[3]=1,$h(dr,dr,On),dr[3]=Math.max(dr[3],1e-5);const Ls=new Id(dr[0]/dr[3],dr[1]/dr[3],dr[2]/dr[3]);Gr.push(gs),$r.push(Ls)}wi.push(Gr),Pr.push($r)}return[wi,Pr]}(ct,ut,Bt,Ot,Yt,yn,jt,Qt,en):function(xn,Xt,Ln,Fn,On){const jr=[],wn=[],or=On[8]*Xt,Fr=On[9]*Xt,wi=On[10]*Xt,Pr=On[11]*Xt,dr=On[8]*Ln,is=On[9]*Ln,Gr=On[10]*Ln,$r=On[11]*Ln;for(const bo of xn){const Fo=[],Eo=[];for(const vi of bo){const gs=vi.x+Fn.x,Ls=vi.y+Fn.y,Os=On[0]*gs+On[4]*Ls+On[12],Bo=On[1]*gs+On[5]*Ls+On[13],da=On[2]*gs+On[6]*Ls+On[14],Js=On[3]*gs+On[7]*Ls+On[15],Ns=Os+or,Si=Bo+Fr,Qs=da+wi,go=Math.max(Js+Pr,1e-5),ka=Os+dr,Es=Bo+is,lu=da+Gr,Fa=Math.max(Js+$r,1e-5);Fo.push(new Id(Ns/go,Si/go,Qs/go)),Eo.push(new Id(ka/Fa,Es/Fa,lu/Fa))}jr.push(Fo),wn.push(Eo)}return[jr,wn]}(ct,ut,Bt,Ot,Yt)),$e=s.queryGeometry;var et,ct,ut,Bt,Ot,Yt,yn,jt,Qt,en;return function(et,ct,ut){let Bt=1/0;Kv(ut,ct)&&(Bt=zy(ut,ct[0]));for(let Ot=0;Ot<ct.length;Ot++){const Yt=ct[Ot],yn=et[Ot];for(let jt=0;jt<Yt.length-1;jt++){const Qt=Yt[jt],en=[Qt,Yt[jt+1],yn[jt+1],yn[jt],Qt];Yv(ut,en)&&(Bt=Math.min(Bt,zy(ut,en)))}}return Bt!==1/0&&Bt}(Ge,nt,$e.isPointQuery()?$e.screenBounds:$e.screenGeometry)}},line:class extends nc{constructor(s){super(s,Ad),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if("line-gradient"===s){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof ol,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,i){super.recalculate(s,i),this.paint._values["line-floorwidth"]=Ip.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new Dd(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new jh(this,s)}queryRadius(s){const i=s,u=Pg(vd("line-width",this,i),vd("line-gap-width",this,i)),f=vd("line-offset",this,i);return u/2+Math.abs(f)+gg(this.paint.get("line-translate"))}queryIntersectsFeature(s,i,u,f,m,w){if(s.queryGeometry.isAboveHorizon)return!1;const S=mg(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,s.pixelToTileUnitsFactor),M=s.pixelToTileUnitsFactor/2*Pg(this.paint.get("line-width").evaluate(i,u),this.paint.get("line-gap-width").evaluate(i,u)),R=this.paint.get("line-offset").evaluate(i,u);return R&&(f=function(L,z){const V=[],G=new Z(0,0);for(let X=0;X<L.length;X++){const K=L[X],ue=[];for(let Ce=0;Ce<K.length;Ce++){const Ge=K[Ce],nt=K[Ce+1],$e=0===Ce?G:Ge.sub(K[Ce-1])._unit()._perp(),et=Ce===K.length-1?G:nt.sub(Ge)._unit()._perp(),ct=$e._add(et)._unit();ct._mult(1/(ct.x*et.x+ct.y*et.y)),ue.push(ct._mult(z)._add(Ge))}V.push(ue)}return V}(f,R*s.pixelToTileUnitsFactor)),function(L,z,V){for(let G=0;G<z.length;G++){const X=z[G];if(L.length>=3)for(let K=0;K<X.length;K++)if(_d(L,X[K]))return!0;if(Kx(L,X,V))return!0}return!1}(S,f,M)}isTileClipped(){return!0}},symbol:wh,background:class extends nc{constructor(s){super(s,rf)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends nc{constructor(s){super(s,Aw)}getProgramIds(){return["raster"]}},sky:class extends nc{constructor(s){super(s,Kg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"sky-gradient"===s?this._updateColorRamp():"sky-atmosphere-sun"!==s&&"sky-atmosphere-halo-color"!==s&&"sky-atmosphere-color"!==s&&"sky-atmosphere-sun-intensity"!==s||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=vg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(s,i){if("atmosphere"===this.paint.get("sky-type")){const f=this.paint.get("sky-atmosphere-sun"),m=!f,w=s.style.light,S=w.properties.get("position");return m&&"viewport"===w.properties.get("anchor")&&cr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?d_(S.azimuthal,90-S.polar,i):d_(f[0],90-f[1],i)}const u=this.paint.get("sky-gradient-center");return d_(u[0],90-u[1],i)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return"atmosphere"===s?["skyboxCapture","skybox"]:"gradient"===s?["skyboxGradient"]:null}}};class sf{constructor(i,u,f,m){this.context=i,this.format=f,this.texture=i.gl.createTexture(),this.update(u,m)}update(i,u,f){const{width:m,height:w}=i,{context:S}=this,{gl:M}=S,{HTMLImageElement:R,HTMLCanvasElement:L,HTMLVideoElement:z,ImageData:V,ImageBitmap:G}=H;if(M.bindTexture(M.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!u||!1!==u.premultiply)),f||this.size&&this.size[0]===m&&this.size[1]===w){const{x:X,y:K}=f||{x:0,y:0};i instanceof R||i instanceof L||i instanceof z||i instanceof V||G&&i instanceof G?M.texSubImage2D(M.TEXTURE_2D,0,X,K,M.RGBA,M.UNSIGNED_BYTE,i):M.texSubImage2D(M.TEXTURE_2D,0,X,K,m,w,M.RGBA,M.UNSIGNED_BYTE,i.data)}else this.size=[m,w],i instanceof R||i instanceof L||i instanceof z||i instanceof V||G&&i instanceof G?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,i):M.texImage2D(M.TEXTURE_2D,0,this.format,m,w,0,this.format,M.UNSIGNED_BYTE,i.data);this.useMipmap=!!(u&&u.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&M.generateMipmap(M.TEXTURE_2D)}bind(i,u){const{context:f}=this,{gl:m}=f;m.bindTexture(m.TEXTURE_2D,this.texture),i!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,i),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?i===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_NEAREST:i),this.filter=i),u!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,u),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class Rw{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class p_{constructor(){this.tasks={},this.taskQueue=[],_n(["process"],this),this.invoker=new Rw(this.process),this.nextId=0}add(i,u){const f=this.nextId++,m=function({type:w,isSymbolTile:S,zoom:M}){return M=M||0,"message"===w?0:"maybePrepare"!==w||S?"parseTile"!==w||S?"parseTile"===w&&S?300-M:"maybePrepare"===w&&S?400-M:500:200-M:100-M}(u);if(0===m){sr();try{i()}finally{}return{cancel:()=>{}}}return this.tasks[f]={fn:i,metadata:u,priority:m,id:f},this.taskQueue.push(f),this.invoker.trigger(),{cancel:()=>{delete this.tasks[f]}}}process(){sr();try{if(this.taskQueue=this.taskQueue.filter(f=>!!this.tasks[f]),!this.taskQueue.length)return;const i=this.pick();if(null===i)return;const u=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!u)return;u.fn()}finally{}}pick(){let i=null,u=1/0;for(let m=0;m<this.taskQueue.length;m++){const w=this.tasks[this.taskQueue[m]];w.priority<u&&(u=w.priority,i=m)}if(null===i)return null;const f=this.taskQueue[i];return this.taskQueue.splice(i,1),f}remove(){this.invoker.remove()}}class jd{constructor(i){this._stringToNumber={},this._numberToString=[];for(let u=0;u<i.length;u++){const f=i[u];this._stringToNumber[f]=u,this._numberToString[u]=f}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const B0=["tile","layer","source","sourceLayer","state"];class Lw{constructor(i,u,f,m,w){this.type="Feature",this._vectorTileFeature=i,this._z=u,this._x=f,this._y=m,this.properties=i.properties,this.id=w}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(i.id=this.id);for(const u of B0)void 0!==this[u]&&(i[u]=this[u]);return i}}const wc=new Uint16Array(8184);for(let s=0;s<2046;s++){let i=s+2,u=0,f=0,m=0,w=0,S=0,M=0;for(1&i?m=w=S=32:u=f=M=32;(i>>=1)>1;){const L=u+m>>1,z=f+w>>1;1&i?(m=u,w=f,u=S,f=M):(u=m,f=w,m=S,w=M),S=L,M=z}const R=4*s;wc[R+0]=u,wc[R+1]=f,wc[R+2]=m,wc[R+3]=w}const bc=new Uint16Array(2178),bh=new Uint8Array(1089),Jg=new Uint16Array(1089);function z0(s){return 0===s?-.03125:32===s?.03125:0}var U0=Et([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const V0={type:2,extent:ar,loadGeometry:()=>[[new Z(0,0),new Z(ar+1,0),new Z(ar+1,ar+1),new Z(0,ar+1),new Z(0,0)]]};class g_{constructor(i,u,f,m,w){this.tileID=i,this.uid=zt(),this.uses=0,this.tileSize=u,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(i){const u=i+this.timeAdded;u<Ss.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=vh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,u,f){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(m,w){const S={};if(!w)return S;for(const M of m){const R=M.layerIds.map(L=>w.getLayer(L)).filter(Boolean);if(0!==R.length){M.layers=R,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(L=>R.filter(z=>z.id===L)[0]));for(const L of R)S[L.id]=M}}return S}(i.buckets,u.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const w=this.buckets[m];if(w instanceof Vf){if(this.hasSymbolBuckets=!0,!f)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const w=this.buckets[m];if(w instanceof Vf&&w.hasRTLText){this.hasRTLText=!0,k.isLoading()||k.isLoaded()||"deferred"!==A()||O();break}}this.queryPadding=0;for(const m in this.buckets){const w=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(m).queryRadius(w))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new Oo}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.id]}upload(i){for(const f in this.buckets){const m=this.buckets[f];m.uploadPending()&&m.upload(i)}const u=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new sf(i,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new sf(i,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new sf(i,this.lineAtlas.image,u.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,u,f,m,w,S,M,R){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:m,pixelPosMatrix:M,transform:S,params:w,tileTransform:this.tileTransform},i,u,f):{}}querySourceFeatures(i,u){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const m=f.loadVTLayers(),w=u?u.sourceLayer:"",S=m._geojsonTileLayer||m[w];if(!S)return;const M=Nc(u&&u.filter),{z:R,x:L,y:z}=this.tileID.canonical,V={z:R,x:L,y:z};for(let G=0;G<S.length;G++){const X=S.feature(G);if(M.needGeometry){const Ce=_c(X,!0);if(!M.filter(new U(this.tileID.overscaledZ),Ce,this.tileID.canonical))continue}else if(!M.filter(new U(this.tileID.overscaledZ),X))continue;const K=f.getId(X,w),ue=new Lw(X,R,L,z,K);ue.tile=V,i.push(ue)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const u=this.expirationTime;if(i.cacheControl){const f=wt(i.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const f=Date.now();let m=!1;if(this.expirationTime>f)m=!1;else if(u)if(this.expirationTime<u)m=!0;else{const w=this.expirationTime-u;w?this.expirationTime=f+Math.max(w,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(i,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(i).length||!u)return;const f=this.latestFeatureIndex.loadVTLayers(),m=u.style.listImages();for(const w in this.buckets){if(!u.style.hasLayer(w))continue;const S=this.buckets[w],M=S.layers[0].sourceLayer||"_geojsonTileLayer",R=f[M],L=i[M];if(!R||!L||0===Object.keys(L).length)continue;if(S.update(L,R,m,this.imageAtlas&&this.imageAtlas.patternPositions||{}),S instanceof Dd||S instanceof gh){const V=u.style._getSourceCache(S.layers[0].source);u._terrain&&u._terrain.enabled&&V&&S.programConfigurations.needsUpload&&u._terrain._clearRenderCacheForTile(V.id,this.tileID)}const z=u&&u.style&&u.style.getLayer(w);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(S)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ss.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=Ss.now()+i}setTexture(i,u){const f=u.context,m=f.gl;this.texture=this.texture||u.getTileTexture(i.width),this.texture?this.texture.update(i,{useMipmap:!0}):(this.texture=new sf(f,i,m.RGBA,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(i,u){const f={};for(const m of u)f[m]=!0;this.dependencies[i]=f}hasDependency(i,u){for(const f of i){const m=this.dependencies[f];if(m)for(const w of u)if(m[w])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,u){if(!u||"mercator"===u.name||this._tileDebugBuffer)return;const f=dl(V0,this.tileID.canonical,this.tileTransform)[0],m=new mn,w=new cl;for(let S=0;S<f.length;S++){const{x:M,y:R}=f[S];m.emplaceBack(M,R),w.emplaceBack(S)}w.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(w),this._tileDebugBuffer=i.createVertexBuffer(m,up.members),this._tileDebugSegments=Zo.simpleSegment(0,0,m.length,w.length)}_makeTileBoundsBuffers(i,u){if(this._tileBoundsBuffer||!u||"mercator"===u.name)return;const f=dl(V0,this.tileID.canonical,this.tileTransform)[0];let m,w;if(this.isRaster){const S=function(M,R){const L=vh(M,R),z=Math.pow(2,M.z);for(let Ce=0;Ce<33;Ce++)for(let Ge=0;Ge<33;Ge++){const nt=Yu((M.x+(Ge+z0(Ge))/32)/z),$e=Ca((M.y+(Ce+z0(Ce))/32)/z),et=R.project(nt,$e),ct=33*Ce+Ge;bc[2*ct+0]=Math.round((et.x*L.scale-L.x)*ar),bc[2*ct+1]=Math.round((et.y*L.scale-L.y)*ar)}bh.fill(0),Jg.fill(0);for(let Ce=2045;Ce>=0;Ce--){const Ge=4*Ce,nt=wc[Ge+0],$e=wc[Ge+1],et=wc[Ge+2],ct=wc[Ge+3],ut=nt+et>>1,Bt=$e+ct>>1,Ot=ut+Bt-$e,Yt=Bt+nt-ut,yn=33*$e+nt,jt=33*ct+et,Qt=33*Bt+ut,en=Math.hypot((bc[2*yn+0]+bc[2*jt+0])/2-bc[2*Qt+0],(bc[2*yn+1]+bc[2*jt+1])/2-bc[2*Qt+1])>=16;bh[Qt]=bh[Qt]||(en?1:0),Ce<1022&&(bh[Qt]=bh[Qt]||bh[33*($e+Yt>>1)+(nt+Ot>>1)]||bh[33*(ct+Yt>>1)+(et+Ot>>1)])}const V=new Kt,G=new Jn;let X=0;function K(Ce,Ge){const nt=33*Ge+Ce;return 0===Jg[nt]&&(V.emplaceBack(bc[2*nt+0],bc[2*nt+1],Ce*ar/32,Ge*ar/32),Jg[nt]=++X),Jg[nt]-1}function ue(Ce,Ge,nt,$e,et,ct){const ut=Ce+nt>>1,Bt=Ge+$e>>1;if(Math.abs(Ce-et)+Math.abs(Ge-ct)>1&&bh[33*Bt+ut])ue(et,ct,Ce,Ge,ut,Bt),ue(nt,$e,et,ct,ut,Bt);else{const Ot=K(Ce,Ge),Yt=K(nt,$e),yn=K(et,ct);G.emplaceBack(Ot,Yt,yn)}}return ue(0,0,32,32,32,0),ue(32,32,0,0,0,32),{vertices:V,indices:G}}(this.tileID.canonical,u);m=S.vertices,w=S.indices}else{m=new Kt,w=new Jn;for(const{x:M,y:R}of f)m.emplaceBack(M,R,0,0);const S=yp(m.int16,void 0,4);for(let M=0;M<S.length;M+=3)w.emplaceBack(S[M],S[M+1],S[M+2])}this._tileBoundsBuffer=i.createVertexBuffer(m,U0.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(w),this._tileBoundsSegments=Zo.simpleSegment(0,0,m.length,w.length)}_makeGlobeTileDebugBuffers(i,u){const f=u.projection;if(!f||"globe"!==f.name||u.freezeTileCoverage)return;const m=this.tileID.canonical,w=Xh(gd(m,u)),S=cp(u.zoom);let M;S>0&&(M=ey(new Float64Array(16),u.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,m,u,w,M,S),this._makeGlobeTileDebugTextBuffer(i,m,u,w,M,S)}_globePoint(i,u,f,m,w,S,M){let R=Bu(i,u,f);if(S){const L=1<<f.z,z=zc(m.center.lng),V=Uc(m.center.lat),G=(f.x+.5)/L-z;let X=0;G>.5?X=-1:G<-.5&&(X=1);let K=(i/ar+f.x)/L+X,ue=(u/ar+f.y)/L;K=(K-z)*m._pixelsPerMercatorPixel+z,ue=(ue-V)*m._pixelsPerMercatorPixel+V;const Ce=[K*m.worldSize,ue*m.worldSize,0];ds(Ce,Ce,S),R=pd(R,Ce,M)}return ds(R,R,w)}_makeGlobeTileDebugBorderBuffer(i,u,f,m,w,S){const M=new mn,R=new cl,L=new Rt,z=(G,X,K,ue,Ce)=>{const Ge=(K-G)/(Ce-1),nt=(ue-X)/(Ce-1),$e=M.length;for(let et=0;et<Ce;et++){const ct=G+et*Ge,ut=X+et*nt;M.emplaceBack(ct,ut);const Bt=this._globePoint(ct,ut,u,f,m,w,S);L.emplaceBack(Bt[0],Bt[1],Bt[2]),R.emplaceBack($e+et)}},V=ar;z(0,0,V,0,16),z(V,0,V,V,16),z(V,V,0,V,16),z(0,V,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(R),this._tileDebugBuffer=i.createVertexBuffer(M,up.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(L,Af.members),this._tileDebugSegments=Zo.simpleSegment(0,0,M.length,R.length)}_makeGlobeTileDebugTextBuffer(i,u,f,m,w,S){const M=ar/4,R=new mn,L=new Jn,z=new Rt,V=25;L.reserve(32),R.reserve(V),z.reserve(V);const G=(X,K)=>V*X+K;for(let X=0;X<V;X++){const K=X*M;for(let ue=0;ue<V;ue++){const Ce=ue*M;R.emplaceBack(Ce,K);const Ge=this._globePoint(Ce,K,u,f,m,w,S);z.emplaceBack(Ge[0],Ge[1],Ge[2])}}for(let X=0;X<4;X++)for(let K=0;K<4;K++){const ue=G(X,K),Ce=G(X,K+1),Ge=G(X+1,K),nt=G(X+1,K+1);L.emplaceBack(ue,Ce,Ge),L.emplaceBack(Ge,Ce,nt)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(L),this._tileDebugTextBuffer=i.createVertexBuffer(R,up.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(z,Af.members),this._tileDebugTextSegments=Zo.simpleSegment(0,0,V,32)}}class Ow{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,u,f){const m=String(u);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][m]=this.stateChanges[i][m]||{},Le(this.stateChanges[i][m],f),null===this.deletedStates[i]){this.deletedStates[i]={};for(const w in this.state[i])w!==m&&(this.deletedStates[i][w]=null)}else if(this.deletedStates[i]&&null===this.deletedStates[i][m]){this.deletedStates[i][m]={};for(const w in this.state[i][m])f[w]||(this.deletedStates[i][m][w]=null)}else for(const w in f)this.deletedStates[i]&&this.deletedStates[i][m]&&null===this.deletedStates[i][m][w]&&delete this.deletedStates[i][m][w]}removeFeatureState(i,u,f){if(null===this.deletedStates[i])return;const m=String(u);if(this.deletedStates[i]=this.deletedStates[i]||{},f&&void 0!==u)null!==this.deletedStates[i][m]&&(this.deletedStates[i][m]=this.deletedStates[i][m]||{},this.deletedStates[i][m][f]=null);else if(void 0!==u)if(this.stateChanges[i]&&this.stateChanges[i][m])for(f in this.deletedStates[i][m]={},this.stateChanges[i][m])this.deletedStates[i][m][f]=null;else this.deletedStates[i][m]=null;else this.deletedStates[i]=null}getState(i,u){const f=String(u),m=Le({},(this.state[i]||{})[f],(this.stateChanges[i]||{})[f]);if(null===this.deletedStates[i])return{};if(this.deletedStates[i]){const w=this.deletedStates[i][u];if(null===w)return{};for(const S in w)delete m[S]}return m}initializeTileState(i,u){i.setFeatureState(this.state,u)}coalesceChanges(i,u){const f={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const w={};for(const S in this.stateChanges[m])this.state[m][S]||(this.state[m][S]={}),Le(this.state[m][S],this.stateChanges[m][S]),w[S]=this.state[m][S];f[m]=w}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const w={};if(null===this.deletedStates[m])for(const S in this.state[m])w[S]={},this.state[m][S]={};else for(const S in this.deletedStates[m]){if(null===this.deletedStates[m][S])this.state[m][S]={};else if(this.state[m][S])for(const M of Object.keys(this.deletedStates[m][S]))delete this.state[m][S][M];w[S]=this.state[m][S]}f[m]=f[m]||{},Le(f[m],w)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(f).length)for(const m in i)i[m].setFeatureState(f,u)}}class m_{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,u){const f=this.toIdx(i,u);return{min:this.minimums[f],max:this.maximums[f]}}isLeaf(i,u){return this.leaves[this.toIdx(i,u)]}toIdx(i,u){return u*this.size+i}}function jf(s,i,u,f){let m=0,w=Number.MAX_VALUE;for(let S=0;S<3;S++)if(Math.abs(f[S])<1e-15){if(u[S]<s[S]||u[S]>i[S])return null}else{const M=1/f[S];let R=(s[S]-u[S])*M,L=(i[S]-u[S])*M;if(R>L){const z=R;R=L,L=z}if(R>m&&(m=R),L<w&&(w=L),m>w)return null}return m}function Hc(s,i,u,f,m,w,S,M,R,L,z){const V=f-s,G=m-i,X=w-u,K=S-s,ue=M-i,Ce=R-u,Ge=z[1]*Ce-z[2]*ue,nt=z[2]*K-z[0]*Ce,$e=z[0]*ue-z[1]*K,et=V*Ge+G*nt+X*$e;if(Math.abs(et)<1e-15)return null;const ct=1/et,ut=L[0]-s,Bt=L[1]-i,Ot=L[2]-u,Yt=(ut*Ge+Bt*nt+Ot*$e)*ct;if(Yt<0||Yt>1)return null;const yn=Bt*X-Ot*G,jt=Ot*V-ut*X,Qt=ut*G-Bt*V,en=(z[0]*yn+z[1]*jt+z[2]*Qt)*ct;return en<0||Yt+en>1?null:(K*yn+ue*jt+Ce*Qt)*ct}function y_(s,i,u){return(s-i)/(u-i)}function Nw(s,i,u,f,m,w,S,M,R){const L=1<<u,z=w-f,V=S-m,G=(s+1)/L*z+f,X=(i+0)/L*V+m,K=(i+1)/L*V+m;M[0]=(s+0)/L*z+f,M[1]=X,R[0]=G,R[1]=K}class j0{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const u=function(w){const S=Math.ceil(Math.log2(w.dim/8)),M=[];let R=Math.ceil(Math.pow(2,S));const L=1/R,z=(X,K,ue,Ce,Ge)=>{const nt=Ce?1:0,$e=(X+1)*ue-nt,et=K*ue,ct=(K+1)*ue-nt;Ge[0]=X*ue,Ge[1]=et,Ge[2]=$e,Ge[3]=ct};let V=new m_(R);const G=[];for(let X=0;X<R*R;X++){z(X%R,Math.floor(X/R),L,!1,G);const K=Gf(G[0],G[1],w),ue=Gf(G[2],G[1],w),Ce=Gf(G[2],G[3],w),Ge=Gf(G[0],G[3],w);V.minimums.push(Math.min(K,ue,Ce,Ge)),V.maximums.push(Math.max(K,ue,Ce,Ge)),V.leaves.push(1)}for(M.push(V),R/=2;R>=1;R/=2){const X=M[M.length-1];V=new m_(R);for(let K=0;K<R*R;K++){z(K%R,Math.floor(K/R),2,!0,G);const ue=X.getElevation(G[0],G[1]),Ce=X.getElevation(G[2],G[1]),Ge=X.getElevation(G[2],G[3]),nt=X.getElevation(G[0],G[3]),$e=X.isLeaf(G[0],G[1]),et=X.isLeaf(G[2],G[1]),ct=X.isLeaf(G[2],G[3]),ut=X.isLeaf(G[0],G[3]),Bt=Math.min(ue.min,Ce.min,Ge.min,nt.min),Ot=Math.max(ue.max,Ce.max,Ge.max,nt.max),Yt=$e&&et&&ct&&ut;V.maximums.push(Ot),V.minimums.push(Bt),V.leaves.push(Ot-Bt<=5&&Yt?1:0)}M.push(V)}return M}(this.dem),f=u.length-1,m=u[f];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(u,0,0,f,0)}raycastRoot(i,u,f,m,w,S,M=1){return jf([i,u,-100],[f,m,this.maximums[0]*M],w,S)}raycast(i,u,f,m,w,S,M=1){if(!this.nodeCount)return null;const R=this.raycastRoot(i,u,f,m,w,S,M);if(null==R)return null;const L=[],z=[],V=[],G=[],X=[{idx:0,t:R,nodex:0,nodey:0,depth:0}];for(;X.length>0;){const{idx:K,t:ue,nodex:Ce,nodey:Ge,depth:nt}=X.pop();if(this.leaves[K]){Nw(Ce,Ge,nt,i,u,f,m,V,G);const et=1<<nt,ct=(Ce+0)/et,ut=(Ce+1)/et,Bt=(Ge+0)/et,Ot=(Ge+1)/et,Yt=Gf(ct,Bt,this.dem)*M,yn=Gf(ut,Bt,this.dem)*M,jt=Gf(ut,Ot,this.dem)*M,Qt=Gf(ct,Ot,this.dem)*M,en=Hc(V[0],V[1],Yt,G[0],V[1],yn,G[0],G[1],jt,w,S),ln=Hc(G[0],G[1],jt,V[0],G[1],Qt,V[0],V[1],Yt,w,S),xn=Math.min(null!==en?en:Number.MAX_VALUE,null!==ln?ln:Number.MAX_VALUE);if(xn!==Number.MAX_VALUE)return xn;{const Xt=cd([],w,S,ue);if(kw(Yt,yn,Qt,jt,y_(Xt[0],V[0],G[0]),y_(Xt[1],V[1],G[1]))>=Xt[2])return ue}continue}let $e=0;for(let et=0;et<this._siblingOffset.length;et++){Nw((Ce<<1)+this._siblingOffset[et][0],(Ge<<1)+this._siblingOffset[et][1],nt+1,i,u,f,m,V,G),V[2]=-100,G[2]=this.maximums[this.childOffsets[K]+et]*M;const ct=jf(V,G,w,S);if(null!=ct){const ut=ct;L[et]=ut;let Bt=!1;for(let Ot=0;Ot<$e&&!Bt;Ot++)ut>=L[z[Ot]]&&(z.splice(Ot,0,et),Bt=!0);Bt||(z[$e]=et),$e++}}for(let et=0;et<$e;et++){const ct=z[et];X.push({idx:this.childOffsets[K]+ct,t:L[ct],nodex:(Ce<<1)+this._siblingOffset[ct][0],nodey:(Ge<<1)+this._siblingOffset[ct][1],depth:nt+1})}}return null}_addNode(i,u,f){return this.minimums.push(i),this.maximums.push(u),this.leaves.push(f),this.childOffsets.push(0),this.nodeCount++}_construct(i,u,f,m,w){if(1===i[m].isLeaf(u,f))return;this.childOffsets[w]||(this.childOffsets[w]=this.nodeCount);const S=m-1,M=i[S];let R=0,L=0;for(let z=0;z<this._siblingOffset.length;z++){const V=2*u+this._siblingOffset[z][0],G=2*f+this._siblingOffset[z][1],X=M.getElevation(V,G),K=M.isLeaf(V,G),ue=this._addNode(X.min,X.max,K);K&&(R|=1<<z),L||(L=ue)}for(let z=0;z<this._siblingOffset.length;z++)R&1<<z||this._construct(i,2*u+this._siblingOffset[z][0],2*f+this._siblingOffset[z][1],S,L+z)}}function kw(s,i,u,f,m,w){return In(In(s,u,w),In(i,f,w),m)}function Gf(s,i,u){const f=u.dim,m=De(s*f-.5,0,f-1),w=De(i*f-.5,0,f-1),S=Math.floor(m),M=Math.floor(w),R=Math.min(S+1,f-1),L=Math.min(M+1,f-1);return kw(u.get(S,M),u.get(R,M),u.get(S,L),u.get(R,L),m-S,w-M)}const __={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function G0(s,i,u){return(256*s*256+256*i+u)/10-1e4}function MS(s,i,u){return 256*s+i+u/256-32768}class Rp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,u,f,m=!1,w=!1){if(this.uid=i,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&"mapbox"!==f&&"terrarium"!==f)return cr(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=u.height;const S=this.dim=u.height-2,M=new Uint32Array(u.data.buffer);if(this.pixels=new Uint8Array(u.data.buffer),this.encoding=f||"mapbox",this.borderReady=m,!m){for(let R=0;R<S;R++)M[this._idx(-1,R)]=M[this._idx(0,R)],M[this._idx(S,R)]=M[this._idx(S-1,R)],M[this._idx(R,-1)]=M[this._idx(R,0)],M[this._idx(R,S)]=M[this._idx(R,S-1)];M[this._idx(-1,-1)]=M[this._idx(0,0)],M[this._idx(S,-1)]=M[this._idx(S-1,0)],M[this._idx(-1,S)]=M[this._idx(0,S-1)],M[this._idx(S,S)]=M[this._idx(S-1,S-1)],w&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new j0(this)}get(i,u,f=!1){f&&(i=De(i,-1,this.dim),u=De(u,-1,this.dim));const m=4*this._idx(i,u);return("terrarium"===this.encoding?MS:G0)(this.pixels[m],this.pixels[m+1],this.pixels[m+2])}static getUnpackVector(i){return __[i]}get unpackVector(){return __[this.encoding]}_idx(i,u){if(i<-1||i>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(i+1)}static pack(i,u){const f=[0,0,0,0],m=Rp.getUnpackVector(u);let w=Math.floor((i+m[3])/m[2]);return f[2]=w%256,w=Math.floor(w/256),f[1]=w%256,w=Math.floor(w/256),f[0]=w,f}getPixels(){return new Ku({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,u,f){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let m=u*this.dim,w=u*this.dim+this.dim,S=f*this.dim,M=f*this.dim+this.dim;switch(u){case-1:m=w-1;break;case 1:w=m+1}switch(f){case-1:S=M-1;break;case 1:M=S+1}const R=-u*this.dim,L=-f*this.dim;for(let z=S;z<M;z++)for(let V=m;V<w;V++){const G=4*this._idx(V,z),X=4*this._idx(V+R,z+L);this.pixels[G+0]=i.pixels[X+0],this.pixels[G+1]=i.pixels[X+1],this.pixels[G+2]=i.pixels[X+2],this.pixels[G+3]=i.pixels[X+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Sn(Rp,"DEMData"),Sn(j0,"DemMinMaxQuadTree",{omit:["dem"]});class Qg{constructor(i,u){this.max=i,this.onRemove=u,this.reset()}reset(){for(const i in this.data)for(const u of this.data[i])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(i,u,f){const m=i.wrapped().key;void 0===this.data[m]&&(this.data[m]=[]);const w={value:u,timeout:void 0};if(void 0!==f&&(w.timeout=setTimeout(()=>{this.remove(i,w)},f)),this.data[m].push(w),this.order.push(m),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const u=this.data[i].shift();return u.timeout&&clearTimeout(u.timeout),0===this.data[i].length&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),u.value}getByKey(i){const u=this.data[i];return u?u[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,u){if(!this.has(i))return this;const f=i.wrapped().key,m=void 0===u?0:this.data[f].indexOf(u),w=this.data[f][m];return this.data[f].splice(m,1),w.timeout&&clearTimeout(w.timeout),0===this.data[f].length&&delete this.data[f],this.onRemove(w.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(i){const u=[];for(const f in this.data)for(const m of this.data[f])i(m.value)||u.push(m);for(const f of u)this.remove(f.value.tileID,f)}}class $f{constructor(i,u,f){this.func=i,this.mask=u,this.range=f}}$f.ReadOnly=!1,$f.ReadWrite=!0,$f.disabled=new $f(519,$f.ReadOnly,[0,1]);class tm{constructor(i,u,f,m,w,S){this.test=i,this.ref=u,this.mask=f,this.fail=m,this.depthFail=w,this.pass=S}}tm.disabled=new tm({func:519,mask:0},0,0,7680,7680,7680);class Nr{constructor(i,u,f){this.blendFunction=i,this.blendColor=u,this.mask=f}}Nr.Replace=[1,0],Nr.disabled=new Nr(Nr.Replace,Qo.transparent,[!1,!1,!1,!1]),Nr.unblended=new Nr(Nr.Replace,Qo.transparent,[!0,!0,!0,!0]),Nr.alphaBlended=new Nr([1,771],Qo.transparent,[!0,!0,!0,!0]);class Wc{constructor(i,u,f){this.enable=i,this.mode=u,this.frontFace=f}}Wc.disabled=new Wc(!1,1029,2305),Wc.backCCW=new Wc(!0,1029,2305),Wc.backCW=new Wc(!0,1029,2304),Wc.frontCW=new Wc(!0,1028,2304),Wc.frontCCW=new Wc(!0,1028,2305);class qf extends na{constructor(i,u,f){super(),this.id=i,this._onlySymbols=f,u.on("data",m=>{"source"===m.dataType&&"metadata"===m.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===m.dataType&&"content"===m.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),u.on("error",()=>{this._sourceErrored=!0}),this._source=u,this._tiles={},this._cache=new Qg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ow,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(i){this.map=i,this._minTileCacheSize=void 0===this._minTileCacheSize&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const u=this._tiles[i];if("loaded"!==u.state&&"errored"!==u.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,u){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,u)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const f=this._tiles[u];f.upload(i),f.prepare(this.map.style.imageManager)}}getIds(){return vt(this._tiles).map(i=>i.tileID).sort(x_).map(i=>i.key)}getRenderableIds(i){const u=[];for(const f in this._tiles)this._isIdRenderable(+f,i)&&u.push(this._tiles[f]);return i?u.sort((f,m)=>{const w=f.tileID,S=m.tileID,M=new Z(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),R=new Z(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-S.overscaledZ||R.y-M.y||R.x-M.x}).map(f=>f.tileID.key):u.map(f=>f.tileID).sort(x_).map(f=>f.key)}hasRenderableParent(i){const u=this.findLoadedParent(i,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(i,u){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(u||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)"errored"!==this._tiles[i].state&&this._reloadTile(+i,"reloading")}}_reloadTile(i,u){const f=this._tiles[i];f&&("loading"!==f.state&&(f.state=u),this._loadTile(f,this._tileLoaded.bind(this,f,i,u)))}_tileLoaded(i,u,f,m){if(m)if(i.state="errored",404!==m.status)this._source.fire(new Gs(m,{tile:i}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const w=this.map.painter.terrain;this.update(this.transform,w.getScaledDemTileSize(),!0),w.resetTileLookupCache(this.id)}else this.update(this.transform);else i.timeAdded=Ss.now(),"expired"===f&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(u,i),"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new ta("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const u=this.getRenderableIds();for(let m=0;m<u.length;m++){const w=u[m];if(i.neighboringTiles&&i.neighboringTiles[w]){const S=this.getTileByID(w);f(i,S),f(S,i)}}function f(m,w){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let S=w.tileID.canonical.x-m.tileID.canonical.x;const M=w.tileID.canonical.y-m.tileID.canonical.y,R=Math.pow(2,m.tileID.canonical.z),L=w.tileID.key;0===S&&0===M||Math.abs(M)>1||(Math.abs(S)>1&&(1===Math.abs(S+R)?S+=R:1===Math.abs(S-R)&&(S-=R)),w.dem&&m.dem&&(m.dem.backfillBorder(w.dem,S,M),m.neighboringTiles&&m.neighboringTiles[L]&&(m.neighboringTiles[L].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,u,f,m){for(const w in this._tiles){let S=this._tiles[w];if(m[w]||!S.hasData()||S.tileID.overscaledZ<=u||S.tileID.overscaledZ>f)continue;let M=S.tileID;for(;S&&S.tileID.overscaledZ>u+1;){const L=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[L.key],S&&S.hasData()&&(M=L)}let R=M;for(;R.overscaledZ>u;)if(R=R.scaledTo(R.overscaledZ-1),i[R.key]){m[M.key]=M;break}}}findLoadedParent(i,u){if(i.key in this._loadedParentTiles){const f=this._loadedParentTiles[i.key];return f&&f.tileID.overscaledZ>=u?f:null}for(let f=i.overscaledZ-1;f>=u;f--){const m=i.scaledTo(f),w=this._getLoadedTile(m);if(w)return w}}_getLoadedTile(i){const u=this._tiles[i.key];return u&&u.hasData()?u:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,u){u=u||this._source.tileSize;const f=Math.ceil(i.width/u)+1,m=Math.ceil(i.height/u)+1,w=Math.floor(f*m*5),S="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,w):w,M="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(M)}handleWrapJump(i){const u=Math.round((i-(void 0===this._prevLng?i:this._prevLng))/360);if(this._prevLng=i,u){const f={};for(const m in this._tiles){const w=this._tiles[m];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+u),f[w.tileID.key]=w}this._tiles=f;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(i,u,f){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;let m;this.updateCacheSize(i,u),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new Uu(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(m=i.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(m=m.filter(M=>this._source.hasTile(M)))):m=[];const w=this._updateRetainedTiles(m);if($0(this._source.type)&&0!==m.length){const M={},R={},L=Object.keys(w);for(const V of L){const G=w[V],X=this._tiles[V];if(!X||X.fadeEndTime&&X.fadeEndTime<=Ss.now())continue;const K=this.findLoadedParent(G,Math.max(G.overscaledZ-qf.maxOverzooming,this._source.minzoom));K&&(this._addTile(K.tileID),M[K.tileID.key]=K.tileID),R[V]=G}const z=m[m.length-1].overscaledZ;for(const V in this._tiles){const G=this._tiles[V];if(w[V]||!G.hasData())continue;let X=G.tileID;for(;X.overscaledZ>z;){X=X.scaledTo(X.overscaledZ-1);const K=this._tiles[X.key];if(K&&K.hasData()&&R[X.key]){w[V]=G.tileID;break}}}for(const V in M)w[V]||(this._coveredTiles[V]=!0,w[V]=M[V])}for(const M in w)this._tiles[M].clearFadeHold();const S=function(M,R){const L=[];for(const z in M)z in R||L.push(z);return L}(this._tiles,w);for(const M of S){const R=this._tiles[M];R.hasSymbolBuckets&&!R.holdingForFade()?R.setHoldDuration(this.map._fadeDuration):R.hasSymbolBuckets&&!R.symbolFadeFinished()||this._removeTile(+M)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const u={};if(0===i.length)return u;const f={},m=i.reduce((L,z)=>Math.min(L,z.overscaledZ),1/0),w=i[0].overscaledZ,S=Math.max(w-qf.maxOverzooming,this._source.minzoom),M=Math.max(w+qf.maxUnderzooming,this._source.minzoom),R={};for(const L of i){const z=this._addTile(L);u[L.key]=L,z.hasData()||m<this._source.maxzoom&&(R[L.key]=L)}this._retainLoadedChildren(R,m,M,u);for(const L of i){let z=this._tiles[L.key];if(z.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const G=L.children(this._source.maxzoom)[0],X=this.getTile(G);if(X&&X.hasData()){u[G.key]=G;continue}}else{const G=L.children(this._source.maxzoom);if(u[G[0].key]&&u[G[1].key]&&u[G[2].key]&&u[G[3].key])continue}let V=z.wasRequested();for(let G=L.overscaledZ-1;G>=S;--G){const X=L.scaledTo(G);if(f[X.key]||(f[X.key]=!0,z=this.getTile(X),!z&&V&&(z=this._addTile(X)),z&&(u[X.key]=X,V=z.wasRequested(),z.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const u=[];let f,m=this._tiles[i].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){f=this._loadedParentTiles[m.key];break}u.push(m.key);const w=m.scaledTo(m.overscaledZ-1);if(f=this._getLoadedTile(w),f)break;m=w}for(const w of u)this._loadedParentTiles[w]=f}}_addTile(i){let u=this._tiles[i.key];if(u)return u;u=this._cache.getAndRemove(i),u&&(this._setTileReloadTimer(i.key,u),u.tileID=i,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,u)));const f=!!u;if(!f){const m=this.map?this.map.painter:null;u=new g_(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom,m,this._isRaster),this._loadTile(u,this._tileLoaded.bind(this,u,i.key,u.state))}return u?(u.uses++,this._tiles[i.key]=u,f||this._source.fire(new ta("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u):null}_setTileReloadTimer(i,u){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const f=u.getExpiryTimeout();f&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},f))}_removeTile(i){const u=this._tiles[i];u&&(u.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),u.uses>0||(u.hasData()&&"reloading"!==u.state?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,u,f){const m=[],w=this.transform;if(!w)return m;const S="globe"===w.projection.name,M=zc(w.center.lng);for(const R in this._tiles){const L=this._tiles[R];if(f&&L.clearQueryDebugViz(),L.holdingForFade())continue;let z;if(S){const V=L.tileID.canonical;if(0===V.z){const G=[Math.abs(De(M,...Lp(V,-1))-M),Math.abs(De(M,...Lp(V,1))-M)];z=[0,2*G.indexOf(Math.min(...G))-1]}else{const G=[Math.abs(De(M,...Lp(V,-1))-M),Math.abs(De(M,...Lp(V,0))-M),Math.abs(De(M,...Lp(V,1))-M)];z=[G.indexOf(Math.min(...G))-1]}}else z=[0];for(const V of z){const G=i.containsTile(L,w,u,V);G&&m.push(G)}}return m}getVisibleCoordinates(i){const u=this.getRenderableIds(i).map(f=>this._tiles[f].tileID);for(const f of u)f.projMatrix=this.transform.calculateProjMatrix(f.toUnwrapped());return u}hasTransition(){if(this._source.hasTransition())return!0;if($0(this._source.type))for(const i in this._tiles){const u=this._tiles[i];if(void 0!==u.fadeEndTime&&u.fadeEndTime>=Ss.now())return!0}return!1}setFeatureState(i,u,f){this._state.updateState(i=i||"_geojsonTileLayer",u,f)}removeFeatureState(i,u,f){this._state.removeFeatureState(i=i||"_geojsonTileLayer",u,f)}getFeatureState(i,u){return this._state.getState(i=i||"_geojsonTileLayer",u)}setDependencies(i,u,f){const m=this._tiles[i];m&&m.setDependencies(u,f)}reloadTilesForDependencies(i,u){for(const f in this._tiles)this._tiles[f].hasDependency(i,u)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(i,u))}_preloadTiles(i,u){if(!this._sourceLoaded){const M=()=>{this._sourceLoaded&&(this._source.off("data",M),this._preloadTiles(i,u))};return void this._source.on("data",M)}const f=new Map,m=Array.isArray(i)?i:[i],w=this.map.painter.terrain,S=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const M of m){const R=M.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of R)f.set(L.key,L);this.usedForTerrain&&M.updateElevation(!1)}at(Array.from(f.values()),(M,R)=>{const L=new g_(M,this._source.tileSize*M.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(L,z=>{"raster-dem"===this._source.type&&L.dem&&this._backfillDEM(L),R(z,L)})},u)}}function x_(s,i){const u=Math.abs(2*s.wrap)-+(s.wrap<0),f=Math.abs(2*i.wrap)-+(i.wrap<0);return s.overscaledZ-i.overscaledZ||f-u||i.canonical.y-s.canonical.y||i.canonical.x-s.canonical.x}function $0(s){return"raster"===s||"image"===s||"video"===s||"custom"===s}function Lp(s,i){const u=1<<s.z;return[s.x/u+i,(s.x+1)/u+i]}qf.maxOverzooming=10,qf.maxUnderzooming=3;class Op{constructor(i,u,f){this._demTile=i,this._dem=this._demTile.dem,this._scale=u,this._offset=f}static create(i,u,f){const m=f||i.findDEMTileFor(u);if(!m||!m.dem)return;const w=m.dem,S=m.tileID,M=1<<u.canonical.z-S.canonical.z;return new Op(m,m.tileSize/ar/M,[(u.canonical.x/M-S.canonical.x)*w.dim,(u.canonical.y/M-S.canonical.y)*w.dim])}tileCoordToPixel(i,u){const f=u*this._scale+this._offset[1],m=Math.floor(i*this._scale+this._offset[0]),w=Math.floor(f);return new Z(m,w)}getElevationAt(i,u,f,m){const w=i*this._scale+this._offset[0],S=u*this._scale+this._offset[1],M=Math.floor(w),R=Math.floor(S),L=this._dem;return m=!!m,f?In(In(L.get(M,R,m),L.get(M,R+1,m),S-R),In(L.get(M+1,R,m),L.get(M+1,R+1,m),S-R),w-M):L.get(M,R,m)}getElevationAtPixel(i,u,f){return this._dem.get(i,u,!!f)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*yc(1,i)*this._dem.stride}}class q0{constructor(i,u){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new qn(ar,16,0),this.featureIndexArray=new ku,this.promoteId=u}insert(i,u,f,m,w,S=0){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,m,w,S);const R=this.grid;for(let L=0;L<u.length;L++){const z=u[L],V=[1/0,1/0,-1/0,-1/0];for(let G=0;G<z.length;G++){const X=z[G];V[0]=Math.min(V[0],X.x),V[1]=Math.min(V[1],X.y),V[2]=Math.max(V[2],X.x),V[3]=Math.max(V[3],X.y)}V[0]<ar&&V[1]<ar&&V[2]>=0&&V[3]>=0&&R.insert(M,V[0],V[1],V[2],V[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new mh(new Ng(this.rawTileData)).layers,this.sourceLayerCoder=new jd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,u,f,m){this.loadVTLayers();const w=i.params||{},S=Nc(w.filter),M=i.tileResult,R=i.transform,L=M.bufferedTilespaceBounds,z=this.grid.query(L.min.x,L.min.y,L.max.x,L.max.y,(K,ue,Ce,Ge)=>vy(M.bufferedTilespaceGeometry,K,ue,Ce,Ge));z.sort(Fw);let V=null;R.elevation&&z.length>0&&(V=Op.create(R.elevation,this.tileID));const G={};let X;for(let K=0;K<z.length;K++){const ue=z[K];if(ue===X)continue;X=ue;const Ce=this.featureIndexArray.get(ue);let Ge=null;this.loadMatchingFeature(G,Ce,S,w.layers,w.availableImages,u,f,m,(nt,$e,et,ct=0)=>(Ge||(Ge=dl(nt,this.tileID.canonical,i.tileTransform)),$e.queryIntersectsFeature(M,nt,et,Ge,this.z,i.transform,i.pixelPosMatrix,V,ct)))}return G}loadMatchingFeature(i,u,f,m,w,S,M,R,L){const{featureIndex:z,bucketIndex:V,sourceLayerIndex:G,layoutVertexArrayOffset:X}=u,K=this.bucketLayerIDs[V];if(m&&!function(nt,$e){for(let et=0;et<nt.length;et++)if($e.indexOf(nt[et])>=0)return!0;return!1}(m,K))return;const ue=this.sourceLayerCoder.decode(G),Ce=this.vtLayers[ue].feature(z);if(f.needGeometry){const nt=_c(Ce,!0);if(!f.filter(new U(this.tileID.overscaledZ),nt,this.tileID.canonical))return}else if(!f.filter(new U(this.tileID.overscaledZ),Ce))return;const Ge=this.getId(Ce,ue);for(let nt=0;nt<K.length;nt++){const $e=K[nt];if(m&&m.indexOf($e)<0)continue;const et=S[$e];if(!et)continue;let ct={};void 0!==Ge&&R&&(ct=R.getState(et.sourceLayer||"_geojsonTileLayer",Ge));const ut=Le({},M[$e]);ut.paint=w_(ut.paint,et.paint,Ce,ct,w),ut.layout=w_(ut.layout,et.layout,Ce,ct,w);const Bt=!L||L(Ce,et,ct,X);if(!Bt)continue;const Ot=new Lw(Ce,this.z,this.x,this.y,Ge);Ot.layer=ut;let Yt=i[$e];void 0===Yt&&(Yt=i[$e]=[]),Yt.push({featureIndex:z,feature:Ot,intersectionZ:Bt})}}lookupSymbolFeatures(i,u,f,m,w,S,M,R){const L={};this.loadVTLayers();const z=Nc(w);for(const V of i)this.loadMatchingFeature(L,{bucketIndex:f,sourceLayerIndex:m,featureIndex:V,layoutVertexArrayOffset:0},z,S,M,R,u);return L}loadFeature(i){const{featureIndex:u,sourceLayerIndex:f}=i;this.loadVTLayers();const m=this.sourceLayerCoder.decode(f),w=this.vtFeatures[m];if(w[u])return w[u];const S=this.vtLayers[m].feature(u);return w[u]=S,S}hasLayer(i){for(const u of this.bucketLayerIDs)for(const f of u)if(i===f)return!0;return!1}getId(i,u){let f=i.id;if(this.promoteId){const m="string"==typeof this.promoteId?this.promoteId:this.promoteId[u];null!=m&&(f=i.properties[m]),"boolean"==typeof f&&(f=Number(f))}return f}}function w_(s,i,u,f,m){return cn(s,(w,S)=>{const M=i instanceof je?i.get(S):null;return M&&M.evaluate?M.evaluate(u,f,m):M})}function Fw(s,i){return i-s}Sn(q0,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class H0{constructor(i,u){this.width=i,this.height=u,this.nextRow=0,this.image=new Vc({width:i,height:u}),this.positions={},this.uploaded=!1}getDash(i,u){const f=this.getKey(i,u);return this.positions[f]}trim(){const i=this.width,u=this.height=Dt(this.nextRow);this.image.resize({width:i,height:u})}getKey(i,u){return i.join(",")+u}getDashRanges(i,u,f){const m=[];let w=i.length%2==1?-i[i.length-1]*f:0,S=i[0]*f,M=!0;m.push({left:w,right:S,isDash:M,zeroLength:0===i[0]});let R=i[0];for(let L=1;L<i.length;L++){M=!M;const z=i[L];w=R*f,R+=z,S=R*f,m.push({left:w,right:S,isDash:M,zeroLength:0===z})}return m}addRoundDash(i,u,f){const m=u/2;for(let w=-f;w<=f;w++){const S=this.width*(this.nextRow+f+w);let M=0,R=i[M];for(let L=0;L<this.width;L++){L/R.right>1&&(R=i[++M]);const z=Math.abs(L-R.left),V=Math.abs(L-R.right),G=Math.min(z,V);let X;const K=w/f*(m+1);if(R.isDash){const ue=m-Math.abs(K);X=Math.sqrt(G*G+ue*ue)}else X=m-Math.sqrt(G*G+K*K);this.image.data[S+L]=Math.max(0,Math.min(255,X+128))}}}addRegularDash(i,u){for(let R=i.length-1;R>=0;--R){const L=i[R],z=i[R+1];L.zeroLength?i.splice(R,1):z&&z.isDash===L.isDash&&(z.left=L.left,i.splice(R,1))}const f=i[0],m=i[i.length-1];f.isDash===m.isDash&&(f.left=m.left-this.width,m.right=f.right+this.width);const w=this.width*this.nextRow;let S=0,M=i[S];for(let R=0;R<this.width;R++){R/M.right>1&&(M=i[++S]);const L=Math.abs(R-M.left),z=Math.abs(R-M.right),V=Math.min(L,z);this.image.data[w+R]=Math.max(0,Math.min(255,(M.isDash?V:-V)+u+128))}}addDash(i,u){const f=this.getKey(i,u);if(this.positions[f])return this.positions[f];const m="round"===u,w=m?7:0,S=2*w+1;if(this.nextRow+S>this.height)return cr("LineAtlas out of space"),null;0===i.length&&i.push(1);let M=0;for(let z=0;z<i.length;z++)i[z]<0&&(cr("Negative value is found in line dasharray, replacing values with 0"),i[z]=0),M+=i[z];if(0!==M){const z=this.width/M,V=this.getDashRanges(i,this.width,z);m?this.addRoundDash(V,z,w):this.addRegularDash(V,"square"===u?.5*z:0)}const R=this.nextRow+w;this.nextRow+=S;const L={tl:[R,w],br:[M,0]};return this.positions[f]=L,L}}Sn(H0,"LineAtlas");const Bw=1*yl;class b_{constructor(i){const u={},f=[];for(const M in i){const R=i[M],L=u[M]={};for(const z in R.glyphs){const V=R.glyphs[+z];if(!V||0===V.bitmap.width||0===V.bitmap.height)continue;const G=V.metrics.localGlyph?Bw:1,X={x:0,y:0,w:V.bitmap.width+2*G,h:V.bitmap.height+2*G};f.push(X),L[z]=X}}const{w:m,h:w}=fa(f),S=new Vc({width:m||1,height:w||1});for(const M in i){const R=i[M];for(const L in R.glyphs){const z=R.glyphs[+L];if(!z||0===z.bitmap.width||0===z.bitmap.height)continue;const V=u[M][L],G=z.metrics.localGlyph?Bw:1;Vc.copy(z.bitmap,S,{x:0,y:0},{x:V.x+G,y:V.y+G},z.bitmap)}}this.image=S,this.positions=u}}Sn(b_,"GlyphAtlas");class W0{constructor(i){this.tileID=new Uu(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.canonical=i.tileID.canonical,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile,this.tileTransform=vh(i.tileID.canonical,i.projection),this.projection=i.projection}parse(i,u,f,m,w){this.status="parsing",this.data=i,this.collisionBoxArray=new Oo;const S=new jd(Object.keys(i.layers).sort()),M=new q0(this.tileID,this.promoteId);M.bucketLayerIDs=[];const R={},L=new H0(256,256),z={featureIndex:M,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:L,availableImages:f},V=u.familiesBySource[this.source];for(const ct in V){const ut=i.layers[ct];if(!ut)continue;let Bt=!1,Ot=!1;for(const jt of V[ct])"symbol"===jt[0].type?Bt=!0:Ot=!0;if(!0===this.isSymbolTile&&!Bt||!1===this.isSymbolTile&&!Ot)continue;1===ut.version&&cr(`Vector tile source "${this.source}" layer "${ct}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Yt=S.encode(ct),yn=[];for(let jt=0;jt<ut.length;jt++){const Qt=ut.feature(jt),en=M.getId(Qt,ct);yn.push({feature:Qt,id:en,index:jt,sourceLayerIndex:Yt})}for(const jt of V[ct]){const Qt=jt[0];void 0!==this.isSymbolTile&&"symbol"===Qt.type!==this.isSymbolTile||Qt.minzoom&&this.zoom<Math.floor(Qt.minzoom)||Qt.maxzoom&&this.zoom>=Qt.maxzoom||"none"!==Qt.visibility&&(Ec(jt,this.zoom,f),(R[Qt.id]=Qt.createBucket({index:M.bucketLayerIDs.length,layers:jt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Yt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:f})).populate(yn,z,this.tileID.canonical,this.tileTransform),M.bucketLayerIDs.push(jt.map(en=>en.id)))}}let G,X,K,ue;L.trim();const Ce={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ge=()=>{if(G)return w(G);if(X&&K&&ue){const ct=new b_(X),ut=new Xy(K,ue);for(const Bt in R){const Ot=R[Bt];Ot instanceof Vf?(Ec(Ot.layers,this.zoom,f),IS(Ot,X,ct.positions,K,ut.iconPositions,this.showCollisionBoxes,f,this.tileID.canonical,this.tileZoom,this.projection)):Ot.hasPattern&&(Ot instanceof Dd||Ot instanceof gh||Ot instanceof Ed)&&(Ec(Ot.layers,this.zoom,f),Ot.addFeatures(z,this.tileID.canonical,ut.patternPositions,f,this.tileTransform))}this.status="done",w(null,{buckets:vt(R).filter(Bt=>!Bt.isEmpty()),featureIndex:M,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ct.image,lineAtlas:L,imageAtlas:ut,glyphMap:this.returnDependencies?X:null,iconMap:this.returnDependencies?K:null,glyphPositions:this.returnDependencies?ct.positions:null})}},nt=cn(z.glyphDependencies,ct=>Object.keys(ct).map(Number));Object.keys(nt).length?m.send("getGlyphs",{uid:this.uid,stacks:nt},(ct,ut)=>{G||(G=ct,X=ut,Ge())},void 0,!1,Ce):X={};const $e=Object.keys(z.iconDependencies);$e.length?m.send("getImages",{icons:$e,source:this.source,tileID:this.tileID,type:"icons"},(ct,ut)=>{G||(G=ct,K=ut,Ge())},void 0,!1,Ce):K={};const et=Object.keys(z.patternDependencies);et.length?m.send("getImages",{icons:et,source:this.source,tileID:this.tileID,type:"patterns"},(ct,ut)=>{G||(G=ct,ue=ut,Ge())},void 0,!1,Ce):ue={},Ge()}}function Ec(s,i,u){const f=new U(i);for(const m of s)m.recalculate(f,u)}class Vr{constructor(i){this.entries={},this.scheduler=i}request(i,u,f,m){const w=this.entries[i]=this.entries[i]||{callbacks:[]};if(w.result){const[S,M]=w.result;return this.scheduler?this.scheduler.add(()=>{m(S,M)},u):m(S,M),()=>{}}return w.callbacks.push(m),w.cancel||(w.cancel=f((S,M)=>{w.result=[S,M];for(const R of w.callbacks)this.scheduler?this.scheduler.add(()=>{R(S,M)},u):R(S,M);setTimeout(()=>delete this.entries[i],3e3)})),()=>{w.result||(w.callbacks=w.callbacks.filter(S=>S!==m),w.callbacks.length||(w.cancel(),delete this.entries[i]))}}}function E_(s,i,u){const f=JSON.stringify(s.request);return s.data&&(this.deduped.entries[f]={result:[null,s.data]}),this.deduped.request(f,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},m=>{const w=Uo(s.request,(S,M,R,L)=>{S?m(S):M&&m(null,{vectorTile:u?void 0:new mh(new Ng(M)),rawData:M,cacheControl:R,expires:L})});return()=>{w.cancel(),m()}},i)}const X0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Gd{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,f]=new Uint8Array(i,0,2);if(219!==u)throw new Error("Data does not appear to be in a KDBush format.");const m=f>>4;if(1!==m)throw new Error(`Got v${m} data when expected v1.`);const w=X0[15&f];if(!w)throw new Error("Unrecognized array type.");const[S]=new Uint16Array(i,2,1),[M]=new Uint32Array(i,4,1);return new Gd(M,S,w,i)}constructor(i,u=64,f=Float64Array,m){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=f,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const w=X0.indexOf(this.ArrayType),S=2*i*this.ArrayType.BYTES_PER_ELEMENT,M=i*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-M%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${f}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+M+R,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+S+M+R),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+M+R,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=i)}add(i,u){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=i,this.coords[this._pos++]=u,f}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return af(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,u,f,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:S,nodeSize:M}=this,R=[0,w.length-1,0],L=[];for(;R.length;){const z=R.pop()||0,V=R.pop()||0,G=R.pop()||0;if(V-G<=M){for(let Ce=G;Ce<=V;Ce++){const Ge=S[2*Ce],nt=S[2*Ce+1];Ge>=i&&Ge<=f&&nt>=u&&nt<=m&&L.push(w[Ce])}continue}const X=G+V>>1,K=S[2*X],ue=S[2*X+1];K>=i&&K<=f&&ue>=u&&ue<=m&&L.push(w[X]),(0===z?i<=K:u<=ue)&&(R.push(G),R.push(X-1),R.push(1-z)),(0===z?f>=K:m>=ue)&&(R.push(X+1),R.push(V),R.push(1-z))}return L}within(i,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:w,nodeSize:S}=this,M=[0,m.length-1,0],R=[],L=f*f;for(;M.length;){const z=M.pop()||0,V=M.pop()||0,G=M.pop()||0;if(V-G<=S){for(let Ce=G;Ce<=V;Ce++)om(w[2*Ce],w[2*Ce+1],i,u)<=L&&R.push(m[Ce]);continue}const X=G+V>>1,K=w[2*X],ue=w[2*X+1];om(K,ue,i,u)<=L&&R.push(m[X]),(0===z?i-f<=K:u-f<=ue)&&(M.push(G),M.push(X-1),M.push(1-z)),(0===z?i+f>=K:u+f>=ue)&&(M.push(X+1),M.push(V),M.push(1-z))}return R}}function af(s,i,u,f,m,w){if(m-f<=u)return;const S=f+m>>1;rm(s,i,S,f,m,w),af(s,i,u,f,S-1,1-w),af(s,i,u,S+1,m,1-w)}function rm(s,i,u,f,m,w){for(;m>f;){if(m-f>600){const L=m-f+1,z=u-f+1,V=Math.log(L),G=.5*Math.exp(2*V/3),X=.5*Math.sqrt(V*G*(L-G)/L)*(z-L/2<0?-1:1);rm(s,i,u,Math.max(f,Math.floor(u-z*G/L+X)),Math.min(m,Math.floor(u+(L-z)*G/L+X)),w)}const S=i[2*u+w];let M=f,R=m;for(Eh(s,i,f,u),i[2*m+w]>S&&Eh(s,i,f,m);M<R;){for(Eh(s,i,M,R),M++,R--;i[2*M+w]<S;)M++;for(;i[2*R+w]>S;)R--}i[2*f+w]===S?Eh(s,i,f,R):(R++,Eh(s,i,R,m)),R<=u&&(f=R+1),u<=R&&(m=R-1)}}function Eh(s,i,u,f){im(s,u,f),im(i,2*u,2*f),im(i,2*u+1,2*f+1)}function im(s,i,u){const f=s[i];s[i]=s[u],s[u]=f}function om(s,i,u,f){const m=s-u,w=i-f;return m*m+w*w}p.ARRAY_TYPE=Su,p.AUTH_ERR_MSG=rt,p.Aabb=Iu,p.Actor=class{constructor(s,i,u){this.target=s,this.parent=i,this.mapId=u,this.callbacks={},this.cancelCallbacks={},_n(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=sr()?s:H,this.scheduler=new p_}send(s,i,u,f,m=!1,w){const S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=w,this.callbacks[S]=u);const M=we(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:s,hasCallback:!!u,targetMapId:f,mustQueue:m,sourceMapId:this.mapId,data:uu(i,M)},M),{cancel:()=>{u&&delete this.callbacks[S],this.target.postMessage({id:S,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(s){const i=s.data,u=i.id;if(u&&(!i.targetMapId||this.mapId===i.targetMapId))if("<cancel>"===i.type){const f=this.cancelCallbacks[u];delete this.cancelCallbacks[u],f&&f.cancel()}else if(i.mustQueue||sr()){const f=this.callbacks[u];this.cancelCallbacks[u]=this.scheduler.add(()=>this.processTask(u,i),f&&f.metadata||{type:"message"})}else this.processTask(u,i)}processTask(s,i){if("<response>"===i.type){const u=this.callbacks[s];delete this.callbacks[s],u&&(i.error?u(Rl(i.error)):u(null,Rl(i.data)))}else{const u=we(this.globalScope)?void 0:[],f=i.hasCallback?(w,S)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:w?uu(w):null,data:uu(S,u)},u)}:w=>{},m=Rl(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,m,f);else if(this.parent.getWorkerSource){const w=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,w[0],m.source)[w[1]](m,f)}else f(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=Ag,p.Color=Qo,p.ColorMode=Nr,p.CullFaceMode=Wc,p.DEMData=Rp,p.DataConstantProperty=oe,p.DedupedRequest=Vr,p.DepthMode=$f,p.EXTENT=ar,p.Elevation=class{isDataAvailableAtPoint(s){const i=this._source();if(this.isUsingMockSource()||!i||s.y<0||s.y>1)return!1;const u=i.getSource().maxzoom,f=1<<u,m=Math.floor(s.x),w=Math.floor((s.x-m)*f),S=Math.floor(s.y*f),M=this.findDEMTileFor(new Uu(u,m,u,w,S));return!(!M||!M.dem)}getAtPointOrZero(s,i=0){return this.getAtPoint(s,i)||0}getAtPoint(s,i,u=!0){if(this.isUsingMockSource())return null;null==i&&(i=null);const f=this._source();if(!f||s.y<0||s.y>1)return i;const m=f.getSource().maxzoom,w=1<<m,S=Math.floor(s.x),M=s.x-S,R=new Uu(m,S,m,Math.floor(M*w),Math.floor(s.y*w)),L=this.findDEMTileFor(R);if(!L||!L.dem)return i;const z=L.dem,V=1<<L.tileID.canonical.z,G=(M*V-L.tileID.canonical.x)*z.dim,X=(s.y*V-L.tileID.canonical.y)*z.dim,K=Math.floor(G),ue=Math.floor(X);return(u?this.exaggeration():1)*In(In(z.get(K,ue),z.get(K,ue+1),X-ue),In(z.get(K+1,ue),z.get(K+1,ue+1),X-ue),G-K)}getAtTileOffset(s,i,u){const f=1<<s.canonical.z;return this.getAtPointOrZero(new dh(s.wrap+(s.canonical.x+i/ar)/f,(s.canonical.y+u/ar)/f))}getAtTileOffsetFunc(s,i,u,f){return m=>{const w=this.getAtTileOffset(s,m.x,m.y),S=f.upVector(s.canonical,m.x,m.y);return hl(S,S,w*f.upVectorScale(s.canonical,i,u).metersToTile),S}}getForTilePoints(s,i,u,f){if(this.isUsingMockSource())return!1;const m=Op.create(this,s,f);return!!m&&(i.forEach(w=>{w[2]=this.exaggeration()*m.getElevationAt(w[0],w[1],u)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(s);if(!i||!i.dem)return null;const u=i.dem.tree,f=i.tileID,m=1<<s.canonical.z-f.canonical.z;let w=s.canonical.x/m-f.canonical.x,S=s.canonical.y/m-f.canonical.y,M=0;for(let R=0;R<s.canonical.z-f.canonical.z&&!u.leaves[M];R++){w*=2,S*=2;const L=2*Math.floor(S)+Math.floor(w);M=u.childOffsets[M]+L,w%=1,S%=1}return{min:this.exaggeration()*u.minimums[M],max:this.exaggeration()*u.maximums[M]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,i,u){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=Gs,p.EvaluationParameters=U,p.Event=ta,p.Evented=na,p.FillExtrusionBucket=Ed,p.Frustum=ay,p.FrustumCorners=lp,p.GLOBE_RADIUS=Zu,p.GLOBE_SCALE_MATCH_LATITUDE=45,p.GLOBE_ZOOM_THRESHOLD_MAX=Pf,p.GLOBE_ZOOM_THRESHOLD_MIN=fd,p.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_fillGridMeshWithLods(s,i){const u=new mn,f=new Jn,m=[],w=s+1+2,S=i[0]+1,M=i[0]+1+(1+i.length),R=(L,z,V)=>{let G=L===w-1?L-2:0===L?L:L-1;return G+=V?24575:0,[G,z]};for(let L=0;L<w;++L)u.emplaceBack(...R(L,0,!0));for(let L=0;L<S;++L)for(let z=0;z<w;++z)u.emplaceBack(...R(z,L,(0===z||z===w-1)&&!0));for(let L=0;L<i.length;++L){const z=i[L];for(let V=0;V<w;++V)u.emplaceBack(...R(V,z,!0))}for(let L=0;L<i.length;++L){const z=f.length,V=i[L]+1+2,G=new Jn;for(let ue=0;ue<V-1;ue++){const Ce=ue===V-2,Ge=Ce?w*(M-i.length+L-ue):w;for(let nt=0;nt<w-1;nt++){const $e=ue*w+nt;0===ue||Ce||0===nt||nt===w-2?(G.emplaceBack($e+1,$e,$e+Ge),G.emplaceBack($e+Ge,$e+Ge+1,$e+1)):(f.emplaceBack($e+1,$e,$e+Ge),f.emplaceBack($e+Ge,$e+Ge+1,$e+1))}}const X=Zo.simpleSegment(0,z,u.length,f.length-z);for(let ue=0;ue<G.uint16.length;ue+=3)f.emplaceBack(G.uint16[ue],G.uint16[ue+1],G.uint16[ue+2]);const K=Zo.simpleSegment(0,z,u.length,f.length-z);m.push({withoutSkirts:X,withSkirts:K})}return{vertices:u,indices:f,segments:m}}_createGrid(s){const i=this._fillGridMeshWithLods(64,Rf);this._gridSegments=i.segments,this._gridBuffer=s.createVertexBuffer(i.vertices,up.members),this._gridIndexBuffer=s.createIndexBuffer(i.indices,!0)}_createPoles(s){const i=new Jn;for(let m=0;m<=64;m++)i.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=s.createIndexBuffer(i,!0);const u=new wo,f=new wo;this._poleSegments=[];for(let m=0,w=0;m<fd;m++){const S=360/(1<<m);u.emplaceBack(0,-Zu,0,.5,0),f.emplaceBack(0,-Zu,0,.5,1);for(let M=0;M<=64;M++){const R=M/64,L=In(0,S,R),[z,V,G]=Bc(hy,yd,L,Zu);u.emplaceBack(z,V,G,R,0),f.emplaceBack(z,V,G,R,1)}this._poleSegments.push(Zo.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(u,sy,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(f,sy,!1)}getGridBuffers(s,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,i){if(!this._wireframeSegments){const u=new Na,f=64,m=f+1+2,w=1;this._wireframeSegments=[];for(let S=0,M=0;S<Rf.length;S++){const R=Rf[S];for(let z=w;z<R+w;z++)for(let V=w;V<f+w;V++){const G=z*m+V;u.emplaceBack(G,G+1),u.emplaceBack(G,G+m),u.emplaceBack(G,G+m+1)}const L=R*f*3;this._wireframeSegments.push(Zo.simpleSegment(0,M,(R+1)*m,L)),M+=L}this._wireframeIndexBuffer=s.createIndexBuffer(u)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[i]]}},p.GlyphManager=ef,p.ImagePosition=Wy,p.KDBush=Gd,p.LivePerformanceUtils=co,p.LngLat=ko,p.LngLatBounds=gc,p.LocalGlyphMode=n_,p.MAX_MERCATOR_LATITUDE=Sa,p.MercatorCoordinate=dh,p.ONE_EM=Ya,p.OverscaledTileID=Uu,p.PerformanceMarkers=du,p.Point=Z,p.Properties=He,p.RGBAImage=Ku,p.Ray=ag,p.RequestManager=class{constructor(s,i,u){this._transformRequestFn=s,this._customAccessToken=i,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const s=function(){let i="";for(let u=0;u<10;u++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ie,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,i){return this._transformRequestFn&&this._transformRequestFn(s,i)||{url:s}}normalizeStyleURL(s,i){if(!Ve(s))return s;const u=bn(s);return u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||i)}normalizeGlyphsURL(s,i){if(!Ve(s))return s;const u=bn(s);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||i)}normalizeSourceURL(s,i,u,f){if(!Ve(s))return s;const m=bn(s);return m.path=`/v4/${m.authority}.json`,m.params.push("secure"),u&&m.params.push(`language=${u}`),f&&m.params.push(`worldview=${f}`),this._makeAPIURL(m,this._customAccessToken||i)}normalizeSpriteURL(s,i,u,f){const m=bn(s);return Ve(s)?(m.path=`/styles/v1${m.path}/sprite${i}${u}`,this._makeAPIURL(m,this._customAccessToken||f)):(m.path+=`${i}${u}`,fn(m))}normalizeTileURL(s,i,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Ve(s))return s;const f=bn(s);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||u&&"raster"!==f.authority&&512===u?"@2x":""}${ze.supported?".webp":"$1"}`),"raster"===f.authority?f.path=`/${Ie.RASTER_URL_PREFIX}${f.path}`:(f.path=f.path.replace(/^.+\/v4\//,"/"),f.path=`/${Ie.TILE_URL_VERSION}${f.path}`);const m=this._customAccessToken||function(w){for(const S of w){const M=S.match(/^access_token=(.*)$/);if(M)return M[1]}return null}(f.params)||Ie.ACCESS_TOKEN;return Ie.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&f.params.push(`sku=${this._skuToken}`),this._makeAPIURL(f,m)}canonicalizeTileURL(s,i){const u=bn(s);if(!u.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!u.path.match(/\.[\w]+$/))return s;let f="mapbox://";u.path.match(/^\/raster\/v1\//)?f+=`raster/${u.path.replace(`/${Ie.RASTER_URL_PREFIX}/`,"")}`:f+=`tiles/${u.path.replace(`/${Ie.TILE_URL_VERSION}/`,"")}`;let m=u.params;return i&&(m=m.filter(w=>!w.match(/^access_token=/))),m.length&&(f+=`?${m.join("&")}`),f}canonicalizeTileset(s,i){const u=!!i&&Ve(i),f=[];for(const m of s.tiles||[])It(m)?f.push(this.canonicalizeTileURL(m,u)):f.push(m);return f}_makeAPIURL(s,i){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",f=bn(Ie.API_URL);if(s.protocol=f.protocol,s.authority=f.authority,"http"===s.protocol){const m=s.params.indexOf("secure");m>=0&&s.params.splice(m,1)}if("/"!==f.path&&(s.path=`${f.path}${s.path}`),!Ie.REQUIRE_ACCESS_TOKEN)return fn(s);if(i=i||Ie.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return s.params=s.params.filter(m=>-1===m.indexOf("access_token")),s.params.push(`access_token=${i||""}`),fn(s)}},p.ResourceType=si,p.SegmentVector=Zo,p.SourceCache=qf,p.StencilMode=tm,p.StructArrayLayout1ui2=cl,p.StructArrayLayout2f1f2i16=fr,p.StructArrayLayout2i4=mn,p.StructArrayLayout2ui4=Na,p.StructArrayLayout3f12=ei,p.StructArrayLayout3ui6=Jn,p.StructArrayLayout4i8=Kt,p.StructArrayLayout5f20=wo,p.Texture=sf,p.Tile=g_,p.Transitionable=te,p.Uniform1f=od,p.Uniform1i=class extends pc{constructor(s){super(s),this.current=0}set(s,i,u){this.fetchUniformLocation(s,i)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},p.Uniform2f=class extends pc{constructor(s){super(s),this.current=[0,0]}set(s,i,u){this.fetchUniformLocation(s,i)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}},p.Uniform3f=class extends pc{constructor(s){super(s),this.current=[0,0,0]}set(s,i,u){this.fetchUniformLocation(s,i)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}},p.Uniform4f=Km,p.UniformColor=eg,p.UniformMatrix2f=class extends pc{constructor(s){super(s),this.current=Jm}set(s,i,u){if(this.fetchUniformLocation(s,i))for(let f=0;f<4;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}},p.UniformMatrix3f=class extends pc{constructor(s){super(s),this.current=Ov}set(s,i,u){if(this.fetchUniformLocation(s,i))for(let f=0;f<9;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix3fv(this.location,!1,u);break}}},p.UniformMatrix4f=class extends pc{constructor(s){super(s),this.current=zx}set(s,i,u){if(this.fetchUniformLocation(s,i)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let f=1;f<16;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}},p.UnwrappedTileID=By,p.ValidationError=An,p.VectorTileFeature=vp,p.VectorTileWorkerSource=class extends na{constructor(s,i,u,f,m){super(),this.actor=s,this.layerIndex=i,this.availableImages=u,this.loadVectorData=m||E_,this.loading={},this.loaded={},this.deduped=new Vr(s.scheduler),this.isSpriteLoaded=f,this.scheduler=s.scheduler}loadTile(s,i){const u=s.uid,f=s&&s.request,m=f&&f.collectResourceTiming,w=this.loading[u]=new W0(s);w.abort=this.loadVectorData(s,(S,M)=>{const R=!this.loading[u];if(delete this.loading[u],R||S||!M)return w.status="done",R||(this.loaded[u]=w),i(S);const L=M.rawData,z={};M.expires&&(z.expires=M.expires),M.cacheControl&&(z.cacheControl=M.cacheControl),w.vectorTile=M.vectorTile||new mh(new Ng(L));const V=()=>{w.parse(w.vectorTile,this.layerIndex,this.availableImages,this.actor,(G,X)=>{if(G||!X)return i(G);const K={};if(m){const ue=Lh(f);ue.length>0&&(K.resourceTiming=JSON.parse(JSON.stringify(ue)))}i(null,Le({rawTileData:L.slice(0)},X,z,K))})};this.isSpriteLoaded?V():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(V,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):V()}),this.loaded=this.loaded||{},this.loaded[u]=w})}reloadTile(s,i){const u=this.loaded,f=s.uid,m=this;if(u&&u[f]){const w=u[f];w.showCollisionBoxes=s.showCollisionBoxes,w.enableTerrain=!!s.enableTerrain,w.projection=s.projection,w.tileTransform=vh(s.tileID.canonical,s.projection);const S=(M,R)=>{const L=w.reloadCallback;L&&(delete w.reloadCallback,w.parse(w.vectorTile,m.layerIndex,this.availableImages,m.actor,L)),i(M,R)};"parsing"===w.status?w.reloadCallback=S:"done"===w.status&&(w.vectorTile?w.parse(w.vectorTile,this.layerIndex,this.availableImages,this.actor,S):S())}}abortTile(s,i){const u=s.uid,f=this.loading[u];f&&(f.abort&&f.abort(),delete this.loading[u]),i()}removeTile(s,i){const u=this.loaded,f=s.uid;u&&u[f]&&delete u[f],i()}},p.WritingMode=ml,p.ZoomDependentExpression=Pa,p.add=hh,p.addDynamicAttributes=Zg,p.adjoint=function(s,i){var u=i[0],f=i[1],m=i[2],w=i[3],S=i[4],M=i[5],R=i[6],L=i[7],z=i[8];return s[0]=S*z-M*L,s[1]=m*L-f*z,s[2]=f*M-m*S,s[3]=M*R-w*z,s[4]=u*z-m*R,s[5]=m*w-u*M,s[6]=w*L-S*R,s[7]=f*R-u*L,s[8]=u*S-f*w,s},p.asyncAll=at,p.bezier=Wt,p.bindAll=_n,p.boundsAttributes=U0,p.bufferConvexPolygon=function(s,i){const u=[];for(let f=0;f<s.length;f++){const m=Fe(f-1,-1,s.length-1),w=Fe(f+1,-1,s.length-1),S=s[f],M=s[w],R=s[m].sub(S).unit(),L=M.sub(S).unit(),z=L.angleWithSep(R.x,R.y),V=R.add(L).unit().mult(-1*i/Math.sin(z/2));u.push(S.add(V))}return u},p.cacheEntryPossiblyAdded=function(s){br++,br>rn&&(s.getActor().send("enforceCacheSizeLimit",Vt),br=0)},p.calculateGlobeLabelMatrix=function(s,i){const{x:u,y:f}=s.point,m=$v(u,f,s.worldSize/s._pixelsPerMercatorPixel,0,0);return ic(m,m,Lf(fh(i)))},p.calculateGlobeMatrix=function(s){const{x:i,y:u}=s.point,{lng:f,lat:m}=s._center;return $v(i,u,s.worldSize,f,m)},p.calculateGlobeMercatorMatrix=function(s){const i=s.pixelsPerMeter,u=i/yc(1,s.center.lat),f=rc(new Float64Array(16));return lh(f,f,[s.point.x,s.point.y,0]),Df(f,f,[u,u,i]),Float32Array.from(f)},p.circumferenceAtLatitude=dy,p.clamp=De,p.clearTileCache=function(s){if(!hr())return;const i=H.caches.delete(yt);s&&i.catch(s).then(()=>s())},p.clipLine=t_,p.clone=function(s){var i=new Su(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},p.clone$1=sn,p.collisionCircleLayout=yw,p.config=Ie,p.conjugate=function(s,i){return s[0]=-i[0],s[1]=-i[1],s[2]=-i[2],s[3]=i[3],s},p.create=function(){var s=new Su(16);return Su!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},p.create$1=rg,p.createExpression=la,p.createLayout=Et,p.createStyleLayer=function(s){return"custom"===s.type?new F0(s):new Pw[s.type](s)},p.cross=ty,p.degToRad=qe,p.distance=function(s,i){return Math.hypot(i[0]-s[0],i[1]-s[1],i[2]-s[2])},p.div=function(s,i,u){return s[0]=i[0]/u[0],s[1]=i[1]/u[1],s[2]=i[2]/u[2],s},p.dot=Ea,p.earthRadius=ug,p.ease=At,p.easeCubicInOut=Ae,p.ecefToLatLng=function([s,i,u]){const f=Math.hypot(s,i,u),m=Math.atan2(s,u),w=.5*Math.PI-Math.acos(-i/f);return new ko(Ue(m),Ue(w))},p.emitValidationErrors=$t,p.endsWith=Cn,p.enforceCacheSizeLimit=function(s){yr(),tn&&tn.then(i=>{i.keys().then(u=>{for(let f=0;f<u.length-s;f++)i.delete(u[f])})})},p.evaluateSizeForFeature=Qh,p.evaluateSizeForZoom=Pd,p.evaluateVariableOffset=kf,p.evented=I,p.exactEquals=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]&&s[3]===i[3]},p.exactEquals$1=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]},p.exported=Ss,p.exported$1=ze,p.extend=Le,p.extend$1=pu,p.fillExtrusionHeightLift=Dg,p.filterObject=En,p.fromMat4=function(s,i){return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[4],s[4]=i[5],s[5]=i[6],s[6]=i[8],s[7]=i[9],s[8]=i[10],s},p.fromQuat=function(s,i){var u=i[0],f=i[1],m=i[2],w=i[3],S=u+u,M=f+f,R=m+m,L=u*S,z=f*S,V=f*M,G=m*S,X=m*M,K=m*R,ue=w*S,Ce=w*M,Ge=w*R;return s[0]=1-V-K,s[1]=z+Ge,s[2]=G-Ce,s[3]=0,s[4]=z-Ge,s[5]=1-L-K,s[6]=X+ue,s[7]=0,s[8]=G+Ce,s[9]=X-ue,s[10]=1-L-V,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},p.fromRotation=function(s,i){var u=Math.sin(i),f=Math.cos(i);return s[0]=f,s[1]=u,s[2]=0,s[3]=-u,s[4]=f,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},p.fromScaling=jx,p.furthestTileCorner=function(s){const i=Math.round((s+45+360)%360/90)%4;return Ye[i]},p.getAABBPointSquareDist=function(s,i,u){let f=0;for(let m=0;m<2;++m){const w=u?u[m]:0;s[m]>w&&(f+=(s[m]-w)*(s[m]-w)),i[m]<w&&(f+=(w-i[m])*(w-i[m]))}return f},p.getAnchorAlignment=Bg,p.getAnchorJustification=A0,p.getBounds=function(s){let i=1/0,u=1/0,f=-1/0,m=-1/0;for(const w of s)i=Math.min(i,w.x),u=Math.min(u,w.y),f=Math.max(f,w.x),m=Math.max(m,w.y);return{min:new Z(i,u),max:new Z(f,m)}},p.getColumn=Ze,p.getDefaultExportFromCjs=W,p.getGridMatrix=function(s,i,u,f){const m=i.getNorth(),w=i.getSouth(),S=i.getWest(),M=i.getEast(),R=1<<s.z,L=M-S,z=m-w,V=L/64,G=-z/Rf[u],X=[0,V,0,G,0,0,m,S,0];if(s.z>0){const K=180/f;Qm(X,X,[K/L+1,0,0,0,K/z+1,0,-.5*K/V,.5*K/G,1])}return X[2]=R,X[5]=s.x,X[8]=s.y,X},p.getImage=We,p.getJSON=function(s,i){return Ii(Le(s,{type:"json"}),i)},p.getLatitudinalLod=function(s){const i=Sa-5;s=De(s,-i,i)/i*90;const u=Math.pow(Math.abs(Math.sin(qe(s))),3);return Math.round(u*(Rf.length-1))},p.getMapSessionAPI=lo,p.getPerformanceMeasurement=Lh,p.getProjection=Xg,p.getRTLTextPluginStatus=A,p.getReferrer=ni,p.getTilePoint=function(s,{x:i,y:u},f=0){return new Z(((i-f)*s.scale-s.x)*ar,(u*s.scale-s.y)*ar)},p.getTileVec3=function(s,i,u=0){return ch(((i.x-u)*s.scale-s.x)*ar,(i.y*s.scale-s.y)*ar,Wv(i.z,i.y))},p.getVideo=function(s,i){const u=H.document.createElement("video");u.muted=!0,u.onloadstart=function(){i(null,u)};for(let f=0;f<s.length;f++){const m=H.document.createElement("source");ys(s[f])||(u.crossOrigin="Anonymous"),m.src=s[f],u.appendChild(m)}return{cancel:()=>{}}},p.globeCenterToScreenPoint=function(s){const i=[0,0,0],u=rc(new Float64Array(16));return ic(u,s.pixelMatrix,s.globeMatrix),ds(i,i,u),new Z(i[0],i[1])},p.globeDenormalizeECEF=Lf,p.globeECEFOrigin=function(s,i){const u=[0,0,0];return ds(u,u,Xh(fh(i.canonical))),ds(u,u,s),u},p.globeMetersToEcef=uy,p.globeNormalizeECEF=Xh,p.globePixelsToTileUnits=function(s,i){return ar/(512*Math.pow(2,s))*Wh(fh(i))},p.globePoleMatrixForTile=function(s,i,u){const f=rc(new Float64Array(16)),m=(i/(1<<s)-.5)*Math.PI*2;return ad(f,u.globeMatrix,m),Float32Array.from(f)},p.globeTileBounds=fh,p.globeTiltAtLngLat=qv,p.globeToMercatorTransition=cp,p.globeUseCustomAntiAliasing=function(s,i,u){const f=cp(u.zoom),m=s.style.map._antialias,w=!!i.extStandardDerivatives,S=i.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return 0===f&&!m&&!S&&w},p.identity=rc,p.identity$1=Vv,p.invert=ey,p.isFullscreen=function(){return!!H.document.fullscreenElement||!!H.document.webkitFullscreenElement},p.isLngLatBehindGlobe=Hv,p.isMapAuthenticated=function(s){return ai.has(s)},p.isMapboxURL=Ve,p.isSafariWithAntialiasingBug=function(s){const i=s.navigator?s.navigator.userAgent:null;return!!we(s)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=Ca,p.latLngToECEF=md,p.len=qx,p.length=ud,p.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},p.lngFromMercatorX=Yu,p.loadVectorTile=E_,p.makeRequest=Ii,p.mapValue=function(s,i,u,f,m){return De((s-i)/(u-i)*(m-f)+f,f,m)},p.mercatorScale=Xv,p.mercatorXfromLng=zc,p.mercatorYfromLat=Uc,p.mercatorZfromAltitude=yc,p.mul=Gx,p.mul$1=ny,p.multiply=ic,p.multiply$1=Qm,p.multiply$2=ig,p.nextPowerOfTwo=Dt,p.normalize=Fu,p.normalize$1=Hx,p.normalize$2=iy,p.number=In,p.ortho=function(s,i,u,f,m,w,S){var M=1/(i-u),R=1/(f-m),L=1/(w-S);return s[0]=-2*M,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*R,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*L,s[11]=0,s[12]=(i+u)*M,s[13]=(m+f)*R,s[14]=(S+w)*L,s[15]=1,s},p.pbf=Vy,p.perspective=function(s,i,u,f,m){var w,S=1/Math.tan(i/2);return s[0]=S/u,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=S,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,null!=m&&m!==1/0?(s[10]=(m+f)*(w=1/(f-m)),s[14]=2*m*f*w):(s[10]=-1,s[14]=-2*f),s},p.pick=function(s,i){const u={};for(let f=0;f<i.length;f++){const m=i[f];m in s&&(u[m]=s[m])}return u},p.plugin=k,p.pointGeometry=ne,p.polesInViewport=function(s){const i=rc(new Float64Array(16));ic(i,s.pixelMatrix,s.globeMatrix);const u=[0,Tu,0],f=[0,mc,0];return ds(u,u,i),ds(f,f,i),[u[0]>0&&u[0]<=s.width&&u[1]>0&&u[1]<=s.height&&!Hv(s,new ko(s.center.lat,90)),f[0]>0&&f[0]<=s.width&&f[1]>0&&f[1]<=s.height&&!Hv(s,new ko(s.center.lat,-90))]},p.polygonContainsPoint=_d,p.polygonIntersectsBox=vy,p.polygonIntersectsPolygon=Yv,p.polygonizeBounds=function(s,i,u=0,f=!0){const m=new Z(u,u),w=s.sub(m),S=i.add(m),M=[w,new Z(S.x,w.y),S,new Z(w.x,S.y)];return f&&M.push(w.clone()),M},p.posAttributes=up,p.postMapLoadEvent=Io,p.postPerformanceEvent=Ti,p.postTurnstileEvent=Zr,p.potpack=fa,p.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},p.radToDeg=Ue,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(s){return s({pluginStatus:v,pluginURL:l}),I.on("pluginStateChange",s),s},p.removeAuthState=function(s){ai.delete(s)},p.renderColorRamp=vg,p.resample=gy,p.rotateX=Bv,p.rotateX$1=ap,p.rotateY=ad,p.rotateY$1=qh,p.rotateZ=function(s,i,u){var f=Math.sin(u),m=Math.cos(u),w=i[0],S=i[1],M=i[2],R=i[3],L=i[4],z=i[5],V=i[6],G=i[7];return i!==s&&(s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=w*m+L*f,s[1]=S*m+z*f,s[2]=M*m+V*f,s[3]=R*m+G*f,s[4]=L*m-w*f,s[5]=z*m-S*f,s[6]=V*m-M*f,s[7]=G*m-R*f,s},p.rotateZ$1=function(s,i,u){u*=.5;var f=i[0],m=i[1],w=i[2],S=i[3],M=Math.sin(u),R=Math.cos(u);return s[0]=f*R+m*M,s[1]=m*R-f*M,s[2]=w*R+S*M,s[3]=S*R-w*M,s},p.scale=Df,p.scale$1=ry,p.scale$2=hl,p.scaleAndAdd=cd,p.set=function(s,i,u,f){return s[0]=i,s[1]=u,s[2]=f,s},p.setCacheLimits=function(s,i){Vt=s,rn=i},p.setColumn=function(s,i,u){s[4*i+0]=u[0],s[4*i+1]=u[1],s[4*i+2]=u[2],s[4*i+3]=u[3]},p.setRTLTextPlugin=function(s,i,u=!1){if(v===Ef||v===zh||v===op)throw new Error("setRTLTextPlugin cannot be called multiple times.");l=Ss.resolveURL(s),v=Ef,Cf=i,E(),u||O()},p.smoothstep=pt,p.spec=Ht,p.squaredLength=function(s){var i=s[0],u=s[1],f=s[2];return i*i+u*u+f*f},p.storeAuthState=function(s,i){i?ai.add(s):ai.delete(s)},p.sub=Fl,p.subtract=ld,p.symbolSize=mS,p.tileAABB=function(s,i,u,f,m,w,S,M,R){if("globe"===R.name)return function aS(s,i,u){const f=i/s.worldSize,m=s.globeMatrix;if(u.z<=1){const Ot=fh(u).getCorners();return Zx(Ot,m,f),Iu.fromPoints(Ot)}const w=ha(u),S=ly(w);Zx(S,m,f);const M=Number.MAX_VALUE,R=[-M,-M,-M],L=[M,M,M];if(w.contains(s.center)){for(const yn of S)Gh(L,L,yn),og(R,R,yn);R[2]=0;const Ot=s.point,Yt=[Ot.x*f,Ot.y*f,0];return Gh(L,L,Yt),og(R,R,Yt),new Iu(L,R)}const z=[m[12]*f,m[13]*f,m[14]*f],V=w.getCenter(),G=De(s.center.lat,-Sa,Sa),X=De(V.lat,-Sa,Sa),K=zc(s.center.lng),ue=Uc(G);let Ce=K-zc(V.lng);const Ge=ue-Uc(X);Ce>.5?Ce-=1:Ce<-.5&&(Ce+=1);let nt=0;Math.abs(Ce)>Math.abs(Ge)?nt=Ce>=0?1:3:(nt=Ge>=0?0:2,cd(z,z,[m[4]*f,m[5]*f,m[6]*f],-Math.sin(qe(Ge>=0?w.getSouth():w.getNorth()))*Zu));const $e=S[nt],et=S[(nt+1)%4],ct=new sS($e,et,z),ut=[Gv(ct,0)||$e[0],Gv(ct,1)||$e[1],Gv(ct,2)||$e[2]],Bt=cp(s.zoom);if(Bt>0){const Ot=function({x:yn,y:jt,z:Qt},en,ln,xn,Xt){const Ln=1/(1<<Qt);let Fn=yn*Ln,On=Fn+Ln,jr=jt*Ln,wn=jr+Ln,or=0;const Fr=(Fn+On)/2-xn;return Fr>.5?or=-1:Fr<-.5&&(or=1),Fn=((Fn+or)*en-(xn*=en))*ln+xn,On=((On+or)*en-xn)*ln+xn,jr=(jr*en-(Xt*=en))*ln+Xt,wn=(wn*en-Xt)*ln+Xt,[[Fn,wn,0],[On,wn,0],[On,jr,0],[Fn,jr,0]]}(u,i,s._pixelsPerMercatorPixel,K,ue);for(let yn=0;yn<S.length;yn++)pd(S[yn],Ot[yn],Bt);const Yt=hh([],Ot[nt],Ot[(nt+1)%4]);hl(Yt,Yt,.5),pd(ut,Yt,Bt)}for(const Ot of S)Gh(L,L,Ot),og(R,R,Ot);return L[2]=Math.min($e[2],et[2]),Gh(L,L,ut),og(R,R,ut),new Iu(L,R)}(s,i,new Ag(u,f,m));const L=vh({z:u,x:f,y:m},R);return new Iu([(w+L.x/L.scale)*i,i*(L.y/L.scale),S],[(w+L.x2/L.scale)*i,i*(L.y2/L.scale),M])},p.tileCornersToBounds=ha,p.tileTransform=vh,p.transformMat3=function(s,i,u){var f=i[0],m=i[1],w=i[2];return s[0]=f*u[0]+m*u[3]+w*u[6],s[1]=f*u[1]+m*u[4]+w*u[7],s[2]=f*u[2]+m*u[5]+w*u[8],s},p.transformMat4=ds,p.transformMat4$1=$h,p.transformQuat=sg,p.transitionTileAABBinECEF=gd,p.translate=lh,p.transpose=function(s,i){if(s===i){var u=i[1],f=i[2],m=i[5];s[1]=i[3],s[2]=i[6],s[3]=u,s[5]=i[7],s[6]=f,s[7]=m}else s[0]=i[0],s[1]=i[3],s[2]=i[6],s[3]=i[1],s[4]=i[4],s[5]=i[7],s[6]=i[2],s[7]=i[5],s[8]=i[8];return s},p.triggerPluginCompletionEvent=g,p.uniqueId=zt,p.updateGlobeVertexNormal=function(s,i,u,f,m){const w=5*i+2;s.float32[w+0]=u,s.float32[w+1]=f,s.float32[w+2]=m},p.validateCustomStyleLayer=function(s){const i=[],u=s.id;return void 0===u&&i.push({message:`layers.${u}: missing required property "id"`}),void 0===s.render&&i.push({message:`layers.${u}: missing required method "render"`}),s.renderingMode&&"2d"!==s.renderingMode&&"3d"!==s.renderingMode&&i.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),i},p.validateFilter=s=>Lt(Ra(s)),p.validateFog=s=>Lt(x(s)),p.validateLayer=s=>Lt(Oa(s)),p.validateLight=s=>Lt(h(s)),p.validateSource=s=>Lt(ah(s)),p.validateStyle=ce,p.validateTerrain=s=>Lt(y(s)),p.values=vt,p.vectorTile=Tg,p.version=fe,p.warnOnce=cr,p.window=H,p.wrap=Fe}),de(0,function(p){function H(Ke){if("number"==typeof Ke||"boolean"==typeof Ke||"string"==typeof Ke||null==Ke)return JSON.stringify(Ke);if(Array.isArray(Ke)){let ye="[";for(const We of Ke)ye+=`${H(We)},`;return`${ye}]`}let ge="{";for(const ye of Object.keys(Ke).sort())ge+=`${ye}:${H(Ke[ye])},`;return`${ge}}`}function fe(Ke){let ge="";for(const ye of p.refProperties)ge+=`/${H(Ke[ye])}`;return ge}class ve{constructor(ge){this.keyCache={},ge&&this.replace(ge)}replace(ge){this._layerConfigs={},this._layers={},this.update(ge,[])}update(ge,ye){for(const rt of ge)this._layerConfigs[rt.id]=rt,(this._layers[rt.id]=p.createStyleLayer(rt)).compileFilter(),this.keyCache[rt.id]&&delete this.keyCache[rt.id];for(const rt of ye)delete this.keyCache[rt],delete this._layerConfigs[rt],delete this._layers[rt];this.familiesBySource={};const We=function(rt,Ve){const It={};for(let tt=0;tt<rt.length;tt++){const Ft=Ve&&Ve[rt[tt].id]||fe(rt[tt]);Ve&&(Ve[rt[tt].id]=Ft);let hn=It[Ft];hn||(hn=It[Ft]=[]),hn.push(rt[tt])}const Ct=[];for(const tt in It)Ct.push(It[tt]);return Ct}(p.values(this._layerConfigs),this.keyCache);for(const rt of We){const Ve=rt.map(bn=>this._layers[bn.id]),It=Ve[0];if("none"===It.visibility)continue;const Ct=It.source||"";let tt=this.familiesBySource[Ct];tt||(tt=this.familiesBySource[Ct]={});const Ft=It.sourceLayer||"_geojsonTileLayer";let hn=tt[Ft];hn||(hn=tt[Ft]=[]),hn.push(Ve)}}}class Ie{loadTile(ge,ye){const{uid:We,encoding:rt,rawImageData:Ve,padding:It,buildQuadTree:Ct}=ge,tt=p.window.ImageBitmap&&Ve instanceof p.window.ImageBitmap?this.getImageData(Ve,It):Ve;ye(null,new p.DEMData(We,tt,rt,It<1,Ct))}getImageData(ge,ye){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ge.width,ge.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ge.width,this.offscreenCanvas.height=ge.height,this.offscreenCanvasContext.drawImage(ge,0,0,ge.width,ge.height);const We=this.offscreenCanvasContext.getImageData(-ye,-ye,ge.width+2*ye,ge.height+2*ye);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),We}}function ze(Ke,ge){if(0!==Ke.length){_t(Ke[0],ge);for(var ye=1;ye<Ke.length;ye++)_t(Ke[ye],!ge)}}function _t(Ke,ge){for(var ye=0,We=0,rt=0,Ve=Ke.length,It=Ve-1;rt<Ve;It=rt++){var Ct=(Ke[rt][0]-Ke[It][0])*(Ke[It][1]+Ke[rt][1]),tt=ye+Ct;We+=Math.abs(ye)>=Math.abs(Ct)?ye-tt+Ct:Ct-tt+ye,ye=tt}ye+We>=0!=!!ge&&Ke.reverse()}var dt=p.getDefaultExportFromCjs(function Ke(ge,ye){var We,rt=ge&&ge.type;if("FeatureCollection"===rt)for(We=0;We<ge.features.length;We++)Ke(ge.features[We],ye);else if("GeometryCollection"===rt)for(We=0;We<ge.geometries.length;We++)Ke(ge.geometries[We],ye);else if("Feature"===rt)Ke(ge.geometry,ye);else if("Polygon"===rt)ze(ge.coordinates,ye);else if("MultiPolygon"===rt)for(We=0;We<ge.coordinates.length;We++)ze(ge.coordinates[We],ye);return ge});const Je=p.VectorTileFeature.prototype.toGeoJSON;var ht={exports:{}},xt=p.pointGeometry,ie=p.vectorTile.VectorTileFeature,W=J;function J(Ke,ge){this.options=ge||{},this.features=Ke,this.length=Ke.length}function re(Ke,ge){this.id="number"==typeof Ke.id?Ke.id:void 0,this.type=Ke.type,this.rawGeometry=1===Ke.type?[Ke.geometry]:Ke.geometry,this.properties=Ke.tags,this.extent=ge||4096}J.prototype.feature=function(Ke){return new re(this.features[Ke],this.options.extent)},re.prototype.loadGeometry=function(){var Ke=this.rawGeometry;this.geometry=[];for(var ge=0;ge<Ke.length;ge++){for(var ye=Ke[ge],We=[],rt=0;rt<ye.length;rt++)We.push(new xt(ye[rt][0],ye[rt][1]));this.geometry.push(We)}return this.geometry},re.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ke=this.geometry,ge=1/0,ye=-1/0,We=1/0,rt=-1/0,Ve=0;Ve<Ke.length;Ve++)for(var It=Ke[Ve],Ct=0;Ct<It.length;Ct++){var tt=It[Ct];ge=Math.min(ge,tt.x),ye=Math.max(ye,tt.x),We=Math.min(We,tt.y),rt=Math.max(rt,tt.y)}return[ge,We,ye,rt]},re.prototype.toGeoJSON=ie.prototype.toGeoJSON;var Y=p.pbf,ne=W;function ee(Ke){var ge=new Y;return function(ye,We){for(var rt in ye.layers)We.writeMessage(3,Z,ye.layers[rt])}(Ke,ge),ge.finish()}function Z(Ke,ge){var ye;ge.writeVarintField(15,Ke.version||1),ge.writeStringField(1,Ke.name||""),ge.writeVarintField(5,Ke.extent||4096);var We={keys:[],values:[],keycache:{},valuecache:{}};for(ye=0;ye<Ke.length;ye++)We.feature=Ke.feature(ye),ge.writeMessage(2,me,We);var rt=We.keys;for(ye=0;ye<rt.length;ye++)ge.writeStringField(3,rt[ye]);var Ve=We.values;for(ye=0;ye<Ve.length;ye++)ge.writeMessage(4,Ae,Ve[ye])}function me(Ke,ge){var ye=Ke.feature;void 0!==ye.id&&ge.writeVarintField(1,ye.id),ge.writeMessage(2,Q,Ke),ge.writeVarintField(3,ye.type),ge.writeMessage(4,Ye,ye)}function Q(Ke,ge){var ye=Ke.feature,We=Ke.keys,rt=Ke.values,Ve=Ke.keycache,It=Ke.valuecache;for(var Ct in ye.properties){var tt=ye.properties[Ct],Ft=Ve[Ct];if(null!==tt){void 0===Ft&&(We.push(Ct),Ve[Ct]=Ft=We.length-1),ge.writeVarint(Ft);var hn=typeof tt;"string"!==hn&&"boolean"!==hn&&"number"!==hn&&(tt=JSON.stringify(tt));var bn=hn+":"+tt,fn=It[bn];void 0===fn&&(rt.push(tt),It[bn]=fn=rt.length-1),ge.writeVarint(fn)}}}function qe(Ke,ge){return(ge<<3)+(7&Ke)}function Ue(Ke){return Ke<<1^Ke>>31}function Ye(Ke,ge){for(var ye=Ke.loadGeometry(),We=Ke.type,rt=0,Ve=0,It=ye.length,Ct=0;Ct<It;Ct++){var tt=ye[Ct],Ft=1;1===We&&(Ft=tt.length),ge.writeVarint(qe(1,Ft));for(var hn=3===We?tt.length-1:tt.length,bn=0;bn<hn;bn++){1===bn&&1!==We&&ge.writeVarint(qe(2,hn-1));var fn=tt[bn].x-rt,Rr=tt[bn].y-Ve;ge.writeVarint(Ue(fn)),ge.writeVarint(Ue(Rr)),rt+=fn,Ve+=Rr}3===We&&ge.writeVarint(qe(7,1))}}function Ae(Ke,ge){var ye=typeof Ke;"string"===ye?ge.writeStringField(1,Ke):"boolean"===ye?ge.writeBooleanField(7,Ke):"number"===ye&&(Ke%1!=0?ge.writeDoubleField(3,Ke):Ke<0?ge.writeSVarintField(6,Ke):ge.writeVarintField(5,Ke))}ht.exports=ee,ht.exports.fromVectorTileJs=ee,ht.exports.fromGeojsonVt=function(Ke,ge){ge=ge||{};var ye={};for(var We in Ke)ye[We]=new ne(Ke[We].features,ge),ye[We].name=We,ye[We].version=ge.version,ye[We].extent=ge.extent;return ee({layers:ye})},ht.exports.GeoJSONWrapper=ne;var Wt=p.getDefaultExportFromCjs(ht.exports);const At={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ke=>Ke},De=Math.fround||(pt=new Float32Array(1),Ke=>(pt[0]=+Ke,pt[0]));var pt;const Fe=3,at=5,vt=6;class Le{constructor(ge){this.options=Object.assign(Object.create(At),ge),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ge){const{log:ye,minZoom:We,maxZoom:rt}=this.options;ye&&console.time("total time");const Ve=`prepare ${ge.length} points`;ye&&console.time(Ve),this.points=ge;const It=[];for(let tt=0;tt<ge.length;tt++){const Ft=ge[tt];if(!Ft.geometry)continue;const[hn,bn]=Ft.geometry.coordinates,fn=De(gn(hn)),Rr=De(Dt(bn));It.push(fn,Rr,1/0,tt,-1,1),this.options.reduce&&It.push(0)}let Ct=this.trees[rt+1]=this._createTree(It);ye&&console.timeEnd(Ve);for(let tt=rt;tt>=We;tt--){const Ft=+Date.now();Ct=this.trees[tt]=this._createTree(this._cluster(Ct,tt)),ye&&console.log("z%d: %d clusters in %dms",tt,Ct.numItems,+Date.now()-Ft)}return ye&&console.timeEnd("total time"),this}getClusters(ge,ye){let We=((ge[0]+180)%360+360)%360-180;const rt=Math.max(-90,Math.min(90,ge[1]));let Ve=180===ge[2]?180:((ge[2]+180)%360+360)%360-180;const It=Math.max(-90,Math.min(90,ge[3]));if(ge[2]-ge[0]>=360)We=-180,Ve=180;else if(We>Ve){const bn=this.getClusters([We,rt,180,It],ye),fn=this.getClusters([-180,rt,Ve,It],ye);return bn.concat(fn)}const Ct=this.trees[this._limitZoom(ye)],tt=Ct.range(gn(We),Dt(It),gn(Ve),Dt(rt)),Ft=Ct.data,hn=[];for(const bn of tt){const fn=this.stride*bn;hn.push(Ft[fn+at]>1?Ut(Ft,fn,this.clusterProps):this.points[Ft[fn+Fe]])}return hn}getChildren(ge){const ye=this._getOriginId(ge),We=this._getOriginZoom(ge),rt="No cluster with the specified id.",Ve=this.trees[We];if(!Ve)throw new Error(rt);const It=Ve.data;if(ye*this.stride>=It.length)throw new Error(rt);const Ct=this.options.radius/(this.options.extent*Math.pow(2,We-1)),tt=Ve.within(It[ye*this.stride],It[ye*this.stride+1],Ct),Ft=[];for(const hn of tt){const bn=hn*this.stride;It[bn+4]===ge&&Ft.push(It[bn+at]>1?Ut(It,bn,this.clusterProps):this.points[It[bn+Fe]])}if(0===Ft.length)throw new Error(rt);return Ft}getLeaves(ge,ye,We){const rt=[];return this._appendLeaves(rt,ge,ye=ye||10,We=We||0,0),rt}getTile(ge,ye,We){const rt=this.trees[this._limitZoom(ge)],Ve=Math.pow(2,ge),{extent:It,radius:Ct}=this.options,tt=Ct/It,Ft=(We-tt)/Ve,hn=(We+1+tt)/Ve,bn={features:[]};return this._addTileFeatures(rt.range((ye-tt)/Ve,Ft,(ye+1+tt)/Ve,hn),rt.data,ye,We,Ve,bn),0===ye&&this._addTileFeatures(rt.range(1-tt/Ve,Ft,1,hn),rt.data,Ve,We,Ve,bn),ye===Ve-1&&this._addTileFeatures(rt.range(0,Ft,tt/Ve,hn),rt.data,-1,We,Ve,bn),bn.features.length?bn:null}getClusterExpansionZoom(ge){let ye=this._getOriginZoom(ge)-1;for(;ye<=this.options.maxZoom;){const We=this.getChildren(ge);if(ye++,1!==We.length)break;ge=We[0].properties.cluster_id}return ye}_appendLeaves(ge,ye,We,rt,Ve){const It=this.getChildren(ye);for(const Ct of It){const tt=Ct.properties;if(tt&&tt.cluster?Ve+tt.point_count<=rt?Ve+=tt.point_count:Ve=this._appendLeaves(ge,tt.cluster_id,We,rt,Ve):Ve<rt?Ve++:ge.push(Ct),ge.length===We)break}return Ve}_createTree(ge){const ye=new p.KDBush(ge.length/this.stride|0,this.options.nodeSize,Float32Array);for(let We=0;We<ge.length;We+=this.stride)ye.add(ge[We],ge[We+1]);return ye.finish(),ye.data=ge,ye}_addTileFeatures(ge,ye,We,rt,Ve,It){for(const Ct of ge){const tt=Ct*this.stride,Ft=ye[tt+at]>1;let hn,bn,fn;if(Ft)hn=zt(ye,tt,this.clusterProps),bn=ye[tt],fn=ye[tt+1];else{const Lr=this.points[ye[tt+Fe]];hn=Lr.properties;const[ir,Zr]=Lr.geometry.coordinates;bn=gn(ir),fn=Dt(Zr)}const Rr={type:1,geometry:[[Math.round(this.options.extent*(bn*Ve-We)),Math.round(this.options.extent*(fn*Ve-rt))]],tags:hn};let Ur;Ur=Ft||this.options.generateId?ye[tt+Fe]:this.points[ye[tt+Fe]].id,void 0!==Ur&&(Rr.id=Ur),It.features.push(Rr)}}_limitZoom(ge){return Math.max(this.options.minZoom,Math.min(Math.floor(+ge),this.options.maxZoom+1))}_cluster(ge,ye){const{radius:We,extent:rt,reduce:Ve,minPoints:It}=this.options,Ct=We/(rt*Math.pow(2,ye)),tt=ge.data,Ft=[],hn=this.stride;for(let bn=0;bn<tt.length;bn+=hn){if(tt[bn+2]<=ye)continue;tt[bn+2]=ye;const fn=tt[bn],Rr=tt[bn+1],Ur=ge.within(tt[bn],tt[bn+1],Ct),Lr=tt[bn+at];let ir=Lr;for(const Zr of Ur){const So=Zr*hn;tt[So+2]>ye&&(ir+=tt[So+at])}if(ir>Lr&&ir>=It){let Zr,So=fn*Lr,Io=Rr*Lr,Er=-1;const Ti=((bn/hn|0)<<5)+(ye+1)+this.points.length;for(const Cs of Ur){const lo=Cs*hn;if(tt[lo+2]<=ye)continue;tt[lo+2]=ye;const ai=tt[lo+at];So+=tt[lo]*ai,Io+=tt[lo+1]*ai,tt[lo+4]=Ti,Ve&&(Zr||(Zr=this._map(tt,bn,!0),Er=this.clusterProps.length,this.clusterProps.push(Zr)),Ve(Zr,this._map(tt,lo)))}tt[bn+4]=Ti,Ft.push(So/ir,Io/ir,1/0,Ti,-1,ir),Ve&&Ft.push(Er)}else{for(let Zr=0;Zr<hn;Zr++)Ft.push(tt[bn+Zr]);if(ir>1)for(const Zr of Ur){const So=Zr*hn;if(!(tt[So+2]<=ye)){tt[So+2]=ye;for(let Io=0;Io<hn;Io++)Ft.push(tt[So+Io])}}}}return Ft}_getOriginId(ge){return ge-this.points.length>>5}_getOriginZoom(ge){return(ge-this.points.length)%32}_map(ge,ye,We){if(ge[ye+at]>1){const It=this.clusterProps[ge[ye+vt]];return We?Object.assign({},It):It}const rt=this.points[ge[ye+Fe]].properties,Ve=this.options.map(rt);return We&&Ve===rt?Object.assign({},Ve):Ve}}function Ut(Ke,ge,ye){return{type:"Feature",id:Ke[ge+Fe],properties:zt(Ke,ge,ye),geometry:{type:"Point",coordinates:[(We=Ke[ge],360*(We-.5)),Un(Ke[ge+1])]}};var We}function zt(Ke,ge,ye){const We=Ke[ge+at],rt=We>=1e4?`${Math.round(We/1e3)}k`:We>=1e3?Math.round(We/100)/10+"k":We,Ve=Ke[ge+vt],It=-1===Ve?{}:Object.assign({},ye[Ve]);return Object.assign(It,{cluster:!0,cluster_id:Ke[ge+Fe],point_count:We,point_count_abbreviated:rt})}function gn(Ke){return Ke/360+.5}function Dt(Ke){const ge=Math.sin(Ke*Math.PI/180),ye=.5-.25*Math.log((1+ge)/(1-ge))/Math.PI;return ye<0?0:ye>1?1:ye}function Un(Ke){const ge=(180-360*Ke)*Math.PI/180;return 360*Math.atan(Math.exp(ge))/Math.PI-90}function _n(Ke,ge,ye,We){for(var rt,Ve=We,It=ye-ge>>1,Ct=ye-ge,tt=Ke[ge],Ft=Ke[ge+1],hn=Ke[ye],bn=Ke[ye+1],fn=ge+3;fn<ye;fn+=3){var Rr=Cn(Ke[fn],Ke[fn+1],tt,Ft,hn,bn);if(Rr>Ve)rt=fn,Ve=Rr;else if(Rr===Ve){var Ur=Math.abs(fn-It);Ur<Ct&&(rt=fn,Ct=Ur)}}Ve>We&&(rt-ge>3&&_n(Ke,ge,rt,We),Ke[rt+2]=Ve,ye-rt>3&&_n(Ke,rt,ye,We))}function Cn(Ke,ge,ye,We,rt,Ve){var It=rt-ye,Ct=Ve-We;if(0!==It||0!==Ct){var tt=((Ke-ye)*It+(ge-We)*Ct)/(It*It+Ct*Ct);tt>1?(ye=rt,We=Ve):tt>0&&(ye+=It*tt,We+=Ct*tt)}return(It=Ke-ye)*It+(Ct=ge-We)*Ct}function cn(Ke,ge,ye,We){var rt={id:void 0===Ke?null:Ke,type:ge,geometry:ye,tags:We,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ve){var It=Ve.geometry,Ct=Ve.type;if("Point"===Ct||"MultiPoint"===Ct||"LineString"===Ct)En(Ve,It);else if("Polygon"===Ct||"MultiLineString"===Ct)for(var tt=0;tt<It.length;tt++)En(Ve,It[tt]);else if("MultiPolygon"===Ct)for(tt=0;tt<It.length;tt++)for(var Ft=0;Ft<It[tt].length;Ft++)En(Ve,It[tt][Ft])}(rt),rt}function En(Ke,ge){for(var ye=0;ye<ge.length;ye+=3)Ke.minX=Math.min(Ke.minX,ge[ye]),Ke.minY=Math.min(Ke.minY,ge[ye+1]),Ke.maxX=Math.max(Ke.maxX,ge[ye]),Ke.maxY=Math.max(Ke.maxY,ge[ye+1])}function sn(Ke,ge,ye,We){if(ge.geometry){var rt=ge.geometry.coordinates,Ve=ge.geometry.type,It=Math.pow(ye.tolerance/((1<<ye.maxZoom)*ye.extent),2),Ct=[],tt=ge.id;if(ye.promoteId?tt=ge.properties[ye.promoteId]:ye.generateId&&(tt=We||0),"Point"===Ve)Ei(rt,Ct);else if("MultiPoint"===Ve)for(var Ft=0;Ft<rt.length;Ft++)Ei(rt[Ft],Ct);else if("LineString"===Ve)cr(rt,Ct,It,!1);else if("MultiLineString"===Ve){if(ye.lineMetrics){for(Ft=0;Ft<rt.length;Ft++)cr(rt[Ft],Ct=[],It,!1),Ke.push(cn(tt,"LineString",Ct,ge.properties));return}oi(rt,Ct,It,!1)}else if("Polygon"===Ve)oi(rt,Ct,It,!0);else{if("MultiPolygon"!==Ve){if("GeometryCollection"===Ve){for(Ft=0;Ft<ge.geometry.geometries.length;Ft++)sn(Ke,{id:tt,geometry:ge.geometry.geometries[Ft],properties:ge.properties},ye,We);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ft=0;Ft<rt.length;Ft++){var hn=[];oi(rt[Ft],hn,It,!0),Ct.push(hn)}}Ke.push(cn(tt,Ve,Ct,ge.properties))}}function Ei(Ke,ge){ge.push(tr(Ke[0])),ge.push(sr(Ke[1])),ge.push(0)}function cr(Ke,ge,ye,We){for(var rt,Ve,It=0,Ct=0;Ct<Ke.length;Ct++){var tt=tr(Ke[Ct][0]),Ft=sr(Ke[Ct][1]);ge.push(tt),ge.push(Ft),ge.push(0),Ct>0&&(It+=We?(rt*Ft-tt*Ve)/2:Math.sqrt(Math.pow(tt-rt,2)+Math.pow(Ft-Ve,2))),rt=tt,Ve=Ft}var hn=ge.length-3;ge[2]=1,_n(ge,0,hn,ye),ge[hn+2]=1,ge.size=Math.abs(It),ge.start=0,ge.end=ge.size}function oi(Ke,ge,ye,We){for(var rt=0;rt<Ke.length;rt++){var Ve=[];cr(Ke[rt],Ve,ye,We),ge.push(Ve)}}function tr(Ke){return Ke/360+.5}function sr(Ke){var ge=Math.sin(Ke*Math.PI/180),ye=.5-.25*Math.log((1+ge)/(1-ge))/Math.PI;return ye<0?0:ye>1?1:ye}function wt(Ke,ge,ye,We,rt,Ve,It,Ct){if(We/=ge,Ve>=(ye/=ge)&&It<We)return Ke;if(It<ye||Ve>=We)return null;for(var tt=[],Ft=0;Ft<Ke.length;Ft++){var hn=Ke[Ft],bn=hn.geometry,fn=hn.type,Rr=0===rt?hn.minX:hn.minY,Ur=0===rt?hn.maxX:hn.maxY;if(Rr>=ye&&Ur<We)tt.push(hn);else if(!(Ur<ye||Rr>=We)){var Lr=[];if("Point"===fn||"MultiPoint"===fn)Te(bn,Lr,ye,We,rt);else if("LineString"===fn)we(bn,Lr,ye,We,rt,!1,Ct.lineMetrics);else if("MultiLineString"===fn)Ze(bn,Lr,ye,We,rt,!1);else if("Polygon"===fn)Ze(bn,Lr,ye,We,rt,!0);else if("MultiPolygon"===fn)for(var ir=0;ir<bn.length;ir++){var Zr=[];Ze(bn[ir],Zr,ye,We,rt,!0),Zr.length&&Lr.push(Zr)}if(Lr.length){if(Ct.lineMetrics&&"LineString"===fn){for(ir=0;ir<Lr.length;ir++)tt.push(cn(hn.id,fn,Lr[ir],hn.tags));continue}"LineString"!==fn&&"MultiLineString"!==fn||(1===Lr.length?(fn="LineString",Lr=Lr[0]):fn="MultiLineString"),"Point"!==fn&&"MultiPoint"!==fn||(fn=3===Lr.length?"Point":"MultiPoint"),tt.push(cn(hn.id,fn,Lr,hn.tags))}}}return tt.length?tt:null}function Te(Ke,ge,ye,We,rt){for(var Ve=0;Ve<Ke.length;Ve+=3){var It=Ke[Ve+rt];It>=ye&&It<=We&&(ge.push(Ke[Ve]),ge.push(Ke[Ve+1]),ge.push(Ke[Ve+2]))}}function we(Ke,ge,ye,We,rt,Ve,It){for(var Ct,tt,Ft=xe(Ke),hn=0===rt?Vt:rn,bn=Ke.start,fn=0;fn<Ke.length-3;fn+=3){var Rr=Ke[fn],Ur=Ke[fn+1],Lr=Ke[fn+2],ir=Ke[fn+3],Zr=Ke[fn+4],So=0===rt?Rr:Ur,Io=0===rt?ir:Zr,Er=!1;It&&(Ct=Math.sqrt(Math.pow(Rr-ir,2)+Math.pow(Ur-Zr,2))),So<ye?Io>ye&&(tt=hn(Ft,Rr,Ur,ir,Zr,ye),It&&(Ft.start=bn+Ct*tt)):So>We?Io<We&&(tt=hn(Ft,Rr,Ur,ir,Zr,We),It&&(Ft.start=bn+Ct*tt)):yt(Ft,Rr,Ur,Lr),Io<ye&&So>=ye&&(tt=hn(Ft,Rr,Ur,ir,Zr,ye),Er=!0),Io>We&&So<=We&&(tt=hn(Ft,Rr,Ur,ir,Zr,We),Er=!0),!Ve&&Er&&(It&&(Ft.end=bn+Ct*tt),ge.push(Ft),Ft=xe(Ke)),It&&(bn+=Ct)}var Ti=Ke.length-3;Rr=Ke[Ti],Ur=Ke[Ti+1],Lr=Ke[Ti+2],(So=0===rt?Rr:Ur)>=ye&&So<=We&&yt(Ft,Rr,Ur,Lr),Ti=Ft.length-3,Ve&&Ti>=3&&(Ft[Ti]!==Ft[0]||Ft[Ti+1]!==Ft[1])&&yt(Ft,Ft[0],Ft[1],Ft[2]),Ft.length&&ge.push(Ft)}function xe(Ke){var ge=[];return ge.size=Ke.size,ge.start=Ke.start,ge.end=Ke.end,ge}function Ze(Ke,ge,ye,We,rt,Ve){for(var It=0;It<Ke.length;It++)we(Ke[It],ge,ye,We,rt,Ve,!1)}function yt(Ke,ge,ye,We){Ke.push(ge),Ke.push(ye),Ke.push(We)}function Vt(Ke,ge,ye,We,rt,Ve){var It=(Ve-ge)/(We-ge);return Ke.push(Ve),Ke.push(ye+(rt-ye)*It),Ke.push(1),It}function rn(Ke,ge,ye,We,rt,Ve){var It=(Ve-ye)/(rt-ye);return Ke.push(ge+(We-ge)*It),Ke.push(Ve),Ke.push(1),It}function tn(Ke,ge){for(var ye=[],We=0;We<Ke.length;We++){var rt,Ve=Ke[We],It=Ve.type;if("Point"===It||"MultiPoint"===It||"LineString"===It)rt=Gt(Ve.geometry,ge);else if("MultiLineString"===It||"Polygon"===It){rt=[];for(var Ct=0;Ct<Ve.geometry.length;Ct++)rt.push(Gt(Ve.geometry[Ct],ge))}else if("MultiPolygon"===It)for(rt=[],Ct=0;Ct<Ve.geometry.length;Ct++){for(var tt=[],Ft=0;Ft<Ve.geometry[Ct].length;Ft++)tt.push(Gt(Ve.geometry[Ct][Ft],ge));rt.push(tt)}ye.push(cn(Ve.id,It,rt,Ve.tags))}return ye}function Gt(Ke,ge){var ye=[];ye.size=Ke.size,void 0!==Ke.start&&(ye.start=Ke.start,ye.end=Ke.end);for(var We=0;We<Ke.length;We+=3)ye.push(Ke[We]+ge,Ke[We+1],Ke[We+2]);return ye}function hr(Ke,ge){if(Ke.transformed)return Ke;var ye,We,rt,Ve=1<<Ke.z,It=Ke.x,Ct=Ke.y;for(ye=0;ye<Ke.features.length;ye++){var tt=Ke.features[ye],Ft=tt.geometry,hn=tt.type;if(tt.geometry=[],1===hn)for(We=0;We<Ft.length;We+=2)tt.geometry.push(yr(Ft[We],Ft[We+1],ge,Ve,It,Ct));else for(We=0;We<Ft.length;We++){var bn=[];for(rt=0;rt<Ft[We].length;rt+=2)bn.push(yr(Ft[We][rt],Ft[We][rt+1],ge,Ve,It,Ct));tt.geometry.push(bn)}}return Ke.transformed=!0,Ke}function yr(Ke,ge,ye,We,rt,Ve){return[Math.round(ye*(Ke*We-rt)),Math.round(ye*(ge*We-Ve))]}function Tn(Ke,ge,ye,We,rt){for(var Ve=ge===rt.maxZoom?0:rt.tolerance/((1<<ge)*rt.extent),It={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ye,y:We,z:ge,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ct=0;Ct<Ke.length;Ct++){It.numFeatures++,br(It,Ke[Ct],Ve,rt);var tt=Ke[Ct].minX,Ft=Ke[Ct].minY,hn=Ke[Ct].maxX,bn=Ke[Ct].maxY;tt<It.minX&&(It.minX=tt),Ft<It.minY&&(It.minY=Ft),hn>It.maxX&&(It.maxX=hn),bn>It.maxY&&(It.maxY=bn)}return It}function br(Ke,ge,ye,We){var rt=ge.geometry,Ve=ge.type,It=[];if("Point"===Ve||"MultiPoint"===Ve)for(var Ct=0;Ct<rt.length;Ct+=3)It.push(rt[Ct]),It.push(rt[Ct+1]),Ke.numPoints++,Ke.numSimplified++;else if("LineString"===Ve)si(It,rt,Ke,ye,!1,!1);else if("MultiLineString"===Ve||"Polygon"===Ve)for(Ct=0;Ct<rt.length;Ct++)si(It,rt[Ct],Ke,ye,"Polygon"===Ve,0===Ct);else if("MultiPolygon"===Ve)for(var tt=0;tt<rt.length;tt++){var Ft=rt[tt];for(Ct=0;Ct<Ft.length;Ct++)si(It,Ft[Ct],Ke,ye,!0,0===Ct)}if(It.length){var hn=ge.tags||null;if("LineString"===Ve&&We.lineMetrics){for(var bn in hn={},ge.tags)hn[bn]=ge.tags[bn];hn.mapbox_clip_start=rt.start/rt.size,hn.mapbox_clip_end=rt.end/rt.size}var fn={geometry:It,type:"Polygon"===Ve||"MultiPolygon"===Ve?3:"LineString"===Ve||"MultiLineString"===Ve?2:1,tags:hn};null!==ge.id&&(fn.id=ge.id),Ke.features.push(fn)}}function si(Ke,ge,ye,We,rt,Ve){var It=We*We;if(We>0&&ge.size<(rt?It:We))ye.numPoints+=ge.length/3;else{for(var Ct=[],tt=0;tt<ge.length;tt+=3)(0===We||ge[tt+2]>It)&&(ye.numSimplified++,Ct.push(ge[tt]),Ct.push(ge[tt+1])),ye.numPoints++;rt&&function(Ft,hn){for(var bn=0,fn=0,Rr=Ft.length,Ur=Rr-2;fn<Rr;Ur=fn,fn+=2)bn+=(Ft[fn]-Ft[Ur])*(Ft[fn+1]+Ft[Ur+1]);if(bn>0===hn)for(fn=0,Rr=Ft.length;fn<Rr/2;fn+=2){var Lr=Ft[fn],ir=Ft[fn+1];Ft[fn]=Ft[Rr-2-fn],Ft[fn+1]=Ft[Rr-1-fn],Ft[Rr-2-fn]=Lr,Ft[Rr-1-fn]=ir}}(Ct,Ve),Ke.push(Ct)}}function zr(Ke,ge){var ye=(ge=this.options=function(rt,Ve){for(var It in Ve)rt[It]=Ve[It];return rt}(Object.create(this.options),ge)).debug;if(ye&&console.time("preprocess data"),ge.maxZoom<0||ge.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ge.promoteId&&ge.generateId)throw new Error("promoteId and generateId cannot be used together.");var rt,Ve,It,Ct,tt,Ft,We=function(rt,Ve){var It=[];if("FeatureCollection"===rt.type)for(var Ct=0;Ct<rt.features.length;Ct++)sn(It,rt.features[Ct],Ve,Ct);else sn(It,"Feature"===rt.type?rt:{geometry:rt},Ve);return It}(Ke,ge);this.tiles={},this.tileCoords=[],ye&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ge.indexMaxZoom,ge.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ct=rt=We,tt=wt(rt,1,-1-(It=(Ve=ge).buffer/Ve.extent),It,0,-1,2,Ve),Ft=wt(rt,1,1-It,2+It,0,-1,2,Ve),(tt||Ft)&&(Ct=wt(rt,1,-It,1+It,0,-1,2,Ve)||[],tt&&(Ct=tn(tt,1).concat(Ct)),Ft&&(Ct=Ct.concat(tn(Ft,-1)))),(We=Ct).length&&this.splitTile(We,0,0,0),ye&&(We.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ni(Ke,ge,ye){return 32*((1<<Ke)*ye+ge)+Ke}function Ii(Ke,ge){const ye=Ke.tileID.canonical;if(!this._geoJSONIndex)return ge(null,null);const We=this._geoJSONIndex.getTile(ye.z,ye.x,ye.y);if(!We)return ge(null,null);const rt=new class{constructor(It){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=It.length,this._features=It}feature(It){return new class{constructor(Ct){this._feature=Ct,this.extent=p.EXTENT,this.type=Ct.type,this.properties=Ct.tags,"id"in Ct&&!isNaN(Ct.id)&&(this.id=parseInt(Ct.id,10))}loadGeometry(){if(1===this._feature.type){const Ct=[];for(const tt of this._feature.geometry)Ct.push([new p.Point(tt[0],tt[1])]);return Ct}{const Ct=[];for(const tt of this._feature.geometry){const Ft=[];for(const hn of tt)Ft.push(new p.Point(hn[0],hn[1]));Ct.push(Ft)}return Ct}}toGeoJSON(Ct,tt,Ft){return Je.call(this,Ct,tt,Ft)}}(this._features[It])}}(We.features);let Ve=Wt(rt);0===Ve.byteOffset&&Ve.byteLength===Ve.buffer.byteLength||(Ve=new Uint8Array(Ve)),ge(null,{vectorTile:rt,rawData:Ve.buffer})}zr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},zr.prototype.splitTile=function(Ke,ge,ye,We,rt,Ve,It){for(var Ct=[Ke,ge,ye,We],tt=this.options,Ft=tt.debug;Ct.length;){We=Ct.pop(),ye=Ct.pop(),ge=Ct.pop(),Ke=Ct.pop();var hn=1<<ge,bn=ni(ge,ye,We),fn=this.tiles[bn];if(!fn&&(Ft>1&&console.time("creation"),fn=this.tiles[bn]=Tn(Ke,ge,ye,We,tt),this.tileCoords.push({z:ge,x:ye,y:We}),Ft)){Ft>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ge,ye,We,fn.numFeatures,fn.numPoints,fn.numSimplified),console.timeEnd("creation"));var Rr="z"+ge;this.stats[Rr]=(this.stats[Rr]||0)+1,this.total++}if(fn.source=Ke,rt){if(ge===tt.maxZoom||ge===rt)continue;var Ur=1<<rt-ge;if(ye!==Math.floor(Ve/Ur)||We!==Math.floor(It/Ur))continue}else if(ge===tt.indexMaxZoom||fn.numPoints<=tt.indexMaxPoints)continue;if(fn.source=null,0!==Ke.length){Ft>1&&console.time("clipping");var Lr,ir,Zr,So,Io,Er,Ti=.5*tt.buffer/tt.extent,Cs=.5-Ti,lo=.5+Ti,ai=1+Ti;Lr=ir=Zr=So=null,Io=wt(Ke,hn,ye-Ti,ye+lo,0,fn.minX,fn.maxX,tt),Er=wt(Ke,hn,ye+Cs,ye+ai,0,fn.minX,fn.maxX,tt),Ke=null,Io&&(Lr=wt(Io,hn,We-Ti,We+lo,1,fn.minY,fn.maxY,tt),ir=wt(Io,hn,We+Cs,We+ai,1,fn.minY,fn.maxY,tt),Io=null),Er&&(Zr=wt(Er,hn,We-Ti,We+lo,1,fn.minY,fn.maxY,tt),So=wt(Er,hn,We+Cs,We+ai,1,fn.minY,fn.maxY,tt),Er=null),Ft>1&&console.timeEnd("clipping"),Ct.push(Lr||[],ge+1,2*ye,2*We),Ct.push(ir||[],ge+1,2*ye,2*We+1),Ct.push(Zr||[],ge+1,2*ye+1,2*We),Ct.push(So||[],ge+1,2*ye+1,2*We+1)}}},zr.prototype.getTile=function(Ke,ge,ye){var We=this.options,rt=We.extent,Ve=We.debug;if(Ke<0||Ke>24)return null;var It=1<<Ke,Ct=ni(Ke,ge=(ge%It+It)%It,ye);if(this.tiles[Ct])return hr(this.tiles[Ct],rt);Ve>1&&console.log("drilling down to z%d-%d-%d",Ke,ge,ye);for(var tt,Ft=Ke,hn=ge,bn=ye;!tt&&Ft>0;)Ft--,hn=Math.floor(hn/2),bn=Math.floor(bn/2),tt=this.tiles[ni(Ft,hn,bn)];return tt&&tt.source?(Ve>1&&console.log("found parent tile z%d-%d-%d",Ft,hn,bn),Ve>1&&console.time("drilling down"),this.splitTile(tt.source,Ft,hn,bn,Ke,ge,ye),Ve>1&&console.timeEnd("drilling down"),this.tiles[Ct]?hr(this.tiles[Ct],rt):null):null};class Uo extends p.VectorTileWorkerSource{constructor(ge,ye,We,rt,Ve){super(ge,ye,We,rt,Ii),Ve&&(this.loadGeoJSON=Ve)}loadData(ge,ye){const We=ge&&ge.request,rt=We&&We.collectResourceTiming;this.loadGeoJSON(ge,(Ve,It)=>{if(Ve||!It)return ye(Ve);if("object"!=typeof It)return ye(new Error(`Input data given to '${ge.source}' is not a valid GeoJSON object.`));{dt(It,!0);try{if(ge.filter){const tt=p.createExpression(ge.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===tt.result)throw new Error(tt.value.map(hn=>`${hn.key}: ${hn.message}`).join(", "));It={type:"FeatureCollection",features:It.features.filter(hn=>tt.value.evaluate({zoom:0},hn))}}this._geoJSONIndex=ge.cluster?new Le(function({superclusterOptions:tt,clusterProperties:Ft}){if(!Ft||!tt)return tt;const hn={},bn={},fn={accumulated:null,zoom:0},Rr={properties:null},Ur=Object.keys(Ft);for(const Lr of Ur){const[ir,Zr]=Ft[Lr],So=p.createExpression(Zr),Io=p.createExpression("string"==typeof ir?[ir,["accumulated"],["get",Lr]]:ir);hn[Lr]=So.value,bn[Lr]=Io.value}return tt.map=Lr=>{Rr.properties=Lr;const ir={};for(const Zr of Ur)ir[Zr]=hn[Zr].evaluate(fn,Rr);return ir},tt.reduce=(Lr,ir)=>{Rr.properties=ir;for(const Zr of Ur)fn.accumulated=Lr[Zr],Lr[Zr]=bn[Zr].evaluate(fn,Rr)},tt}(ge)).load(It.features):new zr(tt=It,ge.geojsonVtOptions)}catch(tt){return ye(tt)}this.loaded={};const Ct={};if(rt){const tt=p.getPerformanceMeasurement(We);tt&&(Ct.resourceTiming={},Ct.resourceTiming[ge.source]=JSON.parse(JSON.stringify(tt)))}ye(null,Ct)}var tt})}reloadTile(ge,ye){const We=this.loaded;return We&&We[ge.uid]?super.reloadTile(ge,ye):this.loadTile(ge,ye)}loadGeoJSON(ge,ye){if(ge.request)p.getJSON(ge.request,ye);else{if("string"!=typeof ge.data)return ye(new Error(`Input data given to '${ge.source}' is not a valid GeoJSON object.`));try{return ye(null,JSON.parse(ge.data))}catch{return ye(new Error(`Input data given to '${ge.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ge,ye){try{ye(null,this._geoJSONIndex.getClusterExpansionZoom(ge.clusterId))}catch(We){ye(We)}}getClusterChildren(ge,ye){try{ye(null,this._geoJSONIndex.getChildren(ge.clusterId))}catch(We){ye(We)}}getClusterLeaves(ge,ye){try{ye(null,this._geoJSONIndex.getLeaves(ge.clusterId,ge.limit,ge.offset))}catch(We){ye(We)}}}class ys{constructor(ge){this.self=ge,this.actor=new p.Actor(ge,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:Uo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ye,We)=>{if(this.workerSourceTypes[ye])throw new Error(`Worker source with name "${ye}" already registered.`);this.workerSourceTypes[ye]=We},this.self.registerRTLTextPlugin=ye=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=ye.applyArabicShaping,p.plugin.processBidirectionalText=ye.processBidirectionalText,p.plugin.processStyledBidirectionalText=ye.processStyledBidirectionalText}}clearCaches(ge,ye,We){delete this.layerIndexes[ge],delete this.availableImages[ge],delete this.workerSources[ge],delete this.demWorkerSources[ge],We()}checkIfReady(ge,ye,We){We()}setReferrer(ge,ye){this.referrer=ye}spriteLoaded(ge,ye){this.isSpriteLoaded[ge]=ye;for(const We in this.workerSources[ge]){const rt=this.workerSources[ge][We];for(const Ve in rt)rt[Ve]instanceof p.VectorTileWorkerSource&&(rt[Ve].isSpriteLoaded=ye,rt[Ve].fire(new p.Event("isSpriteLoaded")))}}setImages(ge,ye,We){this.availableImages[ge]=ye;for(const rt in this.workerSources[ge]){const Ve=this.workerSources[ge][rt];for(const It in Ve)Ve[It].availableImages=ye}We()}enableTerrain(ge,ye,We){this.terrain=ye,We()}setProjection(ge,ye){this.projections[ge]=p.getProjection(ye)}setLayers(ge,ye,We){this.getLayerIndex(ge).replace(ye),We()}updateLayers(ge,ye,We){this.getLayerIndex(ge).update(ye.layers,ye.removedIds),We()}loadTile(ge,ye,We){const rt=this.enableTerrain?p.extend({enableTerrain:this.terrain},ye):ye;rt.projection=this.projections[ge]||this.defaultProjection,this.getWorkerSource(ge,ye.type,ye.source).loadTile(rt,We)}loadDEMTile(ge,ye,We){const rt=this.enableTerrain?p.extend({buildQuadTree:this.terrain},ye):ye;this.getDEMWorkerSource(ge,ye.source).loadTile(rt,We)}reloadTile(ge,ye,We){const rt=this.enableTerrain?p.extend({enableTerrain:this.terrain},ye):ye;rt.projection=this.projections[ge]||this.defaultProjection,this.getWorkerSource(ge,ye.type,ye.source).reloadTile(rt,We)}abortTile(ge,ye,We){this.getWorkerSource(ge,ye.type,ye.source).abortTile(ye,We)}removeTile(ge,ye,We){this.getWorkerSource(ge,ye.type,ye.source).removeTile(ye,We)}removeSource(ge,ye,We){if(!this.workerSources[ge]||!this.workerSources[ge][ye.type]||!this.workerSources[ge][ye.type][ye.source])return;const rt=this.workerSources[ge][ye.type][ye.source];delete this.workerSources[ge][ye.type][ye.source],void 0!==rt.removeSource?rt.removeSource(ye,We):We()}loadWorkerSource(ge,ye,We){try{this.self.importScripts(ye.url),We()}catch(rt){We(rt.toString())}}syncRTLPluginState(ge,ye,We){try{p.plugin.setState(ye);const rt=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=rt){this.self.importScripts(rt);const Ve=p.plugin.isParsed();We(Ve?void 0:new Error(`RTL Text Plugin failed to import scripts from ${rt}`),Ve)}}catch(rt){We(rt.toString())}}getAvailableImages(ge){let ye=this.availableImages[ge];return ye||(ye=[]),ye}getLayerIndex(ge){let ye=this.layerIndexes[ge];return ye||(ye=this.layerIndexes[ge]=new ve),ye}getWorkerSource(ge,ye,We){return this.workerSources[ge]||(this.workerSources[ge]={}),this.workerSources[ge][ye]||(this.workerSources[ge][ye]={}),this.workerSources[ge][ye][We]||(this.workerSources[ge][ye][We]=new this.workerSourceTypes[ye]({send:(Ve,It,Ct,tt,Ft,hn)=>{this.actor.send(Ve,It,Ct,ge,Ft,hn)},scheduler:this.actor.scheduler},this.getLayerIndex(ge),this.getAvailableImages(ge),this.isSpriteLoaded[ge])),this.workerSources[ge][ye][We]}getDEMWorkerSource(ge,ye){return this.demWorkerSources[ge]||(this.demWorkerSources[ge]={}),this.demWorkerSources[ge][ye]||(this.demWorkerSources[ge][ye]=new Ie),this.demWorkerSources[ge][ye]}enforceCacheSizeLimit(ge,ye){p.enforceCacheSizeLimit(ye)}getWorkerPerformanceMetrics(ge,ye,We){We(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ys(self)),ys}),de(0,function(p){function H(v,l){if(Array.isArray(v)){if(!Array.isArray(l)||v.length!==l.length)return!1;for(let g=0;g<v.length;g++)if(!H(v[g],l[g]))return!1;return!0}if("object"==typeof v&&null!==v&&null!==l){if("object"!=typeof l||Object.keys(v).length!==Object.keys(l).length)return!1;for(const g in v)if(!H(v[g],l[g]))return!1;return!0}return v===l}var fe=ve;function ve(v){return l=v,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var E,I,A=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(A);try{I=new Worker(O),E=!0}catch{E=!1}return I&&I.terminate(),URL.revokeObjectURL(O),E}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var E=document.createElement("canvas");E.width=E.height=1;var I=E.getContext("2d");if(!I)return!1;var A=I.getImageData(0,0,1,1);return A&&A.width===E.width}()||(void 0===Ie[g=l&&l.failIfMajorPerformanceCaveat]&&(Ie[g]=function(E){var I,O,k,U,A=(O=E,k=document.createElement("canvas"),(U=Object.create(ve.webGLContextAttributes)).failIfMajorPerformanceCaveat=O,k.getContext("webgl",U)||k.getContext("experimental-webgl",U));if(!A)return!1;try{I=A.createShader(A.VERTEX_SHADER)}catch{return!1}return!(!I||A.isContextLost())&&(A.shaderSource(I,"void main() {}"),A.compileShader(I),!0===A.getShaderParameter(I,A.COMPILE_STATUS))}(g)),!Ie[g]||document.documentMode));var l,g}var Ie={};function ze(v,l,g){const E=p.window.document.createElement(v);return void 0!==l&&(E.className=l),g&&g.appendChild(E),E}function _t(v,l,g){const E=p.window.document.createElementNS("http://www.w3.org/2000/svg",v);for(const I of Object.keys(l))E.setAttributeNS(null,I,l[I]);return g&&g.appendChild(E),E}ve.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const dt=p.window.document&&p.window.document.documentElement.style,Je=dt&&void 0!==dt.userSelect?"userSelect":"WebkitUserSelect";let ht;function xt(){dt&&Je&&(ht=dt[Je],dt[Je]="none")}function ie(){dt&&Je&&(dt[Je]=ht)}function W(v){v.preventDefault(),v.stopPropagation(),p.window.removeEventListener("click",W,!0)}function J(){p.window.addEventListener("click",W,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",W,!0)},0)}function re(v,l){const g=v.getBoundingClientRect();return ee(v,g,l)}function Y(v,l){const g=v.getBoundingClientRect(),E=[];for(let I=0;I<l.length;I++)E.push(ee(v,g,l[I]));return E}function ne(v){return void 0!==p.window.InstallTrigger&&2===v.button&&v.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:v.button}function ee(v,l,g){const E=v.offsetWidth===l.width?1:v.offsetWidth/l.width;return new p.Point((g.clientX-l.left)*E,(g.clientY-l.top)*E)}function Z(v,l){var g=l[0],E=l[1],I=l[2],A=l[3],O=g*A-I*E;return O?(v[0]=A*(O=1/O),v[1]=-E*O,v[2]=-I*O,v[3]=g*O,v):null}function me(v){const{userImage:l}=v;return!!(l&&l.render&&l.render())&&(v.data.replace(new Uint8Array(l.data.buffer)),!0)}class Q extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:g,callback:E}of this.requestors)this._notify(g,E);this.requestors=[]}}hasImage(l){return!!this.getImage(l)}getImage(l){return this.images[l]}addImage(l,g){this._validate(l,g)&&(this.images[l]=g)}_validate(l,g){let E=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${l}" has invalid "stretchX" value`))),E=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${l}" has invalid "stretchY" value`))),E=!1),this._validateContent(g.content,g)||(this.fire(new p.ErrorEvent(new Error(`Image "${l}" has invalid "content" value`))),E=!1),E}_validateStretch(l,g){if(!l)return!0;let E=0;for(const I of l){if(I[0]<E||I[1]<I[0]||g<I[1])return!1;E=I[1]}return!0}_validateContent(l,g){return!(l&&(4!==l.length||l[0]<0||g.data.width<l[0]||l[1]<0||g.data.height<l[1]||l[2]<0||g.data.width<l[2]||l[3]<0||g.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,g){g.version=this.images[l].version+1,this.images[l]=g,this.updatedImages[l]=!0}removeImage(l){const g=this.images[l];delete this.images[l],delete this.patterns[l],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l,g){let E=!0;if(!this.isLoaded())for(const I of l)this.images[I]||(E=!1);this.isLoaded()||E?this._notify(l,g):this.requestors.push({ids:l,callback:g})}_notify(l,g){const E={};for(const I of l){this.images[I]||this.fire(new p.Event("styleimagemissing",{id:I}));const A=this.images[I];A?E[I]={data:A.data.clone(),pixelRatio:A.pixelRatio,sdf:A.sdf,version:A.version,stretchX:A.stretchX,stretchY:A.stretchY,content:A.content,hasRenderCallback:!(!A.userImage||!A.userImage.render)}:p.warnOnce(`Image "${I}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,E)}getPixelSize(){const{width:l,height:g}=this.atlasImage;return{width:l,height:g}}getPattern(l){const g=this.patterns[l],E=this.getImage(l);if(!E)return null;if(g&&g.position.version===E.version)return g.position;if(g)g.position.version=E.version;else{const I={w:E.data.width+2,h:E.data.height+2,x:0,y:0},A=new p.ImagePosition(I,E);this.patterns[l]={bin:I,position:A}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const g=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(l,this.atlasImage,g.RGBA),this.atlasTexture&&this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const A in this.patterns)l.push(this.patterns[A].bin);const{w:g,h:E}=p.potpack(l),I=this.atlasImage;I.resize({width:g||1,height:E||1});for(const A in this.patterns){const{bin:O}=this.patterns[A],k=O.x+1,U=O.y+1,q=this.images[A].data,$=q.width,te=q.height;p.RGBAImage.copy(q,I,{x:0,y:0},{x:k,y:U},{width:$,height:te}),p.RGBAImage.copy(q,I,{x:0,y:te-1},{x:k,y:U-1},{width:$,height:1}),p.RGBAImage.copy(q,I,{x:0,y:0},{x:k,y:U+te},{width:$,height:1}),p.RGBAImage.copy(q,I,{x:$-1,y:0},{x:k-1,y:U},{width:1,height:te}),p.RGBAImage.copy(q,I,{x:0,y:0},{x:k+$,y:U},{width:1,height:te})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const g of l){if(this.callbackDispatchedThisFrame[g])continue;this.callbackDispatchedThisFrame[g]=!0;const E=this.images[g];me(E)&&this.updateImage(g,E)}}}const qe=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(v,l){return function([g,E,I]){const A=p.degToRad(E+90),O=p.degToRad(I);return{x:g*Math.cos(A)*Math.sin(O),y:g*Math.sin(A)*Math.sin(O),z:g*Math.cos(O),azimuthal:E,polar:I}}(v.expression.evaluate(l))}interpolate(v,l,g){return{x:p.number(v.x,l.x,g),y:p.number(v.y,l.y,g),z:p.number(v.z,l.z,g),azimuthal:p.number(v.azimuthal,l.azimuthal,g),polar:p.number(v.polar,l.polar,g)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)});class Ue extends p.Evented{constructor(l){super(),this._transitionable=new p.Transitionable(qe),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,g={}){if(!this._validate(p.validateLight,l,g))for(const E in l){const I=l[E];p.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-11),I):this._transitionable.setValue(E,I)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,g,E){return(!E||!1!==E.validate)&&p.emitValidationErrors(this,l.call(p.validateStyle,p.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const Ye=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)});let Ae=class extends p.Evented{constructor(v,l){super(),this._transitionable=new p.Transitionable(Ye),this.set(v),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(v){for(const l in v){const g=v[l];p.endsWith(l,"-transition")?this._transitionable.setTransition(l.slice(0,-11),g):this._transitionable.setValue(l,g)}}updateTransitions(v){this._transitioning=this._transitionable.transitioned(v,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(v){this.properties=this._transitioning.possiblyEvaluate(v)}};function Wt(v,l,g,E){const I=p.smoothstep(45,65,g),[A,O]=At(v,E),k=p.length(l);let U=1-Math.min(1,Math.exp((k-A)/(O-A)*-6));return U*=U*U,U=Math.min(1,1.00747*U),U*I*v.alpha}function At(v,l){const g=.5/Math.tan(.5*l);return[v.range[0]+g,v.range[1]+g]}const De=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"high-color":new p.DataConstantProperty(p.spec.fog["high-color"]),"space-color":new p.DataConstantProperty(p.spec.fog["space-color"]),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"]),"star-intensity":new p.DataConstantProperty(p.spec.fog["star-intensity"])});class pt extends p.Evented{constructor(l,g){super(),this._transitionable=new p.Transitionable(De),this.set(l),this._transitioning=this._transitionable.untransitioned(),this._transform=g}get state(){const l=this._transform,g="globe"===l.projection.name,E=p.globeToMercatorTransition(l.zoom),I=this.properties.get("range"),A=[.5,3];return{range:g?[p.number(A[0],I[0],E),p.number(A[1],I[1],E)]:I,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,g={}){if(!this._validate(p.validateFog,l,g)){for(const E of Object.keys(p.spec.fog))l&&void 0===l[E]&&(l[E]=p.spec.fog[E].default);for(const E in l){const I=l[E];p.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-11),I):this._transitionable.setValue(E,I)}}}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const g=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.smoothstep(45,65,l))*g.a}getOpacityAtLatLng(l,g){return this._transform.projection.supportsFog?function(E,I,A){const O=p.MercatorCoordinate.fromLngLat(I),k=A.elevation?A.elevation.getAtPointOrZero(O):0,U=[O.x,O.y,k];return p.transformMat4(U,U,A.mercatorFogMatrix),Wt(E,U,A.pitch,A._fov)}(this.state,l,g):0}getFovAdjustedRange(l){return this._transform.projection.supportsFog?At(this.state,l):[0,1]}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,g,E){return(!E||!1!==E.validate)&&p.emitValidationErrors(this,l.call(p.validateStyle,p.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class Fe{constructor(l,g){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const E=this.workerPool.acquire(this.id);for(let I=0;I<E.length;I++){const A=new Fe.Actor(E[I],g,this.id);A.name=`Worker ${I}`,this.actors.push(A)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(l,g,E){p.asyncAll(this.actors,(I,A)=>{I.send(l,g,A)},E=E||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}function at(v,l,g){return l*(p.EXTENT/(v.tileSize*Math.pow(2,g-v.tileID.overscaledZ)))}Fe.Actor=p.Actor;class vt{constructor(l,g,E,I){this.screenBounds=l,this.cameraPoint=g,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=E,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,I)}static createFromScreenPoints(l,g){let E,I;if(l instanceof p.Point||"number"==typeof l[0]){const A=p.Point.convert(l);E=[A],I=g.isPointAboveHorizon(A)}else{const A=p.Point.convert(l[0]),O=p.Point.convert(l[1]);E=[A,O],I=p.polygonizeBounds(A,O).every(k=>g.isPointAboveHorizon(k))}return new vt(E,g.getCameraPoint(),I,g)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(l){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const g=this.screenBounds[0],E=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],I=p.polygonizeBounds(g,E,0,!1);return this.cameraPoint.y>E.y&&(this.cameraPoint.x>g.x&&this.cameraPoint.x<E.x?I.splice(3,0,this.cameraPoint):this.cameraPoint.x>=E.x?I[2]=this.cameraPoint:this.cameraPoint.x<=g.x&&(I[3]=this.cameraPoint)),p.bufferConvexPolygon(I,l)}bufferedCameraGeometryGlobe(l){const g=this.screenBounds[0],E=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],I=p.polygonizeBounds(g,E,l),A=this.cameraPoint.clone();switch(3*((A.y>g.y)+(A.y>E.y))+((A.x>g.x)+(A.x>E.x))){case 0:I[0]=A,I[4]=A.clone();break;case 1:I.splice(1,0,A);break;case 2:I[1]=A;break;case 3:I.splice(4,0,A);break;case 5:I.splice(2,0,A);break;case 6:I[3]=A;break;case 7:I.splice(3,0,A);break;case 8:I[2]=A}return I}containsTile(l,g,E,I=0){const A=l.queryPadding/g._pixelsPerMercatorPixel+1,O=E?this._bufferedCameraMercator(A,g):this._bufferedScreenMercator(A,g);let k=l.tileID.wrap+(O.unwrapped?I:0);const U=O.polygon.map(je=>p.getTilePoint(l.tileTransform,je,k));if(!p.polygonIntersectsBox(U,0,0,p.EXTENT,p.EXTENT))return;k=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?I:0);const q=this.screenGeometryMercator.polygon.map(je=>p.getTileVec3(l.tileTransform,je,k)),$=q.map(je=>new p.Point(je[0],je[1])),te=g.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),Ee=p.getTileVec3(l.tileTransform,te,k),Re=q.map(je=>{const oe=p.sub(je,je,Ee);return p.normalize(oe,oe),new p.Ray(Ee,oe)}),Be=at(l,1,g.zoom)*g._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:$,tilespaceRays:Re,bufferedTilespaceGeometry:U,bufferedTilespaceBounds:(Ne=p.getBounds(U),Ne.min.x=p.clamp(Ne.min.x,0,p.EXTENT),Ne.min.y=p.clamp(Ne.min.y,0,p.EXTENT),Ne.max.x=p.clamp(Ne.max.x,0,p.EXTENT),Ne.max.y=p.clamp(Ne.max.y,0,p.EXTENT),Ne),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:Be};var Ne}_bufferedScreenMercator(l,g){const E=zt(l);if(this._screenRaycastCache[E])return this._screenRaycastCache[E];{let I;return I="globe"===g.projection.name?this._projectAndResample(this.bufferedScreenGeometry(l),g):{polygon:this.bufferedScreenGeometry(l).map(A=>g.pointCoordinate3D(A)),unwrapped:!0},this._screenRaycastCache[E]=I,I}}_bufferedCameraMercator(l,g){const E=zt(l);if(this._cameraRaycastCache[E])return this._cameraRaycastCache[E];{let I;return I="globe"===g.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),g):{polygon:this.bufferedCameraGeometry(l).map(A=>g.pointCoordinate3D(A)),unwrapped:!0},this._cameraRaycastCache[E]=I,I}}_projectAndResample(l,g){const E=function(A,O){const k=p.multiply([],O.pixelMatrix,O.globeMatrix),U=[0,-p.GLOBE_RADIUS,0,1],q=[0,p.GLOBE_RADIUS,0,1],$=[0,0,0,1];p.transformMat4$1(U,U,k),p.transformMat4$1(q,q,k),p.transformMat4$1($,$,k);const te=new p.Point(U[0]/U[3],U[1]/U[3]),Ee=new p.Point(q[0]/q[3],q[1]/q[3]),Re=p.polygonContainsPoint(A,te)&&U[3]<$[3],Be=p.polygonContainsPoint(A,Ee)&&q[3]<$[3];if(!Re&&!Be)return null;const Ne=function(it,St,Et){for(let Tt=1;Tt<it.length;Tt++){const mn=Ut(St.pointCoordinate3D(it[Tt-1]).x),Rt=Ut(St.pointCoordinate3D(it[Tt]).x);if(Et<0){if(mn<Rt)return{idx:Tt,t:-mn/(Rt-1-mn)}}else if(Rt<mn)return{idx:Tt,t:(1-mn)/(Rt+1-mn)}}return null}(A,O,Re?-1:1);if(!Ne)return null;const{idx:je,t:oe}=Ne;let Pe=je>1?Le(A.slice(0,je),O):[],Xe=je<A.length?Le(A.slice(je),O):[];Pe=Pe.map(it=>new p.Point(Ut(it.x),it.y)),Xe=Xe.map(it=>new p.Point(Ut(it.x),it.y));const He=[...Pe];0===He.length&&He.push(Xe[Xe.length-1]);const gt=p.number(He[He.length-1].y,(0===Xe.length?Pe[0]:Xe[0]).y,oe);let mt;return mt=Re?[new p.Point(0,gt),new p.Point(0,0),new p.Point(1,0),new p.Point(1,gt)]:[new p.Point(1,gt),new p.Point(1,1),new p.Point(0,1),new p.Point(0,gt)],He.push(...mt),0===Xe.length?He.push(Pe[0]):He.push(...Xe),{polygon:He.map(it=>new p.MercatorCoordinate(it.x,it.y)),unwrapped:!1}}(l,g);if(E)return E;const I=function(A,O){let k=!1,U=-1/0,q=0;for(let te=0;te<A.length-1;te++)A[te].x>U&&(U=A[te].x,q=te);for(let te=0;te<A.length-1;te++){const Ee=(q+te)%(A.length-1),Re=A[Ee],Be=A[Ee+1];Math.abs(Re.x-Be.x)>.5&&(Re.x<Be.x?(Re.x+=1,0===Ee&&(A[A.length-1].x+=1)):(Be.x+=1,Ee+1===A.length-1&&(A[0].x+=1)),k=!0)}const $=p.mercatorXfromLng(O.center.lng);return k&&$<Math.abs($-1)&&A.forEach(te=>{te.x-=1}),{polygon:A,unwrapped:k}}(Le(l,g).map(A=>new p.Point(Ut(A.x),A.y)),g);return{polygon:I.polygon.map(A=>new p.MercatorCoordinate(A.x,A.y)),unwrapped:I.unwrapped}}}function Le(v,l){return p.resample(v,g=>{const E=l.pointCoordinate3D(g);g.x=E.x,g.y=E.y},1/256)}function Ut(v){return v<0?1+v%1:v%1}function zt(v){return 100*v|0}function gn(v,l,g,E,I){const A=function(O,k){if(O)return I(O);if(k){v.url&&k.tiles&&v.tiles&&delete v.tiles;const U=p.pick(p.extend(k,v),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(U.vectorLayers=k.vector_layers,U.vectorLayerIds=U.vectorLayers.map(q=>q.id)),U.tiles=l.canonicalizeTileset(U,v.url),I(null,U)}};return v.url?p.getJSON(l.transformRequest(l.normalizeSourceURL(v.url,null,g,E),p.ResourceType.Source),A):p.exported.frame(()=>A(null,v))}class Dt{constructor(l,g,E){this.bounds=p.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=g||0,this.maxzoom=E||24}validateBounds(l){return Array.isArray(l)&&4===l.length?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const g=Math.pow(2,l.z),E=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*g),I=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*g),A=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*g),O=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*g);return l.x>=E&&l.x<A&&l.y>=I&&l.y<O}}class Un{constructor(l,g,E){this.context=l;const I=l.gl;this.buffer=I.createBuffer(),this.dynamicDraw=!!E,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),I.bufferData(I.ELEMENT_ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||g.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const g=this.context.gl;this.context.unbindVAO(),this.bind(),g.bufferSubData(g.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const _n={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Cn{constructor(l,g,E,I){this.length=g.length,this.attributes=E,this.itemSize=g.bytesPerElement,this.dynamicDraw=I,this.context=l;const A=l.gl;this.buffer=A.createBuffer(),l.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||g.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const g=this.context.gl;this.bind(),g.bufferSubData(g.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,g){for(let E=0;E<this.attributes.length;E++){const I=g.attributes[this.attributes[E].name];void 0!==I&&l.enableVertexAttribArray(I)}}setVertexAttribPointers(l,g,E){for(let I=0;I<this.attributes.length;I++){const A=this.attributes[I],O=g.attributes[A.name];void 0!==O&&l.vertexAttribPointer(O,A.components,l[_n[A.type]],!1,this.itemSize,A.offset+this.itemSize*(E||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class cn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class En extends cn{getDefault(){return p.Color.transparent}set(l){const g=this.current;(l.r!==g.r||l.g!==g.g||l.b!==g.b||l.a!==g.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class sn extends cn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Ei extends cn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class cr extends cn{getDefault(){return[!0,!0,!0,!0]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class oi extends cn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class tr extends cn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class sr extends cn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const g=this.current;(l.func!==g.func||l.ref!==g.ref||l.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class wt extends cn{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Te extends cn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=l,this.dirty=!1}}class we extends cn{getDefault(){return[0,1]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class xe extends cn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=l,this.dirty=!1}}class Ze extends cn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class yt extends cn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.BLEND):g.disable(g.BLEND),this.current=l,this.dirty=!1}}class Vt extends cn{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class rn extends cn{getDefault(){return p.Color.transparent}set(l){const g=this.current;(l.r!==g.r||l.g!==g.g||l.b!==g.b||l.a!==g.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class tn extends cn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class Gt extends cn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=l,this.dirty=!1}}class hr extends cn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class yr extends cn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let Tn,br=class extends cn{getDefault(){return null}set(v){(v!==this.current||this.dirty)&&(this.gl.useProgram(v),this.current=v,this.dirty=!1)}};class si extends cn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class zr extends cn{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class ni extends cn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Ii extends cn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Uo extends cn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindTexture(g.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class ys extends cn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ke extends cn{getDefault(){return null}set(l){const g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class ge extends cn{constructor(l){super(l),this.vao=l.extVertexArrayObject}getDefault(){return null}set(l){this.vao&&(l!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(l),this.current=l,this.dirty=!1)}}class ye extends cn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class We extends cn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class rt extends cn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Ve extends cn{constructor(l,g){super(l),this.context=l,this.parent=g}getDefault(){return null}}class It extends Ve{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Ct extends Ve{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,this.attachment(),g.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class tt extends Ct{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ft{constructor(l,g,E,I){this.context=l,this.width=g,this.height=E;const A=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new It(l,A),I&&(this.depthAttachment=new Ct(l,A))}destroy(){const l=this.context.gl,g=this.colorAttachment.get();if(g&&l.deleteTexture(g),this.depthAttachment){const E=this.depthAttachment.get();E&&l.deleteRenderbuffer(E)}l.deleteFramebuffer(this.framebuffer)}}class hn{constructor(l,g=!1){if(this.gl=l,this.isWebGL2=g,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),g){const E=l;this.extVertexArrayObject={createVertexArrayOES:E.createVertexArray.bind(l),deleteVertexArrayOES:E.deleteVertexArray.bind(l),bindVertexArrayOES:E.bindVertexArray.bind(l)}}this.clearColor=new En(this),this.clearDepth=new sn(this),this.clearStencil=new Ei(this),this.colorMask=new cr(this),this.depthMask=new oi(this),this.stencilMask=new tr(this),this.stencilFunc=new sr(this),this.stencilOp=new wt(this),this.stencilTest=new Te(this),this.depthRange=new we(this),this.depthTest=new xe(this),this.depthFunc=new Ze(this),this.blend=new yt(this),this.blendFunc=new Vt(this),this.blendColor=new rn(this),this.blendEquation=new tn(this),this.cullFace=new Gt(this),this.cullFaceSide=new hr(this),this.frontFace=new yr(this),this.program=new br(this),this.activeTexture=new si(this),this.viewport=new zr(this),this.bindFramebuffer=new ni(this),this.bindRenderbuffer=new Ii(this),this.bindTexture=new Uo(this),this.bindVertexBuffer=new ys(this),this.bindElementBuffer=new Ke(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ge(this),this.pixelStoreUnpack=new ye(this),this.pixelStoreUnpackPremultiplyAlpha=new We(this),this.pixelStoreUnpackFlipY=new rt(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),g||(this.extTextureHalfFloat=l.getExtension("OES_texture_half_float")),(g||this.extTextureHalfFloat&&l.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=g||l.getExtension("OES_standard_derivatives"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,g){return new Un(this,l,g)}createVertexBuffer(l,g,E){return new Cn(this,l,g,E)}createRenderbuffer(l,g,E){const I=this.gl,A=I.createRenderbuffer();return this.bindRenderbuffer.set(A),I.renderbufferStorage(I.RENDERBUFFER,l,g,E),this.bindRenderbuffer.set(null),A}createFramebuffer(l,g,E){return new Ft(this,l,g,E)}clear({color:l,depth:g,stencil:E}){const I=this.gl;let A=0;l&&(A|=I.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),void 0!==g&&(A|=I.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(g),this.depthMask.set(!0)),void 0!==E&&(A|=I.STENCIL_BUFFER_BIT,this.clearStencil.set(E),this.stencilMask.set(255)),I.clear(A)}setCullFace(l){!1===l.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){H(l.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class bn extends p.Evented{constructor(l,g,E,I){if(super(),this.id=l,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(g,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(I),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(l){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"}));const g=Array.isArray(this.map._language)?this.map._language.join():this.map._language,E=this.map._worldview;this._tileJSONRequest=gn(this._options,this.map._requestManager,g,E,(I,A)=>{this._tileJSONRequest=null,this._loaded=!0,I?(g&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${g}`),E&&2!==E.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${E}`),this.fire(new p.ErrorEvent(I))):A&&(p.extend(this,A),A.bounds&&(this.tileBounds=new Dt(A.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(A.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(I)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}loadTile(l,g){const E=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),I={request:this.map._requestManager.transformRequest(E,p.ResourceType.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile};if(I.request.collectResourceTiming=this._collectResourceTiming,l.actor&&"expired"!==l.state)"loading"===l.state?l.reloadCallback=g:l.request=l.actor.send("reloadTile",I,A.bind(this));else if(l.actor=this._tileWorkers[E]=this._tileWorkers[E]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",I,A.bind(this),void 0,!0);else{const O=p.loadVectorTile.call({deduped:this._deduped},I,(k,U)=>{k||!U?A.call(this,k):(I.data={cacheControl:U.cacheControl,expires:U.expires,rawData:U.rawData.slice(0)},l.actor&&l.actor.send("loadTile",I,A.bind(this),void 0,!0))},!0);l.request={cancel:O}}function A(O,k){return delete l.request,l.aborted?g(null):O&&404!==O.status?g(O):(k&&k.resourceTiming&&(l.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&l.setExpiryData(k),l.loadVectorData(k,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id})}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class fn extends p.Evented{constructor(l,g,E,I){super(),this.id=l,this.dispatcher=E,this.setEventedParent(I),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},g),p.extend(this,p.pick(g,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=gn(this._options,this.map._requestManager,null,null,(g,E)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new p.ErrorEvent(g)):E&&(p.extend(this,E),E.bounds&&(this.tileBounds=new Dt(E.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(E.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(g)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,g){const E=p.exported.devicePixelRatio>=2,I=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),E,this.tileSize);l.request=p.getImage(this.map._requestManager.transformRequest(I,p.ResourceType.Tile),(A,O,k,U)=>(delete l.request,l.aborted?(l.state="unloaded",g(null)):A?(l.state="errored",g(A)):O?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:k,expires:U}),l.setTexture(O,this.map.painter),l.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void g(null)):g(null)))}static loadTileData(l,g,E){l.setTexture(g,E)}static unloadTileData(l,g){l.texture&&g.saveTileTexture(l.texture)}abortTile(l,g){l.request&&(l.request.cancel(),delete l.request),g()}unloadTile(l,g){l.texture&&this.map.painter.saveTileTexture(l.texture),g()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Rr(v,l,g,E,I,A,O,k){const U=[v,g,I,l,E,A,1,1,1],q=[O,k,1],$=p.adjoint([],U),[te,Ee,Re]=p.transformMat3(q,q,p.transpose($,$));return p.multiply$1(U,[te,0,0,0,Ee,0,0,0,Re],U)}class Ur extends p.Evented{constructor(l,g,E,I){super(),this.id=l,this.dispatcher=E,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(I),this.options=g,this._dirty=!1}load(l,g){this._loaded=g||!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(E,I)=>{if(this._imageRequest=null,this._loaded=!0,E)this.fire(new p.ErrorEvent(E));else if(I){const{HTMLImageElement:A}=p.window;this.image=I instanceof A?p.exported.getImageData(I):I,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,l&&(this.coordinates=l),this._finishLoading()}})}loaded(){return this._loaded}updateImage(l){return this.image&&l.url?(this._imageRequest&&l.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=l.url,this.load(l.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(l){this.coordinates=l,this._boundsArray=void 0;const g=l.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(E){let I=1/0,A=1/0,O=-1/0,k=-1/0;for(const te of E)I=Math.min(I,te.x),A=Math.min(A,te.y),O=Math.max(O,te.x),k=Math.max(k,te.y);const U=Math.max(O-I,k-A),q=Math.max(0,Math.floor(-Math.log(U)/Math.LN2)),$=Math.pow(2,q);return new p.CanonicalTileID(q,Math.floor((I+O)/2*$),Math.floor((A+k)/2*$))}(g),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(l){for(const U in this.tiles){const q=this.tiles[U];"loaded"!==q.state&&(q.state="loaded",q.texture=this.texture)}if(this._boundsArray)return;const g=p.tileTransform(this.tileID,this.map.transform.projection),[E,I,A,O]=this.coordinates.map(U=>{const q=g.projection.project(U[0],U[1]);return p.getTilePoint(g,q)._round()});this.perspectiveTransform=function(U,q,$,te,Ee,Re,Be,Ne,je,oe){const Pe=Rr(0,0,U,0,0,q,U,q),Xe=Rr($,te,Ee,Re,Be,Ne,je,oe);return p.multiply$1(Xe,p.adjoint(Pe,Pe),Xe),[Xe[6]/Xe[8]*U/p.EXTENT,Xe[7]/Xe[8]*q/p.EXTENT]}(this.width,this.height,E.x,E.y,I.x,I.y,O.x,O.y,A.x,A.y);const k=this._boundsArray=new p.StructArrayLayout4i8;k.emplaceBack(E.x,E.y,0,0),k.emplaceBack(I.x,I.y,p.EXTENT,0),k.emplaceBack(O.x,O.y,0,p.EXTENT),k.emplaceBack(A.x,A.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=l.createVertexBuffer(k,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const l=this.map.painter.context,g=l.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new p.Texture(l,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(l)}loadTile(l,g){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},g(null)):(l.state="errored",g(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Lr={vector:bn,raster:fn,"raster-dem":class extends fn{constructor(v,l,g,E){super(v,l,g,E),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(v,l){const g=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function E(I,A){I&&(v.state="errored",l(I)),A&&(v.dem=A,v.dem.onDeserialize(),v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0,v.state="loaded",l(null))}v.request=p.getImage(this.map._requestManager.transformRequest(g,p.ResourceType.Tile),function(I,A,O,k){if(delete v.request,v.aborted)v.state="unloaded",l(null);else if(I)v.state="errored",l(I);else if(A){this.map._refreshExpiredTiles&&v.setExpiryData({cacheControl:O,expires:k});const U=p.window.ImageBitmap&&A instanceof p.window.ImageBitmap&&(null==Tn&&(Tn=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),Tn),q=1-(A.width-p.prevPowerOfTwo(A.width))/2;q<1||v.neighboringTiles||(v.neighboringTiles=this._getNeighboringTiles(v.tileID));const $=U?A:p.exported.getImageData(A,q),te={uid:v.uid,coord:v.tileID,source:this.id,rawImageData:$,encoding:this.encoding,padding:q};v.actor&&"expired"!==v.state||(v.actor=this.dispatcher.getActor(),v.actor.send("loadDEMTile",te,E.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(v){const l=v.canonical,g=Math.pow(2,l.z),E=(l.x-1+g)%g,I=0===l.x?v.wrap-1:v.wrap,A=(l.x+1+g)%g,O=l.x+1===g?v.wrap+1:v.wrap,k={};return k[new p.OverscaledTileID(v.overscaledZ,I,l.z,E,l.y).key]={backfilled:!1},k[new p.OverscaledTileID(v.overscaledZ,O,l.z,A,l.y).key]={backfilled:!1},l.y>0&&(k[new p.OverscaledTileID(v.overscaledZ,I,l.z,E,l.y-1).key]={backfilled:!1},k[new p.OverscaledTileID(v.overscaledZ,v.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},k[new p.OverscaledTileID(v.overscaledZ,O,l.z,A,l.y-1).key]={backfilled:!1}),l.y+1<g&&(k[new p.OverscaledTileID(v.overscaledZ,I,l.z,E,l.y+1).key]={backfilled:!1},k[new p.OverscaledTileID(v.overscaledZ,v.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},k[new p.OverscaledTileID(v.overscaledZ,O,l.z,A,l.y+1).key]={backfilled:!1}),k}unloadTile(v){v.demTexture&&this.map.painter.saveTileTexture(v.demTexture),v.fbo&&(v.fbo.destroy(),delete v.fbo),v.dem&&delete v.dem,delete v.neighboringTiles,v.state="unloaded"}},geojson:class extends p.Evented{constructor(v,l,g,E){super(),this.id=v,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=g.getActor(),this.setEventedParent(E),this._data=l.data,this._options=p.extend({},l),this._collectResourceTiming=l.collectResourceTiming,void 0!==l.maxzoom&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const I=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(void 0!==l.buffer?l.buffer:128)*I,tolerance:(void 0!==l.tolerance?l.tolerance:.375)*I,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:void 0!==l.clusterMaxZoom?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==l.clusterRadius?l.clusterRadius:50)*I,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}onAdd(v){this.map=v,this.setData(this._data)}setData(v){return this._data=v,this._updateWorkerData(),this}getClusterExpansionZoom(v,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:v,source:this.id},l),this}getClusterChildren(v,l){return this.actor.send("geojson.getClusterChildren",{clusterId:v,source:this.id},l),this}getClusterLeaves(v,l,g,E){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:v,limit:l,offset:g},E),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const v=p.extend({},this.workerOptions),l=this._data;"string"==typeof l?(v.request=this.map._requestManager.transformRequest(p.exported.resolveURL(l),p.ResourceType.Source),v.request.collectResourceTiming=this._collectResourceTiming):v.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,v,(g,E)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new p.ErrorEvent(g));else{const I={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&E&&E.resourceTiming&&E.resourceTiming[this.id]&&(I.resourceTiming=E.resourceTiming[this.id]),this.fire(new p.Event("data",I)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(v,l){const g=v.actor?"reloadTile":"loadTile";v.actor=this.actor,v.request=this.actor.send(g,{type:this.type,uid:v.uid,tileID:v.tileID,tileZoom:v.tileZoom,zoom:v.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(E,I)=>(delete v.request,v.unloadVectorData(),v.aborted?l(null):E?l(E):(v.loadVectorData(I,this.map.painter,"reloadTile"===g),l(null))),void 0,"loadTile"===g)}abortTile(v){v.request&&(v.request.cancel(),delete v.request),v.aborted=!0}unloadTile(v){v.unloadVectorData(),this.actor.send("removeTile",{uid:v.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ur{constructor(v,l,g,E){super(v,l,g,E),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const v=this.options;this.urls=[];for(const l of v.urls)this.urls.push(this.map._requestManager.transformRequest(l,p.ResourceType.Source).url);p.getVideo(this.urls,(l,g)=>{this._loaded=!0,l?this.fire(new p.ErrorEvent(l)):g&&(this.video=g,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(v){if(this.video){const l=this.video.seekable;v<l.start(0)||v>l.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=v}}getVideo(){return this.video}onAdd(v){this.map||(this.map=v,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const v=this.map.painter.context,l=v.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(v,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(v)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ur,canvas:class extends Ur{constructor(v,l,g,E){super(v,l,g,E),l.coordinates?Array.isArray(l.coordinates)&&4===l.coordinates.length&&!l.coordinates.some(I=>!Array.isArray(I)||2!==I.length||I.some(A=>"number"!=typeof A))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${v}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${v}`,null,'missing required property "coordinates"'))),l.animate&&"boolean"!=typeof l.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${v}`,null,'optional "animate" property must be a boolean value'))),l.canvas?"string"==typeof l.canvas||l.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${v}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${v}`,null,'missing required property "canvas"'))),this.options=l,this.animate=void 0===l.animate||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(v){this.map=v,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let v=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,v=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,v=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const l=this.map.painter.context;this.texture?(v||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const v of[this.canvas.width,this.canvas.height])if(isNaN(v)||v<=0)return!0;return!1}},custom:class extends p.Evented{constructor(v,l,g,E){super(),this.id=v,this.type="custom",this._dataType="raster",this._dispatcher=g,this._implementation=l,this.setEventedParent(E),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Dt(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(v){this._map=v,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(v),this.load()}onRemove(v){this._implementation.onRemove&&this._implementation.onRemove(v)}hasTile(v){if(this._implementation.hasTile){const{x:l,y:g,z:E}=v.canonical;return this._implementation.hasTile({x:l,y:g,z:E})}return!this.tileBounds||this.tileBounds.contains(v.canonical)}loadTile(v,l){const{x:g,y:E,z:I}=v.tileID.canonical,A=new p.window.AbortController;v.request=Promise.resolve(this._implementation.loadTile({x:g,y:E,z:I},{signal:A.signal})).then(function(O){return delete v.request,v.aborted?(v.state="unloaded",l(null)):void 0===O?(v.state="errored",l(null)):null===O?(this.loadTileData(v,{width:this.tileSize,height:this.tileSize,data:null}),v.state="loaded",l(null)):(k=O)instanceof p.window.ImageData||k instanceof p.window.HTMLCanvasElement||k instanceof p.window.ImageBitmap||k instanceof p.window.HTMLImageElement?(this.loadTileData(v,O),v.state="loaded",void l(null)):(v.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var k}.bind(this)).catch(O=>{20!==O.code&&(v.state="errored",l(O))}),v.request.cancel=()=>A.abort()}loadTileData(v,l){fn.loadTileData(v,l,this._map.painter)}unloadTileData(v){fn.unloadTileData(v,this._map.painter)}unloadTile(v,l){if(this.unloadTileData(v),this._implementation.unloadTile){const{x:g,y:E,z:I}=v.tileID.canonical;this._implementation.unloadTile({x:g,y:E,z:I})}l()}abortTile(v,l){v.request&&v.request.cancel&&(v.request.cancel(),delete v.request),l()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(v=>({x:v.canonical.x,y:v.canonical.y,z:v.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ir=function(v,l,g,E){const I=new Lr[l.type](v,l,g,E);if(I.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${I.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],I),I};function Zr(v,l){const g=p.identity([]);return p.scale(g,g,[.5*v.width,.5*-v.height,1]),p.translate(g,g,[1,-1,0]),p.multiply(g,g,v.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(g)}function So(v,l,g,E,I,A,O,k=!1){const U=v.tilesIn(E,O,k);U.sort(Er);const q=[];for(const te of U)q.push({wrappedTileID:te.tile.tileID.wrapped().key,queryResults:te.tile.queryRenderedFeatures(l,g,v._state,te,I,A,Zr(v.transform,te.tile.tileID),k)});const $=function(te){const Ee={},Re={};for(const Be of te){const Ne=Be.queryResults,je=Be.wrappedTileID,oe=Re[je]=Re[je]||{};for(const Pe in Ne){const Xe=Ne[Pe],He=oe[Pe]=oe[Pe]||{},gt=Ee[Pe]=Ee[Pe]||[];for(const mt of Xe)He[mt.featureIndex]||(He[mt.featureIndex]=!0,gt.push(mt))}}return Ee}(q);for(const te in $)$[te].forEach(Ee=>{const Re=Ee.feature,Be=Re.layer;Be&&"background"!==Be.type&&"sky"!==Be.type&&(Re.source=Be.source,Be["source-layer"]&&(Re.sourceLayer=Be["source-layer"]),Re.state=void 0!==Re.id?v.getFeatureState(Be["source-layer"],Re.id):{})});return $}function Io(v,l){const g=v.getRenderableIds().map(A=>v.getTileByID(A)),E=[],I={};for(let A=0;A<g.length;A++){const O=g[A],k=O.tileID.canonical.key;I[k]||(I[k]=!0,O.querySourceFeatures(E,l))}return E}function Er(v,l){const g=v.tileID,E=l.tileID;return g.overscaledZ-E.overscaledZ||g.canonical.y-E.canonical.y||g.wrap-E.wrap||g.canonical.x-E.canonical.x}function Ti(){return null!=Cf.workerClass?new Cf.workerClass:new p.window.Worker(Cf.workerUrl)}const Cs="mapboxgl_preloaded_worker_pool";class lo{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<lo.workerCount;)this.workers.push(new Ti);return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],0===this.numActive()&&(this.workers.forEach(g=>{g.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Cs]}numActive(){return Object.keys(this.active).length}}let ai;function du(){return ai||(ai=new lo),ai}function co(v,l){const g={};for(const E in v)"ref"!==E&&(g[E]=v[E]);return p.refProperties.forEach(E=>{E in l&&(g[E]=l[E])}),g}function el(v){v=v.slice();const l=Object.create(null);for(let g=0;g<v.length;g++)l[v[g].id]=v[g];for(let g=0;g<v.length;g++)"ref"in v[g]&&(v[g]=co(v[g],l[v[g].ref]));return v}lo.workerCount=2;const mr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Lh(v,l,g){g.push({command:mr.addSource,args:[v,l[v]]})}function mo(v,l,g){l.push({command:mr.removeSource,args:[v]}),g[v]=!0}function To(v,l,g,E){mo(v,g,E),Lh(v,l,g)}function tl(v,l,g){let E;for(E in v[g])if(v[g].hasOwnProperty(E)&&"data"!==E&&!H(v[g][E],l[g][E]))return!1;for(E in l[g])if(l[g].hasOwnProperty(E)&&"data"!==E&&!H(v[g][E],l[g][E]))return!1;return!0}function Ko(v,l,g,E,I,A){let O;for(O in l=l||{},v=v||{})v.hasOwnProperty(O)&&(H(v[O],l[O])||g.push({command:A,args:[E,O,l[O],I]}));for(O in l)l.hasOwnProperty(O)&&!v.hasOwnProperty(O)&&(H(v[O],l[O])||g.push({command:A,args:[E,O,l[O],I]}))}function Ss(v){return v.id}function Jo(v,l){return v[l.id]=l,v}class Sl{constructor(l,g){this.reset(l,g)}reset(l,g){this.points=l||[],this._distances=[0];for(let E=1;E<this.points.length;E++)this._distances[E]=this._distances[E-1]+this.points[E].dist(this.points[E-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(g||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(1===this.points.length)return this.points[0];l=p.clamp(l,0,1);let g=1,E=this._distances[g];const I=l*this.paddedLength+this.padding;for(;E<I&&g<this._distances.length;)E=this._distances[++g];const A=g-1,O=this._distances[A],k=E-O,U=k>0?(I-O)/k:0;return this.points[A].mult(1-U).add(this.points[g].mult(U))}}class ta{constructor(l,g,E){const I=this.boxCells=[],A=this.circleCells=[];this.xCellCount=Math.ceil(l/E),this.yCellCount=Math.ceil(g/E);for(let O=0;O<this.xCellCount*this.yCellCount;O++)I.push([]),A.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=g,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/g,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,g,E,I,A){this._forEachCell(g,E,I,A,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(g),this.bboxes.push(E),this.bboxes.push(I),this.bboxes.push(A)}insertCircle(l,g,E,I){this._forEachCell(g-I,E-I,g+I,E+I,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(g),this.circles.push(E),this.circles.push(I)}_insertBoxCell(l,g,E,I,A,O){this.boxCells[A].push(O)}_insertCircleCell(l,g,E,I,A,O){this.circleCells[A].push(O)}_query(l,g,E,I,A,O){if(E<0||l>this.width||I<0||g>this.height)return!A&&[];const k=[];if(l<=0&&g<=0&&this.width<=E&&this.height<=I){if(A)return!0;for(let U=0;U<this.boxKeys.length;U++)k.push({key:this.boxKeys[U],x1:this.bboxes[4*U],y1:this.bboxes[4*U+1],x2:this.bboxes[4*U+2],y2:this.bboxes[4*U+3]});for(let U=0;U<this.circleKeys.length;U++){const q=this.circles[3*U],$=this.circles[3*U+1],te=this.circles[3*U+2];k.push({key:this.circleKeys[U],x1:q-te,y1:$-te,x2:q+te,y2:$+te})}return O?k.filter(O):k}return this._forEachCell(l,g,E,I,this._queryCell,k,{hitTest:A,seenUids:{box:{},circle:{}}},O),A?k.length>0:k}_queryCircle(l,g,E,I,A){const O=l-E,k=l+E,U=g-E,q=g+E;if(k<0||O>this.width||q<0||U>this.height)return!I&&[];const $=[];return this._forEachCell(O,U,k,q,this._queryCellCircle,$,{hitTest:I,circle:{x:l,y:g,radius:E},seenUids:{box:{},circle:{}}},A),I?$.length>0:$}query(l,g,E,I,A){return this._query(l,g,E,I,!1,A)}hitTest(l,g,E,I,A){return this._query(l,g,E,I,!0,A)}hitTestCircle(l,g,E,I){return this._queryCircle(l,g,E,!0,I)}_queryCell(l,g,E,I,A,O,k,U){const q=k.seenUids,$=this.boxCells[A];if(null!==$){const Ee=this.bboxes;for(const Re of $)if(!q.box[Re]){q.box[Re]=!0;const Be=4*Re;if(l<=Ee[Be+2]&&g<=Ee[Be+3]&&E>=Ee[Be+0]&&I>=Ee[Be+1]&&(!U||U(this.boxKeys[Re]))){if(k.hitTest)return O.push(!0),!0;O.push({key:this.boxKeys[Re],x1:Ee[Be],y1:Ee[Be+1],x2:Ee[Be+2],y2:Ee[Be+3]})}}}const te=this.circleCells[A];if(null!==te){const Ee=this.circles;for(const Re of te)if(!q.circle[Re]){q.circle[Re]=!0;const Be=3*Re;if(this._circleAndRectCollide(Ee[Be],Ee[Be+1],Ee[Be+2],l,g,E,I)&&(!U||U(this.circleKeys[Re]))){if(k.hitTest)return O.push(!0),!0;{const Ne=Ee[Be],je=Ee[Be+1],oe=Ee[Be+2];O.push({key:this.circleKeys[Re],x1:Ne-oe,y1:je-oe,x2:Ne+oe,y2:je+oe})}}}}}_queryCellCircle(l,g,E,I,A,O,k,U){const q=k.circle,$=k.seenUids,te=this.boxCells[A];if(null!==te){const Re=this.bboxes;for(const Be of te)if(!$.box[Be]){$.box[Be]=!0;const Ne=4*Be;if(this._circleAndRectCollide(q.x,q.y,q.radius,Re[Ne+0],Re[Ne+1],Re[Ne+2],Re[Ne+3])&&(!U||U(this.boxKeys[Be])))return O.push(!0),!0}}const Ee=this.circleCells[A];if(null!==Ee){const Re=this.circles;for(const Be of Ee)if(!$.circle[Be]){$.circle[Be]=!0;const Ne=3*Be;if(this._circlesCollide(Re[Ne],Re[Ne+1],Re[Ne+2],q.x,q.y,q.radius)&&(!U||U(this.circleKeys[Be])))return O.push(!0),!0}}}_forEachCell(l,g,E,I,A,O,k,U){const q=this._convertToXCellCoord(l),$=this._convertToYCellCoord(g),te=this._convertToXCellCoord(E),Ee=this._convertToYCellCoord(I);for(let Re=q;Re<=te;Re++)for(let Be=$;Be<=Ee;Be++)if(A.call(this,l,g,E,I,this.xCellCount*Be+Re,O,k,U))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,g,E,I,A,O){const k=I-l,U=A-g,q=E+O;return q*q>k*k+U*U}_circleAndRectCollide(l,g,E,I,A,O,k){const U=(O-I)/2,q=Math.abs(l-(I+U));if(q>U+E)return!1;const $=(k-A)/2,te=Math.abs(g-(A+$));if(te>$+E)return!1;if(q<=U||te<=$)return!0;const Ee=q-U,Re=te-$;return Ee*Ee+Re*Re<=E*E}}const Gs={unknown:0,flipRequired:1,flipNotRequired:2},na=Math.tan(85*Math.PI/180);function Ht(v,l,g,E,I,A,O){const k=p.create();if(g)if("globe"===A.name){const U=p.calculateGlobeLabelMatrix(I,l);p.multiply(k,k,U)}else{const U=Z([],O);k[0]=U[0],k[1]=U[1],k[4]=U[2],k[5]=U[3],E||p.rotateZ(k,k,I.angle)}else p.multiply(k,I.labelPlaneMatrix,v);return k}function pu(v,l,g,E,I,A,O){const k=Ht(v,l,g,E,I,A,O);return"globe"===A.name&&g||(k[2]=k[6]=k[10]=k[14]=0),k}function qo(v,l,g,E,I,A,O){if(g){if("globe"===A.name){const k=Ht(v,l,g,E,I,A,O);return p.invert(k,k),p.multiply(k,v,k),k}{const k=p.clone(v),U=p.identity([]);return U[0]=O[0],U[1]=O[1],U[4]=O[2],U[5]=O[3],p.multiply(k,k,U),E||p.rotateZ(k,k,-I.angle),k}}return I.glCoordMatrix}function _s(v,l,g,E){const I=[v,l,g,1];g?p.transformMat4$1(I,I,E):Hr(I,I,E);const A=I[3];return I[0]/=A,I[1]/=A,I[2]/=A,I}function Ho(v,l){return Math.min(.5+v/l*.5,1.5)}function Vo(v,l){const g=v[0]/v[3],E=v[1]/v[3];return g>=-l[0]&&g<=l[0]&&E>=-l[1]&&E<=l[1]}function gu(v,l,g,E,I,A,O,k,U,q){const $=g.transform,te=E?v.textSizeData:v.iconSizeData,Ee=p.evaluateSizeForZoom(te,g.transform.zoom),Re="globe"===$.projection.name,Be=[256/g.width*2+1,256/g.height*2+1],Ne=E?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;Ne.clear();let je=null;Re&&(je=E?v.text.globeExtVertexArray:v.icon.globeExtVertexArray);const oe=v.lineVertexArray,Pe=E?v.text.placedSymbolArray:v.icon.placedSymbolArray,Xe=g.transform.width/g.transform.height;let He,gt=!1;for(let mt=0;mt<Pe.length;mt++){const it=Pe.get(mt),{numGlyphs:St,writingMode:Et}=it;if(Et!==p.WritingMode.vertical||gt||He===p.WritingMode.horizontal||(gt=!0),He=Et,(it.hidden||Et===p.WritingMode.vertical)&&!gt){Bn(St,Ne);continue}gt=!1;const Tt=new p.Point(it.tileAnchorX,it.tileAnchorY);let{x:mn,y:Rt,z:Kt}=$.projection.projectTilePoint(Tt.x,Tt.y,q.canonical);if(U){const[Tr,jn,fr]=U(Tt);mn+=Tr,Rt+=jn,Kt+=fr}const Nt=[mn,Rt,Kt,1];if(p.transformMat4$1(Nt,Nt,l),!Vo(Nt,Be)){Bn(St,Ne);continue}const dn=Ho(g.transform.cameraToCenterDistance,Nt[3]),kt=p.evaluateSizeForFeature(te,Ee,it),Jt=O?kt/dn:kt*dn,un=_s(mn,Rt,Kt,I);if(un[3]<=0){Bn(St,Ne);continue}let on={};const vn=O?null:U,nr=nn(it,Jt,!1,k,l,I,A,v.glyphOffsetArray,oe,Ne,je,un,Tt,on,Xe,vn,$.projection,q,O);gt=nr.useVertical,vn&&nr.needsFlipping&&(on={}),(nr.notEnoughRoom||gt||nr.needsFlipping&&nn(it,Jt,!0,k,l,I,A,v.glyphOffsetArray,oe,Ne,je,un,Tt,on,Xe,vn,$.projection,q,O).notEnoughRoom)&&Bn(St,Ne)}E?(v.text.dynamicLayoutVertexBuffer.updateData(Ne),je&&v.text.globeExtVertexBuffer.updateData(je)):(v.icon.dynamicLayoutVertexBuffer.updateData(Ne),je&&v.icon.globeExtVertexBuffer.updateData(je))}function Or(v,l,g,E,I,A,O,k,U,q,$,te,Ee,Re,Be,Ne){const{lineStartIndex:je,glyphStartIndex:oe,segment:Pe}=k,Xe=oe+k.numGlyphs,He=je+k.lineLength,gt=l.getoffsetX(oe),mt=l.getoffsetX(Xe-1),it=Va(v*gt,g,E,I,A,O,Pe,je,He,U,q,$,te,Ee,!0,Re,Be,Ne);if(!it)return null;const St=Va(v*mt,g,E,I,A,O,Pe,je,He,U,q,$,te,Ee,!0,Re,Be,Ne);return St?{first:it,last:St}:null}function Wl(v,l,g,E){return v===p.WritingMode.horizontal&&Math.abs(E)>Math.abs(g)?{useVertical:!0}:v===p.WritingMode.vertical?E>0?{needsFlipping:!0}:null:l!==Gs.unknown&&(0===(I=g)||Math.abs(E/I)>na)?l===Gs.flipRequired?{needsFlipping:!0}:null:g<0?{needsFlipping:!0}:null;var I}function nn(v,l,g,E,I,A,O,k,U,q,$,te,Ee,Re,Be,Ne,je,oe,Pe){const Xe=l/24,He=v.lineOffsetX*Xe,gt=v.lineOffsetY*Xe,{lineStartIndex:mt,glyphStartIndex:it,numGlyphs:St,segment:Et,writingMode:Tt,flipState:mn}=v,Rt=mt+v.lineLength,Kt=Nt=>{if($){const[un,on,vn]=Nt.up,nr=q.length;p.updateGlobeVertexNormal($,nr+0,un,on,vn),p.updateGlobeVertexNormal($,nr+1,un,on,vn),p.updateGlobeVertexNormal($,nr+2,un,on,vn),p.updateGlobeVertexNormal($,nr+3,un,on,vn)}const[dn,kt,Jt]=Nt.point;p.addDynamicAttributes(q,dn,kt,Jt,Nt.angle)};if(St>1){const Nt=Or(Xe,k,He,gt,g,te,Ee,v,U,A,Re,Ne,!1,je,oe,Pe);if(!Nt)return{notEnoughRoom:!0};if(E&&!g){let[dn,kt,Jt]=Nt.first.point,[un,on,vn]=Nt.last.point;[dn,kt]=_s(dn,kt,Jt,O),[un,on]=_s(un,on,vn,O);const nr=Wl(Tt,mn,(un-dn)*Be,on-kt);if(v.flipState=nr&&nr.needsFlipping?Gs.flipRequired:Gs.flipNotRequired,nr)return nr}Kt(Nt.first);for(let dn=it+1;dn<it+St-1;dn++){const kt=Va(Xe*k.getoffsetX(dn),He,gt,g,te,Ee,Et,mt,Rt,U,A,Re,Ne,!1,!1,je,oe,Pe);if(!kt)return q.length-=4*(dn-it),{notEnoughRoom:!0};Kt(kt)}Kt(Nt.last)}else{if(E&&!g){const dn=_s(Ee.x,Ee.y,0,I),kt=mt+Et+1,Jt=new p.Point(U.getx(kt),U.gety(kt)),un=_s(Jt.x,Jt.y,0,I),on=un[3]>0?un:_r(Ee,Jt,dn,1,I,void 0,je,oe.canonical),vn=Wl(Tt,mn,(on[0]-dn[0])*Be,on[1]-dn[1]);if(v.flipState=vn&&vn.needsFlipping?Gs.flipRequired:Gs.flipNotRequired,vn)return vn}const Nt=Va(Xe*k.getoffsetX(it),He,gt,g,te,Ee,Et,mt,Rt,U,A,Re,Ne,!1,!1,je,oe,Pe);if(!Nt)return{notEnoughRoom:!0};Kt(Nt)}return{}}function Cr(v,l,g,E,I){const{x:A,y:O,z:k}=E.projectTilePoint(v.x,v.y,l);if(!I)return _s(A,O,k,g);const[U,q,$]=I(v);return _s(A+U,O+q,k+$,g)}function _r(v,l,g,E,I,A,O,k){const U=Cr(v.sub(l)._unit()._add(v),k,I,O,A);return p.sub(U,g,U),p.normalize(U,U),p.scaleAndAdd(U,g,U,E)}function Va(v,l,g,E,I,A,O,k,U,q,$,te,Ee,Re,Be,Ne,je,oe){const Pe=E?v-l:v+l;let Xe=Pe>0?1:-1,He=0;E&&(Xe*=-1,He=Math.PI),Xe<0&&(He+=Math.PI);let gt=k+O+(Xe>0?0:1)|0,mt=I,it=I,St=0,Et=0;const Tt=Math.abs(Pe),mn=[],Rt=[];let Kt=A,Nt=Kt;const dn=()=>_r(Nt,Kt,it,Tt-St+1,$,Ee,Ne,je.canonical);for(;St+Et<=Tt;){if(gt+=Xe,gt<k||gt>=U)return null;if(it=mt,Nt=Kt,mn.push(it),Re&&Rt.push(Nt),Kt=new p.Point(q.getx(gt),q.gety(gt)),mt=te[gt],!mt){const fr=Cr(Kt,je.canonical,$,Ne,Ee);mt=fr[3]>0?te[gt]=fr:dn()}St+=Et,Et=p.distance(it,mt)}Be&&Ee&&(te[gt]&&(mt=dn(),Et=p.distance(it,mt)),te[gt]=mt);const kt=(Tt-St)/Et,Jt=Kt.sub(Nt)._mult(kt)._add(Nt),un=p.sub([],mt,it),on=p.scaleAndAdd([],it,un,kt);let vn=[0,0,1],nr=un[0],Tr=un[1];if(oe&&(vn=Ne.upVector(je.canonical,Jt.x,Jt.y),0!==vn[0]||0!==vn[1]||1!==vn[2])){const fr=[vn[2],0,-vn[0]],Rn=p.cross([],vn,fr);p.normalize(fr,fr),p.normalize(Rn,Rn),nr=p.dot(un,fr),Tr=p.dot(un,Rn)}if(g){const fr=p.cross([],vn,un);p.normalize(fr,fr),p.scaleAndAdd(on,on,fr,g*Xe)}const jn=He+Math.atan2(Tr,nr);return mn.push(on),Re&&Rt.push(Jt),{point:on,angle:jn,path:mn,tilePath:Rt,up:vn}}function Bn(v,l){const g=l.length,E=g+4*v;l.resize(E),l.float32.fill(-1/0,4*g,4*E)}function Hr(v,l,g){const E=l[0],I=l[1];return v[0]=g[0]*E+g[4]*I+g[12],v[1]=g[1]*E+g[5]*I+g[13],v[3]=g[3]*E+g[7]*I+g[15],v}const oo=100;class nl{constructor(l,g,E=new ta(l.width+200,l.height+200,25),I=new ta(l.width+200,l.height+200,25)){this.transform=l,this.grid=E,this.ignoredGrid=I,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+oo,this.screenBottomBoundary=l.height+oo,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=g}placeCollisionBox(l,g,E,I,A,O,k,U){let q=E.projectedAnchorX,$=E.projectedAnchorY,te=E.projectedAnchorZ;const Ee=E.elevation,Re=E.tileID,Be=l.getProjection();if(Ee&&Re){const[mt,it,St]=Be.upVector(Re.canonical,E.tileAnchorX,E.tileAnchorY),Et=Be.upVectorScale(Re.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;q+=mt*Ee*Et,$+=it*Ee*Et,te+=St*Ee*Et}const Ne=this.projectAndGetPerspectiveRatio(k,q,$,te,E.tileID,"globe"===Be.name||!!Ee||this.transform.pitch>0,Be),je=O*Ne.perspectiveRatio,oe=(E.x1*g+I.x-E.padding)*je+Ne.point.x,Pe=(E.y1*g+I.y-E.padding)*je+Ne.point.y,Xe=(E.x2*g+I.x+E.padding)*je+Ne.point.x,He=(E.y2*g+I.y+E.padding)*je+Ne.point.y,gt=Ne.perspectiveRatio<=.55||Ne.occluded;return!this.isInsideGrid(oe,Pe,Xe,He)||!A&&this.grid.hitTest(oe,Pe,Xe,He,U)||gt?{box:[],offscreen:!1,occluded:Ne.occluded}:{box:[oe,Pe,Xe,He],offscreen:this.isOffscreen(oe,Pe,Xe,He),occluded:!1}}placeCollisionCircles(l,g,E,I,A,O,k,U,q,$,te,Ee,Re,Be,Ne){const je=[],oe=this.transform.elevation,Pe=l.getProjection(),Xe=oe?oe.getAtTileOffsetFunc(Ne,this.transform.center.lat,this.transform.worldSize,Pe):null,He=new p.Point(E.tileAnchorX,E.tileAnchorY);let{x:gt,y:mt,z:it}=Pe.projectTilePoint(He.x,He.y,Ne.canonical);if(Xe){const[Jt,un,on]=Xe(He);gt+=Jt,mt+=un,it+=on}const St="globe"===Pe.name,Et=this.projectAndGetPerspectiveRatio(k,gt,mt,it,Ne,St||!!oe||this.transform.pitch>0,Pe),{perspectiveRatio:Tt}=Et,mn=(te?O/Tt:O*Tt)/p.ONE_EM,Rt=_s(gt,mt,it,U),Kt=Et.signedDistanceFromCamera>0?Or(mn,A,E.lineOffsetX*mn,E.lineOffsetY*mn,!1,Rt,He,E,I,U,{},oe&&!te?Xe:null,te&&!!oe,Pe,Ne,te):null;let Nt=!1,dn=!1,kt=!0;if(Kt&&!Et.occluded){const Jt=.5*Re*Tt+Be,un=new p.Point(-100,-100),on=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),vn=new Sl,{first:nr,last:Tr}=Kt,jn=nr.path.length;let fr=[];for(let Jn=jn-1;Jn>=1;Jn--)fr.push(nr.path[Jn]);for(let Jn=1;Jn<Tr.path.length;Jn++)fr.push(Tr.path[Jn]);const Rn=2.5*Jt;q&&(fr=fr.map(([Jn,ao,Ro],Lo)=>(Xe&&!St&&(Ro=Xe(Lo<jn-1?nr.tilePath[jn-1-Lo]:Tr.tilePath[Lo-jn+2])[2]),_s(Jn,ao,Ro,q))),fr.some(Jn=>Jn[3]<=0)&&(fr=[]));let ei=[];if(fr.length>0){let Jn=1/0,ao=-1/0,Ro=1/0,Lo=-1/0;for(const wo of fr)Jn=Math.min(Jn,wo[0]),Ro=Math.min(Ro,wo[1]),ao=Math.max(ao,wo[0]),Lo=Math.max(Lo,wo[1]);ao>=un.x&&Jn<=on.x&&Lo>=un.y&&Ro<=on.y&&(ei=[fr.map(wo=>new p.Point(wo[0],wo[1]))],(Jn<un.x||ao>on.x||Ro<un.y||Lo>on.y)&&(ei=p.clipLine(ei,un.x,un.y,on.x,on.y)))}for(const Jn of ei){vn.reset(Jn,.25*Jt);let ao=0;ao=vn.length<=.5*Jt?1:Math.ceil(vn.paddedLength/Rn)+1;for(let Ro=0;Ro<ao;Ro++){const Lo=Ro/Math.max(ao-1,1),wo=vn.lerp(Lo),Ys=wo.x+oo,Na=wo.y+oo;je.push(Ys,Na,Jt,0);const cl=Ys-Jt,ec=Na-Jt,ls=Ys+Jt,Oo=Na+Jt;if(kt=kt&&this.isOffscreen(cl,ec,ls,Oo),dn=dn||this.isInsideGrid(cl,ec,ls,Oo),!g&&this.grid.hitTestCircle(Ys,Na,Jt,Ee)&&(Nt=!0,!$))return{circles:[],offscreen:!1,collisionDetected:Nt,occluded:!1}}}}return{circles:!$&&Nt||!dn?[]:je,offscreen:kt,collisionDetected:Nt,occluded:Et.occluded}}queryRenderedSymbols(l){if(0===l.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const g=[];let E=1/0,I=1/0,A=-1/0,O=-1/0;for(const $ of l){const te=new p.Point($.x+oo,$.y+oo);E=Math.min(E,te.x),I=Math.min(I,te.y),A=Math.max(A,te.x),O=Math.max(O,te.y),g.push(te)}const k=this.grid.query(E,I,A,O).concat(this.ignoredGrid.query(E,I,A,O)),U={},q={};for(const $ of k){const te=$.key;if(void 0===U[te.bucketInstanceId]&&(U[te.bucketInstanceId]={}),U[te.bucketInstanceId][te.featureIndex])continue;const Ee=[new p.Point($.x1,$.y1),new p.Point($.x2,$.y1),new p.Point($.x2,$.y2),new p.Point($.x1,$.y2)];p.polygonIntersectsPolygon(g,Ee)&&(U[te.bucketInstanceId][te.featureIndex]=!0,void 0===q[te.bucketInstanceId]&&(q[te.bucketInstanceId]=[]),q[te.bucketInstanceId].push(te.featureIndex))}return q}insertCollisionBox(l,g,E,I,A){(g?this.ignoredGrid:this.grid).insert({bucketInstanceId:E,featureIndex:I,collisionGroupID:A},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,g,E,I,A){const O=g?this.ignoredGrid:this.grid,k={bucketInstanceId:E,featureIndex:I,collisionGroupID:A};for(let U=0;U<l.length;U+=4)O.insertCircle(k,l[U],l[U+1],l[U+2])}projectAndGetPerspectiveRatio(l,g,E,I,A,O,k){const U=[g,E,I,1];let q=!1;I||this.transform.pitch>0?(p.transformMat4$1(U,U,l),this.fogState&&A&&"globe"!==k.name&&(q=function(Ee,Re,Be,Ne,je,oe){const Pe=oe.calculateFogTileMatrix(je),Xe=[Re,Be,Ne];return p.transformMat4(Xe,Xe,Pe),Wt(Ee,Xe,oe.pitch,oe._fov)}(this.fogState,g,E,I,A.toUnwrapped(),this.transform)>.9)):Hr(U,U,l);const $=U[3];return{point:new p.Point((U[0]/$+1)/2*this.transform.width+oo,(-U[1]/$+1)/2*this.transform.height+oo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/$*.5,1.5),signedDistanceFromCamera:$,occluded:O&&U[2]>$||q}}isOffscreen(l,g,E,I){return E<oo||l>=this.screenRightBoundary||I<oo||g>this.screenBottomBoundary}isInsideGrid(l,g,E,I){return E>=0&&l<this.gridRightBoundary&&I>=0&&g<this.gridBottomBoundary}getViewportMatrix(){const l=p.identity([]);return p.translate(l,l,[-100,-100,0]),l}}function ra(v,l,g){const E=l.createTileMatrix(v,v.worldSize,g.toUnwrapped());return p.multiply(new Float32Array(16),v.projMatrix,E)}function cs(v,l,g){if(l.projection.name===g.projection.name)return v.projMatrix;const E=g.clone();return E.setProjection(l.projection),ra(E,l.getProjection(),v)}function $n(v,l,g){return l.name===g.projection.name?v.projMatrix:ra(g,l,v)}class eh{constructor(l,g,E,I){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?g:-g))):I&&E?1:0,this.placed=E}isHidden(){return 0===this.opacity&&!this.placed}}class pn{constructor(l,g,E,I,A,O=!1){this.text=new eh(l?l.text:null,g,E,A),this.icon=new eh(l?l.icon:null,g,I,A),this.clipped=O}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class lc{constructor(l,g,E,I=!1){this.text=l,this.icon=g,this.skipFade=E,this.clipped=I}}class ma{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class Dn{constructor(l,g,E,I,A){this.bucketInstanceId=l,this.featureIndex=g,this.sourceLayerIndex=E,this.bucketIndex=I,this.tileID=A}}class Xl{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const g=++this.maxGroupID;this.collisionGroups[l]={ID:g,predicate:E=>E.collisionGroupID===g}}return this.collisionGroups[l]}}function Yn(v,l,g,E,I){const{horizontalAlign:A,verticalAlign:O}=p.getAnchorAlignment(v),k=-(A-.5)*l,U=-(O-.5)*g,q=p.evaluateVariableOffset(v,E);return new p.Point(k+q[0]*I,U+q[1]*I)}function rr(v,l,g,E,I){const A=new p.Point(v,l);return g&&A._rotate(E?I:-I),A}class fi{constructor(l,g,E,I,A){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new nl(this.transform,A),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new Xl(E),this.collisionCircleArrays={},this.prevPlacement=I,I&&(I.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,g,E,I){const A=E.getBucket(g),O=E.latestFeatureIndex;if(!A||!O||g.id!==A.layerIds[0])return;const k=A.layers[0].layout,U=E.collisionBoxArray,q=Math.pow(2,this.transform.zoom-E.tileID.overscaledZ),$=E.tileSize/p.EXTENT,te=E.tileID.toUnwrapped();this.transform.setProjection(A.projection);const Ee=(Re=E.tileID,Be=A.getProjection(),Ne=this.transform,Be.name===this.projection?Ne.calculateProjMatrix(Re.toUnwrapped()):ra(Ne,Be,Re));var Re,Be,Ne;const je="map"===k.get("text-pitch-alignment"),oe="map"===k.get("text-rotation-alignment");g.compileFilter();const Pe=g.dynamicFilter(),Xe=g.dynamicFilterNeedsFeature(),He=this.transform.calculatePixelsToTileUnitsMatrix(E),gt=pu(Ee,E.tileID.canonical,je,oe,this.transform,A.getProjection(),He);let mt=null;if(je){const Et=qo(Ee,E.tileID.canonical,je,oe,this.transform,A.getProjection(),He);mt=p.multiply([],this.transform.labelPlaneMatrix,Et)}let it=null;Pe&&E.latestFeatureIndex&&(it={unwrappedTileID:te,dynamicFilter:Pe,dynamicFilterNeedsFeature:Xe,featureIndex:E.latestFeatureIndex}),this.retainedQueryData[A.bucketInstanceId]=new Dn(A.bucketInstanceId,O,A.sourceLayerIndex,A.index,E.tileID);const St={bucket:A,layout:k,posMatrix:Ee,textLabelPlaneMatrix:gt,labelToScreenMatrix:mt,clippingData:it,scale:q,textPixelRatio:$,holdingForFade:E.holdingForFade(),collisionBoxArray:U,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(A.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(A.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(A.sourceID)};if(I)for(const Et of A.sortKeyRanges){const{sortKey:Tt,symbolInstanceStart:mn,symbolInstanceEnd:Rt}=Et;l.push({sortKey:Tt,symbolInstanceStart:mn,symbolInstanceEnd:Rt,parameters:St})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:St})}attemptAnchorPlacement(l,g,E,I,A,O,k,U,q,$,te,Ee,Re,Be,Ne,je,oe,Pe){const{textOffset0:Xe,textOffset1:He,crossTileID:gt}=Ee,mt=[Xe,He],it=Yn(l,E,I,mt,A),St=this.collisionIndex.placeCollisionBox(Be,A,g,rr(it.x,it.y,O,k,this.transform.angle),te,U,q,$.predicate);if(je){const Et=Be.getSymbolInstanceIconSize(Pe,this.transform.zoom,Ee.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(Be,Et,je,rr(it.x,it.y,O,k,this.transform.angle),te,U,q,$.predicate).box.length)return}if(St.box.length>0){let Et;return this.prevPlacement&&this.prevPlacement.variableOffsets[gt]&&this.prevPlacement.placements[gt]&&this.prevPlacement.placements[gt].text&&(Et=this.prevPlacement.variableOffsets[gt].anchor),this.variableOffsets[gt]={textOffset:mt,width:E,height:I,anchor:l,textScale:A,prevAnchor:Et},this.markUsedJustification(Be,l,Ee,Ne),Be.allowVerticalPlacement&&(this.markUsedOrientation(Be,Ne,Ee),this.placedOrientations[gt]=Ne),{shift:it,placedGlyphBoxes:St}}}placeLayerBucketPart(l,g,E,I){const{bucket:A,layout:O,posMatrix:k,textLabelPlaneMatrix:U,labelToScreenMatrix:q,clippingData:$,textPixelRatio:te,holdingForFade:Ee,collisionBoxArray:Re,partiallyEvaluatedTextSize:Be,partiallyEvaluatedIconSize:Ne,collisionGroup:je}=l.parameters,oe=O.get("text-optional"),Pe=O.get("icon-optional"),Xe=O.get("text-allow-overlap"),He=O.get("icon-allow-overlap"),gt="map"===O.get("text-rotation-alignment"),mt="map"===O.get("text-pitch-alignment"),it="none"!==O.get("icon-text-fit"),St="viewport-y"===O.get("symbol-z-order");this.transform.setProjection(A.projection);let Et=Xe&&(He||!A.hasIconData()||Pe),Tt=He&&(Xe||!A.hasTextData()||oe);!A.collisionArrays&&Re&&A.deserializeCollisionBoxes(Re),E&&I&&A.updateCollisionDebugBuffers(this.transform.zoom,Re);const mn=(Rt,Kt,Nt)=>{const{crossTileID:dn,numVerticalGlyphVertices:kt}=Rt;if($){const ls={zoom:this.transform.zoom,pitch:this.transform.pitch};let Oo=null;if($.dynamicFilterNeedsFeature){const Zt=this.retainedQueryData[A.bucketInstanceId];Oo=$.featureIndex.loadFeature({featureIndex:Rt.featureIndex,bucketIndex:Zt.bucketIndex,sourceLayerIndex:Zt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,$.dynamicFilter)(ls,Oo,this.retainedQueryData[A.bucketInstanceId].tileID.canonical,new p.Point(Rt.tileAnchorX,Rt.tileAnchorY),this.transform.calculateDistanceTileData($.unwrappedTileID)))return this.placements[dn]=new lc(!1,!1,!1,!0),void g.add(dn)}if(g.has(dn))return;if(Ee)return void(this.placements[dn]=new lc(!1,!1,!1));let Jt=!1,un=!1,on=!0,vn=!1,nr=!1,Tr=null,jn={box:null,offscreen:null,occluded:null},fr={box:null,offscreen:null,occluded:null},Rn=null,ei=null,Jn=null,ao=0,Ro=0,Lo=0;Nt.textFeatureIndex?ao=Nt.textFeatureIndex:Rt.useRuntimeCollisionCircles&&(ao=Rt.featureIndex),Nt.verticalTextFeatureIndex&&(Ro=Nt.verticalTextFeatureIndex);const wo=ls=>{ls.tileID=this.retainedQueryData[A.bucketInstanceId].tileID;const Oo=this.transform.elevation;(Oo||ls.elevation)&&(ls.elevation=Oo?Oo.getAtTileOffset(ls.tileID,ls.tileAnchorX,ls.tileAnchorY):0)},Ys=Nt.textBox;if(Ys){wo(Ys);const ls=Zt=>{let Sr=p.WritingMode.horizontal;if(A.allowVerticalPlacement&&!Zt&&this.prevPlacement){const Cu=this.prevPlacement.placedOrientations[dn];Cu&&(this.placedOrientations[dn]=Cu,Sr=Cu,this.markUsedOrientation(A,Sr,Rt))}return Sr},Oo=(Zt,Sr)=>{if(A.allowVerticalPlacement&&kt>0&&Nt.verticalTextBox){for(const Cu of A.writingModes)if(Cu===p.WritingMode.vertical?(jn=Sr(),fr=jn):jn=Zt(),jn&&jn.box&&jn.box.length)break}else jn=Zt()};if(O.get("text-variable-anchor")){let Zt=O.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[dn]){const rs=this.prevPlacement.variableOffsets[dn];Zt.indexOf(rs.anchor)>0&&(Zt=Zt.filter(No=>No!==rs.anchor),Zt.unshift(rs.anchor))}const Sr=(rs,No,Sf)=>{const Ol=A.getSymbolInstanceTextSize(Be,Rt,this.transform.zoom,Kt),ku=(rs.x2-rs.x1)*Ol+2*rs.padding,Nl=(rs.y2-rs.y1)*Ol+2*rs.padding,tc=it&&!He?No:null;tc&&wo(tc);let uh={box:[],offscreen:!1,occluded:!1};const sp=Xe?2*Zt.length:Zt.length;for(let Uh=0;Uh<sp;++Uh){const Za=this.attemptAnchorPlacement(Zt[Uh%Zt.length],rs,ku,Nl,Ol,gt,mt,te,k,je,Uh>=Zt.length,Rt,Kt,A,Sf,tc,Be,Ne);if(Za&&(uh=Za.placedGlyphBoxes,uh&&uh.box&&uh.box.length)){Jt=!0,Tr=Za.shift;break}}return uh};Oo(()=>Sr(Ys,Nt.iconBox,p.WritingMode.horizontal),()=>{const rs=Nt.verticalTextBox;return rs&&wo(rs),A.allowVerticalPlacement&&!(jn&&jn.box&&jn.box.length)&&kt>0&&rs?Sr(rs,Nt.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),jn&&(Jt=jn.box,on=jn.offscreen,vn=jn.occluded);const Cu=ls(!(!jn||!jn.box));if(!Jt&&this.prevPlacement){const rs=this.prevPlacement.variableOffsets[dn];rs&&(this.variableOffsets[dn]=rs,this.markUsedJustification(A,rs.anchor,Rt,Cu))}}else{const Zt=(Sr,Cu)=>{const rs=A.getSymbolInstanceTextSize(Be,Rt,this.transform.zoom,Kt),No=this.collisionIndex.placeCollisionBox(A,rs,Sr,new p.Point(0,0),Xe,te,k,je.predicate);return No&&No.box&&No.box.length&&(this.markUsedOrientation(A,Cu,Rt),this.placedOrientations[dn]=Cu),No};Oo(()=>Zt(Ys,p.WritingMode.horizontal),()=>{const Sr=Nt.verticalTextBox;return A.allowVerticalPlacement&&kt>0&&Sr?(wo(Sr),Zt(Sr,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),ls(!!(jn&&jn.box&&jn.box.length))}}if(Rn=jn,Jt=Rn&&Rn.box&&Rn.box.length>0,on=Rn&&Rn.offscreen,vn=Rn&&Rn.occluded,Rt.useRuntimeCollisionCircles){const ls=A.text.placedSymbolArray.get(Rt.centerJustifiedTextSymbolIndex>=0?Rt.centerJustifiedTextSymbolIndex:Rt.verticalPlacedTextSymbolIndex),Oo=p.evaluateSizeForFeature(A.textSizeData,Be,ls),Zt=O.get("text-padding");ei=this.collisionIndex.placeCollisionCircles(A,Xe,ls,A.lineVertexArray,A.glyphOffsetArray,Oo,k,U,q,E,mt,je.predicate,Rt.collisionCircleDiameter*Oo/p.ONE_EM,Zt,this.retainedQueryData[A.bucketInstanceId].tileID),Jt=Xe||ei.circles.length>0&&!ei.collisionDetected,on=on&&ei.offscreen,vn=ei.occluded}if(Nt.iconFeatureIndex&&(Lo=Nt.iconFeatureIndex),Nt.iconBox){const ls=Oo=>{wo(Oo);const Zt=it&&Tr?rr(Tr.x,Tr.y,gt,mt,this.transform.angle):new p.Point(0,0),Sr=A.getSymbolInstanceIconSize(Ne,this.transform.zoom,Rt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(A,Sr,Oo,Zt,He,te,k,je.predicate)};fr&&fr.box&&fr.box.length&&Nt.verticalIconBox?(Jn=ls(Nt.verticalIconBox),un=Jn.box.length>0):(Jn=ls(Nt.iconBox),un=Jn.box.length>0),on=on&&Jn.offscreen,nr=Jn.occluded}const Na=oe||0===Rt.numHorizontalGlyphVertices&&0===kt,cl=Pe||0===Rt.numIconVertices;if(Na||cl?cl?Na||(un=un&&Jt):Jt=un&&Jt:un=Jt=un&&Jt,Jt&&Rn&&Rn.box&&this.collisionIndex.insertCollisionBox(Rn.box,O.get("text-ignore-placement"),A.bucketInstanceId,fr&&fr.box&&Ro?Ro:ao,je.ID),un&&Jn&&this.collisionIndex.insertCollisionBox(Jn.box,O.get("icon-ignore-placement"),A.bucketInstanceId,Lo,je.ID),ei&&(Jt&&this.collisionIndex.insertCollisionCircles(ei.circles,O.get("text-ignore-placement"),A.bucketInstanceId,ao,je.ID),E)){const ls=A.bucketInstanceId;let Oo=this.collisionCircleArrays[ls];void 0===Oo&&(Oo=this.collisionCircleArrays[ls]=new ma);for(let Zt=0;Zt<ei.circles.length;Zt+=4)Oo.circles.push(ei.circles[Zt+0]),Oo.circles.push(ei.circles[Zt+1]),Oo.circles.push(ei.circles[Zt+2]),Oo.circles.push(ei.collisionDetected?1:0)}const ec="globe"!==A.projection.name;Et=Et&&(ec||!vn),Tt=Tt&&(ec||!nr),this.placements[dn]=new lc(Jt||Et,un||Tt,on||A.justReloaded),g.add(dn)};if(St){const Rt=A.getSortedSymbolIndexes(this.transform.angle);for(let Kt=Rt.length-1;Kt>=0;--Kt){const Nt=Rt[Kt];mn(A.symbolInstances.get(Nt),Nt,A.collisionArrays[Nt])}}else for(let Rt=l.symbolInstanceStart;Rt<l.symbolInstanceEnd;Rt++)mn(A.symbolInstances.get(Rt),Rt,A.collisionArrays[Rt]);if(E&&A.bucketInstanceId in this.collisionCircleArrays){const Rt=this.collisionCircleArrays[A.bucketInstanceId];p.invert(Rt.invProjMatrix,k),Rt.viewportMatrix=this.collisionIndex.getViewportMatrix()}A.justReloaded=!1}markUsedJustification(l,g,E,I){const{leftJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:O,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:U,crossTileID:q}=E,$=p.getAnchorJustification(g),te=I===p.WritingMode.vertical?U:"left"===$?A:"center"===$?O:"right"===$?k:-1;A>=0&&(l.text.placedSymbolArray.get(A).crossTileID=te>=0&&A!==te?0:q),O>=0&&(l.text.placedSymbolArray.get(O).crossTileID=te>=0&&O!==te?0:q),k>=0&&(l.text.placedSymbolArray.get(k).crossTileID=te>=0&&k!==te?0:q),U>=0&&(l.text.placedSymbolArray.get(U).crossTileID=te>=0&&U!==te?0:q)}markUsedOrientation(l,g,E){const I=g===p.WritingMode.horizontal||g===p.WritingMode.horizontalOnly?g:0,A=g===p.WritingMode.vertical?g:0,{leftJustifiedTextSymbolIndex:O,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:U,verticalPlacedTextSymbolIndex:q}=E,$=l.text.placedSymbolArray;O>=0&&($.get(O).placedOrientation=I),k>=0&&($.get(k).placedOrientation=I),U>=0&&($.get(U).placedOrientation=I),q>=0&&($.get(q).placedOrientation=A)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const g=this.prevPlacement;let E=!1;this.prevZoomAdjustment=g?g.zoomAdjustment(this.transform.zoom):0;const I=g?g.symbolFadeChange(l):1,A=g?g.opacities:{},O=g?g.variableOffsets:{},k=g?g.placedOrientations:{};for(const U in this.placements){const q=this.placements[U],$=A[U];$?(this.opacities[U]=new pn($,I,q.text,q.icon,null,q.clipped),E=E||q.text!==$.text.placed||q.icon!==$.icon.placed):(this.opacities[U]=new pn(null,I,q.text,q.icon,q.skipFade,q.clipped),E=E||q.text||q.icon)}for(const U in A){const q=A[U];if(!this.opacities[U]){const $=new pn(q,I,!1,!1);$.isHidden()||(this.opacities[U]=$,E=E||q.text.placed||q.icon.placed)}}for(const U in O)this.variableOffsets[U]||!this.opacities[U]||this.opacities[U].isHidden()||(this.variableOffsets[U]=O[U]);for(const U in k)this.placedOrientations[U]||!this.opacities[U]||this.opacities[U].isHidden()||(this.placedOrientations[U]=k[U]);E?this.lastPlacementChangeTime=l:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=g?g.lastPlacementChangeTime:l)}updateLayerOpacities(l,g){const E=new Set;for(const I of g){const A=I.getBucket(l);A&&I.latestFeatureIndex&&l.id===A.layerIds[0]&&this.updateBucketOpacities(A,E,I.collisionBoxArray)}}updateBucketOpacities(l,g,E){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const I=l.layers[0].layout,A=!!l.layers[0].dynamicFilter(),O=new pn(null,0,!1,!1,!0),k=I.get("text-allow-overlap"),U=I.get("icon-allow-overlap"),q=I.get("text-variable-anchor"),$="map"===I.get("text-rotation-alignment"),te="map"===I.get("text-pitch-alignment"),Ee="none"!==I.get("icon-text-fit"),Re=new pn(null,0,k&&(U||!l.hasIconData()||I.get("icon-optional")),U&&(k||!l.hasTextData()||I.get("text-optional")),!0);!l.collisionArrays&&E&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(E);const Be=(je,oe,Pe)=>{for(let Xe=0;Xe<oe/4;Xe++)je.opacityVertexArray.emplaceBack(Pe)};let Ne=0;for(let je=0;je<l.symbolInstances.length;je++){const oe=l.symbolInstances.get(je),{numHorizontalGlyphVertices:Pe,numVerticalGlyphVertices:Xe,crossTileID:He,numIconVertices:gt}=oe,mt=g.has(He);let it=this.opacities[He];mt?it=O:it||(it=Re,this.opacities[He]=it),g.add(He);const St=Pe>0||Xe>0,Et=gt>0,Tt=this.placedOrientations[He],mn=Tt===p.WritingMode.vertical,Rt=Tt===p.WritingMode.horizontal||Tt===p.WritingMode.horizontalOnly;if(!St&&!Et||it.isHidden()||Ne++,St){const Kt=vs(it.text);Be(l.text,Pe,mn?ss:Kt),Be(l.text,Xe,Rt?ss:Kt);const Nt=it.text.isHidden(),{leftJustifiedTextSymbolIndex:dn,centerJustifiedTextSymbolIndex:kt,rightJustifiedTextSymbolIndex:Jt,verticalPlacedTextSymbolIndex:un}=oe,on=l.text.placedSymbolArray,vn=Nt||mn?1:0;dn>=0&&(on.get(dn).hidden=vn),kt>=0&&(on.get(kt).hidden=vn),Jt>=0&&(on.get(Jt).hidden=vn),un>=0&&(on.get(un).hidden=Nt||Rt?1:0);const nr=this.variableOffsets[He];nr&&this.markUsedJustification(l,nr.anchor,oe,Tt);const Tr=this.placedOrientations[He];Tr&&(this.markUsedJustification(l,"left",oe,Tr),this.markUsedOrientation(l,Tr,oe))}if(Et){const Kt=vs(it.icon),{placedIconSymbolIndex:Nt,verticalPlacedIconSymbolIndex:dn}=oe,kt=l.icon.placedSymbolArray,Jt=it.icon.isHidden()?1:0;Nt>=0&&(Be(l.icon,gt,mn?ss:Kt),kt.get(Nt).hidden=Jt),dn>=0&&(Be(l.icon,oe.numVerticalIconVertices,Rt?ss:Kt),kt.get(dn).hidden=Jt)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const Kt=l.collisionArrays[je];if(Kt){let Nt=new p.Point(0,0),dn=!0;if(Kt.textBox||Kt.verticalTextBox){if(q){const Jt=this.variableOffsets[He];Jt?(Nt=Yn(Jt.anchor,Jt.width,Jt.height,Jt.textOffset,Jt.textScale),$&&Nt._rotate(te?this.transform.angle:-this.transform.angle)):dn=!1}A&&(dn=!it.clipped),Kt.textBox&&Mo(l.textCollisionBox.collisionVertexArray,it.text.placed,!dn||mn,Nt.x,Nt.y),Kt.verticalTextBox&&Mo(l.textCollisionBox.collisionVertexArray,it.text.placed,!dn||Rt,Nt.x,Nt.y)}const kt=dn&&!(Rt||!Kt.verticalIconBox);Kt.iconBox&&Mo(l.iconCollisionBox.collisionVertexArray,it.icon.placed,kt,Ee?Nt.x:0,Ee?Nt.y:0),Kt.verticalIconBox&&Mo(l.iconCollisionBox.collisionVertexArray,it.icon.placed,!kt,Ee?Nt.x:0,Ee?Nt.y:0)}}}if(l.fullyClipped=0===Ne,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const je=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=je.invProjMatrix,l.placementViewportMatrix=je.viewportMatrix,l.collisionCircleArray=je.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return 0===this.fadeDuration?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,g){const E=this.zoomAtLastRecencyCheck===g?1-this.zoomAdjustment(g):1;return this.zoomAtLastRecencyCheck=g,this.commitTime+this.fadeDuration*E>l}setStale(){this.stale=!0}}function Mo(v,l,g,E,I){v.emplaceBack(l?1:0,g?1:0,E||0,I||0),v.emplaceBack(l?1:0,g?1:0,E||0,I||0),v.emplaceBack(l?1:0,g?1:0,E||0,I||0),v.emplaceBack(l?1:0,g?1:0,E||0,I||0)}const tu=Math.pow(2,25),Qo=Math.pow(2,24),yo=Math.pow(2,17),th=Math.pow(2,16),es=Math.pow(2,9),Kr=Math.pow(2,8),mu=Math.pow(2,1);function vs(v){if(0===v.opacity&&!v.placed)return 0;if(1===v.opacity&&v.placed)return 4294967295;const l=v.placed?1:0,g=Math.floor(127*v.opacity);return g*tu+l*Qo+g*yo+l*th+g*es+l*Kr+g*mu+l}const ss=0;class Il{constructor(l){this._sortAcrossTiles="viewport-y"!==l.layout.get("symbol-z-order")&&void 0!==l.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,g,E,I,A){const O=this._bucketParts;for(;this._currentTileIndex<l.length;)if(g.getBucketParts(O,I,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,A())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,O.sort((k,U)=>k.sortKey-U.sortKey));this._currentPartIndex<O.length;){const k=O[this._currentPartIndex];if(g.placeLayerBucketPart(k,this._seenCrossTileIDs,E,0===k.symbolInstanceStart),this._currentPartIndex++,A())return!0}return!1}}class Do{constructor(l,g,E,I,A,O,k,U){this.placement=new fi(l,A,O,k,U),this._currentPlacementIndex=g.length-1,this._forceFullPlacement=E,this._showCollisionBoxes=I,this._done=!1}isDone(){return this._done}continuePlacement(l,g,E){const I=p.exported.now(),A=()=>{const O=p.exported.now()-I;return!this._forceFullPlacement&&O>2};for(;this._currentPlacementIndex>=0;){const O=g[l[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if("symbol"===O.type&&(!O.minzoom||O.minzoom<=k)&&(!O.maxzoom||O.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new Il(O)),this._inProgressLayer.continuePlacement(E[O.source],this.placement,this._showCollisionBoxes,O,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const xs=512/p.EXTENT/2;class Is{constructor(l,g,E){this.tileID=l,this.bucketInstanceId=E,this.index=new p.KDBush(g.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const I=l.canonical.x*p.EXTENT,A=l.canonical.y*p.EXTENT;for(let O=0;O<g.length;O++){const{key:k,crossTileID:U,tileAnchorX:q,tileAnchorY:$}=g.get(O),te=Math.floor((I+q)*xs),Ee=Math.floor((A+$)*xs);this.index.add(te,Ee),this.keys.push(k),this.crossTileIDs.push(U)}this.index.finish()}findMatches(l,g,E){const I=this.tileID.canonical.z<g.canonical.z?1:Math.pow(2,this.tileID.canonical.z-g.canonical.z),A=xs/Math.pow(2,g.canonical.z-this.tileID.canonical.z),O=g.canonical.x*p.EXTENT,k=g.canonical.y*p.EXTENT;for(let U=0;U<l.length;U++){const q=l.get(U);if(q.crossTileID)continue;const{key:$,tileAnchorX:te,tileAnchorY:Ee}=q,Re=Math.floor((O+te)*A),Be=Math.floor((k+Ee)*A),Ne=this.index.range(Re-I,Be-I,Re+I,Be+I);for(const je of Ne){const oe=this.crossTileIDs[je];if(this.keys[je]===$&&!E.has(oe)){E.add(oe),q.crossTileID=oe;break}}}}}class ja{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class $u{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const g=Math.round((l-this.lng)/360);if(0!==g)for(const E in this.indexes){const I=this.indexes[E],A={};for(const O in I){const k=I[O];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+g),A[k.tileID.key]=k}this.indexes[E]=A}this.lng=l}addBucket(l,g,E){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===g.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let A=0;A<g.symbolInstances.length;A++)g.symbolInstances.get(A).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const I=this.usedCrossTileIDs[l.overscaledZ];for(const A in this.indexes){const O=this.indexes[A];if(Number(A)>l.overscaledZ)for(const k in O){const U=O[k];U.tileID.isChildOf(l)&&U.findMatches(g.symbolInstances,l,I)}else{const k=O[l.scaledTo(Number(A)).key];k&&k.findMatches(g.symbolInstances,l,I)}}for(let A=0;A<g.symbolInstances.length;A++){const O=g.symbolInstances.get(A);O.crossTileID||(O.crossTileID=E.generate(),I.add(O.crossTileID))}return void 0===this.indexes[l.overscaledZ]&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Is(l,g.symbolInstances,g.bucketInstanceId),!0}removeBucketCrossTileIDs(l,g){for(const E of g.crossTileIDs)this.usedCrossTileIDs[l].delete(E)}removeStaleBuckets(l){let g=!1;for(const E in this.indexes){const I=this.indexes[E];for(const A in I)l[I[A].bucketInstanceId]||(this.removeBucketCrossTileIDs(E,I[A]),delete I[A],g=!0)}return g}}class Ao{constructor(){this.layerIndexes={},this.crossTileIDs=new ja,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,g,E,I){let A=this.layerIndexes[l.id];void 0===A&&(A=this.layerIndexes[l.id]=new $u);let O=!1;const k={};"globe"!==I.name&&A.handleWrapJump(E);for(const U of g){const q=U.getBucket(l);q&&l.id===q.layerIds[0]&&(q.bucketInstanceId||(q.bucketInstanceId=++this.maxBucketInstanceId),A.addBucket(U.tileID,q,this.crossTileIDs)&&(O=!0),k[q.bucketInstanceId]=!0)}return A.removeStaleBuckets(k)&&(O=!0),O}pruneUnusedLayers(l){const g={};l.forEach(E=>{g[E]=!0});for(const E in this.layerIndexes)g[E]||delete this.layerIndexes[E]}}const Jr=(v,l)=>p.emitValidationErrors(v,l&&l.filter(g=>"source.canvas"!==g.identifier)),ts=p.pick(mr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),np=p.pick(mr,["setCenter","setZoom","setBearing","setPitch"]),nu={version:8,layers:[],sources:{}},Vn={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class _o extends p.Evented{constructor(l,g={}){super(),this.map=l,this.dispatcher=new Fe(du(),this),this.imageManager=new Q,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(l._requestManager,g.localFontFamily?p.LocalGlyphMode.all:g.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,g.localFontFamily||g.localIdeographFontFamily),this.crossTileSymbolIndex=new Ao,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const E=this;this._rtlTextPluginCallback=_o.registerForPluginStateChange(I=>{E.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:I.pluginStatus,pluginURL:I.pluginURL},(A,O)=>{if(p.triggerPluginCompletionEvent(A),O&&O.every(k=>k))for(const k in E._sourceCaches){const U=E._sourceCaches[k],q=U.getSource().type;"vector"!==q&&"geojson"!==q||U.reload()}})}),this.on("data",I=>{if("source"!==I.dataType||"metadata"!==I.sourceDataType)return;const A=this.getSource(I.sourceId);if(A&&A.vectorLayerIds)for(const O in this._layers){const k=this._layers[O];k.source===A.id&&this._validateLayer(k)}})}loadURL(l,g={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const E="boolean"==typeof g.validate?g.validate:!p.isMapboxURL(l);l=this.map._requestManager.normalizeStyleURL(l,g.accessToken);const I=this.map._requestManager.transformRequest(l,p.ResourceType.Style);this._request=p.getJSON(I,(A,O)=>{this._request=null,A?this.fire(new p.ErrorEvent(A)):O&&this._load(O,E)})}loadJSON(l,g={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(l,!1!==g.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(nu,!1)}_updateLayerCount(l,g){const E=g?1:-1;l.is3D()&&(this._num3DLayers+=E),"circle"===l.type&&(this._numCircleLayers+=E),"symbol"===l.type&&(this._numSymbolLayers+=E)}_load(l,g){if(g&&Jr(this,p.validateStyle(l)))return;this._loaded=!0,this.stylesheet=p.clone$1(l),this._updateMapProjection();for(const I in l.sources)this.addSource(I,l.sources[I],{validate:!1});this._changed=!1,l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(l.glyphs);const E=el(this.stylesheet.layers);this._order=E.map(I=>I.id),this._layers={},this._serializedLayers={};for(const I of E){const A=p.createStyleLayer(I);A.setEventedParent(this,{layer:{id:A.id}}),this._layers[A.id]=A,this._serializedLayers[A.id]=A.serialize(),this._updateLayerCount(A,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ue(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(l){this._spriteRequest=function(g,E,I){let A,O,k;const U=p.exported.devicePixelRatio>1?"@2x":"";let q=p.getJSON(E.transformRequest(E.normalizeSpriteURL(g,U,".json"),p.ResourceType.SpriteJSON),(Ee,Re)=>{q=null,k||(k=Ee,A=Re,te())}),$=p.getImage(E.transformRequest(E.normalizeSpriteURL(g,U,".png"),p.ResourceType.SpriteImage),(Ee,Re)=>{$=null,k||(k=Ee,O=Re,te())});function te(){if(k)I(k);else if(A&&O){const Ee=p.exported.getImageData(O),Re={};for(const Be in A){const{width:Ne,height:je,x:oe,y:Pe,sdf:Xe,pixelRatio:He,stretchX:gt,stretchY:mt,content:it}=A[Be],St=new p.RGBAImage({width:Ne,height:je});p.RGBAImage.copy(Ee,St,{x:oe,y:Pe},{x:0,y:0},{width:Ne,height:je}),Re[Be]={data:St,pixelRatio:He,sdf:Xe,stretchX:gt,stretchY:mt,content:it}}I(null,Re)}}return{cancel(){q&&(q.cancel(),q=null),$&&($.cancel(),$=null)}}}(l,this.map._requestManager,(g,E)=>{if(this._spriteRequest=null,g)this.fire(new p.ErrorEvent(g));else if(E)for(const I in E)this.imageManager.addImage(I,E[I]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(l){const g=this.getSource(l.source);if(!g)return;const E=l.sourceLayer;E&&("geojson"===g.type||g.vectorLayerIds&&-1===g.vectorLayerIds.indexOf(E))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${E}" does not exist on source "${g.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(l){const g=[];for(const E of l){const I=this._layers[E];"custom"!==I.type&&g.push(I.serialize())}return g}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(l){return!!this.terrain&&("function"==typeof l.isLayerDraped?l.isLayerDraped():Vn[l.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(l){if(!this._loaded)return;const g=this._changed;if(this._changed){const I=Object.keys(this._updatedLayers),A=Object.keys(this._removedLayers);(I.length||A.length)&&this._updateWorkerLayers(I,A);for(const O in this._updatedSources){const k=this._updatedSources[O];"reload"===k?this._reloadSource(O):"clear"===k&&this._clearSource(O)}this._updateTilesForChangedImages();for(const O in this._updatedPaintProps)this._layers[O].updateTransitions(l);this.light.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._resetUpdates()}const E={};for(const I in this._sourceCaches){const A=this._sourceCaches[I];E[I]=A.used,A.used=!1}for(const I of this._order){const A=this._layers[I];if(A.recalculate(l,this._availableImages),!A.isHidden(l.zoom)){const k=this._getLayerSourceCache(A);k&&(k.used=!0)}const O=this.map.painter;if(O){const k=A.getProgramIds();if(!k)continue;const U=A.getProgramConfiguration(l.zoom);for(const q of k)O.useProgram(q,U)}}for(const I in E){const A=this._sourceCaches[I];E[I]!==A.used&&A.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const g in this._sourceCaches)this._sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateWorkerLayers(l,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(l),removedIds:g})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(l){if(this._checkLoaded(),Jr(this,p.validateStyle(l)))return!1;(l=p.clone$1(l)).layers=el(l.layers);const g=function(I,A){if(!I)return[{command:mr.setStyle,args:[A]}];let O=[];try{if(!H(I.version,A.version))return[{command:mr.setStyle,args:[A]}];H(I.center,A.center)||O.push({command:mr.setCenter,args:[A.center]}),H(I.zoom,A.zoom)||O.push({command:mr.setZoom,args:[A.zoom]}),H(I.bearing,A.bearing)||O.push({command:mr.setBearing,args:[A.bearing]}),H(I.pitch,A.pitch)||O.push({command:mr.setPitch,args:[A.pitch]}),H(I.sprite,A.sprite)||O.push({command:mr.setSprite,args:[A.sprite]}),H(I.glyphs,A.glyphs)||O.push({command:mr.setGlyphs,args:[A.glyphs]}),H(I.transition,A.transition)||O.push({command:mr.setTransition,args:[A.transition]}),H(I.light,A.light)||O.push({command:mr.setLight,args:[A.light]}),H(I.fog,A.fog)||O.push({command:mr.setFog,args:[A.fog]}),H(I.projection,A.projection)||O.push({command:mr.setProjection,args:[A.projection]});const k={},U=[];!function(te,Ee,Re,Be){let Ne;for(Ne in Ee=Ee||{},te=te||{})te.hasOwnProperty(Ne)&&(Ee.hasOwnProperty(Ne)||mo(Ne,Re,Be));for(Ne in Ee){if(!Ee.hasOwnProperty(Ne))continue;const je=Ee[Ne];te.hasOwnProperty(Ne)?H(te[Ne],je)||("geojson"===te[Ne].type&&"geojson"===je.type&&tl(te,Ee,Ne)?Re.push({command:mr.setGeoJSONSourceData,args:[Ne,je.data]}):To(Ne,Ee,Re,Be)):Lh(Ne,Ee,Re)}}(I.sources,A.sources,U,k);const q=[];I.layers&&I.layers.forEach(te=>{te.source&&k[te.source]?O.push({command:mr.removeLayer,args:[te.id]}):q.push(te)});let $=I.terrain;$&&k[$.source]&&(O.push({command:mr.setTerrain,args:[void 0]}),$=void 0),O=O.concat(U),H($,A.terrain)||O.push({command:mr.setTerrain,args:[A.terrain]}),function(te,Ee,Re){Ee=Ee||[];const Be=(te=te||[]).map(Ss),Ne=Ee.map(Ss),je=te.reduce(Jo,{}),oe=Ee.reduce(Jo,{}),Pe=Be.slice(),Xe=Object.create(null);let He,gt,mt,it,St,Et,Tt;for(He=0,gt=0;He<Be.length;He++)mt=Be[He],oe.hasOwnProperty(mt)?gt++:(Re.push({command:mr.removeLayer,args:[mt]}),Pe.splice(Pe.indexOf(mt,gt),1));for(He=0,gt=0;He<Ne.length;He++)mt=Ne[Ne.length-1-He],Pe[Pe.length-1-He]!==mt&&(je.hasOwnProperty(mt)?(Re.push({command:mr.removeLayer,args:[mt]}),Pe.splice(Pe.lastIndexOf(mt,Pe.length-gt),1)):gt++,Et=Pe[Pe.length-He],Re.push({command:mr.addLayer,args:[oe[mt],Et]}),Pe.splice(Pe.length-He,0,mt),Xe[mt]=!0);for(He=0;He<Ne.length;He++)if(mt=Ne[He],it=je[mt],St=oe[mt],!Xe[mt]&&!H(it,St))if(H(it.source,St.source)&&H(it["source-layer"],St["source-layer"])&&H(it.type,St.type)){for(Tt in Ko(it.layout,St.layout,Re,mt,null,mr.setLayoutProperty),Ko(it.paint,St.paint,Re,mt,null,mr.setPaintProperty),H(it.filter,St.filter)||Re.push({command:mr.setFilter,args:[mt,St.filter]}),H(it.minzoom,St.minzoom)&&H(it.maxzoom,St.maxzoom)||Re.push({command:mr.setLayerZoomRange,args:[mt,St.minzoom,St.maxzoom]}),it)it.hasOwnProperty(Tt)&&"layout"!==Tt&&"paint"!==Tt&&"filter"!==Tt&&"metadata"!==Tt&&"minzoom"!==Tt&&"maxzoom"!==Tt&&(0===Tt.indexOf("paint.")?Ko(it[Tt],St[Tt],Re,mt,Tt.slice(6),mr.setPaintProperty):H(it[Tt],St[Tt])||Re.push({command:mr.setLayerProperty,args:[mt,Tt,St[Tt]]}));for(Tt in St)St.hasOwnProperty(Tt)&&!it.hasOwnProperty(Tt)&&"layout"!==Tt&&"paint"!==Tt&&"filter"!==Tt&&"metadata"!==Tt&&"minzoom"!==Tt&&"maxzoom"!==Tt&&(0===Tt.indexOf("paint.")?Ko(it[Tt],St[Tt],Re,mt,Tt.slice(6),mr.setPaintProperty):H(it[Tt],St[Tt])||Re.push({command:mr.setLayerProperty,args:[mt,Tt,St[Tt]]}))}else Re.push({command:mr.removeLayer,args:[mt]}),Et=Pe[Pe.lastIndexOf(mt)+1],Re.push({command:mr.addLayer,args:[St,Et]})}(q,A.layers,O)}catch(k){console.warn("Unable to compute style diff:",k),O=[{command:mr.setStyle,args:[A]}]}return O}(this.serialize(),l).filter(I=>!(I.command in np));if(0===g.length)return!1;const E=g.filter(I=>!(I.command in ts));if(E.length>0)throw new Error(`Unimplemented: ${E.map(I=>I.command).join(", ")}.`);return g.forEach(I=>{"setTransition"!==I.command&&"setProjection"!==I.command&&this[I.command].apply(this,I.args)}),this.stylesheet=l,this._updateMapProjection(),!0}addImage(l,g){return this.getImage(l)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,g),this._afterImageUpdated(l),this)}updateImage(l,g){this.imageManager.updateImage(l,g)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l),this._afterImageUpdated(l),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(l,g,E={}){if(this._checkLoaded(),void 0!==this.getSource(l))throw new Error("There is already a source with this ID");if(!g.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(g).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(p.validateSource,`sources.${l}`,g,null,E))return;this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);const I=ir(l,g,this.dispatcher,this);I.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(l),source:I.serialize(),sourceId:l}));const A=O=>{const k=(O?"symbol:":"other:")+l,U=this._sourceCaches[k]=new p.SourceCache(k,I,O);(O?this._symbolSourceCaches:this._otherSourceCaches)[l]=U,U.style=this,U.onAdd(this.map)};A(!1),"vector"!==g.type&&"geojson"!==g.type||A(!0),I.onAdd&&I.onAdd(this.map),this._changed=!0}removeSource(l){this._checkLoaded();const g=this.getSource(l);if(!g)throw new Error("There is no source with this ID");for(const I in this._layers)if(this._layers[I].source===l)return this.fire(new p.ErrorEvent(new Error(`Source "${l}" cannot be removed while layer "${I}" is using it.`)));if(this.terrain&&this.terrain.get().source===l)return this.fire(new p.ErrorEvent(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const E=this._getSourceCaches(l);for(const I of E)delete this._sourceCaches[I.id],delete this._updatedSources[I.id],I.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:I.getSource().id})),I.setEventedParent(null),I.clearTiles();return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],g.setEventedParent(null),g.onRemove&&g.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(l,g){this._checkLoaded(),this.getSource(l).setData(g),this._changed=!0}getSource(l){const g=this._getSourceCache(l);return g&&g.getSource()}_getSources(){const l=[];for(const g in this._otherSourceCaches){const E=this._getSourceCache(g);E&&l.push(E.getSource())}return l}addLayer(l,g,E={}){this._checkLoaded();const I=l.id;if(this.getLayer(I))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${I}" already exists on this map`)));let A;if("custom"===l.type){if(Jr(this,p.validateCustomStyleLayer(l)))return;A=p.createStyleLayer(l)}else{if("object"==typeof l.source&&(this.addSource(I,l.source),l=p.clone$1(l),l=p.extend(l,{source:I})),this._validate(p.validateLayer,`layers.${I}`,l,{arrayIndex:-1},E))return;A=p.createStyleLayer(l),this._validateLayer(A),A.setEventedParent(this,{layer:{id:I}}),this._serializedLayers[A.id]=A.serialize(),this._updateLayerCount(A,!0)}const O=g?this._order.indexOf(g):this._order.length;if(g&&-1===O)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${g}" does not exist on this map.`)));this._order.splice(O,0,I),this._layerOrderChanged=!0,this._layers[I]=A;const k=this._getLayerSourceCache(A);if(this._removedLayers[I]&&A.source&&k&&"custom"!==A.type){const U=this._removedLayers[I];delete this._removedLayers[I],U.type!==A.type?this._updatedSources[A.source]="clear":(this._updatedSources[A.source]="reload",k.pause())}this._updateLayer(A),A.onAdd&&A.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(l,g){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===g)return;const E=this._order.indexOf(l);this._order.splice(E,1);const I=g?this._order.indexOf(g):this._order.length;g&&-1===I?this.fire(new p.ErrorEvent(new Error(`Layer with id "${g}" does not exist on this map.`))):(this._order.splice(I,0,l),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(l){this._checkLoaded();const g=this._layers[l];if(!g)return void this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be removed.`)));g.setEventedParent(null),this._updateLayerCount(g,!1);const E=this._order.indexOf(l);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=g,delete this._layers[l],delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],g.onRemove&&g.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(l){return this._layers[l]}hasLayer(l){return l in this._layers}hasLayerType(l){for(const g in this._layers)if(this._layers[g].type===l)return!0;return!1}setLayerZoomRange(l,g,E){this._checkLoaded();const I=this.getLayer(l);I?I.minzoom===g&&I.maxzoom===E||(null!=g&&(I.minzoom=g),null!=E&&(I.maxzoom=E),this._updateLayer(I)):this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(l,g,E={}){this._checkLoaded();const I=this.getLayer(l);if(I){if(!H(I.filter,g))return null==g?(I.filter=void 0,void this._updateLayer(I)):void(this._validate(p.validateFilter,`layers.${I.id}.filter`,g,{layerType:I.type},E)||(I.filter=p.clone$1(g),this._updateLayer(I)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be filtered.`)))}getFilter(l){const g=this.getLayer(l);return g&&p.clone$1(g.filter)}setLayoutProperty(l,g,E,I={}){this._checkLoaded();const A=this.getLayer(l);A?H(A.getLayoutProperty(g),E)||(A.setLayoutProperty(g,E,I),this._updateLayer(A)):this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(l,g){const E=this.getLayer(l);if(E)return E.getLayoutProperty(g);this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style.`)))}setPaintProperty(l,g,E,I={}){this._checkLoaded();const A=this.getLayer(l);A?H(A.getPaintProperty(g),E)||(A.setPaintProperty(g,E,I)&&this._updateLayer(A),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(l,g){const E=this.getLayer(l);return E&&E.getPaintProperty(g)}setFeatureState(l,g){this._checkLoaded();const E=l.source,I=l.sourceLayer,A=this.getSource(E);if(!A)return void this.fire(new p.ErrorEvent(new Error(`The source '${E}' does not exist in the map's style.`)));const O=A.type;if("geojson"===O&&I)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===O&&!I)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===l.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const k=this._getSourceCaches(E);for(const U of k)U.setFeatureState(I,l.id,g)}removeFeatureState(l,g){this._checkLoaded();const E=l.source,I=this.getSource(E);if(!I)return void this.fire(new p.ErrorEvent(new Error(`The source '${E}' does not exist in the map's style.`)));const A=I.type,O="vector"===A?l.sourceLayer:void 0;if("vector"===A&&!O)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(g&&"string"!=typeof l.id&&"number"!=typeof l.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const k=this._getSourceCaches(E);for(const U of k)U.removeFeatureState(O,l.id,g)}getFeatureState(l){this._checkLoaded();const g=l.source,E=l.sourceLayer,I=this.getSource(g);if(I){if("vector"!==I.type||E)return void 0===l.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(g)[0].getFeatureState(E,l.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const l={};for(const g in this._sourceCaches){const E=this._sourceCaches[g].getSource();l[E.id]||(l[E.id]=E.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:l,layers:this._serializeLayers(this._order)},g=>void 0!==g)}_updateLayer(l){this._updatedLayers[l.id]=!0;const g=this._getLayerSourceCache(l);l.source&&!this._updatedSources[l.source]&&g&&"raster"!==g.getSource().type&&(this._updatedSources[l.source]="reload",g.pause()),this._changed=!0,l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const g=O=>"fill-extrusion"===this._layers[O].type,E={},I=[];for(let O=this._order.length-1;O>=0;O--){const k=this._order[O];if(g(k)){E[k]=O;for(const U of l){const q=U[k];if(q)for(const $ of q)I.push($)}}}I.sort((O,k)=>k.intersectionZ-O.intersectionZ);const A=[];for(let O=this._order.length-1;O>=0;O--){const k=this._order[O];if(g(k))for(let U=I.length-1;U>=0;U--){const q=I[U].feature;if(E[q.layer.id]<O)break;A.push(q),I.pop()}else for(const U of l){const q=U[k];if(q)for(const $ of q)A.push($.feature)}}return A}queryRenderedFeatures(l,g,E){g&&g.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",g.filter,null,g);const I={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const U of g.layers){const q=this._layers[U];if(!q)return this.fire(new p.ErrorEvent(new Error(`The layer '${U}' does not exist in the map's style and cannot be queried for features.`))),[];I[q.source]=!0}}const A=[];g.availableImages=this._availableImages;const O=g&&g.layers?g.layers.some(U=>{const q=this.getLayer(U);return q&&q.is3D()}):this.has3DLayers(),k=vt.createFromScreenPoints(l,E);for(const U in this._sourceCaches){const q=this._sourceCaches[U].getSource().id;g.layers&&!I[q]||A.push(So(this._sourceCaches[U],this._layers,this._serializedLayers,k,g,E,O,!!this.map._showQueryGeometry))}return this.placement&&A.push(function(U,q,$,te,Ee,Re,Be){const Ne={},je=Re.queryRenderedSymbols(te),oe=[];for(const Pe of Object.keys(je).map(Number))oe.push(Be[Pe]);oe.sort(Er);for(const Pe of oe){const Xe=Pe.featureIndex.lookupSymbolFeatures(je[Pe.bucketInstanceId],q,Pe.bucketIndex,Pe.sourceLayerIndex,Ee.filter,Ee.layers,Ee.availableImages,U);for(const He in Xe){const gt=Ne[He]=Ne[He]||[],mt=Xe[He];mt.sort((it,St)=>{const Et=Pe.featureSortOrder;if(Et){const Tt=Et.indexOf(it.featureIndex);return Et.indexOf(St.featureIndex)-Tt}return St.featureIndex-it.featureIndex});for(const it of mt)gt.push(it)}}for(const Pe in Ne)Ne[Pe].forEach(Xe=>{const He=Xe.feature,gt=$(U[Pe]);if(!gt)return;const mt=gt.getFeatureState(He.layer["source-layer"],He.id);He.source=He.layer.source,He.layer["source-layer"]&&(He.sourceLayer=He.layer["source-layer"]),He.state=mt});return Ne}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),k.screenGeometry,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(A)}querySourceFeatures(l,g){g&&g.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",g.filter,null,g);const E=this._getSourceCaches(l);let I=[];for(const A of E)I=I.concat(Io(A,g));return I}addSourceType(l,g,E){return _o.getSourceType(l)?E(new Error(`A source type called "${l}" already exists.`)):(_o.setSourceType(l,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:g.workerSourceURL},E):E(null,null))}getLight(){return this.light.getLight()}setLight(l,g={}){this._checkLoaded();const E=this.light.getLight();let I=!1;for(const O in l)if(!H(l[O],E[O])){I=!0;break}if(!I)return;const A=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(l,g),this.light.updateTransitions(A)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(l,g=1){if(this._checkLoaded(),!l)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let E=l;if(1===g){if("object"==typeof E.source){const I="terrain-dem-src";this.addSource(I,E.source),E=p.clone$1(E),E=p.extend(E,{source:I})}if(this._validate(p.validateTerrain,"terrain",E))return}if(!this.terrain||this.terrain&&g!==this.terrain.drapeRenderMode){if(!E)return;this._createTerrain(E,g)}else{const I=this.terrain,A=I.get();for(const O of Object.keys(p.spec.terrain))!E.hasOwnProperty(O)&&p.spec.terrain[O].default&&(E[O]=p.spec.terrain[O].default);for(const O in E)if(!H(E[O],A[O])){I.set(E),this.stylesheet.terrain=E;const k=this._setTransitionParameters({duration:0});I.updateTransitions(k);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const g=this.fog=new pt(l,this.map.transform);this.stylesheet.fog=l;const E=this._setTransitionParameters({duration:0});g.updateTransitions(E)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const g=this.fog,E=g.get();0===Object.keys(l).length&&g.set(l);for(const I in l)if(!H(l[I],E[I])){g.set(l),this.stylesheet.fog=l;const A=this._setTransitionParameters({duration:0});g.updateTransitions(A);break}}else this._createFog(l);this._markersNeedUpdate=!0}_setTransitionParameters(l){return{now:p.exported.now(),transition:p.extend(l,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const l=this._order.filter(E=>this.isLayerDraped(this._layers[E])),g=this._order.filter(E=>!this.isLayerDraped(this._layers[E]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...g)}_createTerrain(l,g){const E=this.terrain=new Ae(l,g);this.stylesheet.terrain=l,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const I=this._setTransitionParameters({duration:0});E.updateTransitions(I)}_force3DLayerUpdate(){for(const l in this._layers){const g=this._layers[l];"fill-extrusion"===g.type&&this._updateLayer(g)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const g=this._layers[l];"symbol"===g.type&&this._updateLayer(g)}}_validate(l,g,E,I,A={}){return(!A||!1!==A.validate)&&Jr(this,l.call(p.validateStyle,p.extend({key:g,style:this.serialize(),value:E,styleSpec:p.spec},I)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this._sourceCaches)this._sourceCaches[l].clearTiles(),this._sourceCaches[l].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(l){const g=this._getSourceCaches(l);for(const E of g)E.clearTiles()}_reloadSource(l){const g=this._getSourceCaches(l);for(const E of g)E.resume(),E.reload()}_reloadSources(){for(const l of this._getSources())l.reload&&l.reload()}_updateSources(l){for(const g in this._sourceCaches)this._sourceCaches[g].update(l)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const g=this._sourceCaches[l];g.resume(),g.reload()}}_updatePlacement(l,g,E,I,A=!1){let O=!1,k=!1;const U={};for(const q of this._order){const $=this._layers[q];if("symbol"!==$.type)continue;if(!U[$.source]){const Ee=this._getLayerSourceCache($);if(!Ee)continue;U[$.source]=Ee.getRenderableIds(!0).map(Re=>Ee.getTileByID(Re)).sort((Re,Be)=>Be.tileID.overscaledZ-Re.tileID.overscaledZ||(Re.tileID.isLessThan(Be.tileID)?-1:1))}const te=this.crossTileSymbolIndex.addLayer($,U[$.source],l.center.lng,l.projection);O=O||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),A=A||this._layerOrderChanged||0===E,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(A||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),l.zoom))&&(this.pauseablePlacement=new Do(l,this._order,A,g,E,I,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,U),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),k=!0),O&&this.pauseablePlacement.placement.setStale()),k||O)for(const q of this._order){const $=this._layers[q];"symbol"===$.type&&this.placement.updateLayerOpacities($,U[$.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,g,E){this.imageManager.getImages(g.icons,E),this._updateTilesForChangedImages();const I=A=>{A&&A.setDependencies(g.tileID.key,g.type,g.icons)};I(this._otherSourceCaches[g.source]),I(this._symbolSourceCaches[g.source])}getGlyphs(l,g,E){this.glyphManager.getGlyphs(g.stacks,E)}getResource(l,g,E){return p.makeRequest(g,E)}_getSourceCache(l){return this._otherSourceCaches[l]}_getLayerSourceCache(l){return"symbol"===l.type?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}_getSourceCaches(l){const g=[];return this._otherSourceCaches[l]&&g.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&g.push(this._symbolSourceCaches[l]),g}_isSourceCacheLoaded(l){const g=this._getSourceCaches(l);return 0===g.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${l}'`))),!1):g.every(E=>E.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}_o.getSourceType=function(v){return Lr[v]},_o.setSourceType=function(v,l){Lr[v]=l},_o.registerForPluginStateChange=p.registerForPluginStateChange;var yu="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",rl="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ru="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",cc="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",il="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Ts={},ya={};const as=[];Hn(yu,as),Hn(ru,as),Hn(cc,as),Hn(il,as),Ts=kr("",ru),ya=kr(il,cc);const Tl=kr("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),iu=yu,pr="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var vo={background:kr("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:kr("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:kr("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:kr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:kr("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:kr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:kr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:kr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:kr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:kr("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:kr("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:kr("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:kr("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:kr("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:kr("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:kr("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:kr("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:kr("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:kr("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:kr("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:kr("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:kr("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:kr("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:kr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:kr("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:kr("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",rl),skyboxGradient:kr("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",rl),skyboxCapture:kr("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:kr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:kr("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Hn(v,l){const g=v.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let E of g)if(E=E.trim(),"#"===E[0]&&E.includes("if")&&!E.includes("endif")){E=E.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const I=E.split(" ");for(const A of I)l.includes(A)||l.push(A)}}function kr(v,l){const g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,E=l.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),I={},A=[...as];return Hn(v,A),Hn(l,A),{fragmentSource:v=v.replace(g,(O,k,U,q,$)=>(I[$]=!0,"define"===k?`\n#ifndef HAS_UNIFORM_u_${$}\nvarying ${U} ${q} ${$};\n#else\nuniform ${U} ${q} u_${$};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${$}\n    ${U} ${q} ${$} = u_${$};\n#endif\n`)),vertexSource:l=l.replace(g,(O,k,U,q,$)=>{const te="float"===q?"vec2":"vec4",Ee=$.match(/color/)?"color":te;return I[$]?"define"===k?`\n#ifndef HAS_UNIFORM_u_${$}\nuniform lowp float u_${$}_t;\nattribute ${U} ${te} a_${$};\nvarying ${U} ${q} ${$};\n#else\nuniform ${U} ${q} u_${$};\n#endif\n`:"vec4"===Ee?`\n#ifndef HAS_UNIFORM_u_${$}\n    ${$} = a_${$};\n#else\n    ${U} ${q} ${$} = u_${$};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${$}\n    ${$} = unpack_mix_${Ee}(a_${$}, u_${$}_t);\n#else\n    ${U} ${q} ${$} = u_${$};\n#endif\n`:"define"===k?`\n#ifndef HAS_UNIFORM_u_${$}\nuniform lowp float u_${$}_t;\nattribute ${U} ${te} a_${$};\n#else\nuniform ${U} ${q} u_${$};\n#endif\n`:"vec4"===Ee?`\n#ifndef HAS_UNIFORM_u_${$}\n    ${U} ${q} ${$} = a_${$};\n#else\n    ${U} ${q} ${$} = u_${$};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${$}\n    ${U} ${q} ${$} = unpack_mix_${Ee}(a_${$}, u_${$}_t);\n#else\n    ${U} ${q} ${$} = u_${$};\n#endif\n`}),staticAttributes:E,usedDefines:A}}class Ac{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,g,E,I,A,O,k){this.context=l;let U=this.boundPaintVertexBuffers.length!==I.length;for(let $=0;!U&&$<I.length;$++)this.boundPaintVertexBuffers[$]!==I[$]&&(U=!0);let q=this.boundDynamicVertexBuffers.length!==k.length;for(let $=0;!q&&$<k.length;$++)this.boundDynamicVertexBuffers[$]!==k[$]&&(q=!0);if(!l.extVertexArrayObject||!this.vao||this.boundProgram!==g||this.boundLayoutVertexBuffer!==E||U||q||this.boundIndexBuffer!==A||this.boundVertexOffset!==O)this.freshBind(g,E,I,A,O,k);else{l.bindVertexArrayOES.set(this.vao);for(const $ of k)$&&$.bind();A&&A.dynamicDraw&&A.bind()}}freshBind(l,g,E,I,A,O){let k;const U=l.numAttributes,q=this.context,$=q.gl;if(q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=q.extVertexArrayObject.createVertexArrayOES(),q.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=l,this.boundLayoutVertexBuffer=g,this.boundPaintVertexBuffers=E,this.boundIndexBuffer=I,this.boundVertexOffset=A,this.boundDynamicVertexBuffers=O;else{k=q.currentNumAttributes||0;for(let te=U;te<k;te++)$.disableVertexAttribArray(te)}g.enableAttributes($,l),g.bind(),g.setVertexAttribPointers($,l,A);for(const te of E)te.enableAttributes($,l),te.bind(),te.setVertexAttribPointers($,l,A);for(const te of O)te&&(te.enableAttributes($,l),te.bind(),te.setVertexAttribPointers($,l,A));I&&I.bind(),q.currentNumAttributes=U}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function _a(v,l){const g=Math.pow(2,l.canonical.z),E=l.canonical.y;return[new p.MercatorCoordinate(0,E/g).toLngLat().lat,new p.MercatorCoordinate(0,(E+1)/g).toLngLat().lat]}function di(v,l,g,E,I,A,O){const k=v.context,U=k.gl,q=g.fbo;if(!q)return;v.prepareDrawTile();const $=v.useProgram("hillshade");k.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,q.colorAttachment.get());const te=((Ne,je,oe,Pe)=>{const Xe=oe.paint.get("hillshade-shadow-color"),He=oe.paint.get("hillshade-highlight-color"),gt=oe.paint.get("hillshade-accent-color");let mt=oe.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===oe.paint.get("hillshade-illumination-anchor")&&(mt-=Ne.transform.angle);const it=!Ne.options.moving;return{u_matrix:Pe||Ne.transform.calculateProjMatrix(je.tileID.toUnwrapped(),it),u_image:0,u_latrange:_a(0,je.tileID),u_light:[oe.paint.get("hillshade-exaggeration"),mt],u_shadow:Xe,u_highlight:He,u_accent:gt}})(v,g,E,v.terrain?l.projMatrix:null);v.prepareDrawProgram(k,$,l.toUnwrapped());const{tileBoundsBuffer:Ee,tileBoundsIndexBuffer:Re,tileBoundsSegments:Be}=v.getTileBoundsBuffers(g);$.draw(k,U.TRIANGLES,I,A,O,p.CullFaceMode.disabled,te,E.id,Ee,Re,Be)}function Ml(v,l,g){if(!l.needsDEMTextureUpload)return;const E=v.context,I=E.gl;E.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||v.getTileTexture(g.stride);const A=g.getPixels();l.demTexture?l.demTexture.update(A,{premultiply:!1}):l.demTexture=new p.Texture(E,A,I.RGBA,{premultiply:!1}),l.needsDEMTextureUpload=!1}function nh(v,l,g,E,I,A){const O=v.context,k=O.gl;if(!l.dem)return;const U=l.dem;if(O.activeTexture.set(k.TEXTURE1),Ml(v,l,U),!l.demTexture)return;l.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);const q=U.dim;O.activeTexture.set(k.TEXTURE0);let $=l.fbo;if(!$){const Be=new p.Texture(O,{width:q,height:q,data:null},k.RGBA);Be.bind(k.LINEAR,k.CLAMP_TO_EDGE),$=l.fbo=O.createFramebuffer(q,q,!0),$.colorAttachment.set(Be.texture)}O.bindFramebuffer.set($.framebuffer),O.viewport.set([0,0,q,q]);const{tileBoundsBuffer:te,tileBoundsIndexBuffer:Ee,tileBoundsSegments:Re}=v.getMercatorTileBoundsBuffers();v.useProgram("hillshadePrepare").draw(O,k.TRIANGLES,E,I,A,p.CullFaceMode.disabled,((Be,Ne)=>{const je=Ne.stride,oe=p.create();return p.ortho(oe,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(oe,oe,[0,-p.EXTENT,0]),{u_matrix:oe,u_image:1,u_dimension:[je,je],u_zoom:Be.overscaledZ,u_unpack:Ne.unpackVector}})(l.tileID,U),g.id,te,Ee,Re),l.needsHillshadePrepare=!1}const Oh=v=>({u_matrix:new p.UniformMatrix4f(v),u_image0:new p.Uniform1i(v),u_skirt_height:new p.Uniform1f(v)}),qu=(v,l)=>({u_matrix:v,u_image0:0,u_skirt_height:l}),ri=(v,l,g,E,I,A,O,k,U,q,$,te,Ee,Re,Be)=>({u_proj_matrix:Float32Array.from(v),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(E),u_merc_matrix:g,u_zoom_transition:I,u_merc_center:A,u_image0:0,u_frustum_tl:O,u_frustum_tr:k,u_frustum_br:U,u_frustum_bl:q,u_globe_pos:$,u_globe_radius:te,u_viewport:Ee,u_grid_matrix:Be?Float32Array.from(Be):new Float32Array(9),u_skirt_height:Re});function ia(v,l){return null!=v&&null!=l&&!(!v.hasData()||!l.hasData())&&null!=v.demTexture&&null!=l.demTexture&&v.tileID.key!==l.tileID.key}const Ci=new class{constructor(){this.operations={}}newMorphing(v,l,g,E,I){if(v in this.operations){const A=this.operations[v];A.to.tileID.key!==g.tileID.key&&(A.queued=g)}else this.operations[v]={startTime:E,phase:0,duration:I,from:l,to:g,queued:null}}getMorphValuesForProxy(v){if(!(v in this.operations))return null;const l=this.operations[v];return{from:l.from,to:l.to,phase:l.phase}}update(v){for(const l in this.operations){const g=this.operations[l];for(g.phase=(v-g.startTime)/g.duration;g.phase>=1||!this._validOp(g);)if(!this._nextOp(g,v)){delete this.operations[l];break}}}_nextOp(v,l){return!!v.queued&&(v.from=v.to,v.to=v.queued,v.queued=null,v.phase=0,v.startTime=l,!0)}_validOp(v){return v.from.hasData()&&v.to.hasData()}},Hu={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function oa(v){return 6*Math.pow(1.5,22-v)}function Nh(v,l){const g=1<<v.z;return!l&&(0===v.x||v.x===g-1)||0===v.y||v.y===g-1}const Dr=v=>({u_matrix:v});function Dl(v,l,g,E,I){if(I>0){const A=p.exported.now(),O=(A-v.timeAdded)/I,k=l?(A-l.timeAdded)/I:-1,U=g.getSource(),q=E.coveringZoomLevel({tileSize:U.tileSize,roundZoom:U.roundZoom}),$=!l||Math.abs(l.tileID.overscaledZ-q)>Math.abs(v.tileID.overscaledZ-q),te=$&&v.refreshedUponExpiration?1:p.clamp($?O:1-k,0,1);return v.refreshedUponExpiration&&O>=1&&(v.refreshedUponExpiration=!1),l?{opacity:1,mix:1-te}:{opacity:te,mix:0}}return{opacity:1,mix:0}}class gi extends p.SourceCache{constructor(l){const g={type:"raster-dem",maxzoom:l.transform.maxZoom},E=new Fe(du(),null),I=ir("mock-dem",g,E,l.style);super("mock-dem",I,!1),I.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,g){l.state="loaded",g(null)}}class Zl extends p.SourceCache{constructor(l){const g=ir("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new Fe(du(),null),l.style);super("proxy",g,!1),g.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,g,E){if(l.freezeTileCoverage)return;this.transform=l;const I=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((A,O)=>{if(A[O.key]="",!this._tiles[O.key]){const k=new p.Tile(O,this._source.tileSize*O.overscaleFactor(),l.tileZoom);k.state="loaded",this._tiles[O.key]=k}return A},{});for(const A in this._tiles)A in I||(this.freeFBO(A),this._tiles[A].unloadVectorData(),delete this._tiles[A])}freeFBO(l){const g=this.proxyCachedFBO[l];if(void 0!==g){const E=Object.values(g);this.renderCachePool.push(...E),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Wn extends p.OverscaledTileID{constructor(l,g,E){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=g,this.projMatrix=E}}class ol extends p.Elevation{constructor(l,g){super(),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[E,I,A]=function(U){const q=new p.StructArrayLayout2i4,$=new p.StructArrayLayout3ui6;q.reserve(17161),$.reserve(33800);const Ee=p.EXTENT/128,Re=p.EXTENT+Ee/2,Be=Re+Ee;for(let je=-Ee;je<Be;je+=Ee)for(let oe=-Ee;oe<Be;oe+=Ee){const Pe=oe<0||oe>Re||je<0||je>Re?24575:0,Xe=p.clamp(Math.round(oe),0,p.EXTENT),He=p.clamp(Math.round(je),0,p.EXTENT);q.emplaceBack(Xe+Pe,He)}const Ne=(je,oe)=>{const Pe=131*oe+je;$.emplaceBack(Pe+1,Pe,Pe+131),$.emplaceBack(Pe+131,Pe+131+1,Pe+1)};for(let je=1;je<129;je++)for(let oe=1;oe<129;oe++)Ne(oe,je);return[0,129].forEach(je=>{for(let oe=0;oe<130;oe++)Ne(oe,je),Ne(je,oe)}),[q,$,32768]}(),O=l.context;this.gridBuffer=O.createVertexBuffer(E,p.posAttributes.members),this.gridIndexBuffer=O.createIndexBuffer(I),this.gridSegments=p.SegmentVector.simpleSegment(0,0,E.length,I.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,E.length,A),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Zl(g.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.EXTENT,0,p.EXTENT,0,1);const k=O.gl;this._overlapStencilMode=new p.StencilMode({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=g,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new gi(g.map)}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),l.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=l,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,g,E){if(l&&l.terrain){this._style!==l&&(this.style=l),this.enabled=!0;const I=l.terrain.properties;this.sourceCache=0===l.terrain.drapeRenderMode?this._mockSourceCache:l._getSourceCache(I.get("source")),this._exaggeration=I.get("exaggeration");const A=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const O=this.getScaledDemTileSize();this.sourceCache.update(g,O,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,A(),this._initializing=!0),A(),g.updateElevation(!0,E),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(g),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const l=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==l.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${l.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${l.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(l){l.coord&&"source"===l.dataType?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):"style"===l.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._sourceCaches)this._style._sourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const g=this.proxySourceCache,E=this.painter.transform;this._initializing&&(this._initializing=0===E._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(E.center),-1),this._emptyDEMTextureDirty=!this._initializing);const I=this.proxyCoords=g.getIds().map(U=>{const q=g.getTileByID(U).tileID;return q.projMatrix=E.calculateProjMatrix(q.toUnwrapped()),q});(function(U,q){const $=q.transform.pointCoordinate(q.transform.getCameraPoint()),te=new p.Point($.x,$.y);U.sort((Ee,Re)=>{if(Re.overscaledZ-Ee.overscaledZ)return Re.overscaledZ-Ee.overscaledZ;const Be=new p.Point(Ee.canonical.x+(1<<Ee.canonical.z)*Ee.wrap,Ee.canonical.y),Ne=new p.Point(Re.canonical.x+(1<<Re.canonical.z)*Re.wrap,Re.canonical.y),je=te.mult(1<<Ee.canonical.z);return je.x-=.5,je.y-=.5,je.distSqr(Be)-je.distSqr(Ne)})})(I,this.painter),this._previousZoom=E.zoom;const A=this.proxyToSource||{};this.proxyToSource={},I.forEach(U=>{this.proxyToSource[U.key]={}}),this.terrainTileForTile={};const O=this._style._sourceCaches;for(const U in O){const q=O[U];if(!q.used||(q!==this.sourceCache&&this.resetTileLookupCache(q.id),this._setupProxiedCoordsForOrtho(q,l[U],A),q.usedForTerrain))continue;const $=l[U];q.getSource().reparseOverscaled&&this._assignTerrainTiles($)}this.proxiedCoords[g.id]=I.map(U=>new Wn(U,U.key,this.orthoMatrix)),this._assignTerrainTiles(I),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(A),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const k={};this._visibleDemTiles=[];for(const U of this.proxyCoords){const q=this.terrainTileForTile[U.key];if(!q)continue;const $=q.tileID.key;$ in k||(this._visibleDemTiles.push(q),k[$]=$)}}_assignTerrainTiles(l){this._initializing||l.forEach(g=>{if(this.terrainTileForTile[g.key])return;const E=this._findTileCoveringTileID(g,this.sourceCache);E&&(this.terrainTileForTile[g.key]=E)})}_prepareDEMTextures(){const l=this.painter.context,g=l.gl;for(const E in this.terrainTileForTile){const I=this.terrainTileForTile[E],A=I.dem;!A||I.demTexture&&!I.needsDEMTextureUpload||(l.activeTexture.set(g.TEXTURE1),Ml(this.painter,I,A))}}_prepareDemTileUniforms(l,g,E,I){if(!g||null==g.demTexture)return!1;const A=l.tileID.canonical,O=Math.pow(2,g.tileID.canonical.z-A.z),k=I||"";return E[`u_dem_tl${k}`]=[A.x*O%1,A.y*O%1],E[`u_dem_scale${k}`]=O,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const l=this.painter.context,g=l.gl;if(!this._emptyDepthBufferTexture){const E=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(l,E,g.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let l=0;const g=this._visibleDemTiles.reduce((E,I)=>{if(!I.dem)return E;const A=I.dem.tree.minimums[0];return A>0&&l++,E+A},0);return l?g/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,g=l.gl;l.activeTexture.set(g.TEXTURE2);const E=this._getLoadedAreaMinimum(),I=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(E,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let A=this._emptyDEMTexture;return A?A.update(I,{premultiply:!1}):A=this._emptyDEMTexture=new p.Texture(l,I,g.RGBA,{premultiply:!1}),A}setupElevationDraw(l,g,E){const I=this.painter.context,A=I.gl,O=(k=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(k),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var k;O.u_dem_size=this.sourceCache.getSource().tileSize,O.u_exaggeration=this.exaggeration();let U=null,q=null,$=1;if(E&&E.morphing&&this._useVertexMorphing){const te=E.morphing.srcDemTile,Ee=E.morphing.dstDemTile;$=E.morphing.phase,te&&Ee&&(this._prepareDemTileUniforms(l,te,O,"_prev")&&(q=te),this._prepareDemTileUniforms(l,Ee,O)&&(U=Ee))}if(q&&U?(I.activeTexture.set(A.TEXTURE2),U.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE,A.NEAREST),I.activeTexture.set(A.TEXTURE4),q.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE,A.NEAREST),O.u_dem_lerp=$):(U=this.terrainTileForTile[l.tileID.key],I.activeTexture.set(A.TEXTURE2),(this._prepareDemTileUniforms(l,U,O)?U.demTexture:this.emptyDEMTexture).bind(A.NEAREST,A.CLAMP_TO_EDGE)),I.activeTexture.set(A.TEXTURE3),E&&E.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE),this._depthFBO&&(O.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE),O.u_depth_size_inv=[1,1]),E&&E.useMeterToDem&&U){const te=(1<<U.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;O.u_meter_to_dem=te}if(E&&E.labelPlaneMatrixInv&&(O.u_label_plane_matrix_inv=E.labelPlaneMatrixInv),g.setTerrainUniformValues(I,O),"globe"===this.painter.transform.projection.name){const te=this.globeUniformValues(this.painter.transform,l.tileID.canonical,E&&E.useDenormalizedUpVectorScale);g.setGlobeUniformValues(I,te)}}globeUniformValues(l,g,E){const I=l.projection;return{u_tile_tl_up:I.upVector(g,0,0),u_tile_tr_up:I.upVector(g,p.EXTENT,0),u_tile_br_up:I.upVector(g,p.EXTENT,p.EXTENT),u_tile_bl_up:I.upVector(g,0,p.EXTENT),u_tile_up_scale:E?p.globeMetersToEcef(1):I.upVectorScale(g,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const g=this.painter,E=this.painter.context;0!==l.length&&(E.bindFramebuffer.set(null),E.viewport.set([0,0,g.width,g.height]),g.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(I,A,O,k,U){if("globe"===I.transform.projection.name)!function(q,$,te,Ee,Re){const Be=q.context,Ne=Be.gl;let je,oe;const Pe=q.options.showTerrainWireframe?2:0,Xe=q.transform,He=p.globeUseCustomAntiAliasing(q,Be,Xe),gt=(dn,kt)=>{if(oe===dn)return;const Jt=[Hu[dn],"PROJECTION_GLOBE_VIEW"];He&&Jt.push("CUSTOM_ANTIALIASING"),kt&&Jt.push(Hu[Pe]),je=q.useProgram("globeRaster",null,Jt),oe=dn},mt=q.colorModeForRenderPass(),it=new p.DepthMode(Ne.LEQUAL,p.DepthMode.ReadWrite,q.depthRangeFor3D);Ci.update(Re);const St=p.calculateGlobeMercatorMatrix(Xe),Et=[p.mercatorXfromLng(Xe.center.lng),p.mercatorYfromLat(Xe.center.lat)],Tt=Pe?[!1,!0]:[!1],mn=q.globeSharedBuffers,Rt=[Xe.width*p.exported.devicePixelRatio,Xe.height*p.exported.devicePixelRatio],Kt=Float32Array.from(Xe.globeMatrix),Nt={useDenormalizedUpVectorScale:!0};if(Tt.forEach(dn=>{const kt=q.transform,Jt=oa(kt.zoom)*$.exaggeration();oe=-1;const un=dn?Ne.LINES:Ne.TRIANGLES;for(const on of Ee){const vn=te.getTile(on),nr=p.StencilMode.disabled,Tr=$.prevTerrainTileForTile[on.key],jn=$.terrainTileForTile[on.key];ia(Tr,jn)&&Ci.newMorphing(on.key,Tr,jn,Re,250),Be.activeTexture.set(Ne.TEXTURE0),vn.texture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE);const fr=Ci.getMorphValuesForProxy(on.key),Rn=fr?1:0;fr&&p.extend$1(Nt,{morphing:{srcDemTile:fr.from,dstDemTile:fr.to,phase:p.easeCubicInOut(fr.phase)}});const ei=p.tileCornersToBounds(on.canonical),Jn=p.getLatitudinalLod(ei.getCenter().lat),ao=p.getGridMatrix(on.canonical,ei,Jn,kt.worldSize/kt._pixelsPerMercatorPixel),Ro=p.globeNormalizeECEF(p.globeTileBounds(on.canonical)),Lo=ri(kt.projMatrix,Kt,St,Ro,p.globeToMercatorTransition(kt.zoom),Et,kt.frustumCorners.TL,kt.frustumCorners.TR,kt.frustumCorners.BR,kt.frustumCorners.BL,kt.globeCenterInViewSpace,kt.globeRadius,Rt,Jt,ao);if(gt(Rn,dn),$.setupElevationDraw(vn,je,Nt),q.prepareDrawProgram(Be,je,on.toUnwrapped()),mn){const[wo,Ys,Na]=dn?mn.getWirefameBuffers(q.context,Jn):mn.getGridBuffers(Jn,0!==Jt);je.draw(Be,un,it,nr,mt,p.CullFaceMode.backCCW,Lo,"globe_raster",wo,Ys,Na)}}}),mn){const dn=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];He&&dn.push("CUSTOM_ANTIALIASING"),je=q.useProgram("globeRaster",null,dn);for(const kt of Ee){const{x:Jt,y:un,z:on}=kt.canonical,vn=0===un,nr=un===(1<<on)-1,[Tr,jn,fr,Rn]=mn.getPoleBuffers(on);if(Rn&&(vn||nr)){const ei=te.getTile(kt);Be.activeTexture.set(Ne.TEXTURE0),ei.texture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE);let Jn=p.globePoleMatrixForTile(on,Jt,Xe);const ao=p.globeNormalizeECEF(p.globeTileBounds(kt.canonical)),Ro=(Lo,wo)=>Lo.draw(Be,Ne.TRIANGLES,it,p.StencilMode.disabled,mt,p.CullFaceMode.disabled,ri(Xe.projMatrix,Jn,Jn,ao,0,Et,Xe.frustumCorners.TL,Xe.frustumCorners.TR,Xe.frustumCorners.BR,Xe.frustumCorners.BL,Xe.globeCenterInViewSpace,Xe.globeRadius,Rt,0),"globe_pole_raster",wo,fr,Rn);$.setupElevationDraw(ei,je,Nt),q.prepareDrawProgram(Be,je,kt.toUnwrapped()),vn&&Ro(je,Tr),nr&&(Jn=p.scale(p.create(),Jn,[1,-1,1]),Ro(je,jn))}}}}(I,A,O,k,U);else{const q=I.context,$=q.gl;let te,Ee;const Re=I.options.showTerrainWireframe?2:0,Be=(Xe,He)=>{if(Ee===Xe)return;const gt=[Hu[Xe]];He&&gt.push(Hu[Re]),te=I.useProgram("terrainRaster",null,gt),Ee=Xe},Ne=I.colorModeForRenderPass(),je=new p.DepthMode($.LEQUAL,p.DepthMode.ReadWrite,I.depthRangeFor3D);Ci.update(U);const oe=I.transform,Pe=oa(oe.zoom)*A.exaggeration();(Re?[!1,!0]:[!1]).forEach(Xe=>{Ee=-1;const He=Xe?$.LINES:$.TRIANGLES,[gt,mt]=Xe?A.getWirefameBuffer():[A.gridIndexBuffer,A.gridSegments];for(const it of k){const St=O.getTile(it),Et=p.StencilMode.disabled,Tt=A.prevTerrainTileForTile[it.key],mn=A.terrainTileForTile[it.key];ia(Tt,mn)&&Ci.newMorphing(it.key,Tt,mn,U,250),q.activeTexture.set($.TEXTURE0),St.texture.bind($.LINEAR,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST);const Rt=Ci.getMorphValuesForProxy(it.key),Kt=Rt?1:0;let Nt;Rt&&(Nt={morphing:{srcDemTile:Rt.from,dstDemTile:Rt.to,phase:p.easeCubicInOut(Rt.phase)}});const dn=qu(it.projMatrix,Nh(it.canonical,oe.renderWorldCopies)?Pe/10:Pe);Be(Kt,Xe),A.setupElevationDraw(St,te,Nt),I.prepareDrawProgram(q,te,it.toUnwrapped()),te.draw(q,He,je,Et,Ne,p.CullFaceMode.backCCW,dn,"terrain_raster",A.gridBuffer,gt,mt)}})}}(g,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,g.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(0===this._drapedRenderBatches.length)return l+1;this.renderingToTexture=!0;const g=this.painter,E=this.painter.context,I=this.proxySourceCache,A=this.proxiedCoords[I.id],O=this._drapedRenderBatches.shift(),k=[],U=g.style.order;let q=0;for(const $ of A){const te=I.getTileByID($.proxyTileKey),Ee=I.proxyCachedFBO[$.key]?I.proxyCachedFBO[$.key][l]:void 0,Re=void 0!==Ee?I.renderCache[Ee]:this.pool[q++],Be=void 0!==Ee;if(te.texture=Re.tex,Be&&!Re.dirty){k.push(te.tileID);continue}let Ne;E.bindFramebuffer.set(Re.fb.framebuffer),this.renderedToTile=!1,Re.dirty&&(E.clear({color:p.Color.transparent,stencil:0}),Re.dirty=!1);for(let je=O.start;je<=O.end;++je){const oe=g.style._layers[U[je]];if(oe.isHidden(g.transform.zoom))continue;const Pe=g.style._getLayerSourceCache(oe),Xe=Pe?this.proxyToSource[$.key][Pe.id]:[$];if(!Xe)continue;const He=Xe;E.viewport.set([0,0,Re.fb.width,Re.fb.height]),Ne!==(Pe?Pe.id:null)&&(this._setupStencil(Re,Xe,oe,Pe),Ne=Pe?Pe.id:null),g.renderLayer(g,Pe,oe,He)}this.renderedToTile?(Re.dirty=!0,k.push(te.tileID)):Be||--q,5===q&&(q=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,E.bindFramebuffer.set(null),E.viewport.set([0,0,g.width,g.height]),O.end+1}postRender(){}renderCacheEfficiency(l){const g=l.order.length;if(0===g)return{efficiency:100};let E,I=0,A=0,O=!1;for(let k=0;k<g;++k){const U=l._layers[l.order[k]];this._style.isLayerDraped(U)?(O&&++I,++A):O||(O=!0,E=U.id)}return 0===A?{efficiency:100}:{efficiency:100*(1-I/A),firstUndrapedLayer:E}}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(g=>g.dem).forEach(g=>{l=Math.min(l,g.dem.tree.minimums[0])}),0===l?l:(l-30)*this._exaggeration}raycast(l,g,E){if(!this._visibleDemTiles)return null;const I=this._visibleDemTiles.filter(A=>A.dem).map(A=>{const O=A.tileID,k=1<<O.overscaledZ,{x:U,y:q}=O.canonical,$=U/k,te=(U+1)/k,Ee=q/k,Re=(q+1)/k;return{minx:$,miny:Ee,maxx:te,maxy:Re,t:A.dem.tree.raycastRoot($,Ee,te,Re,l,g,E),tile:A}});I.sort((A,O)=>(null!==A.t?A.t:Number.MAX_VALUE)-(null!==O.t?O.t:Number.MAX_VALUE));for(const A of I){if(null==A.t)return null;const O=A.tile.dem.tree.raycast(A.minx,A.miny,A.maxx,A.maxy,l,g,E);if(null!=O)return O}return null}_createFBO(){const l=this.painter.context,g=l.gl,E=this.drapeBufferSize;l.activeTexture.set(g.TEXTURE0);const I=new p.Texture(l,{width:E[0],height:E[1],data:null},g.RGBA);I.bind(g.LINEAR,g.CLAMP_TO_EDGE);const A=l.createFramebuffer(E[0],E[1],!1);return A.colorAttachment.set(I.texture),A.depthAttachment=new tt(l,A.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,E[0],E[1]),this._stencilRef=0,A.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):A.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&!l.extTextureFilterAnisotropicForceOff&&g.texParameterf(g.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:A,tex:I,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const g=this._style._layers[l],E=g.isHidden(this.painter.transform.zoom);return"custom"===g.type?!E&&g.shouldRedrape():!E&&g.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const E of this._style._getSources())if(E instanceof bn){l=!0;break}if(!l)return;const g={};for(let E=0;E<this._style.order.length;++E){const I=this._style._layers[this._style.order[E]],A=this._style._getLayerSourceCache(I);if(A&&!g[A.id]&&!I.isHidden(this.painter.transform.zoom)&&"line"===I.type&&I.widthExpression()instanceof p.ZoomDependentExpression){g[A.id]=!0;for(const O of this.proxyCoords){const k=this.proxyToSource[O.key][A.id];if(k)for(const U of k)this._clearRenderCacheForTile(A.id,U)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const E in this._style._sourceCaches)if(this._style._sourceCaches[E]._source instanceof fn){l=!0;break}if(!l)return;const g={};for(let E=0;E<this._style.order.length;++E){const I=this._style._layers[this._style.order[E]],A=this._style._getLayerSourceCache(I);if(!A||g[A.id]||I.isHidden(this.painter.transform.zoom)||"raster"!==I.type)continue;const O=I.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const U=this.proxyToSource[k.key][A.id];if(U)for(const q of U){const $=Dl(A.getTile(q),A.findLoadedParent(q,0),A,this.painter.transform,O);(1!==$.opacity||0!==$.mix)&&this._clearRenderCacheForTile(A.id,q)}}}}_setupDrapedRenderBatches(){const l=this._style.order,g=l.length;if(0===g)return;const E=[];let I,A=0,O=this._style._layers[l[A]];for(;!this._style.isLayerDraped(O)&&O.isHidden(this.painter.transform.zoom)&&++A<g;)O=this._style._layers[l[A]];for(;A<g;++A){const k=this._style._layers[l[A]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?void 0===I&&(I=A):void 0!==I&&(E.push({start:I,end:A-1}),I=void 0))}void 0!==I&&E.push({start:I,end:A-1}),this._drapedRenderBatches=E}_setupRenderCache(l){const g=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,g.renderCache.length>g.renderCachePool.length){const O=Object.values(g.proxyCachedFBO);g.proxyCachedFBO={};for(let k=0;k<O.length;++k){const U=Object.values(O[k]);g.renderCachePool.push(...U)}}return}this._clearRasterLayersFromRenderCache();const E=this.proxyCoords,I=this._tilesDirty;for(let O=E.length-1;O>=0;O--){const k=E[O];if(g.getTileByID(k.key),void 0!==g.proxyCachedFBO[k.key]){const U=l[k.key],q=this.proxyToSource[k.key];let $=0;for(const te in q){const Ee=q[te],Re=U[te];if(!Re||Re.length!==Ee.length||Ee.some((Be,Ne)=>Be!==Re[Ne]||I[te]&&I[te].hasOwnProperty(Be.key))){$=-1;break}++$}for(const te in g.proxyCachedFBO[k.key])g.renderCache[g.proxyCachedFBO[k.key][te]].dirty=$<0||$!==Object.values(U).length}}const A=[...this._drapedRenderBatches];A.sort((O,k)=>k.end-k.start-(O.end-O.start));for(const O of A)for(const k of E){if(g.proxyCachedFBO[k.key])continue;let U=g.renderCachePool.pop();void 0===U&&g.renderCache.length<50&&(U=g.renderCache.length,g.renderCache.push(this._createFBO())),void 0!==U&&(g.proxyCachedFBO[k.key]={},g.proxyCachedFBO[k.key][O.start]=U,g.renderCache[U].dirty=!0)}this._tilesDirty={}}_setupStencil(l,g,E,I){if(!I||!this._sourceTilesOverlap[I.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const A=this.painter.context,O=A.gl;if(g.length<=1)return void(this._overlapStencilType=!1);let k;if(E.isTileClipped())k=g.length,this._overlapStencilMode.test={func:O.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(g[0].overscaledZ>g[g.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:O.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(A.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,E.isTileClipped()&&this._renderTileClippingMasks(g,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(l,g){const E=this.painter,I=this.painter.context,A=I.gl;E._tileClippingMaskIDs={},I.setColorMode(p.ColorMode.disabled),I.setDepthMode(p.DepthMode.disabled);const O=E.useProgram("clippingMask");for(const k of l){const U=E._tileClippingMaskIDs[k.key]=--g;O.draw(I,A.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:A.ALWAYS,mask:0},U,255,A.KEEP,A.KEEP,A.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,Dr(k.projMatrix),"$clipping",E.tileExtentBuffer,E.quadTriangleIndexBuffer,E.tileExtentSegments)}}pointCoordinate(l){const g=this.painter.transform;if(l.x<0||l.x>g.width||l.y<0||l.y>g.height)return null;const E=[l.x,l.y,1,1];p.transformMat4$1(E,E,g.pixelMatrixInverse),p.scale$1(E,E,1/E[3]),E[0]/=g.worldSize,E[1]/=g.worldSize;const I=g._camera.position,A=p.mercatorZfromAltitude(1,g.center.lat),O=[I[0],I[1],I[2]/A,0],k=p.subtract([],E.slice(0,3),O);p.normalize(k,k);const U=this.raycast(O,k,this._exaggeration);return null!==U&&U?(p.scaleAndAdd(O,O,k,U),O[3]=O[2],O[2]*=A,O):null}drawDepth(){const l=this.painter,g=l.context,E=this.proxySourceCache,I=Math.ceil(l.width),A=Math.ceil(l.height);if(!this._depthFBO||this._depthFBO.width===I&&this._depthFBO.height===A||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const O=g.gl,k=g.createFramebuffer(I,A,!0);g.activeTexture.set(O.TEXTURE0);const U=new p.Texture(g,{width:I,height:A,data:null},O.RGBA);U.bind(O.NEAREST,O.CLAMP_TO_EDGE),k.colorAttachment.set(U.texture);const q=g.createRenderbuffer(g.gl.DEPTH_COMPONENT16,I,A);k.depthAttachment.set(q),this._depthFBO=k,this._depthTexture=U}g.bindFramebuffer.set(this._depthFBO.framebuffer),g.viewport.set([0,0,I,A]),function(O,k,U,q){if("globe"===O.transform.projection.name)return;const $=O.context,te=$.gl;$.clear({depth:1});const Ee=O.useProgram("terrainDepth"),Re=new p.DepthMode(te.LESS,p.DepthMode.ReadWrite,O.depthRangeFor3D);for(const Be of q){const Ne=U.getTile(Be),je=qu(Be.projMatrix,0);k.setupElevationDraw(Ne,Ee),Ee.draw($,te.TRIANGLES,Re,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,je,"terrain_depth",k.gridBuffer,k.gridIndexBuffer,k.gridNoSkirtSegments)}}(l,this,E,this.proxyCoords)}_setupProxiedCoordsForOrtho(l,g,E){if(l.getSource()instanceof Ur)return this._setupProxiedCoordsForImageSource(l,g,E);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const I=this.proxiedCoords[l.id]=[],A=this.proxyCoords;for(let k=0;k<A.length;k++){const U=A[k],q=this._findTileCoveringTileID(U,l);if(q){const $=this._createProxiedId(U,q,E[U.key]&&E[U.key][l.id]);I.push($),this.proxyToSource[U.key][l.id]=[$]}}let O=!1;for(let k=0;k<g.length;k++){const U=l.getTile(g[k]);if(!U||!U.hasData())continue;const q=this._findTileCoveringTileID(U.tileID,this.proxySourceCache);if(q&&q.tileID.canonical.z!==U.tileID.canonical.z){const $=this.proxyToSource[q.tileID.key][l.id],te=this._createProxiedId(q.tileID,U,E[q.tileID.key]&&E[q.tileID.key][l.id]);$?$.splice($.length-1,0,te):this.proxyToSource[q.tileID.key][l.id]=[te],I.push(te),O=!0}}this._sourceTilesOverlap[l.id]=O}_setupProxiedCoordsForImageSource(l,g,E){if(!l.getSource().loaded())return;const I=this.proxiedCoords[l.id]=[],A=this.proxyCoords,O=l.getSource(),k=new p.Point(O.tileID.x,O.tileID.y)._div(1<<O.tileID.z),U=O.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce(($,te)=>($.min.x=Math.min($.min.x,te.x-k.x),$.min.y=Math.min($.min.y,te.y-k.y),$.max.x=Math.max($.max.x,te.x-k.x),$.max.y=Math.max($.max.y,te.y-k.y),$),{min:new p.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),q=($,te)=>{const Ee=$.wrap+$.canonical.x/(1<<$.canonical.z),Re=$.canonical.y/(1<<$.canonical.z),Be=p.EXTENT/(1<<$.canonical.z),Ne=te.wrap+te.canonical.x/(1<<te.canonical.z),je=te.canonical.y/(1<<te.canonical.z);return Ee+Be<Ne+U.min.x||Ee>Ne+U.max.x||Re+Be<je+U.min.y||Re>je+U.max.y};for(let $=0;$<A.length;$++){const te=A[$];for(let Ee=0;Ee<g.length;Ee++){const Re=l.getTile(g[Ee]);if(!Re||!Re.hasData()||q(te,Re.tileID))continue;const Be=this._createProxiedId(te,Re,E[te.key]&&E[te.key][l.id]),Ne=this.proxyToSource[te.key][l.id];Ne?Ne.push(Be):this.proxyToSource[te.key][l.id]=[Be],I.push(Be)}}}_createProxiedId(l,g,E){let I=this.orthoMatrix;if(E){const A=E.find(O=>O.key===g.tileID.key);if(A)return A}if(g.tileID.key!==l.key){const A=l.canonical.z-g.tileID.canonical.z;let O,k,U;I=p.create();const q=g.tileID.wrap-l.wrap<<l.overscaledZ;A>0?(O=p.EXTENT>>A,k=O*((g.tileID.canonical.x<<A)-l.canonical.x+q),U=O*((g.tileID.canonical.y<<A)-l.canonical.y)):(O=p.EXTENT<<-A,k=p.EXTENT*(g.tileID.canonical.x-(l.canonical.x+q<<-A)),U=p.EXTENT*(g.tileID.canonical.y-(l.canonical.y<<-A))),p.ortho(I,0,O,0,O,0,1),p.translate(I,I,[k,U,0])}return new Wn(g.tileID,l.key,I)}_findTileCoveringTileID(l,g){let E=g.getTile(l);if(E&&E.hasData())return E;const I=this._findCoveringTileCache[g.id],A=I[l.key];if(E=A?g.getTileByID(A):null,E&&E.hasData()||null===A)return E;let O=E?E.tileID:l,k=O.overscaledZ;const U=g.getSource().minzoom,q=[];if(!A){const te=g.getSource().maxzoom;if(l.canonical.z>=te){const Ee=l.canonical.z-te;g.getSource().reparseOverscaled?(k=Math.max(l.canonical.z+2,g.transform.tileZoom),O=new p.OverscaledTileID(k,l.wrap,te,l.canonical.x>>Ee,l.canonical.y>>Ee)):0!==Ee&&(k=te,O=new p.OverscaledTileID(k,l.wrap,te,l.canonical.x>>Ee,l.canonical.y>>Ee))}O.key!==l.key&&(q.push(O.key),E=g.getTile(O))}const $=te=>{q.forEach(Ee=>{I[Ee]=te}),q.length=0};for(k-=1;k>=U&&(!E||!E.hasData());k--){E&&$(E.tileID.key);const te=O.calculateScaledKey(k);if(E=g.getTileByID(te),E&&E.hasData())break;const Ee=I[te];if(null===Ee)break;void 0===Ee?q.push(te):E=g.getTileByID(Ee)}return $(E?E.tileID.key:null),E&&E.hasData()?E:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,g){let E=this._tilesDirty[l];E||(E=this._tilesDirty[l]={}),E[g.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const l=function(g){let E=0;const I=new p.StructArrayLayout2ui4,A=131;for(let O=1;O<129;O++){for(let k=1;k<129;k++)E=O*A+k,I.emplaceBack(E,E+1),I.emplaceBack(E,E+A),I.emplaceBack(E+1,E+A),128===O&&I.emplaceBack(E+A,E+A+1);I.emplaceBack(E+1,E+1+A)}return I}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(l),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,l.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class In{static cacheKey(l,g,E,I){let A=`${g}${I?I.cacheKey:""}`;for(const O of E)l.usedDefines.includes(O)&&(A+=`/${O}`);return A}constructor(l,g,E,I,A,O){const k=l.gl;this.program=k.createProgram();const U=function(oe){const Pe=[];for(let Xe=0;Xe<oe.length;Xe++){if(null===oe[Xe])continue;const He=oe[Xe].split(" ");Pe.push(He.pop())}return Pe}(E.staticAttributes),q=I?I.getBinderAttributes():[],$=U.concat(q);let te=I?I.defines():[];te=te.concat(O.map(oe=>`#define ${oe}`));const Ee=l.isWebGL2?"#version 300 es\n":"",Re=Ee+te.concat(l.extStandardDerivatives&&0===Ee.length?"#extension GL_OES_standard_derivatives : enable\n".concat(pr):pr,pr,iu,Tl.fragmentSource,ya.fragmentSource,E.fragmentSource).join("\n"),Be=Ee+te.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",iu,Tl.vertexSource,ya.vertexSource,Ts.vertexSource,E.vertexSource).join("\n"),Ne=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(Ne,Re),k.compileShader(Ne),k.attachShader(this.program,Ne);const je=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(je,Be),k.compileShader(je),k.attachShader(this.program,je),this.attributes={},this.numAttributes=$.length;for(let oe=0;oe<this.numAttributes;oe++)$[oe]&&(k.bindAttribLocation(this.program,oe,$[oe]),this.attributes[$[oe]]=oe);k.linkProgram(this.program),k.deleteShader(je),k.deleteShader(Ne),this.fixedUniforms=A(l),this.binderUniforms=I?I.getUniforms(l):[],O.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(oe=l),u_dem_prev:new p.Uniform1i(oe),u_dem_unpack:new p.Uniform4f(oe),u_dem_tl:new p.Uniform2f(oe),u_dem_scale:new p.Uniform1f(oe),u_dem_tl_prev:new p.Uniform2f(oe),u_dem_scale_prev:new p.Uniform1f(oe),u_dem_size:new p.Uniform1f(oe),u_dem_lerp:new p.Uniform1f(oe),u_exaggeration:new p.Uniform1f(oe),u_depth:new p.Uniform1i(oe),u_depth_size_inv:new p.Uniform2f(oe),u_meter_to_dem:new p.Uniform1f(oe),u_label_plane_matrix_inv:new p.UniformMatrix4f(oe)}),O.includes("GLOBE")&&(this.globeUniforms=(oe=>({u_tile_tl_up:new p.Uniform3f(oe),u_tile_tr_up:new p.Uniform3f(oe),u_tile_br_up:new p.Uniform3f(oe),u_tile_bl_up:new p.Uniform3f(oe),u_tile_up_scale:new p.Uniform1f(oe)}))(l)),O.includes("FOG")&&(this.fogUniforms=(oe=>({u_fog_matrix:new p.UniformMatrix4f(oe),u_fog_range:new p.Uniform2f(oe),u_fog_color:new p.Uniform4f(oe),u_fog_horizon_blend:new p.Uniform1f(oe),u_fog_temporal_offset:new p.Uniform1f(oe),u_frustum_tl:new p.Uniform3f(oe),u_frustum_tr:new p.Uniform3f(oe),u_frustum_br:new p.Uniform3f(oe),u_frustum_bl:new p.Uniform3f(oe),u_globe_pos:new p.Uniform3f(oe),u_globe_radius:new p.Uniform1f(oe),u_globe_transition:new p.Uniform1f(oe),u_is_globe:new p.Uniform1i(oe),u_viewport:new p.Uniform2f(oe)}))(l))}var oe}setTerrainUniformValues(l,g){if(!this.terrainUniforms)return;const E=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const I in g)E[I]&&E[I].set(this.program,I,g[I])}}setGlobeUniformValues(l,g){if(!this.globeUniforms)return;const E=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const I in g)E[I]&&E[I].set(this.program,I,g[I])}}setFogUniformValues(l,g){if(!this.fogUniforms)return;const E=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const I in g)E[I].set(this.program,I,g[I])}}draw(l,g,E,I,A,O,k,U,q,$,te,Ee,Re,Be,Ne){const je=l.gl;if(this.failedToCreate)return;l.program.set(this.program),l.setDepthMode(E),l.setStencilMode(I),l.setColorMode(A),l.setCullFace(O);for(const Pe of Object.keys(this.fixedUniforms))this.fixedUniforms[Pe].set(this.program,Pe,k[Pe]);Be&&Be.setUniforms(this.program,l,this.binderUniforms,Ee,{zoom:Re});const oe={[je.LINES]:2,[je.TRIANGLES]:3,[je.LINE_STRIP]:1}[g];for(const Pe of te.get()){const Xe=Pe.vaos||(Pe.vaos={});(Xe[U]||(Xe[U]=new Ac)).bind(l,this,q,Be?Be.getPaintVertexBuffers():[],$,Pe.vertexOffset,Ne||[]),je.drawElements(g,Pe.primitiveLength*oe,je.UNSIGNED_SHORT,Pe.primitiveOffset*oe*2)}}}function Ga(v,l){const g=Math.pow(2,l.tileID.overscaledZ),E=l.tileSize*Math.pow(2,v.transform.tileZoom)/g,I=E*(l.tileID.canonical.x+l.tileID.wrap*g),A=E*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_tile_units_to_pixels:1/at(l,1,v.transform.tileZoom),u_pixel_coord_upper:[I>>16,A>>16],u_pixel_coord_lower:[65535&I,65535&A]}}const ui=p.create(),Fs=(v,l,g,E,I,A,O,k,U,q,$)=>{const te=l.style.light,Ee=te.properties.get("position"),Re=[Ee.x,Ee.y,Ee.z],Be=p.create$1();"viewport"===te.properties.get("anchor")&&(p.fromRotation(Be,-l.transform.angle),p.transformMat3(Re,Re,Be));const Ne=te.properties.get("color"),je=l.transform,oe={u_matrix:v,u_lightpos:Re,u_lightintensity:te.properties.get("intensity"),u_lightcolor:[Ne.r,Ne.g,Ne.b],u_vertical_gradient:+g,u_opacity:E,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ui,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:I,u_edge_radius:A};return"globe"===je.projection.name&&(oe.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],oe.u_zoom_transition=U,oe.u_inv_rot_matrix=$,oe.u_merc_center=q,oe.u_up_dir=je.projection.upVector(new p.CanonicalTileID(0,0,0),q[0]*p.EXTENT,q[1]*p.EXTENT),oe.u_height_lift=k),oe},hc=(v,l,g,E,I,A,O,k,U,q,$,te)=>{const Ee=Fs(v,l,g,E,I,A,O,U,q,$,te),Re={u_height_factor:-Math.pow(2,O.overscaledZ)/k.tileSize/8};return p.extend(Ee,Ga(l,k),Re)},va=v=>({u_matrix:v}),xa=(v,l,g)=>p.extend(va(v),Ga(l,g)),jo=(v,l)=>({u_matrix:v,u_world:l}),sl=(v,l,g,E)=>p.extend(xa(v,l,g),{u_world:E}),ou=p.create(),$s=(v,l,g,E,I,A)=>{const O=v.transform,k="globe"===O.projection.name;let U;if("map"===A.paint.get("circle-pitch-alignment"))if(k){const $=p.globePixelsToTileUnits(O.zoom,l.canonical)*O._pixelsPerMercatorPixel;U=Float32Array.from([$,0,0,$])}else U=O.calculatePixelsToTileUnitsMatrix(g);else U=new Float32Array([O.pixelsToGLUnits[0],0,0,O.pixelsToGLUnits[1]]);const q={u_camera_to_center_distance:O.cameraToCenterDistance,u_matrix:v.translatePosMatrix(l.projMatrix,g,A.paint.get("circle-translate"),A.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:U,u_inv_rot_matrix:ou,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){q.u_inv_rot_matrix=E,q.u_merc_center=I,q.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],q.u_zoom_transition=p.globeToMercatorTransition(O.zoom);const $=I[0]*p.EXTENT,te=I[1]*p.EXTENT;q.u_up_dir=O.projection.upVector(new p.CanonicalTileID(0,0,0),$,te)}return q},Wr=v=>{const l=[];return"map"===v.paint.get("circle-pitch-alignment")&&l.push("PITCH_WITH_MAP"),"map"===v.paint.get("circle-pitch-scale")&&l.push("SCALE_WITH_MAP"),l},_u=(v,l,g,E)=>{const I=p.EXTENT/g.tileSize;return{u_matrix:v,u_camera_to_center_distance:l.getCameraToCenterDistance(E),u_extrude_scale:[l.pixelsToGLUnits[0]/I,l.pixelsToGLUnits[1]/I]}},Bs=(v,l,g=1)=>({u_matrix:v,u_color:l,u_overlay:0,u_overlay_scale:g}),$a=p.create(),vu=(v,l,g,E,I,A,O)=>{const k=v.transform,U="globe"===k.projection.name,q=U?p.globePixelsToTileUnits(k.zoom,l.canonical)*k._pixelsPerMercatorPixel:at(g,1,A),$={u_matrix:l.projMatrix,u_extrude_scale:q,u_intensity:O,u_inv_rot_matrix:$a,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(U){$.u_inv_rot_matrix=E,$.u_merc_center=I,$.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],$.u_zoom_transition=p.globeToMercatorTransition(k.zoom);const te=I[0]*p.EXTENT,Ee=I[1]*p.EXTENT;$.u_up_dir=k.projection.upVector(new p.CanonicalTileID(0,0,0),te,Ee)}return $},Aa=(v,l,g,E,I,A,O)=>{const k=v.transform,U=k.calculatePixelsToTileUnitsMatrix(l);return{u_matrix:rh(v,l,g,E),u_pixels_to_tile_units:U,u_device_pixel_ratio:A,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:I,u_texsize:al(g)?l.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Wo(l,v.transform),u_alpha_discard_threshold:0,u_trim_offset:O}},sa=(v,l,g,E,I)=>{const A=v.transform;return{u_matrix:rh(v,l,g,E),u_texsize:l.imageAtlasTexture.size,u_pixels_to_tile_units:A.calculatePixelsToTileUnitsMatrix(l),u_device_pixel_ratio:I,u_image:0,u_tile_units_to_pixels:Wo(l,A),u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Wo(v,l){return 1/at(v,1,l.tileZoom)}function rh(v,l,g,E){return v.translatePosMatrix(E||l.tileID.projMatrix,l,g.paint.get("line-translate"),g.paint.get("line-translate-anchor"))}function al(v){const l=v.paint.get("line-dasharray").value;return l.value||"constant"!==l.kind}const Ms=(v,l,g,E,I,A)=>{return{u_matrix:v,u_tl_parent:l,u_scale_parent:g,u_fade_t:E.mix,u_opacity:E.opacity*I.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:I.paint.get("raster-brightness-min"),u_brightness_high:I.paint.get("raster-brightness-max"),u_saturation_factor:(k=I.paint.get("raster-saturation"),k>0?1-1/(1.001-k):-k),u_contrast_factor:(O=I.paint.get("raster-contrast"),O>0?1/(1-O):1+O),u_spin_weights:qs(I.paint.get("raster-hue-rotate")),u_perspective_transform:A};var O,k};function qs(v){v*=Math.PI/180;const l=Math.sin(v),g=Math.cos(v);return[(2*g+1)/3,(-Math.sqrt(3)*l-g+1)/3,(Math.sqrt(3)*l-g+1)/3]}const Hs=p.create(),ih=(v,l,g,E,I,A,O,k,U,q,$,te,Ee,Re,Be,Ne)=>{const je=I.transform,oe={u_is_size_zoom_constant:+("constant"===v||"source"===v),u_is_size_feature_constant:+("constant"===v||"camera"===v),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:je.cameraToCenterDistance,u_rotate_symbol:+g,u_aspect_ratio:je.width/je.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:O,u_coord_matrix:k,u_is_text:+U,u_pitch_with_map:+E,u_texsize:q,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Hs,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Hs,u_up_vector:[0,-1,0]};return"globe"===Ne.name&&(oe.u_tile_id=[$.canonical.x,$.canonical.y,1<<$.canonical.z],oe.u_zoom_transition=te,oe.u_inv_rot_matrix=Re,oe.u_merc_center=Ee,oe.u_camera_forward=je._camera.forward(),oe.u_ecef_origin=p.globeECEFOrigin(je.globeMatrix,$.toUnwrapped()),oe.u_tile_matrix=Float32Array.from(je.globeMatrix),oe.u_up_vector=Be),oe},Ds=(v,l,g,E,I,A,O,k,U,q,$,te,Ee,Re,Be,Ne,je)=>p.extend(ih(v,l,g,E,I,A,O,k,U,q,te,Ee,Re,Be,Ne,je),{u_gamma_scale:E?I.transform.cameraToCenterDistance*Math.cos(I.terrain?0:I.transform._pitch):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+$}),xf=(v,l,g,E,I,A,O,k,U,q,$,te,Ee,Re,Be,Ne)=>p.extend(Ds(v,l,g,E,I,A,O,k,!0,U,!0,$,te,Ee,Re,Be,Ne),{u_texsize_icon:q,u_texture_icon:1}),Yl=(v,l,g)=>({u_matrix:v,u_opacity:l,u_color:g}),Pc=(v,l,g,E,I)=>p.extend(function(A,O,k){const U=O.imageManager.getPattern(A.toString()),{width:q,height:$}=O.imageManager.getPixelSize(),te=Math.pow(2,k.tileID.overscaledZ),Ee=k.tileSize*Math.pow(2,O.transform.tileZoom)/te,Re=Ee*(k.tileID.canonical.x+k.tileID.wrap*te),Be=Ee*k.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[q,$],u_pattern_size:U.displaySize,u_tile_units_to_pixels:1/at(k,1,O.transform.tileZoom),u_pixel_coord_upper:[Re>>16,Be>>16],u_pixel_coord_lower:[65535&Re,65535&Be]}}(E,g,I),{u_matrix:v,u_opacity:l}),kh={fillExtrusion:v=>({u_matrix:new p.UniformMatrix4f(v),u_lightpos:new p.Uniform3f(v),u_lightintensity:new p.Uniform1f(v),u_lightcolor:new p.Uniform3f(v),u_vertical_gradient:new p.Uniform1f(v),u_opacity:new p.Uniform1f(v),u_edge_radius:new p.Uniform1f(v),u_ao:new p.Uniform2f(v),u_tile_id:new p.Uniform3f(v),u_zoom_transition:new p.Uniform1f(v),u_inv_rot_matrix:new p.UniformMatrix4f(v),u_merc_center:new p.Uniform2f(v),u_up_dir:new p.Uniform3f(v),u_height_lift:new p.Uniform1f(v)}),fillExtrusionPattern:v=>({u_matrix:new p.UniformMatrix4f(v),u_lightpos:new p.Uniform3f(v),u_lightintensity:new p.Uniform1f(v),u_lightcolor:new p.Uniform3f(v),u_vertical_gradient:new p.Uniform1f(v),u_height_factor:new p.Uniform1f(v),u_edge_radius:new p.Uniform1f(v),u_ao:new p.Uniform2f(v),u_tile_id:new p.Uniform3f(v),u_zoom_transition:new p.Uniform1f(v),u_inv_rot_matrix:new p.UniformMatrix4f(v),u_merc_center:new p.Uniform2f(v),u_up_dir:new p.Uniform3f(v),u_height_lift:new p.Uniform1f(v),u_image:new p.Uniform1i(v),u_texsize:new p.Uniform2f(v),u_pixel_coord_upper:new p.Uniform2f(v),u_pixel_coord_lower:new p.Uniform2f(v),u_tile_units_to_pixels:new p.Uniform1f(v),u_opacity:new p.Uniform1f(v)}),fill:v=>({u_matrix:new p.UniformMatrix4f(v)}),fillPattern:v=>({u_matrix:new p.UniformMatrix4f(v),u_image:new p.Uniform1i(v),u_texsize:new p.Uniform2f(v),u_pixel_coord_upper:new p.Uniform2f(v),u_pixel_coord_lower:new p.Uniform2f(v),u_tile_units_to_pixels:new p.Uniform1f(v)}),fillOutline:v=>({u_matrix:new p.UniformMatrix4f(v),u_world:new p.Uniform2f(v)}),fillOutlinePattern:v=>({u_matrix:new p.UniformMatrix4f(v),u_world:new p.Uniform2f(v),u_image:new p.Uniform1i(v),u_texsize:new p.Uniform2f(v),u_pixel_coord_upper:new p.Uniform2f(v),u_pixel_coord_lower:new p.Uniform2f(v),u_tile_units_to_pixels:new p.Uniform1f(v)}),circle:v=>({u_camera_to_center_distance:new p.Uniform1f(v),u_extrude_scale:new p.UniformMatrix2f(v),u_device_pixel_ratio:new p.Uniform1f(v),u_matrix:new p.UniformMatrix4f(v),u_inv_rot_matrix:new p.UniformMatrix4f(v),u_merc_center:new p.Uniform2f(v),u_tile_id:new p.Uniform3f(v),u_zoom_transition:new p.Uniform1f(v),u_up_dir:new p.Uniform3f(v)}),collisionBox:v=>({u_matrix:new p.UniformMatrix4f(v),u_camera_to_center_distance:new p.Uniform1f(v),u_extrude_scale:new p.Uniform2f(v)}),collisionCircle:v=>({u_matrix:new p.UniformMatrix4f(v),u_inv_matrix:new p.UniformMatrix4f(v),u_camera_to_center_distance:new p.Uniform1f(v),u_viewport_size:new p.Uniform2f(v)}),debug:v=>({u_color:new p.UniformColor(v),u_matrix:new p.UniformMatrix4f(v),u_overlay:new p.Uniform1i(v),u_overlay_scale:new p.Uniform1f(v)}),clippingMask:v=>({u_matrix:new p.UniformMatrix4f(v)}),heatmap:v=>({u_extrude_scale:new p.Uniform1f(v),u_intensity:new p.Uniform1f(v),u_matrix:new p.UniformMatrix4f(v),u_inv_rot_matrix:new p.UniformMatrix4f(v),u_merc_center:new p.Uniform2f(v),u_tile_id:new p.Uniform3f(v),u_zoom_transition:new p.Uniform1f(v),u_up_dir:new p.Uniform3f(v)}),heatmapTexture:v=>({u_image:new p.Uniform1i(v),u_color_ramp:new p.Uniform1i(v),u_opacity:new p.Uniform1f(v)}),hillshade:v=>({u_matrix:new p.UniformMatrix4f(v),u_image:new p.Uniform1i(v),u_latrange:new p.Uniform2f(v),u_light:new p.Uniform2f(v),u_shadow:new p.UniformColor(v),u_highlight:new p.UniformColor(v),u_accent:new p.UniformColor(v)}),hillshadePrepare:v=>({u_matrix:new p.UniformMatrix4f(v),u_image:new p.Uniform1i(v),u_dimension:new p.Uniform2f(v),u_zoom:new p.Uniform1f(v),u_unpack:new p.Uniform4f(v)}),line:v=>({u_matrix:new p.UniformMatrix4f(v),u_pixels_to_tile_units:new p.UniformMatrix2f(v),u_device_pixel_ratio:new p.Uniform1f(v),u_units_to_pixels:new p.Uniform2f(v),u_dash_image:new p.Uniform1i(v),u_gradient_image:new p.Uniform1i(v),u_image_height:new p.Uniform1f(v),u_texsize:new p.Uniform2f(v),u_tile_units_to_pixels:new p.Uniform1f(v),u_alpha_discard_threshold:new p.Uniform1f(v),u_trim_offset:new p.Uniform2f(v)}),linePattern:v=>({u_matrix:new p.UniformMatrix4f(v),u_texsize:new p.Uniform2f(v),u_pixels_to_tile_units:new p.UniformMatrix2f(v),u_device_pixel_ratio:new p.Uniform1f(v),u_image:new p.Uniform1i(v),u_units_to_pixels:new p.Uniform2f(v),u_tile_units_to_pixels:new p.Uniform1f(v),u_alpha_discard_threshold:new p.Uniform1f(v)}),raster:v=>({u_matrix:new p.UniformMatrix4f(v),u_tl_parent:new p.Uniform2f(v),u_scale_parent:new p.Uniform1f(v),u_fade_t:new p.Uniform1f(v),u_opacity:new p.Uniform1f(v),u_image0:new p.Uniform1i(v),u_image1:new p.Uniform1i(v),u_brightness_low:new p.Uniform1f(v),u_brightness_high:new p.Uniform1f(v),u_saturation_factor:new p.Uniform1f(v),u_contrast_factor:new p.Uniform1f(v),u_spin_weights:new p.Uniform3f(v),u_perspective_transform:new p.Uniform2f(v)}),symbolIcon:v=>({u_is_size_zoom_constant:new p.Uniform1i(v),u_is_size_feature_constant:new p.Uniform1i(v),u_size_t:new p.Uniform1f(v),u_size:new p.Uniform1f(v),u_camera_to_center_distance:new p.Uniform1f(v),u_rotate_symbol:new p.Uniform1i(v),u_aspect_ratio:new p.Uniform1f(v),u_fade_change:new p.Uniform1f(v),u_matrix:new p.UniformMatrix4f(v),u_label_plane_matrix:new p.UniformMatrix4f(v),u_coord_matrix:new p.UniformMatrix4f(v),u_is_text:new p.Uniform1i(v),u_pitch_with_map:new p.Uniform1i(v),u_texsize:new p.Uniform2f(v),u_tile_id:new p.Uniform3f(v),u_zoom_transition:new p.Uniform1f(v),u_inv_rot_matrix:new p.UniformMatrix4f(v),u_merc_center:new p.Uniform2f(v),u_camera_forward:new p.Uniform3f(v),u_tile_matrix:new p.UniformMatrix4f(v),u_up_vector:new p.Uniform3f(v),u_ecef_origin:new p.Uniform3f(v),u_texture:new p.Uniform1i(v)}),symbolSDF:v=>({u_is_size_zoom_constant:new p.Uniform1i(v),u_is_size_feature_constant:new p.Uniform1i(v),u_size_t:new p.Uniform1f(v),u_size:new p.Uniform1f(v),u_camera_to_center_distance:new p.Uniform1f(v),u_rotate_symbol:new p.Uniform1i(v),u_aspect_ratio:new p.Uniform1f(v),u_fade_change:new p.Uniform1f(v),u_matrix:new p.UniformMatrix4f(v),u_label_plane_matrix:new p.UniformMatrix4f(v),u_coord_matrix:new p.UniformMatrix4f(v),u_is_text:new p.Uniform1i(v),u_pitch_with_map:new p.Uniform1i(v),u_texsize:new p.Uniform2f(v),u_texture:new p.Uniform1i(v),u_gamma_scale:new p.Uniform1f(v),u_device_pixel_ratio:new p.Uniform1f(v),u_tile_id:new p.Uniform3f(v),u_zoom_transition:new p.Uniform1f(v),u_inv_rot_matrix:new p.UniformMatrix4f(v),u_merc_center:new p.Uniform2f(v),u_camera_forward:new p.Uniform3f(v),u_tile_matrix:new p.UniformMatrix4f(v),u_up_vector:new p.Uniform3f(v),u_ecef_origin:new p.Uniform3f(v),u_is_halo:new p.Uniform1i(v)}),symbolTextAndIcon:v=>({u_is_size_zoom_constant:new p.Uniform1i(v),u_is_size_feature_constant:new p.Uniform1i(v),u_size_t:new p.Uniform1f(v),u_size:new p.Uniform1f(v),u_camera_to_center_distance:new p.Uniform1f(v),u_rotate_symbol:new p.Uniform1i(v),u_aspect_ratio:new p.Uniform1f(v),u_fade_change:new p.Uniform1f(v),u_matrix:new p.UniformMatrix4f(v),u_label_plane_matrix:new p.UniformMatrix4f(v),u_coord_matrix:new p.UniformMatrix4f(v),u_is_text:new p.Uniform1i(v),u_pitch_with_map:new p.Uniform1i(v),u_texsize:new p.Uniform2f(v),u_texsize_icon:new p.Uniform2f(v),u_texture:new p.Uniform1i(v),u_texture_icon:new p.Uniform1i(v),u_gamma_scale:new p.Uniform1f(v),u_device_pixel_ratio:new p.Uniform1f(v),u_is_halo:new p.Uniform1i(v)}),background:v=>({u_matrix:new p.UniformMatrix4f(v),u_opacity:new p.Uniform1f(v),u_color:new p.UniformColor(v)}),backgroundPattern:v=>({u_matrix:new p.UniformMatrix4f(v),u_opacity:new p.Uniform1f(v),u_image:new p.Uniform1i(v),u_pattern_tl:new p.Uniform2f(v),u_pattern_br:new p.Uniform2f(v),u_texsize:new p.Uniform2f(v),u_pattern_size:new p.Uniform2f(v),u_pixel_coord_upper:new p.Uniform2f(v),u_pixel_coord_lower:new p.Uniform2f(v),u_tile_units_to_pixels:new p.Uniform1f(v)}),terrainRaster:Oh,terrainDepth:Oh,skybox:v=>({u_matrix:new p.UniformMatrix4f(v),u_sun_direction:new p.Uniform3f(v),u_cubemap:new p.Uniform1i(v),u_opacity:new p.Uniform1f(v),u_temporal_offset:new p.Uniform1f(v)}),skyboxGradient:v=>({u_matrix:new p.UniformMatrix4f(v),u_color_ramp:new p.Uniform1i(v),u_center_direction:new p.Uniform3f(v),u_radius:new p.Uniform1f(v),u_opacity:new p.Uniform1f(v),u_temporal_offset:new p.Uniform1f(v)}),skyboxCapture:v=>({u_matrix_3f:new p.UniformMatrix3f(v),u_sun_direction:new p.Uniform3f(v),u_sun_intensity:new p.Uniform1f(v),u_color_tint_r:new p.Uniform4f(v),u_color_tint_m:new p.Uniform4f(v),u_luminance:new p.Uniform1f(v)}),globeRaster:v=>({u_proj_matrix:new p.UniformMatrix4f(v),u_globe_matrix:new p.UniformMatrix4f(v),u_normalize_matrix:new p.UniformMatrix4f(v),u_merc_matrix:new p.UniformMatrix4f(v),u_zoom_transition:new p.Uniform1f(v),u_merc_center:new p.Uniform2f(v),u_image0:new p.Uniform1i(v),u_grid_matrix:new p.UniformMatrix3f(v),u_skirt_height:new p.Uniform1f(v),u_frustum_tl:new p.Uniform3f(v),u_frustum_tr:new p.Uniform3f(v),u_frustum_br:new p.Uniform3f(v),u_frustum_bl:new p.Uniform3f(v),u_globe_pos:new p.Uniform3f(v),u_globe_radius:new p.Uniform1f(v),u_viewport:new p.Uniform2f(v)}),globeAtmosphere:v=>({u_frustum_tl:new p.Uniform3f(v),u_frustum_tr:new p.Uniform3f(v),u_frustum_br:new p.Uniform3f(v),u_frustum_bl:new p.Uniform3f(v),u_horizon:new p.Uniform1f(v),u_transition:new p.Uniform1f(v),u_fadeout_range:new p.Uniform1f(v),u_color:new p.Uniform4f(v),u_high_color:new p.Uniform4f(v),u_space_color:new p.Uniform4f(v),u_star_intensity:new p.Uniform1f(v),u_star_density:new p.Uniform1f(v),u_star_size:new p.Uniform1f(v),u_temporal_offset:new p.Uniform1f(v),u_horizon_angle:new p.Uniform1f(v),u_rotation_matrix:new p.UniformMatrix4f(v)})};let qa;function Wu(v,l,g,E,I,A,O){const k=v.context,U=k.gl,q=v.transform,$=v.useProgram("collisionBox"),te=[];let Ee=0,Re=0;for(let He=0;He<E.length;He++){const gt=E[He],mt=l.getTile(gt),it=mt.getBucket(g);if(!it)continue;const St=cs(gt,it,q);let Et=St;0===I[0]&&0===I[1]||(Et=v.translatePosMatrix(St,mt,I,A));const Tt=O?it.textCollisionBox:it.iconCollisionBox,mn=it.collisionCircleArray;if(mn.length>0){const Rt=p.create(),Kt=Et;p.mul(Rt,it.placementInvProjMatrix,q.glCoordMatrix),p.mul(Rt,Rt,it.placementViewportMatrix),te.push({circleArray:mn,circleOffset:Re,transform:Kt,invTransform:Rt,projection:it.getProjection()}),Ee+=mn.length/4,Re=Ee}Tt&&(v.terrain&&v.terrain.setupElevationDraw(mt,$),$.draw(k,U.LINES,p.DepthMode.disabled,p.StencilMode.disabled,v.colorModeForRenderPass(),p.CullFaceMode.disabled,_u(Et,q,mt,it.getProjection()),g.id,Tt.layoutVertexBuffer,Tt.indexBuffer,Tt.segments,null,q.zoom,null,[Tt.collisionVertexBuffer,Tt.collisionVertexBufferExt]))}if(!O||!te.length)return;const Be=v.useProgram("collisionCircle"),Ne=new p.StructArrayLayout2f1f2i16;Ne.resize(4*Ee),Ne._trim();let je=0;for(const He of te)for(let gt=0;gt<He.circleArray.length/4;gt++){const mt=4*gt,it=He.circleArray[mt+0],St=He.circleArray[mt+1],Et=He.circleArray[mt+2],Tt=He.circleArray[mt+3];Ne.emplace(je++,it,St,Et,Tt,0),Ne.emplace(je++,it,St,Et,Tt,1),Ne.emplace(je++,it,St,Et,Tt,2),Ne.emplace(je++,it,St,Et,Tt,3)}(!qa||qa.length<2*Ee)&&(qa=function(He){const gt=2*He,mt=new p.StructArrayLayout3ui6;mt.resize(gt),mt._trim();for(let it=0;it<gt;it++){const St=6*it;mt.uint16[St+0]=4*it+0,mt.uint16[St+1]=4*it+1,mt.uint16[St+2]=4*it+2,mt.uint16[St+3]=4*it+2,mt.uint16[St+4]=4*it+3,mt.uint16[St+5]=4*it+0}return mt}(Ee));const oe=k.createIndexBuffer(qa,!0),Pe=k.createVertexBuffer(Ne,p.collisionCircleLayout.members,!0);for(const He of te){const gt={u_matrix:He.transform,u_inv_matrix:He.invTransform,u_camera_to_center_distance:(Xe=q).getCameraToCenterDistance(He.projection),u_viewport_size:[Xe.width,Xe.height]};Be.draw(k,U.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,v.colorModeForRenderPass(),p.CullFaceMode.disabled,gt,g.id,Pe,oe,p.SegmentVector.simpleSegment(0,2*He.circleOffset,He.circleArray.length,He.circleArray.length/2),null,q.zoom)}var Xe;Pe.destroy(),oe.destroy()}const xu=p.create();function ws({width:v,height:l,anchor:g,textOffset:E,textScale:I},A){const{horizontalAlign:O,verticalAlign:k}=p.getAnchorAlignment(g),U=-(O-.5)*v,q=-(k-.5)*l,$=p.evaluateVariableOffset(g,E);return new p.Point((U/I+$[0])*A,(q/I+$[1])*A)}function Rc(v,l,g,E,I,A,O,k,U,q,$){const te=v.text.placedSymbolArray,Ee=v.text.dynamicLayoutVertexArray,Re=v.icon.dynamicLayoutVertexArray,Be={},Ne=v.getProjection(),je=$n(k,Ne,A),oe=A.elevation,Pe=Ne.upVectorScale(k.canonical,A.center.lat,A.worldSize).metersToTile;Ee.clear();for(let Xe=0;Xe<te.length;Xe++){const He=te.get(Xe),{tileAnchorX:gt,tileAnchorY:mt,numGlyphs:it}=He,St=He.hidden||!He.crossTileID||v.allowVerticalPlacement&&!He.placedOrientation?null:E[He.crossTileID];if(St){let Et=0,Tt=0,mn=0;if(oe){const vn=oe?oe.getAtTileOffset(k,gt,mt):0,[nr,Tr,jn]=Ne.upVector(k.canonical,gt,mt);Et=vn*nr*Pe,Tt=vn*Tr*Pe,mn=vn*jn*Pe}let[Rt,Kt,Nt,dn]=_s(He.projectedAnchorX+Et,He.projectedAnchorY+Tt,He.projectedAnchorZ+mn,g?je:O);const kt=Ho(A.getCameraToCenterDistance(Ne),dn);let Jt=I.evaluateSizeForFeature(v.textSizeData,q,He)*kt/p.ONE_EM;g&&(Jt*=v.tilePixelRatio/U);const un=ws(St,Jt);g?(({x:Rt,y:Kt,z:Nt}=Ne.projectTilePoint(gt+un.x,mt+un.y,k.canonical)),[Rt,Kt,Nt]=_s(Rt+Et,Kt+Tt,Nt+mn,O)):(l&&un._rotate(-A.angle),Rt+=un.x,Kt+=un.y,Nt=0);const on=v.allowVerticalPlacement&&He.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let vn=0;vn<it;vn++)p.addDynamicAttributes(Ee,Rt,Kt,Nt,on);$&&He.associatedIconIndex>=0&&(Be[He.associatedIconIndex]={x:Rt,y:Kt,z:Nt,angle:on})}else Bn(it,Ee)}if($){Re.clear();const Xe=v.icon.placedSymbolArray;for(let He=0;He<Xe.length;He++){const gt=Xe.get(He),{numGlyphs:mt}=gt,it=Be[He];if(gt.hidden||!it)Bn(mt,Re);else{const{x:St,y:Et,z:Tt,angle:mn}=it;for(let Rt=0;Rt<mt;Rt++)p.addDynamicAttributes(Re,St,Et,Tt,mn)}}v.icon.dynamicLayoutVertexBuffer.updateData(Re)}v.text.dynamicLayoutVertexBuffer.updateData(Ee)}function zs(v,l,g){return g.iconsInText&&l?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function Ru(v,l,g,E,I,A,O,k,U,q,$,te){const Ee=v.context,Re=Ee.gl,Be=v.transform,Ne="map"===k,je="map"===U,oe=Ne&&"point"!==g.layout.get("symbol-placement"),Pe=Ne&&!je&&!oe,Xe=void 0!==g.layout.get("symbol-sort-key").constantOr(1);let He=!1;const gt=v.depthModeForSublayer(0,p.DepthMode.ReadOnly),mt=[p.mercatorXfromLng(Be.center.lng),p.mercatorYfromLat(Be.center.lat)],it=g.layout.get("text-variable-anchor"),St="globe"===Be.projection.name,Et=[],Tt=[0,-1,0];let mn=Tt;!St&&!Be.mercatorFromTransition||Ne||(mn=function(Rt){const Kt=Rt._camera.getWorldToCamera(Rt.worldSize,1),Nt=p.multiply([],Kt,Rt.globeMatrix);p.invert(Nt,Nt);const dn=[0,0,0],kt=[0,1,0,0];return p.transformMat4$1(kt,kt,Nt),dn[0]=kt[0],dn[1]=kt[1],dn[2]=kt[2],p.normalize(dn,dn),dn}(Be));for(const Rt of E){const Kt=l.getTile(Rt),Nt=Kt.getBucket(g);if(!Nt||"mercator"===Nt.projection.name&&St)continue;const dn=I?Nt.text:Nt.icon;if(!dn||Nt.fullyClipped||!dn.segments.get().length)continue;const kt=dn.programConfigurations.get(g.id),Jt=I||Nt.sdfIcons,un=I?Nt.textSizeData:Nt.iconSizeData,on=je||0!==Be.pitch,vn=p.evaluateSizeForZoom(un,Be.zoom);let nr,Tr,jn,fr,Rn=[0,0],ei=null;if(I)Tr=Kt.glyphAtlasTexture,jn=Re.LINEAR,nr=Kt.glyphAtlasTexture.size,Nt.iconsInText&&(Rn=Kt.imageAtlasTexture.size,ei=Kt.imageAtlasTexture,fr=on||v.options.rotating||v.options.zooming||"composite"===un.kind||"camera"===un.kind?Re.LINEAR:Re.NEAREST);else{const Nl=1!==g.layout.get("icon-size").constantOr(0)||Nt.iconsNeedLinear;Tr=Kt.imageAtlasTexture,jn=Jt||v.options.rotating||v.options.zooming||Nl||on?Re.LINEAR:Re.NEAREST,nr=Kt.imageAtlasTexture.size}const Jn="globe"===Nt.projection.name,ao=Jn?mn:Tt,Ro=Jn?p.globeToMercatorTransition(Be.zoom):0,Lo=$n(Rt,Nt.getProjection(),Be),wo=Be.calculatePixelsToTileUnitsMatrix(Kt),Ys=Ht(Lo,Kt.tileID.canonical,je,Ne,Be,Nt.getProjection(),wo),Na=v.terrain&&je&&oe?p.invert(p.create(),Ys):xu,cl=qo(Lo,Kt.tileID.canonical,je,Ne,Be,Nt.getProjection(),wo),ec=it&&Nt.hasTextData(),ls="none"!==g.layout.get("icon-text-fit")&&ec&&Nt.hasIconData();if(oe){const Nl=Be.elevation,tc=Nl?Nl.getAtTileOffsetFunc(Rt,Be.center.lat,Be.worldSize,Nt.getProjection()):null,uh=pu(Lo,Kt.tileID.canonical,je,Ne,Be,Nt.getProjection(),wo);gu(Nt,Lo,v,I,uh,cl,je,q,tc,Rt)}const Oo=oe||I&&it||ls,Zt=v.translatePosMatrix(Lo,Kt,A,O),Sr=Oo?xu:Ys,Cu=v.translatePosMatrix(cl,Kt,A,O,!0),rs=Nt.getProjection().createInversionMatrix(Be,Rt.canonical),No=[];v.terrainRenderModeElevated()&&je&&No.push("PITCH_WITH_MAP_TERRAIN"),Jn&&No.push("PROJECTION_GLOBE_VIEW"),Oo&&No.push("PROJECTED_POS_ON_VIEWPORT");const Sf=Jt&&0!==g.paint.get(I?"text-halo-width":"icon-halo-width").constantOr(1);let Ol;Ol=Jt?Nt.iconsInText?xf(un.kind,vn,Pe,je,v,Zt,Sr,Cu,nr,Rn,Rt,Ro,mt,rs,ao,Nt.getProjection()):Ds(un.kind,vn,Pe,je,v,Zt,Sr,Cu,I,nr,!0,Rt,Ro,mt,rs,ao,Nt.getProjection()):ih(un.kind,vn,Pe,je,v,Zt,Sr,Cu,I,nr,Rt,Ro,mt,rs,ao,Nt.getProjection());const ku={program:v.useProgram(zs(Jt,I,Nt),kt,No),buffers:dn,uniformValues:Ol,atlasTexture:Tr,atlasTextureIcon:ei,atlasInterpolation:jn,atlasInterpolationIcon:fr,isSDF:Jt,hasHalo:Sf,tile:Kt,labelPlaneMatrixInv:Na};if(Xe&&Nt.canOverlap){He=!0;const Nl=dn.segments.get();for(const tc of Nl)Et.push({segments:new p.SegmentVector([tc]),sortKey:tc.sortKey,state:ku})}else Et.push({segments:dn.segments,sortKey:0,state:ku})}He&&Et.sort((Rt,Kt)=>Rt.sortKey-Kt.sortKey);for(const Rt of Et){const Kt=Rt.state;if(v.terrain&&v.terrain.setupElevationDraw(Kt.tile,Kt.program,{useDepthForOcclusion:!St,labelPlaneMatrixInv:Kt.labelPlaneMatrixInv}),Ee.activeTexture.set(Re.TEXTURE0),Kt.atlasTexture.bind(Kt.atlasInterpolation,Re.CLAMP_TO_EDGE),Kt.atlasTextureIcon&&(Ee.activeTexture.set(Re.TEXTURE1),Kt.atlasTextureIcon&&Kt.atlasTextureIcon.bind(Kt.atlasInterpolationIcon,Re.CLAMP_TO_EDGE)),Kt.isSDF){const Nt=Kt.uniformValues;Kt.hasHalo&&(Nt.u_is_halo=1,wu(Kt.buffers,Rt.segments,g,v,Kt.program,gt,$,te,Nt)),Nt.u_is_halo=0}wu(Kt.buffers,Rt.segments,g,v,Kt.program,gt,$,te,Kt.uniformValues)}}function wu(v,l,g,E,I,A,O,k,U){const q=E.context,$=[v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer,v.globeExtVertexBuffer];I.draw(q,q.gl.TRIANGLES,A,O,k,p.CullFaceMode.disabled,U,g.id,v.layoutVertexBuffer,v.indexBuffer,l,g.paint,E.transform.zoom,v.programConfigurations.get(g.id),$)}function Fh(v,l,g,E,I,A,O){const k=v.context.gl,U=g.paint.get("fill-pattern"),q=U&&U.constantOr(1);let $,te,Ee,Re,Be;O?(te=q&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=k.LINES):(te=q?"fillPattern":"fill",$=k.TRIANGLES);for(const Ne of E){const je=l.getTile(Ne);if(q&&!je.patternsLoaded())continue;const oe=je.getBucket(g);if(!oe)continue;v.prepareDrawTile();const Pe=oe.programConfigurations.get(g.id),Xe=v.useProgram(te,Pe);q&&(v.context.activeTexture.set(k.TEXTURE0),je.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Pe.updatePaintBuffers());const He=U.constantOr(null);if(He&&je.imageAtlas){const mt=je.imageAtlas.patternPositions[He.toString()];mt&&Pe.setConstantPatternPositions(mt)}const gt=v.translatePosMatrix(Ne.projMatrix,je,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor"));if(O){Re=oe.indexBuffer2,Be=oe.segments2;const mt=v.terrain&&v.terrain.renderingToTexture?v.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];Ee="fillOutlinePattern"===te&&q?sl(gt,v,je,mt):jo(gt,mt)}else Re=oe.indexBuffer,Be=oe.segments,Ee=q?xa(gt,v,je):va(gt);v.prepareDrawProgram(v.context,Xe,Ne.toUnwrapped()),Xe.draw(v.context,$,I,v.stencilModeForClipping(Ne),A,p.CullFaceMode.disabled,Ee,g.id,oe.layoutVertexBuffer,Re,Be,g.paint,v.transform.zoom,Pe)}}function ul(v,l,g,E,I,A,O){const k=v.context,U=k.gl,q=v.transform,$=g.paint.get("fill-extrusion-pattern"),te=$.constantOr(1),Ee=g.paint.get("fill-extrusion-opacity"),Re=[g.paint.get("fill-extrusion-ambient-occlusion-intensity"),g.paint.get("fill-extrusion-ambient-occlusion-radius")],Be=g.layout.get("fill-extrusion-edge-radius"),Ne=Be>0&&!g.paint.get("fill-extrusion-rounded-roof"),je=Ne?0:Be,oe="globe"===q.projection.name?p.fillExtrusionHeightLift():0,Pe="globe"===q.projection.name,Xe=Pe?p.globeToMercatorTransition(q.zoom):0,He=[p.mercatorXfromLng(q.center.lng),p.mercatorYfromLat(q.center.lat)],gt=[];Pe&&gt.push("PROJECTION_GLOBE_VIEW"),Re[0]>0&&gt.push("FAUX_AO"),Ne&&gt.push("ZERO_ROOF_RADIUS");for(const mt of E){const it=l.getTile(mt),St=it.getBucket(g);if(!St||St.projection.name!==q.projection.name)continue;const Et=St.programConfigurations.get(g.id),Tt=v.useProgram(te?"fillExtrusionPattern":"fillExtrusion",Et,gt);if(v.terrain){const Jt=v.terrain;if(v.style.terrainSetForDrapingOnly())Jt.setupElevationDraw(it,Tt,{useMeterToDem:!0});else{if(!St.enableTerrain)continue;if(Jt.setupElevationDraw(it,Tt,{useMeterToDem:!0}),ll(k,l,mt,St,g,Jt),!St.centroidVertexBuffer){const un=Tt.attributes.a_centroid_pos;void 0!==un&&U.vertexAttrib2f(un,0,0)}}}te&&(v.context.activeTexture.set(U.TEXTURE0),it.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Et.updatePaintBuffers());const mn=$.constantOr(null);if(mn&&it.imageAtlas){const Jt=it.imageAtlas.patternPositions[mn.toString()];Jt&&Et.setConstantPatternPositions(Jt)}const Rt=v.translatePosMatrix(mt.projMatrix,it,g.paint.get("fill-extrusion-translate"),g.paint.get("fill-extrusion-translate-anchor")),Kt=q.projection.createInversionMatrix(q,mt.canonical),Nt=g.paint.get("fill-extrusion-vertical-gradient"),dn=te?hc(Rt,v,Nt,Ee,Re,je,mt,it,oe,Xe,He,Kt):Fs(Rt,v,Nt,Ee,Re,je,mt,oe,Xe,He,Kt);v.prepareDrawProgram(k,Tt,mt.toUnwrapped());const kt=[];v.terrain&&kt.push(St.centroidVertexBuffer),Pe&&kt.push(St.layoutVertexExtBuffer),Tt.draw(k,k.gl.TRIANGLES,I,A,O,p.CullFaceMode.backCCW,dn,g.id,St.layoutVertexBuffer,St.indexBuffer,St.segments,g.paint,v.transform.zoom,Et,kt)}}function ll(v,l,g,E,I,A){const O=[oe=>{let Pe=oe.canonical.x-1,Xe=oe.wrap;return Pe<0&&(Pe=(1<<oe.canonical.z)-1,Xe--),new p.OverscaledTileID(oe.overscaledZ,Xe,oe.canonical.z,Pe,oe.canonical.y)},oe=>{let Pe=oe.canonical.x+1,Xe=oe.wrap;return Pe===1<<oe.canonical.z&&(Pe=0,Xe++),new p.OverscaledTileID(oe.overscaledZ,Xe,oe.canonical.z,Pe,oe.canonical.y)},oe=>new p.OverscaledTileID(oe.overscaledZ,oe.wrap,oe.canonical.z,oe.canonical.x,(0===oe.canonical.y?1<<oe.canonical.z:oe.canonical.y)-1),oe=>new p.OverscaledTileID(oe.overscaledZ,oe.wrap,oe.canonical.z,oe.canonical.x,oe.canonical.y===(1<<oe.canonical.z)-1?0:oe.canonical.y+1)],k=oe=>{const Pe=l.getSource().minzoom,Xe=gt=>{const mt=l.getTileByID(gt);if(mt&&mt.hasData())return mt.getBucket(I)},He=[0,-1,1];for(const gt of He){if(oe.overscaledZ+gt<Pe)continue;const mt=Xe(oe.calculateScaledKey(oe.overscaledZ+gt));if(mt)return mt}},U=[0,0,0],q=(oe,Pe)=>(U[0]=Math.min(oe.min.y,Pe.min.y),U[1]=Math.max(oe.max.y,Pe.max.y),U[2]=p.EXTENT-Pe.min.x>oe.max.x?Pe.min.x-p.EXTENT:oe.max.x,U),$=(oe,Pe)=>(U[0]=Math.min(oe.min.x,Pe.min.x),U[1]=Math.max(oe.max.x,Pe.max.x),U[2]=p.EXTENT-Pe.min.y>oe.max.y?Pe.min.y-p.EXTENT:oe.max.y,U),te=[(oe,Pe)=>q(oe,Pe),(oe,Pe)=>q(Pe,oe),(oe,Pe)=>$(oe,Pe),(oe,Pe)=>$(Pe,oe)],Ee=new p.Point(0,0);let Re,Be,Ne;const je=(oe,Pe,Xe,He,gt)=>{const mt=[[He?Xe:oe,He?oe:Xe,0],[He?Xe:Pe,He?Pe:Xe,0]],it=gt<0?p.EXTENT+gt:gt,St=[He?it:(oe+Pe)/2,He?(oe+Pe)/2:it,0];return 0===Xe&&gt<0||0!==Xe&&gt>0?A.getForTilePoints(Ne,[St],!0,Be):mt.push(St),A.getForTilePoints(g,mt,!0,Re),Math.max(mt[0][2],mt[1][2],St[2])/A.exaggeration()};for(let oe=0;oe<4;oe++){const Pe=(oe<2?1:5)-oe,Xe=E.borders[oe];if(0===Xe.length)continue;const He=Ne=O[oe](g),gt=k(He);if(!(gt&&gt instanceof p.FillExtrusionBucket&&gt.enableTerrain)||E.borderDoneWithNeighborZ[oe]===gt.canonical.z&&gt.borderDoneWithNeighborZ[Pe]===E.canonical.z||(Be=A.findDEMTileFor(He),!Be||!Be.dem))continue;if(!Re){const Et=A.findDEMTileFor(g);if(!Et||!Et.dem)return;Re=Et}const mt=gt.borders[Pe];let it=0;const St=gt.borderDoneWithNeighborZ[Pe]!==E.canonical.z;if(E.canonical.z===gt.canonical.z){for(let Et=0;Et<Xe.length;Et++){const Tt=E.featuresOnBorder[Xe[Et]],mn=Tt.borders[oe];let Rt;for(;it<mt.length&&(Rt=gt.featuresOnBorder[mt[it]],!(Rt.borders[Pe][1]>mn[0]+3));)St&&gt.encodeCentroid(void 0,Rt,!1),it++;if(Rt&&it<mt.length){const Kt=it;let Nt=0;for(;!(Rt.borders[Pe][0]>mn[1]-3)&&(Nt++,++it!==mt.length);)Rt=gt.featuresOnBorder[mt[it]];if(Rt=gt.featuresOnBorder[mt[Kt]],Tt.intersectsCount()>1||Rt.intersectsCount()>1||1!==Nt){1!==Nt&&(it=Kt),E.encodeCentroid(void 0,Tt,!1),St&&gt.encodeCentroid(void 0,Rt,!1);continue}const dn=te[oe](Tt,Rt),kt=oe%2?p.EXTENT-1:0;Ee.x=je(dn[0],Math.min(p.EXTENT-1,dn[1]),kt,oe<2,dn[2]),Ee.y=0,E.encodeCentroid(Ee,Tt,!1),St&&gt.encodeCentroid(Ee,Rt,!1)}else E.encodeCentroid(void 0,Tt,!1)}E.borderDoneWithNeighborZ[oe]=gt.canonical.z,E.needsCentroidUpdate=!0,St&&(gt.borderDoneWithNeighborZ[Pe]=E.canonical.z,gt.needsCentroidUpdate=!0)}else{for(const Et of Xe)E.encodeCentroid(void 0,E.featuresOnBorder[Et],!1);if(St){for(const Et of mt)gt.encodeCentroid(void 0,gt.featuresOnBorder[Et],!1);gt.borderDoneWithNeighborZ[Pe]=E.canonical.z,gt.needsCentroidUpdate=!0}E.borderDoneWithNeighborZ[oe]=gt.canonical.z,E.needsCentroidUpdate=!0}}(E.needsCentroidUpdate||!E.centroidVertexBuffer&&0!==E.centroidVertexArray.length)&&E.uploadCentroid(v)}const Ws=new p.Color(1,0,0,1),Us=new p.Color(0,1,0,1),bu=new p.Color(0,0,1,1),aa=new p.Color(1,0,1,1),Kl=new p.Color(0,1,1,1);function Al(v,l,g){const E=v.context,I=v.transform,A=E.gl,O="globe"===I.projection.name,k=O?["PROJECTION_GLOBE_VIEW"]:null;let U=g.projMatrix;if(O&&p.globeToMercatorTransition(I.zoom)>0){const Tt=p.transitionTileAABBinECEF(g.canonical,I),mn=p.globeDenormalizeECEF(Tt);U=p.multiply(new Float32Array(16),I.globeMatrix,mn),p.multiply(U,I.projMatrix,U)}const q=v.useProgram("debug",null,k),$=l.getTileByID(g.key);v.terrain&&v.terrain.setupElevationDraw($,q);const te=p.DepthMode.disabled,Ee=p.StencilMode.disabled,Re=v.colorModeForRenderPass();E.activeTexture.set(A.TEXTURE0),v.emptyTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),O?$._makeGlobeTileDebugBuffers(v.context,I):$._makeDebugTileBoundsBuffers(v.context,I.projection);const Ne=$._tileDebugBuffer||v.debugBuffer,je=$._tileDebugIndexBuffer||v.debugIndexBuffer,oe=$._tileDebugSegments||v.debugSegments;q.draw(E,A.LINE_STRIP,te,Ee,Re,p.CullFaceMode.disabled,Bs(U,p.Color.red),"$debug",Ne,je,oe,null,null,null,[$._globeTileDebugBorderBuffer]);const Pe=$.latestRawTileData,Xe=Math.floor((Pe&&Pe.byteLength||0)/1024),He=l.getTile(g).tileSize,gt=512/Math.min(He,512)*(g.overscaledZ/I.zoom)*.5;let mt=g.canonical.toString();g.overscaledZ!==g.canonical.z&&(mt+=` => ${g.overscaledZ}`),mt+=` ${Xe}kb`,function(Tt,mn){Tt.initDebugOverlayCanvas();const Rt=Tt.debugOverlayCanvas,Kt=Tt.context.gl,Nt=Tt.debugOverlayCanvas.getContext("2d");Nt.clearRect(0,0,Rt.width,Rt.height),Nt.shadowColor="white",Nt.shadowBlur=2,Nt.lineWidth=1.5,Nt.strokeStyle="white",Nt.textBaseline="top",Nt.font="bold 36px Open Sans, sans-serif",Nt.fillText(mn,5,5),Nt.strokeText(mn,5,5),Tt.debugOverlayTexture.update(Rt),Tt.debugOverlayTexture.bind(Kt.LINEAR,Kt.CLAMP_TO_EDGE)}(v,mt);const it=$._tileDebugTextBuffer||v.debugBuffer,St=$._tileDebugTextIndexBuffer||v.quadTriangleIndexBuffer,Et=$._tileDebugTextSegments||v.debugSegments;q.draw(E,A.TRIANGLES,te,Ee,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,Bs(U,p.Color.transparent,gt),"$debug",it,St,Et,null,null,null,[$._globeTileDebugTextBuffer])}function Pl(v,l,g,E){yi(v,0,l+g/2,v.transform.width,g,E)}function mi(v,l,g,E){yi(v,l-g/2,0,g,v.transform.height,E)}function yi(v,l,g,E,I,A){const O=v.context,k=O.gl;k.enable(k.SCISSOR_TEST),k.scissor(l*p.exported.devicePixelRatio,g*p.exported.devicePixelRatio,E*p.exported.devicePixelRatio,I*p.exported.devicePixelRatio),O.clear({color:A}),k.disable(k.SCISSOR_TEST)}const Qr=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ho}=Qr;function us(v,l,g,E){v.emplaceBack(l,g,E)}class Ha{constructor(l){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,us(this.vertexArray,-1,-1,1),us(this.vertexArray,1,-1,1),us(this.vertexArray,-1,1,1),us(this.vertexArray,1,1,1),us(this.vertexArray,-1,-1,-1),us(this.vertexArray,1,-1,-1),us(this.vertexArray,-1,1,-1),us(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,ho),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function eo(v,l,g,E,I,A){const O=v.gl,k=l.paint.get("sky-atmosphere-color"),U=l.paint.get("sky-atmosphere-halo-color"),q=l.paint.get("sky-atmosphere-sun-intensity"),$={u_matrix_3f:p.fromMat4(p.create$1(),E),u_sun_direction:I,u_sun_intensity:q,u_color_tint_r:[(Be=k).r,Be.g,Be.b,Be.a],u_color_tint_m:[(Ne=U).r,Ne.g,Ne.b,Ne.a],u_luminance:5e-5};var Be,Ne;O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_CUBE_MAP_POSITIVE_X+A,l.skyboxTexture,0),g.draw(v,O.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,$,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const As=p.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class oh{constructor(l){const g=new p.StructArrayLayout5f20;g.emplaceBack(-1,1,1,0,0),g.emplaceBack(1,1,1,1,0),g.emplaceBack(1,-1,1,1,1),g.emplaceBack(-1,-1,1,0,1);const E=new p.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(g,As.members),this.indexBuffer=l.createIndexBuffer(E),this.segments=p.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const xo={symbol:function(v,l,g,E,I){if("translucent"!==v.renderPass)return;const A=p.StencilMode.disabled,O=v.colorModeForRenderPass();g.layout.get("text-variable-anchor")&&function(k,U,q,$,te,Ee,Re){const Be=U.transform,Ne="map"===te,je="map"===Ee;for(const oe of k){const Pe=$.getTile(oe),Xe=Pe.getBucket(q);if(!Xe||!Xe.text||!Xe.text.segments.get().length)continue;const He=p.evaluateSizeForZoom(Xe.textSizeData,Be.zoom),gt=$n(oe,Xe.getProjection(),Be),mt=Be.calculatePixelsToTileUnitsMatrix(Pe),it=Ht(gt,Pe.tileID.canonical,je,Ne,Be,Xe.getProjection(),mt),St="none"!==q.layout.get("icon-text-fit")&&Xe.hasIconData();if(He){const Et=Math.pow(2,Be.zoom-Pe.tileID.overscaledZ);Rc(Xe,Ne,je,Re,p.symbolSize,Be,it,oe,Et,He,St)}}}(E,v,g,l,g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),I),0!==g.paint.get("icon-opacity").constantOr(1)&&Ru(v,l,g,E,!1,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),g.layout.get("icon-rotation-alignment"),g.layout.get("icon-pitch-alignment"),g.layout.get("icon-keep-upright"),A,O),0!==g.paint.get("text-opacity").constantOr(1)&&Ru(v,l,g,E,!0,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),g.layout.get("text-keep-upright"),A,O),l.map.showCollisionBoxes&&(Wu(v,l,g,E,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),!0),Wu(v,l,g,E,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),!1))},circle:function(v,l,g,E){if("translucent"!==v.renderPass)return;const I=g.paint.get("circle-opacity"),A=g.paint.get("circle-stroke-width"),O=g.paint.get("circle-stroke-opacity"),k=void 0!==g.layout.get("circle-sort-key").constantOr(1);if(0===I.constantOr(1)&&(0===A.constantOr(1)||0===O.constantOr(1)))return;const U=v.context,q=U.gl,$=v.transform,te=v.depthModeForSublayer(0,p.DepthMode.ReadOnly),Ee=p.StencilMode.disabled,Re=v.colorModeForRenderPass(),Be="globe"===$.projection.name,Ne=[p.mercatorXfromLng($.center.lng),p.mercatorYfromLat($.center.lat)],je=[];for(let Pe=0;Pe<E.length;Pe++){const Xe=E[Pe],He=l.getTile(Xe),gt=He.getBucket(g);if(!gt||gt.projection.name!==$.projection.name)continue;const mt=gt.programConfigurations.get(g.id),it=Wr(g);Be&&it.push("PROJECTION_GLOBE_VIEW");const St=v.useProgram("circle",mt,it),Et=gt.layoutVertexBuffer,Tt=gt.globeExtVertexBuffer,mn=gt.indexBuffer,Rt=$.projection.createInversionMatrix($,Xe.canonical),Kt={programConfiguration:mt,program:St,layoutVertexBuffer:Et,globeExtVertexBuffer:Tt,indexBuffer:mn,uniformValues:$s(v,Xe,He,Rt,Ne,g),tile:He};if(k){const Nt=gt.segments.get();for(const dn of Nt)je.push({segments:new p.SegmentVector([dn]),sortKey:dn.sortKey,state:Kt})}else je.push({segments:gt.segments,sortKey:0,state:Kt})}k&&je.sort((Pe,Xe)=>Pe.sortKey-Xe.sortKey);const oe={useDepthForOcclusion:!Be};for(const Pe of je){const{programConfiguration:Xe,program:He,layoutVertexBuffer:gt,globeExtVertexBuffer:mt,indexBuffer:it,uniformValues:St,tile:Et}=Pe.state,Tt=Pe.segments;v.terrain&&v.terrain.setupElevationDraw(Et,He,oe),v.prepareDrawProgram(U,He,Et.tileID.toUnwrapped()),He.draw(U,q.TRIANGLES,te,Ee,Re,p.CullFaceMode.disabled,St,g.id,gt,it,Tt,g.paint,$.zoom,Xe,[mt])}},heatmap:function(v,l,g,E){if(0!==g.paint.get("heatmap-opacity"))if("offscreen"===v.renderPass){const I=v.context,A=I.gl,O=p.StencilMode.disabled,k=new p.ColorMode([A.ONE,A.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(Re,Be,Ne,je){const oe=Re.gl,Pe=Be.width*je,Xe=Be.height*je;Re.activeTexture.set(oe.TEXTURE1),Re.viewport.set([0,0,Pe,Xe]);let He=Ne.heatmapFbo;if(!He||He&&(He.width!==Pe||He.height!==Xe)){He&&He.destroy();const gt=oe.createTexture();oe.bindTexture(oe.TEXTURE_2D,gt),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_WRAP_S,oe.CLAMP_TO_EDGE),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_WRAP_T,oe.CLAMP_TO_EDGE),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_MIN_FILTER,oe.LINEAR),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_MAG_FILTER,oe.LINEAR),He=Ne.heatmapFbo=Re.createFramebuffer(Pe,Xe,!1),function(mt,it,St,Et,Tt,mn){const Rt=mt.gl;Rt.texImage2D(Rt.TEXTURE_2D,0,mt.isWebGL2&&mt.extRenderToTextureHalfFloat?Rt.RGBA16F:Rt.RGBA,Tt,mn,0,Rt.RGBA,mt.extRenderToTextureHalfFloat?mt.isWebGL2?Rt.HALF_FLOAT:mt.extTextureHalfFloat.HALF_FLOAT_OES:Rt.UNSIGNED_BYTE,null),Et.colorAttachment.set(St)}(Re,0,gt,He,Pe,Xe)}else oe.bindTexture(oe.TEXTURE_2D,He.colorAttachment.get()),Re.bindFramebuffer.set(He.framebuffer)})(I,v,g,"globe"===v.transform.projection.name?.5:.25),I.clear({color:p.Color.transparent});const U=v.transform,q="globe"===U.projection.name,$=q?["PROJECTION_GLOBE_VIEW"]:null,te=q?p.CullFaceMode.frontCCW:p.CullFaceMode.disabled,Ee=[p.mercatorXfromLng(U.center.lng),p.mercatorYfromLat(U.center.lat)];for(let Re=0;Re<E.length;Re++){const Be=E[Re];if(l.hasRenderableParent(Be))continue;const Ne=l.getTile(Be),je=Ne.getBucket(g);if(!je||je.projection.name!==U.projection.name)continue;const oe=je.programConfigurations.get(g.id),Pe=v.useProgram("heatmap",oe,$),{zoom:Xe}=v.transform;v.terrain&&v.terrain.setupElevationDraw(Ne,Pe),v.prepareDrawProgram(I,Pe,Be.toUnwrapped());const He=U.projection.createInversionMatrix(U,Be.canonical);Pe.draw(I,A.TRIANGLES,p.DepthMode.disabled,O,k,te,vu(v,Be,Ne,He,Ee,Xe,g.paint.get("heatmap-intensity")),g.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,g.paint,v.transform.zoom,oe,q?[je.globeExtVertexBuffer]:null)}I.viewport.set([0,0,v.width,v.height])}else"translucent"===v.renderPass&&(v.context.setColorMode(v.colorModeForRenderPass()),function(I,A){const O=I.context,k=O.gl,U=A.heatmapFbo;if(!U)return;O.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,U.colorAttachment.get()),O.activeTexture.set(k.TEXTURE1);let q=A.colorRampTexture;q||(q=A.colorRampTexture=new p.Texture(O,A.colorRamp,k.RGBA)),q.bind(k.LINEAR,k.CLAMP_TO_EDGE),I.useProgram("heatmapTexture").draw(O,k.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,I.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:A.paint.get("heatmap-opacity")},A.id,I.viewportBuffer,I.quadTriangleIndexBuffer,I.viewportSegments,A.paint,I.transform.zoom)}(v,g))},line:function(v,l,g,E){if("translucent"!==v.renderPass)return;const I=g.paint.get("line-opacity"),A=g.paint.get("line-width");if(0===I.constantOr(1)||0===A.constantOr(1))return;const O=v.depthModeForSublayer(0,p.DepthMode.ReadOnly),k=v.colorModeForRenderPass(),U=v.terrain&&v.terrain.renderingToTexture?1:p.exported.devicePixelRatio,q=g.paint.get("line-dasharray"),$=q.constantOr(1),te=g.layout.get("line-cap"),Ee=g.paint.get("line-pattern"),Re=Ee.constantOr(1),Be=g.paint.get("line-gradient"),Ne=Re?"linePattern":"line",je=v.context,oe=je.gl,Pe=(He=>{const gt=[];al(He)&&gt.push("RENDER_LINE_DASH"),He.paint.get("line-gradient")&&gt.push("RENDER_LINE_GRADIENT");const mt=He.paint.get("line-trim-offset");0===mt[0]&&0===mt[1]||gt.push("RENDER_LINE_TRIM_OFFSET");const it=He.paint.get("line-pattern").constantOr(1),St=1!==He.paint.get("line-opacity").constantOr(1);return!it&&St&&gt.push("RENDER_LINE_ALPHA_DISCARD"),gt})(g);let Xe=Pe.includes("RENDER_LINE_ALPHA_DISCARD");v.terrain&&v.terrain.clipOrMaskOverlapStencilType()&&(Xe=!1);for(const He of E){const gt=l.getTile(He);if(Re&&!gt.patternsLoaded())continue;const mt=gt.getBucket(g);if(!mt)continue;v.prepareDrawTile();const it=mt.programConfigurations.get(g.id),St=v.useProgram(Ne,it,Pe),Et=Ee.constantOr(null);if(Et&&gt.imageAtlas){const Jt=gt.imageAtlas.patternPositions[Et.toString()];Jt&&it.setConstantPatternPositions(Jt)}const Tt=q.constantOr(null),mn=te.constantOr(null);if(!Re&&Tt&&mn&&gt.lineAtlas){const Jt=gt.lineAtlas.getDash(Tt,mn);Jt&&it.setConstantPatternPositions(Jt)}let[Rt,Kt]=g.paint.get("line-trim-offset");("round"===mn||"square"===mn)&&Rt!==Kt&&(0===Rt&&(Rt-=1),1===Kt&&(Kt+=1));const Nt=v.terrain?He.projMatrix:null,dn=Re?sa(v,gt,g,Nt,U):Aa(v,gt,g,Nt,mt.lineClipsArray.length,U,[Rt,Kt]);if(Be){const Jt=mt.gradients[g.id];let un=Jt.texture;if(g.gradientVersion!==Jt.version){let on=256;if(g.stepInterpolant){const vn=l.getSource().maxzoom,nr=He.canonical.z===vn?Math.ceil(1<<v.transform.maxZoom-He.canonical.z):1;on=p.clamp(p.nextPowerOfTwo(mt.maxLineLength/p.EXTENT*1024*nr),256,je.maxTextureSize)}Jt.gradient=p.renderColorRamp({expression:g.gradientExpression(),evaluationKey:"lineProgress",resolution:on,image:Jt.gradient||void 0,clips:mt.lineClipsArray}),Jt.texture?Jt.texture.update(Jt.gradient):Jt.texture=new p.Texture(je,Jt.gradient,oe.RGBA),Jt.version=g.gradientVersion,un=Jt.texture}je.activeTexture.set(oe.TEXTURE1),un.bind(g.stepInterpolant?oe.NEAREST:oe.LINEAR,oe.CLAMP_TO_EDGE)}$&&(je.activeTexture.set(oe.TEXTURE0),gt.lineAtlasTexture.bind(oe.LINEAR,oe.REPEAT),it.updatePaintBuffers()),Re&&(je.activeTexture.set(oe.TEXTURE0),gt.imageAtlasTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE),it.updatePaintBuffers()),v.prepareDrawProgram(je,St,He.toUnwrapped());const kt=Jt=>{St.draw(je,oe.TRIANGLES,O,Jt,k,p.CullFaceMode.disabled,dn,g.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,g.paint,v.transform.zoom,it,[mt.layoutVertexBuffer2])};if(Xe){const Jt=v.stencilModeForClipping(He).ref;0===Jt&&v.terrain&&je.clear({stencil:0});const un={func:oe.EQUAL,mask:255};dn.u_alpha_discard_threshold=.8,kt(new p.StencilMode(un,Jt,255,oe.KEEP,oe.KEEP,oe.INVERT)),dn.u_alpha_discard_threshold=0,kt(new p.StencilMode(un,Jt,255,oe.KEEP,oe.KEEP,oe.KEEP))}else kt(v.stencilModeForClipping(He))}Xe&&(v.resetStencilClippingMasks(),v.terrain&&je.clear({stencil:0}))},fill:function(v,l,g,E){const I=g.paint.get("fill-color"),A=g.paint.get("fill-opacity");if(0===A.constantOr(1))return;const O=v.colorModeForRenderPass(),k=g.paint.get("fill-pattern"),U=v.opaquePassEnabledForLayer()&&!k.constantOr(1)&&1===I.constantOr(p.Color.transparent).a&&1===A.constantOr(0)?"opaque":"translucent";if(v.renderPass===U){const q=v.depthModeForSublayer(1,"opaque"===v.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);Fh(v,l,g,E,q,O,!1)}if("translucent"===v.renderPass&&g.paint.get("fill-antialias")){const q=v.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);Fh(v,l,g,E,q,O,!0)}},"fill-extrusion":function(v,l,g,E){const I=g.paint.get("fill-extrusion-opacity");if(0!==I&&"translucent"===v.renderPass){const A=new p.DepthMode(v.context.gl.LEQUAL,p.DepthMode.ReadWrite,v.depthRangeFor3D);if(1!==I||g.paint.get("fill-extrusion-pattern").constantOr(1))ul(v,l,g,E,A,p.StencilMode.disabled,p.ColorMode.disabled),ul(v,l,g,E,A,v.stencilModeFor3D(),v.colorModeForRenderPass()),v.resetStencilClippingMasks();else{const O=v.colorModeForRenderPass();ul(v,l,g,E,A,p.StencilMode.disabled,O)}}},hillshade:function(v,l,g,E){if("offscreen"!==v.renderPass&&"translucent"!==v.renderPass)return;const I=v.context,A=v.depthModeForSublayer(0,p.DepthMode.ReadOnly),O=v.colorModeForRenderPass(),k=v.terrain&&v.terrain.renderingToTexture,[U,q]="translucent"!==v.renderPass||k?[{},E]:v.stencilConfigForOverlap(E);for(const $ of q){const te=l.getTile($);if(te.needsHillshadePrepare&&"offscreen"===v.renderPass)nh(v,te,g,A,p.StencilMode.disabled,O);else if("translucent"===v.renderPass){const Ee=k&&v.terrain?v.terrain.stencilModeForRTTOverlap($):U[$.overscaledZ];di(v,$,te,g,A,Ee,O)}}I.viewport.set([0,0,v.width,v.height]),v.resetStencilClippingMasks()},raster:function(v,l,g,E,I,A){if("translucent"!==v.renderPass||0===g.paint.get("raster-opacity")||!E.length)return;const O=v.context,k=O.gl,U=l.getSource(),q=v.useProgram("raster"),$=v.colorModeForRenderPass(),te=v.terrain&&v.terrain.renderingToTexture,[Ee,Re]=U instanceof Ur||te?[{},E]:v.stencilConfigForOverlap(E),Be=Re[Re.length-1].overscaledZ,Ne=!v.options.moving;for(const je of Re){const oe=te?p.DepthMode.disabled:v.depthModeForSublayer(je.overscaledZ-Be,1===g.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,k.LESS),Pe=je.toUnwrapped(),Xe=l.getTile(je);if(te&&(!Xe||!Xe.hasData()))continue;const He=te?je.projMatrix:v.transform.calculateProjMatrix(Pe,Ne),gt=v.terrain&&te?v.terrain.stencilModeForRTTOverlap(je):Ee[je.overscaledZ],mt=A?0:g.paint.get("raster-fade-duration");Xe.registerFadeDuration(mt);const it=l.findLoadedParent(je,0),St=Dl(Xe,it,l,v.transform,mt);let Et,Tt;v.terrain&&v.terrain.prepareDrawTile();const mn="nearest"===g.paint.get("raster-resampling")?k.NEAREST:k.LINEAR;O.activeTexture.set(k.TEXTURE0),Xe.texture.bind(mn,k.CLAMP_TO_EDGE),O.activeTexture.set(k.TEXTURE1),it?(it.texture.bind(mn,k.CLAMP_TO_EDGE),Et=Math.pow(2,it.tileID.overscaledZ-Xe.tileID.overscaledZ),Tt=[Xe.tileID.canonical.x*Et%1,Xe.tileID.canonical.y*Et%1]):Xe.texture.bind(mn,k.CLAMP_TO_EDGE),Xe.texture.useMipmap&&O.extTextureFilterAnisotropic&&v.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax);const Rt=Ms(He,Tt||[0,0],Et||1,St,g,U instanceof Ur?U.perspectiveTransform:[0,0]);if(v.prepareDrawProgram(O,q,Pe),U instanceof Ur)U.boundsBuffer&&U.boundsSegments&&q.draw(O,k.TRIANGLES,oe,p.StencilMode.disabled,$,p.CullFaceMode.disabled,Rt,g.id,U.boundsBuffer,v.quadTriangleIndexBuffer,U.boundsSegments);else{const{tileBoundsBuffer:Kt,tileBoundsIndexBuffer:Nt,tileBoundsSegments:dn}=v.getTileBoundsBuffers(Xe);q.draw(O,k.TRIANGLES,oe,gt,$,p.CullFaceMode.disabled,Rt,g.id,Kt,Nt,dn)}}v.resetStencilClippingMasks()},background:function(v,l,g,E){const I=g.paint.get("background-color"),A=g.paint.get("background-opacity");if(0===A)return;const O=v.context,k=O.gl,U=v.transform,q=U.tileSize,$=g.paint.get("background-pattern");if(v.isPatternMissing($))return;const te=!$&&1===I.a&&1===A&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==te)return;const Ee=p.StencilMode.disabled,Re=v.depthModeForSublayer(0,"opaque"===te?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),Be=v.colorModeForRenderPass(),Ne=v.useProgram($?"backgroundPattern":"background");let je,oe=E;oe||(je=v.getBackgroundTiles(),oe=Object.values(je).map(Pe=>Pe.tileID)),$&&(O.activeTexture.set(k.TEXTURE0),v.imageManager.bind(v.context));for(const Pe of oe){const Xe=Pe.toUnwrapped(),He=E?Pe.projMatrix:v.transform.calculateProjMatrix(Xe);v.prepareDrawTile();const gt=l?l.getTile(Pe):je?je[Pe.key]:new p.Tile(Pe,q,U.zoom,v),mt=$?Pc(He,A,v,$,{tileID:Pe,tileSize:q}):Yl(He,A,I);v.prepareDrawProgram(O,Ne,Xe);const{tileBoundsBuffer:it,tileBoundsIndexBuffer:St,tileBoundsSegments:Et}=v.getTileBoundsBuffers(gt);Ne.draw(O,k.TRIANGLES,Re,Ee,Be,p.CullFaceMode.disabled,mt,g.id,it,St,Et)}},sky:function(v,l,g){const E=v.transform,I="mercator"===E.projection.name||"globe"===E.projection.name?1:p.smoothstep(7,8,E.zoom),A=g.paint.get("sky-opacity")*I;if(0===A)return;const O=v.context,k=g.paint.get("sky-type"),U=new p.DepthMode(O.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),q=v.frameCounter/1e3%1;"atmosphere"===k?"offscreen"===v.renderPass?g.needsSkyboxCapture(v)&&(function($,te,Ee,Re){const Be=$.context,Ne=Be.gl;let je=te.skyboxFbo;if(!je){je=te.skyboxFbo=Be.createFramebuffer(32,32,!1),te.skyboxGeometry=new Ha(Be),te.skyboxTexture=Be.gl.createTexture(),Ne.bindTexture(Ne.TEXTURE_CUBE_MAP,te.skyboxTexture),Ne.texParameteri(Ne.TEXTURE_CUBE_MAP,Ne.TEXTURE_WRAP_S,Ne.CLAMP_TO_EDGE),Ne.texParameteri(Ne.TEXTURE_CUBE_MAP,Ne.TEXTURE_WRAP_T,Ne.CLAMP_TO_EDGE),Ne.texParameteri(Ne.TEXTURE_CUBE_MAP,Ne.TEXTURE_MIN_FILTER,Ne.LINEAR),Ne.texParameteri(Ne.TEXTURE_CUBE_MAP,Ne.TEXTURE_MAG_FILTER,Ne.LINEAR);for(let He=0;He<6;++He)Ne.texImage2D(Ne.TEXTURE_CUBE_MAP_POSITIVE_X+He,0,Ne.RGBA,32,32,0,Ne.RGBA,Ne.UNSIGNED_BYTE,null)}Be.bindFramebuffer.set(je.framebuffer),Be.viewport.set([0,0,32,32]);const oe=te.getCenter($,!0),Pe=$.useProgram("skyboxCapture"),Xe=new Float64Array(16);p.identity(Xe),p.rotateY(Xe,Xe,.5*-Math.PI),eo(Be,te,Pe,Xe,oe,0),p.identity(Xe),p.rotateY(Xe,Xe,.5*Math.PI),eo(Be,te,Pe,Xe,oe,1),p.identity(Xe),p.rotateX(Xe,Xe,.5*-Math.PI),eo(Be,te,Pe,Xe,oe,2),p.identity(Xe),p.rotateX(Xe,Xe,.5*Math.PI),eo(Be,te,Pe,Xe,oe,3),p.identity(Xe),eo(Be,te,Pe,Xe,oe,4),p.identity(Xe),p.rotateY(Xe,Xe,Math.PI),eo(Be,te,Pe,Xe,oe,5),Be.viewport.set([0,0,$.width,$.height])}(v,g),g.markSkyboxValid(v)):"sky"===v.renderPass&&function($,te,Ee,Re,Be){const Ne=$.context,je=Ne.gl,oe=$.transform,Pe=$.useProgram("skybox");Ne.activeTexture.set(je.TEXTURE0),je.bindTexture(je.TEXTURE_CUBE_MAP,te.skyboxTexture);const Xe={u_matrix:oe.skyboxMatrix,u_sun_direction:te.getCenter($,!1),u_cubemap:0,u_opacity:Re,u_temporal_offset:Be};$.prepareDrawProgram(Ne,Pe),Pe.draw(Ne,je.TRIANGLES,Ee,p.StencilMode.disabled,$.colorModeForRenderPass(),p.CullFaceMode.backCW,Xe,"skybox",te.skyboxGeometry.vertexBuffer,te.skyboxGeometry.indexBuffer,te.skyboxGeometry.segment)}(v,g,U,A,q):"gradient"===k&&"sky"===v.renderPass&&function($,te,Ee,Re,Be){const Ne=$.context,je=Ne.gl,oe=$.transform,Pe=$.useProgram("skyboxGradient");te.skyboxGeometry||(te.skyboxGeometry=new Ha(Ne)),Ne.activeTexture.set(je.TEXTURE0);let Xe=te.colorRampTexture;Xe||(Xe=te.colorRampTexture=new p.Texture(Ne,te.colorRamp,je.RGBA)),Xe.bind(je.LINEAR,je.CLAMP_TO_EDGE);const He=(gt=oe.skyboxMatrix,mt=te.getCenter($,!1),it=te.paint.get("sky-gradient-radius"),St=Re,Et=Be,{u_matrix:gt,u_color_ramp:0,u_center_direction:mt,u_radius:p.degToRad(it),u_opacity:St,u_temporal_offset:Et});var gt,mt,it,St,Et;$.prepareDrawProgram(Ne,Pe),Pe.draw(Ne,je.TRIANGLES,Ee,p.StencilMode.disabled,$.colorModeForRenderPass(),p.CullFaceMode.backCW,He,"skyboxGradient",te.skyboxGeometry.vertexBuffer,te.skyboxGeometry.indexBuffer,te.skyboxGeometry.segment)}(v,g,U,A,q)},debug:function(v,l,g){for(let E=0;E<g.length;E++)Al(v,l,g[E])},custom:function(v,l,g,E){const I=v.context,A=g.implementation;if(!v.transform.projection.unsupportedLayers||!v.transform.projection.unsupportedLayers.includes("custom")||v.terrain&&(v.terrain.renderingToTexture||"offscreen"===v.renderPass)&&g.isLayerDraped()){if("offscreen"===v.renderPass){const O=A.prerender;if(O){if(v.setCustomLayerDefaults(),I.setColorMode(v.colorModeForRenderPass()),"globe"===v.transform.projection.name){const k=v.transform.pointMerc;O.call(A,I.gl,v.transform.customLayerMatrix(),v.transform.getProjection(),v.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(v.transform.zoom),[k.x,k.y],v.transform.pixelsPerMeterRatio)}else O.call(A,I.gl,v.transform.customLayerMatrix());I.setDirty(),v.setBaseState()}}else if("translucent"===v.renderPass){if(v.terrain&&v.terrain.renderingToTexture){const k=A.renderToTile;if(k){const U=E[0].canonical,q=new p.MercatorCoordinate(U.x+E[0].wrap*(1<<U.z),U.y,U.z);I.setDepthMode(p.DepthMode.disabled),I.setStencilMode(p.StencilMode.disabled),I.setColorMode(v.colorModeForRenderPass()),v.setCustomLayerDefaults(),k.call(A,I.gl,q),I.setDirty(),v.setBaseState()}return}v.setCustomLayerDefaults(),I.setColorMode(v.colorModeForRenderPass()),I.setStencilMode(p.StencilMode.disabled);const O="3d"===A.renderingMode?new p.DepthMode(v.context.gl.LEQUAL,p.DepthMode.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,p.DepthMode.ReadOnly);if(I.setDepthMode(O),"globe"===v.transform.projection.name){const k=v.transform.pointMerc;A.render(I.gl,v.transform.customLayerMatrix(),v.transform.getProjection(),v.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(v.transform.zoom),[k.x,k.y],v.transform.pixelsPerMeterRatio)}else A.render(I.gl,v.transform.customLayerMatrix());I.setDirty(),v.setBaseState(),I.bindFramebuffer.set(null)}}else p.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Jl{constructor(l,g,E=!1){this.context=new hn(l,E),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(l,g){const E=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(E||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ol(this,l));const I=this._terrain;this.transform.elevation=E?I:null,I.update(l,this.transform,g)}_updateFog(l){const g=l.fog;if(!g||"globe"===this.transform.projection.name||g.getOpacity(this.transform.pitch)<1||g.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[E,I]=g.getFovAdjustedRange(this.transform._fov);if(E>I)return void(this.transform.fogCullDistSq=null);const A=E+.78*(I-E);this.transform.fogCullDistSq=A*A}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(l,g){if(this.width=l*p.exported.devicePixelRatio,this.height=g*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const E of this.style.order)this.style._layers[E].resize()}setup(){const l=this.context,g=new p.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(p.EXTENT,0),g.emplaceBack(0,p.EXTENT),g.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(g,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const E=new p.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(p.EXTENT,0),E.emplaceBack(0,p.EXTENT),E.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=l.createVertexBuffer(E,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const I=new p.StructArrayLayout2i4;I.emplaceBack(-1,-1),I.emplaceBack(1,-1),I.emplaceBack(-1,1),I.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(I,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const A=new p.StructArrayLayout4i8;A.emplaceBack(0,0,0,0),A.emplaceBack(p.EXTENT,0,p.EXTENT,0),A.emplaceBack(0,p.EXTENT,0,p.EXTENT),A.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=l.createVertexBuffer(A,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const O=new p.StructArrayLayout3ui6;O.emplaceBack(0,1,2),O.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(O);const k=new p.StructArrayLayout1ui2;for(const q of[0,1,3,2,0])k.emplaceBack(q);this.debugIndexBuffer=l.createIndexBuffer(k),this.emptyTexture=new p.Texture(l,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=p.create();const U=this.context.gl;this.stencilClearMode=new p.StencilMode({func:U.ALWAYS,mask:0},0,255,U.ZERO,U.ZERO,U.ZERO),this.loadTimeStamps.push(p.window.performance.now()),this.atmosphereBuffer=new oh(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context,g=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(l,g.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,Dr(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,g,E){if(!g||this.currentStencilSource===g.id||!l.isTileClipped()||!E||0===E.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const U of E)if(void 0===this._tileClippingMaskIDs[U.key]){k=!0;break}if(!k)return}this.currentStencilSource=g.id;const I=this.context,A=I.gl;this.nextStencilID+E.length>256&&this.clearStencil(),I.setColorMode(p.ColorMode.disabled),I.setDepthMode(p.DepthMode.disabled);const O=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of E){const U=g.getTile(k),q=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:$,tileBoundsIndexBuffer:te,tileBoundsSegments:Ee}=this.getTileBoundsBuffers(U);O.draw(I,A.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:A.ALWAYS,mask:0},q,255,A.KEEP,A.KEEP,A.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,Dr(k.projMatrix),"$clipping",$,te,Ee)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,g=this.context.gl;return new p.StencilMode({func:g.NOTEQUAL,mask:255},l,255,g.KEEP,g.KEEP,g.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const g=this.context.gl;return new p.StencilMode({func:g.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,g.KEEP,g.KEEP,g.REPLACE)}stencilConfigForOverlap(l){const g=this.context.gl,E=l.sort((O,k)=>k.overscaledZ-O.overscaledZ),I=E[E.length-1].overscaledZ,A=E[0].overscaledZ-I+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();const O={};for(let k=0;k<A;k++)O[k+I]=new p.StencilMode({func:g.GEQUAL,mask:255},k+this.nextStencilID,255,g.KEEP,g.KEEP,g.REPLACE);return this.nextStencilID+=A,[O,E]}return[{[I]:p.StencilMode.disabled},E]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([l.CONSTANT_COLOR,l.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(l,g,E){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const I=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new p.DepthMode(E||this.context.gl.LEQUAL,g,[I,I])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,g){this.style=l,this.options=g,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const E=this.style.order,I=this.style._sourceCaches;for(const q in I){const $=I[q];$.used&&$.prepare(this.context)}const A={},O={},k={};for(const q in I){const $=I[q];A[q]=$.getVisibleCoordinates(),O[q]=A[q].slice().reverse(),k[q]=$.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let q=0;q<E.length;q++)if(this.style._layers[E[q]].is3D()){this.opaquePassCutoff=q;break}if(this.terrain&&(this.terrain.updateTileBinding(k),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const q of E){const $=this.style._layers[q],te=l._getLayerSourceCache($);if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;const Ee=te?O[te.id]:void 0;("custom"===$.type||$.isSky()||Ee&&Ee.length)&&this.renderLayer(this,te,$,Ee)}this.depthRangeFor3D=[0,1-(l.order.length+2)*this.numSublayers*this.depthEpsilon];const U=this.terrain;if(U&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&U.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:g.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=g.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=E.length-1;this.currentLayer>=0;this.currentLayer--){const q=this.style._layers[E[this.currentLayer]],$=l._getLayerSourceCache(q);if(q.isSky())continue;const te=$?O[$.id]:void 0;this._renderTileClippingMasks(q,$,te),this.renderLayer(this,$,q,te)}if(this.style.fog&&this.transform.projection.supportsFog&&function(q,$){const te=q.context,Ee=te.gl,Re=q.transform,Be=new p.DepthMode(Ee.LEQUAL,p.DepthMode.ReadOnly,[0,1]),Ne=q.useProgram("globeAtmosphere",null,"globe"===Re.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),je=p.globeToMercatorTransition(Re.zoom),oe=$.properties.get("color").toArray01(),Pe=$.properties.get("high-color").toArray01(),Xe=$.properties.get("space-color").toArray01PremultipliedAlpha(),He=p.identity$1([]);p.rotateY$1(He,He,-p.degToRad(Re._center.lng)),p.rotateX$1(He,He,p.degToRad(Re._center.lat)),p.rotateZ$1(He,He,Re.angle),p.rotateX$1(He,He,-Re._pitch);const gt=p.fromQuat(new Float32Array(16),He),mt=p.mapValue($.properties.get("star-intensity"),0,1,0,.25),St=p.mapValue($.properties.get("horizon-blend"),0,1,5e-4,.25),Et=p.globeUseCustomAntiAliasing(q,te,Re)&&5e-4===St?Re.worldSize/(2*Math.PI*1.025)-1:Re.globeRadius,Tt=q.frameCounter/1e3%1,mn=p.length(Re.globeCenterInViewSpace),Rt=Math.sqrt(Math.pow(mn,2)-Math.pow(Et,2)),Kt=Math.acos(Rt/mn),Nt={u_frustum_tl:Re.frustumCorners.TL,u_frustum_tr:Re.frustumCorners.TR,u_frustum_br:Re.frustumCorners.BR,u_frustum_bl:Re.frustumCorners.BL,u_horizon:Re.frustumCorners.horizon,u_transition:je,u_fadeout_range:St,u_color:oe,u_high_color:Pe,u_space_color:Xe,u_star_intensity:mt,u_star_size:5*p.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Tt,u_horizon_angle:Kt,u_rotation_matrix:gt};q.prepareDrawProgram(te,Ne);const dn=q.atmosphereBuffer;dn&&Ne.draw(te,Ee.TRIANGLES,Be,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,Nt,"skybox",dn.vertexBuffer,dn.indexBuffer,dn.segments)}(this,this.style.fog),this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<E.length;this.currentLayer++){const q=this.style._layers[E[this.currentLayer]],$=l._getLayerSourceCache(q);q.isSky()&&this.renderLayer(this,$,q,$?O[$.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<E.length;){const q=this.style._layers[E[this.currentLayer]],$=l._getLayerSourceCache(q);if(q.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(q)){if(q.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const te=$?("symbol"===q.type?k:O)[$.id]:void 0;this._renderTileClippingMasks(q,$,$?A[$.id]:void 0),this.renderLayer(this,$,q,te),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let q=null;p.values(this.style._layers).forEach($=>{const te=l._getLayerSourceCache($);te&&!$.isHidden(this.transform.zoom)&&(!q||q.getSource().maxzoom<te.getSource().maxzoom)&&(q=te)}),q&&this.options.showTileBoundaries&&xo.debug(this,q,q.getVisibleCoordinates())}this.options.showPadding&&function(q){const $=q.transform.padding;Pl(q,q.transform.height-($.top||0),3,Ws),Pl(q,$.bottom||0,3,Us),mi(q,$.left||0,3,bu),mi(q,q.transform.width-($.right||0),3,aa);const te=q.transform.centerPoint;var Ee,Re,Be,Ne;yi(Ee=q,(Re=te.x)-1,(Be=q.transform.height-te.y)-10,2,20,Ne=Kl),yi(Ee,Re-10,Be-1,20,2,Ne)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(l,g,E,I){E.isHidden(this.transform.zoom)||("background"===E.type||"sky"===E.type||"custom"===E.type||I&&I.length)&&(this.id=E.id,this.gpuTimingStart(E),(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes(E.type)||l.terrain&&"custom"===E.type)&&xo[E.type](l,g,E,I,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const g=this.context.extTimerQuery;let E=this.gpuTimers[l.id];E||(E=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:g.createQueryEXT()}),E.calls++,g.beginQueryEXT(g.TIME_ELAPSED_EXT,E.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,g=l.createQueryEXT();this.deferredRenderGpuTimeQueries.push(g),l.beginQueryEXT(l.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const g={};for(const E in l){const I=l[E],A=this.context.extTimerQuery,O=A.getQueryObjectEXT(I.query,A.QUERY_RESULT_EXT)/1e6;A.deleteQueryEXT(I.query),g[E]=O}return g}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const g=this.context.extTimerQuery;let E=0;for(const I of l)E+=g.getQueryObjectEXT(I,g.QUERY_RESULT_EXT)/1e6,g.deleteQueryEXT(I);return E}translatePosMatrix(l,g,E,I,A){if(!E[0]&&!E[1])return l;const O=A?"map"===I?this.transform.angle:0:"viewport"===I?-this.transform.angle:0;if(O){const q=Math.sin(O),$=Math.cos(O);E=[E[0]*$-E[1]*q,E[0]*q+E[1]*$]}const k=[A?E[0]:at(g,E[0],this.transform.zoom),A?E[1]:at(g,E[1],this.transform.zoom),0],U=new Float32Array(16);return p.translate(U,l,k),U}saveTileTexture(l){const g=this._tileTextures[l.size[0]];g?g.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const g=this._tileTextures[l];return g&&g.length>0?g.pop():null}isPatternMissing(l){return null===l||void 0!==l&&!this.imageManager.getPattern(l.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const l=this.terrain&&this.terrain.renderingToTexture,g=this.terrain&&0===this.terrain.exaggeration(),E=this.style&&this.style.fog,I=[];return this.terrainRenderModeElevated()&&I.push("TERRAIN"),"globe"===this.transform.projection.name&&I.push("GLOBE"),g&&I.push("ZERO_EXAGGERATION"),E&&!l&&0!==E.getOpacity(this.transform.pitch)&&I.push("FOG"),l&&I.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&I.push("OVERDRAW_INSPECTOR"),I}useProgram(l,g,E){this.cache=this.cache||{};const I=E||[],A=this.currentGlobalDefines().concat(I),O=In.cacheKey(vo[l],l,A,g);return this.cache[O]||(this.cache[O]=new In(this.context,l,vo[l],g,kh[l],A)),this.cache[O]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(l,g,E){if(this.terrain&&this.terrain.renderingToTexture)return;const I=this.style.fog;if(I){const A=I.getOpacity(this.transform.pitch),O=((k,U,q,$,te,Ee,Re,Be,Ne,je,oe)=>{const Pe=k.transform,Xe=U.properties.get("color").toArray01();Xe[3]=$;const He=k.frameCounter/1e3%1;return{u_fog_matrix:q?Pe.calculateFogTileMatrix(q):k.identityMat,u_fog_range:U.getFovAdjustedRange(Pe._fov),u_fog_color:Xe,u_fog_horizon_blend:U.properties.get("horizon-blend"),u_fog_temporal_offset:He,u_frustum_tl:te,u_frustum_tr:Ee,u_frustum_br:Re,u_frustum_bl:Be,u_globe_pos:Ne,u_globe_radius:je,u_viewport:oe,u_globe_transition:p.globeToMercatorTransition(Pe.zoom),u_is_globe:+("globe"===Pe.projection.name)}})(this,I,E,A,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.exported.devicePixelRatio,this.transform.height*p.exported.devicePixelRatio]);g.setFogUniformValues(l,O)}}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,g=l.createTexture();return l.bindTexture(l.TEXTURE_2D,g),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),g}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&0!==l.getOpacity(this.transform.pitch)}getBackgroundTiles(){const l=this._backgroundTiles,g=this._backgroundTiles={},E=this.transform.coveringTiles({tileSize:512});for(const I of E)g[I.key]=l[I.key]||new p.Tile(I,512,this.transform.tileZoom,this);return g}clearBackgroundTiles(){this._backgroundTiles={}}}class Wa{constructor(l=0,g=0,E=0,I=0){if(isNaN(l)||l<0||isNaN(g)||g<0||isNaN(E)||E<0||isNaN(I)||I<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=g,this.left=E,this.right=I}interpolate(l,g,E){return null!=g.top&&null!=l.top&&(this.top=p.number(l.top,g.top,E)),null!=g.bottom&&null!=l.bottom&&(this.bottom=p.number(l.bottom,g.bottom,E)),null!=g.left&&null!=l.left&&(this.left=p.number(l.left,g.left,E)),null!=g.right&&null!=l.right&&(this.right=p.number(l.right,g.right,E)),this}getCenter(l,g){const E=p.clamp((this.left+l-this.right)/2,0,l),I=p.clamp((this.top+g-this.bottom)/2,0,g);return new p.Point(E,I)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new Wa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ii(v,l){const g=p.getColumn(v,3);p.fromQuat(v,l),p.setColumn(v,3,g)}function an(v,l){const g=p.identity$1([]);return p.rotateZ$1(g,g,-l),p.rotateX$1(g,g,-v),g}function vr(v,l){const g=[v[0],v[1],0],E=[l[0],l[1],0];if(p.length(g)>=1e-15){const O=p.normalize([],g);p.scale$2(E,O,p.dot(E,O)),l[0]=E[0],l[1]=E[1]}const I=p.cross([],l,v);if(p.len(I)<1e-15)return null;const A=Math.atan2(-I[1],I[0]);return an(Math.atan2(Math.sqrt(v[0]*v[0]+v[1]*v[1]),-v[2]),A)}class fo{constructor(l,g){this.position=l,this.orientation=g}get position(){return this._position}set position(l){if(l){const g=l instanceof p.MercatorCoordinate?l:new p.MercatorCoordinate(l[0],l[1],l[2]);this._renderWorldCopies&&(g.x=p.wrap(g.x,0,1)),this._position=g}else this._position=null}lookAtPoint(l,g){if(this.orientation=null,!this.position)return;const E=this.position,I=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(l)):0,A=p.MercatorCoordinate.fromLngLat(l,I),O=[A.x-E.x,A.y-E.y,A.z-E.z];g||(g=[0,0,1]),g[2]=Math.abs(g[2]),this.orientation=vr(O,g)}setPitchBearing(l,g){this.orientation=an(p.degToRad(l),p.degToRad(-g))}}class ns{constructor(l,g){this._transform=p.identity([]),this.orientation=g,this.position=l}get mercatorPosition(){const l=this.position;return new p.MercatorCoordinate(l[0],l[1],l[2])}get position(){const l=p.getColumn(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var g;l&&p.setColumn(this._transform,3,[(g=l)[0],g[1],g[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||p.identity$1([]),l&&ii(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),g=this.right();return{bearing:Math.atan2(-g[1],g[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,g){this._orientation=an(l,g),ii(this._transform,this._orientation)}forward(){const l=p.getColumn(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=p.getColumn(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=p.getColumn(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,g){const E=new Float64Array(16);return p.invert(E,this.getWorldToCamera(l,g)),E}getWorldToCameraPosition(l,g,E){const I=this.position;p.scale$2(I,I,-l);const A=new Float64Array(16);return p.fromScaling(A,[E,E,E]),p.translate(A,A,I),A[10]*=g,A}getWorldToCamera(l,g){const E=new Float64Array(16),I=new Float64Array(4),A=this.position;return p.conjugate(I,this._orientation),p.scale$2(A,A,-l),p.fromQuat(E,I),p.translate(E,E,A),E[1]*=-1,E[5]*=-1,E[9]*=-1,E[13]*=-1,E[8]*=g,E[9]*=g,E[10]*=g,E[11]*=g,E}getCameraToClipPerspective(l,g,E,I){const A=new Float64Array(16);return p.perspective(A,l,g,E,I),A}getDistanceToElevation(l,g=!1){const E=0===l?0:p.mercatorZfromAltitude(l,g?p.latFromMercatorY(this.position[1]):this.position[1]),I=this.forward();return(E-this.position[2])/I[2]}clone(){return new ns([...this.position],[...this.orientation])}}function ua(v,l){const g=Xs(v.projection,v.zoom,v.width,v.height),E=function(A,O,k,U,q){const $=new p.LngLat(k.lng-180*xr,k.lat),te=new p.LngLat(k.lng+180*xr,k.lat),Ee=A.project($.lng,$.lat),Re=A.project(te.lng,te.lat),Be=-Math.atan2(Re.y-Ee.y,Re.x-Ee.x),Ne=p.MercatorCoordinate.fromLngLat(k);Ne.y=p.clamp(Ne.y,-1+xr,1-xr);const je=Ne.toLngLat(),oe=A.project(je.lng,je.lat),Pe=p.MercatorCoordinate.fromLngLat(je);Pe.x+=xr;const Xe=Pe.toLngLat(),He=A.project(Xe.lng,Xe.lat),gt=Xu(He.x-oe.x,He.y-oe.y,Be),mt=p.MercatorCoordinate.fromLngLat(je);mt.y+=xr;const it=mt.toLngLat(),St=A.project(it.lng,it.lat),Et=Xu(St.x-oe.x,St.y-oe.y,Be),Tt=Math.abs(gt.x)/Math.abs(Et.y),mn=p.identity([]);p.rotateZ(mn,mn,-Be*(1-(q?0:U)));const Rt=p.identity([]);return p.scale(Rt,Rt,[1,1-(1-Tt)*U,1]),Rt[4]=-Et.x/Et.y*U,p.rotateZ(Rt,Rt,Be),p.multiply(Rt,mn,Rt),Rt}(v.projection,0,v.center,g,l),I=Mi(v);return p.scale(E,E,[I,I,1]),E}function Mi(v){const l=v.projection,g=Xs(v.projection,v.zoom,v.width,v.height),E=Ql(l,v.center),I=Ql(l,p.LngLat.convert(l.center));return Math.pow(2,E*g+(1-g)*I)}function Xs(v,l,g,E,I=1/0){const A=v.range;if(!A)return 0;const O=Math.min(I,Math.max(g,E)),k=Math.log(O/1024)/Math.LN2;return p.smoothstep(A[0]+k,A[1]+k,l)}const xr=1/4e4;function Ql(v,l){const g=p.clamp(l.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),E=new p.LngLat(l.lng-180*xr,g),I=new p.LngLat(l.lng+180*xr,g),A=v.project(E.lng,g),O=v.project(I.lng,g),k=p.MercatorCoordinate.fromLngLat(E),U=p.MercatorCoordinate.fromLngLat(I),q=O.x-A.x,$=O.y-A.y,te=U.x-k.x,Ee=U.y-k.y,Re=Math.sqrt((te*te+Ee*Ee)/(q*q+$*$));return Math.log(Re)/Math.LN2}function Xu(v,l,g){const E=Math.cos(g),I=Math.sin(g);return{x:v*E-l*I,y:v*I+l*E}}class Kn{constructor(l,g,E,I,A,O,k){this.tileSize=512,this._renderWorldCopies=void 0===A||A,this._minZoom=l||0,this._maxZoom=g||22,this._minPitch=E??0,this._maxPitch=I??60,this.setProjection(O),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Wa,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ns,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const l=new Kn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(l,g=!1){const E=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||E)&&this._updateCameraOnTerrain(),(l||E)&&this._constrainCamera(g),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const g=this.projection?this.getProjection():void 0;this.projection=p.getProjection(this.projectionOptions);const E=!H(g,this.getProjection());return E&&this._calcMatrices(),this.mercatorFromTransition=!1,E}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.getProjection({name:"mercator"});const g=l!==this.projection.name;return g&&this._calcMatrices(),g}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(l){void 0===l?l=!0:null===l&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.Point(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const g=-l*Math.PI/180;var E,I,A,O,k,U,q,$,te,Ee;this.angle!==g&&(this._unmodified=!1,this.angle=g,this._calcMatrices(),this.rotationMatrix=(E=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(E[1]=0,E[2]=0),E[0]=1,E[3]=1,E),I=this.rotationMatrix,O=this.angle,k=(A=this.rotationMatrix)[0],U=A[1],q=A[2],$=A[3],te=Math.sin(O),Ee=Math.cos(O),I[0]=k*Ee+q*te,I[1]=U*Ee+$*te,I[2]=k*-te+q*Ee,I[3]=U*-te+$*Ee)}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const g=p.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==g&&(this._unmodified=!1,this._pitch=g,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=p.degToRad(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const g=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==g&&(this._unmodified=!1,this._setZoom(g),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const l=this._elevation;this._centerAltitude=l.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=l.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,g=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],E=this.horizonLineFromTop();let I=0,A=0;for(let O=0;O<g.length;O++){const k=new p.Point(g[O][0]*this.width,E+g[O][1]*(this.height-E)),U=l.pointCoordinate(k);if(!U)continue;const q=1/Math.hypot(U[0]-this._camera.position[0],U[1]-this._camera.position[1]);I+=U[3]*q,A+=q}return 0===A?NaN:I/A}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const l=this._seaLevelZoom,g=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),E=this.pixelsPerMeter/this.worldSize*g,I=this._mercatorZfromZoom(l),A=this._mercatorZfromZoom(this._maxZoom),O=Math.max(I-E,A);this._setZoom(this._zoomFromMercatorZ(O))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const g=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let E;E=l.z<this._camera.position[2]?[g.x,g.y,g.z]:[l.x,l.y,l.z];const I=p.length(p.sub([],this._camera.position,E));return p.clamp(this._zoomFromMercatorZ(I),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let g=!1;if(l.orientation&&!p.exactEquals(l.orientation,this._camera.orientation)&&(g=this._setCameraOrientation(l.orientation)),l.position){const E=[l.position.x,l.position.y,l.position.z];p.exactEquals$1(E,this._camera.position)||(this._setCameraPosition(E),g=!0)}g&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,g=new fo;return g.position=new p.MercatorCoordinate(l[0],l[1],l[2]),g.orientation=this._camera.orientation,g._elevation=this.elevation,g._renderWorldCopies=this.renderWorldCopies,g}_setCameraOrientation(l){if(!p.length$1(l))return!1;p.normalize$1(l,l);const g=p.transformQuat([],[0,0,-1],l),E=p.transformQuat([],[0,-1,0],l);if(E[2]<0)return!1;const I=vr(g,E);return!!I&&(this._camera.orientation=I,!0)}_setCameraPosition(l){const g=this.zoomScale(this.minZoom)*this.tileSize,E=this.zoomScale(this.maxZoom)*this.tileSize,I=this.cameraToCenterDistance;l[2]=p.clamp(l[2],I/E,I/g),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,g,E){this._unmodified=!1,this._edgeInsets.interpolate(l,g,E),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const g=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,g)}getVisibleUnwrappedCoordinates(l){const g=[new p.UnwrappedTileID(0,l)];if(this.renderWorldCopies){const E=this.pointCoordinate(new p.Point(0,0)),I=this.pointCoordinate(new p.Point(this.width,0)),A=this.pointCoordinate(new p.Point(this.width,this.height)),O=this.pointCoordinate(new p.Point(0,this.height)),k=Math.floor(Math.min(E.x,I.x,A.x,O.x)),U=Math.floor(Math.max(E.x,I.x,A.x,O.x)),q=1;for(let $=k-q;$<=U+q;$++)0!==$&&g.push(new p.UnwrappedTileID($,l))}return g}coveringTiles(l){let g=this.coveringZoomLevel(l);const E=g,I=this.elevation&&!l.isTerrainDEM,A="mercator"===this.projection.name;if(void 0!==l.minzoom&&g<l.minzoom)return[];void 0!==l.maxzoom&&g>l.maxzoom&&(g=l.maxzoom);const O=this.locationCoordinate(this.center),k=this.center.lat,U=1<<g,q=[U*O.x,U*O.y,0],$="globe"===this.projection.name,te=!$,Ee=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g,te),Re=$?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Be=U*p.mercatorZfromAltitude(1,this.center.lat),Ne=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),je=[U*Re.x,U*Re.y,Ne*(te?1:Be)],oe=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),Pe=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?g:0,Xe=l.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,He=l.isTerrainDEM?-Xe:this._elevation?this._elevation.getMinElevationBelowMSL():0,gt=this.projection.isReprojectedInTileSpace?Mi(this):1,mt=kt=>{const un=new p.MercatorCoordinate(kt.x+25e-6,kt.y,kt.z),on=new p.MercatorCoordinate(kt.x,kt.y+25e-6,kt.z),vn=kt.toLngLat(),nr=un.toLngLat(),Tr=on.toLngLat(),jn=this.locationCoordinate(vn),fr=this.locationCoordinate(nr),Rn=this.locationCoordinate(Tr),ei=Math.hypot(fr.x-jn.x,fr.y-jn.y),Jn=Math.hypot(Rn.x-jn.x,Rn.y-jn.y);return Math.sqrt(ei*Jn)*gt/25e-6},it=kt=>{const Jt=Xe,un=He;return{aabb:p.tileAABB(this,U,0,0,0,kt,un,Jt,this.projection),zoom:0,x:0,y:0,minZ:un,maxZ:Jt,wrap:kt,fullyVisible:!1}},St=[];let Et=[];const Tt=g,mn=l.reparseOverscaled?E:g,Rt=kt=>kt*kt,Kt=Rt((Ne-this._centerAltitude)*Be),Nt=kt=>{if(!this._elevation||!kt.tileID||!A)return;const Jt=this._elevation.getMinMaxForTile(kt.tileID),un=kt.aabb;Jt?(un.min[2]=Jt.min,un.max[2]=Jt.max,un.center[2]=(un.min[2]+un.max[2])/2):(kt.shouldSplit=dn(kt),kt.shouldSplit||(un.min[2]=un.max[2]=un.center[2]=this._centerAltitude))},dn=kt=>{if(kt.zoom<Pe)return!0;if(kt.zoom===Tt)return!1;if(null!=kt.shouldSplit)return kt.shouldSplit;const Jt=kt.aabb.distanceX(je),un=kt.aabb.distanceY(je);let on=Kt,vn=1;if($){on=Rt(kt.aabb.distanceZ(je));const jn=Math.pow(2,kt.zoom),fr=p.latFromMercatorY((kt.y+1)/jn),Rn=p.latFromMercatorY(kt.y/jn),ei=Math.min(Math.max(k,fr),Rn),Jn=p.circumferenceAtLatitude(ei)/p.circumferenceAtLatitude(k);if(vn=ei===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Jn/this._mercatorScaleRatio),this.zoom<=p.GLOBE_ZOOM_THRESHOLD_MIN&&kt.zoom===Tt-1&&Jn>=.9)return!0}else if(I&&(on=Rt(kt.aabb.distanceZ(je)*Be)),this.projection.isReprojectedInTileSpace&&E<=5){const jn=Math.pow(2,kt.zoom),fr=mt(new p.MercatorCoordinate((kt.x+.5)/jn,(kt.y+.5)/jn));vn=fr>.85?1:fr}const nr=Jt*Jt+un*un+on;return nr<Rt((1<<Tt-kt.zoom)*oe*vn*((jn,fr)=>{if(fr*Rt(.707)<jn)return 1;const Rn=Math.sqrt(fr/jn);return Rn/(1.4144271570014144+(Math.pow(1.1,Rn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(on,Kt),nr))};if(this.renderWorldCopies)for(let kt=1;kt<=3;kt++)St.push(it(-kt)),St.push(it(kt));for(St.push(it(0));St.length>0;){const kt=St.pop(),Jt=kt.x,un=kt.y;let on=kt.fullyVisible;if(!on){const vn=kt.aabb.intersects(Ee);if(0===vn)continue;on=2===vn}if(kt.zoom!==Tt&&dn(kt))for(let vn=0;vn<4;vn++){const nr=(Jt<<1)+vn%2,Tr=(un<<1)+(vn>>1),jn={aabb:A?kt.aabb.quadrant(vn):p.tileAABB(this,U,kt.zoom+1,nr,Tr,kt.wrap,kt.minZ,kt.maxZ,this.projection),zoom:kt.zoom+1,x:nr,y:Tr,wrap:kt.wrap,fullyVisible:on,tileID:void 0,shouldSplit:void 0,minZ:kt.minZ,maxZ:kt.maxZ};I&&!$&&(jn.tileID=new p.OverscaledTileID(kt.zoom+1===Tt?mn:kt.zoom+1,kt.wrap,kt.zoom+1,nr,Tr),Nt(jn)),St.push(jn)}else{const vn=kt.zoom===Tt?mn:kt.zoom;if(l.minzoom&&l.minzoom>vn)continue;const nr=q[0]-(.5+Jt+(kt.wrap<<kt.zoom))*(1<<g-kt.zoom),Tr=q[1]-.5-un,jn=kt.tileID?kt.tileID:new p.OverscaledTileID(vn,kt.wrap,kt.zoom,Jt,un);Et.push({tileID:jn,distanceSq:nr*nr+Tr*Tr})}}if(this.fogCullDistSq){const kt=this.fogCullDistSq,Jt=this.horizonLineFromTop();Et=Et.filter(un=>{const on=[0,0,0,1],vn=[p.EXTENT,p.EXTENT,0,1],nr=this.calculateFogTileMatrix(un.tileID.toUnwrapped());p.transformMat4$1(on,on,nr),p.transformMat4$1(vn,vn,nr);const Tr=p.getAABBPointSquareDist(on,vn);if(0===Tr)return!0;let jn=!1;const fr=this._elevation;if(fr&&Tr>kt&&0!==Jt){const Rn=this.calculateProjMatrix(un.tileID.toUnwrapped());let ei;l.isTerrainDEM||(ei=fr.getMinMaxForTile(un.tileID)),ei||(ei={min:He,max:Xe});const Jn=p.furthestTileCorner(this.rotation),ao=[Jn[0]*p.EXTENT,Jn[1]*p.EXTENT,ei.max];p.transformMat4(ao,ao,Rn),jn=(1-ao[1])*this.height*.5<Jt}return Tr<kt||jn})}return Et.sort((kt,Jt)=>kt.distanceSq-Jt.distanceSq).map(kt=>kt.tileID)}resize(l,g){this.width=l,this.height=g,this.pixelsToGLUnits=[2/l,-2/g],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const g=p.clamp(l.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),E=this.projection.project(l.lng,g);return new p.Point(E.x*this.worldSize,E.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/p.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,g){let E,I;const A=this.centerPoint;if("globe"===this.projection.name){const k=this.worldSize;E=(g.x-A.x)/k,I=(g.y-A.y)/k}else{const k=this.pointCoordinate(g),U=this.pointCoordinate(A);E=k.x-U.x,I=k.y-U.y}const O=this.locationCoordinate(l);this.setLocation(new p.MercatorCoordinate(O.x-E,O.y-I))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,g){const E=g?p.mercatorZfromAltitude(g,l.lat):void 0,I=this.projection.project(l.lng,l.lat);return new p.MercatorCoordinate(I.x,I.y,E)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,g){const E=g??this._centerAltitude,I=[l.x,l.y,0,1],A=[l.x,l.y,1,1];p.transformMat4$1(I,I,this.pixelMatrixInverse),p.transformMat4$1(A,A,this.pixelMatrixInverse);const O=A[3];p.scale$1(I,I,1/I[3]),p.scale$1(A,A,1/O);const k=I[2],U=A[2];return{p0:I,p1:A,t:k===U?0:(E-k)/(U-k)}}screenPointToMercatorRay(l){const g=[l.x,l.y,0,1],E=[l.x,l.y,1,1];return p.transformMat4$1(g,g,this.pixelMatrixInverse),p.transformMat4$1(E,E,this.pixelMatrixInverse),p.scale$1(g,g,1/g[3]),p.scale$1(E,E,1/E[3]),g[2]=p.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,E[2]=p.mercatorZfromAltitude(E[2],this._center.lat)*this.worldSize,p.scale$1(g,g,1/this.worldSize),p.scale$1(E,E,1/this.worldSize),new p.Ray([g[0],g[1],g[2]],p.normalize([],p.sub([],E,g)))}rayIntersectionCoordinate(l){const{p0:g,p1:E,t:I}=l,A=p.mercatorZfromAltitude(g[2],this._center.lat),O=p.mercatorZfromAltitude(E[2],this._center.lat);return new p.MercatorCoordinate(p.number(g[0],E[0],I)/this.worldSize,p.number(g[1],E[1],I)/this.worldSize,p.number(A,O,I))}pointCoordinate(l,g=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,g)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let g=this.projection.pointCoordinate3D(this,l.x,l.y);if(g)return new p.MercatorCoordinate(g[0],g[1],g[2]);let E=0,I=this.horizonLineFromTop();if(l.y>I)return this.pointCoordinate(l);const A=.02*I,O=l.clone();for(let k=0;k<10&&I-E>A;k++){O.y=p.number(E,I,.66);const U=this.projection.pointCoordinate3D(this,O.x,O.y);U?(I=O.y,g=U):E=O.y}return g?new p.MercatorCoordinate(g[0],g[1],g[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(l);const g=this.pointCoordinate(l);return g.y>=0&&g.y<=1}_coordinatePoint(l,g){const E=g&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,I=[l.x*this.worldSize,l.y*this.worldSize,E+l.toAltitude(),1];return p.transformMat4$1(I,I,this.pixelMatrix),I[3]>0?new p.Point(I[0]/I[3],I[1]/I[3]):new p.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:g}=this._edgeInsets,E=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,A=this.pointLocation3D(new p.Point(g,l)),O=this.pointLocation3D(new p.Point(I,l)),k=this.pointLocation3D(new p.Point(I,E)),U=this.pointLocation3D(new p.Point(g,E));let q=Math.min(A.lng,O.lng,k.lng,U.lng),$=Math.max(A.lng,O.lng,k.lng,U.lng),te=Math.min(A.lat,O.lat,k.lat,U.lat),Ee=Math.max(A.lat,O.lat,k.lat,U.lat);const Re=Math.pow(2,-this.zoom)/16*270,Be="globe"===this.projection.name?1:4,Ne=(je,oe,Pe,Xe,He)=>{const gt=(je+Pe)/2,mt=(oe+Xe)/2,it=new p.Point(gt,mt),{lng:St,lat:Et}=this.pointLocation3D(it),Tt=Math.max(0,q-St,te-Et,St-$,Et-Ee);q=Math.min(q,St),$=Math.max($,St),te=Math.min(te,Et),Ee=Math.max(Ee,Et),(He<Be||Tt>Re)&&(Ne(je,oe,gt,mt,He+1),Ne(gt,mt,Pe,Xe,He+1))};if(Ne(g,l,I,l,1),Ne(I,l,I,E,1),Ne(I,E,g,E,1),Ne(g,E,g,l,1),"globe"===this.projection.name){const[je,oe]=p.polesInViewport(this);je?(Ee=90,$=180,q=-180):oe&&(te=-90,$=180,q=-180)}return new p.LngLatBounds(new p.LngLat(q,te),new p.LngLat($,Ee))}_getBoundsRectangular(l,g){const{top:E,left:I}=this._edgeInsets,A=this.height-this._edgeInsets.bottom,O=this.width-this._edgeInsets.right,k=new p.Point(I,E),U=new p.Point(O,E),q=new p.Point(O,A),$=new p.Point(I,A);let te=this.pointCoordinate(k,l),Ee=this.pointCoordinate(U,l);const Re=this.pointCoordinate(q,g),Be=this.pointCoordinate($,g),Ne=(je,oe)=>(oe.y-je.y)/(oe.x-je.x);return te.y>1&&Ee.y>=0?te=new p.MercatorCoordinate((1-Be.y)/Ne(Be,te)+Be.x,1):te.y<0&&Ee.y<=1&&(te=new p.MercatorCoordinate(-Be.y/Ne(Be,te)+Be.x,0)),Ee.y>1&&te.y>=0?Ee=new p.MercatorCoordinate((1-Re.y)/Ne(Re,Ee)+Re.x,1):Ee.y<0&&te.y<=1&&(Ee=new p.MercatorCoordinate(-Re.y/Ne(Re,Ee)+Re.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(te)).extend(this.coordinateLocation(Ee)).extend(this.coordinateLocation(Be)).extend(this.coordinateLocation(Re))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const g=l.visibleDemTiles.reduce((E,I)=>{if(I.dem){const A=I.dem.tree;E.min=Math.min(E.min,A.minimums[0]),E.max=Math.max(E.max,A.maximums[0])}return E},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(g.min*l.exaggeration(),g.max*l.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const g=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,E=this.height/2-g*(1-this._horizonShift);return l?Math.max(0,E):E}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,g){return this.projection.createTileMatrix(this,g,l)}calculateDistanceTileData(l){const g=l.key,E=this._distanceTileDataCache;if(E[g])return E[g];const I=l.canonical,A=1/this.height,O=this.cameraWorldSize,k=O/this.zoomScale(I.z),U=(I.x+Math.pow(2,I.z)*l.wrap)*k,q=I.y*k,$=this.point;$.x*=O/this.worldSize,$.y*=O/this.worldSize;const te=this.angle,Ee=Math.sin(-te),Re=-Math.cos(-te);return E[g]={bearing:[Ee,Re],center:[($.x-U)*A,($.y-q)*A],scale:k/p.EXTENT*A},E[g]}calculateFogTileMatrix(l){const g=l.key,E=this._fogTileMatrixCache;if(E[g])return E[g];const I=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return p.multiply(I,this.worldToFogMatrix,I),E[g]=new Float32Array(I),E[g]}calculateProjMatrix(l,g=!1){const E=l.key,I=g?this._alignedProjMatrixCache:this._projMatrixCache;if(I[E])return I[E];const A=this.calculatePosMatrix(l,this.worldSize);return p.multiply(A,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.alignedProjMatrix:this.projMatrix,A),I[E]=new Float32Array(A),I[E]}calculatePixelsToTileUnitsMatrix(l){const g=l.tileID.key,E=this._pixelsToTileUnitsCache;if(E[g])return E[g];const I=function(A,O){const{scale:k}=A.tileTransform,U=k*p.EXTENT/(A.tileSize*Math.pow(2,O.zoom-A.tileID.overscaledZ+A.tileID.canonical.z));return q=new Float32Array(4),Ee=($=O.inverseAdjustmentMatrix)[1],Re=$[2],Be=$[3],je=(te=[U,U])[1],q[0]=$[0]*(Ne=te[0]),q[1]=Ee*Ne,q[2]=Re*je,q[3]=Be*je,q;var q,$,te,Ee,Re,Be,Ne,je}(l,this);return E[g]=I,E[g]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const l=1/this.worldSize,g=p.fromScaling([],[l,l,l]);return p.multiply(g,g,this.globeMatrix),g}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const l=this._elevation;this._updateCameraState();const g=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,E=this._computeCameraPosition(g),I=this._camera.forward(),A=p.mercatorZfromAltitude(1,this._center.lat);E[2]/=A,I[2]/=A,p.normalize(I,I);const O=l.raycast(E,I,l.exaggeration());if(O){const k=p.scaleAndAdd([],E,I,O),U=new p.MercatorCoordinate(k[0],k[1],p.mercatorZfromAltitude(k[2],p.latFromMercatorY(k[1]))),q=(U.z+p.length([U.x-E[0],U.y-E[1],U.z-E[2]*A]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(q),this._centerAltitude=U.toAltitude(),this._center=this.coordinateLocation(U),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const g=this._elevation,E=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,I=this._computeCameraPosition(E),A=g.getAtPointOrZero(new p.MercatorCoordinate(...I)),O=this.pixelsPerMeter/this.worldSize*A,k=this._minimumHeightOverTerrain(),U=I[2]-O;if(U<=k)if(U<0||l){const q=this.locationCoordinate(this._center,this._centerAltitude),$=[I[0],I[1],q.z-I[2]],te=p.length($);$[2]-=(k-U)/this._pixelsPerMercatorPixel;const Ee=p.length($);if(0===Ee)return;p.scale$2($,$,te/Ee*this._pixelsPerMercatorPixel),this._camera.position=[I[0],I[1],q.z*this._pixelsPerMercatorPixel-$[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const Ee=this.center;return Ee.lat=p.clamp(Ee.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(Ee.lng=p.clamp(Ee.lng,this.minLng,this.maxLng)),this.center=Ee,void(this._constraining=!1)}const g=this._unmodified,{x:E,y:I}=this.point;let A=0,O=E,k=I;const U=this.width/2,q=this.height/2,$=this.worldMinY*this.scale,te=this.worldMaxY*this.scale;if(I-q<$&&(k=$+q),I+q>te&&(k=te-q),te-$<this.height&&(A=Math.max(A,this.height/(te-$)),k=(te+$)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Ee=this.worldMinX*this.scale,Re=this.worldMaxX*this.scale,Be=this.worldSize/2-(Ee+Re)/2;O=(E+Be+this.worldSize)%this.worldSize-Be,O-U<Ee&&(O=Ee+U),O+U>Re&&(O=Re-U),Re-Ee<this.width&&(A=Math.max(A,this.width/(Re-Ee)),O=(Re+Ee)/2)}O===E&&k===I||(this.center=this.unproject(new p.Point(O,k))),A&&(this.zoom+=this.scaleZoom(A)),this._constrainCamera(),this._unmodified=g,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,g=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.mercatorZfromAltitude(1,this.center.lat)/p.mercatorZfromAltitude(1,p.GLOBE_SCALE_MATCH_LATITUDE));const E=Xs(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,E),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const I="meters"===this.projection.zAxisUnit?g:1,A=this._camera.getWorldToCamera(this.worldSize,I),O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);O[8]=2*-l.x/this.width,O[9]=2*l.y/this.height;let k=p.mul([],O,A);if(this.projection.isReprojectedInTileSpace){const mt=this.locationCoordinate(this.center),it=p.identity([]);p.translate(it,it,[mt.x*this.worldSize,mt.y*this.worldSize,0]),p.multiply(it,it,ua(this)),p.translate(it,it,[-mt.x*this.worldSize,-mt.y*this.worldSize,0]),p.multiply(k,k,it),this.inverseAdjustmentMatrix=function(St){const Et=ua(St,!0);return Z([],[Et[0],Et[1],Et[4],Et[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],k,[this.worldSize,this.worldSize,this.worldSize/I,1]),this.projMatrix=k,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const U=p.invert([],O);this.frustumCorners=p.FrustumCorners.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height);const q=new Float32Array(16);p.identity(q),p.scale(q,q,[1,-1,1]),p.rotateX(q,q,this._pitch),p.rotateZ(q,q,this.angle);const $=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),te=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;$[8]=2*-l.x/this.width,$[9]=2*(l.y+te)/this.height,this.skyboxMatrix=p.multiply(q,$,q);const Ee=this.point,Re=Ee.x,Be=Ee.y,Ne=this.width%2/2,je=this.height%2/2,oe=Math.cos(this.angle),Pe=Math.sin(this.angle),Xe=Re-Math.round(Re)+oe*Ne+Pe*je,He=Be-Math.round(Be)+oe*je+Pe*Ne,gt=new Float64Array(k);if(p.translate(gt,gt,[Xe>.5?Xe-1:Xe,He>.5?He-1:He,0]),this.alignedProjMatrix=gt,k=p.create(),p.scale(k,k,[this.width/2,-this.height/2,1]),p.translate(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=p.create(),p.scale(k,k,[1,-1,1]),p.translate(k,k,[-1,-1,0]),p.scale(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},k=p.invert(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.calculateGlobeMatrix(this);const mt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.transformMat4(mt,mt,A),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,g=this.cameraPixelsPerMeter,E=this._camera.position,I=1/this.height/this._pixelsPerMercatorPixel,A=[l,l,g];p.scale$2(A,A,I),p.scale$2(E,E,-1),p.multiply$2(E,E,A);const O=p.create();p.translate(O,O,E),p.scale(O,O,A),this.mercatorFogMatrix=O,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,g,I)}_computeCameraPosition(l){const g=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,E=this._camera.forward(),I=this.point,A=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*g-l/this.worldSize*this._centerAltitude;return[I.x/this.worldSize-E[0]*A,I.y/this.worldSize-E[1]*A,l/this.worldSize*this._centerAltitude-E[2]*A]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const g=this._maxCameraBoundsDistance()*Math.cos(this._pitch),E=this._camera.position[2],I=l[2];let A=1;this.projection.wrap&&(this.center=this.center.wrap()),I>0&&(A=Math.min((g-E)/I,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,l,A),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,g=this._camera.forward(),{pitch:E,bearing:I}=this._camera.getPitchBearing(),A=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,O=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),k=Math.max((l[2]-A)/Math.cos(E),O),U=this._zoomFromMercatorZ(k);p.scaleAndAdd(l,l,g,k),this._pitch=p.clamp(E,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(I,-Math.PI,Math.PI),this._setZoom(p.clamp(U,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let g=0,E=p.GLOBE_ZOOM_THRESHOLD_MAX,I=0,A=1/0;for(;E-g>1e-6&&E>g;){const O=g+.5*(E-g),k=this.tileSize*Math.pow(2,O),U=this.getCameraToCenterDistance(this.projection,O,k),q=this.scaleZoom(U/(l*this.tileSize)),$=Math.abs(O-q);$<A&&(A=$,I=O),O<q?g=O:E=O}return I}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,g){const E=Math.min(l.x,g.x),I=Math.max(l.x,g.x),A=Math.min(l.y,g.y),O=Math.max(l.y,g.y);if(A<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const k=[new p.Point(E,A),new p.Point(I,O),new p.Point(E,O),new p.Point(I,A)],U=this.renderWorldCopies?-3:0,q=this.renderWorldCopies?4:1;for(const $ of k){const te=this.pointRayIntersection($);if(te.t<0)return!0;const Ee=this.rayIntersectionCoordinate(te);if(Ee.x<U||Ee.y<0||Ee.x>q||Ee.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.Point(0,0),new p.Point(this.width,this.height))}zoomDeltaToMovement(l,g){const E=p.length(p.sub([],this._camera.position,l)),I=this._zoomFromMercatorZ(E)+g;return E-this._mercatorZfromZoom(I)}getCameraPoint(){if("globe"===this.projection.name){const l=function([g,E,I],A){const O=[g,E,I,1];p.transformMat4$1(O,O,A);const k=O[3]=Math.max(O[3],1e-6);return O[0]/=k,O[1]/=k,O[2]/=k,O}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.Point(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,l))}}getCameraToCenterDistance(l,g=this.zoom,E=this.worldSize){const I=Xs(l,g,this.width,this.height,1024),A=l.pixelSpaceConversion(this.center.lat,E,I);return.5/Math.tan(.5*this._fov)*this.height*A}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.multiply(l,l,this.globeMatrix),l}}function la(v,l){let g=!1,E=null;const I=()=>{E=null,g&&(v(),E=setTimeout(I,l),g=!1)};return()=>(g=!0,E||I(),E)}class Lc{constructor(l){this._hashName=l&&encodeURIComponent(l),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=la(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,p.window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const g=Pa(l);if(this._hashName){const E=this._hashName;let I=!1;const A=p.window.location.hash.slice(1).split("&").map(O=>{const k=O.split("=")[0];return k===E?(I=!0,`${k}=${g}`):O}).filter(O=>O);return I||A.push(`${E}=${g}`),`#${A.join("&")}`}return`#${g}`}_getCurrentHash(){const l=p.window.location.hash.replace("#","");if(this._hashName){let g;return l.split("&").map(E=>E.split("=")).forEach(E=>{E[0]===this._hashName&&(g=E)}),(g&&g[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const g=this._getCurrentHash();if(g.length>=3&&!g.some(E=>isNaN(E))){const E=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(g[3]||0):l.getBearing();return l.jumpTo({center:[+g[2],+g[1]],zoom:+g[0],bearing:E,pitch:+(g[4]||0)}),!0}return!1}_updateHashUnthrottled(){const l=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,l)}}function Pa(v,l){const g=v.getCenter(),E=Math.round(100*v.getZoom())/100,I=Math.ceil((E*Math.LN2+Math.log(512/360/.5))/Math.LN10),A=Math.pow(10,I),O=Math.round(g.lng*A)/A,k=Math.round(g.lat*A)/A,U=v.getBearing(),q=v.getPitch();let $=l?`/${O}/${k}/${E}`:`${E}/${k}/${O}`;return(U||q)&&($+="/"+Math.round(10*U)/10),q&&($+=`/${Math.round(q)}`),$}const to={linearity:.3,easing:p.bezier(0,0,.3,1)},Po=p.extend({deceleration:2500,maxSpeed:1400},to),Xo=p.extend({deceleration:20,maxSpeed:1400},to),An=p.extend({deceleration:1e3,maxSpeed:360},to),po=p.extend({deceleration:1e3,maxSpeed:90},to);class sh{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,g=p.exported.now();for(;l.length>0&&g-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const g={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:A}of this._inertiaBuffer)g.zoom+=A.zoomDelta||0,g.bearing+=A.bearingDelta||0,g.pitch+=A.pitchDelta||0,A.panDelta&&g.pan._add(A.panDelta),A.around&&(g.around=A.around),A.pinchAround&&(g.pinchAround=A.pinchAround);const E=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,I={};if(g.pan.mag()){const A=no(g.pan.mag(),E,p.extend({},Po,l||{}));I.offset=g.pan.mult(A.amount/g.pan.mag()),I.center=this._map.transform.center,Xa(I,A)}if(g.zoom){const A=no(g.zoom,E,Xo);I.zoom=this._map.transform.zoom+A.amount,Xa(I,A)}if(g.bearing){const A=no(g.bearing,E,An);I.bearing=this._map.transform.bearing+p.clamp(A.amount,-179,179),Xa(I,A)}if(g.pitch){const A=no(g.pitch,E,po);I.pitch=this._map.transform.pitch+A.amount,Xa(I,A)}if(I.zoom||I.bearing){const A=void 0===g.pinchAround?g.around:g.pinchAround;I.around=A?this._map.unproject(A):this._map.getCenter()}return this.clear(),I.noMoveStart=!0,I}}function Xa(v,l){(!v.duration||v.duration<l.duration)&&(v.duration=l.duration,v.easing=l.easing)}function no(v,l,g){const{maxSpeed:E,linearity:I,deceleration:A}=g,O=p.clamp(v*I/(l/1e3),-E,E),k=Math.abs(O)/(A*I);return{easing:g.easing,duration:1e3*k,amount:O*(k/2)}}class Ps extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,g,E,I={}){const A=re(g.getCanvasContainer(),E),O=g.unproject(A);super(l,p.extend({point:A,lngLat:O,originalEvent:E},I)),this._defaultPrevented=!1,this.target=g}}class ca extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,g,E){const I="touchend"===l?E.changedTouches:E.touches,A=Y(g.getCanvasContainer(),I),O=A.map(U=>g.unproject(U)),k=A.reduce((U,q,$,te)=>U.add(q.div(te.length)),new p.Point(0,0));super(l,{points:A,point:k,lngLats:O,lngLat:g.unproject(k),originalEvent:E}),this._defaultPrevented=!1}}class li extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,g,E){super(l,{originalEvent:E}),this._defaultPrevented=!1}}class Oc{constructor(l,g){this._map=l,this._clickTolerance=g.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new li(l.type,this._map,l))}mousedown(l,g){return this._mousedownPos=g,this._firePreventable(new Ps(l.type,this._map,l))}mouseup(l){this._map.fire(new Ps(l.type,this._map,l))}preclick(l){const g=p.extend({},l);g.type="preclick",this._map.fire(new Ps(g.type,this._map,g))}click(l,g){this._mousedownPos&&this._mousedownPos.dist(g)>=this._clickTolerance||(this.preclick(l),this._map.fire(new Ps(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new Ps(l.type,this._map,l))}mouseover(l){this._map.fire(new Ps(l.type,this._map,l))}mouseout(l){this._map.fire(new Ps(l.type,this._map,l))}touchstart(l){return this._firePreventable(new ca(l.type,this._map,l))}touchmove(l){this._map.fire(new ca(l.type,this._map,l))}touchend(l){this._map.fire(new ca(l.type,this._map,l))}touchcancel(l){this._map.fire(new ca(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Nc{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new Ps(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ps("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Ps(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wf{constructor(l,g){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=g.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,g){this.isEnabled()&&l.shiftKey&&0===l.button&&(xt(),this._startPos=this._lastPos=g,this._active=!0)}mousemoveWindow(l,g){if(!this._active)return;const E=g,I=this._startPos,A=this._lastPos;if(!I||!A||A.equals(E)||!this._box&&E.dist(I)<this._clickTolerance)return;this._lastPos=E,this._box||(this._box=ze("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const O=Math.min(I.x,E.x),k=Math.max(I.x,E.x),U=Math.min(I.y,E.y),q=Math.max(I.y,E.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${O}px,${U}px)`,this._box.style.width=k-O+"px",this._box.style.height=q-U+"px")})}mouseupWindow(l,g){if(!this._active)return;const E=this._startPos,I=g;if(E&&0===l.button){if(this.reset(),J(),E.x!==I.x||E.y!==I.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:A=>A.fitScreenCoordinates(E,I,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&27===l.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ie(),delete this._startPos,delete this._lastPos}_fireEvent(l,g){return this._map.fire(new p.Event(l,{originalEvent:g}))}}function hs(v,l){const g={};for(let E=0;E<v.length;E++)g[v[E].identifier]=l[E];return g}class su{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,g,E){(this.centroid||E.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=l.timeStamp),E.length===this.numTouches&&(this.centroid=function(I){const A=new p.Point(0,0);for(const O of I)A._add(O);return A.div(I.length)}(g),this.touches=hs(E,g)))}touchmove(l,g,E){if(this.aborted||!this.centroid)return;const I=hs(E,g);for(const A in this.touches){const O=I[A];(!O||O.dist(this.touches[A])>30)&&(this.aborted=!0)}}touchend(l,g,E){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),0===E.length){const I=!this.aborted&&this.centroid;if(this.reset(),I)return I}}}class Eu{constructor(l){this.singleTap=new su(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,g,E){this.singleTap.touchstart(l,g,E)}touchmove(l,g,E){this.singleTap.touchmove(l,g,E)}touchend(l,g,E){const I=this.singleTap.touchend(l,g,E);if(I){const A=l.timeStamp-this.lastTime<500,O=!this.lastTap||this.lastTap.dist(I)<30;if(A&&O||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=I,this.count===this.numTaps)return this.reset(),I}}}class fc{constructor(){this._zoomIn=new Eu({numTouches:1,numTaps:2}),this._zoomOut=new Eu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,g,E){this._zoomIn.touchstart(l,g,E),this._zoomOut.touchstart(l,g,E)}touchmove(l,g,E){this._zoomIn.touchmove(l,g,E),this._zoomOut.touchmove(l,g,E)}touchend(l,g,E){const I=this._zoomIn.touchend(l,g,E),A=this._zoomOut.touchend(l,g,E);return I?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:O.getZoom()+1,around:O.unproject(I)},{originalEvent:l})}):A?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:O.getZoom()-1,around:O.unproject(A)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const fs={0:1,2:2};class Lu{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,g){return!1}_move(l,g){return{}}mousedown(l,g){if(this._lastPoint)return;const E=ne(l);this._correctButton(l,E)&&(this._lastPoint=g,this._eventButton=E)}mousemoveWindow(l,g){const E=this._lastPoint;if(E)if(l.preventDefault(),null!=this._eventButton&&function(I,A){const O=fs[A];return void 0===I.buttons||(I.buttons&O)!==O}(l,this._eventButton))this.reset();else if(this._moved||!(g.dist(E)<this._clickTolerance))return this._moved=!0,this._lastPoint=g,this._move(E,g)}mouseupWindow(l){this._lastPoint&&ne(l)===this._eventButton&&(this._moved&&J(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zs extends Lu{mousedown(l,g){super.mousedown(l,g),this._lastPoint&&(this._active=!0)}_correctButton(l,g){return 0===g&&!l.ctrlKey}_move(l,g){return{around:g,panDelta:g.sub(l)}}}class Rs extends Lu{_correctButton(l,g){return 0===g&&l.ctrlKey||2===g}_move(l,g){const E=.8*(g.x-l.x);if(E)return this._active=!0,{bearingDelta:E}}contextmenu(l){l.preventDefault()}}class Ou extends Lu{_correctButton(l,g){return 0===g&&l.ctrlKey||2===g}_move(l,g){const E=-.5*(g.y-l.y);if(E)return this._active=!0,{pitchDelta:E}}contextmenu(l){l.preventDefault()}}class ur{constructor(l,g){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=g.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)}touchstart(l,g,E){return this._calculateTransform(l,g,E)}touchmove(l,g,E){if(this._active&&!(E.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===E.length&&!p.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,g,E)}}touchend(l,g,E){this._calculateTransform(l,g,E),this._active&&E.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,g,E){E.length>0&&(this._active=!0);const I=hs(E,g),A=new p.Point(0,0),O=new p.Point(0,0);let k=0;for(const q in I){const $=I[q],te=this._touches[q];te&&(A._add($),O._add($.sub(te)),k++,I[q]=$)}if(this._touches=I,k<this._minTouches||!O.mag())return;const U=O.div(k);return this._sum._add(U),this._sum.mag()<this._clickTolerance?void 0:{around:A.div(k),panDelta:U}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ze("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Ra{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,g,E){return{}}touchstart(l,g,E){this._firstTwoTouches||E.length<2||(this._firstTwoTouches=[E[0].identifier,E[1].identifier],this._start([g[0],g[1]]))}touchmove(l,g,E){const I=this._firstTwoTouches;if(!I)return;l.preventDefault();const[A,O]=I,k=Vs(E,g,A),U=Vs(E,g,O);if(!k||!U)return;const q=this._aroundCenter?null:k.add(U).div(2);return this._move([k,U],q,l)}touchend(l,g,E){if(!this._firstTwoTouches)return;const[I,A]=this._firstTwoTouches,O=Vs(E,g,I),k=Vs(E,g,A);O&&k||(this._active&&J(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&"center"===l.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Vs(v,l,g){for(let E=0;E<v.length;E++)if(v[E].identifier===g)return l[E]}function Nu(v,l){return Math.log(v/l)/Math.LN2}class La extends Ra{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,g){const E=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Nu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Nu(this._distance,E),pinchAround:g}}}function bf(v,l){return 180*v.angleWith(l)/Math.PI}class Oa extends Ra{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,g){const E=this._vector;if(this._vector=l[0].sub(l[1]),E&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:bf(this._vector,E),pinchAround:g}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const g=25/(Math.PI*this._minDiameter)*360,E=this._startVector;if(!E)return!1;const I=bf(l,E);return Math.abs(I)<g}}function so(v){return Math.abs(v.y)>Math.abs(v.x)}class rd extends Ra{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,so(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,g,E){const I=this._lastPoints;if(!I)return;const A=l[0].sub(I[0]),O=l[1].sub(I[1]);return this._map._cooperativeGestures&&!p.isFullscreen()&&E.touches.length<3||(this._valid=this.gestureBeginsVertically(A,O,E.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(A.y+O.y)/2*-.5})}gestureBeginsVertically(l,g,E){if(void 0!==this._valid)return this._valid;const I=l.mag()>=2,A=g.mag()>=2;if(!I&&!A)return;if(!I||!A)return null==this._firstMove&&(this._firstMove=E),E-this._firstMove<100&&void 0;const O=l.y>0==g.y>0;return so(l)&&so(g)&&O}}const ah={panStep:100,bearingStep:15,pitchStep:10};class a{constructor(){const l=ah;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let g=0,E=0,I=0,A=0,O=0;switch(l.keyCode){case 61:case 107:case 171:case 187:g=1;break;case 189:case 109:case 173:g=-1;break;case 37:l.shiftKey?E=-1:(l.preventDefault(),A=-1);break;case 39:l.shiftKey?E=1:(l.preventDefault(),A=1);break;case 38:l.shiftKey?I=1:(l.preventDefault(),O=-1);break;case 40:l.shiftKey?I=-1:(l.preventDefault(),O=1);break;default:return}return this._rotationDisabled&&(E=0,I=0),{cameraAnimation:k=>{const U=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:h,zoom:g?Math.round(U)+g*(l.shiftKey?2:1):U,bearing:k.getBearing()+E*this._bearingStep,pitch:k.getPitch()+I*this._pitchStep,offset:[-A*this._panStep,-O*this._panStep],center:k.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function h(v){return v*(2-v)}const y=4.000244140625;class x{constructor(l,g){this._map=l,this._el=l.getCanvasContainer(),this._handler=g,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&"center"===l.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||p.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let g=l.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const E=p.exported.now(),I=E-(this._lastWheelEventTime||0);this._lastWheelEventTime=E,0!==g&&g%y==0?this._type="wheel":0!==g&&Math.abs(g)<4?this._type="trackpad":I>400?(this._type=null,this._lastValue=g,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(I*g)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,g+=this._lastValue)),l.shiftKey&&g&&(g/=4),this._type&&(this._lastWheelEvent=l,this._delta-=g,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const g=re(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:g,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;"wheel"===this._type&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const g=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(0!==this._delta){const U="wheel"===this._type&&Math.abs(this._delta)>y?this._wheelZoomRate:this._defaultZoomRate;let q=2/(1+Math.exp(-Math.abs(this._delta*U)));this._delta<0&&0!==q&&(q=1/q);const $=g(),te=Math.pow(2,$),Ee="number"==typeof this._targetZoom?l.zoomScale(this._targetZoom):te;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(Ee*q))),"wheel"===this._type&&(this._startZoom=$,this._easing=this._smoothOutEasing(200)),this._delta=0}const E="number"==typeof this._targetZoom?this._targetZoom:g(),I=this._startZoom,A=this._easing;let O,k=!1;if("wheel"===this._type&&I&&A){const U=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),q=A(U);O=p.number(I,E,q),U<1?this._frameId||(this._frameId=!0):k=!0}else O=E,k=!0;return this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!k,zoomDelta:O-g(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let g=p.ease;if(this._prevEase){const E=this._prevEase,I=(p.exported.now()-E.start)/E.duration,A=E.easing(I+.01)-E.easing(I),O=.27/Math.sqrt(A*A+1e-4)*.01,k=Math.sqrt(.0729-O*O);g=p.bezier(O,k,.25,1)}return this._prevEase={start:p.exported.now(),duration:l,easing:g},g}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ze("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class T{constructor(l,g){this._clickZoom=l,this._tapZoom=g}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class F{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,g){return l.preventDefault(),{cameraAnimation:E=>{E.easeTo({duration:300,zoom:E.getZoom()+(l.shiftKey?-1:1),around:E.unproject(g)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class j{constructor(){this._tap=new Eu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,g,E){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?E.length>0&&(this._swipePoint=g[0],this._swipeTouch=E[0].identifier):this._tap.touchstart(l,g,E))}touchmove(l,g,E){if(this._tapTime){if(this._swipePoint){if(E[0].identifier!==this._swipeTouch)return;const I=g[0],A=I.y-this._swipePoint.y;return this._swipePoint=I,l.preventDefault(),this._active=!0,{zoomDelta:A/128}}}else this._tap.touchmove(l,g,E)}touchend(l,g,E){this._tapTime?this._swipePoint&&0===E.length&&this.reset():this._tap.touchend(l,g,E)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ce{constructor(l,g,E){this._el=l,this._mousePan=g,this._touchPan=E}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ke{constructor(l,g,E){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=g,this._mousePitch=E}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ft{constructor(l,g,E,I){this._el=l,this._touchZoom=g,this._touchRotate=E,this._tapDragZoom=I,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Lt=v=>v.zoom||v.drag||v.pitch||v.rotate;class $t extends p.Event{}class Pn{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,g){const E=p.sub([],g,l);this.radius=p.length(E[2]<0?p.div([],E,this.constants):[E[0],E[1],0])}projectRay(l){p.div(l,l,this.constants),p.normalize(l,l),p.mul$1(l,l,this.constants);const g=p.scale$2([],l,this.radius);if(g[2]>0){const E=p.scale$2([],[0,0,1],p.dot(g,[0,0,1])),I=p.scale$2([],p.normalize([],[g[0],g[1],0]),this.radius),A=p.add([],g,p.scale$2([],p.sub([],p.add([],I,E),g),2));g[0]=A[0],g[1]=A[1]}return g}}function Mn(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class zn{constructor(l,g){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new sh(l),this._bearingSnap=g.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Pn,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(g),p.bindAll(["handleEvent","handleWindowEvent"],this);const E=this._el;this._listeners=[[E,"touchstart",{passive:!0}],[E,"touchmove",{passive:!1}],[E,"touchend",void 0],[E,"touchcancel",void 0],[E,"mousedown",void 0],[E,"mousemove",void 0],[E,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[E,"mouseover",void 0],[E,"mouseout",void 0],[E,"dblclick",void 0],[E,"click",void 0],[E,"keydown",{capture:!1}],[E,"keyup",void 0],[E,"wheel",{passive:!1}],[E,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[I,A,O]of this._listeners)I.addEventListener(A,I===p.window.document?this.handleWindowEvent:this.handleEvent,O)}destroy(){for(const[l,g,E]of this._listeners)l.removeEventListener(g,l===p.window.document?this.handleWindowEvent:this.handleEvent,E)}_addDefaultHandlers(l){const g=this._map,E=g.getCanvasContainer();this._add("mapEvent",new Oc(g,l));const I=g.boxZoom=new wf(g,l);this._add("boxZoom",I);const A=new fc,O=new F;g.doubleClickZoom=new T(O,A),this._add("tapZoom",A),this._add("clickZoom",O);const k=new j;this._add("tapDragZoom",k);const U=g.touchPitch=new rd(g);this._add("touchPitch",U);const q=new Rs(l),$=new Ou(l);g.dragRotate=new ke(l,q,$),this._add("mouseRotate",q,["mousePitch"]),this._add("mousePitch",$,["mouseRotate"]);const te=new Zs(l),Ee=new ur(g,l);g.dragPan=new ce(E,te,Ee),this._add("mousePan",te),this._add("touchPan",Ee,["touchZoom","touchRotate"]);const Re=new Oa,Be=new La;g.touchZoomRotate=new ft(E,Be,Re,k),this._add("touchRotate",Re,["touchPan","touchZoom"]),this._add("touchZoom",Be,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Nc(g));const Ne=g.scrollZoom=new x(g,this);this._add("scrollZoom",Ne,["mousePan"]);const je=g.keyboard=new a;this._add("keyboard",je);for(const oe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[oe]&&g[oe].enable(l[oe])}_add(l,g,E){this._handlers.push({handlerName:l,handler:g,allowed:E}),this._handlersById[l]=g}stop(l){if(!this._updatingCamera){for(const{handler:g}of this._handlers)g.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Lt(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,g,E){for(const I in l)if(I!==E&&(!g||g.indexOf(I)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const g=[];for(const E of l)this._el.contains(E.target)&&g.push(E);return g}handleEvent(l,g){this._updatingCamera=!0;const E="renderFrame"===l.type,I=E?void 0:l,A={needsRenderFrame:!1},O={},k={},U=l.touches?this._getMapTouches(l.touches):void 0,q=U?Y(this._el,U):E?void 0:re(this._el,l);for(const{handlerName:Ee,handler:Re,allowed:Be}of this._handlers){if(!Re.isEnabled())continue;let Ne;this._blockedByActive(k,Be,Ee)?Re.reset():Re[g||l.type]&&(Ne=Re[g||l.type](l,q,U),this.mergeHandlerResult(A,O,Ne,Ee,I),Ne&&Ne.needsRenderFrame&&this._triggerRenderFrame()),(Ne||Re.isActive())&&(k[Ee]=Re)}const $={};for(const Ee in this._previousActiveHandlers)k[Ee]||($[Ee]=I);this._previousActiveHandlers=k,(Object.keys($).length||Mn(A))&&(this._changes.push([A,O,$]),this._triggerRenderFrame()),(Object.keys(k).length||Mn(A))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:te}=A;te&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],te(this._map))}mergeHandlerResult(l,g,E,I,A){if(!E)return;p.extend(l,E);const O={handlerName:I,originalEvent:E.originalEvent||A};void 0!==E.zoomDelta&&(g.zoom=O),void 0!==E.panDelta&&(g.drag=O),void 0!==E.pitchDelta&&(g.pitch=O),void 0!==E.bearingDelta&&(g.rotate=O)}_applyChanges(){const l={},g={},E={};for(const[I,A,O]of this._changes)I.panDelta&&(l.panDelta=(l.panDelta||new p.Point(0,0))._add(I.panDelta)),I.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+I.zoomDelta),I.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+I.bearingDelta),I.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+I.pitchDelta),void 0!==I.around&&(l.around=I.around),void 0!==I.aroundCoord&&(l.aroundCoord=I.aroundCoord),void 0!==I.pinchAround&&(l.pinchAround=I.pinchAround),I.noInertia&&(l.noInertia=I.noInertia),p.extend(g,A),p.extend(E,O);this._updateMapTransform(l,g,E),this._changes=[]}_updateMapTransform(l,g,E){const I=this._map,A=I.transform,O=Pe=>[Pe.x,Pe.y,Pe.z];if((Pe=>{const Xe=this._eventsInProgress.drag;return Xe&&!this._handlersById[Xe.handlerName].isActive()})()&&!Mn(l)){const Pe=A.zoom;A.cameraElevationReference="sea",A.recenterOnTerrain(),A.cameraElevationReference="ground",Pe!==A.zoom&&this._map._update(!0)}if(A._isCameraConstrained&&I._stop(!0),!Mn(l))return void this._fireEvents(g,E,!0);let{panDelta:k,zoomDelta:U,bearingDelta:q,pitchDelta:$,around:te,aroundCoord:Ee,pinchAround:Re}=l;A._isCameraConstrained&&(U>0&&(U=0),A._isCameraConstrained=!1),void 0!==Re&&(te=Re),(U||(Pe=>g.drag&&!this._eventsInProgress.drag)())&&te&&(this._dragOrigin=O(A.pointCoordinate3D(te)),this._trackingEllipsoid.setup(A._camera.position,this._dragOrigin)),A.cameraElevationReference="sea",I._stop(!0),te=te||I.transform.centerPoint,q&&(A.bearing+=q),$&&(A.pitch+=$),A._updateCameraState();const Be=[0,0,0];if(k)if("mercator"===A.projection.name){const Pe=this._trackingEllipsoid.projectRay(A.screenPointToMercatorRay(te).dir),Xe=this._trackingEllipsoid.projectRay(A.screenPointToMercatorRay(te.sub(k)).dir);Be[0]=Xe[0]-Pe[0],Be[1]=Xe[1]-Pe[1]}else{const Pe=A.pointCoordinate(te);if("globe"===A.projection.name){k=k.rotate(-A.angle);const Xe=A._pixelsPerMercatorPixel/A.worldSize;Be[0]=-k.x*p.mercatorScale(p.latFromMercatorY(Pe.y))*Xe,Be[1]=-k.y*p.mercatorScale(A.center.lat)*Xe}else{const Xe=A.pointCoordinate(te.sub(k));Pe&&Xe&&(Be[0]=Xe.x-Pe.x,Be[1]=Xe.y-Pe.y)}}const Ne=A.zoom,je=[0,0,0];if(U){const Pe=O(Ee||A.pointCoordinate3D(te)),Xe={dir:p.normalize([],p.sub([],Pe,A._camera.position))};if(Xe.dir[2]<0){const He=A.zoomDeltaToMovement(Pe,U);p.scale$2(je,Xe.dir,He)}}const oe=p.add(Be,Be,je);A._translateCameraConstrained(oe),U&&Math.abs(A.zoom-Ne)>1e-4&&A.recenterOnTerrain(),A.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(g,E,!0)}_fireEvents(l,g,E){const I=Lt(this._eventsInProgress),A=Lt(l),O={};for(const $ in l){const{originalEvent:te}=l[$];this._eventsInProgress[$]||(O[`${$}start`]=te),this._eventsInProgress[$]=l[$]}!I&&A&&this._fireEvent("movestart",A.originalEvent);for(const $ in O)this._fireEvent($,O[$]);A&&this._fireEvent("move",A.originalEvent);for(const $ in l){const{originalEvent:te}=l[$];this._fireEvent($,te)}const k={};let U;for(const $ in this._eventsInProgress){const{handlerName:te,originalEvent:Ee}=this._eventsInProgress[$];this._handlersById[te].isActive()||(delete this._eventsInProgress[$],U=g[te]||Ee,k[`${$}end`]=U)}for(const $ in k)this._fireEvent($,k[$]);const q=Lt(this._eventsInProgress);if(E&&(I||A)&&!q){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),te=Ee=>0!==Ee&&-this._bearingSnap<Ee&&Ee<this._bearingSnap;$?(te($.bearing||this._map.getBearing())&&($.bearing=0),this._map.easeTo($,{originalEvent:U})):(this._map.fire(new p.Event("moveend",{originalEvent:U})),te(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,g){this._map.fire(new p.Event(l,g?{originalEvent:g}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new $t("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const qn="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class hi extends p.Evented{constructor(l,g){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=g.bearingSnap,this._respectPrefersReducedMotion=!1!==g.respectPrefersReducedMotion,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(l,g){return this.jumpTo({center:l},g)}panBy(l,g,E){return l=p.Point.convert(l).mult(-1),this.panTo(this.transform.center,p.extend({offset:l},g),E)}panTo(l,g,E){return this.easeTo(p.extend({center:l},g),E)}getZoom(){return this.transform.zoom}setZoom(l,g){return this.jumpTo({zoom:l},g),this}zoomTo(l,g,E){return this.easeTo(p.extend({zoom:l},g),E)}zoomIn(l,g){return this.zoomTo(this.getZoom()+1,l,g),this}zoomOut(l,g){return this.zoomTo(this.getZoom()-1,l,g),this}getBearing(){return this.transform.bearing}setBearing(l,g){return this.jumpTo({bearing:l},g),this}getPadding(){return this.transform.padding}setPadding(l,g){return this.jumpTo({padding:l},g),this}rotateTo(l,g,E){return this.easeTo(p.extend({bearing:l},g),E)}resetNorth(l,g){return this.rotateTo(0,p.extend({duration:1e3},l),g),this}resetNorthPitch(l,g){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},l),g),this}snapToNorth(l,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,g):this}getPitch(){return this.transform.pitch}setPitch(l,g){return this.jumpTo({pitch:l},g),this}cameraForBounds(l,g){l=p.LngLatBounds.convert(l);const E=g&&g.bearing||0,I=g&&g.pitch||0,A=l.getNorthWest(),O=l.getSouthEast();return this._cameraForBounds(this.transform,A,O,E,I,g)}_extendCameraOptions(l){const g={top:0,bottom:0,right:0,left:0};if("number"==typeof(l=p.extend({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding){const E=l.padding;l.padding={top:E,bottom:E,right:E,left:E}}return l.padding=p.extend(g,l.padding),l}_minimumAABBFrustumDistance(l,g){const E=g.max[0]-g.min[0],I=g.max[1]-g.min[1];return E/I>l.aspect?E/(2*Math.tan(.5*l.fovX)*l.aspect):I/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,g,E,I,A,O){const k=l.clone(),U=this._extendCameraOptions(O);k.bearing=I,k.pitch=A;const q=p.LngLat.convert(g),$=p.LngLat.convert(E),te=.5*(q.lat+$.lat),Ee=.5*(q.lng+$.lng),Re=p.latLngToECEF(te,Ee),Be=p.normalize([],Re),Ne=p.normalize([],p.cross([],Be,[0,1,0])),je=p.cross([],Ne,Be),oe=[Ne[0],Ne[1],Ne[2],0,je[0],je[1],je[2],0,Be[0],Be[1],Be[2],0,0,0,0,1],Pe=[Re,p.latLngToECEF(q.lat,q.lng),p.latLngToECEF($.lat,q.lng),p.latLngToECEF($.lat,$.lng),p.latLngToECEF(q.lat,$.lng),p.latLngToECEF(te,q.lng),p.latLngToECEF(te,$.lng),p.latLngToECEF(q.lat,Ee),p.latLngToECEF($.lat,Ee)];let Xe=p.Aabb.fromPoints(Pe.map(on=>[p.dot(Ne,on),p.dot(je,on),p.dot(Be,on)]));const He=p.transformMat4([],Xe.center,oe);0===p.squaredLength(He)&&p.set(He,0,0,1),p.normalize(He,He),p.scale$2(He,He,p.GLOBE_RADIUS),k.center=p.ecefToLatLng(He);const gt=k.getWorldToCameraMatrix(),mt=p.invert(new Float64Array(16),gt);Xe=p.Aabb.applyTransform(Xe,p.multiply([],gt,oe)),p.transformMat4(He,He,gt);const it=.5*(Xe.max[2]-Xe.min[2]),St=this._minimumAABBFrustumDistance(k,Xe),Et=p.scale$2([],[0,0,1],it),Tt=p.add(Et,He,Et),mn=St+(0===k.pitch?0:p.distance(He,Tt)),Rt=k.globeCenterInViewSpace,Kt=p.sub([],He,[Rt[0],Rt[1],Rt[2]]);p.normalize(Kt,Kt),p.scale$2(Kt,Kt,mn);const Nt=p.add([],He,Kt);p.transformMat4(Nt,Nt,mt);const dn=p.earthRadius/p.GLOBE_RADIUS,kt=p.length(Nt),Jt=p.mercatorZfromAltitude(Math.max(kt*dn-p.earthRadius,Number.EPSILON),0),un=Math.min(k.zoomFromMercatorZAdjusted(Jt),U.maxZoom);return un>.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(k.setProjection({name:"mercator"}),k.zoom=un,this._cameraForBounds(k,g,E,I,A,O)):{center:k.center,zoom:un,bearing:I,pitch:A}}queryTerrainElevation(l,g){const E=this.transform.elevation;return E?(g=p.extend({},{exaggerated:!0},g),E.getAtPoint(p.MercatorCoordinate.fromLngLat(l),null,g.exaggerated)):null}_cameraForBounds(l,g,E,I,A,O){if("globe"===l.projection.name)return this._cameraForBoundsOnGlobe(l,g,E,I,A,O);const k=l.clone(),U=this._extendCameraOptions(O),q=k.padding;k.bearing=I,k.pitch=A;const $=p.LngLat.convert(g),te=p.LngLat.convert(E),Ee=new p.LngLat($.lng,te.lat),Re=new p.LngLat(te.lng,$.lat),Be=k.project($),Ne=k.project(te),je=this.queryTerrainElevation($),oe=this.queryTerrainElevation(te),Pe=this.queryTerrainElevation(Ee),Xe=this.queryTerrainElevation(Re),He=[[Be.x,Be.y,Math.min(je||0,oe||0,Pe||0,Xe||0)],[Ne.x,Ne.y,Math.max(je||0,oe||0,Pe||0,Xe||0)]];let gt=p.Aabb.fromPoints(He);const mt=k.getWorldToCameraMatrix(),it=p.invert(new Float64Array(16),mt);gt=p.Aabb.applyTransform(gt,mt);const St=p.sub([],gt.max,gt.min),Et=q.left||0,Tt=q.right||0,mn=q.bottom||0,Rt=q.top||0,{left:Kt,right:Nt,top:dn,bottom:kt}=U.padding,Jt=.5*(Et+Tt),un=.5*(Rt+mn),on=Math.min(k.scaleZoom(k.scale*Math.min((k.width-(Et+Tt+Kt+Nt))/St[0],(k.height-(mn+Rt+kt+dn))/St[1])),U.maxZoom),vn=k.scale/k.zoomScale(on);gt=new p.Aabb([gt.min[0]-(Kt+Jt)*vn,gt.min[1]-(kt+un)*vn,gt.min[2]],[gt.max[0]+(Nt+Jt)*vn,gt.max[1]+(dn+un)*vn,gt.max[2]]);const nr=.5*St[2],Tr=this._minimumAABBFrustumDistance(k,gt),jn=[0,0,1,0];p.transformMat4$1(jn,jn,mt),p.normalize$2(jn,jn);const fr=p.scale$2([],jn,Tr+nr),Rn=p.add([],gt.center,fr),ei=("number"==typeof U.offset.x&&"number"==typeof U.offset.y?new p.Point(U.offset.x,U.offset.y):p.Point.convert(U.offset)).rotate(-p.degToRad(I));gt.center[0]-=ei.x*vn,gt.center[1]+=ei.y*vn,p.transformMat4(gt.center,gt.center,it),p.transformMat4(Rn,Rn,it);const Jn=[gt.center[0],gt.center[1],Rn[2]*k.pixelsPerMeter];p.scale$2(Jn,Jn,1/k.worldSize);const ao=p.lngFromMercatorX(Jn[0]),Ro=p.latFromMercatorY(Jn[1]),Lo=Math.min(k._zoomFromMercatorZ(Jn[2]),U.maxZoom),wo=new p.LngLat(ao,Ro);return k.mercatorFromTransition&&Lo<.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(k.setProjection({name:"globe"}),k.zoom=Lo,this._cameraForBounds(k,g,E,I,A,O)):{center:wo,zoom:Lo,bearing:I,pitch:A}}fitBounds(l,g,E){const I=this.cameraForBounds(l,g);return this._fitInternal(I,g,E)}fitScreenCoordinates(l,g,E,I,A){const O=p.Point.convert(l),k=p.Point.convert(g),U=new p.Point(Math.min(O.x,k.x),Math.min(O.y,k.y)),q=new p.Point(Math.max(O.x,k.x),Math.max(O.y,k.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(O,k))return this;const $=this.transform.pointLocation3D(U),te=this.transform.pointLocation3D(q),Ee=this.transform.pointLocation3D(new p.Point(U.x,q.y)),Re=this.transform.pointLocation3D(new p.Point(q.x,U.y)),Be=[Math.min($.lng,te.lng,Ee.lng,Re.lng),Math.min($.lat,te.lat,Ee.lat,Re.lat)],Ne=[Math.max($.lng,te.lng,Ee.lng,Re.lng),Math.max($.lat,te.lat,Ee.lat,Re.lat)],je=I&&I.pitch?I.pitch:this.getPitch(),oe=this._cameraForBounds(this.transform,Be,Ne,E,je,I);return this._fitInternal(oe,I,A)}_fitInternal(l,g,E){return l?(delete(g=p.extend(l,g)).padding,g.linear?this.easeTo(g,E):this.flyTo(g,E)):this}jumpTo(l,g){this.stop();const E=l.preloadOnly?this.transform.clone():this.transform;let I=!1,A=!1,O=!1;return"zoom"in l&&E.zoom!==+l.zoom&&(I=!0,E.zoom=+l.zoom),void 0!==l.center&&(E.center=p.LngLat.convert(l.center)),"bearing"in l&&E.bearing!==+l.bearing&&(A=!0,E.bearing=+l.bearing),"pitch"in l&&E.pitch!==+l.pitch&&(O=!0,E.pitch=+l.pitch),null==l.padding||E.isPaddingEqual(l.padding)||(E.padding=l.padding),l.preloadOnly?(this._preloadTiles(E),this):(this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),I&&this.fire(new p.Event("zoomstart",g)).fire(new p.Event("zoom",g)).fire(new p.Event("zoomend",g)),A&&this.fire(new p.Event("rotatestart",g)).fire(new p.Event("rotate",g)).fire(new p.Event("rotateend",g)),O&&this.fire(new p.Event("pitchstart",g)).fire(new p.Event("pitch",g)).fire(new p.Event("pitchend",g)),this.fire(new p.Event("moveend",g)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(qn),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,g){const E=this.transform;if(!E.projection.supportsFreeCamera)return p.warnOnce(qn),this;this.stop();const I=E.zoom,A=E.pitch,O=E.bearing;E.setFreeCameraOptions(l);const k=I!==E.zoom,U=A!==E.pitch,q=O!==E.bearing;return this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),k&&this.fire(new p.Event("zoomstart",g)).fire(new p.Event("zoom",g)).fire(new p.Event("zoomend",g)),q&&this.fire(new p.Event("rotatestart",g)).fire(new p.Event("rotate",g)).fire(new p.Event("rotateend",g)),U&&this.fire(new p.Event("pitchstart",g)).fire(new p.Event("pitch",g)).fire(new p.Event("pitchend",g)),this.fire(new p.Event("moveend",g)),this}easeTo(l,g){this._stop(!1,l.easeId),(!1===(l=p.extend({offset:[0,0],duration:500,easing:p.ease},l)).animate||this._prefersReducedMotion(l))&&(l.duration=0);const E=this.transform,I=this.getZoom(),A=this.getBearing(),O=this.getPitch(),k=this.getPadding(),U="zoom"in l?+l.zoom:I,q="bearing"in l?this._normalizeBearing(l.bearing,A):A,$="pitch"in l?+l.pitch:O,te="padding"in l?l.padding:E.padding,Ee=p.Point.convert(l.offset);let Re,Be,Ne;if("globe"===E.projection.name){const Et=p.MercatorCoordinate.fromLngLat(E.center),Tt=Ee.rotate(-E.angle);Et.x+=Tt.x/E.worldSize,Et.y+=Tt.y/E.worldSize;const mn=Et.toLngLat(),Rt=p.LngLat.convert(l.center||mn);this._normalizeCenter(Rt),Re=E.centerPoint.add(Tt),Be=new p.Point(Et.x,Et.y).mult(E.worldSize),Ne=new p.Point(p.mercatorXfromLng(Rt.lng),p.mercatorYfromLat(Rt.lat)).mult(E.worldSize).sub(Be)}else{Re=E.centerPoint.add(Ee);const Et=E.pointLocation(Re),Tt=p.LngLat.convert(l.center||Et);this._normalizeCenter(Tt),Be=E.project(Et),Ne=E.project(Tt).sub(Be)}const je=E.zoomScale(U-I);let oe,Pe;l.around&&(oe=p.LngLat.convert(l.around),Pe=E.locationPoint(oe));const Xe=this._zooming||U!==I,He=this._rotating||A!==q,gt=this._pitching||$!==O,mt=!E.isPaddingEqual(te),it=Et=>Tt=>{if(Xe&&(Et.zoom=p.number(I,U,Tt)),He&&(Et.bearing=p.number(A,q,Tt)),gt&&(Et.pitch=p.number(O,$,Tt)),mt&&(Et.interpolatePadding(k,te,Tt),Re=Et.centerPoint.add(Ee)),oe)Et.setLocationAtPoint(oe,Pe);else{const mn=Et.zoomScale(Et.zoom-I),Rt=U>I?Math.min(2,je):Math.max(.5,je),Kt=Math.pow(Rt,1-Tt),Nt=Et.unproject(Be.add(Ne.mult(Tt*Kt)).mult(mn));Et.setLocationAtPoint(Et.renderWorldCopies?Nt.wrap():Nt,Re)}return l.preloadOnly||this._fireMoveEvents(g),Et};if(l.preloadOnly){const Et=this._emulate(it,l.duration,E);return this._preloadTiles(Et),this}const St={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Xe,this._rotating=He,this._pitching=gt,this._padding=mt,this._easeId=l.easeId,this._prepareEase(g,l.noMoveStart,St),this._ease(it(E),Et=>{E.recenterOnTerrain(),this._afterEase(g,Et)},l),this}_prepareEase(l,g,E={}){this._moving=!0,this.transform.cameraElevationReference="sea",g||E.moving||this.fire(new p.Event("movestart",l)),this._zooming&&!E.zooming&&this.fire(new p.Event("zoomstart",l)),this._rotating&&!E.rotating&&this.fire(new p.Event("rotatestart",l)),this._pitching&&!E.pitching&&this.fire(new p.Event("pitchstart",l))}_fireMoveEvents(l){this.fire(new p.Event("move",l)),this._zooming&&this.fire(new p.Event("zoom",l)),this._rotating&&this.fire(new p.Event("rotate",l)),this._pitching&&this.fire(new p.Event("pitch",l))}_afterEase(l,g){if(this._easeId&&g&&this._easeId===g)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const E=this._zooming,I=this._rotating,A=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new p.Event("zoomend",l)),I&&this.fire(new p.Event("rotateend",l)),A&&this.fire(new p.Event("pitchend",l)),this.fire(new p.Event("moveend",l))}flyTo(l,g){if(this._prefersReducedMotion(l)){const on=p.pick(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(on,g)}this.stop(),l=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},l);const E=this.transform,I=this.getZoom(),A=this.getBearing(),O=this.getPitch(),k=this.getPadding(),U="zoom"in l?p.clamp(+l.zoom,E.minZoom,E.maxZoom):I,q="bearing"in l?this._normalizeBearing(l.bearing,A):A,$="pitch"in l?+l.pitch:O,te="padding"in l?l.padding:E.padding,Ee=E.zoomScale(U-I),Re=p.Point.convert(l.offset);let Be=E.centerPoint.add(Re);const Ne=E.pointLocation(Be),je=p.LngLat.convert(l.center||Ne);this._normalizeCenter(je);const oe=E.project(Ne),Pe=E.project(je).sub(oe);let Xe=l.curve;const He=Math.max(E.width,E.height),gt=He/Ee,mt=Pe.mag();if("minZoom"in l){const on=p.clamp(Math.min(l.minZoom,I,U),E.minZoom,E.maxZoom),vn=He/E.zoomScale(on-I);Xe=Math.sqrt(vn/mt*2)}const it=Xe*Xe;function St(on){const vn=(gt*gt-He*He+(on?-1:1)*it*it*mt*mt)/(2*(on?gt:He)*it*mt);return Math.log(Math.sqrt(vn*vn+1)-vn)}function Et(on){return(Math.exp(on)-Math.exp(-on))/2}function Tt(on){return(Math.exp(on)+Math.exp(-on))/2}const mn=St(0);let Rt=function(on){return Tt(mn)/Tt(mn+Xe*on)},Kt=function(on){return He*((Tt(mn)*(Et(vn=mn+Xe*on)/Tt(vn))-Et(mn))/it)/mt;var vn},Nt=(St(1)-mn)/Xe;if(Math.abs(mt)<1e-6||!isFinite(Nt)){if(Math.abs(He-gt)<1e-6)return this.easeTo(l,g);const on=gt<He?-1:1;Nt=Math.abs(Math.log(gt/He))/Xe,Kt=function(){return 0},Rt=function(vn){return Math.exp(on*Xe*vn)}}l.duration="duration"in l?+l.duration:1e3*Nt/("screenSpeed"in l?+l.screenSpeed/Xe:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const dn=A!==q,kt=$!==O,Jt=!E.isPaddingEqual(te),un=on=>vn=>{const nr=vn*Nt,Tr=1/Rt(nr);on.zoom=1===vn?U:I+on.scaleZoom(Tr),dn&&(on.bearing=p.number(A,q,vn)),kt&&(on.pitch=p.number(O,$,vn)),Jt&&(on.interpolatePadding(k,te,vn),Be=on.centerPoint.add(Re));const jn=1===vn?je:on.unproject(oe.add(Pe.mult(Kt(nr))).mult(Tr));return on.setLocationAtPoint(on.renderWorldCopies?jn.wrap():jn,Be),on._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(g),on};if(l.preloadOnly){const on=this._emulate(un,l.duration,E);return this._preloadTiles(on),this}return this._zooming=!0,this._rotating=dn,this._pitching=kt,this._padding=Jt,this._prepareEase(g,!1),this._ease(un(E),()=>this._afterEase(g),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const E=this._onEaseEnd;this._onEaseEnd=void 0,E.call(this,g)}if(!l){const E=this.handlers;E&&E.stop(!1)}return this}_ease(l,g,E){!1===E.animate||0===E.duration?(l(1),g()):(this._easeStart=p.exported.now(),this._easeOptions=E,this._onEaseFrame=l,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),g=this._onEaseFrame;g&&g(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,g){l=p.wrap(l,-180,180);const E=Math.abs(l-g);return Math.abs(l-360-g)<E&&(l-=360),Math.abs(l+360-g)<E&&(l+=360),l}_normalizeCenter(l){const g=this.transform;if(!g.renderWorldCopies||g.maxBounds)return;const E=l.lng-g.center.lng;l.lng+=E>180?-360:E<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&p.exported.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,g,E){const I=Math.ceil(15*g/1e3),A=[],O=l(E.clone());for(let k=0;k<=I;k++){const U=O(k/I);A.push(U.clone())}return A}}class Sn{constructor(l={}){this.options=l,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const g=this.options&&this.options.compact;return this._map=l,this._container=ze("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ze("button","mapboxgl-ctrl-attrib-button",this._container),ze("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ze("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),g&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===g&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(l,g){const E=this._map._getUIString(`AttributionControl.${g}`);l.setAttribute("aria-label",E),l.removeAttribute("title"),l.firstElementChild&&l.firstElementChild.setAttribute("title",E)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const g=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(l){const E=g.reduce((I,A,O)=>(A.value&&(I+=`${A.key}=${A.value}${O<g.length-1?"&":""}`),I),"?");l.href=`${p.config.FEEDBACK_URL}/${E}#${Pa(this._map,!0)}`,l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}}_updateData(l){!l||"metadata"!==l.sourceDataType&&"visibility"!==l.sourceDataType&&"style"!==l.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const I=this._map.style.stylesheet;this.styleOwner=I.owner,this.styleId=I.id}const g=this._map.style._sourceCaches;for(const I in g){const A=g[I];if(A.used){const O=A.getSource();O.attribution&&l.indexOf(O.attribution)<0&&l.push(O.attribution)}}l.sort((I,A)=>I.length-A.length),l=l.filter((I,A)=>{for(let O=A+1;O<l.length;O++)if(l[O].indexOf(I)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const E=l.join(" | ");E!==this._attribHTML&&(this._attribHTML=E,l.length?(this._innerContainer.innerHTML=E,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class bs{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=ze("div","mapboxgl-ctrl");const g=ze("a","mapboxgl-ctrl-logo");return g.target="_blank",g.rel="noopener nofollow",g.href="https://www.mapbox.com/",g.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),g.setAttribute("rel","noopener nofollow"),this._container.appendChild(g),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&"metadata"!==l.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(0===Object.entries(l).length)return!0;for(const g in l){const E=l[g].getSource();if(E.hasOwnProperty("mapbox_logo")&&!E.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const g=l[0];this._map.getCanvasContainer().offsetWidth<250?g.classList.add("mapboxgl-compact"):g.classList.remove("mapboxgl-compact")}}}class au{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const g=++this._id;return this._queue.push({callback:l,id:g,cancelled:!1}),g}remove(l){const g=this._currentlyRunning,E=g?this._queue.concat(g):this._queue;for(const I of E)if(I.id===l)return void(I.cancelled=!0)}run(l=0){const g=this._currentlyRunning=this._queue;this._queue=[];for(const E of g)if(!E.cancelled&&(E.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function uu(v,l,g){if(v=new p.LngLat(v.lng,v.lat),l){const E=new p.LngLat(v.lng-360,v.lat),I=new p.LngLat(v.lng+360,v.lat),A=360*Math.ceil(Math.abs(v.lng-g.center.lng)/360),O=g.locationPoint(v).distSqr(l),k=l.x<0||l.y<0||l.x>g.width||l.y>g.height;g.locationPoint(E).distSqr(l)<O&&(k||Math.abs(E.lng-g.center.lng)<A)?v=E:g.locationPoint(I).distSqr(l)<O&&(k||Math.abs(I.lng-g.center.lng)<A)&&(v=I)}for(;Math.abs(v.lng-g.center.lng)>180;){const E=g.locationPoint(v);if(E.x>=0&&E.y>=0&&E.x<=g.width&&E.y<=g.height)break;v.lng>g.center.lng?v.lng-=360:v.lng+=360}return v}const Rl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class kn extends p.Evented{constructor(l,g){if(super(),(l instanceof p.window.HTMLElement||g)&&(l=p.extend({element:l},g)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=p.Point.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=ze("div");const I=41,A=27,O=_t("svg",{display:"block",height:I*this._scale+"px",width:A*this._scale+"px",viewBox:`0 0 ${A} ${I}`},this._element),k=_t("radialGradient",{id:"shadowGradient"},_t("defs",{},O));_t("stop",{offset:"10%","stop-opacity":.4},k),_t("stop",{offset:"100%","stop-opacity":.05},k),_t("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},O),_t("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},O),_t("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},O),_t("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},O),this._offset=p.Point.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",I=>{I.preventDefault()}),this._element.addEventListener("mousedown",I=>{I.preventDefault()});const E=this._element.classList;for(const I in Rl)E.remove(`mapboxgl-marker-anchor-${I}`);E.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=p.LngLat.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const I=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[I,-1*(24.6+I)],"bottom-right":[-I,-1*(24.6+I)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const g=l.code,E=l.charCode||l.keyCode;"Space"!==g&&"Enter"!==g&&32!==E&&13!==E||this.togglePopup()}_onMapClick(l){const g=l.originalEvent.target,E=this._element;this._popup&&(g===E||E.contains(g))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,g=this._pos;if(!l||!g)return!1;const E=l.unproject(g),I=l.getFreeCameraOptions();if(!I.position)return!1;const A=I.position.toLngLat();return A.distanceTo(E)<.9*A.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const g=this._pos;if(!g||g.x<0||g.x>l.transform.width||g.y<0||g.y>l.transform.height)return void this._clearFadeTimer();const E=l.unproject(g);let I;l._showingGlobe()&&p.isLngLatBehindGlobe(l.transform,this._lngLat)?I=0:(I=1-l._queryFogOpacity(E),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(I*=this._occludedOpacity)),this._element.style.opacity=`${I}`,this._element.style.pointerEvents=I>0?"auto":"none",this._popup&&this._popup._setOpacity(I),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const g=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${l.x}px,${l.y}px)\n            ${Rl[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${g.x}px,${g.y}px)\n        `}_calculateXYTransform(){const l=this._pos,g=this._map,E=this.getPitchAlignment();if(!g||!l||"map"!==E)return"";if(!g._showingGlobe()){const U=g.getPitch();return U?`rotateX(${U}deg)`:""}const I=p.radToDeg(p.globeTiltAtLngLat(g.transform,this._lngLat)),A=l.sub(p.globeCenterToScreenPoint(g.transform)),O=Math.abs(A.x)+Math.abs(A.y);if(0===O)return"";const k=I/O;return`rotateX(${-A.y*k}deg) rotateY(${A.x*k}deg)`}_calculateZTransform(){const l=this._pos,g=this._map;if(!g||!l)return"";let E=0;const I=this.getRotationAlignment();if("map"===I)if(g._showingGlobe()){const A=g.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),O=g.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(A);E=p.radToDeg(Math.atan2(O.y,O.x))-90}else E=-g.getBearing();else if("horizon"===I){const A=p.smoothstep(4,6,g.getZoom()),O=p.globeCenterToScreenPoint(g.transform);O.y+=A*g.transform.height;const k=l.sub(O),U=p.radToDeg(Math.atan2(k.y,k.x));E=(U>90?U-270:U+90)*(1-A)}return E+=this._rotation,E?`rotateZ(${E}deg)`:""}_update(l){p.window.cancelAnimationFrame(this._updateFrameId);const g=this._map;g&&(g.transform.renderWorldCopies&&(this._lngLat=uu(this._lngLat,this._pos,g.transform)),this._pos=g.project(this._lngLat),!0===l?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),g._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(g._showingGlobe()||g.getTerrain()||g.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=p.Point.convert(l),this._update(),this}_onMove(l){const g=this._map;if(!g)return;const E=this._pointerdownPos,I=this._positionDelta;if(E&&I){if(!this._isDragging){const A=this._clickTolerance||g._clickTolerance;if(l.point.dist(E)<A)return;this._isDragging=!0}this._pos=l.point.sub(I),this._lngLat=g.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(l){const g=this._map,E=this._pos;g&&E&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(E),this._pointerdownPos=l.point,this._state="pending",g.on("mousemove",this._onMove),g.on("touchmove",this._onMove),g.once("mouseup",this._onUp),g.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const g=this._map;return g&&(l?(g.on("mousedown",this._addDragHandler),g.on("touchstart",this._addDragHandler)):(g.off("mousedown",this._addDragHandler),g.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Kp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Wm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ll(v=new p.Point(0,0),l="bottom"){if("number"==typeof v){const g=Math.round(Math.sqrt(.5*Math.pow(v,2)));switch(l){case"top":return new p.Point(0,v);case"top-left":return new p.Point(g,g);case"top-right":return new p.Point(-g,g);case"bottom":return new p.Point(0,-v);case"bottom-left":return new p.Point(g,-g);case"bottom-right":return new p.Point(-g,-g);case"left":return new p.Point(v,0);case"right":return new p.Point(-v,0)}return new p.Point(0,0)}return v instanceof p.Point||Array.isArray(v)?p.Point.convert(v):p.Point.convert(v[l]||[0,0])}class Bh{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const g=p.easeCubicInOut((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-g)+this._end*g}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,g,E){this._start=this.getValue(g),this._end=l,this._startTime=g,this._endTime=g+E}}const wa={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},rp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Lv={showCompass:!0,showZoom:!0,visualizePitch:!1};class ip{constructor(l,g,E=!1){this._clickTolerance=10,this.element=g,this.mouseRotate=new Rs({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,E&&(this.mousePitch=new Ou({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),g.addEventListener("mousedown",this.mousedown),g.addEventListener("touchstart",this.touchstart,{passive:!1}),g.addEventListener("touchmove",this.touchmove),g.addEventListener("touchend",this.touchend),g.addEventListener("touchcancel",this.reset)}down(l,g){this.mouseRotate.mousedown(l,g),this.mousePitch&&this.mousePitch.mousedown(l,g),xt()}move(l,g){const E=this.map,I=this.mouseRotate.mousemoveWindow(l,g),A=I&&I.bearingDelta;if(A&&E.setBearing(E.getBearing()+A),this.mousePitch){const O=this.mousePitch.mousemoveWindow(l,g),k=O&&O.pitchDelta;k&&E.setPitch(E.getPitch()+k)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ie(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(p.extend({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),re(this.element,l)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,re(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){1!==l.targetTouches.length?this.reset():(this._startPos=this._lastPos=Y(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){1!==l.targetTouches.length?this.reset():(this._lastPos=Y(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){0===l.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Ef={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},zh={maxWidth:100,unit:"metric"},op={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Cf={version:p.version,supported:fe,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends hi{constructor(v){if(p.LivePerformanceUtils.mark(p.PerformanceMarkers.create),null!=(v=p.extend({},rp,v)).minZoom&&null!=v.maxZoom&&v.minZoom>v.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=v.minPitch&&null!=v.maxPitch&&v.minPitch>v.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=v.minPitch&&v.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=v.maxPitch&&v.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(v.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(v.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Kn(v.minZoom,v.maxZoom,v.minPitch,v.maxPitch,v.renderWorldCopies),v),this._interactive=v.interactive,this._minTileCacheSize=v.minTileCacheSize,this._maxTileCacheSize=v.maxTileCacheSize,this._failIfMajorPerformanceCaveat=v.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=v.preserveDrawingBuffer,this._antialias=v.antialias,this._useWebGL2=v.useWebGL2,this._trackResize=v.trackResize,this._bearingSnap=v.bearingSnap,this._refreshExpiredTiles=v.refreshExpiredTiles,this._fadeDuration=v.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=v.crossSourceCollisions,this._collectResourceTiming=v.collectResourceTiming,this._optimizeForTerrain=v.optimizeForTerrain,this._language=this._parseLanguage(v.language),this._worldview=v.worldview,this._renderTaskQueue=new au,this._domRenderTaskQueue=new au,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.uniqueId(),this._locale=p.extend({},wa,v.locale),this._clickTolerance=v.clickTolerance,this._cooperativeGestures=v.cooperativeGestures,this._performanceMetricsCollection=v.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Bh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new p.RequestManager(v.transformRequest,v.accessToken,v.testMode),this._silenceAuthErrors=!!v.testMode,"string"==typeof v.container){if(this._container=p.window.document.getElementById(v.container),!this._container)throw new Error(`Container '${v.container}' not found.`)}else{if(!(v.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=v.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),v.maxBounds&&this.setMaxBounds(v.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new zn(this,v),this._localFontFamily=v.localFontFamily,this._localIdeographFontFamily=v.localIdeographFontFamily,v.style&&this.setStyle(v.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),v.projection&&this.setProjection(v.projection),this._hash=v.hash&&new Lc("string"==typeof v.hash&&v.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch}),v.bounds&&(this.resize(),this.fitBounds(v.bounds,p.extend({},v.fitBoundsOptions,{duration:0})))),this.resize(),v.attributionControl&&this.addControl(new Sn({customAttribution:v.customAttribution})),this._logoControl=new bs,this.addControl(this._logoControl,v.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update("style"===l.dataType),this.fire(new p.Event(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new p.Event(`${l.dataType}dataloading`,l))})}_getMapId(){return this._mapId}addControl(v,l){if(void 0===l&&(l=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const g=v.onAdd(this);this._controls.push(v);const E=this._controlPositions[l];return-1!==l.indexOf("bottom")?E.insertBefore(g,E.firstChild):E.appendChild(g),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(v);return l>-1&&this._controls.splice(l,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(v){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new p.Event("movestart",v)).fire(new p.Event("move",v)),this.fire(new p.Event("resize",v)),l&&this.fire(new p.Event("moveend",v)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(v){return this.transform.setMaxBounds(p.LngLatBounds.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v?this.setZoom(v):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v?this.setZoom(v):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v?this.setPitch(v):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v?this.setPitch(v):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(v){return"auto"===v?p.window.navigator.language:Array.isArray(v)?0===v.length?void 0:v.map(l=>"auto"===l?p.window.navigator.language:l):v}setLanguage(v){const l=this._parseLanguage(v);if(!this.style||l===this._language)return this;this._language=l,this.style._reloadSources();for(const g of this._controls)g._setLanguage&&g._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(v){return this.style&&v!==this._worldview?(this._worldview=v,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(v){return this._lazyInitEmptyStyle(),v?"string"==typeof v&&(v={name:v}):v=null,this._useExplicitProjection=!!v,this._prioritizeAndUpdateProjection(v,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const v=this.transform,l=v.projection.name;let g;"globe"===l&&v.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?(v.setMercatorFromTransition(),g=!0):"mercator"===l&&v.zoom<p.GLOBE_ZOOM_THRESHOLD_MAX&&(v.setProjection({name:"globe"}),g=!0),g&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(v,l){return this._updateProjection(v||l||{name:"mercator"})}_updateProjection(v){let l;if(l="globe"===v.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(v),this.style.applyProjectionUpdate(),l){this.painter.clearBackgroundTiles();for(const g in this.style._sourceCaches)this.style._sourceCaches[g].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(v){return this.transform.locationPoint3D(p.LngLat.convert(v))}unproject(v){return this.transform.pointLocation3D(p.Point.convert(v))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(v,l,g){if("mouseenter"===v||"mouseover"===v){let E=!1;const I=O=>{const k=l.filter(q=>this.getLayer(q)),U=k.length?this.queryRenderedFeatures(O.point,{layers:k}):[];U.length?E||(E=!0,g.call(this,new Ps(v,this,O.originalEvent,{features:U}))):E=!1},A=()=>{E=!1};return{layers:new Set(l),listener:g,delegates:{mousemove:I,mouseout:A}}}if("mouseleave"===v||"mouseout"===v){let E=!1;const I=O=>{const k=l.filter(U=>this.getLayer(U));(k.length?this.queryRenderedFeatures(O.point,{layers:k}):[]).length?E=!0:E&&(E=!1,g.call(this,new Ps(v,this,O.originalEvent)))},A=O=>{E&&(E=!1,g.call(this,new Ps(v,this,O.originalEvent)))};return{layers:new Set(l),listener:g,delegates:{mousemove:I,mouseout:A}}}{const E=I=>{const A=l.filter(k=>this.getLayer(k)),O=A.length?this.queryRenderedFeatures(I.point,{layers:A}):[];O.length&&(I.features=O,g.call(this,I),delete I.features)};return{layers:new Set(l),listener:g,delegates:{[v]:E}}}}on(v,l,g){if(void 0===g)return super.on(v,l);Array.isArray(l)||(l=[l]);const E=this._createDelegatedListener(v,l,g);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(E);for(const I in E.delegates)this.on(I,E.delegates[I]);return this}once(v,l,g){if(void 0===g)return super.once(v,l);Array.isArray(l)||(l=[l]);const E=this._createDelegatedListener(v,l,g);for(const I in E.delegates)this.once(I,E.delegates[I]);return this}off(v,l,g){if(void 0===g)return super.off(v,l);l=new Set(Array.isArray(l)?l:[l]);const E=(A,O)=>{if(A.size!==O.size)return!1;for(const k of A)if(!O.has(k))return!1;return!0},I=this._delegatedListeners?this._delegatedListeners[v]:void 0;return I&&(A=>{for(let O=0;O<A.length;O++){const k=A[O];if(k.listener===g&&E(k.layers,l)){for(const U in k.delegates)this.off(U,k.delegates[U]);return A.splice(O,1),this}}})(I),this}queryRenderedFeatures(v,l){return this.style?(void 0!==l||void 0===v||v instanceof p.Point||Array.isArray(v)||(l=v,v=void 0),this.style.queryRenderedFeatures(v=v||[[0,0],[this.transform.width,this.transform.height]],l=l||{},this.transform)):[]}querySourceFeatures(v,l){return this.style.querySourceFeatures(v,l)}isPointOnSurface(v){const{name:l}=this.transform.projection;return"globe"!==l&&"mercator"!==l&&p.warnOnce(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(p.Point.convert(v))}setStyle(v,l){return!1!==(l=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l)).diff&&l.localIdeographFontFamily===this._localIdeographFontFamily&&l.localFontFamily===this._localFontFamily&&this.style&&v?(this._diffStyle(v,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(v,l))}_getUIString(v){const l=this._locale[v];if(null==l)throw new Error(`Missing UI string '${v}'`);return l}_updateStyle(v,l){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),v&&(this.style=new _o(this,l||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof v?this.style.loadURL(v):this.style.loadJSON(v)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new _o(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,l){if("string"==typeof v){const g=this._requestManager.normalizeStyleURL(v),E=this._requestManager.transformRequest(g,p.ResourceType.Style);p.getJSON(E,(I,A)=>{I?this.fire(new p.ErrorEvent(I)):A&&this._updateDiff(A,l)})}else"object"==typeof v&&this._updateDiff(v,l)}_updateDiff(v,l){try{this.style.setState(v)&&this._update(!0)}catch(g){p.warnOnce(`Unable to perform style diff: ${g.message||g.error||g}.  Rebuilding the style from scratch.`),this._updateStyle(v,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(v,l){return this._lazyInitEmptyStyle(),this.style.addSource(v,l),this._update(!0)}isSourceLoaded(v){return!!this.style&&this.style._isSourceCacheLoaded(v)}areTilesLoaded(){const v=this.style&&this.style._sourceCaches;for(const l in v){const g=v[l]._tiles;for(const E in g){const I=g[E];if("loaded"!==I.state&&"errored"!==I.state)return!1}}return!0}addSourceType(v,l,g){this._lazyInitEmptyStyle(),this.style.addSourceType(v,l,g)}removeSource(v){return this.style.removeSource(v),this._updateTerrain(),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,l,{pixelRatio:g=1,sdf:E=!1,stretchX:I,stretchY:A,content:O}={}){if(this._lazyInitEmptyStyle(),l instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&l instanceof p.window.ImageBitmap){const{width:k,height:U,data:q}=p.exported.getImageData(l);this.style.addImage(v,{data:new p.RGBAImage({width:k,height:U},q),pixelRatio:g,stretchX:I,stretchY:A,content:O,sdf:E,version:0})}else if(void 0===l.width||void 0===l.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:k,height:U}=l,q=l;this.style.addImage(v,{data:new p.RGBAImage({width:k,height:U},new Uint8Array(q.data)),pixelRatio:g,stretchX:I,stretchY:A,content:O,sdf:E,version:0,userImage:q}),q.onAdd&&q.onAdd(this,v)}}updateImage(v,l){const g=this.style.getImage(v);if(!g)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const E=l instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&l instanceof p.window.ImageBitmap?p.exported.getImageData(l):l,{width:I,height:A}=E;void 0!==I&&void 0!==A?I===g.data.width&&A===g.data.height?(g.data.replace(E.data,!(l instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&l instanceof p.window.ImageBitmap)),this.style.updateImage(v,g)):this.fire(new p.ErrorEvent(new Error(`The width and height of the updated image (${I}, ${A})\n                must be that same as the previous version of the image\n                (${g.data.width}, ${g.data.height})`))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v,l){p.getImage(this._requestManager.transformRequest(v,p.ResourceType.Image),(g,E)=>{l(g,E instanceof p.window.HTMLImageElement?p.exported.getImageData(E):E)})}listImages(){return this.style.listImages()}addLayer(v,l){return this._lazyInitEmptyStyle(),this.style.addLayer(v,l),this._update(!0)}moveLayer(v,l){return this.style.moveLayer(v,l),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}setLayerZoomRange(v,l,g){return this.style.setLayerZoomRange(v,l,g),this._update(!0)}setFilter(v,l,g={}){return this.style.setFilter(v,l,g),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,l,g,E={}){return this.style.setPaintProperty(v,l,g,E),this._update(!0)}getPaintProperty(v,l){return this.style.getPaintProperty(v,l)}setLayoutProperty(v,l,g,E={}){return this.style.setLayoutProperty(v,l,g,E),this._update(!0)}getLayoutProperty(v,l){return this.style.getLayoutProperty(v,l)}setLight(v,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,l),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(v){return this._lazyInitEmptyStyle(),!v&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(v),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(v){return this._lazyInitEmptyStyle(),this.style.setFog(v),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(v){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(v),this.transform):0}setFeatureState(v,l){return this.style.setFeatureState(v,l),this._update()}removeFeatureState(v,l){return this.style.removeFeatureState(v,l),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}_updateContainerDimensions(){if(!this._container)return;const v=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let g,E,I,A=this._container;for(;A&&(!E||!I);){const O=p.window.getComputedStyle(A).transform;O&&"none"!==O&&(g=O.match(/matrix.*\((.+)\)/)[1].split(", "),g[0]&&"0"!==g[0]&&"1"!==g[0]&&(E=g[0]),g[3]&&"0"!==g[3]&&"1"!==g[3]&&(I=g[3])),A=A.parentElement}this._containerWidth=E?Math.abs(v/E):v,this._containerHeight=I?Math.abs(l/I):l}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const v=this._container;v.classList.add("mapboxgl-map"),(this._missingCSSCanary=ze("div","mapboxgl-canary",v)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=ze("div","mapboxgl-canvas-container",v);this._interactive&&l.classList.add("mapboxgl-interactive"),this._canvas=ze("canvas","mapboxgl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const g=this._controlContainer=ze("div","mapboxgl-control-container",v),E=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(I=>{E[I]=ze("div",`mapboxgl-ctrl-${I}`,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,l){const g=p.exported.devicePixelRatio||1;this._canvas.width=g*Math.ceil(v),this._canvas.height=g*Math.ceil(l),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${l}px`}_addMarker(v){this._markers.push(v)}_removeMarker(v){const l=this._markers.indexOf(v);-1!==l&&this._markers.splice(l,1)}_addPopup(v){this._popups.push(v)}_removePopup(v){const l=this._popups.indexOf(v);-1!==l&&this._popups.splice(l,1)}_setupPainter(){const v=p.extend({},fe.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._useWebGL2&&this._canvas.getContext("webgl2",v),g=l||this._canvas.getContext("webgl",v)||this._canvas.getContext("experimental-webgl",v);g?(this._useWebGL2&&!l&&p.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),p.storeAuthState(g,!0),this.painter=new Jl(g,this.transform,!!l),this.on("data",E=>{"source"===E.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(g)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(v){v.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:v}))}_contextRestored(v){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:v}))}_onMapScroll(v){if(v.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_requestDomTask(v){!this.loaded()||this.loaded()&&!this.isMoving()?v():this._domRenderTaskQueue.add(v)}_render(v){let l;const g=this.painter.context.extTimerQuery,E=p.exported.now();if(this.listens("gpu-timing-frame")&&(l=g.createQueryEXT(),g.beginQueryEXT(g.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],p.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],p.window.performance.now())),this._renderTaskQueue.run(v),this._domRenderTaskQueue.run(v),this._removed)return;this._updateProjectionTransition();const I=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,U=this.transform.pitch,q=p.exported.now(),$=new p.EvaluationParameters(k,{now:q,fadeDuration:I,pitch:U,transition:this.style.getTransition()});this.style.update($)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let A=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),A=this._updateAverageElevation(E),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):A=this._updateAverageElevation(E),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,I,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:I,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const k=p.exported.now()-E;g.endQueryEXT(g.TIME_ELAPSED_EXT,l),setTimeout(()=>{const U=g.getQueryObjectEXT(l,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(l),this.fire(new p.Event("gpu-timing-frame",{cpuTime:k,gpuTime:U})),p.window.performance.mark("frame-gpu",{startTime:E,detail:{gpuTime:U}})},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const U=this.painter.queryGpuTimers(k);this.fire(new p.Event("gpu-timing-layer",{layerTimes:U}))},50)}if(this.listens("gpu-timing-deferred-render")){const k=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const U=this.painter.queryGpuTimeDeferredRender(k);this.fire(new p.Event("gpu-timing-deferred-render",{gpuTime:U}))},50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||A;if(O||this._repaint)this.triggerRepaint();else{const k=!this.isMoving()&&this.loaded();if(k&&(A=this._updateAverageElevation(E,!0)),A)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const U=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:U})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,p.LivePerformanceUtils.mark(p.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&p.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(v){for(const l of this._markers)v&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!v||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(v,l=!1){const g=E=>(this.transform.averageElevation=E,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&g(0);if((l||v-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(v)){const E=this.transform.averageElevation;let I=this.transform.sampleAverageElevation(),A=!1;this.transform.elevation&&(A=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(I)?I=0:this._averageElevationLastSampledAt=v;const O=Math.abs(E-I);if(O>1){if(this._isInitialLoad||A)return this._averageElevation.jumpTo(I),g(I);this._averageElevation.easeTo(I,v,300)}else if(O>1e-4)return this._averageElevation.jumpTo(I),g(I)}return!!this._averageElevation.isEasing(v)&&g(this._averageElevation.getValue(v))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,v=>{if(v&&(v.message===p.AUTH_ERR_MSG||401===v.status)){const l=this.painter.context.gl;p.storeAuthState(l,!1),this._logoControl instanceof bs&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const v=this._isDragging();this.painter.updateTerrain(this.style,v)}_calculateSpeedIndex(){const v=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const g=this.painter.context.gl,E=g.createFramebuffer();function I(A){g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,A,0);const O=new Uint8Array(g.drawingBufferWidth*g.drawingBufferHeight*4);return g.readPixels(0,0,g.drawingBufferWidth,g.drawingBufferHeight,g.RGBA,g.UNSIGNED_BYTE,O),O}return g.bindFramebuffer(g.FRAMEBUFFER,E),this._canvasPixelComparison(I(v),l.canvasCopies.map(I),l.timeStamps)}_canvasPixelComparison(v,l,g){let E=g[1]-g[0];const I=v.length/4;for(let A=0;A<l.length;A++){const O=l[A];let k=0;for(let U=0;U<O.length;U+=4)O[U]===v[U]&&O[U+1]===v[U+1]&&O[U+2]===v[U+2]&&O[U+3]===v[U+3]&&(k+=1);E+=(g[A+2]-g[A+1])*(1-k/I)}return E}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1),p.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const v=this.painter.context.gl.getExtension("WEBGL_lose_context");v&&v.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(v){this._renderNextFrame=this._renderNextFrame||v,this.style&&!this._frame&&(this._frame=p.exported.frame(l=>{const g=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,g&&this._render(l)}))}_preloadTiles(v){const l=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(l,(g,E)=>g._preloadTiles(v,E),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(v){this._trackResize&&this.resize({originalEvent:v})._update()}_onVisibilityChange(){"hidden"===p.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(v){this._showTerrainWireframe!==v&&(this._showTerrainWireframe=v,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(v){this._speedIndexTiming!==v&&(this._speedIndexTiming=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(v){this._showTileAABBs!==v&&(this._showTileAABBs=v,v&&this._update())}_setCacheLimits(v,l){p.setCacheLimits(v,l)}get version(){return p.version}},NavigationControl:class{constructor(v){this.options=p.extend({},Lv,v),this._container=ze("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),ze("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),ze("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const g=this._map;g&&(this.options.visualizePitch?g.resetNorthPitch({},{originalEvent:l}):g.resetNorth({},{originalEvent:l}))}),this._compassIcon=ze("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const v=this._map;if(!v)return;const l=v.getZoom(),g=l===v.getMaxZoom(),E=l===v.getMinZoom();this._zoomInButton.disabled=g,this._zoomOutButton.disabled=E,this._zoomInButton.setAttribute("aria-disabled",g.toString()),this._zoomOutButton.setAttribute("aria-disabled",E.toString())}_rotateCompassArrow(){const v=this._map;if(!v)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(v.transform.pitch*(Math.PI/180)),.5)}) rotateX(${v.transform.pitch}deg) rotateZ(${v.transform.angle*(180/Math.PI)}deg)`:`rotate(${v.transform.angle*(180/Math.PI)}deg)`;v._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),v.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&v.on("pitch",this._rotateCompassArrow),v.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ip(v,this._compass,this.options.visualizePitch)),this._container}onRemove(){const v=this._map;v&&(this._container.remove(),this.options.showZoom&&v.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&v.off("pitch",this._rotateCompassArrow),v.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(v,l){const g=ze("button",v,this._container);return g.type="button",g.addEventListener("click",l),g}_setButtonTitle(v,l){if(!this._map)return;const g=this._map._getUIString(`NavigationControl.${l}`);v.setAttribute("aria-label",g),v.firstElementChild&&v.firstElementChild.setAttribute("title",g)}},GeolocateControl:class extends p.Evented{constructor(v){super(),this.options=p.extend({geolocation:p.window.navigator.geolocation},Ef,v),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=la(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(v){return this._map=v,this._container=ze("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(v){const l=(g=!!this.options.geolocation)=>{this._supportsGeolocation=g,v(g)};void 0!==this._supportsGeolocation?v(this._supportsGeolocation):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(g=>l("denied"!==g.state)).catch(()=>l()):l()}_isOutOfMapMaxBounds(v){const l=this._map.getMaxBounds(),g=v.coords;return!!l&&(g.longitude<l.getWest()||g.longitude>l.getEast()||g.latitude<l.getSouth()||g.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(v){if(this._map){if(this._isOutOfMapMaxBounds(v))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",v)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=v,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(v),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(v),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",v)),this._finish()}}_updateCamera(v){const l=new p.LngLat(v.coords.longitude,v.coords.latitude),g=v.coords.accuracy,E=this._map.getBearing(),I=p.extend({bearing:E},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(g),I,{geolocateSource:!0})}_updateMarker(v){if(v){const l=new p.LngLat(v.coords.longitude,v.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=v.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const v=this._map.transform,l=p.mercatorZfromAltitude(1,v._center.lat)*v.worldSize,g=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(v){if(this._map){if(this.options.trackUserLocation)if(1===v.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===v.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",v)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(v){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=ze("button","mapboxgl-ctrl-geolocate",this._container),ze("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===v){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ze("div","mapboxgl-user-location"),this._dotElement.appendChild(ze("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ze("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new kn({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ze("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new kn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||"ACTIVE_LOCK"!==this._watchState||l.originalEvent&&"resize"===l.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}}_onDeviceOrientation(v){this._userLocationDotMarker&&(v.webkitCompassHeading?this._heading=v.webkitCompassHeading:!0===v.absolute&&(this._heading=-1*v.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let v;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(v={maximumAge:6e5,timeout:0},this._noTimeout=!0):(v=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,v),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const v=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(l=>{"granted"===l&&v()}).catch(console.error):v()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Sn,ScaleControl:class{constructor(v){this.options=p.extend({},zh,v),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),p.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const v=this.options.maxWidth||100,l=this._map,g=l._containerHeight/2,E=l._containerWidth/2-v/2,I=l.unproject([E,g]),A=l.unproject([E+v,g]),O=I.distanceTo(A);if("imperial"===this.options.unit){const k=3.2808*O;k>5280?this._setScale(v,k/5280,"mile"):this._setScale(v,k,"foot")}else"nautical"===this.options.unit?this._setScale(v,O/1852,"nautical-mile"):O>=1e3?this._setScale(v,O/1e3,"kilometer"):this._setScale(v,O,"meter")}_setScale(v,l,g){this._map._requestDomTask(()=>{const E=function(A){const O=Math.pow(10,`${Math.floor(A)}`.length-1);let k=A/O;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(U){const q=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*q)/q}(k),O*k}(l),I=E/l;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==g?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:g}).format(E):`${E}&nbsp;${op[g]}`,this._container.style.width=v*I+"px"})}onAdd(v){return this._map=v,this._language=v.getLanguage(),this._container=ze("div","mapboxgl-ctrl mapboxgl-ctrl-scale",v.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(v){this._language=v,this._update()}setUnit(v){this.options.unit=v,this._update()}},FullscreenControl:class{constructor(v){this._fullscreen=!1,v&&v.container&&(v.container instanceof p.window.HTMLElement?this._container=v.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=ze("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const v=this._fullscreenButton=ze("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ze("span","mapboxgl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",v)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(v){super(),this.options=p.extend(Object.create(Kp),v),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(v&&v.className?v.className.trim().split(/\s+/):[])}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&v.on("preclick",this._onClose),this.options.closeOnMove&&v.on("move",this._onClose),v.on("remove",this.remove),this._update(),v._addPopup(this),this._focusFirstElement(),this._trackPointer?(v.on("mousemove",this._onMouseEvent),v.on("mouseup",this._onMouseEvent),v._canvasContainer.classList.add("mapboxgl-track-pointer")):v.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const v=this._map;return v&&(v.off("move",this._update),v.off("move",this._onClose),v.off("preclick",this._onClose),v.off("click",this._onClose),v.off("remove",this.remove),v.off("mousemove",this._onMouseEvent),v.off("mouseup",this._onMouseEvent),v.off("drag",this._onMouseEvent),v._canvasContainer&&v._canvasContainer.classList.remove("mapboxgl-track-pointer"),v._removePopup(this),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(v){this._lngLat=p.LngLat.convert(v),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const v=this._map;return v&&(v.off("move",this._update),v.on("mousemove",this._onMouseEvent),v.on("drag",this._onMouseEvent),v._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(p.window.document.createTextNode(v))}setHTML(v){const l=p.window.document.createDocumentFragment(),g=p.window.document.createElement("body");let E;for(g.innerHTML=v;E=g.firstChild,E;)l.appendChild(E);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=ze("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(v),this.options.closeButton){const g=this._closeButton=ze("button","mapboxgl-popup-close-button",l);g.type="button",g.setAttribute("aria-label","Close popup"),g.setAttribute("aria-hidden","true"),g.innerHTML="&#215;",g.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(v){return this._classList.add(v),this._updateClassList(),this}removeClassName(v){return this._classList.delete(v),this._updateClassList(),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){let l;return this._classList.delete(v)?l=!1:(this._classList.add(v),l=!0),this._updateClassList(),l}_onMouseEvent(v){this._update(v.point)}_getAnchor(v){if(this.options.anchor)return this.options.anchor;const l=this._map,g=this._container,E=this._pos;if(!l||!g||!E)return"bottom";const I=g.offsetWidth,A=g.offsetHeight,O=E.x<I/2,k=E.x>l.transform.width-I/2;if(E.y+v<A)return O?"top-left":k?"top-right":"top";if(E.y>l.transform.height-A){if(O)return"bottom-left";if(k)return"bottom-right"}return O?"left":k?"right":"bottom"}_updateClassList(){const v=this._container;if(!v)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),v.className=l.join(" ")}_update(v){const l=this._map,g=this._content;if(!l||!this._lngLat&&!this._trackPointer||!g)return;let E=this._container;if(E||(E=this._container=ze("div","mapboxgl-popup",l.getContainer()),this._tip=ze("div","mapboxgl-popup-tip",E),E.appendChild(g)),this.options.maxWidth&&E.style.maxWidth!==this.options.maxWidth&&(E.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=uu(this._lngLat,this._pos,l.transform)),!this._trackPointer||v){const I=this._pos=this._trackPointer&&v?v:l.project(this._lngLat),A=Ll(this.options.offset),O=this._anchor=this._getAnchor(A.y),k=Ll(this.options.offset,O),U=I.add(k).round();l._requestDomTask(()=>{this._container&&O&&(this._container.style.transform=`${Rl[O]} translate(${U.x}px,${U.y}px)`)})}if(!this._marker&&l._showingGlobe()){const I=p.isLngLatBehindGlobe(l.transform,this._lngLat)?0:1;this._setOpacity(I)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(Wm);v&&v.focus()}_onClose(){this.remove()}_setOpacity(v){this._container&&(this._container.style.opacity=`${v}`),this._content&&(this._content.style.pointerEvents=v?"auto":"none")}},Marker:kn,Style:_o,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:fo,Evented:p.Evented,config:p.config,prewarm:function(){du().acquire(Cs)},clearPrewarmedResources:function(){const v=ai;v&&(v.isPreloaded()&&1===v.numActive()?(v.release(Cs),ai=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(v){p.config.ACCESS_TOKEN=v},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(v){p.config.API_URL=v},get workerCount(){return lo.workerCount},set workerCount(v){lo.workerCount=v},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(v){p.config.MAX_PARALLEL_IMAGE_REQUESTS=v},clearStorage(v){p.clearTileCache(v)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return Cf}),he}()},5943:bt=>{"use strict";var Qe=Object.getOwnPropertySymbols,pe=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;bt.exports=function _e(){try{if(!Object.assign)return!1;var p=new String("abc");if(p[5]="de","5"===Object.getOwnPropertyNames(p)[0])return!1;for(var H={},fe=0;fe<10;fe++)H["_"+String.fromCharCode(fe)]=fe;if("0123456789"!==Object.getOwnPropertyNames(H).map(function(ze){return H[ze]}).join(""))return!1;var Ie={};return"abcdefghijklmnopqrst".split("").forEach(function(ze){Ie[ze]=ze}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},Ie)).join("")}catch{return!1}}()?Object.assign:function(p,H){for(var fe,Ie,ve=function de(p){if(null==p)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(p)}(p),ze=1;ze<arguments.length;ze++){for(var _t in fe=Object(arguments[ze]))pe.call(fe,_t)&&(ve[_t]=fe[_t]);if(Qe){Ie=Qe(fe);for(var dt=0;dt<Ie.length;dt++)he.call(fe,Ie[dt])&&(ve[Ie[dt]]=fe[Ie[dt]])}}return ve}},1175:bt=>{"use strict";var Qe=function(pe){return pe!=pe};bt.exports=function(he,de){return 0===he&&0===de?1/he==1/de:!!(he===de||Qe(he)&&Qe(de))}},2e3:(bt,Qe,pe)=>{"use strict";var he=pe(2358),de=pe(5685),_e=pe(1175),p=pe(6305),H=pe(3859),fe=de(p(),Object);he(fe,{getPolyfill:p,implementation:_e,shim:H}),bt.exports=fe},6305:(bt,Qe,pe)=>{"use strict";var he=pe(1175);bt.exports=function(){return"function"==typeof Object.is?Object.is:he}},3859:(bt,Qe,pe)=>{"use strict";var he=pe(6305),de=pe(2358);bt.exports=function(){var p=he();return de(Object,{is:p},{is:function(){return Object.is!==p}}),p}},2450:(bt,Qe,pe)=>{"use strict";var he;if(!Object.keys){var de=Object.prototype.hasOwnProperty,_e=Object.prototype.toString,p=pe(9978),H=Object.prototype.propertyIsEnumerable,fe=!H.call({toString:null},"toString"),ve=H.call(function(){},"prototype"),Ie=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],ze=function(ht){var xt=ht.constructor;return xt&&xt.prototype===ht},_t={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},dt=function(){if(typeof window>"u")return!1;for(var ht in window)try{if(!_t["$"+ht]&&de.call(window,ht)&&null!==window[ht]&&"object"==typeof window[ht])try{ze(window[ht])}catch{return!0}}catch{return!0}return!1}();he=function(xt){var ie=null!==xt&&"object"==typeof xt,W="[object Function]"===_e.call(xt),J=p(xt),re=ie&&"[object String]"===_e.call(xt),Y=[];if(!ie&&!W&&!J)throw new TypeError("Object.keys called on a non-object");var ne=ve&&W;if(re&&xt.length>0&&!de.call(xt,0))for(var ee=0;ee<xt.length;++ee)Y.push(String(ee));if(J&&xt.length>0)for(var Z=0;Z<xt.length;++Z)Y.push(String(Z));else for(var me in xt)(!ne||"prototype"!==me)&&de.call(xt,me)&&Y.push(String(me));if(fe)for(var Q=function(ht){if(typeof window>"u"||!dt)return ze(ht);try{return ze(ht)}catch{return!1}}(xt),qe=0;qe<Ie.length;++qe)(!Q||"constructor"!==Ie[qe])&&de.call(xt,Ie[qe])&&Y.push(Ie[qe]);return Y}}bt.exports=he},1356:(bt,Qe,pe)=>{"use strict";var he=Array.prototype.slice,de=pe(9978),_e=Object.keys,p=_e?function(ve){return _e(ve)}:pe(2450),H=Object.keys;p.shim=function(){if(Object.keys){var ve=function(){var Ie=Object.keys(arguments);return Ie&&Ie.length===arguments.length}(1,2);ve||(Object.keys=function(ze){return de(ze)?H(he.call(ze)):H(ze)})}else Object.keys=p;return Object.keys||p},bt.exports=p},9978:bt=>{"use strict";var Qe=Object.prototype.toString;bt.exports=function(he){var de=Qe.call(he),_e="[object Arguments]"===de;return _e||(_e="[object Array]"!==de&&null!==he&&"object"==typeof he&&"number"==typeof he.length&&he.length>=0&&"[object Function]"===Qe.call(he.callee)),_e}},1766:bt=>{bt.exports=function(pe,he,de,_e){var p=pe[0],H=pe[1],fe=!1;void 0===de&&(de=0),void 0===_e&&(_e=he.length);for(var ve=(_e-de)/2,Ie=0,ze=ve-1;Ie<ve;ze=Ie++){var _t=he[de+2*Ie+0],dt=he[de+2*Ie+1],ht=he[de+2*ze+1];dt>H!=ht>H&&p<(he[de+2*ze+0]-_t)*(H-dt)/(ht-dt)+_t&&(fe=!fe)}return fe}},3870:(bt,Qe,pe)=>{var he=pe(1766),de=pe(2260);bt.exports=function(p,H,fe,ve){return H.length>0&&Array.isArray(H[0])?de(p,H,fe,ve):he(p,H,fe,ve)},bt.exports.nested=de,bt.exports.flat=he},2260:bt=>{bt.exports=function(pe,he,de,_e){var p=pe[0],H=pe[1],fe=!1;void 0===de&&(de=0),void 0===_e&&(_e=he.length);for(var ve=_e-de,Ie=0,ze=ve-1;Ie<ve;ze=Ie++){var _t=he[Ie+de][0],dt=he[Ie+de][1],ht=he[ze+de][1];dt>H!=ht>H&&p<(he[ze+de][0]-_t)*(H-dt)/(ht-dt)+_t&&(fe=!fe)}return fe}},9855:function(bt){bt.exports=function(){"use strict";function Qe(wt,Te){if(!(wt instanceof Te))throw new TypeError("Cannot call a class as a function")}function pe(wt,Te){for(var we=0;we<Te.length;we++){var xe=Te[we];xe.enumerable=xe.enumerable||!1,xe.configurable=!0,"value"in xe&&(xe.writable=!0),Object.defineProperty(wt,xe.key,xe)}}function he(wt,Te,we){return Te&&pe(wt.prototype,Te),we&&pe(wt,we),wt}var de=function wt(Te,we){this.next=null,this.key=Te,this.data=we,this.left=null,this.right=null};function _e(wt,Te){return wt>Te?1:wt<Te?-1:0}function p(wt,Te,we){for(var xe=new de(null,null),Ze=xe,yt=xe;;){var Vt=we(wt,Te.key);if(Vt<0){if(null===Te.left)break;if(we(wt,Te.left.key)<0&&(Te.left=(rn=Te.left).right,rn.right=Te,null===(Te=rn).left))break;yt.left=Te,yt=Te,Te=Te.left}else{if(!(Vt>0))break;if(null===Te.right)break;var rn;if(we(wt,Te.right.key)>0&&(Te.right=(rn=Te.right).left,rn.left=Te,null===(Te=rn).right))break;Ze.right=Te,Ze=Te,Te=Te.right}}return Ze.right=Te.left,yt.left=Te.right,Te.left=xe.right,Te.right=xe.left,Te}function H(wt,Te,we,xe){var Ze=new de(wt,Te);if(null===we)return Ze.left=Ze.right=null,Ze;var yt=xe(wt,(we=p(wt,we,xe)).key);return yt<0?(Ze.left=we.left,Ze.right=we,we.left=null):yt>=0&&(Ze.right=we.right,Ze.left=we,we.right=null),Ze}function fe(wt,Te,we){var xe=null,Ze=null;if(Te){var yt=we((Te=p(wt,Te,we)).key,wt);0===yt?(xe=Te.left,Ze=Te.right):yt<0?(Ze=Te.right,Te.right=null,xe=Te):(xe=Te.left,Te.left=null,Ze=Te)}return{left:xe,right:Ze}}function Ie(wt,Te,we,xe,Ze){if(wt){xe(Te+(we?"\u2514\u2500\u2500 ":"\u251c\u2500\u2500 ")+Ze(wt)+"\n");var yt=Te+(we?"    ":"\u2502   ");wt.left&&Ie(wt.left,yt,!1,xe,Ze),wt.right&&Ie(wt.right,yt,!0,xe,Ze)}}var ze=function(){function wt(Te){void 0===Te&&(Te=_e),this._root=null,this._size=0,this._comparator=Te}return wt.prototype.insert=function(Te,we){return this._size++,this._root=H(Te,we,this._root,this._comparator)},wt.prototype.add=function(Te,we){var xe=new de(Te,we);null===this._root&&(xe.left=xe.right=null,this._size++,this._root=xe);var Ze=this._comparator,yt=p(Te,this._root,Ze),Vt=Ze(Te,yt.key);return 0===Vt?this._root=yt:(Vt<0?(xe.left=yt.left,xe.right=yt,yt.left=null):Vt>0&&(xe.right=yt.right,xe.left=yt,yt.right=null),this._size++,this._root=xe),this._root},wt.prototype.remove=function(Te){this._root=this._remove(Te,this._root,this._comparator)},wt.prototype._remove=function(Te,we,xe){var Ze;return null===we?null:0===xe(Te,(we=p(Te,we,xe)).key)?(null===we.left?Ze=we.right:(Ze=p(Te,we.left,xe)).right=we.right,this._size--,Ze):we},wt.prototype.pop=function(){var Te=this._root;if(Te){for(;Te.left;)Te=Te.left;return this._root=p(Te.key,this._root,this._comparator),this._root=this._remove(Te.key,this._root,this._comparator),{key:Te.key,data:Te.data}}return null},wt.prototype.findStatic=function(Te){for(var we=this._root,xe=this._comparator;we;){var Ze=xe(Te,we.key);if(0===Ze)return we;we=Ze<0?we.left:we.right}return null},wt.prototype.find=function(Te){return this._root&&(this._root=p(Te,this._root,this._comparator),0!==this._comparator(Te,this._root.key))?null:this._root},wt.prototype.contains=function(Te){for(var we=this._root,xe=this._comparator;we;){var Ze=xe(Te,we.key);if(0===Ze)return!0;we=Ze<0?we.left:we.right}return!1},wt.prototype.forEach=function(Te,we){for(var xe=this._root,Ze=[],yt=!1;!yt;)null!==xe?(Ze.push(xe),xe=xe.left):0!==Ze.length?(xe=Ze.pop(),Te.call(we,xe),xe=xe.right):yt=!0;return this},wt.prototype.range=function(Te,we,xe,Ze){for(var yt=[],Vt=this._comparator,rn=this._root;0!==yt.length||rn;)if(rn)yt.push(rn),rn=rn.left;else{if(Vt((rn=yt.pop()).key,we)>0)break;if(Vt(rn.key,Te)>=0&&xe.call(Ze,rn))return this;rn=rn.right}return this},wt.prototype.keys=function(){var Te=[];return this.forEach(function(we){return Te.push(we.key)}),Te},wt.prototype.values=function(){var Te=[];return this.forEach(function(we){return Te.push(we.data)}),Te},wt.prototype.min=function(){return this._root?this.minNode(this._root).key:null},wt.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},wt.prototype.minNode=function(Te){if(void 0===Te&&(Te=this._root),Te)for(;Te.left;)Te=Te.left;return Te},wt.prototype.maxNode=function(Te){if(void 0===Te&&(Te=this._root),Te)for(;Te.right;)Te=Te.right;return Te},wt.prototype.at=function(Te){for(var we=this._root,xe=!1,Ze=0,yt=[];!xe;)if(we)yt.push(we),we=we.left;else if(yt.length>0){if(we=yt.pop(),Ze===Te)return we;Ze++,we=we.right}else xe=!0;return null},wt.prototype.next=function(Te){var we=this._root,xe=null;if(Te.right){for(xe=Te.right;xe.left;)xe=xe.left;return xe}for(var Ze=this._comparator;we;){var yt=Ze(Te.key,we.key);if(0===yt)break;yt<0?(xe=we,we=we.left):we=we.right}return xe},wt.prototype.prev=function(Te){var we=this._root,xe=null;if(null!==Te.left){for(xe=Te.left;xe.right;)xe=xe.right;return xe}for(var Ze=this._comparator;we;){var yt=Ze(Te.key,we.key);if(0===yt)break;yt<0?we=we.left:(xe=we,we=we.right)}return xe},wt.prototype.clear=function(){return this._root=null,this._size=0,this},wt.prototype.toList=function(){return function Je(wt){for(var Te=wt,we=[],xe=!1,Ze=new de(null,null),yt=Ze;!xe;)Te?(we.push(Te),Te=Te.left):we.length>0?Te=(Te=yt=yt.next=we.pop()).right:xe=!0;return yt.next=null,Ze.next}(this._root)},wt.prototype.load=function(Te,we,xe){void 0===we&&(we=[]),void 0===xe&&(xe=!1);var Ze=Te.length,yt=this._comparator;if(xe&&ie(Te,we,0,Ze-1,yt),null===this._root)this._root=_t(Te,we,0,Ze),this._size=Ze;else{var Vt=function xt(wt,Te,we){for(var xe=new de(null,null),Ze=xe,yt=wt,Vt=Te;null!==yt&&null!==Vt;)we(yt.key,Vt.key)<0?(Ze.next=yt,yt=yt.next):(Ze.next=Vt,Vt=Vt.next),Ze=Ze.next;return null!==yt?Ze.next=yt:null!==Vt&&(Ze.next=Vt),xe.next}(this.toList(),function dt(wt,Te){for(var we=new de(null,null),xe=we,Ze=0;Ze<wt.length;Ze++)xe=xe.next=new de(wt[Ze],Te[Ze]);return xe.next=null,we.next}(Te,we),yt);this._root=ht({head:Vt},0,Ze=this._size+Ze)}return this},wt.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(wt.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(wt.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),wt.prototype.toString=function(Te){void 0===Te&&(Te=function(Ze){return String(Ze.key)});var we=[];return Ie(this._root,"",!0,function(xe){return we.push(xe)},Te),we.join("")},wt.prototype.update=function(Te,we,xe){var Ze=this._comparator,yt=fe(Te,this._root,Ze),Vt=yt.left,rn=yt.right;Ze(Te,we)<0?rn=H(we,xe,rn,Ze):Vt=H(we,xe,Vt,Ze),this._root=function ve(wt,Te,we){return null===Te?wt:(null===wt||((Te=p(wt.key,Te,we)).left=wt),Te)}(Vt,rn,Ze)},wt.prototype.split=function(Te){return fe(Te,this._root,this._comparator)},wt}();function _t(wt,Te,we,xe){var Ze=xe-we;if(Ze>0){var yt=we+Math.floor(Ze/2),tn=new de(wt[yt],Te[yt]);return tn.left=_t(wt,Te,we,yt),tn.right=_t(wt,Te,yt+1,xe),tn}return null}function ht(wt,Te,we){var xe=we-Te;if(xe>0){var Ze=Te+Math.floor(xe/2),yt=ht(wt,Te,Ze),Vt=wt.head;return Vt.left=yt,wt.head=wt.head.next,Vt.right=ht(wt,Ze+1,we),Vt}return null}function ie(wt,Te,we,xe,Ze){if(!(we>=xe)){for(var yt=wt[we+xe>>1],Vt=we-1,rn=xe+1;;){do{Vt++}while(Ze(wt[Vt],yt)<0);do{rn--}while(Ze(wt[rn],yt)>0);if(Vt>=rn)break;var tn=wt[Vt];wt[Vt]=wt[rn],wt[rn]=tn,tn=Te[Vt],Te[Vt]=Te[rn],Te[rn]=tn}ie(wt,Te,we,rn,Ze),ie(wt,Te,rn+1,xe,Ze)}}var W=function(Te,we){return Te.ll.x<=we.x&&we.x<=Te.ur.x&&Te.ll.y<=we.y&&we.y<=Te.ur.y},J=function(Te,we){return we.ur.x<Te.ll.x||Te.ur.x<we.ll.x||we.ur.y<Te.ll.y||Te.ur.y<we.ll.y?null:{ll:{x:Te.ll.x<we.ll.x?we.ll.x:Te.ll.x,y:Te.ll.y<we.ll.y?we.ll.y:Te.ll.y},ur:{x:Te.ur.x<we.ur.x?Te.ur.x:we.ur.x,y:Te.ur.y<we.ur.y?Te.ur.y:we.ur.y}}},re=Number.EPSILON;void 0===re&&(re=Math.pow(2,-52));var Y=re*re,ne=function(Te,we){if(-re<Te&&Te<re&&-re<we&&we<re)return 0;var xe=Te-we;return xe*xe<Y*Te*we?0:Te<we?-1:1},ee=function(){function wt(){Qe(this,wt),this.reset()}return he(wt,[{key:"reset",value:function(){this.xRounder=new Z,this.yRounder=new Z}},{key:"round",value:function(we,xe){return{x:this.xRounder.round(we),y:this.yRounder.round(xe)}}}]),wt}(),Z=function(){function wt(){Qe(this,wt),this.tree=new ze,this.round(0)}return he(wt,[{key:"round",value:function(we){var xe=this.tree.add(we),Ze=this.tree.prev(xe);if(null!==Ze&&0===ne(xe.key,Ze.key))return this.tree.remove(we),Ze.key;var yt=this.tree.next(xe);return null!==yt&&0===ne(xe.key,yt.key)?(this.tree.remove(we),yt.key):we}}]),wt}(),me=new ee,Q=function(Te,we){return Te.x*we.y-Te.y*we.x},qe=function(Te,we){return Te.x*we.x+Te.y*we.y},Ue=function(Te,we,xe){var Vt=Q({x:we.x-Te.x,y:we.y-Te.y},{x:xe.x-Te.x,y:xe.y-Te.y});return ne(Vt,0)},Ye=function(Te){return Math.sqrt(qe(Te,Te))},Ae=function(Te,we,xe){var Ze={x:we.x-Te.x,y:we.y-Te.y},yt={x:xe.x-Te.x,y:xe.y-Te.y};return Q(yt,Ze)/Ye(yt)/Ye(Ze)},Wt=function(Te,we,xe){var Ze={x:we.x-Te.x,y:we.y-Te.y},yt={x:xe.x-Te.x,y:xe.y-Te.y};return qe(yt,Ze)/Ye(yt)/Ye(Ze)},At=function(Te,we,xe){return 0===we.y?null:{x:Te.x+we.x/we.y*(xe-Te.y),y:xe}},De=function(Te,we,xe){return 0===we.x?null:{x:xe,y:Te.y+we.y/we.x*(xe-Te.x)}},Fe=function(){function wt(Te,we){Qe(this,wt),void 0===Te.events?Te.events=[this]:Te.events.push(this),this.point=Te,this.isLeft=we}return he(wt,null,[{key:"compare",value:function(we,xe){var Ze=wt.comparePoints(we.point,xe.point);return 0!==Ze?Ze:(we.point!==xe.point&&we.link(xe),we.isLeft!==xe.isLeft?we.isLeft?1:-1:vt.compare(we.segment,xe.segment))}},{key:"comparePoints",value:function(we,xe){return we.x<xe.x?-1:we.x>xe.x?1:we.y<xe.y?-1:we.y>xe.y?1:0}}]),he(wt,[{key:"link",value:function(we){if(we.point===this.point)throw new Error("Tried to link already linked events");for(var xe=we.point.events,Ze=0,yt=xe.length;Ze<yt;Ze++){var Vt=xe[Ze];this.point.events.push(Vt),Vt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var we=this.point.events.length,xe=0;xe<we;xe++){var Ze=this.point.events[xe];if(void 0===Ze.segment.consumedBy)for(var yt=xe+1;yt<we;yt++){var Vt=this.point.events[yt];void 0===Vt.consumedBy&&Ze.otherSE.point.events===Vt.otherSE.point.events&&Ze.segment.consume(Vt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var we=[],xe=0,Ze=this.point.events.length;xe<Ze;xe++){var yt=this.point.events[xe];yt!==this&&!yt.segment.ringOut&&yt.segment.isInResult()&&we.push(yt)}return we}},{key:"getLeftmostComparator",value:function(we){var xe=this,Ze=new Map,yt=function(rn){var tn=rn.otherSE;Ze.set(rn,{sine:Ae(xe.point,we.point,tn.point),cosine:Wt(xe.point,we.point,tn.point)})};return function(Vt,rn){Ze.has(Vt)||yt(Vt),Ze.has(rn)||yt(rn);var tn=Ze.get(Vt),Gt=tn.sine,hr=tn.cosine,yr=Ze.get(rn),Tn=yr.sine,br=yr.cosine;return Gt>=0&&Tn>=0?hr<br?1:hr>br?-1:0:Gt<0&&Tn<0?hr<br?-1:hr>br?1:0:Tn<Gt?-1:Tn>Gt?1:0}}}]),wt}(),at=0,vt=function(){function wt(Te,we,xe,Ze){Qe(this,wt),this.id=++at,this.leftSE=Te,Te.segment=this,Te.otherSE=we,this.rightSE=we,we.segment=this,we.otherSE=Te,this.rings=xe,this.windings=Ze}return he(wt,null,[{key:"compare",value:function(we,xe){var Ze=we.leftSE.point.x,yt=xe.leftSE.point.x,Vt=we.rightSE.point.x,rn=xe.rightSE.point.x;if(rn<Ze)return 1;if(Vt<yt)return-1;var tn=we.leftSE.point.y,Gt=xe.leftSE.point.y,hr=we.rightSE.point.y,yr=xe.rightSE.point.y;if(Ze<yt){if(Gt<tn&&Gt<hr)return 1;if(Gt>tn&&Gt>hr)return-1;var Tn=we.comparePoint(xe.leftSE.point);if(Tn<0)return 1;if(Tn>0)return-1;var br=xe.comparePoint(we.rightSE.point);return 0!==br?br:-1}if(Ze>yt){if(tn<Gt&&tn<yr)return-1;if(tn>Gt&&tn>yr)return 1;var si=xe.comparePoint(we.leftSE.point);if(0!==si)return si;var zr=we.comparePoint(xe.rightSE.point);return zr<0?1:zr>0?-1:1}if(tn<Gt)return-1;if(tn>Gt)return 1;if(Vt<rn){var ni=xe.comparePoint(we.rightSE.point);if(0!==ni)return ni}if(Vt>rn){var Ii=we.comparePoint(xe.rightSE.point);if(Ii<0)return 1;if(Ii>0)return-1}if(Vt!==rn){var Uo=hr-tn,ys=Vt-Ze,Ke=yr-Gt,ge=rn-yt;if(Uo>ys&&Ke<ge)return 1;if(Uo<ys&&Ke>ge)return-1}return Vt>rn?1:Vt<rn||hr<yr?-1:hr>yr?1:we.id<xe.id?-1:we.id>xe.id?1:0}}]),he(wt,[{key:"replaceRightSE",value:function(we){this.rightSE=we,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var we=this.leftSE.point.y,xe=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:we<xe?we:xe},ur:{x:this.rightSE.point.x,y:we>xe?we:xe}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(we){return we.x===this.leftSE.point.x&&we.y===this.leftSE.point.y||we.x===this.rightSE.point.x&&we.y===this.rightSE.point.y}},{key:"comparePoint",value:function(we){if(this.isAnEndpoint(we))return 0;var xe=this.leftSE.point,Ze=this.rightSE.point,yt=this.vector();if(xe.x===Ze.x)return we.x===xe.x?0:we.x<xe.x?1:-1;if(we.x===xe.x+(we.y-xe.y)/yt.y*yt.x)return 0;var Gt=xe.y+(we.x-xe.x)/yt.x*yt.y;return we.y===Gt?0:we.y<Gt?-1:1}},{key:"getIntersection",value:function(we){var xe=this.bbox(),Ze=we.bbox(),yt=J(xe,Ze);if(null===yt)return null;var Vt=this.leftSE.point,rn=this.rightSE.point,tn=we.leftSE.point,Gt=we.rightSE.point,hr=W(xe,tn)&&0===this.comparePoint(tn),yr=W(Ze,Vt)&&0===we.comparePoint(Vt),Tn=W(xe,Gt)&&0===this.comparePoint(Gt),br=W(Ze,rn)&&0===we.comparePoint(rn);if(yr&&hr)return br&&!Tn?rn:!br&&Tn?Gt:null;if(yr)return Tn&&Vt.x===Gt.x&&Vt.y===Gt.y?null:Vt;if(hr)return br&&rn.x===tn.x&&rn.y===tn.y?null:tn;if(br&&Tn)return null;if(br)return rn;if(Tn)return Gt;var si=function(Te,we,xe,Ze){if(0===we.x)return De(xe,Ze,Te.x);if(0===Ze.x)return De(Te,we,xe.x);if(0===we.y)return At(xe,Ze,Te.y);if(0===Ze.y)return At(Te,we,xe.y);var yt=Q(we,Ze);if(0==yt)return null;var Vt={x:xe.x-Te.x,y:xe.y-Te.y},rn=Q(Vt,we)/yt,tn=Q(Vt,Ze)/yt;return{x:(Te.x+tn*we.x+(xe.x+rn*Ze.x))/2,y:(Te.y+tn*we.y+(xe.y+rn*Ze.y))/2}}(Vt,this.vector(),tn,we.vector());return null!==si&&W(yt,si)?me.round(si.x,si.y):null}},{key:"split",value:function(we){var xe=[],Ze=void 0!==we.events,yt=new Fe(we,!0),Vt=new Fe(we,!1),rn=this.rightSE;this.replaceRightSE(Vt),xe.push(Vt),xe.push(yt);var tn=new wt(yt,rn,this.rings.slice(),this.windings.slice());return Fe.comparePoints(tn.leftSE.point,tn.rightSE.point)>0&&tn.swapEvents(),Fe.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Ze&&(yt.checkForConsuming(),Vt.checkForConsuming()),xe}},{key:"swapEvents",value:function(){var we=this.rightSE;this.rightSE=this.leftSE,this.leftSE=we,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var xe=0,Ze=this.windings.length;xe<Ze;xe++)this.windings[xe]*=-1}},{key:"consume",value:function(we){for(var xe=this,Ze=we;xe.consumedBy;)xe=xe.consumedBy;for(;Ze.consumedBy;)Ze=Ze.consumedBy;var yt=wt.compare(xe,Ze);if(0!==yt){if(yt>0){var Vt=xe;xe=Ze,Ze=Vt}if(xe.prev===Ze){var rn=xe;xe=Ze,Ze=rn}for(var tn=0,Gt=Ze.rings.length;tn<Gt;tn++){var hr=Ze.rings[tn],yr=Ze.windings[tn],Tn=xe.rings.indexOf(hr);-1===Tn?(xe.rings.push(hr),xe.windings.push(yr)):xe.windings[Tn]+=yr}Ze.rings=null,Ze.windings=null,Ze.consumedBy=xe,Ze.leftSE.consumedBy=xe.leftSE,Ze.rightSE.consumedBy=xe.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this._prevInResult=this.prev?this.prev.isInResult()?this.prev:this.prev.prevInResult():null),this._prevInResult}},{key:"beforeState",value:function(){return void 0!==this._beforeState||(this._beforeState=this.prev?(this.prev.consumedBy||this.prev).afterState():{rings:[],windings:[],multiPolys:[]}),this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var we=this.beforeState();this._afterState={rings:we.rings.slice(0),windings:we.windings.slice(0),multiPolys:[]};for(var xe=this._afterState.rings,Ze=this._afterState.windings,yt=this._afterState.multiPolys,Vt=0,rn=this.rings.length;Vt<rn;Vt++){var tn=this.rings[Vt],Gt=this.windings[Vt],hr=xe.indexOf(tn);-1===hr?(xe.push(tn),Ze.push(Gt)):Ze[hr]+=Gt}for(var yr=[],Tn=[],br=0,si=xe.length;br<si;br++)if(0!==Ze[br]){var zr=xe[br],ni=zr.poly;if(-1===Tn.indexOf(ni))if(zr.isExterior)yr.push(ni);else{-1===Tn.indexOf(ni)&&Tn.push(ni);var Ii=yr.indexOf(zr.poly);-1!==Ii&&yr.splice(Ii,1)}}for(var Uo=0,ys=yr.length;Uo<ys;Uo++){var Ke=yr[Uo].multiPoly;-1===yt.indexOf(Ke)&&yt.push(Ke)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var we=this.beforeState().multiPolys,xe=this.afterState().multiPolys;switch(sn.type){case"union":this._isInResult=0===we.length!=(0===xe.length);break;case"intersection":var Vt,rn;we.length<xe.length?(Vt=we.length,rn=xe.length):(Vt=xe.length,rn=we.length),this._isInResult=rn===sn.numMultiPolys&&Vt<rn;break;case"xor":var tn=Math.abs(we.length-xe.length);this._isInResult=tn%2==1;break;case"difference":var Gt=function(yr){return 1===yr.length&&yr[0].isSubject};this._isInResult=Gt(we)!==Gt(xe);break;default:throw new Error("Unrecognized operation type found ".concat(sn.type))}return this._isInResult}}],[{key:"fromRing",value:function(we,xe,Ze){var yt,Vt,rn,tn=Fe.comparePoints(we,xe);if(tn<0)yt=we,Vt=xe,rn=1;else{if(!(tn>0))throw new Error("Tried to create degenerate segment at [".concat(we.x,", ").concat(we.y,"]"));yt=xe,Vt=we,rn=-1}return new wt(new Fe(yt,!0),new Fe(Vt,!1),[Ze],[rn])}}]),wt}(),Le=function(){function wt(Te,we,xe){if(Qe(this,wt),!Array.isArray(Te)||0===Te.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=we,this.isExterior=xe,this.segments=[],"number"!=typeof Te[0][0]||"number"!=typeof Te[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Ze=me.round(Te[0][0],Te[0][1]);this.bbox={ll:{x:Ze.x,y:Ze.y},ur:{x:Ze.x,y:Ze.y}};for(var yt=Ze,Vt=1,rn=Te.length;Vt<rn;Vt++){if("number"!=typeof Te[Vt][0]||"number"!=typeof Te[Vt][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var tn=me.round(Te[Vt][0],Te[Vt][1]);tn.x===yt.x&&tn.y===yt.y||(this.segments.push(vt.fromRing(yt,tn,this)),tn.x<this.bbox.ll.x&&(this.bbox.ll.x=tn.x),tn.y<this.bbox.ll.y&&(this.bbox.ll.y=tn.y),tn.x>this.bbox.ur.x&&(this.bbox.ur.x=tn.x),tn.y>this.bbox.ur.y&&(this.bbox.ur.y=tn.y),yt=tn)}(Ze.x!==yt.x||Ze.y!==yt.y)&&this.segments.push(vt.fromRing(yt,Ze,this))}return he(wt,[{key:"getSweepEvents",value:function(){for(var we=[],xe=0,Ze=this.segments.length;xe<Ze;xe++){var yt=this.segments[xe];we.push(yt.leftSE),we.push(yt.rightSE)}return we}}]),wt}(),Ut=function(){function wt(Te,we){if(Qe(this,wt),!Array.isArray(Te))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Le(Te[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var xe=1,Ze=Te.length;xe<Ze;xe++){var yt=new Le(Te[xe],this,!1);yt.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=yt.bbox.ll.x),yt.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=yt.bbox.ll.y),yt.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=yt.bbox.ur.x),yt.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=yt.bbox.ur.y),this.interiorRings.push(yt)}this.multiPoly=we}return he(wt,[{key:"getSweepEvents",value:function(){for(var we=this.exteriorRing.getSweepEvents(),xe=0,Ze=this.interiorRings.length;xe<Ze;xe++)for(var yt=this.interiorRings[xe].getSweepEvents(),Vt=0,rn=yt.length;Vt<rn;Vt++)we.push(yt[Vt]);return we}}]),wt}(),zt=function(){function wt(Te,we){if(Qe(this,wt),!Array.isArray(Te))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof Te[0][0][0]&&(Te=[Te])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var xe=0,Ze=Te.length;xe<Ze;xe++){var yt=new Ut(Te[xe],this);yt.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=yt.bbox.ll.x),yt.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=yt.bbox.ll.y),yt.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=yt.bbox.ur.x),yt.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=yt.bbox.ur.y),this.polys.push(yt)}this.isSubject=we}return he(wt,[{key:"getSweepEvents",value:function(){for(var we=[],xe=0,Ze=this.polys.length;xe<Ze;xe++)for(var yt=this.polys[xe].getSweepEvents(),Vt=0,rn=yt.length;Vt<rn;Vt++)we.push(yt[Vt]);return we}}]),wt}(),gn=function(){function wt(Te){Qe(this,wt),this.events=Te;for(var we=0,xe=Te.length;we<xe;we++)Te[we].segment.ringOut=this;this.poly=null}return he(wt,null,[{key:"factory",value:function(we){for(var xe=[],Ze=0,yt=we.length;Ze<yt;Ze++){var Vt=we[Ze];if(Vt.isInResult()&&!Vt.ringOut){for(var rn=null,tn=Vt.leftSE,Gt=Vt.rightSE,hr=[tn],yr=tn.point,Tn=[];rn=tn,hr.push(tn=Gt),tn.point!==yr;)for(;;){var br=tn.getAvailableLinkedEvents();if(0===br.length){var si=hr[0].point,zr=hr[hr.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(si.x,",")+" ".concat(si.y,"]. Last matching segment found ends at")+" [".concat(zr.x,", ").concat(zr.y,"]."))}if(1===br.length){Gt=br[0].otherSE;break}for(var ni=null,Ii=0,Uo=Tn.length;Ii<Uo;Ii++)if(Tn[Ii].point===tn.point){ni=Ii;break}if(null===ni){Tn.push({index:hr.length,point:tn.point});var ge=tn.getLeftmostComparator(rn);Gt=br.sort(ge)[0].otherSE;break}var ys=Tn.splice(ni)[0],Ke=hr.splice(ys.index);Ke.unshift(Ke[0].otherSE),xe.push(new wt(Ke.reverse()))}xe.push(new wt(hr))}}return xe}}]),he(wt,[{key:"getGeom",value:function(){for(var we=this.events[0].point,xe=[we],Ze=1,yt=this.events.length-1;Ze<yt;Ze++){var Vt=this.events[Ze].point;0!==Ue(Vt,we,this.events[Ze+1].point)&&(xe.push(Vt),we=Vt)}if(1===xe.length)return null;0===Ue(xe[0],we,xe[1])&&xe.shift(),xe.push(xe[0]);for(var hr=this.isExteriorRing()?1:-1,yr=this.isExteriorRing()?0:xe.length-1,Tn=this.isExteriorRing()?xe.length:-1,br=[],si=yr;si!=Tn;si+=hr)br.push([xe[si].x,xe[si].y]);return br}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var we=this.enclosingRing();this._isExteriorRing=!we||!we.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var we=this.events[0],xe=1,Ze=this.events.length;xe<Ze;xe++){var yt=this.events[xe];Fe.compare(we,yt)>0&&(we=yt)}for(var Vt=we.segment.prevInResult(),rn=Vt?Vt.prevInResult():null;;){if(!Vt)return null;if(!rn)return Vt.ringOut;if(rn.ringOut!==Vt.ringOut)return rn.ringOut.enclosingRing()!==Vt.ringOut?Vt.ringOut:Vt.ringOut.enclosingRing();Vt=rn.prevInResult(),rn=Vt?Vt.prevInResult():null}}}]),wt}(),Dt=function(){function wt(Te){Qe(this,wt),this.exteriorRing=Te,Te.poly=this,this.interiorRings=[]}return he(wt,[{key:"addInterior",value:function(we){this.interiorRings.push(we),we.poly=this}},{key:"getGeom",value:function(){var we=[this.exteriorRing.getGeom()];if(null===we[0])return null;for(var xe=0,Ze=this.interiorRings.length;xe<Ze;xe++){var yt=this.interiorRings[xe].getGeom();null!==yt&&we.push(yt)}return we}}]),wt}(),Un=function(){function wt(Te){Qe(this,wt),this.rings=Te,this.polys=this._composePolys(Te)}return he(wt,[{key:"getGeom",value:function(){for(var we=[],xe=0,Ze=this.polys.length;xe<Ze;xe++){var yt=this.polys[xe].getGeom();null!==yt&&we.push(yt)}return we}},{key:"_composePolys",value:function(we){for(var xe=[],Ze=0,yt=we.length;Ze<yt;Ze++){var Vt=we[Ze];if(!Vt.poly)if(Vt.isExteriorRing())xe.push(new Dt(Vt));else{var rn=Vt.enclosingRing();rn.poly||xe.push(new Dt(rn)),rn.poly.addInterior(Vt)}}return xe}}]),wt}(),_n=function(){function wt(Te){var we=arguments.length>1&&void 0!==arguments[1]?arguments[1]:vt.compare;Qe(this,wt),this.queue=Te,this.tree=new ze(we),this.segments=[]}return he(wt,[{key:"process",value:function(we){var xe=we.segment,Ze=[];if(we.consumedBy)return we.isLeft?this.queue.remove(we.otherSE):this.tree.remove(xe),Ze;var yt=we.isLeft?this.tree.insert(xe):this.tree.find(xe);if(!yt)throw new Error("Unable to find segment #".concat(xe.id," ")+"[".concat(xe.leftSE.point.x,", ").concat(xe.leftSE.point.y,"] -> ")+"[".concat(xe.rightSE.point.x,", ").concat(xe.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var Vt=yt,rn=yt,tn=void 0,Gt=void 0;void 0===tn;)null===(Vt=this.tree.prev(Vt))?tn=null:void 0===Vt.key.consumedBy&&(tn=Vt.key);for(;void 0===Gt;)null===(rn=this.tree.next(rn))?Gt=null:void 0===rn.key.consumedBy&&(Gt=rn.key);if(we.isLeft){var hr=null;if(tn){var yr=tn.getIntersection(xe);if(null!==yr&&(xe.isAnEndpoint(yr)||(hr=yr),!tn.isAnEndpoint(yr)))for(var Tn=this._splitSafely(tn,yr),br=0,si=Tn.length;br<si;br++)Ze.push(Tn[br])}var zr=null;if(Gt){var ni=Gt.getIntersection(xe);if(null!==ni&&(xe.isAnEndpoint(ni)||(zr=ni),!Gt.isAnEndpoint(ni)))for(var Ii=this._splitSafely(Gt,ni),Uo=0,ys=Ii.length;Uo<ys;Uo++)Ze.push(Ii[Uo])}if(null!==hr||null!==zr){var Ke;Ke=null===hr?zr:null===zr||Fe.comparePoints(hr,zr)<=0?hr:zr,this.queue.remove(xe.rightSE),Ze.push(xe.rightSE);for(var ye=xe.split(Ke),We=0,rt=ye.length;We<rt;We++)Ze.push(ye[We])}Ze.length>0?(this.tree.remove(xe),Ze.push(we)):(this.segments.push(xe),xe.prev=tn)}else{if(tn&&Gt){var Ve=tn.getIntersection(Gt);if(null!==Ve){if(!tn.isAnEndpoint(Ve))for(var It=this._splitSafely(tn,Ve),Ct=0,tt=It.length;Ct<tt;Ct++)Ze.push(It[Ct]);if(!Gt.isAnEndpoint(Ve))for(var Ft=this._splitSafely(Gt,Ve),hn=0,bn=Ft.length;hn<bn;hn++)Ze.push(Ft[hn])}}this.tree.remove(xe)}return Ze}},{key:"_splitSafely",value:function(we,xe){this.tree.remove(we);var Ze=we.rightSE;this.queue.remove(Ze);var yt=we.split(xe);return yt.push(Ze),void 0===we.consumedBy&&this.tree.insert(we),yt}}]),wt}(),Cn=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,cn=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,sn=new(function(){function wt(){Qe(this,wt)}return he(wt,[{key:"run",value:function(we,xe,Ze){sn.type=we,me.reset();for(var yt=[new zt(xe,!0)],Vt=0,rn=Ze.length;Vt<rn;Vt++)yt.push(new zt(Ze[Vt],!1));if(sn.numMultiPolys=yt.length,"difference"===sn.type)for(var tn=yt[0],Gt=1;Gt<yt.length;)null!==J(yt[Gt].bbox,tn.bbox)?Gt++:yt.splice(Gt,1);if("intersection"===sn.type)for(var hr=0,yr=yt.length;hr<yr;hr++)for(var Tn=yt[hr],br=hr+1,si=yt.length;br<si;br++)if(null===J(Tn.bbox,yt[br].bbox))return[];for(var zr=new ze(Fe.compare),ni=0,Ii=yt.length;ni<Ii;ni++)for(var Uo=yt[ni].getSweepEvents(),ys=0,Ke=Uo.length;ys<Ke;ys++)if(zr.insert(Uo[ys]),zr.size>Cn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var ge=new _n(zr),ye=zr.size,We=zr.pop();We;){var rt=We.key;if(zr.size===ye){var Ve=rt.segment;throw new Error("Unable to pop() ".concat(rt.isLeft?"left":"right"," SweepEvent ")+"[".concat(rt.point.x,", ").concat(rt.point.y,"] from segment #").concat(Ve.id," ")+"[".concat(Ve.leftSE.point.x,", ").concat(Ve.leftSE.point.y,"] -> ")+"[".concat(Ve.rightSE.point.x,", ").concat(Ve.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(zr.size>Cn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(ge.segments.length>cn)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var It=ge.process(rt),Ct=0,tt=It.length;Ct<tt;Ct++){var Ft=It[Ct];void 0===Ft.consumedBy&&zr.insert(Ft)}ye=zr.size,We=zr.pop()}me.reset();var hn=gn.factory(ge.segments);return new Un(hn).getGeom()}}]),wt}());return{union:function(Te){for(var we=arguments.length,xe=new Array(we>1?we-1:0),Ze=1;Ze<we;Ze++)xe[Ze-1]=arguments[Ze];return sn.run("union",Te,xe)},intersection:function(Te){for(var we=arguments.length,xe=new Array(we>1?we-1:0),Ze=1;Ze<we;Ze++)xe[Ze-1]=arguments[Ze];return sn.run("intersection",Te,xe)},xor:function(Te){for(var we=arguments.length,xe=new Array(we>1?we-1:0),Ze=1;Ze<we;Ze++)xe[Ze-1]=arguments[Ze];return sn.run("xor",Te,xe)},difference:function(Te){for(var we=arguments.length,xe=new Array(we>1?we-1:0),Ze=1;Ze<we;Ze++)xe[Ze-1]=arguments[Ze];return sn.run("difference",Te,xe)}}}()},3544:(bt,Qe,pe)=>{"use strict";bt.exports=de,bt.exports.default=de;var he=pe(6709);function de(J,re){if(!(this instanceof de))return new de(J,re);this._maxEntries=Math.max(4,J||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),re&&this._initFormat(re),this.clear()}function _e(J,re,Y){if(!Y)return re.indexOf(J);for(var ne=0;ne<re.length;ne++)if(Y(J,re[ne]))return ne;return-1}function p(J,re){H(J,0,J.children.length,re,J)}function H(J,re,Y,ne,ee){ee||(ee=ie(null)),ee.minX=1/0,ee.minY=1/0,ee.maxX=-1/0,ee.maxY=-1/0;for(var me,Z=re;Z<Y;Z++)me=J.children[Z],fe(ee,J.leaf?ne(me):me);return ee}function fe(J,re){return J.minX=Math.min(J.minX,re.minX),J.minY=Math.min(J.minY,re.minY),J.maxX=Math.max(J.maxX,re.maxX),J.maxY=Math.max(J.maxY,re.maxY),J}function ve(J,re){return J.minX-re.minX}function Ie(J,re){return J.minY-re.minY}function ze(J){return(J.maxX-J.minX)*(J.maxY-J.minY)}function _t(J){return J.maxX-J.minX+(J.maxY-J.minY)}function dt(J,re){return(Math.max(re.maxX,J.maxX)-Math.min(re.minX,J.minX))*(Math.max(re.maxY,J.maxY)-Math.min(re.minY,J.minY))}function Je(J,re){var Y=Math.max(J.minX,re.minX),ne=Math.max(J.minY,re.minY),ee=Math.min(J.maxX,re.maxX),Z=Math.min(J.maxY,re.maxY);return Math.max(0,ee-Y)*Math.max(0,Z-ne)}function ht(J,re){return J.minX<=re.minX&&J.minY<=re.minY&&re.maxX<=J.maxX&&re.maxY<=J.maxY}function xt(J,re){return re.minX<=J.maxX&&re.minY<=J.maxY&&re.maxX>=J.minX&&re.maxY>=J.minY}function ie(J){return{children:J,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function W(J,re,Y,ne,ee){for(var me,Z=[re,Y];Z.length;)!((Y=Z.pop())-(re=Z.pop())<=ne)&&(me=re+Math.ceil((Y-re)/ne/2)*ne,he(J,me,re,Y,ee),Z.push(re,me,me,Y))}de.prototype={all:function(){return this._all(this.data,[])},search:function(J){var re=this.data,Y=[],ne=this.toBBox;if(!xt(J,re))return Y;for(var Z,me,Q,qe,ee=[];re;){for(Z=0,me=re.children.length;Z<me;Z++)Q=re.children[Z],xt(J,qe=re.leaf?ne(Q):Q)&&(re.leaf?Y.push(Q):ht(J,qe)?this._all(Q,Y):ee.push(Q));re=ee.pop()}return Y},collides:function(J){var re=this.data,Y=this.toBBox;if(!xt(J,re))return!1;for(var ee,Z,me,Q,ne=[];re;){for(ee=0,Z=re.children.length;ee<Z;ee++)if(me=re.children[ee],xt(J,Q=re.leaf?Y(me):me)){if(re.leaf||ht(J,Q))return!0;ne.push(me)}re=ne.pop()}return!1},load:function(J){if(!J||!J.length)return this;if(J.length<this._minEntries){for(var re=0,Y=J.length;re<Y;re++)this.insert(J[re]);return this}var ne=this._build(J.slice(),0,J.length-1,0);if(this.data.children.length)if(this.data.height===ne.height)this._splitRoot(this.data,ne);else{if(this.data.height<ne.height){var ee=this.data;this.data=ne,ne=ee}this._insert(ne,this.data.height-ne.height-1,!0)}else this.data=ne;return this},insert:function(J){return J&&this._insert(J,this.data.height-1),this},clear:function(){return this.data=ie([]),this},remove:function(J,re){if(!J)return this;for(var me,Q,qe,Ue,Y=this.data,ne=this.toBBox(J),ee=[],Z=[];Y||ee.length;){if(Y||(Y=ee.pop(),Q=ee[ee.length-1],me=Z.pop(),Ue=!0),Y.leaf&&-1!==(qe=_e(J,Y.children,re)))return Y.children.splice(qe,1),ee.push(Y),this._condense(ee),this;Ue||Y.leaf||!ht(Y,ne)?Q?(me++,Y=Q.children[me],Ue=!1):Y=null:(ee.push(Y),Z.push(me),me=0,Q=Y,Y=Y.children[0])}return this},toBBox:function(J){return J},compareMinX:ve,compareMinY:Ie,toJSON:function(){return this.data},fromJSON:function(J){return this.data=J,this},_all:function(J,re){for(var Y=[];J;)J.leaf?re.push.apply(re,J.children):Y.push.apply(Y,J.children),J=Y.pop();return re},_build:function(J,re,Y,ne){var me,ee=Y-re+1,Z=this._maxEntries;if(ee<=Z)return p(me=ie(J.slice(re,Y+1)),this.toBBox),me;ne||(ne=Math.ceil(Math.log(ee)/Math.log(Z)),Z=Math.ceil(ee/Math.pow(Z,ne-1))),(me=ie([])).leaf=!1,me.height=ne;var Ue,Ye,Ae,Wt,Q=Math.ceil(ee/Z),qe=Q*Math.ceil(Math.sqrt(Z));for(W(J,re,Y,qe,this.compareMinX),Ue=re;Ue<=Y;Ue+=qe)for(W(J,Ue,Ae=Math.min(Ue+qe-1,Y),Q,this.compareMinY),Ye=Ue;Ye<=Ae;Ye+=Q)Wt=Math.min(Ye+Q-1,Ae),me.children.push(this._build(J,Ye,Wt,ne-1));return p(me,this.toBBox),me},_chooseSubtree:function(J,re,Y,ne){for(var ee,Z,me,Q,qe,Ue,Ye,Ae;ne.push(re),!re.leaf&&ne.length-1!==Y;){for(Ye=Ae=1/0,ee=0,Z=re.children.length;ee<Z;ee++)qe=ze(me=re.children[ee]),(Ue=dt(J,me)-qe)<Ae?(Ae=Ue,Ye=qe<Ye?qe:Ye,Q=me):Ue===Ae&&qe<Ye&&(Ye=qe,Q=me);re=Q||re.children[0]}return re},_insert:function(J,re,Y){var ee=Y?J:(0,this.toBBox)(J),Z=[],me=this._chooseSubtree(ee,this.data,re,Z);for(me.children.push(J),fe(me,ee);re>=0&&Z[re].children.length>this._maxEntries;)this._split(Z,re),re--;this._adjustParentBBoxes(ee,Z,re)},_split:function(J,re){var Y=J[re],ne=Y.children.length,ee=this._minEntries;this._chooseSplitAxis(Y,ee,ne);var Z=this._chooseSplitIndex(Y,ee,ne),me=ie(Y.children.splice(Z,Y.children.length-Z));me.height=Y.height,me.leaf=Y.leaf,p(Y,this.toBBox),p(me,this.toBBox),re?J[re-1].children.push(me):this._splitRoot(Y,me)},_splitRoot:function(J,re){this.data=ie([J,re]),this.data.height=J.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},_chooseSplitIndex:function(J,re,Y){var ne,ee,Z,me,Q,qe,Ue,Ye;for(qe=Ue=1/0,ne=re;ne<=Y-re;ne++)me=Je(ee=H(J,0,ne,this.toBBox),Z=H(J,ne,Y,this.toBBox)),Q=ze(ee)+ze(Z),me<qe?(qe=me,Ye=ne,Ue=Q<Ue?Q:Ue):me===qe&&Q<Ue&&(Ue=Q,Ye=ne);return Ye},_chooseSplitAxis:function(J,re,Y){var ne=J.leaf?this.compareMinX:ve,ee=J.leaf?this.compareMinY:Ie;this._allDistMargin(J,re,Y,ne)<this._allDistMargin(J,re,Y,ee)&&J.children.sort(ne)},_allDistMargin:function(J,re,Y,ne){J.children.sort(ne);var qe,Ue,ee=this.toBBox,Z=H(J,0,re,ee),me=H(J,Y-re,Y,ee),Q=_t(Z)+_t(me);for(qe=re;qe<Y-re;qe++)Ue=J.children[qe],fe(Z,J.leaf?ee(Ue):Ue),Q+=_t(Z);for(qe=Y-re-1;qe>=re;qe--)Ue=J.children[qe],fe(me,J.leaf?ee(Ue):Ue),Q+=_t(me);return Q},_adjustParentBBoxes:function(J,re,Y){for(var ne=Y;ne>=0;ne--)fe(re[ne],J)},_condense:function(J){for(var Y,re=J.length-1;re>=0;re--)0===J[re].children.length?re>0?(Y=J[re-1].children).splice(Y.indexOf(J[re]),1):this.clear():p(J[re],this.toBBox)},_initFormat:function(J){var re=["return a"," - b",";"];this.compareMinX=new Function("a","b",re.join(J[0])),this.compareMinY=new Function("a","b",re.join(J[1])),this.toBBox=new Function("a","return {minX: a"+J[0]+", minY: a"+J[1]+", maxX: a"+J[2]+", maxY: a"+J[3]+"};")}}},6709:function(bt){bt.exports=function(){"use strict";function pe(_e,p,H,fe,ve){for(;fe>H;){if(fe-H>600){var Ie=fe-H+1,ze=p-H+1,_t=Math.log(Ie),dt=.5*Math.exp(2*_t/3),Je=.5*Math.sqrt(_t*dt*(Ie-dt)/Ie)*(ze-Ie/2<0?-1:1);pe(_e,p,Math.max(H,Math.floor(p-ze*dt/Ie+Je)),Math.min(fe,Math.floor(p+(Ie-ze)*dt/Ie+Je)),ve)}var ie=_e[p],W=H,J=fe;for(he(_e,H,p),ve(_e[fe],ie)>0&&he(_e,H,fe);W<J;){for(he(_e,W,J),W++,J--;ve(_e[W],ie)<0;)W++;for(;ve(_e[J],ie)>0;)J--}0===ve(_e[H],ie)?he(_e,H,J):he(_e,++J,fe),J<=p&&(H=J+1),p<=J&&(fe=J-1)}}function he(_e,p,H){var fe=_e[p];_e[p]=_e[H],_e[H]=fe}function de(_e,p){return _e<p?-1:_e>p?1:0}return function Qe(_e,p,H,fe,ve){pe(_e,p,H||0,fe||_e.length-1,ve||de)}}()},4468:(bt,Qe,pe)=>{"use strict";var he=pe(9582).functionsHaveConfigurableNames(),de=Object,_e=TypeError;bt.exports=function(){if(null!=this&&this!==de(this))throw new _e("RegExp.prototype.flags getter called on non-object");var H="";return this.hasIndices&&(H+="d"),this.global&&(H+="g"),this.ignoreCase&&(H+="i"),this.multiline&&(H+="m"),this.dotAll&&(H+="s"),this.unicode&&(H+="u"),this.unicodeSets&&(H+="v"),this.sticky&&(H+="y"),H},he&&Object.defineProperty&&Object.defineProperty(bt.exports,"name",{value:"get flags"})},9235:(bt,Qe,pe)=>{"use strict";var he=pe(2358),de=pe(5685),_e=pe(4468),p=pe(6343),H=pe(1956),fe=de(p());he(fe,{getPolyfill:p,implementation:_e,shim:H}),bt.exports=fe},6343:(bt,Qe,pe)=>{"use strict";var he=pe(4468),de=pe(2358).supportsDescriptors,_e=Object.getOwnPropertyDescriptor;bt.exports=function(){if(de&&"gim"===/a/gim.flags){var H=_e(RegExp.prototype,"flags");if(H&&"function"==typeof H.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var fe="",ve={};if(Object.defineProperty(ve,"hasIndices",{get:function(){fe+="d"}}),Object.defineProperty(ve,"sticky",{get:function(){fe+="y"}}),"dy"===fe)return H.get}}return he}},1956:(bt,Qe,pe)=>{"use strict";var he=pe(2358).supportsDescriptors,de=pe(6343),_e=Object.getOwnPropertyDescriptor,p=Object.defineProperty,H=TypeError,fe=Object.getPrototypeOf,ve=/a/;bt.exports=function(){if(!he||!fe)throw new H("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var ze=de(),_t=fe(ve),dt=_e(_t,"flags");return(!dt||dt.get!==ze)&&p(_t,"flags",{configurable:!0,enumerable:!1,get:ze}),ze}},7563:function(bt,Qe){!function(pe){"use strict";function _e(ht,xt,ie,W,J){let re,Y,ne,ee,Z=xt[0],me=W[0],Q=0,qe=0;me>Z==me>-Z?(re=Z,Z=xt[++Q]):(re=me,me=W[++qe]);let Ue=0;if(Q<ht&&qe<ie)for(me>Z==me>-Z?(ne=re-((Y=Z+re)-Z),Z=xt[++Q]):(ne=re-((Y=me+re)-me),me=W[++qe]),re=Y,0!==ne&&(J[Ue++]=ne);Q<ht&&qe<ie;)me>Z==me>-Z?(ne=re-((Y=re+Z)-(ee=Y-re))+(Z-ee),Z=xt[++Q]):(ne=re-((Y=re+me)-(ee=Y-re))+(me-ee),me=W[++qe]),re=Y,0!==ne&&(J[Ue++]=ne);for(;Q<ht;)ne=re-((Y=re+Z)-(ee=Y-re))+(Z-ee),Z=xt[++Q],re=Y,0!==ne&&(J[Ue++]=ne);for(;qe<ie;)ne=re-((Y=re+me)-(ee=Y-re))+(me-ee),me=W[++qe],re=Y,0!==ne&&(J[Ue++]=ne);return 0===re&&0!==Ue||(J[Ue++]=re),Ue}function p(ht){return new Float64Array(ht)}const Ie=p(4),ze=p(8),_t=p(12),dt=p(16),Je=p(4);pe.orient2d=function(ht,xt,ie,W,J,re){const Y=(xt-re)*(ie-J),ne=(ht-J)*(W-re),ee=Y-ne;if(0===Y||0===ne||Y>0!=ne>0)return ee;const Z=Math.abs(Y+ne);return Math.abs(ee)>=33306690738754716e-32*Z?ee:-function(me,Q,qe,Ue,Ye,Ae,Wt){let At,De,pt,Fe,at,vt,Le,Ut,zt,gn,Dt,Un,_n,Cn,cn,En,sn,Ei;const cr=me-Ye,oi=qe-Ye,tr=Q-Ae,sr=Ue-Ae;at=(cn=(Ut=cr-(Le=(vt=134217729*cr)-(vt-cr)))*(gn=sr-(zt=(vt=134217729*sr)-(vt-sr)))-((Cn=cr*sr)-Le*zt-Ut*zt-Le*gn))-(Dt=cn-(sn=(Ut=tr-(Le=(vt=134217729*tr)-(vt-tr)))*(gn=oi-(zt=(vt=134217729*oi)-(vt-oi)))-((En=tr*oi)-Le*zt-Ut*zt-Le*gn))),Ie[0]=cn-(Dt+at)+(at-sn),at=(_n=Cn-((Un=Cn+Dt)-(at=Un-Cn))+(Dt-at))-(Dt=_n-En),Ie[1]=_n-(Dt+at)+(at-En),at=(Ei=Un+Dt)-Un,Ie[2]=Un-(Ei-at)+(Dt-at),Ie[3]=Ei;let wt=function(yt,Vt){let rn=Vt[0];for(let tn=1;tn<4;tn++)rn+=Vt[tn];return rn}(0,Ie),Te=22204460492503146e-32*Wt;if(wt>=Te||-wt>=Te||(At=me-(cr+(at=me-cr))+(at-Ye),pt=qe-(oi+(at=qe-oi))+(at-Ye),De=Q-(tr+(at=Q-tr))+(at-Ae),Fe=Ue-(sr+(at=Ue-sr))+(at-Ae),0===At&&0===De&&0===pt&&0===Fe)||(Te=11093356479670487e-47*Wt+33306690738754706e-32*Math.abs(wt),(wt+=cr*Fe+sr*At-(tr*pt+oi*De))>=Te||-wt>=Te))return wt;at=(cn=(Ut=At-(Le=(vt=134217729*At)-(vt-At)))*(gn=sr-(zt=(vt=134217729*sr)-(vt-sr)))-((Cn=At*sr)-Le*zt-Ut*zt-Le*gn))-(Dt=cn-(sn=(Ut=De-(Le=(vt=134217729*De)-(vt-De)))*(gn=oi-(zt=(vt=134217729*oi)-(vt-oi)))-((En=De*oi)-Le*zt-Ut*zt-Le*gn))),Je[0]=cn-(Dt+at)+(at-sn),at=(_n=Cn-((Un=Cn+Dt)-(at=Un-Cn))+(Dt-at))-(Dt=_n-En),Je[1]=_n-(Dt+at)+(at-En),at=(Ei=Un+Dt)-Un,Je[2]=Un-(Ei-at)+(Dt-at),Je[3]=Ei;const we=_e(4,Ie,4,Je,ze);at=(cn=(Ut=cr-(Le=(vt=134217729*cr)-(vt-cr)))*(gn=Fe-(zt=(vt=134217729*Fe)-(vt-Fe)))-((Cn=cr*Fe)-Le*zt-Ut*zt-Le*gn))-(Dt=cn-(sn=(Ut=tr-(Le=(vt=134217729*tr)-(vt-tr)))*(gn=pt-(zt=(vt=134217729*pt)-(vt-pt)))-((En=tr*pt)-Le*zt-Ut*zt-Le*gn))),Je[0]=cn-(Dt+at)+(at-sn),at=(_n=Cn-((Un=Cn+Dt)-(at=Un-Cn))+(Dt-at))-(Dt=_n-En),Je[1]=_n-(Dt+at)+(at-En),at=(Ei=Un+Dt)-Un,Je[2]=Un-(Ei-at)+(Dt-at),Je[3]=Ei;const xe=_e(we,ze,4,Je,_t);at=(cn=(Ut=At-(Le=(vt=134217729*At)-(vt-At)))*(gn=Fe-(zt=(vt=134217729*Fe)-(vt-Fe)))-((Cn=At*Fe)-Le*zt-Ut*zt-Le*gn))-(Dt=cn-(sn=(Ut=De-(Le=(vt=134217729*De)-(vt-De)))*(gn=pt-(zt=(vt=134217729*pt)-(vt-pt)))-((En=De*pt)-Le*zt-Ut*zt-Le*gn))),Je[0]=cn-(Dt+at)+(at-sn),at=(_n=Cn-((Un=Cn+Dt)-(at=Un-Cn))+(Dt-at))-(Dt=_n-En),Je[1]=_n-(Dt+at)+(at-En),at=(Ei=Un+Dt)-Un,Je[2]=Un-(Ei-at)+(Dt-at),Je[3]=Ei;const Ze=_e(xe,_t,4,Je,dt);return dt[Ze-1]}(ht,xt,ie,W,J,re,Z)},pe.orient2dfast=function(ht,xt,ie,W,J,re){return(xt-re)*(ie-J)-(ht-J)*(W-re)},Object.defineProperty(pe,"__esModule",{value:!0})}(Qe)},9231:bt=>{"use strict";bt.exports={eudist:function(pe,he,de){for(var _e=pe.length,p=0,H=0;H<_e;H++){var fe=(pe[H]||0)-(he[H]||0);p+=fe*fe}return de?Math.sqrt(p):p},mandist:function(pe,he,de){for(var _e=pe.length,p=0,H=0;H<_e;H++)p+=Math.abs((pe[H]||0)-(he[H]||0));return de?Math.sqrt(p):p},dist:function(pe,he,de){var _e=Math.abs(pe-he);return de?_e:_e*_e}}},5561:(bt,Qe,pe)=>{"use strict";var he=pe(9231),de=he.eudist,_e=he.dist;bt.exports={kmrand:function(H,fe){for(var ve={},Ie=[],ze=fe<<2,_t=H.length,dt=H[0].length>0;Ie.length<fe&&ze-- >0;){var Je=H[Math.floor(Math.random()*_t)],ht=dt?Je.join("_"):""+Je;ve[ht]||(ve[ht]=!0,Ie.push(Je))}if(Ie.length<fe)throw new Error("Error initializating clusters");return Ie},kmpp:function(H,fe){var ve=H[0].length?de:_e,Ie=[],ze=H.length,_t=H[0].length>0,Je=H[Math.floor(Math.random()*ze)];for(_t&&Je.join("_"),Ie.push(Je);Ie.length<fe;){for(var xt=[],ie=Ie.length,W=0,J=[],re=0;re<ze;re++){for(var Y=1/0,ne=0;ne<ie;ne++){var ee=ve(H[re],Ie[ne]);ee<=Y&&(Y=ee)}xt[re]=Y}for(var Z=0;Z<ze;Z++)W+=xt[Z];for(var me=0;me<ze;me++)J[me]={i:me,v:H[me],pr:xt[me]/W,cs:0};J.sort(function(Ye,Ae){return Ye.pr-Ae.pr}),J[0].cs=J[0].pr;for(var Q=1;Q<ze;Q++)J[Q].cs=J[Q-1].cs+J[Q].pr;for(var qe=Math.random(),Ue=0;Ue<ze-1&&J[Ue++].cs<qe;);Ie.push(J[Ue-1].v)}return Ie}}},9475:(bt,Qe,pe)=>{"use strict";var he=pe(9231),de=pe(5561),_e=he.eudist,fe=de.kmrand,ve=de.kmpp;function ze(dt,Je,ht){ht=ht||[];for(var xt=0;xt<dt;xt++)ht[xt]=Je;return ht}bt.exports=function _t(dt,Je,ht,xt){var ie=[],W=[],J=[],re=[],Y=!1,ne=xt||1e4,ee=dt.length,Z=dt[0].length,me=Z>0,Q=[];if(ht)ie="kmrand"==ht?fe(dt,Je):"kmpp"==ht?ve(dt,Je):ht;else for(var qe={};ie.length<Je;){var Ue=Math.floor(Math.random()*ee);qe[Ue]||(qe[Ue]=!0,ie.push(dt[Ue]))}do{ze(Je,0,Q);for(var Ye=0;Ye<ee;Ye++){for(var Ae=1/0,Wt=0,At=0;At<Je;At++)(re=me?_e(dt[Ye],ie[At]):Math.abs(dt[Ye]-ie[At]))<=Ae&&(Ae=re,Wt=At);J[Ye]=Wt,Q[Wt]++}for(var De=[],Fe=(W=[],0);Fe<Je;Fe++)De[Fe]=me?ze(Z,0,De[Fe]):0,W[Fe]=ie[Fe];if(me){for(var at=0;at<Je;at++)ie[at]=[];for(var vt=0;vt<ee;vt++)for(var Ut=De[J[vt]],zt=dt[vt],gn=0;gn<Z;gn++)Ut[gn]+=zt[gn];Y=!0;for(var Dt=0;Dt<Je;Dt++){for(var Un=ie[Dt],_n=De[Dt],Cn=W[Dt],cn=Q[Dt],En=0;En<Z;En++)Un[En]=_n[En]/cn||0;if(Y)for(var sn=0;sn<Z;sn++)if(Cn[sn]!=Un[sn]){Y=!1;break}}}else{for(var Ei=0;Ei<ee;Ei++)De[J[Ei]]+=dt[Ei];for(var oi=0;oi<Je;oi++)ie[oi]=De[oi]/Q[oi]||0;Y=!0;for(var tr=0;tr<Je;tr++)if(W[tr]!=ie[tr]){Y=!1;break}}Y=Y||--ne<=0}while(!Y);return{it:1e4-ne,k:Je,idxs:J,centroids:ie}}},6775:function(bt){var he;he=function(){var Qe="",pe=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function he(fe){return fe.match(pe)||[]}function _e(fe){return{language:(fe=he(fe))[1]||Qe,extlang:fe[2]||Qe,script:fe[3]||Qe,region:fe[4]||Qe}}function p(fe,ve,Ie){Object.defineProperty(fe,ve,{value:Ie,enumerable:!0})}function H(fe,ve,Ie){function ze(_t){return he(_t)[fe]||Qe}p(ze,"pattern",ve),p(_e,Ie,ze)}return H(1,/^[a-zA-Z]{2,3}$/,"language"),H(2,/^[a-zA-Z]{3}$/,"extlang"),H(3,/^[a-zA-Z]{4}$/,"script"),H(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),p(_e,"split",function de(fe){return he(fe).filter(function(ve,Ie){return ve&&Ie})}),_e},bt.exports?bt.exports=he():this.subtag=he()},5562:(bt,Qe,pe)=>{"use strict";var he=pe(8576);bt.exports=he,typeof window<"u"&&(window.Suggestions=he)},7554:bt=>{"use strict";var Qe=function(pe){return this.component=pe,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,pe.el.parentNode.insertBefore(this.wrapper,pe.el.nextSibling),this};Qe.prototype.show=function(){this.element.style.display="block"},Qe.prototype.hide=function(){this.element.style.display="none"},Qe.prototype.add=function(pe){this.items.push(pe)},Qe.prototype.clear=function(){this.items=[],this.active=0},Qe.prototype.isEmpty=function(){return!this.items.length},Qe.prototype.isVisible=function(){return"block"===this.element.style.display},Qe.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var pe=0;pe<this.items.length;pe++)this.drawItem(this.items[pe],this.active===pe);this.show()}else this.hide()},Qe.prototype.drawItem=function(pe,he){var de=document.createElement("li"),_e=document.createElement("a");he&&(de.className+=" active"),_e.innerHTML=pe.string,de.appendChild(_e),this.element.appendChild(de),de.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),de.addEventListener("mouseup",function(){this.handleMouseUp.call(this,pe)}.bind(this))},Qe.prototype.handleMouseUp=function(pe){this.selectingListItem=!1,this.component.value(pe.original),this.clear(),this.draw()},Qe.prototype.move=function(pe){this.active=pe,this.draw()},Qe.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},Qe.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},Qe.prototype.drawError=function(pe){var he=document.createElement("li");he.innerHTML=pe,this.element.appendChild(he),this.show()},bt.exports=Qe},8576:(bt,Qe,pe)=>{"use strict";var he=pe(4703),de=pe(5780),_e=pe(7554),p=function(H,fe,ve){return this.options=he({minLength:2,limit:5,filter:!0,hideOnBlur:!0},ve=ve||{}),this.el=H,this.data=fe||[],this.list=new _e(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(Ie){this.handleKeyUp(Ie.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(Ie){this.handleKeyDown(Ie)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(Ie){this.handlePaste(Ie)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};p.prototype.handleKeyUp=function(H){40===H||38===H||27===H||13===H||9===H||this.handleInputChange(this.el.value)},p.prototype.handleKeyDown=function(H){switch(H.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&H.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},p.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},p.prototype.handlePaste=function(H){if(H.clipboardData)this.handleInputChange(H.clipboardData.getData("Text"));else{var fe=this;setTimeout(function(){fe.handleInputChange(H.target.value)},100)}},p.prototype.handleInputChange=function(H){this.query=this.normalize(H),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(fe){for(var ve=0;ve<fe.length&&(this.list.add(fe[ve]),ve!==this.options.limit-1);ve++);this.list.draw()}.bind(this))},p.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},p.prototype.update=function(H){this.data=H,this.handleKeyUp()},p.prototype.clear=function(){this.data=[],this.list.clear()},p.prototype.normalize=function(H){return H.toLowerCase()},p.prototype.match=function(H,fe){return H.indexOf(fe)>-1},p.prototype.value=function(H){if(this.selected=H,this.el.value=this.getItemValue(H),document.createEvent){var fe=document.createEvent("HTMLEvents");fe.initEvent("change",!0,!1),this.el.dispatchEvent(fe)}else this.el.fireEvent("onchange")},p.prototype.getCandidates=function(H){var fe={pre:"<strong>",post:"</strong>",extract:function(Ie){return this.getItemValue(Ie)}.bind(this)};H(this.options.filter?de.filter(this.query,this.data,fe).map(function(Ie){return{original:Ie.original,string:this.render(Ie.original,Ie.string)}}.bind(this)):this.data.map(function(Ie){return{original:Ie,string:this.render(Ie)}}.bind(this)))},p.prototype.getItemValue=function(H){return H},p.prototype.render=function(H,fe){if(fe)return fe;for(var ve=this.getItemValue(H.original?H.original:H),Ie=this.normalize(ve),ze=Ie.lastIndexOf(this.query);ze>-1;){var _t=ze+this.query.length;ve=ve.slice(0,ze)+"<strong>"+ve.slice(ze,_t)+"</strong>"+ve.slice(_t),ze=Ie.slice(0,ze).lastIndexOf(this.query)}return ve},p.prototype.renderError=function(H){this.list.drawError(H)},bt.exports=p},7253:(bt,Qe,pe)=>{"use strict";pe.r(Qe),pe.d(Qe,{default:()=>he});class he{constructor(p=[],H=de){if(this.data=p,this.length=this.data.length,this.compare=H,this.length>0)for(let fe=(this.length>>1)-1;fe>=0;fe--)this._down(fe)}push(p){this.data.push(p),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const p=this.data[0],H=this.data.pop();return this.length--,this.length>0&&(this.data[0]=H,this._down(0)),p}peek(){return this.data[0]}_up(p){const{data:H,compare:fe}=this,ve=H[p];for(;p>0;){const Ie=p-1>>1,ze=H[Ie];if(fe(ve,ze)>=0)break;H[p]=ze,p=Ie}H[p]=ve}_down(p){const{data:H,compare:fe}=this,ve=this.length>>1,Ie=H[p];for(;p<ve;){let ze=1+(p<<1),_t=H[ze];const dt=ze+1;if(dt<this.length&&fe(H[dt],_t)<0&&(ze=dt,_t=H[dt]),fe(_t,Ie)>=0)break;H[p]=_t,p=ze}H[p]=Ie}}function de(_e,p){return _e<p?-1:_e>p?1:0}},770:function(bt,Qe){!function(pe){"use strict";function he(){}function de(a){this.message=a||""}function _e(a){this.message=a||""}function p(a){this.message=a||""}function H(){}function fe(a){return null===a?ir:a.color}function ve(a){return null===a?null:a.parent}function Ie(a,h){null!==a&&(a.color=h)}function ze(a){return null===a?null:a.left}function _t(a){return null===a?null:a.right}function dt(){this.root_=null,this.size_=0}function Je(){}function ht(){this.array_=[],arguments[0]instanceof ye&&this.addAll(arguments[0])}function xt(){}function ie(a){this.message=a||""}function W(){this.array_=[]}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(a){if(null==this)throw new TypeError(this+" is not an object");var h=Object(this),y=Math.max(Math.min(h.length,9007199254740991),0)||0,x=1 in arguments&&parseInt(Number(arguments[1]),10)||0;x=x<0?Math.max(y+x,0):Math.min(x,y);var T=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:y;for(T=T<0?Math.max(y+arguments[2],0):Math.min(T,y);x<T;)h[x]=a,++x;return h},writable:!0}),Number.isFinite=Number.isFinite||function(a){return"number"==typeof a&&isFinite(a)},Number.isInteger=Number.isInteger||function(a){return"number"==typeof a&&isFinite(a)&&Math.floor(a)===a},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(a){return a!=a},Math.trunc=Math.trunc||function(a){return a<0?Math.ceil(a):Math.floor(a)};var J=function(){};J.prototype.interfaces_=function(){return[]},J.prototype.getClass=function(){return J},J.prototype.equalsWithTolerance=function(a,h,y){return Math.abs(a-h)<=y};var re=function(a){function h(y){a.call(this,y),this.name="IllegalArgumentException",this.message=y,this.stack=(new a).stack}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h}(Error),Y=function(){},ne={MAX_VALUE:{configurable:!0}};Y.isNaN=function(a){return Number.isNaN(a)},Y.doubleToLongBits=function(a){return a},Y.longBitsToDouble=function(a){return a},Y.isInfinite=function(a){return!Number.isFinite(a)},ne.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(Y,ne);var ee=function(){},Z=function(){},me=function(){},Q=function a(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=a.NULL_ORDINATE;else if(1===arguments.length){var h=arguments[0];this.x=h.x,this.y=h.y,this.z=h.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=a.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},qe={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};Q.prototype.setOrdinate=function(a,h){switch(a){case Q.X:this.x=h;break;case Q.Y:this.y=h;break;case Q.Z:this.z=h;break;default:throw new re("Invalid ordinate index: "+a)}},Q.prototype.equals2D=function(){if(1===arguments.length){var a=arguments[0];return this.x===a.x&&this.y===a.y}if(2===arguments.length){var h=arguments[0],y=arguments[1];return!!J.equalsWithTolerance(this.x,h.x,y)&&!!J.equalsWithTolerance(this.y,h.y,y)}},Q.prototype.getOrdinate=function(a){switch(a){case Q.X:return this.x;case Q.Y:return this.y;case Q.Z:return this.z}throw new re("Invalid ordinate index: "+a)},Q.prototype.equals3D=function(a){return this.x===a.x&&this.y===a.y&&(this.z===a.z||Y.isNaN(this.z))&&Y.isNaN(a.z)},Q.prototype.equals=function(a){return a instanceof Q&&this.equals2D(a)},Q.prototype.equalInZ=function(a,h){return J.equalsWithTolerance(this.z,a.z,h)},Q.prototype.compareTo=function(a){return this.x<a.x?-1:this.x>a.x?1:this.y<a.y?-1:this.y>a.y?1:0},Q.prototype.clone=function(){},Q.prototype.copy=function(){return new Q(this)},Q.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},Q.prototype.distance3D=function(a){var h=this.x-a.x,y=this.y-a.y,x=this.z-a.z;return Math.sqrt(h*h+y*y+x*x)},Q.prototype.distance=function(a){var h=this.x-a.x,y=this.y-a.y;return Math.sqrt(h*h+y*y)},Q.prototype.hashCode=function(){var a=17;return 37*(a=37*a+Q.hashCode(this.x))+Q.hashCode(this.y)},Q.prototype.setCoordinate=function(a){this.x=a.x,this.y=a.y,this.z=a.z},Q.prototype.interfaces_=function(){return[ee,Z,he]},Q.prototype.getClass=function(){return Q},Q.hashCode=function(){if(1===arguments.length){var h=Y.doubleToLongBits(arguments[0]);return Math.trunc((h^h)>>>32)}},qe.DimensionalComparator.get=function(){return Ue},qe.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},qe.NULL_ORDINATE.get=function(){return Y.NaN},qe.X.get=function(){return 0},qe.Y.get=function(){return 1},qe.Z.get=function(){return 2},Object.defineProperties(Q,qe);var Ue=function(a){if(this._dimensionsToTest=2,0!==arguments.length&&1===arguments.length){var h=arguments[0];if(2!==h&&3!==h)throw new re("only 2 or 3 dimensions may be specified");this._dimensionsToTest=h}};Ue.prototype.compare=function(a,h){var y=a,x=h,T=Ue.compare(y.x,x.x);if(0!==T)return T;var F=Ue.compare(y.y,x.y);return 0!==F?F:this._dimensionsToTest<=2?0:Ue.compare(y.z,x.z)},Ue.prototype.interfaces_=function(){return[me]},Ue.prototype.getClass=function(){return Ue},Ue.compare=function(a,h){return a<h?-1:a>h?1:Y.isNaN(a)?Y.isNaN(h)?0:-1:Y.isNaN(h)?1:0};var Ye=function(){};Ye.prototype.create=function(){},Ye.prototype.interfaces_=function(){return[]},Ye.prototype.getClass=function(){return Ye};var Ae=function(){},Wt={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Ae.prototype.interfaces_=function(){return[]},Ae.prototype.getClass=function(){return Ae},Ae.toLocationSymbol=function(a){switch(a){case Ae.EXTERIOR:return"e";case Ae.BOUNDARY:return"b";case Ae.INTERIOR:return"i";case Ae.NONE:return"-"}throw new re("Unknown location value: "+a)},Wt.INTERIOR.get=function(){return 0},Wt.BOUNDARY.get=function(){return 1},Wt.EXTERIOR.get=function(){return 2},Wt.NONE.get=function(){return-1},Object.defineProperties(Ae,Wt);var At=function(a,h){return a.interfaces_&&a.interfaces_().indexOf(h)>-1},De=function(){},pt={LOG_10:{configurable:!0}};De.prototype.interfaces_=function(){return[]},De.prototype.getClass=function(){return De},De.log10=function(a){var h=Math.log(a);return Y.isInfinite(h)||Y.isNaN(h)?h:h/De.LOG_10},De.min=function(a,h,y,x){var T=a;return h<T&&(T=h),y<T&&(T=y),x<T&&(T=x),T},De.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var a=arguments[0],h=arguments[1],y=arguments[2];return a<h?h:a>y?y:a}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var x=arguments[0],T=arguments[1],F=arguments[2];return x<T?T:x>F?F:x}},De.wrap=function(a,h){return a<0?h- -a%h:a%h},De.max=function(){if(3===arguments.length){var h=arguments[1],y=arguments[2],x=arguments[0];return h>x&&(x=h),y>x&&(x=y),x}if(4===arguments.length){var F=arguments[1],j=arguments[2],ce=arguments[3],ke=arguments[0];return F>ke&&(ke=F),j>ke&&(ke=j),ce>ke&&(ke=ce),ke}},De.average=function(a,h){return(a+h)/2},pt.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(De,pt);var Fe=function(a){this.str=a};Fe.prototype.append=function(a){this.str+=a},Fe.prototype.setCharAt=function(a,h){this.str=this.str.substr(0,a)+h+this.str.substr(a+1)},Fe.prototype.toString=function(a){return this.str};var at=function(a){this.value=a};at.prototype.intValue=function(){return this.value},at.prototype.compareTo=function(a){return this.value<a?-1:this.value>a?1:0},at.isNaN=function(a){return Number.isNaN(a)};var vt=function(){};vt.isWhitespace=function(a){return a<=32&&a>=0||127===a},vt.toUpperCase=function(a){return a.toUpperCase()};var Le=function a(){this._hi=0,this._lo=0,0===arguments.length?this.init(0):1===arguments.length?"number"==typeof arguments[0]||arguments[0]instanceof a?this.init(arguments[0]):"string"==typeof arguments[0]&&a.call(this,a.parse(arguments[0])):2===arguments.length&&this.init(arguments[0],arguments[1])},Ut={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Le.prototype.le=function(a){return(this._hi<a._hi||this._hi===a._hi)&&this._lo<=a._lo},Le.prototype.extractSignificantDigits=function(a,h){var y=this.abs(),x=Le.magnitude(y._hi),T=Le.TEN.pow(x);(y=y.divide(T)).gt(Le.TEN)?(y=y.divide(Le.TEN),x+=1):y.lt(Le.ONE)&&(y=y.multiply(Le.TEN),x-=1);for(var F=x+1,j=new Fe,ce=Le.MAX_PRINT_DIGITS-1,ke=0;ke<=ce;ke++){a&&ke===F&&j.append(".");var ft=Math.trunc(y._hi);if(ft<0)break;var Lt=!1,$t=0;ft>9?(Lt=!0,$t="9"):$t="0"+ft,j.append($t),y=y.subtract(Le.valueOf(ft)).multiply(Le.TEN),Lt&&y.selfAdd(Le.TEN);var Pn=!0,Mn=Le.magnitude(y._hi);if(Mn<0&&Math.abs(Mn)>=ce-ke&&(Pn=!1),!Pn)break}return h[0]=x,j.toString()},Le.prototype.sqr=function(){return this.multiply(this)},Le.prototype.doubleValue=function(){return this._hi+this._lo},Le.prototype.subtract=function(){return arguments[0]instanceof Le?this.add(arguments[0].negate()):"number"==typeof arguments[0]?this.add(-arguments[0]):void 0},Le.prototype.equals=function(){if(1===arguments.length){var a=arguments[0];return this._hi===a._hi&&this._lo===a._lo}},Le.prototype.isZero=function(){return 0===this._hi&&0===this._lo},Le.prototype.selfSubtract=function(){if(arguments[0]instanceof Le){var a=arguments[0];return this.isNaN()?this:this.selfAdd(-a._hi,-a._lo)}if("number"==typeof arguments[0]){var h=arguments[0];return this.isNaN()?this:this.selfAdd(-h,0)}},Le.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},Le.prototype.min=function(a){return this.le(a)?this:a},Le.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof Le){var a=arguments[0];return this.selfDivide(a._hi,a._lo)}if("number"==typeof arguments[0])return this.selfDivide(arguments[0],0)}else if(2===arguments.length){var F,ce,ke,Lt,y=arguments[0],T=null,j=null,ft=null,$t=null;return this._hi=$t=(ke=this._hi/y)+(ft=(this._hi-(Lt=ke*y)-($t=(T=(ft=Le.SPLIT*ke)-(T=ft-ke))*(j=($t=Le.SPLIT*y)-(j=$t-y))-Lt+T*(ce=y-j)+(F=ke-T)*j+F*ce)+this._lo-ke*arguments[1])/y),this._lo=ke-$t+ft,this}},Le.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},Le.prototype.divide=function(){if(arguments[0]instanceof Le){var y,T,F,ce,a=arguments[0],h=null,x=null,j=null,ke=null;return y=(F=this._hi/a._hi)-(h=(j=Le.SPLIT*F)-(h=j-F)),ke=h*(x=(ke=Le.SPLIT*a._hi)-(x=ke-a._hi))-(ce=F*a._hi)+h*(T=a._hi-x)+y*x+y*T,new Le(ke=F+(j=(this._hi-ce-ke+this._lo-F*a._lo)/a._hi),F-ke+j)}if("number"==typeof arguments[0]){var ft=arguments[0];return Y.isNaN(ft)?Le.createNaN():Le.copy(this).selfDivide(ft,0)}},Le.prototype.ge=function(a){return(this._hi>a._hi||this._hi===a._hi)&&this._lo>=a._lo},Le.prototype.pow=function(a){if(0===a)return Le.valueOf(1);var h=new Le(this),y=Le.valueOf(1),x=Math.abs(a);if(x>1)for(;x>0;)x%2==1&&y.selfMultiply(h),(x/=2)>0&&(h=h.sqr());else y=h;return a<0?y.reciprocal():y},Le.prototype.ceil=function(){if(this.isNaN())return Le.NaN;var a=Math.ceil(this._hi),h=0;return a===this._hi&&(h=Math.ceil(this._lo)),new Le(a,h)},Le.prototype.compareTo=function(a){return this._hi<a._hi?-1:this._hi>a._hi?1:this._lo<a._lo?-1:this._lo>a._lo?1:0},Le.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},Le.prototype.setValue=function(){return arguments[0]instanceof Le||"number"==typeof arguments[0]?(this.init(arguments[0]),this):void 0},Le.prototype.max=function(a){return this.ge(a)?this:a},Le.prototype.sqrt=function(){if(this.isZero())return Le.valueOf(0);if(this.isNegative())return Le.NaN;var a=1/Math.sqrt(this._hi),y=Le.valueOf(this._hi*a),x=this.subtract(y.sqr())._hi*(.5*a);return y.add(x)},Le.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof Le){var a=arguments[0];return this.selfAdd(a._hi,a._lo)}if("number"==typeof arguments[0]){var y,x,T,j,ce,h=arguments[0];return this._hi=(y=(T=this._hi+h)+(ce=h-(j=T-this._hi)+(this._hi-(T-j))+this._lo))+(x=ce+(T-y)),this._lo=x+(y-this._hi),this}}else if(2===arguments.length){var Lt,$t,Mn,hi,ke=arguments[0],ft=arguments[1],Pn=null,zn=null,qn=null;zn=(Mn=this._hi+ke)-(qn=Mn-this._hi),Pn=($t=this._lo+ft)-(hi=$t-this._lo);var Sn=(Lt=Mn+(qn=(zn=ke-qn+(this._hi-zn))+$t))+(qn=(Pn=ft-hi+(this._lo-Pn))+(qn+(Mn-Lt))),bs=qn+(Lt-Sn);return this._hi=Sn,this._lo=bs,this}},Le.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof Le){var a=arguments[0];return this.selfMultiply(a._hi,a._lo)}if("number"==typeof arguments[0])return this.selfMultiply(arguments[0],0)}else if(2===arguments.length){var F,ce,y=arguments[0],T=null,j=null,ke=null,ft=null;T=(ke=Le.SPLIT*this._hi)-this._hi,T=ke-T;var Lt=(ke=this._hi*y)+(ft=T*(j=(ft=Le.SPLIT*y)-(j=ft-y))-ke+T*(ce=y-j)+(F=this._hi-T)*j+F*ce+(this._hi*arguments[1]+this._lo*y)),$t=ft+(T=ke-Lt);return this._hi=Lt,this._lo=$t,this}},Le.prototype.selfSqr=function(){return this.selfMultiply(this)},Le.prototype.floor=function(){if(this.isNaN())return Le.NaN;var a=Math.floor(this._hi),h=0;return a===this._hi&&(h=Math.floor(this._lo)),new Le(a,h)},Le.prototype.negate=function(){return this.isNaN()?this:new Le(-this._hi,-this._lo)},Le.prototype.clone=function(){},Le.prototype.multiply=function(){if(arguments[0]instanceof Le){var a=arguments[0];return a.isNaN()?Le.createNaN():Le.copy(this).selfMultiply(a)}if("number"==typeof arguments[0]){var h=arguments[0];return Y.isNaN(h)?Le.createNaN():Le.copy(this).selfMultiply(h,0)}},Le.prototype.isNaN=function(){return Y.isNaN(this._hi)},Le.prototype.intValue=function(){return Math.trunc(this._hi)},Le.prototype.toString=function(){var a=Le.magnitude(this._hi);return a>=-3&&a<=20?this.toStandardNotation():this.toSciNotation()},Le.prototype.toStandardNotation=function(){var a=this.getSpecialNumberString();if(null!==a)return a;var h=new Array(1).fill(null),y=this.extractSignificantDigits(!0,h),x=h[0]+1,T=y;return"."===y.charAt(0)?T="0"+y:x<0?T="0."+Le.stringOfChar("0",-x)+y:-1===y.indexOf(".")&&(T=y+Le.stringOfChar("0",x-y.length)+".0"),this.isNegative()?"-"+T:T},Le.prototype.reciprocal=function(){var h,x,T,j,a=null,y=null,F=null,ce=null;h=(T=1/this._hi)-(a=(F=Le.SPLIT*T)-(a=F-T)),y=(ce=Le.SPLIT*this._hi)-this._hi;var ke=T+(F=(1-(j=T*this._hi)-(ce=a*(y=ce-y)-j+a*(x=this._hi-y)+h*y+h*x)-T*this._lo)/this._hi);return new Le(ke,T-ke+F)},Le.prototype.toSciNotation=function(){if(this.isZero())return Le.SCI_NOT_ZERO;var a=this.getSpecialNumberString();if(null!==a)return a;var h=new Array(1).fill(null),y=this.extractSignificantDigits(!1,h),x=Le.SCI_NOT_EXPONENT_CHAR+h[0];if("0"===y.charAt(0))throw new Error("Found leading zero: "+y);var T="";y.length>1&&(T=y.substring(1));var F=y.charAt(0)+"."+T;return this.isNegative()?"-"+F+x:F+x},Le.prototype.abs=function(){return this.isNaN()?Le.NaN:this.isNegative()?this.negate():new Le(this)},Le.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},Le.prototype.lt=function(a){return(this._hi<a._hi||this._hi===a._hi)&&this._lo<a._lo},Le.prototype.add=function(){if(arguments[0]instanceof Le){var a=arguments[0];return Le.copy(this).selfAdd(a)}if("number"==typeof arguments[0]){var h=arguments[0];return Le.copy(this).selfAdd(h)}},Le.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0])this._hi=arguments[0],this._lo=0;else if(arguments[0]instanceof Le){var h=arguments[0];this._hi=h._hi,this._lo=h._lo}}else if(2===arguments.length){var x=arguments[1];this._hi=arguments[0],this._lo=x}},Le.prototype.gt=function(a){return(this._hi>a._hi||this._hi===a._hi)&&this._lo>a._lo},Le.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},Le.prototype.trunc=function(){return this.isNaN()?Le.NaN:this.isPositive()?this.floor():this.ceil()},Le.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},Le.prototype.interfaces_=function(){return[he,ee,Z]},Le.prototype.getClass=function(){return Le},Le.sqr=function(a){return Le.valueOf(a).selfMultiply(a)},Le.valueOf=function(){return"string"==typeof arguments[0]?Le.parse(arguments[0]):"number"==typeof arguments[0]?new Le(arguments[0]):void 0},Le.sqrt=function(a){return Le.valueOf(a).sqrt()},Le.parse=function(a){for(var h=0,y=a.length;vt.isWhitespace(a.charAt(h));)h++;var x=!1;if(h<y){var T=a.charAt(h);"-"!==T&&"+"!==T||(h++,"-"===T&&(x=!0))}for(var F=new Le,j=0,ce=0,ke=0;!(h>=y);){var ft=a.charAt(h);if(h++,vt.isDigit(ft)){var Lt=ft-"0";F.selfMultiply(Le.TEN),F.selfAdd(Lt),j++}else{if("."!==ft){if("e"===ft||"E"===ft){var $t=a.substring(h);try{ke=at.parseInt($t)}catch(hi){throw hi instanceof Error?new Error("Invalid exponent "+$t+" in string "+a):hi}break}throw new Error("Unexpected character '"+ft+"' at position "+h+" in string "+a)}ce=j}}var Pn=F,Mn=j-ce-ke;if(0===Mn)Pn=F;else if(Mn>0){var zn=Le.TEN.pow(Mn);Pn=F.divide(zn)}else if(Mn<0){var qn=Le.TEN.pow(-Mn);Pn=F.multiply(qn)}return x?Pn.negate():Pn},Le.createNaN=function(){return new Le(Y.NaN,Y.NaN)},Le.copy=function(a){return new Le(a)},Le.magnitude=function(a){var h=Math.abs(a),y=Math.log(h)/Math.log(10),x=Math.trunc(Math.floor(y));return 10*Math.pow(10,x)<=h&&(x+=1),x},Le.stringOfChar=function(a,h){for(var y=new Fe,x=0;x<h;x++)y.append(a);return y.toString()},Ut.PI.get=function(){return new Le(3.141592653589793,12246467991473532e-32)},Ut.TWO_PI.get=function(){return new Le(6.283185307179586,24492935982947064e-32)},Ut.PI_2.get=function(){return new Le(1.5707963267948966,6123233995736766e-32)},Ut.E.get=function(){return new Le(2.718281828459045,14456468917292502e-32)},Ut.NaN.get=function(){return new Le(Y.NaN,Y.NaN)},Ut.EPS.get=function(){return 123259516440783e-46},Ut.SPLIT.get=function(){return 134217729},Ut.MAX_PRINT_DIGITS.get=function(){return 32},Ut.TEN.get=function(){return Le.valueOf(10)},Ut.ONE.get=function(){return Le.valueOf(1)},Ut.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},Ut.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(Le,Ut);var zt=function(){},gn={DP_SAFE_EPSILON:{configurable:!0}};zt.prototype.interfaces_=function(){return[]},zt.prototype.getClass=function(){return zt},zt.orientationIndex=function(a,h,y){var x=zt.orientationIndexFilter(a,h,y);if(x<=1)return x;var T=Le.valueOf(h.x).selfAdd(-a.x),F=Le.valueOf(h.y).selfAdd(-a.y),j=Le.valueOf(y.x).selfAdd(-h.x),ce=Le.valueOf(y.y).selfAdd(-h.y);return T.selfMultiply(ce).selfSubtract(F.selfMultiply(j)).signum()},zt.signOfDet2x2=function(a,h,y,x){return a.multiply(x).selfSubtract(h.multiply(y)).signum()},zt.intersection=function(a,h,y,x){var T=Le.valueOf(x.y).selfSubtract(y.y).selfMultiply(Le.valueOf(h.x).selfSubtract(a.x)),F=Le.valueOf(x.x).selfSubtract(y.x).selfMultiply(Le.valueOf(h.y).selfSubtract(a.y)),j=T.subtract(F),ce=Le.valueOf(x.x).selfSubtract(y.x).selfMultiply(Le.valueOf(a.y).selfSubtract(y.y)),ke=Le.valueOf(x.y).selfSubtract(y.y).selfMultiply(Le.valueOf(a.x).selfSubtract(y.x)),ft=ce.subtract(ke).selfDivide(j).doubleValue(),Lt=Le.valueOf(a.x).selfAdd(Le.valueOf(h.x).selfSubtract(a.x).selfMultiply(ft)).doubleValue(),$t=Le.valueOf(h.x).selfSubtract(a.x).selfMultiply(Le.valueOf(a.y).selfSubtract(y.y)),Pn=Le.valueOf(h.y).selfSubtract(a.y).selfMultiply(Le.valueOf(a.x).selfSubtract(y.x)),Mn=$t.subtract(Pn).selfDivide(j).doubleValue(),zn=Le.valueOf(y.y).selfAdd(Le.valueOf(x.y).selfSubtract(y.y).selfMultiply(Mn)).doubleValue();return new Q(Lt,zn)},zt.orientationIndexFilter=function(a,h,y){var x=null,T=(a.x-y.x)*(h.y-y.y),F=(a.y-y.y)*(h.x-y.x),j=T-F;if(T>0){if(F<=0)return zt.signum(j);x=T+F}else{if(!(T<0)||F>=0)return zt.signum(j);x=-T-F}var ce=zt.DP_SAFE_EPSILON*x;return j>=ce||-j>=ce?zt.signum(j):2},zt.signum=function(a){return a>0?1:a<0?-1:0},gn.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(zt,gn);var Dt=function(){},Un={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Un.X.get=function(){return 0},Un.Y.get=function(){return 1},Un.Z.get=function(){return 2},Un.M.get=function(){return 3},Dt.prototype.setOrdinate=function(a,h,y){},Dt.prototype.size=function(){},Dt.prototype.getOrdinate=function(a,h){},Dt.prototype.getCoordinate=function(){},Dt.prototype.getCoordinateCopy=function(a){},Dt.prototype.getDimension=function(){},Dt.prototype.getX=function(a){},Dt.prototype.clone=function(){},Dt.prototype.expandEnvelope=function(a){},Dt.prototype.copy=function(){},Dt.prototype.getY=function(a){},Dt.prototype.toCoordinateArray=function(){},Dt.prototype.interfaces_=function(){return[Z]},Dt.prototype.getClass=function(){return Dt},Object.defineProperties(Dt,Un);var _n=function(){},Cn=function(a){function h(){a.call(this,"Projective point not representable on the Cartesian plane.")}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(_n),cn=function(){};cn.arraycopy=function(a,h,y,x,T){for(var F=0,j=h;j<h+T;j++)y[x+F]=a[j],F++},cn.getProperty=function(a){return{"line.separator":"\n"}[a]};var En=function a(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var h=arguments[0];this.x=h.x,this.y=h.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var x=arguments[1];this.x=arguments[0],this.y=x,this.w=1}else if(arguments[0]instanceof a&&arguments[1]instanceof a){var T=arguments[0],F=arguments[1];this.x=T.y*F.w-F.y*T.w,this.y=F.x*T.w-T.x*F.w,this.w=T.x*F.y-F.x*T.y}else if(arguments[0]instanceof Q&&arguments[1]instanceof Q){var j=arguments[0],ce=arguments[1];this.x=j.y-ce.y,this.y=ce.x-j.x,this.w=j.x*ce.y-ce.x*j.y}}else if(3===arguments.length){var ft=arguments[1],Lt=arguments[2];this.x=arguments[0],this.y=ft,this.w=Lt}else if(4===arguments.length){var $t=arguments[0],Pn=arguments[1],Mn=arguments[2],zn=arguments[3],qn=$t.y-Pn.y,hi=Pn.x-$t.x,Sn=$t.x*Pn.y-Pn.x*$t.y,bs=Mn.y-zn.y,au=zn.x-Mn.x,uu=Mn.x*zn.y-zn.x*Mn.y;this.x=hi*uu-au*Sn,this.y=bs*Sn-qn*uu,this.w=qn*au-bs*hi}};En.prototype.getY=function(){var a=this.y/this.w;if(Y.isNaN(a)||Y.isInfinite(a))throw new Cn;return a},En.prototype.getX=function(){var a=this.x/this.w;if(Y.isNaN(a)||Y.isInfinite(a))throw new Cn;return a},En.prototype.getCoordinate=function(){var a=new Q;return a.x=this.getX(),a.y=this.getY(),a},En.prototype.interfaces_=function(){return[]},En.prototype.getClass=function(){return En},En.intersection=function(a,h,y,x){var T=a.y-h.y,F=h.x-a.x,j=a.x*h.y-h.x*a.y,ce=y.y-x.y,ke=x.x-y.x,ft=y.x*x.y-x.x*y.y,Lt=T*ke-ce*F,$t=(F*ft-ke*j)/Lt,Pn=(ce*j-T*ft)/Lt;if(Y.isNaN($t)||Y.isInfinite($t)||Y.isNaN(Pn)||Y.isInfinite(Pn))throw new Cn;return new Q($t,Pn)};var sn=function a(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length)if(arguments[0]instanceof Q){var h=arguments[0];this.init(h.x,h.x,h.y,h.y)}else arguments[0]instanceof a&&this.init(arguments[0]);else if(2===arguments.length){var x=arguments[0],T=arguments[1];this.init(x.x,T.x,x.y,T.y)}else 4===arguments.length&&this.init(arguments[0],arguments[1],arguments[2],arguments[3])},Ei={serialVersionUID:{configurable:!0}};sn.prototype.getArea=function(){return this.getWidth()*this.getHeight()},sn.prototype.equals=function(a){if(!(a instanceof sn))return!1;var h=a;return this.isNull()?h.isNull():this._maxx===h.getMaxX()&&this._maxy===h.getMaxY()&&this._minx===h.getMinX()&&this._miny===h.getMinY()},sn.prototype.intersection=function(a){return this.isNull()||a.isNull()||!this.intersects(a)?new sn:new sn(this._minx>a._minx?this._minx:a._minx,this._maxx<a._maxx?this._maxx:a._maxx,this._miny>a._miny?this._miny:a._miny,this._maxy<a._maxy?this._maxy:a._maxy)},sn.prototype.isNull=function(){return this._maxx<this._minx},sn.prototype.getMaxX=function(){return this._maxx},sn.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof Q){var a=arguments[0];return this.covers(a.x,a.y)}if(arguments[0]instanceof sn){var h=arguments[0];return!this.isNull()&&!h.isNull()&&h.getMinX()>=this._minx&&h.getMaxX()<=this._maxx&&h.getMinY()>=this._miny&&h.getMaxY()<=this._maxy}}else if(2===arguments.length){var y=arguments[0],x=arguments[1];return!this.isNull()&&y>=this._minx&&y<=this._maxx&&x>=this._miny&&x<=this._maxy}},sn.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof sn){var a=arguments[0];return!this.isNull()&&!a.isNull()&&!(a._minx>this._maxx||a._maxx<this._minx||a._miny>this._maxy||a._maxy<this._miny)}if(arguments[0]instanceof Q){var h=arguments[0];return this.intersects(h.x,h.y)}}else if(2===arguments.length){var y=arguments[0],x=arguments[1];return!this.isNull()&&!(y>this._maxx||y<this._minx||x>this._maxy||x<this._miny)}},sn.prototype.getMinY=function(){return this._miny},sn.prototype.getMinX=function(){return this._minx},sn.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof Q){var a=arguments[0];this.expandToInclude(a.x,a.y)}else if(arguments[0]instanceof sn){var h=arguments[0];if(h.isNull())return null;this.isNull()?(this._minx=h.getMinX(),this._maxx=h.getMaxX(),this._miny=h.getMinY(),this._maxy=h.getMaxY()):(h._minx<this._minx&&(this._minx=h._minx),h._maxx>this._maxx&&(this._maxx=h._maxx),h._miny<this._miny&&(this._miny=h._miny),h._maxy>this._maxy&&(this._maxy=h._maxy))}}else if(2===arguments.length){var y=arguments[0],x=arguments[1];this.isNull()?(this._minx=y,this._maxx=y,this._miny=x,this._maxy=x):(y<this._minx&&(this._minx=y),y>this._maxx&&(this._maxx=y),x<this._miny&&(this._miny=x),x>this._maxy&&(this._maxy=x))}},sn.prototype.minExtent=function(){if(this.isNull())return 0;var a=this.getWidth(),h=this.getHeight();return a<h?a:h},sn.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},sn.prototype.compareTo=function(a){var h=a;return this.isNull()?h.isNull()?0:-1:h.isNull()?1:this._minx<h._minx?-1:this._minx>h._minx?1:this._miny<h._miny?-1:this._miny>h._miny?1:this._maxx<h._maxx?-1:this._maxx>h._maxx?1:this._maxy<h._maxy?-1:this._maxy>h._maxy?1:0},sn.prototype.translate=function(a,h){if(this.isNull())return null;this.init(this.getMinX()+a,this.getMaxX()+a,this.getMinY()+h,this.getMaxY()+h)},sn.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},sn.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},sn.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},sn.prototype.maxExtent=function(){if(this.isNull())return 0;var a=this.getWidth(),h=this.getHeight();return a>h?a:h},sn.prototype.expandBy=function(){if(1===arguments.length){var a=arguments[0];this.expandBy(a,a)}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this.isNull())return null;this._minx-=h,this._maxx+=h,this._miny-=y,this._maxy+=y,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},sn.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof sn)return this.covers(arguments[0]);if(arguments[0]instanceof Q)return this.covers(arguments[0])}else if(2===arguments.length)return this.covers(arguments[0],arguments[1])},sn.prototype.centre=function(){return this.isNull()?null:new Q((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},sn.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof Q){var a=arguments[0];this.init(a.x,a.x,a.y,a.y)}else if(arguments[0]instanceof sn){var h=arguments[0];this._minx=h._minx,this._maxx=h._maxx,this._miny=h._miny,this._maxy=h._maxy}}else if(2===arguments.length){var y=arguments[0],x=arguments[1];this.init(y.x,x.x,y.y,x.y)}else if(4===arguments.length){var T=arguments[0],F=arguments[1],j=arguments[2],ce=arguments[3];T<F?(this._minx=T,this._maxx=F):(this._minx=F,this._maxx=T),j<ce?(this._miny=j,this._maxy=ce):(this._miny=ce,this._maxy=j)}},sn.prototype.getMaxY=function(){return this._maxy},sn.prototype.distance=function(a){if(this.intersects(a))return 0;var h=0;this._maxx<a._minx?h=a._minx-this._maxx:this._minx>a._maxx&&(h=this._minx-a._maxx);var y=0;return this._maxy<a._miny?y=a._miny-this._maxy:this._miny>a._maxy&&(y=this._miny-a._maxy),0===h?y:0===y?h:Math.sqrt(h*h+y*y)},sn.prototype.hashCode=function(){var a=17;return 37*(a=37*(a=37*(a=37*a+Q.hashCode(this._minx))+Q.hashCode(this._maxx))+Q.hashCode(this._miny))+Q.hashCode(this._maxy)},sn.prototype.interfaces_=function(){return[ee,he]},sn.prototype.getClass=function(){return sn},sn.intersects=function(){if(3===arguments.length){var a=arguments[0],h=arguments[1],y=arguments[2];return y.x>=(a.x<h.x?a.x:h.x)&&y.x<=(a.x>h.x?a.x:h.x)&&y.y>=(a.y<h.y?a.y:h.y)&&y.y<=(a.y>h.y?a.y:h.y)}if(4===arguments.length){var x=arguments[0],T=arguments[1],F=arguments[2],j=arguments[3],ce=Math.min(F.x,j.x),ke=Math.max(F.x,j.x),ft=Math.min(x.x,T.x),Lt=Math.max(x.x,T.x);return!(ft>ke||Lt<ce||(ce=Math.min(F.y,j.y),ke=Math.max(F.y,j.y),ft=Math.min(x.y,T.y),Lt=Math.max(x.y,T.y),ft>ke||Lt<ce))}},Ei.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(sn,Ei);var cr={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},oi=function(a){this.geometryFactory=a||new Bn};oi.prototype.read=function(a){var h,y;a=a.replace(/[\n\r]/g," ");var T=cr.typeStr.exec(a);if(-1!==a.search("EMPTY")&&((T=cr.emptyTypeStr.exec(a))[2]=void 0),T&&(y=T[1].toLowerCase(),sr[y]&&(h=sr[y].apply(this,[T[2]]))),void 0===h)throw new Error("Could not parse WKT "+a);return h},oi.prototype.write=function(a){return this.extractGeometry(a)},oi.prototype.extractGeometry=function(a){var h=a.getGeometryType().toLowerCase();if(!tr[h])return null;var y=h.toUpperCase();return a.isEmpty()?y+" EMPTY":y+"("+tr[h].apply(this,[a])+")"};var tr={coordinate:function(a){return a.x+" "+a.y},point:function(a){return tr.coordinate.call(this,a._coordinates._coordinates[0])},multipoint:function(a){for(var h=[],y=0,x=a._geometries.length;y<x;++y)h.push("("+tr.point.apply(this,[a._geometries[y]])+")");return h.join(",")},linestring:function(a){for(var h=[],y=0,x=a._points._coordinates.length;y<x;++y)h.push(tr.coordinate.apply(this,[a._points._coordinates[y]]));return h.join(",")},linearring:function(a){for(var h=[],y=0,x=a._points._coordinates.length;y<x;++y)h.push(tr.coordinate.apply(this,[a._points._coordinates[y]]));return h.join(",")},multilinestring:function(a){for(var h=[],y=0,x=a._geometries.length;y<x;++y)h.push("("+tr.linestring.apply(this,[a._geometries[y]])+")");return h.join(",")},polygon:function(a){var h=[];h.push("("+tr.linestring.apply(this,[a._shell])+")");for(var y=0,x=a._holes.length;y<x;++y)h.push("("+tr.linestring.apply(this,[a._holes[y]])+")");return h.join(",")},multipolygon:function(a){for(var h=[],y=0,x=a._geometries.length;y<x;++y)h.push("("+tr.polygon.apply(this,[a._geometries[y]])+")");return h.join(",")},geometrycollection:function(a){for(var h=[],y=0,x=a._geometries.length;y<x;++y)h.push(this.extractGeometry(a._geometries[y]));return h.join(",")}},sr={point:function(a){if(void 0===a)return this.geometryFactory.createPoint();var h=a.trim().split(cr.spaces);return this.geometryFactory.createPoint(new Q(Number.parseFloat(h[0]),Number.parseFloat(h[1])))},multipoint:function(a){if(void 0===a)return this.geometryFactory.createMultiPoint();for(var h,y=a.trim().split(","),x=[],T=0,F=y.length;T<F;++T)h=y[T].replace(cr.trimParens,"$1"),x.push(sr.point.apply(this,[h]));return this.geometryFactory.createMultiPoint(x)},linestring:function(a){if(void 0===a)return this.geometryFactory.createLineString();for(var h,y=a.trim().split(","),x=[],T=0,F=y.length;T<F;++T)h=y[T].trim().split(cr.spaces),x.push(new Q(Number.parseFloat(h[0]),Number.parseFloat(h[1])));return this.geometryFactory.createLineString(x)},linearring:function(a){if(void 0===a)return this.geometryFactory.createLinearRing();for(var h,y=a.trim().split(","),x=[],T=0,F=y.length;T<F;++T)h=y[T].trim().split(cr.spaces),x.push(new Q(Number.parseFloat(h[0]),Number.parseFloat(h[1])));return this.geometryFactory.createLinearRing(x)},multilinestring:function(a){if(void 0===a)return this.geometryFactory.createMultiLineString();for(var h,y=a.trim().split(cr.parenComma),x=[],T=0,F=y.length;T<F;++T)h=y[T].replace(cr.trimParens,"$1"),x.push(sr.linestring.apply(this,[h]));return this.geometryFactory.createMultiLineString(x)},polygon:function(a){if(void 0===a)return this.geometryFactory.createPolygon();for(var h,y,x,T,F=a.trim().split(cr.parenComma),j=[],ce=0,ke=F.length;ce<ke;++ce)h=F[ce].replace(cr.trimParens,"$1"),y=sr.linestring.apply(this,[h]),x=this.geometryFactory.createLinearRing(y._points),0===ce?T=x:j.push(x);return this.geometryFactory.createPolygon(T,j)},multipolygon:function(a){if(void 0===a)return this.geometryFactory.createMultiPolygon();for(var h,y=a.trim().split(cr.doubleParenComma),x=[],T=0,F=y.length;T<F;++T)h=y[T].replace(cr.trimParens,"$1"),x.push(sr.polygon.apply(this,[h]));return this.geometryFactory.createMultiPolygon(x)},geometrycollection:function(a){if(void 0===a)return this.geometryFactory.createGeometryCollection();for(var h=(a=a.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),y=[],x=0,T=h.length;x<T;++x)y.push(this.read(h[x]));return this.geometryFactory.createGeometryCollection(y)}},wt=function(a){this.parser=new oi(a)};wt.prototype.write=function(a){return this.parser.write(a)},wt.toLineString=function(a,h){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+a.x+" "+a.y+", "+h.x+" "+h.y+" )"};var Te=function(a){function h(y){a.call(this,y),this.name="RuntimeException",this.message=y,this.stack=(new a).stack}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h}(Error),we=function(a){function h(){a.call(this),0===arguments.length?a.call(this):1===arguments.length&&a.call(this,arguments[0])}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Te),xe=function(){};xe.prototype.interfaces_=function(){return[]},xe.prototype.getClass=function(){return xe},xe.shouldNeverReachHere=function(){if(0===arguments.length)xe.shouldNeverReachHere(null);else if(1===arguments.length){var a=arguments[0];throw new we("Should never reach here"+(null!==a?": "+a:""))}},xe.isTrue=function(){var h;if(1===arguments.length)xe.isTrue(arguments[0],null);else if(2===arguments.length&&(h=arguments[1],!arguments[0]))throw null===h?new we:new we(h)},xe.equals=function(){var a,h,y;if(2===arguments.length)xe.equals(a=arguments[0],h=arguments[1],null);else if(3===arguments.length&&(y=arguments[2],!(h=arguments[1]).equals(a=arguments[0])))throw new we("Expected "+a+" but encountered "+h+(null!==y?": "+y:""))};var Ze=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Q,this._intPt[1]=new Q,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},yt={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Ze.prototype.getIndexAlongSegment=function(a,h){return this.computeIntLineIndex(),this._intLineIndex[a][h]},Ze.prototype.getTopologySummary=function(){var a=new Fe;return this.isEndPoint()&&a.append(" endpoint"),this._isProper&&a.append(" proper"),this.isCollinear()&&a.append(" collinear"),a.toString()},Ze.prototype.computeIntersection=function(a,h,y,x){this._inputLines[0][0]=a,this._inputLines[0][1]=h,this._inputLines[1][0]=y,this._inputLines[1][1]=x,this._result=this.computeIntersect(a,h,y,x)},Ze.prototype.getIntersectionNum=function(){return this._result},Ze.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var a=arguments[0];this.getEdgeDistance(a,0)>this.getEdgeDistance(a,1)?(this._intLineIndex[a][0]=0,this._intLineIndex[a][1]=1):(this._intLineIndex[a][0]=1,this._intLineIndex[a][1]=0)}},Ze.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},Ze.prototype.setPrecisionModel=function(a){this._precisionModel=a},Ze.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var a=arguments[0],h=0;h<this._result;h++)if(!this._intPt[h].equals2D(this._inputLines[a][0])&&!this._intPt[h].equals2D(this._inputLines[a][1]))return!0;return!1}},Ze.prototype.getIntersection=function(a){return this._intPt[a]},Ze.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},Ze.prototype.hasIntersection=function(){return this._result!==Ze.NO_INTERSECTION},Ze.prototype.getEdgeDistance=function(a,h){return Ze.computeEdgeDistance(this._intPt[h],this._inputLines[a][0],this._inputLines[a][1])},Ze.prototype.isCollinear=function(){return this._result===Ze.COLLINEAR_INTERSECTION},Ze.prototype.toString=function(){return wt.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+wt.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},Ze.prototype.getEndpoint=function(a,h){return this._inputLines[a][h]},Ze.prototype.isIntersection=function(a){for(var h=0;h<this._result;h++)if(this._intPt[h].equals2D(a))return!0;return!1},Ze.prototype.getIntersectionAlongSegment=function(a,h){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[a][h]]},Ze.prototype.interfaces_=function(){return[]},Ze.prototype.getClass=function(){return Ze},Ze.computeEdgeDistance=function(a,h,y){var x=Math.abs(y.x-h.x),T=Math.abs(y.y-h.y),F=-1;if(a.equals(h))F=0;else if(a.equals(y))F=x>T?x:T;else{var j=Math.abs(a.x-h.x),ce=Math.abs(a.y-h.y);0!==(F=x>T?j:ce)||a.equals(h)||(F=Math.max(j,ce))}return xe.isTrue(!(0===F&&!a.equals(h)),"Bad distance calculation"),F},Ze.nonRobustComputeEdgeDistance=function(a,h,y){var x=a.x-h.x,T=a.y-h.y,F=Math.sqrt(x*x+T*T);return xe.isTrue(!(0===F&&!a.equals(h)),"Invalid distance calculation"),F},yt.DONT_INTERSECT.get=function(){return 0},yt.DO_INTERSECT.get=function(){return 1},yt.COLLINEAR.get=function(){return 2},yt.NO_INTERSECTION.get=function(){return 0},yt.POINT_INTERSECTION.get=function(){return 1},yt.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(Ze,yt);var Vt=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.isInSegmentEnvelopes=function(y){var x=new sn(this._inputLines[0][0],this._inputLines[0][1]),T=new sn(this._inputLines[1][0],this._inputLines[1][1]);return x.contains(y)&&T.contains(y)},h.prototype.computeIntersection=function(){if(3!==arguments.length)return a.prototype.computeIntersection.apply(this,arguments);var y=arguments[0],x=arguments[1],T=arguments[2];if(this._isProper=!1,sn.intersects(x,T,y)&&0===Gt.orientationIndex(x,T,y)&&0===Gt.orientationIndex(T,x,y))return this._isProper=!0,(y.equals(x)||y.equals(T))&&(this._isProper=!1),this._result=a.POINT_INTERSECTION,null;this._result=a.NO_INTERSECTION},h.prototype.normalizeToMinimum=function(y,x,T,F,j){j.x=this.smallestInAbsValue(y.x,x.x,T.x,F.x),j.y=this.smallestInAbsValue(y.y,x.y,T.y,F.y),y.x-=j.x,y.y-=j.y,x.x-=j.x,x.y-=j.y,T.x-=j.x,T.y-=j.y,F.x-=j.x,F.y-=j.y},h.prototype.safeHCoordinateIntersection=function(y,x,T,F){var j=null;try{j=En.intersection(y,x,T,F)}catch(ce){if(!(ce instanceof Cn))throw ce;j=h.nearestEndpoint(y,x,T,F)}return j},h.prototype.intersection=function(y,x,T,F){var j=this.intersectionWithNormalization(y,x,T,F);return this.isInSegmentEnvelopes(j)||(j=new Q(h.nearestEndpoint(y,x,T,F))),null!==this._precisionModel&&this._precisionModel.makePrecise(j),j},h.prototype.smallestInAbsValue=function(y,x,T,F){var j=y,ce=Math.abs(j);return Math.abs(x)<ce&&(j=x,ce=Math.abs(x)),Math.abs(T)<ce&&(j=T,ce=Math.abs(T)),Math.abs(F)<ce&&(j=F),j},h.prototype.checkDD=function(y,x,T,F,j){var ce=zt.intersection(y,x,T,F),ke=this.isInSegmentEnvelopes(ce);cn.out.println("DD in env = "+ke+"  --------------------- "+ce),j.distance(ce)>1e-4&&cn.out.println("Distance = "+j.distance(ce))},h.prototype.intersectionWithNormalization=function(y,x,T,F){var j=new Q(y),ce=new Q(x),ke=new Q(T),ft=new Q(F),Lt=new Q;this.normalizeToEnvCentre(j,ce,ke,ft,Lt);var $t=this.safeHCoordinateIntersection(j,ce,ke,ft);return $t.x+=Lt.x,$t.y+=Lt.y,$t},h.prototype.computeCollinearIntersection=function(y,x,T,F){var j=sn.intersects(y,x,T),ce=sn.intersects(y,x,F),ke=sn.intersects(T,F,y),ft=sn.intersects(T,F,x);return j&&ce?(this._intPt[0]=T,this._intPt[1]=F,a.COLLINEAR_INTERSECTION):ke&&ft?(this._intPt[0]=y,this._intPt[1]=x,a.COLLINEAR_INTERSECTION):j&&ke?(this._intPt[0]=T,this._intPt[1]=y,!T.equals(y)||ce||ft?a.COLLINEAR_INTERSECTION:a.POINT_INTERSECTION):j&&ft?(this._intPt[0]=T,this._intPt[1]=x,!T.equals(x)||ce||ke?a.COLLINEAR_INTERSECTION:a.POINT_INTERSECTION):ce&&ke?(this._intPt[0]=F,this._intPt[1]=y,!F.equals(y)||j||ft?a.COLLINEAR_INTERSECTION:a.POINT_INTERSECTION):ce&&ft?(this._intPt[0]=F,this._intPt[1]=x,!F.equals(x)||j||ke?a.COLLINEAR_INTERSECTION:a.POINT_INTERSECTION):a.NO_INTERSECTION},h.prototype.normalizeToEnvCentre=function(y,x,T,F,j){var ce=y.x<x.x?y.x:x.x,ke=y.y<x.y?y.y:x.y,ft=y.x>x.x?y.x:x.x,Lt=y.y>x.y?y.y:x.y,$t=T.x<F.x?T.x:F.x,Pn=T.y<F.y?T.y:F.y,Mn=T.x>F.x?T.x:F.x,zn=T.y>F.y?T.y:F.y,hi=((ke>Pn?ke:Pn)+(Lt<zn?Lt:zn))/2;j.x=((ce>$t?ce:$t)+(ft<Mn?ft:Mn))/2,j.y=hi,y.x-=j.x,y.y-=j.y,x.x-=j.x,x.y-=j.y,T.x-=j.x,T.y-=j.y,F.x-=j.x,F.y-=j.y},h.prototype.computeIntersect=function(y,x,T,F){if(this._isProper=!1,!sn.intersects(y,x,T,F))return a.NO_INTERSECTION;var j=Gt.orientationIndex(y,x,T),ce=Gt.orientationIndex(y,x,F);if(j>0&&ce>0||j<0&&ce<0)return a.NO_INTERSECTION;var ke=Gt.orientationIndex(T,F,y),ft=Gt.orientationIndex(T,F,x);return ke>0&&ft>0||ke<0&&ft<0?a.NO_INTERSECTION:0===j&&0===ce&&0===ke&&0===ft?this.computeCollinearIntersection(y,x,T,F):(0===j||0===ce||0===ke||0===ft?(this._isProper=!1,y.equals2D(T)||y.equals2D(F)?this._intPt[0]=y:x.equals2D(T)||x.equals2D(F)?this._intPt[0]=x:0===j?this._intPt[0]=new Q(T):0===ce?this._intPt[0]=new Q(F):0===ke?this._intPt[0]=new Q(y):0===ft&&(this._intPt[0]=new Q(x))):(this._isProper=!0,this._intPt[0]=this.intersection(y,x,T,F)),a.POINT_INTERSECTION)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.nearestEndpoint=function(y,x,T,F){var j=y,ce=Gt.distancePointLine(y,T,F),ke=Gt.distancePointLine(x,T,F);return ke<ce&&(ce=ke,j=x),(ke=Gt.distancePointLine(T,y,x))<ce&&(ce=ke,j=T),(ke=Gt.distancePointLine(F,y,x))<ce&&(ce=ke,j=F),j},h}(Ze),rn=function(){};rn.prototype.interfaces_=function(){return[]},rn.prototype.getClass=function(){return rn},rn.orientationIndex=function(a,h,y){return rn.signOfDet2x2(h.x-a.x,h.y-a.y,y.x-h.x,y.y-h.y)},rn.signOfDet2x2=function(a,h,y,x){var T=null,F=null,j=null;if(T=1,0===a||0===x)return 0===h||0===y?0:h>0?y>0?-T:T:y>0?T:-T;if(0===h||0===y)return x>0?a>0?T:-T:a>0?-T:T;if(h>0?x>0?h<=x||(T=-T,F=a,a=y,y=F,F=h,h=x,x=F):h<=-x?(T=-T,y=-y,x=-x):(F=a,a=-y,y=F,F=h,h=-x,x=F):x>0?-h<=x?(T=-T,a=-a,h=-h):(F=-a,a=y,y=F,F=-h,h=x,x=F):h>=x?(a=-a,h=-h,y=-y,x=-x):(T=-T,F=-a,a=-y,y=F,F=-h,h=-x,x=F),a>0){if(!(y>0&&a<=y))return T}else{if(y>0||!(a>=y))return-T;T=-T,a=-a,y=-y}for(;;){if((x-=(j=Math.floor(y/a))*h)<0)return-T;if(x>h)return T;if(a>(y-=j*a)+y){if(h<x+x)return T}else{if(h>x+x)return-T;y=a-y,x=h-x,T=-T}if(0===x)return 0===y?0:-T;if(0===y||(a-=(j=Math.floor(a/y))*y,(h-=j*x)<0))return T;if(h>x)return-T;if(y>a+a){if(x<h+h)return-T}else{if(x>h+h)return T;a=y-a,h=x-h,T=-T}if(0===h)return 0===a?0:T;if(0===a)return-T}};var tn=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1,this._p=arguments[0]};tn.prototype.countSegment=function(a,h){if(a.x<this._p.x&&h.x<this._p.x)return null;if(this._p.x===h.x&&this._p.y===h.y)return this._isPointOnSegment=!0,null;if(a.y===this._p.y&&h.y===this._p.y){var y=a.x,x=h.x;return y>x&&(y=h.x,x=a.x),this._p.x>=y&&this._p.x<=x&&(this._isPointOnSegment=!0),null}if(a.y>this._p.y&&h.y<=this._p.y||h.y>this._p.y&&a.y<=this._p.y){var F=a.y-this._p.y,ce=h.y-this._p.y,ke=rn.signOfDet2x2(a.x-this._p.x,F,h.x-this._p.x,ce);if(0===ke)return this._isPointOnSegment=!0,null;ce<F&&(ke=-ke),ke>0&&this._crossingCount++}},tn.prototype.isPointInPolygon=function(){return this.getLocation()!==Ae.EXTERIOR},tn.prototype.getLocation=function(){return this._isPointOnSegment?Ae.BOUNDARY:this._crossingCount%2==1?Ae.INTERIOR:Ae.EXTERIOR},tn.prototype.isOnSegment=function(){return this._isPointOnSegment},tn.prototype.interfaces_=function(){return[]},tn.prototype.getClass=function(){return tn},tn.locatePointInRing=function(){if(arguments[0]instanceof Q&&At(arguments[1],Dt)){for(var h=arguments[1],y=new tn(arguments[0]),x=new Q,T=new Q,F=1;F<h.size();F++)if(h.getCoordinate(F,x),h.getCoordinate(F-1,T),y.countSegment(x,T),y.isOnSegment())return y.getLocation();return y.getLocation()}if(arguments[0]instanceof Q&&arguments[1]instanceof Array){for(var ce=arguments[1],ke=new tn(arguments[0]),ft=1;ft<ce.length;ft++)if(ke.countSegment(ce[ft],ce[ft-1]),ke.isOnSegment())return ke.getLocation();return ke.getLocation()}};var Gt=function(){},hr={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};Gt.prototype.interfaces_=function(){return[]},Gt.prototype.getClass=function(){return Gt},Gt.orientationIndex=function(a,h,y){return zt.orientationIndex(a,h,y)},Gt.signedArea=function(){if(arguments[0]instanceof Array){var a=arguments[0];if(a.length<3)return 0;for(var h=0,y=a[0].x,x=1;x<a.length-1;x++)h+=(a[x].x-y)*(a[x-1].y-a[x+1].y);return h/2}if(At(arguments[0],Dt)){var j=arguments[0],ce=j.size();if(ce<3)return 0;var ke=new Q,ft=new Q,Lt=new Q;j.getCoordinate(0,ft),j.getCoordinate(1,Lt);var $t=ft.x;Lt.x-=$t;for(var Pn=0,Mn=1;Mn<ce-1;Mn++)ke.y=ft.y,ft.x=Lt.x,ft.y=Lt.y,j.getCoordinate(Mn+1,Lt),Lt.x-=$t,Pn+=ft.x*(ke.y-Lt.y);return Pn/2}},Gt.distanceLineLine=function(a,h,y,x){if(a.equals(h))return Gt.distancePointLine(a,y,x);if(y.equals(x))return Gt.distancePointLine(x,a,h);var T=!1;if(sn.intersects(a,h,y,x)){var F=(h.x-a.x)*(x.y-y.y)-(h.y-a.y)*(x.x-y.x);if(0===F)T=!0;else{var ce=((a.y-y.y)*(h.x-a.x)-(a.x-y.x)*(h.y-a.y))/F,ke=((a.y-y.y)*(x.x-y.x)-(a.x-y.x)*(x.y-y.y))/F;(ke<0||ke>1||ce<0||ce>1)&&(T=!0)}}else T=!0;return T?De.min(Gt.distancePointLine(a,y,x),Gt.distancePointLine(h,y,x),Gt.distancePointLine(y,a,h),Gt.distancePointLine(x,a,h)):0},Gt.isPointInRing=function(a,h){return Gt.locatePointInRing(a,h)!==Ae.EXTERIOR},Gt.computeLength=function(a){var h=a.size();if(h<=1)return 0;var y=0,x=new Q;a.getCoordinate(0,x);for(var T=x.x,F=x.y,j=1;j<h;j++){a.getCoordinate(j,x);var ce=x.x,ke=x.y,ft=ce-T,Lt=ke-F;y+=Math.sqrt(ft*ft+Lt*Lt),T=ce,F=ke}return y},Gt.isCCW=function(a){var h=a.length-1;if(h<3)throw new re("Ring has fewer than 4 points, so orientation cannot be determined");for(var y=a[0],x=0,T=1;T<=h;T++){var F=a[T];F.y>y.y&&(y=F,x=T)}var j=x;do{(j-=1)<0&&(j=h)}while(a[j].equals2D(y)&&j!==x);var ce=x;do{ce=(ce+1)%h}while(a[ce].equals2D(y)&&ce!==x);var ke=a[j],ft=a[ce];if(ke.equals2D(y)||ft.equals2D(y)||ke.equals2D(ft))return!1;var Lt=Gt.computeOrientation(ke,y,ft);return 0===Lt?ke.x>ft.x:Lt>0},Gt.locatePointInRing=function(a,h){return tn.locatePointInRing(a,h)},Gt.distancePointLinePerpendicular=function(a,h,y){var x=(y.x-h.x)*(y.x-h.x)+(y.y-h.y)*(y.y-h.y);return Math.abs(((h.y-a.y)*(y.x-h.x)-(h.x-a.x)*(y.y-h.y))/x)*Math.sqrt(x)},Gt.computeOrientation=function(a,h,y){return Gt.orientationIndex(a,h,y)},Gt.distancePointLine=function(){if(2===arguments.length){var a=arguments[0],h=arguments[1];if(0===h.length)throw new re("Line array must contain at least one vertex");for(var y=a.distance(h[0]),x=0;x<h.length-1;x++){var T=Gt.distancePointLine(a,h[x],h[x+1]);T<y&&(y=T)}return y}if(3===arguments.length){var F=arguments[0],j=arguments[1],ce=arguments[2];if(j.x===ce.x&&j.y===ce.y)return F.distance(j);var ke=(ce.x-j.x)*(ce.x-j.x)+(ce.y-j.y)*(ce.y-j.y),ft=((F.x-j.x)*(ce.x-j.x)+(F.y-j.y)*(ce.y-j.y))/ke;return ft<=0?F.distance(j):ft>=1?F.distance(ce):Math.abs(((j.y-F.y)*(ce.x-j.x)-(j.x-F.x)*(ce.y-j.y))/ke)*Math.sqrt(ke)}},Gt.isOnLine=function(a,h){for(var y=new Vt,x=1;x<h.length;x++)if(y.computeIntersection(a,h[x-1],h[x]),y.hasIntersection())return!0;return!1},hr.CLOCKWISE.get=function(){return-1},hr.RIGHT.get=function(){return Gt.CLOCKWISE},hr.COUNTERCLOCKWISE.get=function(){return 1},hr.LEFT.get=function(){return Gt.COUNTERCLOCKWISE},hr.COLLINEAR.get=function(){return 0},hr.STRAIGHT.get=function(){return Gt.COLLINEAR},Object.defineProperties(Gt,hr);var yr=function(){};yr.prototype.filter=function(a){},yr.prototype.interfaces_=function(){return[]},yr.prototype.getClass=function(){return yr};var Tn=function(){var a=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=a,this._SRID=a.getSRID()},br={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Tn.prototype.isGeometryCollection=function(){return this.getSortIndex()===Tn.SORTINDEX_GEOMETRYCOLLECTION},Tn.prototype.getFactory=function(){return this._factory},Tn.prototype.getGeometryN=function(a){return this},Tn.prototype.getArea=function(){return 0},Tn.prototype.isRectangle=function(){return!1},Tn.prototype.equals=function(){if(arguments[0]instanceof Tn){var a=arguments[0];return null!==a&&this.equalsTopo(a)}if(arguments[0]instanceof Object){var h=arguments[0];return h instanceof Tn&&this.equalsExact(h)}},Tn.prototype.equalsExact=function(a){return this===a||this.equalsExact(a,0)},Tn.prototype.geometryChanged=function(){this.apply(Tn.geometryChangedFilter)},Tn.prototype.geometryChangedAction=function(){this._envelope=null},Tn.prototype.equalsNorm=function(a){return null!==a&&this.norm().equalsExact(a.norm())},Tn.prototype.getLength=function(){return 0},Tn.prototype.getNumGeometries=function(){return 1},Tn.prototype.compareTo=function(){if(1===arguments.length){var a=arguments[0],h=a;return this.getSortIndex()!==h.getSortIndex()?this.getSortIndex()-h.getSortIndex():this.isEmpty()&&h.isEmpty()?0:this.isEmpty()?-1:h.isEmpty()?1:this.compareToSameClass(a)}if(2===arguments.length){var y=arguments[0],x=arguments[1];return this.getSortIndex()!==y.getSortIndex()?this.getSortIndex()-y.getSortIndex():this.isEmpty()&&y.isEmpty()?0:this.isEmpty()?-1:y.isEmpty()?1:this.compareToSameClass(y,x)}},Tn.prototype.getUserData=function(){return this._userData},Tn.prototype.getSRID=function(){return this._SRID},Tn.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},Tn.prototype.checkNotGeometryCollection=function(a){if(a.getSortIndex()===Tn.SORTINDEX_GEOMETRYCOLLECTION)throw new re("This method does not support GeometryCollection arguments")},Tn.prototype.equal=function(a,h,y){return 0===y?a.equals(h):a.distance(h)<=y},Tn.prototype.norm=function(){var a=this.copy();return a.normalize(),a},Tn.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},Tn.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new sn(this._envelope)},Tn.prototype.setSRID=function(a){this._SRID=a},Tn.prototype.setUserData=function(a){this._userData=a},Tn.prototype.compare=function(a,h){for(var y=a.iterator(),x=h.iterator();y.hasNext()&&x.hasNext();){var T=y.next(),F=x.next(),j=T.compareTo(F);if(0!==j)return j}return y.hasNext()?1:x.hasNext()?-1:0},Tn.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},Tn.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Tn.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Tn.SORTINDEX_MULTIPOINT||this.getSortIndex()===Tn.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Tn.SORTINDEX_MULTIPOLYGON},Tn.prototype.interfaces_=function(){return[Z,ee,he]},Tn.prototype.getClass=function(){return Tn},Tn.hasNonEmptyElements=function(a){for(var h=0;h<a.length;h++)if(!a[h].isEmpty())return!0;return!1},Tn.hasNullElements=function(a){for(var h=0;h<a.length;h++)if(null===a[h])return!0;return!1},br.serialVersionUID.get=function(){return 0x799ea46522854c00},br.SORTINDEX_POINT.get=function(){return 0},br.SORTINDEX_MULTIPOINT.get=function(){return 1},br.SORTINDEX_LINESTRING.get=function(){return 2},br.SORTINDEX_LINEARRING.get=function(){return 3},br.SORTINDEX_MULTILINESTRING.get=function(){return 4},br.SORTINDEX_POLYGON.get=function(){return 5},br.SORTINDEX_MULTIPOLYGON.get=function(){return 6},br.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},br.geometryChangedFilter.get=function(){return si},Object.defineProperties(Tn,br);var si=function(){};si.interfaces_=function(){return[yr]},si.filter=function(a){a.geometryChangedAction()};var zr=function(){};zr.prototype.filter=function(a){},zr.prototype.interfaces_=function(){return[]},zr.prototype.getClass=function(){return zr};var ni=function(){},Ii={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};ni.prototype.isInBoundary=function(a){},ni.prototype.interfaces_=function(){return[]},ni.prototype.getClass=function(){return ni},Ii.Mod2BoundaryNodeRule.get=function(){return Uo},Ii.EndPointBoundaryNodeRule.get=function(){return ys},Ii.MultiValentEndPointBoundaryNodeRule.get=function(){return Ke},Ii.MonoValentEndPointBoundaryNodeRule.get=function(){return ge},Ii.MOD2_BOUNDARY_RULE.get=function(){return new Uo},Ii.ENDPOINT_BOUNDARY_RULE.get=function(){return new ys},Ii.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Ke},Ii.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new ge},Ii.OGC_SFS_BOUNDARY_RULE.get=function(){return ni.MOD2_BOUNDARY_RULE},Object.defineProperties(ni,Ii);var Uo=function(){};Uo.prototype.isInBoundary=function(a){return a%2==1},Uo.prototype.interfaces_=function(){return[ni]},Uo.prototype.getClass=function(){return Uo};var ys=function(){};ys.prototype.isInBoundary=function(a){return a>0},ys.prototype.interfaces_=function(){return[ni]},ys.prototype.getClass=function(){return ys};var Ke=function(){};Ke.prototype.isInBoundary=function(a){return a>1},Ke.prototype.interfaces_=function(){return[ni]},Ke.prototype.getClass=function(){return Ke};var ge=function(){};ge.prototype.isInBoundary=function(a){return 1===a},ge.prototype.interfaces_=function(){return[ni]},ge.prototype.getClass=function(){return ge};var ye=function(){};ye.prototype.add=function(){},ye.prototype.addAll=function(){},ye.prototype.isEmpty=function(){},ye.prototype.iterator=function(){},ye.prototype.size=function(){},ye.prototype.toArray=function(){},ye.prototype.remove=function(){},(de.prototype=new Error).name="IndexOutOfBoundsException";var We=function(){};We.prototype.hasNext=function(){},We.prototype.next=function(){},We.prototype.remove=function(){};var rt=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.get=function(){},h.prototype.set=function(){},h.prototype.isEmpty=function(){},h}(ye);(_e.prototype=new Error).name="NoSuchElementException";var Ve=function(a){function h(){a.call(this),this.array_=[],arguments[0]instanceof ye&&this.addAll(arguments[0])}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.ensureCapacity=function(){},h.prototype.interfaces_=function(){return[a,ye]},h.prototype.add=function(y){return 1===arguments.length?this.array_.push(y):this.array_.splice(arguments[0],arguments[1]),!0},h.prototype.clear=function(){this.array_=[]},h.prototype.addAll=function(y){for(var x=y.iterator();x.hasNext();)this.add(x.next());return!0},h.prototype.set=function(y,x){var T=this.array_[y];return this.array_[y]=x,T},h.prototype.iterator=function(){return new It(this)},h.prototype.get=function(y){if(y<0||y>=this.size())throw new de;return this.array_[y]},h.prototype.isEmpty=function(){return 0===this.array_.length},h.prototype.size=function(){return this.array_.length},h.prototype.toArray=function(){for(var y=[],x=0,T=this.array_.length;x<T;x++)y.push(this.array_[x]);return y},h.prototype.remove=function(y){for(var x=!1,T=0,F=this.array_.length;T<F;T++)if(this.array_[T]===y){this.array_.splice(T,1),x=!0;break}return x},h}(rt),It=function(a){function h(y){a.call(this),this.arrayList_=y,this.position_=0}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new _e;return this.arrayList_.get(this.position_++)},h.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},h.prototype.set=function(y){return this.arrayList_.set(this.position_-1,y)},h.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},h}(We),Ct=function(a){function h(){if(a.call(this),0!==arguments.length)if(1===arguments.length){var x=arguments[0];this.ensureCapacity(x.length),this.add(x,!0)}else if(2===arguments.length){var T=arguments[0],F=arguments[1];this.ensureCapacity(T.length),this.add(T,F)}}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={coordArrayType:{configurable:!0}};return y.coordArrayType.get=function(){return new Array(0).fill(null)},h.prototype.getCoordinate=function(x){return this.get(x)},h.prototype.addAll=function(){if(2===arguments.length){for(var T=arguments[1],F=!1,j=arguments[0].iterator();j.hasNext();)this.add(j.next(),T),F=!0;return F}return a.prototype.addAll.apply(this,arguments)},h.prototype.clone=function(){for(var x=a.prototype.clone.call(this),T=0;T<this.size();T++)x.add(T,this.get(T).copy());return x},h.prototype.toCoordinateArray=function(){return this.toArray(h.coordArrayType)},h.prototype.add=function(){if(1===arguments.length)a.prototype.add.call(this,arguments[0]);else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1],!0),!0;if(arguments[0]instanceof Q&&"boolean"==typeof arguments[1]){var j=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(j))return null;a.prototype.add.call(this,j)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1]),!0}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var ft=arguments[0],Lt=arguments[1];if(arguments[2])for(var $t=0;$t<ft.length;$t++)this.add(ft[$t],Lt);else for(var Pn=ft.length-1;Pn>=0;Pn--)this.add(ft[Pn],Lt);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof Q){var Mn=arguments[0],zn=arguments[1];if(!arguments[2]){var qn=this.size();if(qn>0&&(Mn>0&&this.get(Mn-1).equals2D(zn)||Mn<qn&&this.get(Mn).equals2D(zn)))return null}a.prototype.add.call(this,Mn,zn)}}else if(4===arguments.length){var hi=arguments[0],Sn=arguments[1],bs=arguments[2],au=arguments[3],uu=1;bs>au&&(uu=-1);for(var Rl=bs;Rl!==au;Rl+=uu)this.add(hi[Rl],Sn);return!0}},h.prototype.closeRing=function(){this.size()>0&&this.add(new Q(this.get(0)),!1)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},Object.defineProperties(h,y),h}(Ve),tt=function(){},Ft={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Ft.ForwardComparator.get=function(){return hn},Ft.BidirectionalComparator.get=function(){return bn},Ft.coordArrayType.get=function(){return new Array(0).fill(null)},tt.prototype.interfaces_=function(){return[]},tt.prototype.getClass=function(){return tt},tt.isRing=function(a){return!(a.length<4||!a[0].equals2D(a[a.length-1]))},tt.ptNotInList=function(a,h){for(var y=0;y<a.length;y++){var x=a[y];if(tt.indexOf(x,h)<0)return x}return null},tt.scroll=function(a,h){var y=tt.indexOf(h,a);if(y<0)return null;var x=new Array(a.length).fill(null);cn.arraycopy(a,y,x,0,a.length-y),cn.arraycopy(a,0,x,a.length-y,y),cn.arraycopy(x,0,a,0,a.length)},tt.equals=function(){if(2===arguments.length){var a=arguments[0],h=arguments[1];if(a===h)return!0;if(null===a||null===h||a.length!==h.length)return!1;for(var y=0;y<a.length;y++)if(!a[y].equals(h[y]))return!1;return!0}if(3===arguments.length){var x=arguments[0],T=arguments[1],F=arguments[2];if(x===T)return!0;if(null===x||null===T||x.length!==T.length)return!1;for(var j=0;j<x.length;j++)if(0!==F.compare(x[j],T[j]))return!1;return!0}},tt.intersection=function(a,h){for(var y=new Ct,x=0;x<a.length;x++)h.intersects(a[x])&&y.add(a[x],!0);return y.toCoordinateArray()},tt.hasRepeatedPoints=function(a){for(var h=1;h<a.length;h++)if(a[h-1].equals(a[h]))return!0;return!1},tt.removeRepeatedPoints=function(a){return tt.hasRepeatedPoints(a)?new Ct(a,!1).toCoordinateArray():a},tt.reverse=function(a){for(var h=a.length-1,y=Math.trunc(h/2),x=0;x<=y;x++){var T=a[x];a[x]=a[h-x],a[h-x]=T}},tt.removeNull=function(a){for(var h=0,y=0;y<a.length;y++)null!==a[y]&&h++;var x=new Array(h).fill(null);if(0===h)return x;for(var T=0,F=0;F<a.length;F++)null!==a[F]&&(x[T++]=a[F]);return x},tt.copyDeep=function(){if(1===arguments.length){for(var a=arguments[0],h=new Array(a.length).fill(null),y=0;y<a.length;y++)h[y]=new Q(a[y]);return h}if(5===arguments.length)for(var x=arguments[0],T=arguments[1],F=arguments[2],j=arguments[3],ce=arguments[4],ke=0;ke<ce;ke++)F[j+ke]=new Q(x[T+ke])},tt.isEqualReversed=function(a,h){for(var y=0;y<a.length;y++)if(0!==a[y].compareTo(h[a.length-y-1]))return!1;return!0},tt.envelope=function(a){for(var h=new sn,y=0;y<a.length;y++)h.expandToInclude(a[y]);return h},tt.toCoordinateArray=function(a){return a.toArray(tt.coordArrayType)},tt.atLeastNCoordinatesOrNothing=function(a,h){return h.length>=a?h:[]},tt.indexOf=function(a,h){for(var y=0;y<h.length;y++)if(a.equals(h[y]))return y;return-1},tt.increasingDirection=function(a){for(var h=0;h<Math.trunc(a.length/2);h++){var x=a[h].compareTo(a[a.length-1-h]);if(0!==x)return x}return 1},tt.compare=function(a,h){for(var y=0;y<a.length&&y<h.length;){var x=a[y].compareTo(h[y]);if(0!==x)return x;y++}return y<h.length?-1:y<a.length?1:0},tt.minCoordinate=function(a){for(var h=null,y=0;y<a.length;y++)(null===h||h.compareTo(a[y])>0)&&(h=a[y]);return h},tt.extract=function(a,h,y){h=De.clamp(h,0,a.length);var x=(y=De.clamp(y,-1,a.length))-h+1;y<0&&(x=0),h>=a.length&&(x=0),y<h&&(x=0);var T=new Array(x).fill(null);if(0===x)return T;for(var F=0,j=h;j<=y;j++)T[F++]=a[j];return T},Object.defineProperties(tt,Ft);var hn=function(){};hn.prototype.compare=function(a,h){return tt.compare(a,h)},hn.prototype.interfaces_=function(){return[me]},hn.prototype.getClass=function(){return hn};var bn=function(){};bn.prototype.compare=function(a,h){var y=a,x=h;if(y.length<x.length)return-1;if(y.length>x.length)return 1;if(0===y.length)return 0;var T=tt.compare(y,x);return tt.isEqualReversed(y,x)?0:T},bn.prototype.OLDcompare=function(a,h){var y=a,x=h;if(y.length<x.length)return-1;if(y.length>x.length)return 1;if(0===y.length)return 0;for(var T=tt.increasingDirection(y),F=tt.increasingDirection(x),j=T>0?0:y.length-1,ce=F>0?0:y.length-1,ke=0;ke<y.length;ke++){var ft=y[j].compareTo(x[ce]);if(0!==ft)return ft;j+=T,ce+=F}return 0},bn.prototype.interfaces_=function(){return[me]},bn.prototype.getClass=function(){return bn};var fn=function(){};fn.prototype.get=function(){},fn.prototype.put=function(){},fn.prototype.size=function(){},fn.prototype.values=function(){},fn.prototype.entrySet=function(){};var Rr=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h}(fn);(p.prototype=new Error).name="OperationNotSupported",(H.prototype=new ye).contains=function(){};var Ur=function(a){function h(){a.call(this),this.array_=[],arguments[0]instanceof ye&&this.addAll(arguments[0])}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.contains=function(y){for(var x=0,T=this.array_.length;x<T;x++)if(this.array_[x]===y)return!0;return!1},h.prototype.add=function(y){return!this.contains(y)&&(this.array_.push(y),!0)},h.prototype.addAll=function(y){for(var x=y.iterator();x.hasNext();)this.add(x.next());return!0},h.prototype.remove=function(y){throw new Error},h.prototype.size=function(){return this.array_.length},h.prototype.isEmpty=function(){return 0===this.array_.length},h.prototype.toArray=function(){for(var y=[],x=0,T=this.array_.length;x<T;x++)y.push(this.array_[x]);return y},h.prototype.iterator=function(){return new Lr(this)},h}(H),Lr=function(a){function h(y){a.call(this),this.hashSet_=y,this.position_=0}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new _e;return this.hashSet_.array_[this.position_++]},h.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},h.prototype.remove=function(){throw new p},h}(We),ir=0;(dt.prototype=new Rr).get=function(a){for(var h=this.root_;null!==h;){var y=a.compareTo(h.key);if(y<0)h=h.left;else{if(!(y>0))return h.value;h=h.right}}return null},dt.prototype.put=function(a,h){if(null===this.root_)return this.root_={key:a,value:h,left:null,right:null,parent:null,color:ir,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var y,x,T=this.root_;do{if(y=T,(x=a.compareTo(T.key))<0)T=T.left;else{if(!(x>0)){var F=T.value;return T.value=h,F}T=T.right}}while(null!==T);var j={key:a,left:null,right:null,value:h,parent:y,color:ir,getValue:function(){return this.value},getKey:function(){return this.key}};return x<0?y.left=j:y.right=j,this.fixAfterInsertion(j),this.size_++,null},dt.prototype.fixAfterInsertion=function(a){for(a.color=1;null!=a&&a!==this.root_&&1===a.parent.color;)if(ve(a)===ze(ve(ve(a)))){var h=_t(ve(ve(a)));1===fe(h)?(Ie(ve(a),ir),Ie(h,ir),Ie(ve(ve(a)),1),a=ve(ve(a))):(a===_t(ve(a))&&(a=ve(a),this.rotateLeft(a)),Ie(ve(a),ir),Ie(ve(ve(a)),1),this.rotateRight(ve(ve(a))))}else{var y=ze(ve(ve(a)));1===fe(y)?(Ie(ve(a),ir),Ie(y,ir),Ie(ve(ve(a)),1),a=ve(ve(a))):(a===ze(ve(a))&&(a=ve(a),this.rotateRight(a)),Ie(ve(a),ir),Ie(ve(ve(a)),1),this.rotateLeft(ve(ve(a))))}this.root_.color=ir},dt.prototype.values=function(){var a=new Ve,h=this.getFirstEntry();if(null!==h)for(a.add(h.value);null!==(h=dt.successor(h));)a.add(h.value);return a},dt.prototype.entrySet=function(){var a=new Ur,h=this.getFirstEntry();if(null!==h)for(a.add(h);null!==(h=dt.successor(h));)a.add(h);return a},dt.prototype.rotateLeft=function(a){if(null!=a){var h=a.right;a.right=h.left,null!=h.left&&(h.left.parent=a),h.parent=a.parent,null===a.parent?this.root_=h:a.parent.left===a?a.parent.left=h:a.parent.right=h,h.left=a,a.parent=h}},dt.prototype.rotateRight=function(a){if(null!=a){var h=a.left;a.left=h.right,null!=h.right&&(h.right.parent=a),h.parent=a.parent,null===a.parent?this.root_=h:a.parent.right===a?a.parent.right=h:a.parent.left=h,h.right=a,a.parent=h}},dt.prototype.getFirstEntry=function(){var a=this.root_;if(null!=a)for(;null!=a.left;)a=a.left;return a},dt.successor=function(a){if(null===a)return null;if(null!==a.right){for(var h=a.right;null!==h.left;)h=h.left;return h}for(var y=a.parent,x=a;null!==y&&x===y.right;)x=y,y=y.parent;return y},dt.prototype.size=function(){return this.size_};var Zr=function(){};Zr.prototype.interfaces_=function(){return[]},Zr.prototype.getClass=function(){return Zr},Je.prototype=new H,(ht.prototype=new Je).contains=function(a){for(var h=0,y=this.array_.length;h<y;h++)if(0===this.array_[h].compareTo(a))return!0;return!1},ht.prototype.add=function(a){if(this.contains(a))return!1;for(var h=0,y=this.array_.length;h<y;h++)if(1===this.array_[h].compareTo(a))return this.array_.splice(h,0,a),!0;return this.array_.push(a),!0},ht.prototype.addAll=function(a){for(var h=a.iterator();h.hasNext();)this.add(h.next());return!0},ht.prototype.remove=function(a){throw new p},ht.prototype.size=function(){return this.array_.length},ht.prototype.isEmpty=function(){return 0===this.array_.length},ht.prototype.toArray=function(){for(var a=[],h=0,y=this.array_.length;h<y;h++)a.push(this.array_[h]);return a},ht.prototype.iterator=function(){return new So(this)};var So=function(a){this.treeSet_=a,this.position_=0};So.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new _e;return this.treeSet_.array_[this.position_++]},So.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},So.prototype.remove=function(){throw new p};var Io=function(){};Io.sort=function(){var a,h,y,T=arguments[0];if(1===arguments.length)T.sort(function(j,ce){return j.compareTo(ce)});else if(2===arguments.length)y=arguments[1],T.sort(function(j,ce){return y.compare(j,ce)});else if(3===arguments.length){(h=T.slice(arguments[1],arguments[2])).sort();var F=T.slice(0,arguments[1]).concat(h,T.slice(arguments[2],T.length));for(T.splice(0,T.length),a=0;a<F.length;a++)T.push(F[a])}else if(4===arguments.length)for(h=T.slice(arguments[1],arguments[2]),y=arguments[3],h.sort(function(j,ce){return y.compare(j,ce)}),F=T.slice(0,arguments[1]).concat(h,T.slice(arguments[2],T.length)),T.splice(0,T.length),a=0;a<F.length;a++)T.push(F[a])},Io.asList=function(a){for(var h=new Ve,y=0,x=a.length;y<x;y++)h.add(a[y]);return h};var Er=function(){},Ti={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Ti.P.get=function(){return 0},Ti.L.get=function(){return 1},Ti.A.get=function(){return 2},Ti.FALSE.get=function(){return-1},Ti.TRUE.get=function(){return-2},Ti.DONTCARE.get=function(){return-3},Ti.SYM_FALSE.get=function(){return"F"},Ti.SYM_TRUE.get=function(){return"T"},Ti.SYM_DONTCARE.get=function(){return"*"},Ti.SYM_P.get=function(){return"0"},Ti.SYM_L.get=function(){return"1"},Ti.SYM_A.get=function(){return"2"},Er.prototype.interfaces_=function(){return[]},Er.prototype.getClass=function(){return Er},Er.toDimensionSymbol=function(a){switch(a){case Er.FALSE:return Er.SYM_FALSE;case Er.TRUE:return Er.SYM_TRUE;case Er.DONTCARE:return Er.SYM_DONTCARE;case Er.P:return Er.SYM_P;case Er.L:return Er.SYM_L;case Er.A:return Er.SYM_A}throw new re("Unknown dimension value: "+a)},Er.toDimensionValue=function(a){switch(vt.toUpperCase(a)){case Er.SYM_FALSE:return Er.FALSE;case Er.SYM_TRUE:return Er.TRUE;case Er.SYM_DONTCARE:return Er.DONTCARE;case Er.SYM_P:return Er.P;case Er.SYM_L:return Er.L;case Er.SYM_A:return Er.A}throw new re("Unknown dimension symbol: "+a)},Object.defineProperties(Er,Ti);var Cs=function(){};Cs.prototype.filter=function(a){},Cs.prototype.interfaces_=function(){return[]},Cs.prototype.getClass=function(){return Cs};var lo=function(){};lo.prototype.filter=function(a,h){},lo.prototype.isDone=function(){},lo.prototype.isGeometryChanged=function(){},lo.prototype.interfaces_=function(){return[]},lo.prototype.getClass=function(){return lo};var ai=function(a){function h(x,T){if(a.call(this,T),this._geometries=x||[],a.hasNullElements(this._geometries))throw new re("geometries must not contain null elements")}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){for(var x=new sn,T=0;T<this._geometries.length;T++)x.expandToInclude(this._geometries[T].getEnvelopeInternal());return x},h.prototype.getGeometryN=function(x){return this._geometries[x]},h.prototype.getSortIndex=function(){return a.SORTINDEX_GEOMETRYCOLLECTION},h.prototype.getCoordinates=function(){for(var x=new Array(this.getNumPoints()).fill(null),T=-1,F=0;F<this._geometries.length;F++)for(var j=this._geometries[F].getCoordinates(),ce=0;ce<j.length;ce++)x[++T]=j[ce];return x},h.prototype.getArea=function(){for(var x=0,T=0;T<this._geometries.length;T++)x+=this._geometries[T].getArea();return x},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];if(!this.isEquivalentClass(x))return!1;var F=x;if(this._geometries.length!==F._geometries.length)return!1;for(var j=0;j<this._geometries.length;j++)if(!this._geometries[j].equalsExact(F._geometries[j],T))return!1;return!0}return a.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){for(var x=0;x<this._geometries.length;x++)this._geometries[x].normalize();Io.sort(this._geometries)},h.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},h.prototype.getBoundaryDimension=function(){for(var x=Er.FALSE,T=0;T<this._geometries.length;T++)x=Math.max(x,this._geometries[T].getBoundaryDimension());return x},h.prototype.getDimension=function(){for(var x=Er.FALSE,T=0;T<this._geometries.length;T++)x=Math.max(x,this._geometries[T].getDimension());return x},h.prototype.getLength=function(){for(var x=0,T=0;T<this._geometries.length;T++)x+=this._geometries[T].getLength();return x},h.prototype.getNumPoints=function(){for(var x=0,T=0;T<this._geometries.length;T++)x+=this._geometries[T].getNumPoints();return x},h.prototype.getNumGeometries=function(){return this._geometries.length},h.prototype.reverse=function(){for(var T=new Array(this._geometries.length).fill(null),F=0;F<this._geometries.length;F++)T[F]=this._geometries[F].reverse();return this.getFactory().createGeometryCollection(T)},h.prototype.compareToSameClass=function(){if(1===arguments.length){var x=arguments[0],T=new ht(Io.asList(this._geometries)),F=new ht(Io.asList(x._geometries));return this.compare(T,F)}if(2===arguments.length){for(var ce=arguments[1],ke=arguments[0],ft=this.getNumGeometries(),Lt=ke.getNumGeometries(),$t=0;$t<ft&&$t<Lt;){var Pn=this.getGeometryN($t),Mn=ke.getGeometryN($t),zn=Pn.compareToSameClass(Mn,ce);if(0!==zn)return zn;$t++}return $t<ft?1:$t<Lt?-1:0}},h.prototype.apply=function(){if(At(arguments[0],zr))for(var x=arguments[0],T=0;T<this._geometries.length;T++)this._geometries[T].apply(x);else if(At(arguments[0],lo)){var F=arguments[0];if(0===this._geometries.length)return null;for(var j=0;j<this._geometries.length&&(this._geometries[j].apply(F),!F.isDone());j++);F.isGeometryChanged()&&this.geometryChanged()}else if(At(arguments[0],Cs)){var ce=arguments[0];ce.filter(this);for(var ke=0;ke<this._geometries.length;ke++)this._geometries[ke].apply(ce)}else if(At(arguments[0],yr)){var ft=arguments[0];ft.filter(this);for(var Lt=0;Lt<this._geometries.length;Lt++)this._geometries[Lt].apply(ft)}},h.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),xe.shouldNeverReachHere(),null},h.prototype.clone=function(){var x=a.prototype.clone.call(this);x._geometries=new Array(this._geometries.length).fill(null);for(var T=0;T<this._geometries.length;T++)x._geometries[T]=this._geometries[T].clone();return x},h.prototype.getGeometryType=function(){return"GeometryCollection"},h.prototype.copy=function(){for(var x=new Array(this._geometries.length).fill(null),T=0;T<x.length;T++)x[T]=this._geometries[T].copy();return new h(x,this._factory)},h.prototype.isEmpty=function(){for(var x=0;x<this._geometries.length;x++)if(!this._geometries[x].isEmpty())return!1;return!0},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(h,y),h}(Tn),du=function(a){function h(){a.apply(this,arguments)}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return Tn.SORTINDEX_MULTILINESTRING},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];return!!this.isEquivalentClass(x)&&a.prototype.equalsExact.call(this,x,T)}return a.prototype.equalsExact.apply(this,arguments)},h.prototype.getBoundaryDimension=function(){return this.isClosed()?Er.FALSE:0},h.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var x=0;x<this._geometries.length;x++)if(!this._geometries[x].isClosed())return!1;return!0},h.prototype.getDimension=function(){return 1},h.prototype.reverse=function(){for(var x=this._geometries.length,T=new Array(x).fill(null),F=0;F<this._geometries.length;F++)T[x-1-F]=this._geometries[F].reverse();return this.getFactory().createMultiLineString(T)},h.prototype.getBoundary=function(){return new co(this).getBoundary()},h.prototype.getGeometryType=function(){return"MultiLineString"},h.prototype.copy=function(){for(var x=new Array(this._geometries.length).fill(null),T=0;T<x.length;T++)x[T]=this._geometries[T].copy();return new h(x,this._factory)},h.prototype.interfaces_=function(){return[Zr]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(h,y),h}(ai),co=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var a=arguments[0],h=ni.MOD2_BOUNDARY_RULE;this._geom=a,this._geomFact=a.getFactory(),this._bnRule=h}else if(2===arguments.length){var y=arguments[0],x=arguments[1];this._geom=y,this._geomFact=y.getFactory(),this._bnRule=x}};co.prototype.boundaryMultiLineString=function(a){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var h=this.computeBoundaryCoordinates(a);return 1===h.length?this._geomFact.createPoint(h[0]):this._geomFact.createMultiPointFromCoords(h)},co.prototype.getBoundary=function(){return this._geom instanceof To?this.boundaryLineString(this._geom):this._geom instanceof du?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},co.prototype.boundaryLineString=function(a){return this._geom.isEmpty()?this.getEmptyMultiPoint():a.isClosed()?this._bnRule.isInBoundary(2)?a.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([a.getStartPoint(),a.getEndPoint()])},co.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},co.prototype.computeBoundaryCoordinates=function(a){var h=new Ve;this._endpointMap=new dt;for(var y=0;y<a.getNumGeometries();y++){var x=a.getGeometryN(y);0!==x.getNumPoints()&&(this.addEndpoint(x.getCoordinateN(0)),this.addEndpoint(x.getCoordinateN(x.getNumPoints()-1)))}for(var T=this._endpointMap.entrySet().iterator();T.hasNext();){var F=T.next(),j=F.getValue().count;this._bnRule.isInBoundary(j)&&h.add(F.getKey())}return tt.toCoordinateArray(h)},co.prototype.addEndpoint=function(a){var h=this._endpointMap.get(a);null===h&&(h=new el,this._endpointMap.put(a,h)),h.count++},co.prototype.interfaces_=function(){return[]},co.prototype.getClass=function(){return co},co.getBoundary=function(){return 1===arguments.length?new co(arguments[0]).getBoundary():2===arguments.length?new co(arguments[0],arguments[1]).getBoundary():void 0};var el=function(){this.count=null};el.prototype.interfaces_=function(){return[]},el.prototype.getClass=function(){return el};var mr=function(){},Lh={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};mr.prototype.interfaces_=function(){return[]},mr.prototype.getClass=function(){return mr},mr.chars=function(a,h){for(var y=new Array(h).fill(null),x=0;x<h;x++)y[x]=a;return String(y)},mr.getStackTrace=function(){if(1===arguments.length){var a=arguments[0],h=new function(){},y=new function(){}(h);return a.printStackTrace(y),h.toString()}if(2===arguments.length){for(var T=arguments[1],F="",j=new function(){}(new function(){}(mr.getStackTrace(arguments[0]))),ce=0;ce<T;ce++)try{F+=j.readLine()+mr.NEWLINE}catch(ke){if(!(ke instanceof xt))throw ke;xe.shouldNeverReachHere()}return F}},mr.split=function(a,h){for(var y=h.length,x=new Ve,T=""+a,F=T.indexOf(h);F>=0;){var j=T.substring(0,F);x.add(j),F=(T=T.substring(F+y)).indexOf(h)}T.length>0&&x.add(T);for(var ce=new Array(x.size()).fill(null),ke=0;ke<ce.length;ke++)ce[ke]=x.get(ke);return ce},mr.toString=function(){if(1===arguments.length)return mr.SIMPLE_ORDINATE_FORMAT.format(arguments[0])},mr.spaces=function(a){return mr.chars(" ",a)},Lh.NEWLINE.get=function(){return cn.getProperty("line.separator")},Lh.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}("0.#")},Object.defineProperties(mr,Lh);var mo=function(){};mo.prototype.interfaces_=function(){return[]},mo.prototype.getClass=function(){return mo},mo.copyCoord=function(a,h,y,x){for(var T=Math.min(a.getDimension(),y.getDimension()),F=0;F<T;F++)y.setOrdinate(x,F,a.getOrdinate(h,F))},mo.isRing=function(a){var h=a.size();return 0===h||!(h<=3)&&a.getOrdinate(0,Dt.X)===a.getOrdinate(h-1,Dt.X)&&a.getOrdinate(0,Dt.Y)===a.getOrdinate(h-1,Dt.Y)},mo.isEqual=function(a,h){var y=a.size();if(y!==h.size())return!1;for(var x=Math.min(a.getDimension(),h.getDimension()),T=0;T<y;T++)for(var F=0;F<x;F++){var j=a.getOrdinate(T,F),ce=h.getOrdinate(T,F);if(!(a.getOrdinate(T,F)===h.getOrdinate(T,F)||Y.isNaN(j)&&Y.isNaN(ce)))return!1}return!0},mo.extend=function(a,h,y){var x=a.create(y,h.getDimension()),T=h.size();if(mo.copy(h,0,x,0,T),T>0)for(var F=T;F<y;F++)mo.copy(h,T-1,x,F,1);return x},mo.reverse=function(a){for(var h=a.size()-1,y=Math.trunc(h/2),x=0;x<=y;x++)mo.swap(a,x,h-x)},mo.swap=function(a,h,y){if(h===y)return null;for(var x=0;x<a.getDimension();x++){var T=a.getOrdinate(h,x);a.setOrdinate(h,x,a.getOrdinate(y,x)),a.setOrdinate(y,x,T)}},mo.copy=function(a,h,y,x,T){for(var F=0;F<T;F++)mo.copyCoord(a,h+F,y,x+F)},mo.toString=function(){if(1===arguments.length){var a=arguments[0],h=a.size();if(0===h)return"()";var y=a.getDimension(),x=new Fe;x.append("(");for(var T=0;T<h;T++){T>0&&x.append(" ");for(var F=0;F<y;F++)F>0&&x.append(","),x.append(mr.toString(a.getOrdinate(T,F)))}return x.append(")"),x.toString()}},mo.ensureValidRing=function(a,h){var y=h.size();return 0===y?h:y<=3?mo.createClosedRing(a,h,4):h.getOrdinate(0,Dt.X)===h.getOrdinate(y-1,Dt.X)&&h.getOrdinate(0,Dt.Y)===h.getOrdinate(y-1,Dt.Y)?h:mo.createClosedRing(a,h,y+1)},mo.createClosedRing=function(a,h,y){var x=a.create(y,h.getDimension()),T=h.size();mo.copy(h,0,x,0,T);for(var F=T;F<y;F++)mo.copy(h,0,x,F,1);return x};var To=function(a){function h(x,T){a.call(this,T),this._points=null,this.init(x)}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new sn:this._points.expandEnvelope(new sn)},h.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},h.prototype.getSortIndex=function(){return a.SORTINDEX_LINESTRING},h.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];if(!this.isEquivalentClass(x))return!1;var F=x;if(this._points.size()!==F._points.size())return!1;for(var j=0;j<this._points.size();j++)if(!this.equal(this._points.getCoordinate(j),F._points.getCoordinate(j),T))return!1;return!0}return a.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){for(var x=0;x<Math.trunc(this._points.size()/2);x++){var T=this._points.size()-1-x;if(!this._points.getCoordinate(x).equals(this._points.getCoordinate(T)))return this._points.getCoordinate(x).compareTo(this._points.getCoordinate(T))>0&&mo.reverse(this._points),null}},h.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},h.prototype.getBoundaryDimension=function(){return this.isClosed()?Er.FALSE:0},h.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},h.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},h.prototype.getDimension=function(){return 1},h.prototype.getLength=function(){return Gt.computeLength(this._points)},h.prototype.getNumPoints=function(){return this._points.size()},h.prototype.reverse=function(){var x=this._points.copy();return mo.reverse(x),this.getFactory().createLineString(x)},h.prototype.compareToSameClass=function(){if(1===arguments.length){for(var x=arguments[0],T=0,F=0;T<this._points.size()&&F<x._points.size();){var j=this._points.getCoordinate(T).compareTo(x._points.getCoordinate(F));if(0!==j)return j;T++,F++}return T<this._points.size()?1:F<x._points.size()?-1:0}if(2===arguments.length)return arguments[1].compare(this._points,arguments[0]._points)},h.prototype.apply=function(){if(At(arguments[0],zr))for(var x=arguments[0],T=0;T<this._points.size();T++)x.filter(this._points.getCoordinate(T));else if(At(arguments[0],lo)){var F=arguments[0];if(0===this._points.size())return null;for(var j=0;j<this._points.size()&&(F.filter(this._points,j),!F.isDone());j++);F.isGeometryChanged()&&this.geometryChanged()}else(At(arguments[0],Cs)||At(arguments[0],yr))&&arguments[0].filter(this)},h.prototype.getBoundary=function(){return new co(this).getBoundary()},h.prototype.isEquivalentClass=function(x){return x instanceof h},h.prototype.clone=function(){var x=a.prototype.clone.call(this);return x._points=this._points.clone(),x},h.prototype.getCoordinateN=function(x){return this._points.getCoordinate(x)},h.prototype.getGeometryType=function(){return"LineString"},h.prototype.copy=function(){return new h(this._points.copy(),this._factory)},h.prototype.getCoordinateSequence=function(){return this._points},h.prototype.isEmpty=function(){return 0===this._points.size()},h.prototype.init=function(x){if(null===x&&(x=this.getFactory().getCoordinateSequenceFactory().create([])),1===x.size())throw new re("Invalid number of points in LineString (found "+x.size()+" - must be 0 or >= 2)");this._points=x},h.prototype.isCoordinate=function(x){for(var T=0;T<this._points.size();T++)if(this._points.getCoordinate(T).equals(x))return!0;return!1},h.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},h.prototype.getPointN=function(x){return this.getFactory().createPoint(this._points.getCoordinate(x))},h.prototype.interfaces_=function(){return[Zr]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(h,y),h}(Tn),tl=function(){};tl.prototype.interfaces_=function(){return[]},tl.prototype.getClass=function(){return tl};var Ko=function(a){function h(x,T){a.call(this,T),this._coordinates=x||null,this.init(this._coordinates)}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new sn;var x=new sn;return x.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),x},h.prototype.getSortIndex=function(){return a.SORTINDEX_POINT},h.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];return!!this.isEquivalentClass(x)&&(!(!this.isEmpty()||!x.isEmpty())||this.isEmpty()===x.isEmpty()&&this.equal(x.getCoordinate(),this.getCoordinate(),T))}return a.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){},h.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},h.prototype.getBoundaryDimension=function(){return Er.FALSE},h.prototype.getDimension=function(){return 0},h.prototype.getNumPoints=function(){return this.isEmpty()?0:1},h.prototype.reverse=function(){return this.copy()},h.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},h.prototype.compareToSameClass=function(){if(1===arguments.length){var x=arguments[0];return this.getCoordinate().compareTo(x.getCoordinate())}if(2===arguments.length)return arguments[1].compare(this._coordinates,arguments[0]._coordinates)},h.prototype.apply=function(){if(At(arguments[0],zr)){var x=arguments[0];if(this.isEmpty())return null;x.filter(this.getCoordinate())}else if(At(arguments[0],lo)){var T=arguments[0];if(this.isEmpty())return null;T.filter(this._coordinates,0),T.isGeometryChanged()&&this.geometryChanged()}else(At(arguments[0],Cs)||At(arguments[0],yr))&&arguments[0].filter(this)},h.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},h.prototype.clone=function(){var x=a.prototype.clone.call(this);return x._coordinates=this._coordinates.clone(),x},h.prototype.getGeometryType=function(){return"Point"},h.prototype.copy=function(){return new h(this._coordinates.copy(),this._factory)},h.prototype.getCoordinateSequence=function(){return this._coordinates},h.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},h.prototype.isEmpty=function(){return 0===this._coordinates.size()},h.prototype.init=function(x){null===x&&(x=this.getFactory().getCoordinateSequenceFactory().create([])),xe.isTrue(x.size()<=1),this._coordinates=x},h.prototype.isSimple=function(){return!0},h.prototype.interfaces_=function(){return[tl]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(h,y),h}(Tn),Ss=function(){};Ss.prototype.interfaces_=function(){return[]},Ss.prototype.getClass=function(){return Ss};var Jo=function(a){function h(x,T,F){if(a.call(this,F),this._shell=null,this._holes=null,null===x&&(x=this.getFactory().createLinearRing()),null===T&&(T=[]),a.hasNullElements(T))throw new re("holes must not contain null elements");if(x.isEmpty()&&a.hasNonEmptyElements(T))throw new re("shell is empty but holes are not");this._shell=x,this._holes=T}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},h.prototype.getSortIndex=function(){return a.SORTINDEX_POLYGON},h.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var x=new Array(this.getNumPoints()).fill(null),T=-1,F=this._shell.getCoordinates(),j=0;j<F.length;j++)x[++T]=F[j];for(var ce=0;ce<this._holes.length;ce++)for(var ke=this._holes[ce].getCoordinates(),ft=0;ft<ke.length;ft++)x[++T]=ke[ft];return x},h.prototype.getArea=function(){var x=0;x+=Math.abs(Gt.signedArea(this._shell.getCoordinateSequence()));for(var T=0;T<this._holes.length;T++)x-=Math.abs(Gt.signedArea(this._holes[T].getCoordinateSequence()));return x},h.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing()||null===this._shell||5!==this._shell.getNumPoints())return!1;for(var x=this._shell.getCoordinateSequence(),T=this.getEnvelopeInternal(),F=0;F<5;F++){var j=x.getX(F);if(j!==T.getMinX()&&j!==T.getMaxX())return!1;var ce=x.getY(F);if(ce!==T.getMinY()&&ce!==T.getMaxY())return!1}for(var ke=x.getX(0),ft=x.getY(0),Lt=1;Lt<=4;Lt++){var $t=x.getX(Lt),Pn=x.getY(Lt);if($t!==ke==(Pn!==ft))return!1;ke=$t,ft=Pn}return!0},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];if(!this.isEquivalentClass(x))return!1;var F=x;if(!this._shell.equalsExact(F._shell,T)||this._holes.length!==F._holes.length)return!1;for(var ke=0;ke<this._holes.length;ke++)if(!this._holes[ke].equalsExact(F._holes[ke],T))return!1;return!0}return a.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var x=0;x<this._holes.length;x++)this.normalize(this._holes[x],!1);Io.sort(this._holes)}else if(2===arguments.length){var T=arguments[0],F=arguments[1];if(T.isEmpty())return null;var j=new Array(T.getCoordinates().length-1).fill(null);cn.arraycopy(T.getCoordinates(),0,j,0,j.length);var ce=tt.minCoordinate(T.getCoordinates());tt.scroll(j,ce),cn.arraycopy(j,0,T.getCoordinates(),0,j.length),T.getCoordinates()[j.length]=j[0],Gt.isCCW(T.getCoordinates())===F&&tt.reverse(T.getCoordinates())}},h.prototype.getCoordinate=function(){return this._shell.getCoordinate()},h.prototype.getNumInteriorRing=function(){return this._holes.length},h.prototype.getBoundaryDimension=function(){return 1},h.prototype.getDimension=function(){return 2},h.prototype.getLength=function(){var x=0;x+=this._shell.getLength();for(var T=0;T<this._holes.length;T++)x+=this._holes[T].getLength();return x},h.prototype.getNumPoints=function(){for(var x=this._shell.getNumPoints(),T=0;T<this._holes.length;T++)x+=this._holes[T].getNumPoints();return x},h.prototype.reverse=function(){var x=this.copy();x._shell=this._shell.copy().reverse(),x._holes=new Array(this._holes.length).fill(null);for(var T=0;T<this._holes.length;T++)x._holes[T]=this._holes[T].copy().reverse();return x},h.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},h.prototype.compareToSameClass=function(){if(1===arguments.length)return this._shell.compareToSameClass(arguments[0]._shell);if(2===arguments.length){var ce=arguments[1],ke=arguments[0],$t=this._shell.compareToSameClass(ke._shell,ce);if(0!==$t)return $t;for(var Pn=this.getNumInteriorRing(),Mn=ke.getNumInteriorRing(),zn=0;zn<Pn&&zn<Mn;){var qn=this.getInteriorRingN(zn),hi=ke.getInteriorRingN(zn),Sn=qn.compareToSameClass(hi,ce);if(0!==Sn)return Sn;zn++}return zn<Pn?1:zn<Mn?-1:0}},h.prototype.apply=function(x){if(At(x,zr)){this._shell.apply(x);for(var T=0;T<this._holes.length;T++)this._holes[T].apply(x)}else if(At(x,lo)){if(this._shell.apply(x),!x.isDone())for(var F=0;F<this._holes.length&&(this._holes[F].apply(x),!x.isDone());F++);x.isGeometryChanged()&&this.geometryChanged()}else if(At(x,Cs))x.filter(this);else if(At(x,yr)){x.filter(this),this._shell.apply(x);for(var j=0;j<this._holes.length;j++)this._holes[j].apply(x)}},h.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var x=new Array(this._holes.length+1).fill(null);x[0]=this._shell;for(var T=0;T<this._holes.length;T++)x[T+1]=this._holes[T];return x.length<=1?this.getFactory().createLinearRing(x[0].getCoordinateSequence()):this.getFactory().createMultiLineString(x)},h.prototype.clone=function(){var x=a.prototype.clone.call(this);x._shell=this._shell.clone(),x._holes=new Array(this._holes.length).fill(null);for(var T=0;T<this._holes.length;T++)x._holes[T]=this._holes[T].clone();return x},h.prototype.getGeometryType=function(){return"Polygon"},h.prototype.copy=function(){for(var x=this._shell.copy(),T=new Array(this._holes.length).fill(null),F=0;F<T.length;F++)T[F]=this._holes[F].copy();return new h(x,T,this._factory)},h.prototype.getExteriorRing=function(){return this._shell},h.prototype.isEmpty=function(){return this._shell.isEmpty()},h.prototype.getInteriorRingN=function(x){return this._holes[x]},h.prototype.interfaces_=function(){return[Ss]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(h,y),h}(Tn),Sl=function(a){function h(){a.apply(this,arguments)}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return Tn.SORTINDEX_MULTIPOINT},h.prototype.isValid=function(){return!0},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];return!!this.isEquivalentClass(x)&&a.prototype.equalsExact.call(this,x,T)}return a.prototype.equalsExact.apply(this,arguments)},h.prototype.getCoordinate=function(){return 1===arguments.length?this._geometries[arguments[0]].getCoordinate():a.prototype.getCoordinate.apply(this,arguments)},h.prototype.getBoundaryDimension=function(){return Er.FALSE},h.prototype.getDimension=function(){return 0},h.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},h.prototype.getGeometryType=function(){return"MultiPoint"},h.prototype.copy=function(){for(var x=new Array(this._geometries.length).fill(null),T=0;T<x.length;T++)x[T]=this._geometries[T].copy();return new h(x,this._factory)},h.prototype.interfaces_=function(){return[tl]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(h,y),h}(ai),ta=function(a){function h(x,T){x instanceof Q&&T instanceof Bn&&(x=T.getCoordinateSequenceFactory().create(x)),a.call(this,x,T),this.validateConstruction()}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return Tn.SORTINDEX_LINEARRING},h.prototype.getBoundaryDimension=function(){return Er.FALSE},h.prototype.isClosed=function(){return!!this.isEmpty()||a.prototype.isClosed.call(this)},h.prototype.reverse=function(){var x=this._points.copy();return mo.reverse(x),this.getFactory().createLinearRing(x)},h.prototype.validateConstruction=function(){if(!this.isEmpty()&&!a.prototype.isClosed.call(this))throw new re("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<h.MINIMUM_VALID_SIZE)throw new re("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},h.prototype.getGeometryType=function(){return"LinearRing"},h.prototype.copy=function(){return new h(this._points.copy(),this._factory)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},y.MINIMUM_VALID_SIZE.get=function(){return 4},y.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(h,y),h}(To),Gs=function(a){function h(){a.apply(this,arguments)}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return Tn.SORTINDEX_MULTIPOLYGON},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];return!!this.isEquivalentClass(x)&&a.prototype.equalsExact.call(this,x,T)}return a.prototype.equalsExact.apply(this,arguments)},h.prototype.getBoundaryDimension=function(){return 1},h.prototype.getDimension=function(){return 2},h.prototype.reverse=function(){for(var T=new Array(this._geometries.length).fill(null),F=0;F<this._geometries.length;F++)T[F]=this._geometries[F].reverse();return this.getFactory().createMultiPolygon(T)},h.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var x=new Ve,T=0;T<this._geometries.length;T++)for(var F=this._geometries[T].getBoundary(),j=0;j<F.getNumGeometries();j++)x.add(F.getGeometryN(j));var ce=new Array(x.size()).fill(null);return this.getFactory().createMultiLineString(x.toArray(ce))},h.prototype.getGeometryType=function(){return"MultiPolygon"},h.prototype.copy=function(){for(var x=new Array(this._geometries.length).fill(null),T=0;T<x.length;T++)x[T]=this._geometries[T].copy();return new h(x,this._factory)},h.prototype.interfaces_=function(){return[Ss]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(h,y),h}(ai),na=function(a){this._factory=a||null,this._isUserDataCopied=!1},Ht={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};na.prototype.setCopyUserData=function(a){this._isUserDataCopied=a},na.prototype.edit=function(a,h){if(null===a)return null;var y=this.editInternal(a,h);return this._isUserDataCopied&&y.setUserData(a.getUserData()),y},na.prototype.editInternal=function(a,h){return null===this._factory&&(this._factory=a.getFactory()),a instanceof ai?this.editGeometryCollection(a,h):a instanceof Jo?this.editPolygon(a,h):a instanceof Ko||a instanceof To?h.edit(a,this._factory):(xe.shouldNeverReachHere("Unsupported Geometry class: "+a.getClass().getName()),null)},na.prototype.editGeometryCollection=function(a,h){for(var y=h.edit(a,this._factory),x=new Ve,T=0;T<y.getNumGeometries();T++){var F=this.edit(y.getGeometryN(T),h);null===F||F.isEmpty()||x.add(F)}return y.getClass()===Sl?this._factory.createMultiPoint(x.toArray([])):y.getClass()===du?this._factory.createMultiLineString(x.toArray([])):y.getClass()===Gs?this._factory.createMultiPolygon(x.toArray([])):this._factory.createGeometryCollection(x.toArray([]))},na.prototype.editPolygon=function(a,h){var y=h.edit(a,this._factory);if(null===y&&(y=this._factory.createPolygon(null)),y.isEmpty())return y;var x=this.edit(y.getExteriorRing(),h);if(null===x||x.isEmpty())return this._factory.createPolygon();for(var T=new Ve,F=0;F<y.getNumInteriorRing();F++){var j=this.edit(y.getInteriorRingN(F),h);null===j||j.isEmpty()||T.add(j)}return this._factory.createPolygon(x,T.toArray([]))},na.prototype.interfaces_=function(){return[]},na.prototype.getClass=function(){return na},na.GeometryEditorOperation=function(){},Ht.NoOpGeometryOperation.get=function(){return pu},Ht.CoordinateOperation.get=function(){return qo},Ht.CoordinateSequenceOperation.get=function(){return _s},Object.defineProperties(na,Ht);var pu=function(){};pu.prototype.edit=function(a,h){return a},pu.prototype.interfaces_=function(){return[na.GeometryEditorOperation]},pu.prototype.getClass=function(){return pu};var qo=function(){};qo.prototype.edit=function(a,h){var y=this.editCoordinates(a.getCoordinates(),a);return null===y?a:a instanceof ta?h.createLinearRing(y):a instanceof To?h.createLineString(y):a instanceof Ko?y.length>0?h.createPoint(y[0]):h.createPoint():a},qo.prototype.interfaces_=function(){return[na.GeometryEditorOperation]},qo.prototype.getClass=function(){return qo};var _s=function(){};_s.prototype.edit=function(a,h){return a instanceof ta?h.createLinearRing(this.edit(a.getCoordinateSequence(),a)):a instanceof To?h.createLineString(this.edit(a.getCoordinateSequence(),a)):a instanceof Ko?h.createPoint(this.edit(a.getCoordinateSequence(),a)):a},_s.prototype.interfaces_=function(){return[na.GeometryEditorOperation]},_s.prototype.getClass=function(){return _s};var Ho=function(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var a=arguments[0];this._coordinates=new Array(a).fill(null);for(var h=0;h<a;h++)this._coordinates[h]=new Q}else if(At(arguments[0],Dt)){var y=arguments[0];if(null===y)return this._coordinates=new Array(0).fill(null),null;this._dimension=y.getDimension(),this._coordinates=new Array(y.size()).fill(null);for(var x=0;x<this._coordinates.length;x++)this._coordinates[x]=y.getCoordinateCopy(x)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var T=arguments[0],F=arguments[1];this._coordinates=T,this._dimension=F,null===T&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var j=arguments[0],ce=arguments[1];this._coordinates=new Array(j).fill(null),this._dimension=ce;for(var ke=0;ke<j;ke++)this._coordinates[ke]=new Q}},Vo={serialVersionUID:{configurable:!0}};Ho.prototype.setOrdinate=function(a,h,y){switch(h){case Dt.X:this._coordinates[a].x=y;break;case Dt.Y:this._coordinates[a].y=y;break;case Dt.Z:this._coordinates[a].z=y;break;default:throw new re("invalid ordinateIndex")}},Ho.prototype.size=function(){return this._coordinates.length},Ho.prototype.getOrdinate=function(a,h){switch(h){case Dt.X:return this._coordinates[a].x;case Dt.Y:return this._coordinates[a].y;case Dt.Z:return this._coordinates[a].z}return Y.NaN},Ho.prototype.getCoordinate=function(){if(1===arguments.length)return this._coordinates[arguments[0]];if(2===arguments.length){var h=arguments[0],y=arguments[1];y.x=this._coordinates[h].x,y.y=this._coordinates[h].y,y.z=this._coordinates[h].z}},Ho.prototype.getCoordinateCopy=function(a){return new Q(this._coordinates[a])},Ho.prototype.getDimension=function(){return this._dimension},Ho.prototype.getX=function(a){return this._coordinates[a].x},Ho.prototype.clone=function(){for(var a=new Array(this.size()).fill(null),h=0;h<this._coordinates.length;h++)a[h]=this._coordinates[h].clone();return new Ho(a,this._dimension)},Ho.prototype.expandEnvelope=function(a){for(var h=0;h<this._coordinates.length;h++)a.expandToInclude(this._coordinates[h]);return a},Ho.prototype.copy=function(){for(var a=new Array(this.size()).fill(null),h=0;h<this._coordinates.length;h++)a[h]=this._coordinates[h].copy();return new Ho(a,this._dimension)},Ho.prototype.toString=function(){if(this._coordinates.length>0){var a=new Fe(17*this._coordinates.length);a.append("("),a.append(this._coordinates[0]);for(var h=1;h<this._coordinates.length;h++)a.append(", "),a.append(this._coordinates[h]);return a.append(")"),a.toString()}return"()"},Ho.prototype.getY=function(a){return this._coordinates[a].y},Ho.prototype.toCoordinateArray=function(){return this._coordinates},Ho.prototype.interfaces_=function(){return[Dt,he]},Ho.prototype.getClass=function(){return Ho},Vo.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(Ho,Vo);var gu=function(){},Or={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};gu.prototype.readResolve=function(){return gu.instance()},gu.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new Ho(arguments[0]);if(At(arguments[0],Dt))return new Ho(arguments[0])}else if(2===arguments.length){var y=arguments[0],x=arguments[1];return x>3&&(x=3),x<2?new Ho(y):new Ho(y,x)}},gu.prototype.interfaces_=function(){return[Ye,he]},gu.prototype.getClass=function(){return gu},gu.instance=function(){return gu.instanceObject},Or.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},Or.instanceObject.get=function(){return new gu},Object.defineProperties(gu,Or);var Wl=function(a){function h(){a.call(this),this.map_=new Map}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.get=function(y){return this.map_.get(y)||null},h.prototype.put=function(y,x){return this.map_.set(y,x),x},h.prototype.values=function(){for(var y=new Ve,x=this.map_.values(),T=x.next();!T.done;)y.add(T.value),T=x.next();return y},h.prototype.entrySet=function(){var y=new Ur;return this.map_.entries().forEach(function(x){return y.add(x)}),y},h.prototype.size=function(){return this.map_.size()},h}(fn),nn=function a(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=a.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof _r){var h=arguments[0];this._modelType=h,h===a.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var y=arguments[0];this._modelType=a.FIXED,this.setScale(y)}else if(arguments[0]instanceof a){var x=arguments[0];this._modelType=x._modelType,this._scale=x._scale}},Cr={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};nn.prototype.equals=function(a){return a instanceof nn&&this._modelType===a._modelType&&this._scale===a._scale},nn.prototype.compareTo=function(a){var h=a,y=this.getMaximumSignificantDigits(),x=h.getMaximumSignificantDigits();return new at(y).compareTo(new at(x))},nn.prototype.getScale=function(){return this._scale},nn.prototype.isFloating=function(){return this._modelType===nn.FLOATING||this._modelType===nn.FLOATING_SINGLE},nn.prototype.getType=function(){return this._modelType},nn.prototype.toString=function(){var a="UNKNOWN";return this._modelType===nn.FLOATING?a="Floating":this._modelType===nn.FLOATING_SINGLE?a="Floating-Single":this._modelType===nn.FIXED&&(a="Fixed (Scale="+this.getScale()+")"),a},nn.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var a=arguments[0];return Y.isNaN(a)||this._modelType===nn.FLOATING_SINGLE?a:this._modelType===nn.FIXED?Math.round(a*this._scale)/this._scale:a}if(arguments[0]instanceof Q){var h=arguments[0];if(this._modelType===nn.FLOATING)return null;h.x=this.makePrecise(h.x),h.y=this.makePrecise(h.y)}},nn.prototype.getMaximumSignificantDigits=function(){var a=16;return this._modelType===nn.FLOATING?a=16:this._modelType===nn.FLOATING_SINGLE?a=6:this._modelType===nn.FIXED&&(a=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),a},nn.prototype.setScale=function(a){this._scale=Math.abs(a)},nn.prototype.interfaces_=function(){return[he,ee]},nn.prototype.getClass=function(){return nn},nn.mostPrecise=function(a,h){return a.compareTo(h)>=0?a:h},Cr.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},Cr.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(nn,Cr);var _r=function a(h){this._name=h||null,a.nameToTypeMap.put(h,this)},Va={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};_r.prototype.readResolve=function(){return _r.nameToTypeMap.get(this._name)},_r.prototype.toString=function(){return this._name},_r.prototype.interfaces_=function(){return[he]},_r.prototype.getClass=function(){return _r},Va.serialVersionUID.get=function(){return-552860263173159e4},Va.nameToTypeMap.get=function(){return new Wl},Object.defineProperties(_r,Va),nn.Type=_r,nn.FIXED=new _r("FIXED"),nn.FLOATING=new _r("FLOATING"),nn.FLOATING_SINGLE=new _r("FLOATING SINGLE");var Bn=function a(){this._precisionModel=new nn,this._SRID=0,this._coordinateSequenceFactory=a.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?At(arguments[0],Ye)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof nn&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},Hr={serialVersionUID:{configurable:!0}};Bn.prototype.toGeometry=function(a){return a.isNull()?this.createPoint(null):a.getMinX()===a.getMaxX()&&a.getMinY()===a.getMaxY()?this.createPoint(new Q(a.getMinX(),a.getMinY())):a.getMinX()===a.getMaxX()||a.getMinY()===a.getMaxY()?this.createLineString([new Q(a.getMinX(),a.getMinY()),new Q(a.getMaxX(),a.getMaxY())]):this.createPolygon(this.createLinearRing([new Q(a.getMinX(),a.getMinY()),new Q(a.getMinX(),a.getMaxY()),new Q(a.getMaxX(),a.getMaxY()),new Q(a.getMaxX(),a.getMinY()),new Q(a.getMinX(),a.getMinY())]),null)},Bn.prototype.createLineString=function(a){return a?a instanceof Array?new To(this.getCoordinateSequenceFactory().create(a),this):At(a,Dt)?new To(a,this):void 0:new To(this.getCoordinateSequenceFactory().create([]),this)},Bn.prototype.createMultiLineString=function(){return 0===arguments.length?new du(null,this):1===arguments.length?new du(arguments[0],this):void 0},Bn.prototype.buildGeometry=function(a){for(var h=null,y=!1,x=!1,T=a.iterator();T.hasNext();){var F=T.next(),j=F.getClass();null===h&&(h=j),j!==h&&(y=!0),F.isGeometryCollectionOrDerived()&&(x=!0)}if(null===h)return this.createGeometryCollection();if(y||x)return this.createGeometryCollection(Bn.toGeometryArray(a));var ce=a.iterator().next();if(a.size()>1){if(ce instanceof Jo)return this.createMultiPolygon(Bn.toPolygonArray(a));if(ce instanceof To)return this.createMultiLineString(Bn.toLineStringArray(a));if(ce instanceof Ko)return this.createMultiPoint(Bn.toPointArray(a));xe.shouldNeverReachHere("Unhandled class: "+ce.getClass().getName())}return ce},Bn.prototype.createMultiPointFromCoords=function(a){return this.createMultiPoint(null!==a?this.getCoordinateSequenceFactory().create(a):null)},Bn.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Q){var a=arguments[0];return this.createPoint(null!==a?this.getCoordinateSequenceFactory().create([a]):null)}if(At(arguments[0],Dt))return new Ko(arguments[0],this)}},Bn.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},Bn.prototype.createPolygon=function(){if(0===arguments.length)return new Jo(null,null,this);if(1===arguments.length){if(At(arguments[0],Dt))return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof Array)return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof ta)return this.createPolygon(arguments[0],null)}else if(2===arguments.length)return new Jo(arguments[0],arguments[1],this)},Bn.prototype.getSRID=function(){return this._SRID},Bn.prototype.createGeometryCollection=function(){return 0===arguments.length?new ai(null,this):1===arguments.length?new ai(arguments[0],this):void 0},Bn.prototype.createGeometry=function(a){return new na(this).edit(a,{edit:function(){if(2===arguments.length)return this._coordinateSequenceFactory.create(arguments[0])}})},Bn.prototype.getPrecisionModel=function(){return this._precisionModel},Bn.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var a=arguments[0];return this.createLinearRing(null!==a?this.getCoordinateSequenceFactory().create(a):null)}if(At(arguments[0],Dt))return new ta(arguments[0],this)}},Bn.prototype.createMultiPolygon=function(){return 0===arguments.length?new Gs(null,this):1===arguments.length?new Gs(arguments[0],this):void 0},Bn.prototype.createMultiPoint=function(){if(0===arguments.length)return new Sl(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new Sl(arguments[0],this);if(arguments[0]instanceof Array){var h=arguments[0];return this.createMultiPoint(null!==h?this.getCoordinateSequenceFactory().create(h):null)}if(At(arguments[0],Dt)){var y=arguments[0];if(null===y)return this.createMultiPoint(new Array(0).fill(null));for(var x=new Array(y.size()).fill(null),T=0;T<y.size();T++){var F=this.getCoordinateSequenceFactory().create(1,y.getDimension());mo.copy(y,T,F,0,1),x[T]=this.createPoint(F)}return this.createMultiPoint(x)}}},Bn.prototype.interfaces_=function(){return[he]},Bn.prototype.getClass=function(){return Bn},Bn.toMultiPolygonArray=function(a){var h=new Array(a.size()).fill(null);return a.toArray(h)},Bn.toGeometryArray=function(a){if(null===a)return null;var h=new Array(a.size()).fill(null);return a.toArray(h)},Bn.getDefaultCoordinateSequenceFactory=function(){return gu.instance()},Bn.toMultiLineStringArray=function(a){var h=new Array(a.size()).fill(null);return a.toArray(h)},Bn.toLineStringArray=function(a){var h=new Array(a.size()).fill(null);return a.toArray(h)},Bn.toMultiPointArray=function(a){var h=new Array(a.size()).fill(null);return a.toArray(h)},Bn.toLinearRingArray=function(a){var h=new Array(a.size()).fill(null);return a.toArray(h)},Bn.toPointArray=function(a){var h=new Array(a.size()).fill(null);return a.toArray(h)},Bn.toPolygonArray=function(a){var h=new Array(a.size()).fill(null);return a.toArray(h)},Bn.createPointFromInternalCoord=function(a,h){return h.getPrecisionModel().makePrecise(a),h.getFactory().createPoint(a)},Hr.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(Bn,Hr);var oo=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],nl=function(a){this.geometryFactory=a||new Bn};nl.prototype.read=function(a){var h,y=(h="string"==typeof a?JSON.parse(a):a).type;if(!ra[y])throw new Error("Unknown GeoJSON type: "+h.type);return-1!==oo.indexOf(y)?ra[y].apply(this,[h.coordinates]):ra[y].apply(this,"GeometryCollection"===y?[h.geometries]:[h])},nl.prototype.write=function(a){var h=a.getGeometryType();if(!cs[h])throw new Error("Geometry is not supported");return cs[h].apply(this,[a])};var ra={Feature:function(a){var h={};for(var y in a)h[y]=a[y];if(a.geometry){if(!ra[a.geometry.type])throw new Error("Unknown GeoJSON type: "+a.type);h.geometry=this.read(a.geometry)}return a.bbox&&(h.bbox=ra.bbox.apply(this,[a.bbox])),h},FeatureCollection:function(a){var h={};if(a.features){h.features=[];for(var y=0;y<a.features.length;++y)h.features.push(this.read(a.features[y]))}return a.bbox&&(h.bbox=this.parse.bbox.apply(this,[a.bbox])),h},coordinates:function(a){for(var h=[],y=0;y<a.length;++y){var x=a[y];h.push(new Q(x[0],x[1]))}return h},bbox:function(a){return this.geometryFactory.createLinearRing([new Q(a[0],a[1]),new Q(a[2],a[1]),new Q(a[2],a[3]),new Q(a[0],a[3]),new Q(a[0],a[1])])},Point:function(a){var h=new Q(a[0],a[1]);return this.geometryFactory.createPoint(h)},MultiPoint:function(a){for(var h=[],y=0;y<a.length;++y)h.push(ra.Point.apply(this,[a[y]]));return this.geometryFactory.createMultiPoint(h)},LineString:function(a){var h=ra.coordinates.apply(this,[a]);return this.geometryFactory.createLineString(h)},MultiLineString:function(a){for(var h=[],y=0;y<a.length;++y)h.push(ra.LineString.apply(this,[a[y]]));return this.geometryFactory.createMultiLineString(h)},Polygon:function(a){for(var h=ra.coordinates.apply(this,[a[0]]),y=this.geometryFactory.createLinearRing(h),x=[],T=1;T<a.length;++T){var j=ra.coordinates.apply(this,[a[T]]),ce=this.geometryFactory.createLinearRing(j);x.push(ce)}return this.geometryFactory.createPolygon(y,x)},MultiPolygon:function(a){for(var h=[],y=0;y<a.length;++y)h.push(ra.Polygon.apply(this,[a[y]]));return this.geometryFactory.createMultiPolygon(h)},GeometryCollection:function(a){for(var h=[],y=0;y<a.length;++y)h.push(this.read(a[y]));return this.geometryFactory.createGeometryCollection(h)}},cs={coordinate:function(a){return[a.x,a.y]},Point:function(a){return{type:"Point",coordinates:cs.coordinate.apply(this,[a.getCoordinate()])}},MultiPoint:function(a){for(var h=[],y=0;y<a._geometries.length;++y){var T=cs.Point.apply(this,[a._geometries[y]]);h.push(T.coordinates)}return{type:"MultiPoint",coordinates:h}},LineString:function(a){for(var h=[],y=a.getCoordinates(),x=0;x<y.length;++x)h.push(cs.coordinate.apply(this,[y[x]]));return{type:"LineString",coordinates:h}},MultiLineString:function(a){for(var h=[],y=0;y<a._geometries.length;++y){var T=cs.LineString.apply(this,[a._geometries[y]]);h.push(T.coordinates)}return{type:"MultiLineString",coordinates:h}},Polygon:function(a){var h=[],y=cs.LineString.apply(this,[a._shell]);h.push(y.coordinates);for(var x=0;x<a._holes.length;++x){var F=cs.LineString.apply(this,[a._holes[x]]);h.push(F.coordinates)}return{type:"Polygon",coordinates:h}},MultiPolygon:function(a){for(var h=[],y=0;y<a._geometries.length;++y){var T=cs.Polygon.apply(this,[a._geometries[y]]);h.push(T.coordinates)}return{type:"MultiPolygon",coordinates:h}},GeometryCollection:function(a){for(var h=[],y=0;y<a._geometries.length;++y){var x=a._geometries[y],T=x.getGeometryType();h.push(cs[T].apply(this,[x]))}return{type:"GeometryCollection",geometries:h}}},$n=function(a){this.geometryFactory=a||new Bn,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new nl(this.geometryFactory)};$n.prototype.read=function(a){var h=this.parser.read(a);return this.precisionModel.getType()===nn.FIXED&&this.reducePrecision(h),h},$n.prototype.reducePrecision=function(a){var h,y;if(a.coordinate)this.precisionModel.makePrecise(a.coordinate);else if(a.points)for(h=0,y=a.points.length;h<y;h++)this.precisionModel.makePrecise(a.points[h]);else if(a.geometries)for(h=0,y=a.geometries.length;h<y;h++)this.reducePrecision(a.geometries[h])};var eh=function(){this.parser=new nl(this.geometryFactory)};eh.prototype.write=function(a){return this.parser.write(a)};var pn=function(){},lc={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};pn.prototype.interfaces_=function(){return[]},pn.prototype.getClass=function(){return pn},pn.opposite=function(a){return a===pn.LEFT?pn.RIGHT:a===pn.RIGHT?pn.LEFT:a},lc.ON.get=function(){return 0},lc.LEFT.get=function(){return 1},lc.RIGHT.get=function(){return 2},Object.defineProperties(pn,lc),(ie.prototype=new Error).name="EmptyStackException",(W.prototype=new rt).add=function(a){return this.array_.push(a),!0},W.prototype.get=function(a){if(a<0||a>=this.size())throw new Error;return this.array_[a]},W.prototype.push=function(a){return this.array_.push(a),a},W.prototype.pop=function(a){if(0===this.array_.length)throw new ie;return this.array_.pop()},W.prototype.peek=function(){if(0===this.array_.length)throw new ie;return this.array_[this.array_.length-1]},W.prototype.empty=function(){return 0===this.array_.length},W.prototype.isEmpty=function(){return this.empty()},W.prototype.search=function(a){return this.array_.indexOf(a)},W.prototype.size=function(){return this.array_.length},W.prototype.toArray=function(){for(var a=[],h=0,y=this.array_.length;h<y;h++)a.push(this.array_[h]);return a};var ma=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};ma.prototype.getCoordinate=function(){return this._minCoord},ma.prototype.getRightmostSide=function(a,h){var y=this.getRightmostSideOfSegment(a,h);return y<0&&(y=this.getRightmostSideOfSegment(a,h-1)),y<0&&(this._minCoord=null,this.checkForRightmostCoordinate(a)),y},ma.prototype.findRightmostEdgeAtVertex=function(){var a=this._minDe.getEdge().getCoordinates();xe.isTrue(this._minIndex>0&&this._minIndex<a.length,"rightmost point expected to be interior vertex of edge");var h=a[this._minIndex-1],y=a[this._minIndex+1],x=Gt.computeOrientation(this._minCoord,y,h),T=!1;(h.y<this._minCoord.y&&y.y<this._minCoord.y&&x===Gt.COUNTERCLOCKWISE||h.y>this._minCoord.y&&y.y>this._minCoord.y&&x===Gt.CLOCKWISE)&&(T=!0),T&&(this._minIndex=this._minIndex-1)},ma.prototype.getRightmostSideOfSegment=function(a,h){var y=a.getEdge().getCoordinates();if(h<0||h+1>=y.length||y[h].y===y[h+1].y)return-1;var x=pn.LEFT;return y[h].y<y[h+1].y&&(x=pn.RIGHT),x},ma.prototype.getEdge=function(){return this._orientedDe},ma.prototype.checkForRightmostCoordinate=function(a){for(var h=a.getEdge().getCoordinates(),y=0;y<h.length-1;y++)(null===this._minCoord||h[y].x>this._minCoord.x)&&(this._minDe=a,this._minIndex=y,this._minCoord=h[y])},ma.prototype.findRightmostEdgeAtNode=function(){var a=this._minDe.getNode().getEdges();this._minDe=a.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},ma.prototype.findEdge=function(a){for(var h=a.iterator();h.hasNext();){var y=h.next();y.isForward()&&this.checkForRightmostCoordinate(y)}xe.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===pn.LEFT&&(this._orientedDe=this._minDe.getSym())},ma.prototype.interfaces_=function(){return[]},ma.prototype.getClass=function(){return ma};var Dn=function(a){function h(y,x){a.call(this,h.msgWithCoord(y,x)),this.pt=x?new Q(x):null,this.name="TopologyException"}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.getCoordinate=function(){return this.pt},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.msgWithCoord=function(y,x){return x?y:y+" [ "+x+" ]"},h}(Te),Xl=function(){this.array_=[]};Xl.prototype.addLast=function(a){this.array_.push(a)},Xl.prototype.removeFirst=function(){return this.array_.shift()},Xl.prototype.isEmpty=function(){return 0===this.array_.length};var Yn=function(){this._finder=null,this._dirEdgeList=new Ve,this._nodes=new Ve,this._rightMostCoord=null,this._env=null,this._finder=new ma};Yn.prototype.clearVisitedEdges=function(){for(var a=this._dirEdgeList.iterator();a.hasNext();)a.next().setVisited(!1)},Yn.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},Yn.prototype.computeNodeDepth=function(a){for(var h=null,y=a.getEdges().iterator();y.hasNext();){var x=y.next();if(x.isVisited()||x.getSym().isVisited()){h=x;break}}if(null===h)throw new Dn("unable to find edge to compute depths at "+a.getCoordinate());a.getEdges().computeDepths(h);for(var T=a.getEdges().iterator();T.hasNext();){var F=T.next();F.setVisited(!0),this.copySymDepths(F)}},Yn.prototype.computeDepth=function(a){this.clearVisitedEdges();var h=this._finder.getEdge();h.setEdgeDepths(pn.RIGHT,a),this.copySymDepths(h),this.computeDepths(h)},Yn.prototype.create=function(a){this.addReachable(a),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},Yn.prototype.findResultEdges=function(){for(var a=this._dirEdgeList.iterator();a.hasNext();){var h=a.next();h.getDepth(pn.RIGHT)>=1&&h.getDepth(pn.LEFT)<=0&&!h.isInteriorAreaEdge()&&h.setInResult(!0)}},Yn.prototype.computeDepths=function(a){var h=new Ur,y=new Xl,x=a.getNode();for(y.addLast(x),h.add(x),a.setVisited(!0);!y.isEmpty();){var T=y.removeFirst();h.add(T),this.computeNodeDepth(T);for(var F=T.getEdges().iterator();F.hasNext();){var j=F.next().getSym();if(!j.isVisited()){var ce=j.getNode();h.contains(ce)||(y.addLast(ce),h.add(ce))}}}},Yn.prototype.compareTo=function(a){return this._rightMostCoord.x<a._rightMostCoord.x?-1:this._rightMostCoord.x>a._rightMostCoord.x?1:0},Yn.prototype.getEnvelope=function(){if(null===this._env){for(var a=new sn,h=this._dirEdgeList.iterator();h.hasNext();)for(var y=h.next().getEdge().getCoordinates(),x=0;x<y.length-1;x++)a.expandToInclude(y[x]);this._env=a}return this._env},Yn.prototype.addReachable=function(a){var h=new W;for(h.add(a);!h.empty();){var y=h.pop();this.add(y,h)}},Yn.prototype.copySymDepths=function(a){var h=a.getSym();h.setDepth(pn.LEFT,a.getDepth(pn.RIGHT)),h.setDepth(pn.RIGHT,a.getDepth(pn.LEFT))},Yn.prototype.add=function(a,h){a.setVisited(!0),this._nodes.add(a);for(var y=a.getEdges().iterator();y.hasNext();){var x=y.next();this._dirEdgeList.add(x);var T=x.getSym().getNode();T.isVisited()||h.push(T)}},Yn.prototype.getNodes=function(){return this._nodes},Yn.prototype.getDirectedEdges=function(){return this._dirEdgeList},Yn.prototype.interfaces_=function(){return[ee]},Yn.prototype.getClass=function(){return Yn};var rr=function a(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array)this.init(arguments[0].length);else if(Number.isInteger(arguments[0])){var y=arguments[0];this.init(1),this.location[pn.ON]=y}else if(arguments[0]instanceof a){var x=arguments[0];if(this.init(x.location.length),null!==x)for(var T=0;T<this.location.length;T++)this.location[T]=x.location[T]}}else if(3===arguments.length){var F=arguments[0],j=arguments[1],ce=arguments[2];this.init(3),this.location[pn.ON]=F,this.location[pn.LEFT]=j,this.location[pn.RIGHT]=ce}};rr.prototype.setAllLocations=function(a){for(var h=0;h<this.location.length;h++)this.location[h]=a},rr.prototype.isNull=function(){for(var a=0;a<this.location.length;a++)if(this.location[a]!==Ae.NONE)return!1;return!0},rr.prototype.setAllLocationsIfNull=function(a){for(var h=0;h<this.location.length;h++)this.location[h]===Ae.NONE&&(this.location[h]=a)},rr.prototype.isLine=function(){return 1===this.location.length},rr.prototype.merge=function(a){if(a.location.length>this.location.length){var h=new Array(3).fill(null);h[pn.ON]=this.location[pn.ON],h[pn.LEFT]=Ae.NONE,h[pn.RIGHT]=Ae.NONE,this.location=h}for(var y=0;y<this.location.length;y++)this.location[y]===Ae.NONE&&y<a.location.length&&(this.location[y]=a.location[y])},rr.prototype.getLocations=function(){return this.location},rr.prototype.flip=function(){if(this.location.length<=1)return null;var a=this.location[pn.LEFT];this.location[pn.LEFT]=this.location[pn.RIGHT],this.location[pn.RIGHT]=a},rr.prototype.toString=function(){var a=new Fe;return this.location.length>1&&a.append(Ae.toLocationSymbol(this.location[pn.LEFT])),a.append(Ae.toLocationSymbol(this.location[pn.ON])),this.location.length>1&&a.append(Ae.toLocationSymbol(this.location[pn.RIGHT])),a.toString()},rr.prototype.setLocations=function(a,h,y){this.location[pn.ON]=a,this.location[pn.LEFT]=h,this.location[pn.RIGHT]=y},rr.prototype.get=function(a){return a<this.location.length?this.location[a]:Ae.NONE},rr.prototype.isArea=function(){return this.location.length>1},rr.prototype.isAnyNull=function(){for(var a=0;a<this.location.length;a++)if(this.location[a]===Ae.NONE)return!0;return!1},rr.prototype.setLocation=function(){1===arguments.length?this.setLocation(pn.ON,arguments[0]):2===arguments.length&&(this.location[arguments[0]]=arguments[1])},rr.prototype.init=function(a){this.location=new Array(a).fill(null),this.setAllLocations(Ae.NONE)},rr.prototype.isEqualOnSide=function(a,h){return this.location[h]===a.location[h]},rr.prototype.allPositionsEqual=function(a){for(var h=0;h<this.location.length;h++)if(this.location[h]!==a)return!1;return!0},rr.prototype.interfaces_=function(){return[]},rr.prototype.getClass=function(){return rr};var fi=function a(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var h=arguments[0];this.elt[0]=new rr(h),this.elt[1]=new rr(h)}else if(arguments[0]instanceof a){var y=arguments[0];this.elt[0]=new rr(y.elt[0]),this.elt[1]=new rr(y.elt[1])}}else if(2===arguments.length){var x=arguments[0],T=arguments[1];this.elt[0]=new rr(Ae.NONE),this.elt[1]=new rr(Ae.NONE),this.elt[x].setLocation(T)}else if(3===arguments.length){var F=arguments[0],j=arguments[1],ce=arguments[2];this.elt[0]=new rr(F,j,ce),this.elt[1]=new rr(F,j,ce)}else if(4===arguments.length){var ke=arguments[0],ft=arguments[1],Lt=arguments[2],$t=arguments[3];this.elt[0]=new rr(Ae.NONE,Ae.NONE,Ae.NONE),this.elt[1]=new rr(Ae.NONE,Ae.NONE,Ae.NONE),this.elt[ke].setLocations(ft,Lt,$t)}};fi.prototype.getGeometryCount=function(){var a=0;return this.elt[0].isNull()||a++,this.elt[1].isNull()||a++,a},fi.prototype.setAllLocations=function(a,h){this.elt[a].setAllLocations(h)},fi.prototype.isNull=function(a){return this.elt[a].isNull()},fi.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var a=arguments[0];this.setAllLocationsIfNull(0,a),this.setAllLocationsIfNull(1,a)}else 2===arguments.length&&this.elt[arguments[0]].setAllLocationsIfNull(arguments[1])},fi.prototype.isLine=function(a){return this.elt[a].isLine()},fi.prototype.merge=function(a){for(var h=0;h<2;h++)null===this.elt[h]&&null!==a.elt[h]?this.elt[h]=new rr(a.elt[h]):this.elt[h].merge(a.elt[h])},fi.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},fi.prototype.getLocation=function(){return 1===arguments.length?this.elt[arguments[0]].get(pn.ON):2===arguments.length?this.elt[arguments[0]].get(arguments[1]):void 0},fi.prototype.toString=function(){var a=new Fe;return null!==this.elt[0]&&(a.append("A:"),a.append(this.elt[0].toString())),null!==this.elt[1]&&(a.append(" B:"),a.append(this.elt[1].toString())),a.toString()},fi.prototype.isArea=function(){return 0===arguments.length?this.elt[0].isArea()||this.elt[1].isArea():1===arguments.length?this.elt[arguments[0]].isArea():void 0},fi.prototype.isAnyNull=function(a){return this.elt[a].isAnyNull()},fi.prototype.setLocation=function(){2===arguments.length?this.elt[arguments[0]].setLocation(pn.ON,arguments[1]):3===arguments.length&&this.elt[arguments[0]].setLocation(arguments[1],arguments[2])},fi.prototype.isEqualOnSide=function(a,h){return this.elt[0].isEqualOnSide(a.elt[0],h)&&this.elt[1].isEqualOnSide(a.elt[1],h)},fi.prototype.allPositionsEqual=function(a,h){return this.elt[a].allPositionsEqual(h)},fi.prototype.toLine=function(a){this.elt[a].isArea()&&(this.elt[a]=new rr(this.elt[a].location[0]))},fi.prototype.interfaces_=function(){return[]},fi.prototype.getClass=function(){return fi},fi.toLineLabel=function(a){for(var h=new fi(Ae.NONE),y=0;y<2;y++)h.setLocation(y,a.getLocation(y));return h};var Mo=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new Ve,this._pts=new Ve,this._label=new fi(Ae.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Ve,this._geometryFactory=null;var a=arguments[0];this._geometryFactory=arguments[1],this.computePoints(a),this.computeRing()};Mo.prototype.computeRing=function(){if(null!==this._ring)return null;for(var a=new Array(this._pts.size()).fill(null),h=0;h<this._pts.size();h++)a[h]=this._pts.get(h);this._ring=this._geometryFactory.createLinearRing(a),this._isHole=Gt.isCCW(this._ring.getCoordinates())},Mo.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},Mo.prototype.computePoints=function(a){this._startDe=a;var h=a,y=!0;do{if(null===h)throw new Dn("Found null DirectedEdge");if(h.getEdgeRing()===this)throw new Dn("Directed Edge visited twice during ring-building at "+h.getCoordinate());this._edges.add(h);var x=h.getLabel();xe.isTrue(x.isArea()),this.mergeLabel(x),this.addPoints(h.getEdge(),h.isForward(),y),y=!1,this.setEdgeRing(h,this),h=this.getNext(h)}while(h!==this._startDe)},Mo.prototype.getLinearRing=function(){return this._ring},Mo.prototype.getCoordinate=function(a){return this._pts.get(a)},Mo.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var a=this._startDe;do{var h=a.getNode().getEdges().getOutgoingDegree(this);h>this._maxNodeDegree&&(this._maxNodeDegree=h),a=this.getNext(a)}while(a!==this._startDe);this._maxNodeDegree*=2},Mo.prototype.addPoints=function(a,h,y){var x=a.getCoordinates();if(h){var T=1;y&&(T=0);for(var F=T;F<x.length;F++)this._pts.add(x[F])}else{var j=x.length-2;y&&(j=x.length-1);for(var ce=j;ce>=0;ce--)this._pts.add(x[ce])}},Mo.prototype.isHole=function(){return this._isHole},Mo.prototype.setInResult=function(){var a=this._startDe;do{a.getEdge().setInResult(!0),a=a.getNext()}while(a!==this._startDe)},Mo.prototype.containsPoint=function(a){var h=this.getLinearRing();if(!h.getEnvelopeInternal().contains(a)||!Gt.isPointInRing(a,h.getCoordinates()))return!1;for(var y=this._holes.iterator();y.hasNext();)if(y.next().containsPoint(a))return!1;return!0},Mo.prototype.addHole=function(a){this._holes.add(a)},Mo.prototype.isShell=function(){return null===this._shell},Mo.prototype.getLabel=function(){return this._label},Mo.prototype.getEdges=function(){return this._edges},Mo.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},Mo.prototype.getShell=function(){return this._shell},Mo.prototype.mergeLabel=function(){if(1===arguments.length){var a=arguments[0];this.mergeLabel(a,0),this.mergeLabel(a,1)}else if(2===arguments.length){var y=arguments[1],x=arguments[0].getLocation(y,pn.RIGHT);if(x===Ae.NONE)return null;if(this._label.getLocation(y)===Ae.NONE)return this._label.setLocation(y,x),null}},Mo.prototype.setShell=function(a){this._shell=a,null!==a&&a.addHole(this)},Mo.prototype.toPolygon=function(a){for(var h=new Array(this._holes.size()).fill(null),y=0;y<this._holes.size();y++)h[y]=this._holes.get(y).getLinearRing();return a.createPolygon(this.getLinearRing(),h)},Mo.prototype.interfaces_=function(){return[]},Mo.prototype.getClass=function(){return Mo};var tu=function(a){function h(){a.call(this,arguments[0],arguments[1])}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.setEdgeRing=function(y,x){y.setMinEdgeRing(x)},h.prototype.getNext=function(y){return y.getNextMin()},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Mo),Qo=function(a){function h(){a.call(this,arguments[0],arguments[1])}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.buildMinimalRings=function(){var y=new Ve,x=this._startDe;do{if(null===x.getMinEdgeRing()){var T=new tu(x,this._geometryFactory);y.add(T)}x=x.getNext()}while(x!==this._startDe);return y},h.prototype.setEdgeRing=function(y,x){y.setEdgeRing(x)},h.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var y=this._startDe;do{y.getNode().getEdges().linkMinimalDirectedEdges(this),y=y.getNext()}while(y!==this._startDe)},h.prototype.getNext=function(y){return y.getNext()},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Mo),yo=function(){this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0!==arguments.length&&1===arguments.length&&(this._label=arguments[0])};yo.prototype.setVisited=function(a){this._isVisited=a},yo.prototype.setInResult=function(a){this._isInResult=a},yo.prototype.isCovered=function(){return this._isCovered},yo.prototype.isCoveredSet=function(){return this._isCoveredSet},yo.prototype.setLabel=function(a){this._label=a},yo.prototype.getLabel=function(){return this._label},yo.prototype.setCovered=function(a){this._isCovered=a,this._isCoveredSet=!0},yo.prototype.updateIM=function(a){xe.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(a)},yo.prototype.isInResult=function(){return this._isInResult},yo.prototype.isVisited=function(){return this._isVisited},yo.prototype.interfaces_=function(){return[]},yo.prototype.getClass=function(){return yo};var th=function(a){function h(){a.call(this),this._coord=null,this._edges=null;var x=arguments[1];this._coord=arguments[0],this._edges=x,this._label=new fi(0,Ae.NONE)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.isIncidentEdgeInResult=function(){for(var y=this.getEdges().getEdges().iterator();y.hasNext();)if(y.next().getEdge().isInResult())return!0;return!1},h.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},h.prototype.getCoordinate=function(){return this._coord},h.prototype.print=function(y){y.println("node "+this._coord+" lbl: "+this._label)},h.prototype.computeIM=function(y){},h.prototype.computeMergedLocation=function(y,x){var T=Ae.NONE;if(T=this._label.getLocation(x),!y.isNull(x)){var F=y.getLocation(x);T!==Ae.BOUNDARY&&(T=F)}return T},h.prototype.setLabel=function(){if(2!==arguments.length)return a.prototype.setLabel.apply(this,arguments);var y=arguments[0],x=arguments[1];null===this._label?this._label=new fi(y,x):this._label.setLocation(y,x)},h.prototype.getEdges=function(){return this._edges},h.prototype.mergeLabel=function(){if(arguments[0]instanceof h)this.mergeLabel(arguments[0]._label);else if(arguments[0]instanceof fi)for(var x=arguments[0],T=0;T<2;T++){var F=this.computeMergedLocation(x,T);this._label.getLocation(T)===Ae.NONE&&this._label.setLocation(T,F)}},h.prototype.add=function(y){this._edges.insert(y),y.setNode(this)},h.prototype.setLabelBoundary=function(y){if(null===this._label)return null;var x=Ae.NONE;null!==this._label&&(x=this._label.getLocation(y)),this._label.setLocation(y,x===Ae.BOUNDARY?Ae.INTERIOR:Ae.BOUNDARY)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(yo),es=function(){this.nodeMap=new dt,this.nodeFact=null,this.nodeFact=arguments[0]};es.prototype.find=function(a){return this.nodeMap.get(a)},es.prototype.addNode=function(){if(arguments[0]instanceof Q){var a=arguments[0],h=this.nodeMap.get(a);return null===h&&(h=this.nodeFact.createNode(a),this.nodeMap.put(a,h)),h}if(arguments[0]instanceof th){var y=arguments[0],x=this.nodeMap.get(y.getCoordinate());return null===x?(this.nodeMap.put(y.getCoordinate(),y),y):(x.mergeLabel(y),x)}},es.prototype.print=function(a){for(var h=this.iterator();h.hasNext();)h.next().print(a)},es.prototype.iterator=function(){return this.nodeMap.values().iterator()},es.prototype.values=function(){return this.nodeMap.values()},es.prototype.getBoundaryNodes=function(a){for(var h=new Ve,y=this.iterator();y.hasNext();){var x=y.next();x.getLabel().getLocation(a)===Ae.BOUNDARY&&h.add(x)}return h},es.prototype.add=function(a){var h=a.getCoordinate();this.addNode(h).add(a)},es.prototype.interfaces_=function(){return[]},es.prototype.getClass=function(){return es};var Kr=function(){},mu={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Kr.prototype.interfaces_=function(){return[]},Kr.prototype.getClass=function(){return Kr},Kr.isNorthern=function(a){return a===Kr.NE||a===Kr.NW},Kr.isOpposite=function(a,h){return a!==h&&(a-h+4)%4==2},Kr.commonHalfPlane=function(a,h){if(a===h)return a;if((a-h+4)%4==2)return-1;var y=a<h?a:h;return 0===y&&3===(a>h?a:h)?3:y},Kr.isInHalfPlane=function(a,h){return h===Kr.SE?a===Kr.SE||a===Kr.SW:a===h||a===h+1},Kr.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var a=arguments[0],h=arguments[1];if(0===a&&0===h)throw new re("Cannot compute the quadrant for point ( "+a+", "+h+" )");return a>=0?h>=0?Kr.NE:Kr.SE:h>=0?Kr.NW:Kr.SW}if(arguments[0]instanceof Q&&arguments[1]instanceof Q){var y=arguments[0],x=arguments[1];if(x.x===y.x&&x.y===y.y)throw new re("Cannot compute the quadrant for two identical points "+y);return x.x>=y.x?x.y>=y.y?Kr.NE:Kr.SE:x.y>=y.y?Kr.NW:Kr.SW}},mu.NE.get=function(){return 0},mu.NW.get=function(){return 1},mu.SW.get=function(){return 2},mu.SE.get=function(){return 3},Object.defineProperties(Kr,mu);var vs=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length)this._edge=arguments[0];else if(3===arguments.length){var y=arguments[1],x=arguments[2];this._edge=arguments[0],this.init(y,x),this._label=null}else if(4===arguments.length){var F=arguments[1],j=arguments[2],ce=arguments[3];this._edge=arguments[0],this.init(F,j),this._label=ce}};vs.prototype.compareDirection=function(a){return this._dx===a._dx&&this._dy===a._dy?0:this._quadrant>a._quadrant?1:this._quadrant<a._quadrant?-1:Gt.computeOrientation(a._p0,a._p1,this._p1)},vs.prototype.getDy=function(){return this._dy},vs.prototype.getCoordinate=function(){return this._p0},vs.prototype.setNode=function(a){this._node=a},vs.prototype.print=function(a){var h=Math.atan2(this._dy,this._dx),y=this.getClass().getName(),x=y.lastIndexOf("."),T=y.substring(x+1);a.print("  "+T+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+h+"   "+this._label)},vs.prototype.compareTo=function(a){return this.compareDirection(a)},vs.prototype.getDirectedCoordinate=function(){return this._p1},vs.prototype.getDx=function(){return this._dx},vs.prototype.getLabel=function(){return this._label},vs.prototype.getEdge=function(){return this._edge},vs.prototype.getQuadrant=function(){return this._quadrant},vs.prototype.getNode=function(){return this._node},vs.prototype.toString=function(){var a=Math.atan2(this._dy,this._dx),h=this.getClass().getName(),y=h.lastIndexOf(".");return"  "+h.substring(y+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+a+"   "+this._label},vs.prototype.computeLabel=function(a){},vs.prototype.init=function(a,h){this._p0=a,this._p1=h,this._dx=h.x-a.x,this._dy=h.y-a.y,this._quadrant=Kr.quadrant(this._dx,this._dy),xe.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},vs.prototype.interfaces_=function(){return[ee]},vs.prototype.getClass=function(){return vs};var ss=function(a){function h(){var y=arguments[0],x=arguments[1];if(a.call(this,y),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=x,x)this.init(y.getCoordinate(0),y.getCoordinate(1));else{var T=y.getNumPoints()-1;this.init(y.getCoordinate(T),y.getCoordinate(T-1))}this.computeDirectedLabel()}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.getNextMin=function(){return this._nextMin},h.prototype.getDepth=function(y){return this._depth[y]},h.prototype.setVisited=function(y){this._isVisited=y},h.prototype.computeDirectedLabel=function(){this._label=new fi(this._edge.getLabel()),this._isForward||this._label.flip()},h.prototype.getNext=function(){return this._next},h.prototype.setDepth=function(y,x){if(-999!==this._depth[y]&&this._depth[y]!==x)throw new Dn("assigned depths do not match",this.getCoordinate());this._depth[y]=x},h.prototype.isInteriorAreaEdge=function(){for(var y=!0,x=0;x<2;x++)this._label.isArea(x)&&this._label.getLocation(x,pn.LEFT)===Ae.INTERIOR&&this._label.getLocation(x,pn.RIGHT)===Ae.INTERIOR||(y=!1);return y},h.prototype.setNextMin=function(y){this._nextMin=y},h.prototype.print=function(y){a.prototype.print.call(this,y),y.print(" "+this._depth[pn.LEFT]+"/"+this._depth[pn.RIGHT]),y.print(" ("+this.getDepthDelta()+")"),this._isInResult&&y.print(" inResult")},h.prototype.setMinEdgeRing=function(y){this._minEdgeRing=y},h.prototype.isLineEdge=function(){var y=this._label.isLine(0)||this._label.isLine(1),x=!this._label.isArea(0)||this._label.allPositionsEqual(0,Ae.EXTERIOR),T=!this._label.isArea(1)||this._label.allPositionsEqual(1,Ae.EXTERIOR);return y&&x&&T},h.prototype.setEdgeRing=function(y){this._edgeRing=y},h.prototype.getMinEdgeRing=function(){return this._minEdgeRing},h.prototype.getDepthDelta=function(){var y=this._edge.getDepthDelta();return this._isForward||(y=-y),y},h.prototype.setInResult=function(y){this._isInResult=y},h.prototype.getSym=function(){return this._sym},h.prototype.isForward=function(){return this._isForward},h.prototype.getEdge=function(){return this._edge},h.prototype.printEdge=function(y){this.print(y),y.print(" "),this._isForward?this._edge.print(y):this._edge.printReverse(y)},h.prototype.setSym=function(y){this._sym=y},h.prototype.setVisitedEdge=function(y){this.setVisited(y),this._sym.setVisited(y)},h.prototype.setEdgeDepths=function(y,x){var T=this.getEdge().getDepthDelta();this._isForward||(T=-T);var F=1;y===pn.LEFT&&(F=-1);var j=pn.opposite(y),ce=x+T*F;this.setDepth(y,x),this.setDepth(j,ce)},h.prototype.getEdgeRing=function(){return this._edgeRing},h.prototype.isInResult=function(){return this._isInResult},h.prototype.setNext=function(y){this._next=y},h.prototype.isVisited=function(){return this._isVisited},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.depthFactor=function(y,x){return y===Ae.EXTERIOR&&x===Ae.INTERIOR?1:y===Ae.INTERIOR&&x===Ae.EXTERIOR?-1:0},h}(vs),Il=function(){};Il.prototype.createNode=function(a){return new th(a,null)},Il.prototype.interfaces_=function(){return[]},Il.prototype.getClass=function(){return Il};var Do=function(){this._edges=new Ve,this._nodes=null,this._edgeEndList=new Ve,0===arguments.length?this._nodes=new es(new Il):1===arguments.length&&(this._nodes=new es(arguments[0]))};Do.prototype.printEdges=function(a){a.println("Edges:");for(var h=0;h<this._edges.size();h++){a.println("edge "+h+":");var y=this._edges.get(h);y.print(a),y.eiList.print(a)}},Do.prototype.find=function(a){return this._nodes.find(a)},Do.prototype.addNode=function(){return arguments[0]instanceof th||arguments[0]instanceof Q?this._nodes.addNode(arguments[0]):void 0},Do.prototype.getNodeIterator=function(){return this._nodes.iterator()},Do.prototype.linkResultDirectedEdges=function(){for(var a=this._nodes.iterator();a.hasNext();)a.next().getEdges().linkResultDirectedEdges()},Do.prototype.debugPrintln=function(a){cn.out.println(a)},Do.prototype.isBoundaryNode=function(a,h){var y=this._nodes.find(h);if(null===y)return!1;var x=y.getLabel();return null!==x&&x.getLocation(a)===Ae.BOUNDARY},Do.prototype.linkAllDirectedEdges=function(){for(var a=this._nodes.iterator();a.hasNext();)a.next().getEdges().linkAllDirectedEdges()},Do.prototype.matchInSameDirection=function(a,h,y,x){return!!a.equals(y)&&Gt.computeOrientation(a,h,x)===Gt.COLLINEAR&&Kr.quadrant(a,h)===Kr.quadrant(y,x)},Do.prototype.getEdgeEnds=function(){return this._edgeEndList},Do.prototype.debugPrint=function(a){cn.out.print(a)},Do.prototype.getEdgeIterator=function(){return this._edges.iterator()},Do.prototype.findEdgeInSameDirection=function(a,h){for(var y=0;y<this._edges.size();y++){var x=this._edges.get(y),T=x.getCoordinates();if(this.matchInSameDirection(a,h,T[0],T[1])||this.matchInSameDirection(a,h,T[T.length-1],T[T.length-2]))return x}return null},Do.prototype.insertEdge=function(a){this._edges.add(a)},Do.prototype.findEdgeEnd=function(a){for(var h=this.getEdgeEnds().iterator();h.hasNext();){var y=h.next();if(y.getEdge()===a)return y}return null},Do.prototype.addEdges=function(a){for(var h=a.iterator();h.hasNext();){var y=h.next();this._edges.add(y);var x=new ss(y,!0),T=new ss(y,!1);x.setSym(T),T.setSym(x),this.add(x),this.add(T)}},Do.prototype.add=function(a){this._nodes.add(a),this._edgeEndList.add(a)},Do.prototype.getNodes=function(){return this._nodes.values()},Do.prototype.findEdge=function(a,h){for(var y=0;y<this._edges.size();y++){var x=this._edges.get(y),T=x.getCoordinates();if(a.equals(T[0])&&h.equals(T[1]))return x}return null},Do.prototype.interfaces_=function(){return[]},Do.prototype.getClass=function(){return Do},Do.linkResultDirectedEdges=function(a){for(var h=a.iterator();h.hasNext();)h.next().getEdges().linkResultDirectedEdges()};var xs=function(){this._geometryFactory=null,this._shellList=new Ve,this._geometryFactory=arguments[0]};xs.prototype.sortShellsAndHoles=function(a,h,y){for(var x=a.iterator();x.hasNext();){var T=x.next();T.isHole()?y.add(T):h.add(T)}},xs.prototype.computePolygons=function(a){for(var h=new Ve,y=a.iterator();y.hasNext();){var x=y.next().toPolygon(this._geometryFactory);h.add(x)}return h},xs.prototype.placeFreeHoles=function(a,h){for(var y=h.iterator();y.hasNext();){var x=y.next();if(null===x.getShell()){var T=this.findEdgeRingContaining(x,a);if(null===T)throw new Dn("unable to assign hole to a shell",x.getCoordinate(0));x.setShell(T)}}},xs.prototype.buildMinimalEdgeRings=function(a,h,y){for(var x=new Ve,T=a.iterator();T.hasNext();){var F=T.next();if(F.getMaxNodeDegree()>2){F.linkDirectedEdgesForMinimalEdgeRings();var j=F.buildMinimalRings(),ce=this.findShell(j);null!==ce?(this.placePolygonHoles(ce,j),h.add(ce)):y.addAll(j)}else x.add(F)}return x},xs.prototype.containsPoint=function(a){for(var h=this._shellList.iterator();h.hasNext();)if(h.next().containsPoint(a))return!0;return!1},xs.prototype.buildMaximalEdgeRings=function(a){for(var h=new Ve,y=a.iterator();y.hasNext();){var x=y.next();if(x.isInResult()&&x.getLabel().isArea()&&null===x.getEdgeRing()){var T=new Qo(x,this._geometryFactory);h.add(T),T.setInResult()}}return h},xs.prototype.placePolygonHoles=function(a,h){for(var y=h.iterator();y.hasNext();){var x=y.next();x.isHole()&&x.setShell(a)}},xs.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},xs.prototype.findEdgeRingContaining=function(a,h){for(var y=a.getLinearRing(),x=y.getEnvelopeInternal(),T=y.getCoordinateN(0),F=null,j=null,ce=h.iterator();ce.hasNext();){var ke=ce.next(),ft=ke.getLinearRing(),Lt=ft.getEnvelopeInternal();null!==F&&(j=F.getLinearRing().getEnvelopeInternal());var $t=!1;Lt.contains(x)&&Gt.isPointInRing(T,ft.getCoordinates())&&($t=!0),$t&&(null===F||j.contains(Lt))&&(F=ke)}return F},xs.prototype.findShell=function(a){for(var h=0,y=null,x=a.iterator();x.hasNext();){var T=x.next();T.isHole()||(y=T,h++)}return xe.isTrue(h<=1,"found two shells in MinimalEdgeRing list"),y},xs.prototype.add=function(){if(1===arguments.length){var a=arguments[0];this.add(a.getEdgeEnds(),a.getNodes())}else if(2===arguments.length){var h=arguments[0];Do.linkResultDirectedEdges(arguments[1]);var x=this.buildMaximalEdgeRings(h),T=new Ve,F=this.buildMinimalEdgeRings(x,this._shellList,T);this.sortShellsAndHoles(F,this._shellList,T),this.placeFreeHoles(this._shellList,T)}},xs.prototype.interfaces_=function(){return[]},xs.prototype.getClass=function(){return xs};var Is=function(){};Is.prototype.getBounds=function(){},Is.prototype.interfaces_=function(){return[]},Is.prototype.getClass=function(){return Is};var ja=function(){this._bounds=null,this._item=null;var h=arguments[1];this._bounds=arguments[0],this._item=h};ja.prototype.getItem=function(){return this._item},ja.prototype.getBounds=function(){return this._bounds},ja.prototype.interfaces_=function(){return[Is,he]},ja.prototype.getClass=function(){return ja};var $u=function(){this._size=null,this._items=null,this._size=0,this._items=new Ve,this._items.add(null)};$u.prototype.poll=function(){if(this.isEmpty())return null;var a=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),a},$u.prototype.size=function(){return this._size},$u.prototype.reorder=function(a){for(var h=null,y=this._items.get(a);2*a<=this._size&&((h=2*a)!==this._size&&this._items.get(h+1).compareTo(this._items.get(h))<0&&h++,this._items.get(h).compareTo(y)<0);a=h)this._items.set(a,this._items.get(h));this._items.set(a,y)},$u.prototype.clear=function(){this._size=0,this._items.clear()},$u.prototype.isEmpty=function(){return 0===this._size},$u.prototype.add=function(a){this._items.add(null),this._size+=1;var h=this._size;for(this._items.set(0,a);a.compareTo(this._items.get(Math.trunc(h/2)))<0;h/=2)this._items.set(h,this._items.get(Math.trunc(h/2)));this._items.set(h,a)},$u.prototype.interfaces_=function(){return[]},$u.prototype.getClass=function(){return $u};var Ao=function(){};Ao.prototype.visitItem=function(a){},Ao.prototype.interfaces_=function(){return[]},Ao.prototype.getClass=function(){return Ao};var Jr=function(){};Jr.prototype.insert=function(a,h){},Jr.prototype.remove=function(a,h){},Jr.prototype.query=function(){},Jr.prototype.interfaces_=function(){return[]},Jr.prototype.getClass=function(){return Jr};var ts=function(){this._childBoundables=new Ve,this._bounds=null,this._level=null,0!==arguments.length&&1===arguments.length&&(this._level=arguments[0])},np={serialVersionUID:{configurable:!0}};ts.prototype.getLevel=function(){return this._level},ts.prototype.size=function(){return this._childBoundables.size()},ts.prototype.getChildBoundables=function(){return this._childBoundables},ts.prototype.addChildBoundable=function(a){xe.isTrue(null===this._bounds),this._childBoundables.add(a)},ts.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},ts.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},ts.prototype.interfaces_=function(){return[Is,he]},ts.prototype.getClass=function(){return ts},np.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(ts,np);var nu=function(){};nu.reverseOrder=function(){return{compare:function(a,h){return h.compareTo(a)}}},nu.min=function(a){return nu.sort(a),a.get(0)},nu.sort=function(a,h){var y=a.toArray();h?Io.sort(y,h):Io.sort(y);for(var x=a.iterator(),T=0,F=y.length;T<F;T++)x.next(),x.set(y[T])},nu.singletonList=function(a){var h=new Ve;return h.add(a),h};var Vn=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var h=arguments[1],y=arguments[2];this._boundable1=arguments[0],this._boundable2=h,this._itemDistance=y,this._distance=this.distance()};Vn.prototype.expandToQueue=function(a,h){var y=Vn.isComposite(this._boundable1),x=Vn.isComposite(this._boundable2);if(y&&x)return Vn.area(this._boundable1)>Vn.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,a,h),null):(this.expand(this._boundable2,this._boundable1,a,h),null);if(y)return this.expand(this._boundable1,this._boundable2,a,h),null;if(x)return this.expand(this._boundable2,this._boundable1,a,h),null;throw new re("neither boundable is composite")},Vn.prototype.isLeaves=function(){return!(Vn.isComposite(this._boundable1)||Vn.isComposite(this._boundable2))},Vn.prototype.compareTo=function(a){return this._distance<a._distance?-1:this._distance>a._distance?1:0},Vn.prototype.expand=function(a,h,y,x){for(var T=a.getChildBoundables().iterator();T.hasNext();){var F=T.next(),j=new Vn(F,h,this._itemDistance);j.getDistance()<x&&y.add(j)}},Vn.prototype.getBoundable=function(a){return 0===a?this._boundable1:this._boundable2},Vn.prototype.getDistance=function(){return this._distance},Vn.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},Vn.prototype.interfaces_=function(){return[ee]},Vn.prototype.getClass=function(){return Vn},Vn.area=function(a){return a.getBounds().getArea()},Vn.isComposite=function(a){return a instanceof ts};var _o=function a(){if(this._root=null,this._built=!1,this._itemBoundables=new Ve,this._nodeCapacity=null,0===arguments.length)this._nodeCapacity=a.DEFAULT_NODE_CAPACITY;else if(1===arguments.length){var y=arguments[0];xe.isTrue(y>1,"Node capacity must be greater than 1"),this._nodeCapacity=y}},yu={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};_o.prototype.getNodeCapacity=function(){return this._nodeCapacity},_o.prototype.lastNode=function(a){return a.get(a.size()-1)},_o.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var a=0,h=arguments[0].getChildBoundables().iterator();h.hasNext();){var y=h.next();y instanceof ts?a+=this.size(y):y instanceof ja&&(a+=1)}return a}},_o.prototype.removeItem=function(a,h){for(var y=null,x=a.getChildBoundables().iterator();x.hasNext();){var T=x.next();T instanceof ja&&T.getItem()===h&&(y=T)}return null!==y&&(a.getChildBoundables().remove(y),!0)},_o.prototype.itemsTree=function(){if(0===arguments.length){this.build();var a=this.itemsTree(this._root);return null===a?new Ve:a}if(1===arguments.length){for(var h=arguments[0],y=new Ve,x=h.getChildBoundables().iterator();x.hasNext();){var T=x.next();if(T instanceof ts){var F=this.itemsTree(T);null!==F&&y.add(F)}else T instanceof ja?y.add(T.getItem()):xe.shouldNeverReachHere()}return y.size()<=0?null:y}},_o.prototype.insert=function(a,h){xe.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new ja(a,h))},_o.prototype.boundablesAtLevel=function(){if(1===arguments.length){var a=arguments[0],h=new Ve;return this.boundablesAtLevel(a,this._root,h),h}if(3===arguments.length){var y=arguments[0],x=arguments[1],T=arguments[2];if(xe.isTrue(y>-2),x.getLevel()===y)return T.add(x),null;for(var F=x.getChildBoundables().iterator();F.hasNext();){var j=F.next();j instanceof ts?this.boundablesAtLevel(y,j,T):(xe.isTrue(j instanceof ja),-1===y&&T.add(j))}return null}},_o.prototype.query=function(){if(1===arguments.length){var a=arguments[0];this.build();var h=new Ve;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),a)&&this.query(a,this._root,h),h}if(2===arguments.length){var y=arguments[0],x=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),y)&&this.query(y,this._root,x)}else if(3===arguments.length)if(At(arguments[2],Ao)&&arguments[0]instanceof Object&&arguments[1]instanceof ts)for(var T=arguments[0],j=arguments[2],ce=arguments[1].getChildBoundables(),ke=0;ke<ce.size();ke++){var ft=ce.get(ke);this.getIntersectsOp().intersects(ft.getBounds(),T)&&(ft instanceof ts?this.query(T,ft,j):ft instanceof ja?j.visitItem(ft.getItem()):xe.shouldNeverReachHere())}else if(At(arguments[2],rt)&&arguments[0]instanceof Object&&arguments[1]instanceof ts)for(var Lt=arguments[0],Pn=arguments[2],Mn=arguments[1].getChildBoundables(),zn=0;zn<Mn.size();zn++){var qn=Mn.get(zn);this.getIntersectsOp().intersects(qn.getBounds(),Lt)&&(qn instanceof ts?this.query(Lt,qn,Pn):qn instanceof ja?Pn.add(qn.getItem()):xe.shouldNeverReachHere())}},_o.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},_o.prototype.getRoot=function(){return this.build(),this._root},_o.prototype.remove=function(){if(2===arguments.length){var a=arguments[0],h=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),a)&&this.remove(a,this._root,h)}if(3===arguments.length){var y=arguments[0],x=arguments[1],T=arguments[2],F=this.removeItem(x,T);if(F)return!0;for(var j=null,ce=x.getChildBoundables().iterator();ce.hasNext();){var ke=ce.next();if(this.getIntersectsOp().intersects(ke.getBounds(),y)&&ke instanceof ts&&(F=this.remove(y,ke,T))){j=ke;break}}return null!==j&&j.getChildBoundables().isEmpty()&&x.getChildBoundables().remove(j),F}},_o.prototype.createHigherLevels=function(a,h){xe.isTrue(!a.isEmpty());var y=this.createParentBoundables(a,h+1);return 1===y.size()?y.get(0):this.createHigherLevels(y,h+1)},_o.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var a=0,h=arguments[0].getChildBoundables().iterator();h.hasNext();){var y=h.next();if(y instanceof ts){var x=this.depth(y);x>a&&(a=x)}}return a+1}},_o.prototype.createParentBoundables=function(a,h){xe.isTrue(!a.isEmpty());var y=new Ve;y.add(this.createNode(h));var x=new Ve(a);nu.sort(x,this.getComparator());for(var T=x.iterator();T.hasNext();){var F=T.next();this.lastNode(y).getChildBoundables().size()===this.getNodeCapacity()&&y.add(this.createNode(h)),this.lastNode(y).addChildBoundable(F)}return y},_o.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},_o.prototype.interfaces_=function(){return[he]},_o.prototype.getClass=function(){return _o},_o.compareDoubles=function(a,h){return a>h?1:a<h?-1:0},yu.IntersectsOp.get=function(){return rl},yu.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},yu.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(_o,yu);var rl=function(){},ru=function(){};ru.prototype.distance=function(a,h){},ru.prototype.interfaces_=function(){return[]},ru.prototype.getClass=function(){return ru};var cc=function(a){function h(x){a.call(this,x=x||h.DEFAULT_NODE_CAPACITY)}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return h.prototype.createParentBoundablesFromVerticalSlices=function(x,T){xe.isTrue(x.length>0);for(var F=new Ve,j=0;j<x.length;j++)F.addAll(this.createParentBoundablesFromVerticalSlice(x[j],T));return F},h.prototype.createNode=function(x){return new il(x)},h.prototype.size=function(){return 0===arguments.length?a.prototype.size.call(this):a.prototype.size.apply(this,arguments)},h.prototype.insert=function(){if(2!==arguments.length)return a.prototype.insert.apply(this,arguments);var x=arguments[0],T=arguments[1];if(x.isNull())return null;a.prototype.insert.call(this,x,T)},h.prototype.getIntersectsOp=function(){return h.intersectsOp},h.prototype.verticalSlices=function(x,T){for(var F=Math.trunc(Math.ceil(x.size()/T)),j=new Array(T).fill(null),ce=x.iterator(),ke=0;ke<T;ke++){j[ke]=new Ve;for(var ft=0;ce.hasNext()&&ft<F;){var Lt=ce.next();j[ke].add(Lt),ft++}}return j},h.prototype.query=function(){if(1===arguments.length)return a.prototype.query.call(this,arguments[0]);2===arguments.length?a.prototype.query.call(this,arguments[0],arguments[1]):3===arguments.length&&(At(arguments[2],Ao)&&arguments[0]instanceof Object&&arguments[1]instanceof ts||At(arguments[2],rt)&&arguments[0]instanceof Object&&arguments[1]instanceof ts)&&a.prototype.query.call(this,arguments[0],arguments[1],arguments[2])},h.prototype.getComparator=function(){return h.yComparator},h.prototype.createParentBoundablesFromVerticalSlice=function(x,T){return a.prototype.createParentBoundables.call(this,x,T)},h.prototype.remove=function(){return 2===arguments.length?a.prototype.remove.call(this,arguments[0],arguments[1]):a.prototype.remove.apply(this,arguments)},h.prototype.depth=function(){return 0===arguments.length?a.prototype.depth.call(this):a.prototype.depth.apply(this,arguments)},h.prototype.createParentBoundables=function(x,T){xe.isTrue(!x.isEmpty());var F=Math.trunc(Math.ceil(x.size()/this.getNodeCapacity())),j=new Ve(x);nu.sort(j,h.xComparator);var ce=this.verticalSlices(j,Math.trunc(Math.ceil(Math.sqrt(F))));return this.createParentBoundablesFromVerticalSlices(ce,T)},h.prototype.nearestNeighbour=function(){if(1===arguments.length){if(At(arguments[0],ru)){var x=arguments[0],T=new Vn(this.getRoot(),this.getRoot(),x);return this.nearestNeighbour(T)}if(arguments[0]instanceof Vn)return this.nearestNeighbour(arguments[0],Y.POSITIVE_INFINITY)}else if(2===arguments.length){if(arguments[0]instanceof h&&At(arguments[1],ru)){var j=arguments[0],ce=arguments[1],ke=new Vn(this.getRoot(),j.getRoot(),ce);return this.nearestNeighbour(ke)}if(arguments[0]instanceof Vn&&"number"==typeof arguments[1]){var ft=arguments[0],Lt=arguments[1],$t=null,Pn=new $u;for(Pn.add(ft);!Pn.isEmpty()&&Lt>0;){var Mn=Pn.poll(),zn=Mn.getDistance();if(zn>=Lt)break;Mn.isLeaves()?(Lt=zn,$t=Mn):Mn.expandToQueue(Pn,Lt)}return[$t.getBoundable(0).getItem(),$t.getBoundable(1).getItem()]}}else if(3===arguments.length){var Sn=arguments[2],bs=new ja(arguments[0],arguments[1]),au=new Vn(this.getRoot(),bs,Sn);return this.nearestNeighbour(au)[0]}},h.prototype.interfaces_=function(){return[Jr,he]},h.prototype.getClass=function(){return h},h.centreX=function(x){return h.avg(x.getMinX(),x.getMaxX())},h.avg=function(x,T){return(x+T)/2},h.centreY=function(x){return h.avg(x.getMinY(),x.getMaxY())},y.STRtreeNode.get=function(){return il},y.serialVersionUID.get=function(){return 0x39920f7d5f261e0},y.xComparator.get=function(){return{interfaces_:function(){return[me]},compare:function(x,T){return a.compareDoubles(h.centreX(x.getBounds()),h.centreX(T.getBounds()))}}},y.yComparator.get=function(){return{interfaces_:function(){return[me]},compare:function(x,T){return a.compareDoubles(h.centreY(x.getBounds()),h.centreY(T.getBounds()))}}},y.intersectsOp.get=function(){return{interfaces_:function(){return[a.IntersectsOp]},intersects:function(x,T){return x.intersects(T)}}},y.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(h,y),h}(_o),il=function(a){function h(){a.call(this,arguments[0])}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.computeBounds=function(){for(var y=null,x=this.getChildBoundables().iterator();x.hasNext();){var T=x.next();null===y?y=new sn(T.getBounds()):y.expandToInclude(T.getBounds())}return y},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(ts),Ts=function(){};Ts.prototype.interfaces_=function(){return[]},Ts.prototype.getClass=function(){return Ts},Ts.relativeSign=function(a,h){return a<h?-1:a>h?1:0},Ts.compare=function(a,h,y){if(h.equals2D(y))return 0;var x=Ts.relativeSign(h.x,y.x),T=Ts.relativeSign(h.y,y.y);switch(a){case 0:return Ts.compareValue(x,T);case 1:return Ts.compareValue(T,x);case 2:return Ts.compareValue(T,-x);case 3:return Ts.compareValue(-x,T);case 4:return Ts.compareValue(-x,-T);case 5:return Ts.compareValue(-T,-x);case 6:return Ts.compareValue(-T,x);case 7:return Ts.compareValue(x,-T)}return xe.shouldNeverReachHere("invalid octant value"),0},Ts.compareValue=function(a,h){return a<0?-1:a>0?1:h<0?-1:h>0?1:0};var ya=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var a=arguments[0],h=arguments[1],y=arguments[2],x=arguments[3];this._segString=a,this.coord=new Q(h),this.segmentIndex=y,this._segmentOctant=x,this._isInterior=!h.equals2D(a.getCoordinate(y))};ya.prototype.getCoordinate=function(){return this.coord},ya.prototype.print=function(a){a.print(this.coord),a.print(" seg # = "+this.segmentIndex)},ya.prototype.compareTo=function(a){var h=a;return this.segmentIndex<h.segmentIndex?-1:this.segmentIndex>h.segmentIndex?1:this.coord.equals2D(h.coord)?0:Ts.compare(this._segmentOctant,this.coord,h.coord)},ya.prototype.isEndPoint=function(a){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===a},ya.prototype.isInterior=function(){return this._isInterior},ya.prototype.interfaces_=function(){return[ee]},ya.prototype.getClass=function(){return ya};var as=function(){this._nodeMap=new dt,this._edge=null,this._edge=arguments[0]};as.prototype.getSplitCoordinates=function(){var a=new Ct;this.addEndpoints();for(var h=this.iterator(),y=h.next();h.hasNext();){var x=h.next();this.addEdgeCoordinates(y,x,a),y=x}return a.toCoordinateArray()},as.prototype.addCollapsedNodes=function(){var a=new Ve;this.findCollapsesFromInsertedNodes(a),this.findCollapsesFromExistingVertices(a);for(var h=a.iterator();h.hasNext();){var y=h.next().intValue();this.add(this._edge.getCoordinate(y),y)}},as.prototype.print=function(a){a.println("Intersections:");for(var h=this.iterator();h.hasNext();)h.next().print(a)},as.prototype.findCollapsesFromExistingVertices=function(a){for(var h=0;h<this._edge.size()-2;h++){var y=this._edge.getCoordinate(h),x=this._edge.getCoordinate(h+2);y.equals2D(x)&&a.add(new at(h+1))}},as.prototype.addEdgeCoordinates=function(a,h,y){var x=this._edge.getCoordinate(h.segmentIndex),T=h.isInterior()||!h.coord.equals2D(x);y.add(new Q(a.coord),!1);for(var F=a.segmentIndex+1;F<=h.segmentIndex;F++)y.add(this._edge.getCoordinate(F));T&&y.add(new Q(h.coord))},as.prototype.iterator=function(){return this._nodeMap.values().iterator()},as.prototype.addSplitEdges=function(a){this.addEndpoints(),this.addCollapsedNodes();for(var h=this.iterator(),y=h.next();h.hasNext();){var x=h.next(),T=this.createSplitEdge(y,x);a.add(T),y=x}},as.prototype.findCollapseIndex=function(a,h,y){if(!a.coord.equals2D(h.coord))return!1;var x=h.segmentIndex-a.segmentIndex;return h.isInterior()||x--,1===x&&(y[0]=a.segmentIndex+1,!0)},as.prototype.findCollapsesFromInsertedNodes=function(a){for(var h=new Array(1).fill(null),y=this.iterator(),x=y.next();y.hasNext();){var T=y.next();this.findCollapseIndex(x,T,h)&&a.add(new at(h[0])),x=T}},as.prototype.getEdge=function(){return this._edge},as.prototype.addEndpoints=function(){var a=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(a),a)},as.prototype.createSplitEdge=function(a,h){var y=h.segmentIndex-a.segmentIndex+2,x=this._edge.getCoordinate(h.segmentIndex),T=h.isInterior()||!h.coord.equals2D(x);T||y--;var F=new Array(y).fill(null),j=0;F[j++]=new Q(a.coord);for(var ce=a.segmentIndex+1;ce<=h.segmentIndex;ce++)F[j++]=this._edge.getCoordinate(ce);return T&&(F[j]=new Q(h.coord)),new vo(F,this._edge.getData())},as.prototype.add=function(a,h){var y=new ya(this._edge,a,h,this._edge.getSegmentOctant(h)),x=this._nodeMap.get(y);return null!==x?(xe.isTrue(x.coord.equals2D(a),"Found equal nodes with different coordinates"),x):(this._nodeMap.put(y,y),y)},as.prototype.checkSplitEdgesCorrectness=function(a){var h=this._edge.getCoordinates(),y=a.get(0).getCoordinate(0);if(!y.equals2D(h[0]))throw new Te("bad split edge start point at "+y);var x=a.get(a.size()-1).getCoordinates(),T=x[x.length-1];if(!T.equals2D(h[h.length-1]))throw new Te("bad split edge end point at "+T)},as.prototype.interfaces_=function(){return[]},as.prototype.getClass=function(){return as};var Tl=function(){};Tl.prototype.interfaces_=function(){return[]},Tl.prototype.getClass=function(){return Tl},Tl.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var a=arguments[0],h=arguments[1];if(0===a&&0===h)throw new re("Cannot compute the octant for point ( "+a+", "+h+" )");var y=Math.abs(a),x=Math.abs(h);return a>=0?h>=0?y>=x?0:1:y>=x?7:6:h>=0?y>=x?3:2:y>=x?4:5}if(arguments[0]instanceof Q&&arguments[1]instanceof Q){var T=arguments[0],F=arguments[1],j=F.x-T.x,ce=F.y-T.y;if(0===j&&0===ce)throw new re("Cannot compute the octant for two identical points "+T);return Tl.octant(j,ce)}};var iu=function(){};iu.prototype.getCoordinates=function(){},iu.prototype.size=function(){},iu.prototype.getCoordinate=function(a){},iu.prototype.isClosed=function(){},iu.prototype.setData=function(a){},iu.prototype.getData=function(){},iu.prototype.interfaces_=function(){return[]},iu.prototype.getClass=function(){return iu};var pr=function(){};pr.prototype.addIntersection=function(a,h){},pr.prototype.interfaces_=function(){return[iu]},pr.prototype.getClass=function(){return pr};var vo=function(){this._nodeList=new as(this),this._pts=null,this._data=null;var h=arguments[1];this._pts=arguments[0],this._data=h};vo.prototype.getCoordinates=function(){return this._pts},vo.prototype.size=function(){return this._pts.length},vo.prototype.getCoordinate=function(a){return this._pts[a]},vo.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},vo.prototype.getSegmentOctant=function(a){return a===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(a),this.getCoordinate(a+1))},vo.prototype.setData=function(a){this._data=a},vo.prototype.safeOctant=function(a,h){return a.equals2D(h)?0:Tl.octant(a,h)},vo.prototype.getData=function(){return this._data},vo.prototype.addIntersection=function(){if(2===arguments.length)this.addIntersectionNode(arguments[0],arguments[1]);else if(4===arguments.length){var x=arguments[1],F=new Q(arguments[0].getIntersection(arguments[3]));this.addIntersection(F,x)}},vo.prototype.toString=function(){return wt.toLineString(new Ho(this._pts))},vo.prototype.getNodeList=function(){return this._nodeList},vo.prototype.addIntersectionNode=function(a,h){var y=h,x=y+1;return x<this._pts.length&&a.equals2D(this._pts[x])&&(y=x),this._nodeList.add(a,y)},vo.prototype.addIntersections=function(a,h,y){for(var x=0;x<a.getIntersectionNum();x++)this.addIntersection(a,h,y,x)},vo.prototype.interfaces_=function(){return[pr]},vo.prototype.getClass=function(){return vo},vo.getNodedSubstrings=function(){if(1===arguments.length){var a=arguments[0],h=new Ve;return vo.getNodedSubstrings(a,h),h}if(2===arguments.length)for(var x=arguments[1],T=arguments[0].iterator();T.hasNext();)T.next().getNodeList().addSplitEdges(x)};var Hn=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new Q,this.p1=new Q;else if(1===arguments.length){var a=arguments[0];this.p0=new Q(a.p0),this.p1=new Q(a.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var x=arguments[2],T=arguments[3];this.p0=new Q(arguments[0],arguments[1]),this.p1=new Q(x,T)}},kr={serialVersionUID:{configurable:!0}};Hn.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},Hn.prototype.orientationIndex=function(){if(arguments[0]instanceof Hn){var a=arguments[0],h=Gt.orientationIndex(this.p0,this.p1,a.p0),y=Gt.orientationIndex(this.p0,this.p1,a.p1);return h>=0&&y>=0||h<=0&&y<=0?Math.max(h,y):0}if(arguments[0]instanceof Q)return Gt.orientationIndex(this.p0,this.p1,arguments[0])},Hn.prototype.toGeometry=function(a){return a.createLineString([this.p0,this.p1])},Hn.prototype.isVertical=function(){return this.p0.x===this.p1.x},Hn.prototype.equals=function(a){if(!(a instanceof Hn))return!1;var h=a;return this.p0.equals(h.p0)&&this.p1.equals(h.p1)},Hn.prototype.intersection=function(a){var h=new Vt;return h.computeIntersection(this.p0,this.p1,a.p0,a.p1),h.hasIntersection()?h.getIntersection(0):null},Hn.prototype.project=function(){if(arguments[0]instanceof Q){var a=arguments[0];if(a.equals(this.p0)||a.equals(this.p1))return new Q(a);var h=this.projectionFactor(a),y=new Q;return y.x=this.p0.x+h*(this.p1.x-this.p0.x),y.y=this.p0.y+h*(this.p1.y-this.p0.y),y}if(arguments[0]instanceof Hn){var x=arguments[0],T=this.projectionFactor(x.p0),F=this.projectionFactor(x.p1);if(T>=1&&F>=1||T<=0&&F<=0)return null;var j=this.project(x.p0);T<0&&(j=this.p0),T>1&&(j=this.p1);var ce=this.project(x.p1);return F<0&&(ce=this.p0),F>1&&(ce=this.p1),new Hn(j,ce)}},Hn.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},Hn.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},Hn.prototype.getCoordinate=function(a){return 0===a?this.p0:this.p1},Hn.prototype.distancePerpendicular=function(a){return Gt.distancePointLinePerpendicular(a,this.p0,this.p1)},Hn.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},Hn.prototype.midPoint=function(){return Hn.midPoint(this.p0,this.p1)},Hn.prototype.projectionFactor=function(a){if(a.equals(this.p0))return 0;if(a.equals(this.p1))return 1;var h=this.p1.x-this.p0.x,y=this.p1.y-this.p0.y,x=h*h+y*y;return x<=0?Y.NaN:((a.x-this.p0.x)*h+(a.y-this.p0.y)*y)/x},Hn.prototype.closestPoints=function(a){var h=this.intersection(a);if(null!==h)return[h,h];var y=new Array(2).fill(null),x=Y.MAX_VALUE,T=null,F=this.closestPoint(a.p0);x=F.distance(a.p0),y[0]=F,y[1]=a.p0;var j=this.closestPoint(a.p1);(T=j.distance(a.p1))<x&&(x=T,y[0]=j,y[1]=a.p1);var ce=a.closestPoint(this.p0);(T=ce.distance(this.p0))<x&&(x=T,y[0]=this.p0,y[1]=ce);var ke=a.closestPoint(this.p1);return(T=ke.distance(this.p1))<x&&(x=T,y[0]=this.p1,y[1]=ke),y},Hn.prototype.closestPoint=function(a){var h=this.projectionFactor(a);return h>0&&h<1?this.project(a):this.p0.distance(a)<this.p1.distance(a)?this.p0:this.p1},Hn.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},Hn.prototype.getLength=function(){return this.p0.distance(this.p1)},Hn.prototype.compareTo=function(a){var h=a,y=this.p0.compareTo(h.p0);return 0!==y?y:this.p1.compareTo(h.p1)},Hn.prototype.reverse=function(){var a=this.p0;this.p0=this.p1,this.p1=a},Hn.prototype.equalsTopo=function(a){return this.p0.equals(a.p0)&&(this.p1.equals(a.p1)||this.p0.equals(a.p1))&&this.p1.equals(a.p0)},Hn.prototype.lineIntersection=function(a){try{return En.intersection(this.p0,this.p1,a.p0,a.p1)}catch(h){if(!(h instanceof Cn))throw h}return null},Hn.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},Hn.prototype.pointAlongOffset=function(a,h){var y=this.p0.x+a*(this.p1.x-this.p0.x),x=this.p0.y+a*(this.p1.y-this.p0.y),T=this.p1.x-this.p0.x,F=this.p1.y-this.p0.y,j=Math.sqrt(T*T+F*F),ce=0,ke=0;if(0!==h){if(j<=0)throw new Error("Cannot compute offset from zero-length line segment");ce=h*T/j,ke=h*F/j}return new Q(y-ke,x+ce)},Hn.prototype.setCoordinates=function(){if(1===arguments.length){var a=arguments[0];this.setCoordinates(a.p0,a.p1)}else if(2===arguments.length){var h=arguments[0],y=arguments[1];this.p0.x=h.x,this.p0.y=h.y,this.p1.x=y.x,this.p1.y=y.y}},Hn.prototype.segmentFraction=function(a){var h=this.projectionFactor(a);return h<0?h=0:(h>1||Y.isNaN(h))&&(h=1),h},Hn.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},Hn.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},Hn.prototype.distance=function(){if(arguments[0]instanceof Hn){var a=arguments[0];return Gt.distanceLineLine(this.p0,this.p1,a.p0,a.p1)}if(arguments[0]instanceof Q)return Gt.distancePointLine(arguments[0],this.p0,this.p1)},Hn.prototype.pointAlong=function(a){var h=new Q;return h.x=this.p0.x+a*(this.p1.x-this.p0.x),h.y=this.p0.y+a*(this.p1.y-this.p0.y),h},Hn.prototype.hashCode=function(){var a=Y.doubleToLongBits(this.p0.x);a^=31*Y.doubleToLongBits(this.p0.y);var h=Math.trunc(a)^Math.trunc(a>>32),y=Y.doubleToLongBits(this.p1.x);return y^=31*Y.doubleToLongBits(this.p1.y),h^Math.trunc(y)^Math.trunc(y>>32)},Hn.prototype.interfaces_=function(){return[ee,he]},Hn.prototype.getClass=function(){return Hn},Hn.midPoint=function(a,h){return new Q((a.x+h.x)/2,(a.y+h.y)/2)},kr.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(Hn,kr);var Ac=function(){this.tempEnv1=new sn,this.tempEnv2=new sn,this._overlapSeg1=new Hn,this._overlapSeg2=new Hn};Ac.prototype.overlap=function(){if(2!==arguments.length&&4===arguments.length){var y=arguments[2],x=arguments[3];arguments[0].getLineSegment(arguments[1],this._overlapSeg1),y.getLineSegment(x,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},Ac.prototype.interfaces_=function(){return[]},Ac.prototype.getClass=function(){return Ac};var _a=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var h=arguments[1],y=arguments[2],x=arguments[3];this._pts=arguments[0],this._start=h,this._end=y,this._context=x};_a.prototype.getLineSegment=function(a,h){h.p0=this._pts[a],h.p1=this._pts[a+1]},_a.prototype.computeSelect=function(a,h,y,x){if(x.tempEnv1.init(this._pts[h],this._pts[y]),y-h==1)return x.select(this,h),null;if(!a.intersects(x.tempEnv1))return null;var j=Math.trunc((h+y)/2);h<j&&this.computeSelect(a,h,j,x),j<y&&this.computeSelect(a,j,y,x)},_a.prototype.getCoordinates=function(){for(var a=new Array(this._end-this._start+1).fill(null),h=0,y=this._start;y<=this._end;y++)a[h++]=this._pts[y];return a},_a.prototype.computeOverlaps=function(a,h){this.computeOverlapsInternal(this._start,this._end,a,a._start,a._end,h)},_a.prototype.setId=function(a){this._id=a},_a.prototype.select=function(a,h){this.computeSelect(a,this._start,this._end,h)},_a.prototype.getEnvelope=function(){return null===this._env&&(this._env=new sn(this._pts[this._start],this._pts[this._end])),this._env},_a.prototype.getEndIndex=function(){return this._end},_a.prototype.getStartIndex=function(){return this._start},_a.prototype.getContext=function(){return this._context},_a.prototype.getId=function(){return this._id},_a.prototype.computeOverlapsInternal=function(a,h,y,x,T,F){var j=this._pts[a],ce=this._pts[h],ke=y._pts[x],ft=y._pts[T];if(h-a==1&&T-x==1)return F.overlap(this,a,y,x),null;if(F.tempEnv1.init(j,ce),F.tempEnv2.init(ke,ft),!F.tempEnv1.intersects(F.tempEnv2))return null;var Lt=Math.trunc((a+h)/2),$t=Math.trunc((x+T)/2);a<Lt&&(x<$t&&this.computeOverlapsInternal(a,Lt,y,x,$t,F),$t<T&&this.computeOverlapsInternal(a,Lt,y,$t,T,F)),Lt<h&&(x<$t&&this.computeOverlapsInternal(Lt,h,y,x,$t,F),$t<T&&this.computeOverlapsInternal(Lt,h,y,$t,T,F))},_a.prototype.interfaces_=function(){return[]},_a.prototype.getClass=function(){return _a};var di=function(){};di.prototype.interfaces_=function(){return[]},di.prototype.getClass=function(){return di},di.getChainStartIndices=function(a){var h=0,y=new Ve;y.add(new at(h));do{var x=di.findChainEnd(a,h);y.add(new at(x)),h=x}while(h<a.length-1);return di.toIntArray(y)},di.findChainEnd=function(a,h){for(var y=h;y<a.length-1&&a[y].equals2D(a[y+1]);)y++;if(y>=a.length-1)return a.length-1;for(var x=Kr.quadrant(a[y],a[y+1]),T=h+1;T<a.length&&(a[T-1].equals2D(a[T])||Kr.quadrant(a[T-1],a[T])===x);)T++;return T-1},di.getChains=function(){if(1===arguments.length)return di.getChains(arguments[0],null);if(2===arguments.length){for(var h=arguments[0],y=arguments[1],x=new Ve,T=di.getChainStartIndices(h),F=0;F<T.length-1;F++){var j=new _a(h,T[F],T[F+1],y);x.add(j)}return x}},di.toIntArray=function(a){for(var h=new Array(a.size()).fill(null),y=0;y<h.length;y++)h[y]=a.get(y).intValue();return h};var Ml=function(){};Ml.prototype.computeNodes=function(a){},Ml.prototype.getNodedSubstrings=function(){},Ml.prototype.interfaces_=function(){return[]},Ml.prototype.getClass=function(){return Ml};var nh=function(){this._segInt=null,0!==arguments.length&&1===arguments.length&&this.setSegmentIntersector(arguments[0])};nh.prototype.setSegmentIntersector=function(a){this._segInt=a},nh.prototype.interfaces_=function(){return[Ml]},nh.prototype.getClass=function(){return nh};var Oh=function(a){function h(x){x?a.call(this,x):a.call(this),this._monoChains=new Ve,this._index=new cc,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={SegmentOverlapAction:{configurable:!0}};return h.prototype.getMonotoneChains=function(){return this._monoChains},h.prototype.getNodedSubstrings=function(){return vo.getNodedSubstrings(this._nodedSegStrings)},h.prototype.getIndex=function(){return this._index},h.prototype.add=function(x){for(var T=di.getChains(x.getCoordinates(),x).iterator();T.hasNext();){var F=T.next();F.setId(this._idCounter++),this._index.insert(F.getEnvelope(),F),this._monoChains.add(F)}},h.prototype.computeNodes=function(x){this._nodedSegStrings=x;for(var T=x.iterator();T.hasNext();)this.add(T.next());this.intersectChains()},h.prototype.intersectChains=function(){for(var x=new qu(this._segInt),T=this._monoChains.iterator();T.hasNext();)for(var F=T.next(),j=this._index.query(F.getEnvelope()).iterator();j.hasNext();){var ce=j.next();if(ce.getId()>F.getId()&&(F.computeOverlaps(ce,x),this._nOverlaps++),this._segInt.isDone())return null}},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},y.SegmentOverlapAction.get=function(){return qu},Object.defineProperties(h,y),h}(nh),qu=function(a){function h(){a.call(this),this._si=null,this._si=arguments[0]}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.overlap=function(){if(4!==arguments.length)return a.prototype.overlap.apply(this,arguments);var x=arguments[1],T=arguments[2],F=arguments[3],j=arguments[0].getContext(),ce=T.getContext();this._si.processIntersections(j,x,ce,F)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Ac),ri=function a(){if(this._quadrantSegments=a.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=a.CAP_ROUND,this._joinStyle=a.JOIN_ROUND,this._mitreLimit=a.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=a.DEFAULT_SIMPLIFY_FACTOR,0!==arguments.length)if(1===arguments.length)this.setQuadrantSegments(arguments[0]);else if(2===arguments.length){var x=arguments[1];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(x)}else if(4===arguments.length){var F=arguments[1],j=arguments[2],ce=arguments[3];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(F),this.setJoinStyle(j),this.setMitreLimit(ce)}},ia={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};ri.prototype.getEndCapStyle=function(){return this._endCapStyle},ri.prototype.isSingleSided=function(){return this._isSingleSided},ri.prototype.setQuadrantSegments=function(a){this._quadrantSegments=a,0===this._quadrantSegments&&(this._joinStyle=ri.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=ri.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),a<=0&&(this._quadrantSegments=1),this._joinStyle!==ri.JOIN_ROUND&&(this._quadrantSegments=ri.DEFAULT_QUADRANT_SEGMENTS)},ri.prototype.getJoinStyle=function(){return this._joinStyle},ri.prototype.setJoinStyle=function(a){this._joinStyle=a},ri.prototype.setSimplifyFactor=function(a){this._simplifyFactor=a<0?0:a},ri.prototype.getSimplifyFactor=function(){return this._simplifyFactor},ri.prototype.getQuadrantSegments=function(){return this._quadrantSegments},ri.prototype.setEndCapStyle=function(a){this._endCapStyle=a},ri.prototype.getMitreLimit=function(){return this._mitreLimit},ri.prototype.setMitreLimit=function(a){this._mitreLimit=a},ri.prototype.setSingleSided=function(a){this._isSingleSided=a},ri.prototype.interfaces_=function(){return[]},ri.prototype.getClass=function(){return ri},ri.bufferDistanceError=function(a){var h=Math.PI/2/a;return 1-Math.cos(h/2)},ia.CAP_ROUND.get=function(){return 1},ia.CAP_FLAT.get=function(){return 2},ia.CAP_SQUARE.get=function(){return 3},ia.JOIN_ROUND.get=function(){return 1},ia.JOIN_MITRE.get=function(){return 2},ia.JOIN_BEVEL.get=function(){return 3},ia.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},ia.DEFAULT_MITRE_LIMIT.get=function(){return 5},ia.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(ri,ia);var Ci=function(a){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Gt.COUNTERCLOCKWISE,this._inputLine=a||null},Hu={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Ci.prototype.isDeletable=function(a,h,y,x){var T=this._inputLine[a],F=this._inputLine[h],j=this._inputLine[y];return!!this.isConcave(T,F,j)&&!!this.isShallow(T,F,j,x)&&this.isShallowSampled(T,F,a,y,x)},Ci.prototype.deleteShallowConcavities=function(){for(var a=1,h=this.findNextNonDeletedIndex(a),y=this.findNextNonDeletedIndex(h),x=!1;y<this._inputLine.length;){var T=!1;this.isDeletable(a,h,y,this._distanceTol)&&(this._isDeleted[h]=Ci.DELETE,T=!0,x=!0),h=this.findNextNonDeletedIndex(a=T?y:h),y=this.findNextNonDeletedIndex(h)}return x},Ci.prototype.isShallowConcavity=function(a,h,y,x){return Gt.computeOrientation(a,h,y)===this._angleOrientation&&Gt.distancePointLine(h,a,y)<x},Ci.prototype.isShallowSampled=function(a,h,y,x,T){var F=Math.trunc((x-y)/Ci.NUM_PTS_TO_CHECK);F<=0&&(F=1);for(var j=y;j<x;j+=F)if(!this.isShallow(a,h,this._inputLine[j],T))return!1;return!0},Ci.prototype.isConcave=function(a,h,y){return Gt.computeOrientation(a,h,y)===this._angleOrientation},Ci.prototype.simplify=function(a){this._distanceTol=Math.abs(a),a<0&&(this._angleOrientation=Gt.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var h=!1;do{h=this.deleteShallowConcavities()}while(h);return this.collapseLine()},Ci.prototype.findNextNonDeletedIndex=function(a){for(var h=a+1;h<this._inputLine.length&&this._isDeleted[h]===Ci.DELETE;)h++;return h},Ci.prototype.isShallow=function(a,h,y,x){return Gt.distancePointLine(h,a,y)<x},Ci.prototype.collapseLine=function(){for(var a=new Ct,h=0;h<this._inputLine.length;h++)this._isDeleted[h]!==Ci.DELETE&&a.add(this._inputLine[h]);return a.toCoordinateArray()},Ci.prototype.interfaces_=function(){return[]},Ci.prototype.getClass=function(){return Ci},Ci.simplify=function(a,h){return new Ci(a).simplify(h)},Hu.INIT.get=function(){return 0},Hu.DELETE.get=function(){return 1},Hu.KEEP.get=function(){return 1},Hu.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Ci,Hu);var oa=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Ve},Nh={COORDINATE_ARRAY_TYPE:{configurable:!0}};oa.prototype.getCoordinates=function(){return this._ptList.toArray(oa.COORDINATE_ARRAY_TYPE)},oa.prototype.setPrecisionModel=function(a){this._precisionModel=a},oa.prototype.addPt=function(a){var h=new Q(a);if(this._precisionModel.makePrecise(h),this.isRedundant(h))return null;this._ptList.add(h)},oa.prototype.revere=function(){},oa.prototype.addPts=function(a,h){if(h)for(var y=0;y<a.length;y++)this.addPt(a[y]);else for(var x=a.length-1;x>=0;x--)this.addPt(a[x])},oa.prototype.isRedundant=function(a){if(this._ptList.size()<1)return!1;var h=this._ptList.get(this._ptList.size()-1);return a.distance(h)<this._minimimVertexDistance},oa.prototype.toString=function(){return(new Bn).createLineString(this.getCoordinates()).toString()},oa.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var a=new Q(this._ptList.get(0)),h=this._ptList.get(this._ptList.size()-1);if(a.equals(h))return null;this._ptList.add(a)},oa.prototype.setMinimumVertexDistance=function(a){this._minimimVertexDistance=a},oa.prototype.interfaces_=function(){return[]},oa.prototype.getClass=function(){return oa},Nh.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(oa,Nh);var Dr=function(){},Dl={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Dr.prototype.interfaces_=function(){return[]},Dr.prototype.getClass=function(){return Dr},Dr.toDegrees=function(a){return 180*a/Math.PI},Dr.normalize=function(a){for(;a>Math.PI;)a-=Dr.PI_TIMES_2;for(;a<=-Math.PI;)a+=Dr.PI_TIMES_2;return a},Dr.angle=function(){if(1===arguments.length){var a=arguments[0];return Math.atan2(a.y,a.x)}if(2===arguments.length){var h=arguments[0],y=arguments[1];return Math.atan2(y.y-h.y,y.x-h.x)}},Dr.isAcute=function(a,h,y){return(a.x-h.x)*(y.x-h.x)+(a.y-h.y)*(y.y-h.y)>0},Dr.isObtuse=function(a,h,y){return(a.x-h.x)*(y.x-h.x)+(a.y-h.y)*(y.y-h.y)<0},Dr.interiorAngle=function(a,h,y){var x=Dr.angle(h,a),T=Dr.angle(h,y);return Math.abs(T-x)},Dr.normalizePositive=function(a){if(a<0){for(;a<0;)a+=Dr.PI_TIMES_2;a>=Dr.PI_TIMES_2&&(a=0)}else{for(;a>=Dr.PI_TIMES_2;)a-=Dr.PI_TIMES_2;a<0&&(a=0)}return a},Dr.angleBetween=function(a,h,y){var x=Dr.angle(h,a),T=Dr.angle(h,y);return Dr.diff(x,T)},Dr.diff=function(a,h){var y=null;return(y=a<h?h-a:a-h)>Math.PI&&(y=2*Math.PI-y),y},Dr.toRadians=function(a){return a*Math.PI/180},Dr.getTurn=function(a,h){var y=Math.sin(h-a);return y>0?Dr.COUNTERCLOCKWISE:y<0?Dr.CLOCKWISE:Dr.NONE},Dr.angleBetweenOriented=function(a,h,y){var x=Dr.angle(h,a),T=Dr.angle(h,y)-x;return T<=-Math.PI?T+Dr.PI_TIMES_2:T>Math.PI?T-Dr.PI_TIMES_2:T},Dl.PI_TIMES_2.get=function(){return 2*Math.PI},Dl.PI_OVER_2.get=function(){return Math.PI/2},Dl.PI_OVER_4.get=function(){return Math.PI/4},Dl.COUNTERCLOCKWISE.get=function(){return Gt.COUNTERCLOCKWISE},Dl.CLOCKWISE.get=function(){return Gt.CLOCKWISE},Dl.NONE.get=function(){return Gt.COLLINEAR},Object.defineProperties(Dr,Dl);var gi=function a(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Hn,this._seg1=new Hn,this._offset0=new Hn,this._offset1=new Hn,this._side=0,this._hasNarrowConcaveAngle=!1;var y=arguments[1],x=arguments[2];this._precisionModel=arguments[0],this._bufParams=y,this._li=new Vt,this._filletAngleQuantum=Math.PI/2/y.getQuadrantSegments(),y.getQuadrantSegments()>=8&&y.getJoinStyle()===ri.JOIN_ROUND&&(this._closingSegLengthFactor=a.MAX_CLOSING_SEG_LEN_FACTOR),this.init(x)},Zl={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};gi.prototype.addNextSegment=function(a,h){if(this._s0=this._s1,this._s1=this._s2,this._s2=a,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var y=Gt.computeOrientation(this._s0,this._s1,this._s2),x=y===Gt.CLOCKWISE&&this._side===pn.LEFT||y===Gt.COUNTERCLOCKWISE&&this._side===pn.RIGHT;0===y?this.addCollinear(h):x?this.addOutsideTurn(y,h):this.addInsideTurn(y,h)},gi.prototype.addLineEndCap=function(a,h){var y=new Hn(a,h),x=new Hn;this.computeOffsetSegment(y,pn.LEFT,this._distance,x);var T=new Hn;this.computeOffsetSegment(y,pn.RIGHT,this._distance,T);var ce=Math.atan2(h.y-a.y,h.x-a.x);switch(this._bufParams.getEndCapStyle()){case ri.CAP_ROUND:this._segList.addPt(x.p1),this.addFilletArc(h,ce+Math.PI/2,ce-Math.PI/2,Gt.CLOCKWISE,this._distance),this._segList.addPt(T.p1);break;case ri.CAP_FLAT:this._segList.addPt(x.p1),this._segList.addPt(T.p1);break;case ri.CAP_SQUARE:var ke=new Q;ke.x=Math.abs(this._distance)*Math.cos(ce),ke.y=Math.abs(this._distance)*Math.sin(ce);var ft=new Q(x.p1.x+ke.x,x.p1.y+ke.y),Lt=new Q(T.p1.x+ke.x,T.p1.y+ke.y);this._segList.addPt(ft),this._segList.addPt(Lt)}},gi.prototype.getCoordinates=function(){return this._segList.getCoordinates()},gi.prototype.addMitreJoin=function(a,h,y,x){var T=!0,F=null;try{F=En.intersection(h.p0,h.p1,y.p0,y.p1),(x<=0?1:F.distance(a)/Math.abs(x))>this._bufParams.getMitreLimit()&&(T=!1)}catch(j){if(!(j instanceof Cn))throw j;F=new Q(0,0),T=!1}T?this._segList.addPt(F):this.addLimitedMitreJoin(h,y,x,this._bufParams.getMitreLimit())},gi.prototype.addFilletCorner=function(a,h,y,x,T){var ce=Math.atan2(h.y-a.y,h.x-a.x),Lt=Math.atan2(y.y-a.y,y.x-a.x);x===Gt.CLOCKWISE?ce<=Lt&&(ce+=2*Math.PI):ce>=Lt&&(ce-=2*Math.PI),this._segList.addPt(h),this.addFilletArc(a,ce,Lt,x,T),this._segList.addPt(y)},gi.prototype.addOutsideTurn=function(a,h){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*gi.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===ri.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===ri.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(h&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,a,this._distance),this._segList.addPt(this._offset1.p0))},gi.prototype.createSquare=function(a){this._segList.addPt(new Q(a.x+this._distance,a.y+this._distance)),this._segList.addPt(new Q(a.x+this._distance,a.y-this._distance)),this._segList.addPt(new Q(a.x-this._distance,a.y-this._distance)),this._segList.addPt(new Q(a.x-this._distance,a.y+this._distance)),this._segList.closeRing()},gi.prototype.addSegments=function(a,h){this._segList.addPts(a,h)},gi.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},gi.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},gi.prototype.initSideSegments=function(a,h,y){this._s1=a,this._s2=h,this._side=y,this._seg1.setCoordinates(a,h),this.computeOffsetSegment(this._seg1,y,this._distance,this._offset1)},gi.prototype.addLimitedMitreJoin=function(a,h,y,x){var T=this._seg0.p1,F=Dr.angle(T,this._seg0.p0),j=Dr.angleBetweenOriented(this._seg0.p0,T,this._seg1.p1)/2,ce=Dr.normalize(F+j),ke=Dr.normalize(ce+Math.PI),ft=x*y,Lt=y-ft*Math.abs(Math.sin(j)),$t=T.x+ft*Math.cos(ke),Pn=T.y+ft*Math.sin(ke),Mn=new Q($t,Pn),zn=new Hn(T,Mn),qn=zn.pointAlongOffset(1,Lt),hi=zn.pointAlongOffset(1,-Lt);this._side===pn.LEFT?(this._segList.addPt(qn),this._segList.addPt(hi)):(this._segList.addPt(hi),this._segList.addPt(qn))},gi.prototype.computeOffsetSegment=function(a,h,y,x){var T=h===pn.LEFT?1:-1,F=a.p1.x-a.p0.x,j=a.p1.y-a.p0.y,ce=Math.sqrt(F*F+j*j),ke=T*y*F/ce,ft=T*y*j/ce;x.p0.x=a.p0.x-ft,x.p0.y=a.p0.y+ke,x.p1.x=a.p1.x-ft,x.p1.y=a.p1.y+ke},gi.prototype.addFilletArc=function(a,h,y,x,T){var F=x===Gt.CLOCKWISE?-1:1,j=Math.abs(h-y),ce=Math.trunc(j/this._filletAngleQuantum+.5);if(ce<1)return null;for(var ke=j/ce,ft=0,Lt=new Q;ft<j;){var $t=h+F*ft;Lt.x=a.x+T*Math.cos($t),Lt.y=a.y+T*Math.sin($t),this._segList.addPt(Lt),ft+=ke}},gi.prototype.addInsideTurn=function(a,h){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*gi.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var y=new Q((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(y);var x=new Q((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(x)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},gi.prototype.createCircle=function(a){var h=new Q(a.x+this._distance,a.y);this._segList.addPt(h),this.addFilletArc(a,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},gi.prototype.addBevelJoin=function(a,h){this._segList.addPt(a.p1),this._segList.addPt(h.p0)},gi.prototype.init=function(a){this._distance=a,this._maxCurveSegmentError=a*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new oa,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(a*gi.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},gi.prototype.addCollinear=function(a){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===ri.JOIN_BEVEL||this._bufParams.getJoinStyle()===ri.JOIN_MITRE?(a&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,Gt.CLOCKWISE,this._distance))},gi.prototype.closeRing=function(){this._segList.closeRing()},gi.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},gi.prototype.interfaces_=function(){return[]},gi.prototype.getClass=function(){return gi},Zl.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Zl.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Zl.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Zl.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(gi,Zl);var Wn=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var h=arguments[1];this._precisionModel=arguments[0],this._bufParams=h};Wn.prototype.getOffsetCurve=function(a,h){if(this._distance=h,0===h)return null;var y=h<0,x=Math.abs(h),T=this.getSegGen(x);a.length<=1?this.computePointCurve(a[0],T):this.computeOffsetCurve(a,y,T);var F=T.getCoordinates();return y&&tt.reverse(F),F},Wn.prototype.computeSingleSidedBufferCurve=function(a,h,y){var x=this.simplifyTolerance(this._distance);if(h){y.addSegments(a,!0);var T=Ci.simplify(a,-x),F=T.length-1;y.initSideSegments(T[F],T[F-1],pn.LEFT),y.addFirstSegment();for(var j=F-2;j>=0;j--)y.addNextSegment(T[j],!0)}else{y.addSegments(a,!1);var ce=Ci.simplify(a,x),ke=ce.length-1;y.initSideSegments(ce[0],ce[1],pn.LEFT),y.addFirstSegment();for(var ft=2;ft<=ke;ft++)y.addNextSegment(ce[ft],!0)}y.addLastSegment(),y.closeRing()},Wn.prototype.computeRingBufferCurve=function(a,h,y){var x=this.simplifyTolerance(this._distance);h===pn.RIGHT&&(x=-x);var T=Ci.simplify(a,x),F=T.length-1;y.initSideSegments(T[F-1],T[0],h);for(var j=1;j<=F;j++)y.addNextSegment(T[j],1!==j);y.closeRing()},Wn.prototype.computeLineBufferCurve=function(a,h){var y=this.simplifyTolerance(this._distance),x=Ci.simplify(a,y),T=x.length-1;h.initSideSegments(x[0],x[1],pn.LEFT);for(var F=2;F<=T;F++)h.addNextSegment(x[F],!0);h.addLastSegment(),h.addLineEndCap(x[T-1],x[T]);var j=Ci.simplify(a,-y),ce=j.length-1;h.initSideSegments(j[ce],j[ce-1],pn.LEFT);for(var ke=ce-2;ke>=0;ke--)h.addNextSegment(j[ke],!0);h.addLastSegment(),h.addLineEndCap(j[1],j[0]),h.closeRing()},Wn.prototype.computePointCurve=function(a,h){switch(this._bufParams.getEndCapStyle()){case ri.CAP_ROUND:h.createCircle(a);break;case ri.CAP_SQUARE:h.createSquare(a)}},Wn.prototype.getLineCurve=function(a,h){if(this._distance=h,h<0&&!this._bufParams.isSingleSided()||0===h)return null;var y=Math.abs(h),x=this.getSegGen(y);return a.length<=1?this.computePointCurve(a[0],x):this._bufParams.isSingleSided()?this.computeSingleSidedBufferCurve(a,h<0,x):this.computeLineBufferCurve(a,x),x.getCoordinates()},Wn.prototype.getBufferParameters=function(){return this._bufParams},Wn.prototype.simplifyTolerance=function(a){return a*this._bufParams.getSimplifyFactor()},Wn.prototype.getRingCurve=function(a,h,y){if(this._distance=y,a.length<=2)return this.getLineCurve(a,y);if(0===y)return Wn.copyCoordinates(a);var x=this.getSegGen(y);return this.computeRingBufferCurve(a,h,x),x.getCoordinates()},Wn.prototype.computeOffsetCurve=function(a,h,y){var x=this.simplifyTolerance(this._distance);if(h){var T=Ci.simplify(a,-x),F=T.length-1;y.initSideSegments(T[F],T[F-1],pn.LEFT),y.addFirstSegment();for(var j=F-2;j>=0;j--)y.addNextSegment(T[j],!0)}else{var ce=Ci.simplify(a,x),ke=ce.length-1;y.initSideSegments(ce[0],ce[1],pn.LEFT),y.addFirstSegment();for(var ft=2;ft<=ke;ft++)y.addNextSegment(ce[ft],!0)}y.addLastSegment()},Wn.prototype.getSegGen=function(a){return new gi(this._precisionModel,this._bufParams,a)},Wn.prototype.interfaces_=function(){return[]},Wn.prototype.getClass=function(){return Wn},Wn.copyCoordinates=function(a){for(var h=new Array(a.length).fill(null),y=0;y<h.length;y++)h[y]=new Q(a[y]);return h};var ol=function(){this._subgraphs=null,this._seg=new Hn,this._cga=new Gt,this._subgraphs=arguments[0]},In={DepthSegment:{configurable:!0}};ol.prototype.findStabbedSegments=function(){if(1===arguments.length){for(var a=arguments[0],h=new Ve,y=this._subgraphs.iterator();y.hasNext();){var x=y.next(),T=x.getEnvelope();a.y<T.getMinY()||a.y>T.getMaxY()||this.findStabbedSegments(a,x.getDirectedEdges(),h)}return h}if(3===arguments.length)if(At(arguments[2],rt)&&arguments[0]instanceof Q&&arguments[1]instanceof ss){for(var F=arguments[0],j=arguments[1],ce=arguments[2],ke=j.getEdge().getCoordinates(),ft=0;ft<ke.length-1;ft++)if(this._seg.p0=ke[ft],this._seg.p1=ke[ft+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<F.x||this._seg.isHorizontal()||F.y<this._seg.p0.y||F.y>this._seg.p1.y||Gt.computeOrientation(this._seg.p0,this._seg.p1,F)===Gt.RIGHT)){var Lt=j.getDepth(pn.LEFT);this._seg.p0.equals(ke[ft])||(Lt=j.getDepth(pn.RIGHT));var $t=new Ga(this._seg,Lt);ce.add($t)}}else if(At(arguments[2],rt)&&arguments[0]instanceof Q&&At(arguments[1],rt))for(var Pn=arguments[0],zn=arguments[2],qn=arguments[1].iterator();qn.hasNext();){var hi=qn.next();hi.isForward()&&this.findStabbedSegments(Pn,hi,zn)}},ol.prototype.getDepth=function(a){var h=this.findStabbedSegments(a);return 0===h.size()?0:nu.min(h)._leftDepth},ol.prototype.interfaces_=function(){return[]},ol.prototype.getClass=function(){return ol},In.DepthSegment.get=function(){return Ga},Object.defineProperties(ol,In);var Ga=function(){this._upwardSeg=null,this._leftDepth=null;var h=arguments[1];this._upwardSeg=new Hn(arguments[0]),this._leftDepth=h};Ga.prototype.compareTo=function(a){var h=a;if(this._upwardSeg.minX()>=h._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=h._upwardSeg.minX())return-1;var y=this._upwardSeg.orientationIndex(h._upwardSeg);return 0!==y||0!=(y=-1*h._upwardSeg.orientationIndex(this._upwardSeg))?y:this._upwardSeg.compareTo(h._upwardSeg)},Ga.prototype.compareX=function(a,h){var y=a.p0.compareTo(h.p0);return 0!==y?y:a.p1.compareTo(h.p1)},Ga.prototype.toString=function(){return this._upwardSeg.toString()},Ga.prototype.interfaces_=function(){return[ee]},Ga.prototype.getClass=function(){return Ga};var ui=function(a,h,y){this.p0=a||null,this.p1=h||null,this.p2=y||null};ui.prototype.area=function(){return ui.area(this.p0,this.p1,this.p2)},ui.prototype.signedArea=function(){return ui.signedArea(this.p0,this.p1,this.p2)},ui.prototype.interpolateZ=function(a){if(null===a)throw new re("Supplied point is null.");return ui.interpolateZ(a,this.p0,this.p1,this.p2)},ui.prototype.longestSideLength=function(){return ui.longestSideLength(this.p0,this.p1,this.p2)},ui.prototype.isAcute=function(){return ui.isAcute(this.p0,this.p1,this.p2)},ui.prototype.circumcentre=function(){return ui.circumcentre(this.p0,this.p1,this.p2)},ui.prototype.area3D=function(){return ui.area3D(this.p0,this.p1,this.p2)},ui.prototype.centroid=function(){return ui.centroid(this.p0,this.p1,this.p2)},ui.prototype.inCentre=function(){return ui.inCentre(this.p0,this.p1,this.p2)},ui.prototype.interfaces_=function(){return[]},ui.prototype.getClass=function(){return ui},ui.area=function(a,h,y){return Math.abs(((y.x-a.x)*(h.y-a.y)-(h.x-a.x)*(y.y-a.y))/2)},ui.signedArea=function(a,h,y){return((y.x-a.x)*(h.y-a.y)-(h.x-a.x)*(y.y-a.y))/2},ui.det=function(a,h,y,x){return a*x-h*y},ui.interpolateZ=function(a,h,y,x){var T=h.x,F=h.y,j=y.x-T,ce=x.x-T,ke=y.y-F,ft=x.y-F,Lt=j*ft-ce*ke,$t=a.x-T,Pn=a.y-F;return h.z+(ft*$t-ce*Pn)/Lt*(y.z-h.z)+(-ke*$t+j*Pn)/Lt*(x.z-h.z)},ui.longestSideLength=function(a,h,y){var x=a.distance(h),T=h.distance(y),F=y.distance(a),j=x;return T>j&&(j=T),F>j&&(j=F),j},ui.isAcute=function(a,h,y){return!!Dr.isAcute(a,h,y)&&!!Dr.isAcute(h,y,a)&&!!Dr.isAcute(y,a,h)},ui.circumcentre=function(a,h,y){var x=y.x,T=y.y,F=a.x-x,j=a.y-T,ce=h.x-x,ke=h.y-T,ft=2*ui.det(F,j,ce,ke),Lt=ui.det(j,F*F+j*j,ke,ce*ce+ke*ke),$t=ui.det(F,F*F+j*j,ce,ce*ce+ke*ke);return new Q(x-Lt/ft,T+$t/ft)},ui.perpendicularBisector=function(a,h){var y=h.x-a.x,x=h.y-a.y,T=new En(a.x+y/2,a.y+x/2,1),F=new En(a.x-x+y/2,a.y+y+x/2,1);return new En(T,F)},ui.angleBisector=function(a,h,y){var x=h.distance(a),T=x/(x+h.distance(y));return new Q(a.x+T*(y.x-a.x),a.y+T*(y.y-a.y))},ui.area3D=function(a,h,y){var x=h.x-a.x,T=h.y-a.y,F=h.z-a.z,j=y.x-a.x,ce=y.y-a.y,ke=y.z-a.z,ft=T*ke-F*ce,Lt=F*j-x*ke,$t=x*ce-T*j;return Math.sqrt(ft*ft+Lt*Lt+$t*$t)/2},ui.centroid=function(a,h,y){return new Q((a.x+h.x+y.x)/3,(a.y+h.y+y.y)/3)},ui.inCentre=function(a,h,y){var x=h.distance(y),T=a.distance(y),F=a.distance(h),j=x+T+F;return new Q((x*a.x+T*h.x+F*y.x)/j,(x*a.y+T*h.y+F*y.y)/j)};var Fs=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Ve;var h=arguments[1],y=arguments[2];this._inputGeom=arguments[0],this._distance=h,this._curveBuilder=y};Fs.prototype.addPoint=function(a){if(this._distance<=0)return null;var h=a.getCoordinates(),y=this._curveBuilder.getLineCurve(h,this._distance);this.addCurve(y,Ae.EXTERIOR,Ae.INTERIOR)},Fs.prototype.addPolygon=function(a){var h=this._distance,y=pn.LEFT;this._distance<0&&(h=-this._distance,y=pn.RIGHT);var x=a.getExteriorRing(),T=tt.removeRepeatedPoints(x.getCoordinates());if(this._distance<0&&this.isErodedCompletely(x,this._distance)||this._distance<=0&&T.length<3)return null;this.addPolygonRing(T,h,y,Ae.EXTERIOR,Ae.INTERIOR);for(var F=0;F<a.getNumInteriorRing();F++){var j=a.getInteriorRingN(F),ce=tt.removeRepeatedPoints(j.getCoordinates());this._distance>0&&this.isErodedCompletely(j,-this._distance)||this.addPolygonRing(ce,h,pn.opposite(y),Ae.INTERIOR,Ae.EXTERIOR)}},Fs.prototype.isTriangleErodedCompletely=function(a,h){var y=new ui(a[0],a[1],a[2]),x=y.inCentre();return Gt.distancePointLine(x,y.p0,y.p1)<Math.abs(h)},Fs.prototype.addLineString=function(a){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var h=tt.removeRepeatedPoints(a.getCoordinates()),y=this._curveBuilder.getLineCurve(h,this._distance);this.addCurve(y,Ae.EXTERIOR,Ae.INTERIOR)},Fs.prototype.addCurve=function(a,h,y){if(null===a||a.length<2)return null;var x=new vo(a,new fi(0,Ae.BOUNDARY,h,y));this._curveList.add(x)},Fs.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},Fs.prototype.addPolygonRing=function(a,h,y,x,T){if(0===h&&a.length<ta.MINIMUM_VALID_SIZE)return null;var F=x,j=T;a.length>=ta.MINIMUM_VALID_SIZE&&Gt.isCCW(a)&&(F=T,j=x,y=pn.opposite(y));var ce=this._curveBuilder.getRingCurve(a,y,h);this.addCurve(ce,F,j)},Fs.prototype.add=function(a){if(a.isEmpty())return null;a instanceof Jo?this.addPolygon(a):a instanceof To?this.addLineString(a):a instanceof Ko?this.addPoint(a):(a instanceof Sl||a instanceof du||a instanceof Gs||a instanceof ai)&&this.addCollection(a)},Fs.prototype.isErodedCompletely=function(a,h){var y=a.getCoordinates();if(y.length<4)return h<0;if(4===y.length)return this.isTriangleErodedCompletely(y,h);var x=a.getEnvelopeInternal(),T=Math.min(x.getHeight(),x.getWidth());return h<0&&2*Math.abs(h)>T},Fs.prototype.addCollection=function(a){for(var h=0;h<a.getNumGeometries();h++){var y=a.getGeometryN(h);this.add(y)}},Fs.prototype.interfaces_=function(){return[]},Fs.prototype.getClass=function(){return Fs};var hc=function(){};hc.prototype.locate=function(a){},hc.prototype.interfaces_=function(){return[]},hc.prototype.getClass=function(){return hc};var va=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var a=arguments[0];this._parent=a,this._atStart=!0,this._index=0,this._max=a.getNumGeometries()};va.prototype.next=function(){if(this._atStart)return this._atStart=!1,va.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new _e;var a=this._parent.getGeometryN(this._index++);return a instanceof ai?(this._subcollectionIterator=new va(a),this._subcollectionIterator.next()):a},va.prototype.remove=function(){throw new Error(this.getClass().getName())},va.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},va.prototype.interfaces_=function(){return[We]},va.prototype.getClass=function(){return va},va.isAtomic=function(a){return!(a instanceof ai)};var xa=function(){this._geom=null,this._geom=arguments[0]};xa.prototype.locate=function(a){return xa.locate(a,this._geom)},xa.prototype.interfaces_=function(){return[hc]},xa.prototype.getClass=function(){return xa},xa.isPointInRing=function(a,h){return!!h.getEnvelopeInternal().intersects(a)&&Gt.isPointInRing(a,h.getCoordinates())},xa.containsPointInPolygon=function(a,h){if(h.isEmpty())return!1;var y=h.getExteriorRing();if(!xa.isPointInRing(a,y))return!1;for(var x=0;x<h.getNumInteriorRing();x++){var T=h.getInteriorRingN(x);if(xa.isPointInRing(a,T))return!1}return!0},xa.containsPoint=function(a,h){if(h instanceof Jo)return xa.containsPointInPolygon(a,h);if(h instanceof ai)for(var y=new va(h);y.hasNext();){var x=y.next();if(x!==h&&xa.containsPoint(a,x))return!0}return!1},xa.locate=function(a,h){return h.isEmpty()?Ae.EXTERIOR:xa.containsPoint(a,h)?Ae.INTERIOR:Ae.EXTERIOR};var jo=function(){this._edgeMap=new dt,this._edgeList=null,this._ptInAreaLocation=[Ae.NONE,Ae.NONE]};jo.prototype.getNextCW=function(a){this.getEdges();var h=this._edgeList.indexOf(a),y=h-1;return 0===h&&(y=this._edgeList.size()-1),this._edgeList.get(y)},jo.prototype.propagateSideLabels=function(a){for(var h=Ae.NONE,y=this.iterator();y.hasNext();){var x=y.next().getLabel();x.isArea(a)&&x.getLocation(a,pn.LEFT)!==Ae.NONE&&(h=x.getLocation(a,pn.LEFT))}if(h===Ae.NONE)return null;for(var T=h,F=this.iterator();F.hasNext();){var j=F.next(),ce=j.getLabel();if(ce.getLocation(a,pn.ON)===Ae.NONE&&ce.setLocation(a,pn.ON,T),ce.isArea(a)){var ke=ce.getLocation(a,pn.LEFT),ft=ce.getLocation(a,pn.RIGHT);if(ft!==Ae.NONE){if(ft!==T)throw new Dn("side location conflict",j.getCoordinate());ke===Ae.NONE&&xe.shouldNeverReachHere("found single null side (at "+j.getCoordinate()+")"),T=ke}else xe.isTrue(ce.getLocation(a,pn.LEFT)===Ae.NONE,"found single null side"),ce.setLocation(a,pn.RIGHT,T),ce.setLocation(a,pn.LEFT,T)}}},jo.prototype.getCoordinate=function(){var a=this.iterator();return a.hasNext()?a.next().getCoordinate():null},jo.prototype.print=function(a){cn.out.println("EdgeEndStar:   "+this.getCoordinate());for(var h=this.iterator();h.hasNext();)h.next().print(a)},jo.prototype.isAreaLabelsConsistent=function(a){return this.computeEdgeEndLabels(a.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},jo.prototype.checkAreaLabelsConsistent=function(a){var h=this.getEdges();if(h.size()<=0)return!0;var y=h.size()-1,x=h.get(y).getLabel().getLocation(a,pn.LEFT);xe.isTrue(x!==Ae.NONE,"Found unlabelled area edge");for(var T=x,F=this.iterator();F.hasNext();){var j=F.next().getLabel();xe.isTrue(j.isArea(a),"Found non-area edge");var ce=j.getLocation(a,pn.LEFT),ke=j.getLocation(a,pn.RIGHT);if(ce===ke||ke!==T)return!1;T=ce}return!0},jo.prototype.findIndex=function(a){this.iterator();for(var h=0;h<this._edgeList.size();h++)if(this._edgeList.get(h)===a)return h;return-1},jo.prototype.iterator=function(){return this.getEdges().iterator()},jo.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new Ve(this._edgeMap.values())),this._edgeList},jo.prototype.getLocation=function(a,h,y){return this._ptInAreaLocation[a]===Ae.NONE&&(this._ptInAreaLocation[a]=xa.locate(h,y[a].getGeometry())),this._ptInAreaLocation[a]},jo.prototype.toString=function(){var a=new Fe;a.append("EdgeEndStar:   "+this.getCoordinate()),a.append("\n");for(var h=this.iterator();h.hasNext();){var y=h.next();a.append(y),a.append("\n")}return a.toString()},jo.prototype.computeEdgeEndLabels=function(a){for(var h=this.iterator();h.hasNext();)h.next().computeLabel(a)},jo.prototype.computeLabelling=function(a){this.computeEdgeEndLabels(a[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var h=[!1,!1],y=this.iterator();y.hasNext();)for(var x=y.next().getLabel(),T=0;T<2;T++)x.isLine(T)&&x.getLocation(T)===Ae.BOUNDARY&&(h[T]=!0);for(var F=this.iterator();F.hasNext();)for(var j=F.next(),ce=j.getLabel(),ke=0;ke<2;ke++)if(ce.isAnyNull(ke)){var ft=Ae.NONE;if(h[ke])ft=Ae.EXTERIOR;else{var Lt=j.getCoordinate();ft=this.getLocation(ke,Lt,a)}ce.setAllLocationsIfNull(ke,ft)}},jo.prototype.getDegree=function(){return this._edgeMap.size()},jo.prototype.insertEdgeEnd=function(a,h){this._edgeMap.put(a,h),this._edgeList=null},jo.prototype.interfaces_=function(){return[]},jo.prototype.getClass=function(){return jo};var sl=function(a){function h(){a.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var y=null,x=null,T=this._SCANNING_FOR_INCOMING,F=0;F<this._resultAreaEdgeList.size();F++){var j=this._resultAreaEdgeList.get(F),ce=j.getSym();if(j.getLabel().isArea())switch(null===y&&j.isInResult()&&(y=j),T){case this._SCANNING_FOR_INCOMING:if(!ce.isInResult())continue;x=ce,T=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!j.isInResult())continue;x.setNext(j),T=this._SCANNING_FOR_INCOMING}}if(T===this._LINKING_TO_OUTGOING){if(null===y)throw new Dn("no outgoing dirEdge found",this.getCoordinate());xe.isTrue(y.isInResult(),"unable to link last incoming dirEdge"),x.setNext(y)}},h.prototype.insert=function(y){this.insertEdgeEnd(y,y)},h.prototype.getRightmostEdge=function(){var y=this.getEdges(),x=y.size();if(x<1)return null;var T=y.get(0);if(1===x)return T;var F=y.get(x-1),j=T.getQuadrant(),ce=F.getQuadrant();return Kr.isNorthern(j)&&Kr.isNorthern(ce)?T:Kr.isNorthern(j)||Kr.isNorthern(ce)?0!==T.getDy()?T:0!==F.getDy()?F:(xe.shouldNeverReachHere("found two horizontal edges incident on node"),null):F},h.prototype.print=function(y){cn.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var x=this.iterator();x.hasNext();){var T=x.next();y.print("out "),T.print(y),y.println(),y.print("in "),T.getSym().print(y),y.println()}},h.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Ve;for(var y=this.iterator();y.hasNext();){var x=y.next();(x.isInResult()||x.getSym().isInResult())&&this._resultAreaEdgeList.add(x)}return this._resultAreaEdgeList},h.prototype.updateLabelling=function(y){for(var x=this.iterator();x.hasNext();){var T=x.next().getLabel();T.setAllLocationsIfNull(0,y.getLocation(0)),T.setAllLocationsIfNull(1,y.getLocation(1))}},h.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var y=null,x=null,T=this._edgeList.size()-1;T>=0;T--){var F=this._edgeList.get(T),j=F.getSym();null===x&&(x=j),null!==y&&j.setNext(y),y=F}x.setNext(y)},h.prototype.computeDepths=function(){if(1===arguments.length){var y=arguments[0],x=this.findIndex(y),T=y.getDepth(pn.LEFT),F=y.getDepth(pn.RIGHT),j=this.computeDepths(x+1,this._edgeList.size(),T);if(this.computeDepths(0,x,j)!==F)throw new Dn("depth mismatch at "+y.getCoordinate())}else if(3===arguments.length){for(var ke=arguments[1],ft=arguments[2],Lt=arguments[0];Lt<ke;Lt++){var $t=this._edgeList.get(Lt);$t.setEdgeDepths(pn.RIGHT,ft),ft=$t.getDepth(pn.LEFT)}return ft}},h.prototype.mergeSymLabels=function(){for(var y=this.iterator();y.hasNext();){var x=y.next();x.getLabel().merge(x.getSym().getLabel())}},h.prototype.linkMinimalDirectedEdges=function(y){for(var x=null,T=null,F=this._SCANNING_FOR_INCOMING,j=this._resultAreaEdgeList.size()-1;j>=0;j--){var ce=this._resultAreaEdgeList.get(j),ke=ce.getSym();switch(null===x&&ce.getEdgeRing()===y&&(x=ce),F){case this._SCANNING_FOR_INCOMING:if(ke.getEdgeRing()!==y)continue;T=ke,F=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(ce.getEdgeRing()!==y)continue;T.setNextMin(ce),F=this._SCANNING_FOR_INCOMING}}F===this._LINKING_TO_OUTGOING&&(xe.isTrue(null!==x,"found null for first outgoing dirEdge"),xe.isTrue(x.getEdgeRing()===y,"unable to link last incoming dirEdge"),T.setNextMin(x))},h.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var y=0,x=this.iterator();x.hasNext();)x.next().isInResult()&&y++;return y}if(1===arguments.length){for(var T=arguments[0],F=0,j=this.iterator();j.hasNext();)j.next().getEdgeRing()===T&&F++;return F}},h.prototype.getLabel=function(){return this._label},h.prototype.findCoveredLineEdges=function(){for(var y=Ae.NONE,x=this.iterator();x.hasNext();){var T=x.next(),F=T.getSym();if(!T.isLineEdge()){if(T.isInResult()){y=Ae.INTERIOR;break}if(F.isInResult()){y=Ae.EXTERIOR;break}}}if(y===Ae.NONE)return null;for(var j=y,ce=this.iterator();ce.hasNext();){var ke=ce.next(),ft=ke.getSym();ke.isLineEdge()?ke.getEdge().setCovered(j===Ae.INTERIOR):(ke.isInResult()&&(j=Ae.EXTERIOR),ft.isInResult()&&(j=Ae.INTERIOR))}},h.prototype.computeLabelling=function(y){a.prototype.computeLabelling.call(this,y),this._label=new fi(Ae.NONE);for(var x=this.iterator();x.hasNext();)for(var T=x.next().getEdge().getLabel(),F=0;F<2;F++){var j=T.getLocation(F);j!==Ae.INTERIOR&&j!==Ae.BOUNDARY||this._label.setLocation(F,Ae.INTERIOR)}},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(jo),ou=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.createNode=function(y){return new th(y,new sl)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Il),$s=function a(){this._pts=null,this._orientation=null;var h=arguments[0];this._pts=h,this._orientation=a.orientation(h)};$s.prototype.compareTo=function(a){return $s.compareOriented(this._pts,this._orientation,a._pts,a._orientation)},$s.prototype.interfaces_=function(){return[ee]},$s.prototype.getClass=function(){return $s},$s.orientation=function(a){return 1===tt.increasingDirection(a)},$s.compareOriented=function(a,h,y,x){for(var T=h?1:-1,F=x?1:-1,j=h?a.length:-1,ce=x?y.length:-1,ke=h?0:a.length-1,ft=x?0:y.length-1;;){var Lt=a[ke].compareTo(y[ft]);if(0!==Lt)return Lt;var $t=(ke+=T)===j,Pn=(ft+=F)===ce;if($t&&!Pn)return-1;if(!$t&&Pn)return 1;if($t&&Pn)return 0}};var Wr=function(){this._edges=new Ve,this._ocaMap=new dt};Wr.prototype.print=function(a){a.print("MULTILINESTRING ( ");for(var h=0;h<this._edges.size();h++){var y=this._edges.get(h);h>0&&a.print(","),a.print("(");for(var x=y.getCoordinates(),T=0;T<x.length;T++)T>0&&a.print(","),a.print(x[T].x+" "+x[T].y);a.println(")")}a.print(")  ")},Wr.prototype.addAll=function(a){for(var h=a.iterator();h.hasNext();)this.add(h.next())},Wr.prototype.findEdgeIndex=function(a){for(var h=0;h<this._edges.size();h++)if(this._edges.get(h).equals(a))return h;return-1},Wr.prototype.iterator=function(){return this._edges.iterator()},Wr.prototype.getEdges=function(){return this._edges},Wr.prototype.get=function(a){return this._edges.get(a)},Wr.prototype.findEqualEdge=function(a){var h=new $s(a.getCoordinates());return this._ocaMap.get(h)},Wr.prototype.add=function(a){this._edges.add(a);var h=new $s(a.getCoordinates());this._ocaMap.put(h,a)},Wr.prototype.interfaces_=function(){return[]},Wr.prototype.getClass=function(){return Wr};var _u=function(){};_u.prototype.processIntersections=function(a,h,y,x){},_u.prototype.isDone=function(){},_u.prototype.interfaces_=function(){return[]},_u.prototype.getClass=function(){return _u};var Bs=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0,this._li=arguments[0]};Bs.prototype.isTrivialIntersection=function(a,h,y,x){if(a===y&&1===this._li.getIntersectionNum()){if(Bs.isAdjacentSegments(h,x))return!0;if(a.isClosed()){var T=a.size()-1;if(0===h&&x===T||0===x&&h===T)return!0}}return!1},Bs.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Bs.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Bs.prototype.getLineIntersector=function(){return this._li},Bs.prototype.hasProperIntersection=function(){return this._hasProper},Bs.prototype.processIntersections=function(a,h,y,x){if(a===y&&h===x)return null;this.numTests++;var T=a.getCoordinates()[h],F=a.getCoordinates()[h+1],j=y.getCoordinates()[x],ce=y.getCoordinates()[x+1];this._li.computeIntersection(T,F,j,ce),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(a,h,y,x)||(this._hasIntersection=!0,a.addIntersections(this._li,h,0),y.addIntersections(this._li,x,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Bs.prototype.hasIntersection=function(){return this._hasIntersection},Bs.prototype.isDone=function(){return!1},Bs.prototype.hasInteriorIntersection=function(){return this._hasInterior},Bs.prototype.interfaces_=function(){return[_u]},Bs.prototype.getClass=function(){return Bs},Bs.isAdjacentSegments=function(a,h){return 1===Math.abs(a-h)};var $a=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var h=arguments[1],y=arguments[2];this.coord=new Q(arguments[0]),this.segmentIndex=h,this.dist=y};$a.prototype.getSegmentIndex=function(){return this.segmentIndex},$a.prototype.getCoordinate=function(){return this.coord},$a.prototype.print=function(a){a.print(this.coord),a.print(" seg # = "+this.segmentIndex),a.println(" dist = "+this.dist)},$a.prototype.compareTo=function(a){return this.compare(a.segmentIndex,a.dist)},$a.prototype.isEndPoint=function(a){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===a},$a.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},$a.prototype.getDistance=function(){return this.dist},$a.prototype.compare=function(a,h){return this.segmentIndex<a?-1:this.segmentIndex>a?1:this.dist<h?-1:this.dist>h?1:0},$a.prototype.interfaces_=function(){return[ee]},$a.prototype.getClass=function(){return $a};var vu=function(){this._nodeMap=new dt,this.edge=null,this.edge=arguments[0]};vu.prototype.print=function(a){a.println("Intersections:");for(var h=this.iterator();h.hasNext();)h.next().print(a)},vu.prototype.iterator=function(){return this._nodeMap.values().iterator()},vu.prototype.addSplitEdges=function(a){this.addEndpoints();for(var h=this.iterator(),y=h.next();h.hasNext();){var x=h.next(),T=this.createSplitEdge(y,x);a.add(T),y=x}},vu.prototype.addEndpoints=function(){var a=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[a],a,0)},vu.prototype.createSplitEdge=function(a,h){var y=h.segmentIndex-a.segmentIndex+2,T=h.dist>0||!h.coord.equals2D(this.edge.pts[h.segmentIndex]);T||y--;var F=new Array(y).fill(null),j=0;F[j++]=new Q(a.coord);for(var ce=a.segmentIndex+1;ce<=h.segmentIndex;ce++)F[j++]=this.edge.pts[ce];return T&&(F[j]=h.coord),new al(F,new fi(this.edge._label))},vu.prototype.add=function(a,h,y){var x=new $a(a,h,y),T=this._nodeMap.get(x);return null!==T?T:(this._nodeMap.put(x,x),x)},vu.prototype.isIntersection=function(a){for(var h=this.iterator();h.hasNext();)if(h.next().coord.equals(a))return!0;return!1},vu.prototype.interfaces_=function(){return[]},vu.prototype.getClass=function(){return vu};var Aa=function(){};Aa.prototype.getChainStartIndices=function(a){var h=0,y=new Ve;y.add(new at(h));do{var x=this.findChainEnd(a,h);y.add(new at(x)),h=x}while(h<a.length-1);return Aa.toIntArray(y)},Aa.prototype.findChainEnd=function(a,h){for(var y=Kr.quadrant(a[h],a[h+1]),x=h+1;x<a.length&&Kr.quadrant(a[x-1],a[x])===y;)x++;return x-1},Aa.prototype.interfaces_=function(){return[]},Aa.prototype.getClass=function(){return Aa},Aa.toIntArray=function(a){for(var h=new Array(a.size()).fill(null),y=0;y<h.length;y++)h[y]=a.get(y).intValue();return h};var sa=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new sn,this.env2=new sn;var a=arguments[0];this.e=a,this.pts=a.getCoordinates();var h=new Aa;this.startIndex=h.getChainStartIndices(this.pts)};sa.prototype.getCoordinates=function(){return this.pts},sa.prototype.getMaxX=function(a){var h=this.pts[this.startIndex[a]].x,y=this.pts[this.startIndex[a+1]].x;return h>y?h:y},sa.prototype.getMinX=function(a){var h=this.pts[this.startIndex[a]].x,y=this.pts[this.startIndex[a+1]].x;return h<y?h:y},sa.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var a=arguments[0],h=arguments[1],y=arguments[2];this.computeIntersectsForChain(this.startIndex[a],this.startIndex[a+1],h,h.startIndex[y],h.startIndex[y+1],arguments[3])}else if(6===arguments.length){var T=arguments[0],F=arguments[1],j=arguments[2],ce=arguments[3],ke=arguments[4],ft=arguments[5],Lt=this.pts[T],$t=this.pts[F],Pn=j.pts[ce],Mn=j.pts[ke];if(F-T==1&&ke-ce==1)return ft.addIntersections(this.e,T,j.e,ce),null;if(this.env1.init(Lt,$t),this.env2.init(Pn,Mn),!this.env1.intersects(this.env2))return null;var zn=Math.trunc((T+F)/2),qn=Math.trunc((ce+ke)/2);T<zn&&(ce<qn&&this.computeIntersectsForChain(T,zn,j,ce,qn,ft),qn<ke&&this.computeIntersectsForChain(T,zn,j,qn,ke,ft)),zn<F&&(ce<qn&&this.computeIntersectsForChain(zn,F,j,ce,qn,ft),qn<ke&&this.computeIntersectsForChain(zn,F,j,qn,ke,ft))}},sa.prototype.getStartIndexes=function(){return this.startIndex},sa.prototype.computeIntersects=function(a,h){for(var y=0;y<this.startIndex.length-1;y++)for(var x=0;x<a.startIndex.length-1;x++)this.computeIntersectsForChain(y,a,x,h)},sa.prototype.interfaces_=function(){return[]},sa.prototype.getClass=function(){return sa};var Wo=function a(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var h=0;h<2;h++)for(var y=0;y<3;y++)this._depth[h][y]=a.NULL_VALUE},rh={NULL_VALUE:{configurable:!0}};Wo.prototype.getDepth=function(a,h){return this._depth[a][h]},Wo.prototype.setDepth=function(a,h,y){this._depth[a][h]=y},Wo.prototype.isNull=function(){if(0===arguments.length){for(var a=0;a<2;a++)for(var h=0;h<3;h++)if(this._depth[a][h]!==Wo.NULL_VALUE)return!1;return!0}return 1===arguments.length?this._depth[arguments[0]][1]===Wo.NULL_VALUE:2===arguments.length?this._depth[arguments[0]][arguments[1]]===Wo.NULL_VALUE:void 0},Wo.prototype.normalize=function(){for(var a=0;a<2;a++)if(!this.isNull(a)){var h=this._depth[a][1];this._depth[a][2]<h&&(h=this._depth[a][2]),h<0&&(h=0);for(var y=1;y<3;y++){var x=0;this._depth[a][y]>h&&(x=1),this._depth[a][y]=x}}},Wo.prototype.getDelta=function(a){return this._depth[a][pn.RIGHT]-this._depth[a][pn.LEFT]},Wo.prototype.getLocation=function(a,h){return this._depth[a][h]<=0?Ae.EXTERIOR:Ae.INTERIOR},Wo.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},Wo.prototype.add=function(){if(1===arguments.length)for(var a=arguments[0],h=0;h<2;h++)for(var y=1;y<3;y++){var x=a.getLocation(h,y);x!==Ae.EXTERIOR&&x!==Ae.INTERIOR||(this.isNull(h,y)?this._depth[h][y]=Wo.depthAtLocation(x):this._depth[h][y]+=Wo.depthAtLocation(x))}else 3===arguments.length&&arguments[2]===Ae.INTERIOR&&this._depth[arguments[0]][arguments[1]]++},Wo.prototype.interfaces_=function(){return[]},Wo.prototype.getClass=function(){return Wo},Wo.depthAtLocation=function(a){return a===Ae.EXTERIOR?0:a===Ae.INTERIOR?1:Wo.NULL_VALUE},rh.NULL_VALUE.get=function(){return-1},Object.defineProperties(Wo,rh);var al=function(a){function h(){if(a.call(this),this.pts=null,this._env=null,this.eiList=new vu(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Wo,this._depthDelta=0,1===arguments.length)h.call(this,arguments[0],null);else if(2===arguments.length){var T=arguments[1];this.pts=arguments[0],this._label=T}}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.getDepth=function(){return this._depth},h.prototype.getCollapsedEdge=function(){var y=new Array(2).fill(null);return y[0]=this.pts[0],y[1]=this.pts[1],new h(y,fi.toLineLabel(this._label))},h.prototype.isIsolated=function(){return this._isIsolated},h.prototype.getCoordinates=function(){return this.pts},h.prototype.setIsolated=function(y){this._isIsolated=y},h.prototype.setName=function(y){this._name=y},h.prototype.equals=function(y){if(!(y instanceof h))return!1;var x=y;if(this.pts.length!==x.pts.length)return!1;for(var T=!0,F=!0,j=this.pts.length,ce=0;ce<this.pts.length;ce++)if(this.pts[ce].equals2D(x.pts[ce])||(T=!1),this.pts[ce].equals2D(x.pts[--j])||(F=!1),!T&&!F)return!1;return!0},h.prototype.getCoordinate=function(){return 0===arguments.length?this.pts.length>0?this.pts[0]:null:1===arguments.length?this.pts[arguments[0]]:void 0},h.prototype.print=function(y){y.print("edge "+this._name+": "),y.print("LINESTRING (");for(var x=0;x<this.pts.length;x++)x>0&&y.print(","),y.print(this.pts[x].x+" "+this.pts[x].y);y.print(")  "+this._label+" "+this._depthDelta)},h.prototype.computeIM=function(y){h.updateIM(this._label,y)},h.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},h.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},h.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},h.prototype.getDepthDelta=function(){return this._depthDelta},h.prototype.getNumPoints=function(){return this.pts.length},h.prototype.printReverse=function(y){y.print("edge "+this._name+": ");for(var x=this.pts.length-1;x>=0;x--)y.print(this.pts[x]+" ");y.println("")},h.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new sa(this)),this._mce},h.prototype.getEnvelope=function(){if(null===this._env){this._env=new sn;for(var y=0;y<this.pts.length;y++)this._env.expandToInclude(this.pts[y])}return this._env},h.prototype.addIntersection=function(y,x,T,F){var j=new Q(y.getIntersection(F)),ce=x,ke=y.getEdgeDistance(T,F),ft=ce+1;ft<this.pts.length&&j.equals2D(this.pts[ft])&&(ce=ft,ke=0),this.eiList.add(j,ce,ke)},h.prototype.toString=function(){var y=new Fe;y.append("edge "+this._name+": "),y.append("LINESTRING (");for(var x=0;x<this.pts.length;x++)x>0&&y.append(","),y.append(this.pts[x].x+" "+this.pts[x].y);return y.append(")  "+this._label+" "+this._depthDelta),y.toString()},h.prototype.isPointwiseEqual=function(y){if(this.pts.length!==y.pts.length)return!1;for(var x=0;x<this.pts.length;x++)if(!this.pts[x].equals2D(y.pts[x]))return!1;return!0},h.prototype.setDepthDelta=function(y){this._depthDelta=y},h.prototype.getEdgeIntersectionList=function(){return this.eiList},h.prototype.addIntersections=function(y,x,T){for(var F=0;F<y.getIntersectionNum();F++)this.addIntersection(y,x,T,F)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.updateIM=function(){if(2!==arguments.length)return a.prototype.updateIM.apply(this,arguments);var y=arguments[0],x=arguments[1];x.setAtLeastIfValid(y.getLocation(0,pn.ON),y.getLocation(1,pn.ON),1),y.isArea()&&(x.setAtLeastIfValid(y.getLocation(0,pn.LEFT),y.getLocation(1,pn.LEFT),2),x.setAtLeastIfValid(y.getLocation(0,pn.RIGHT),y.getLocation(1,pn.RIGHT),2))},h}(yo),Ms=function(a){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Wr,this._bufParams=a||null};Ms.prototype.setWorkingPrecisionModel=function(a){this._workingPrecisionModel=a},Ms.prototype.insertUniqueEdge=function(a){var h=this._edgeList.findEqualEdge(a);if(null!==h){var y=h.getLabel(),x=a.getLabel();h.isPointwiseEqual(a)||(x=new fi(a.getLabel())).flip(),y.merge(x);var T=Ms.depthDelta(x),F=h.getDepthDelta()+T;h.setDepthDelta(F)}else this._edgeList.add(a),a.setDepthDelta(Ms.depthDelta(a.getLabel()))},Ms.prototype.buildSubgraphs=function(a,h){for(var y=new Ve,x=a.iterator();x.hasNext();){var T=x.next(),F=T.getRightmostCoordinate(),j=new ol(y).getDepth(F);T.computeDepth(j),T.findResultEdges(),y.add(T),h.add(T.getDirectedEdges(),T.getNodes())}},Ms.prototype.createSubgraphs=function(a){for(var h=new Ve,y=a.getNodes().iterator();y.hasNext();){var x=y.next();if(!x.isVisited()){var T=new Yn;T.create(x),h.add(T)}}return nu.sort(h,nu.reverseOrder()),h},Ms.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},Ms.prototype.getNoder=function(a){if(null!==this._workingNoder)return this._workingNoder;var h=new Oh,y=new Vt;return y.setPrecisionModel(a),h.setSegmentIntersector(new Bs(y)),h},Ms.prototype.buffer=function(a,h){var y=this._workingPrecisionModel;null===y&&(y=a.getPrecisionModel()),this._geomFact=a.getFactory();var x=new Wn(y,this._bufParams),T=new Fs(a,h,x).getCurves();if(T.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(T,y),this._graph=new Do(new ou),this._graph.addEdges(this._edgeList.getEdges());var F=this.createSubgraphs(this._graph),j=new xs(this._geomFact);this.buildSubgraphs(F,j);var ce=j.getPolygons();return ce.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(ce)},Ms.prototype.computeNodedEdges=function(a,h){var y=this.getNoder(h);y.computeNodes(a);for(var x=y.getNodedSubstrings().iterator();x.hasNext();){var T=x.next(),F=T.getCoordinates();if(2!==F.length||!F[0].equals2D(F[1])){var j=T.getData(),ce=new al(T.getCoordinates(),new fi(j));this.insertUniqueEdge(ce)}}},Ms.prototype.setNoder=function(a){this._workingNoder=a},Ms.prototype.interfaces_=function(){return[]},Ms.prototype.getClass=function(){return Ms},Ms.depthDelta=function(a){var h=a.getLocation(0,pn.LEFT),y=a.getLocation(0,pn.RIGHT);return h===Ae.INTERIOR&&y===Ae.EXTERIOR?1:h===Ae.EXTERIOR&&y===Ae.INTERIOR?-1:0},Ms.convertSegStrings=function(a){for(var h=new Bn,y=new Ve;a.hasNext();){var x=a.next(),T=h.createLineString(x.getCoordinates());y.add(T)}return h.buildGeometry(y)};var qs=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var h=arguments[1];this._noder=arguments[0],this._scaleFactor=h,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var x=arguments[1],T=arguments[2],F=arguments[3];this._noder=arguments[0],this._scaleFactor=x,this._offsetX=T,this._offsetY=F,this._isScaled=!this.isIntegerPrecision()}};qs.prototype.rescale=function(){if(At(arguments[0],ye))for(var a=arguments[0].iterator();a.hasNext();){var h=a.next();this.rescale(h.getCoordinates())}else if(arguments[0]instanceof Array){for(var y=arguments[0],x=0;x<y.length;x++)y[x].x=y[x].x/this._scaleFactor+this._offsetX,y[x].y=y[x].y/this._scaleFactor+this._offsetY;2===y.length&&y[0].equals2D(y[1])&&cn.out.println(y)}},qs.prototype.scale=function(){if(At(arguments[0],ye)){for(var a=arguments[0],h=new Ve,y=a.iterator();y.hasNext();){var x=y.next();h.add(new vo(this.scale(x.getCoordinates()),x.getData()))}return h}if(arguments[0]instanceof Array){for(var T=arguments[0],F=new Array(T.length).fill(null),j=0;j<T.length;j++)F[j]=new Q(Math.round((T[j].x-this._offsetX)*this._scaleFactor),Math.round((T[j].y-this._offsetY)*this._scaleFactor),T[j].z);return tt.removeRepeatedPoints(F)}},qs.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},qs.prototype.getNodedSubstrings=function(){var a=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(a),a},qs.prototype.computeNodes=function(a){var h=a;this._isScaled&&(h=this.scale(a)),this._noder.computeNodes(h)},qs.prototype.interfaces_=function(){return[Ml]},qs.prototype.getClass=function(){return qs};var Hs=function(){this._li=new Vt,this._segStrings=null,this._segStrings=arguments[0]},ih={fact:{configurable:!0}};Hs.prototype.checkEndPtVertexIntersections=function(){if(0===arguments.length)for(var a=this._segStrings.iterator();a.hasNext();){var h=a.next().getCoordinates();this.checkEndPtVertexIntersections(h[0],this._segStrings),this.checkEndPtVertexIntersections(h[h.length-1],this._segStrings)}else if(2===arguments.length)for(var y=arguments[0],x=arguments[1].iterator();x.hasNext();)for(var T=x.next().getCoordinates(),F=1;F<T.length-1;F++)if(T[F].equals(y))throw new Te("found endpt/interior pt intersection at index "+F+" :pt "+y)},Hs.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var a=this._segStrings.iterator();a.hasNext();)for(var h=a.next(),y=this._segStrings.iterator();y.hasNext();){var x=y.next();this.checkInteriorIntersections(h,x)}else if(2===arguments.length)for(var T=arguments[0],F=arguments[1],j=T.getCoordinates(),ce=F.getCoordinates(),ke=0;ke<j.length-1;ke++)for(var ft=0;ft<ce.length-1;ft++)this.checkInteriorIntersections(T,ke,F,ft);else if(4===arguments.length){var Lt=arguments[0],$t=arguments[1],Pn=arguments[2],Mn=arguments[3];if(Lt===Pn&&$t===Mn)return null;var zn=Lt.getCoordinates()[$t],qn=Lt.getCoordinates()[$t+1],hi=Pn.getCoordinates()[Mn],Sn=Pn.getCoordinates()[Mn+1];if(this._li.computeIntersection(zn,qn,hi,Sn),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,zn,qn)||this.hasInteriorIntersection(this._li,hi,Sn)))throw new Te("found non-noded intersection at "+zn+"-"+qn+" and "+hi+"-"+Sn)}},Hs.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},Hs.prototype.checkCollapses=function(){if(0===arguments.length)for(var a=this._segStrings.iterator();a.hasNext();){var h=a.next();this.checkCollapses(h)}else if(1===arguments.length)for(var y=arguments[0].getCoordinates(),x=0;x<y.length-2;x++)this.checkCollapse(y[x],y[x+1],y[x+2])},Hs.prototype.hasInteriorIntersection=function(a,h,y){for(var x=0;x<a.getIntersectionNum();x++){var T=a.getIntersection(x);if(!T.equals(h)&&!T.equals(y))return!0}return!1},Hs.prototype.checkCollapse=function(a,h,y){if(a.equals(y))throw new Te("found non-noded collapse at "+Hs.fact.createLineString([a,h,y]))},Hs.prototype.interfaces_=function(){return[]},Hs.prototype.getClass=function(){return Hs},ih.fact.get=function(){return new Bn},Object.defineProperties(Hs,ih);var Ds=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var a=arguments[0],h=arguments[1],y=arguments[2];if(this._originalPt=a,this._pt=a,this._scaleFactor=h,this._li=y,h<=0)throw new re("Scale factor must be non-zero");1!==h&&(this._pt=new Q(this.scale(a.x),this.scale(a.y)),this._p0Scaled=new Q,this._p1Scaled=new Q),this.initCorners(this._pt)},xf={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};Ds.prototype.intersectsScaled=function(a,h){var y=Math.min(a.x,h.x),x=Math.max(a.x,h.x),T=Math.min(a.y,h.y),F=Math.max(a.y,h.y),j=this._maxx<y||this._minx>x||this._maxy<T||this._miny>F;if(j)return!1;var ce=this.intersectsToleranceSquare(a,h);return xe.isTrue(!(j&&ce),"Found bad envelope test"),ce},Ds.prototype.initCorners=function(a){this._minx=a.x-.5,this._maxx=a.x+.5,this._miny=a.y-.5,this._maxy=a.y+.5,this._corner[0]=new Q(this._maxx,this._maxy),this._corner[1]=new Q(this._minx,this._maxy),this._corner[2]=new Q(this._minx,this._miny),this._corner[3]=new Q(this._maxx,this._miny)},Ds.prototype.intersects=function(a,h){return 1===this._scaleFactor?this.intersectsScaled(a,h):(this.copyScaled(a,this._p0Scaled),this.copyScaled(h,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},Ds.prototype.scale=function(a){return Math.round(a*this._scaleFactor)},Ds.prototype.getCoordinate=function(){return this._originalPt},Ds.prototype.copyScaled=function(a,h){h.x=this.scale(a.x),h.y=this.scale(a.y)},Ds.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var a=Ds.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new sn(this._originalPt.x-a,this._originalPt.x+a,this._originalPt.y-a,this._originalPt.y+a)}return this._safeEnv},Ds.prototype.intersectsPixelClosure=function(a,h){return this._li.computeIntersection(a,h,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(a,h,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(a,h,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(a,h,this._corner[3],this._corner[0]),this._li.hasIntersection()))))},Ds.prototype.intersectsToleranceSquare=function(a,h){var y=!1,x=!1;return this._li.computeIntersection(a,h,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(a,h,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(y=!0),this._li.computeIntersection(a,h,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(x=!0),this._li.computeIntersection(a,h,this._corner[3],this._corner[0]),this._li.isProper()||y&&x||a.equals(this._pt)||h.equals(this._pt)))))},Ds.prototype.addSnappedNode=function(a,h){var y=a.getCoordinate(h),x=a.getCoordinate(h+1);return!!this.intersects(y,x)&&(a.addIntersection(this.getCoordinate(),h),!0)},Ds.prototype.interfaces_=function(){return[]},Ds.prototype.getClass=function(){return Ds},xf.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(Ds,xf);var Yl=function(){this.tempEnv1=new sn,this.selectedSegment=new Hn};Yl.prototype.select=function(){1!==arguments.length&&2===arguments.length&&(arguments[0].getLineSegment(arguments[1],this.selectedSegment),this.select(this.selectedSegment))},Yl.prototype.interfaces_=function(){return[]},Yl.prototype.getClass=function(){return Yl};var Pc=function(){this._index=null,this._index=arguments[0]},kh={HotPixelSnapAction:{configurable:!0}};Pc.prototype.snap=function(){if(1===arguments.length)return this.snap(arguments[0],null,-1);if(3===arguments.length){var h=arguments[0],y=arguments[1],x=arguments[2],T=h.getSafeEnvelope(),F=new qa(h,y,x);return this._index.query(T,{interfaces_:function(){return[Ao]},visitItem:function(j){j.select(T,F)}}),F.isNodeAdded()}},Pc.prototype.interfaces_=function(){return[]},Pc.prototype.getClass=function(){return Pc},kh.HotPixelSnapAction.get=function(){return qa},Object.defineProperties(Pc,kh);var qa=function(a){function h(){a.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var x=arguments[1],T=arguments[2];this._hotPixel=arguments[0],this._parentEdge=x,this._hotPixelVertexIndex=T}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.isNodeAdded=function(){return this._isNodeAdded},h.prototype.select=function(){if(2!==arguments.length)return a.prototype.select.apply(this,arguments);var x=arguments[1],T=arguments[0].getContext();if(null!==this._parentEdge&&T===this._parentEdge&&x===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(T,x)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Yl),Wu=function(){this._li=null,this._interiorIntersections=null,this._li=arguments[0],this._interiorIntersections=new Ve};Wu.prototype.processIntersections=function(a,h,y,x){if(a===y&&h===x)return null;var T=a.getCoordinates()[h],F=a.getCoordinates()[h+1],j=y.getCoordinates()[x],ce=y.getCoordinates()[x+1];if(this._li.computeIntersection(T,F,j,ce),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var ke=0;ke<this._li.getIntersectionNum();ke++)this._interiorIntersections.add(this._li.getIntersection(ke));a.addIntersections(this._li,h,0),y.addIntersections(this._li,x,1)}},Wu.prototype.isDone=function(){return!1},Wu.prototype.getInteriorIntersections=function(){return this._interiorIntersections},Wu.prototype.interfaces_=function(){return[_u]},Wu.prototype.getClass=function(){return Wu};var xu=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var a=arguments[0];this._pm=a,this._li=new Vt,this._li.setPrecisionModel(a),this._scaleFactor=a.getScale()};xu.prototype.checkCorrectness=function(a){var h=vo.getNodedSubstrings(a),y=new Hs(h);try{y.checkValid()}catch(x){if(!(x instanceof _n))throw x;x.printStackTrace()}},xu.prototype.getNodedSubstrings=function(){return vo.getNodedSubstrings(this._nodedSegStrings)},xu.prototype.snapRound=function(a,h){var y=this.findInteriorIntersections(a,h);this.computeIntersectionSnaps(y),this.computeVertexSnaps(a)},xu.prototype.findInteriorIntersections=function(a,h){var y=new Wu(h);return this._noder.setSegmentIntersector(y),this._noder.computeNodes(a),y.getInteriorIntersections()},xu.prototype.computeVertexSnaps=function(){if(At(arguments[0],ye))for(var a=arguments[0].iterator();a.hasNext();){var h=a.next();this.computeVertexSnaps(h)}else if(arguments[0]instanceof vo)for(var y=arguments[0],x=y.getCoordinates(),T=0;T<x.length;T++){var F=new Ds(x[T],this._scaleFactor,this._li);this._pointSnapper.snap(F,y,T)&&y.addIntersection(x[T],T)}},xu.prototype.computeNodes=function(a){this._nodedSegStrings=a,this._noder=new Oh,this._pointSnapper=new Pc(this._noder.getIndex()),this.snapRound(a,this._li)},xu.prototype.computeIntersectionSnaps=function(a){for(var h=a.iterator();h.hasNext();){var y=h.next(),x=new Ds(y,this._scaleFactor,this._li);this._pointSnapper.snap(x)}},xu.prototype.interfaces_=function(){return[Ml]},xu.prototype.getClass=function(){return xu};var ws=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new ri,this._resultGeometry=null,this._saveException=null,1===arguments.length)this._argGeom=arguments[0];else if(2===arguments.length){var y=arguments[1];this._argGeom=arguments[0],this._bufParams=y}},Rc={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};ws.prototype.bufferFixedPrecision=function(a){var h=new qs(new xu(new nn(1)),a.getScale()),y=new Ms(this._bufParams);y.setWorkingPrecisionModel(a),y.setNoder(h),this._resultGeometry=y.buffer(this._argGeom,this._distance)},ws.prototype.bufferReducedPrecision=function(){var a=this;if(0===arguments.length){for(var h=ws.MAX_PRECISION_DIGITS;h>=0;h--){try{a.bufferReducedPrecision(h)}catch(F){if(!(F instanceof Dn))throw F;a._saveException=F}if(null!==a._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var x=ws.precisionScaleFactor(this._argGeom,this._distance,arguments[0]),T=new nn(x);this.bufferFixedPrecision(T)}},ws.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var a=this._argGeom.getFactory().getPrecisionModel();a.getType()===nn.FIXED?this.bufferFixedPrecision(a):this.bufferReducedPrecision()},ws.prototype.setQuadrantSegments=function(a){this._bufParams.setQuadrantSegments(a)},ws.prototype.bufferOriginalPrecision=function(){try{var a=new Ms(this._bufParams);this._resultGeometry=a.buffer(this._argGeom,this._distance)}catch(h){if(!(h instanceof Te))throw h;this._saveException=h}},ws.prototype.getResultGeometry=function(a){return this._distance=a,this.computeGeometry(),this._resultGeometry},ws.prototype.setEndCapStyle=function(a){this._bufParams.setEndCapStyle(a)},ws.prototype.interfaces_=function(){return[]},ws.prototype.getClass=function(){return ws},ws.bufferOp=function(){if(2===arguments.length){var h=arguments[1];return new ws(arguments[0]).getResultGeometry(h)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Tn&&"number"==typeof arguments[1]){var x=arguments[1],T=arguments[2],F=new ws(arguments[0]);return F.setQuadrantSegments(T),F.getResultGeometry(x)}if(arguments[2]instanceof ri&&arguments[0]instanceof Tn&&"number"==typeof arguments[1]){var ce=arguments[1];return new ws(arguments[0],arguments[2]).getResultGeometry(ce)}}else if(4===arguments.length){var Lt=arguments[1],$t=arguments[2],Pn=arguments[3],Mn=new ws(arguments[0]);return Mn.setQuadrantSegments($t),Mn.setEndCapStyle(Pn),Mn.getResultGeometry(Lt)}},ws.precisionScaleFactor=function(a,h,y){var x=a.getEnvelopeInternal(),T=De.max(Math.abs(x.getMaxX()),Math.abs(x.getMaxY()),Math.abs(x.getMinX()),Math.abs(x.getMinY()))+2*(h>0?h:0),F=y-Math.trunc(Math.log(T)/Math.log(10)+1);return Math.pow(10,F)},Rc.CAP_ROUND.get=function(){return ri.CAP_ROUND},Rc.CAP_BUTT.get=function(){return ri.CAP_FLAT},Rc.CAP_FLAT.get=function(){return ri.CAP_FLAT},Rc.CAP_SQUARE.get=function(){return ri.CAP_SQUARE},Rc.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(ws,Rc);var zs=function(){this._pt=[new Q,new Q],this._distance=Y.NaN,this._isNull=!0};zs.prototype.getCoordinates=function(){return this._pt},zs.prototype.getCoordinate=function(a){return this._pt[a]},zs.prototype.setMinimum=function(){if(1===arguments.length){var a=arguments[0];this.setMinimum(a._pt[0],a._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var x=h.distance(y);x<this._distance&&this.initialize(h,y,x)}},zs.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var a=arguments[0],h=arguments[1];this._pt[0].setCoordinate(a),this._pt[1].setCoordinate(h),this._distance=a.distance(h),this._isNull=!1}else if(3===arguments.length){var x=arguments[1],T=arguments[2];this._pt[0].setCoordinate(arguments[0]),this._pt[1].setCoordinate(x),this._distance=T,this._isNull=!1}},zs.prototype.getDistance=function(){return this._distance},zs.prototype.setMaximum=function(){if(1===arguments.length){var a=arguments[0];this.setMaximum(a._pt[0],a._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var x=h.distance(y);x>this._distance&&this.initialize(h,y,x)}},zs.prototype.interfaces_=function(){return[]},zs.prototype.getClass=function(){return zs};var Ru=function(){};Ru.prototype.interfaces_=function(){return[]},Ru.prototype.getClass=function(){return Ru},Ru.computeDistance=function(){if(arguments[2]instanceof zs&&arguments[0]instanceof To&&arguments[1]instanceof Q)for(var h=arguments[1],y=arguments[2],x=arguments[0].getCoordinates(),T=new Hn,F=0;F<x.length-1;F++){T.setCoordinates(x[F],x[F+1]);var j=T.closestPoint(h);y.setMinimum(j,h)}else if(arguments[2]instanceof zs&&arguments[0]instanceof Jo&&arguments[1]instanceof Q){var ce=arguments[0],ke=arguments[1],ft=arguments[2];Ru.computeDistance(ce.getExteriorRing(),ke,ft);for(var Lt=0;Lt<ce.getNumInteriorRing();Lt++)Ru.computeDistance(ce.getInteriorRingN(Lt),ke,ft)}else if(arguments[2]instanceof zs&&arguments[0]instanceof Tn&&arguments[1]instanceof Q){var $t=arguments[0],Pn=arguments[1],Mn=arguments[2];if($t instanceof To)Ru.computeDistance($t,Pn,Mn);else if($t instanceof Jo)Ru.computeDistance($t,Pn,Mn);else if($t instanceof ai)for(var zn=$t,qn=0;qn<zn.getNumGeometries();qn++){var hi=zn.getGeometryN(qn);Ru.computeDistance(hi,Pn,Mn)}else Mn.setMinimum($t.getCoordinate(),Pn)}else if(arguments[2]instanceof zs&&arguments[0]instanceof Hn&&arguments[1]instanceof Q){var bs=arguments[1],au=arguments[2],uu=arguments[0].closestPoint(bs);au.setMinimum(uu,bs)}};var wu=function(a){this._maxPtDist=new zs,this._inputGeom=a||null},Fh={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};wu.prototype.computeMaxMidpointDistance=function(a){var h=new ll(this._inputGeom);a.apply(h),this._maxPtDist.setMaximum(h.getMaxPointDistance())},wu.prototype.computeMaxVertexDistance=function(a){var h=new ul(this._inputGeom);a.apply(h),this._maxPtDist.setMaximum(h.getMaxPointDistance())},wu.prototype.findDistance=function(a){return this.computeMaxVertexDistance(a),this.computeMaxMidpointDistance(a),this._maxPtDist.getDistance()},wu.prototype.getDistancePoints=function(){return this._maxPtDist},wu.prototype.interfaces_=function(){return[]},wu.prototype.getClass=function(){return wu},Fh.MaxPointDistanceFilter.get=function(){return ul},Fh.MaxMidpointDistanceFilter.get=function(){return ll},Object.defineProperties(wu,Fh);var ul=function(a){this._maxPtDist=new zs,this._minPtDist=new zs,this._geom=a||null};ul.prototype.filter=function(a){this._minPtDist.initialize(),Ru.computeDistance(this._geom,a,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},ul.prototype.getMaxPointDistance=function(){return this._maxPtDist},ul.prototype.interfaces_=function(){return[zr]},ul.prototype.getClass=function(){return ul};var ll=function(a){this._maxPtDist=new zs,this._minPtDist=new zs,this._geom=a||null};ll.prototype.filter=function(a,h){if(0===h)return null;var y=a.getCoordinate(h-1),x=a.getCoordinate(h),T=new Q((y.x+x.x)/2,(y.y+x.y)/2);this._minPtDist.initialize(),Ru.computeDistance(this._geom,T,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},ll.prototype.isDone=function(){return!1},ll.prototype.isGeometryChanged=function(){return!1},ll.prototype.getMaxPointDistance=function(){return this._maxPtDist},ll.prototype.interfaces_=function(){return[lo]},ll.prototype.getClass=function(){return ll};var Ws=function(a){this._comps=a||null};Ws.prototype.filter=function(a){a instanceof Jo&&this._comps.add(a)},Ws.prototype.interfaces_=function(){return[Cs]},Ws.prototype.getClass=function(){return Ws},Ws.getPolygons=function(){if(1===arguments.length)return Ws.getPolygons(arguments[0],new Ve);if(2===arguments.length){var h=arguments[0],y=arguments[1];return h instanceof Jo?y.add(h):h instanceof ai&&h.apply(new Ws(y)),y}};var Us=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length)this._lines=arguments[0];else if(2===arguments.length){var y=arguments[1];this._lines=arguments[0],this._isForcedToLineString=y}};Us.prototype.filter=function(a){if(this._isForcedToLineString&&a instanceof ta){var h=a.getFactory().createLineString(a.getCoordinateSequence());return this._lines.add(h),null}a instanceof To&&this._lines.add(a)},Us.prototype.setForceToLineString=function(a){this._isForcedToLineString=a},Us.prototype.interfaces_=function(){return[yr]},Us.prototype.getClass=function(){return Us},Us.getGeometry=function(){if(1===arguments.length){var a=arguments[0];return a.getFactory().buildGeometry(Us.getLines(a))}if(2===arguments.length){var h=arguments[0],y=arguments[1];return h.getFactory().buildGeometry(Us.getLines(h,y))}},Us.getLines=function(){if(1===arguments.length)return Us.getLines(arguments[0],!1);if(2===arguments.length){if(At(arguments[0],ye)&&At(arguments[1],ye)){for(var y=arguments[1],x=arguments[0].iterator();x.hasNext();){var T=x.next();Us.getLines(T,y)}return y}if(arguments[0]instanceof Tn&&"boolean"==typeof arguments[1]){var F=arguments[0],j=arguments[1],ce=new Ve;return F.apply(new Us(ce,j)),ce}if(arguments[0]instanceof Tn&&At(arguments[1],ye)){var ke=arguments[0],ft=arguments[1];return ke instanceof To?ft.add(ke):ke.apply(new Us(ft)),ft}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&At(arguments[0],ye)&&At(arguments[1],ye)){for(var $t=arguments[1],Pn=arguments[2],Mn=arguments[0].iterator();Mn.hasNext();){var zn=Mn.next();Us.getLines(zn,$t,Pn)}return $t}if("boolean"==typeof arguments[2]&&arguments[0]instanceof Tn&&At(arguments[1],ye)){var hi=arguments[1];return arguments[0].apply(new Us(hi,arguments[2])),hi}}};var bu=function(){if(this._boundaryRule=ni.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0!==arguments.length&&1===arguments.length){var a=arguments[0];if(null===a)throw new re("Rule must be non-null");this._boundaryRule=a}};bu.prototype.locateInternal=function(){if(arguments[0]instanceof Q&&arguments[1]instanceof Jo){var a=arguments[0],h=arguments[1];if(h.isEmpty())return Ae.EXTERIOR;var y=h.getExteriorRing(),x=this.locateInPolygonRing(a,y);if(x===Ae.EXTERIOR)return Ae.EXTERIOR;if(x===Ae.BOUNDARY)return Ae.BOUNDARY;for(var T=0;T<h.getNumInteriorRing();T++){var F=h.getInteriorRingN(T),j=this.locateInPolygonRing(a,F);if(j===Ae.INTERIOR)return Ae.EXTERIOR;if(j===Ae.BOUNDARY)return Ae.BOUNDARY}return Ae.INTERIOR}if(arguments[0]instanceof Q&&arguments[1]instanceof To){var ce=arguments[0],ke=arguments[1];if(!ke.getEnvelopeInternal().intersects(ce))return Ae.EXTERIOR;var ft=ke.getCoordinates();return ke.isClosed()||!ce.equals(ft[0])&&!ce.equals(ft[ft.length-1])?Gt.isOnLine(ce,ft)?Ae.INTERIOR:Ae.EXTERIOR:Ae.BOUNDARY}if(arguments[0]instanceof Q&&arguments[1]instanceof Ko){var Lt=arguments[0];return arguments[1].getCoordinate().equals2D(Lt)?Ae.INTERIOR:Ae.EXTERIOR}},bu.prototype.locateInPolygonRing=function(a,h){return h.getEnvelopeInternal().intersects(a)?Gt.locatePointInRing(a,h.getCoordinates()):Ae.EXTERIOR},bu.prototype.intersects=function(a,h){return this.locate(a,h)!==Ae.EXTERIOR},bu.prototype.updateLocationInfo=function(a){a===Ae.INTERIOR&&(this._isIn=!0),a===Ae.BOUNDARY&&this._numBoundaries++},bu.prototype.computeLocation=function(a,h){if(h instanceof Ko&&this.updateLocationInfo(this.locateInternal(a,h)),h instanceof To)this.updateLocationInfo(this.locateInternal(a,h));else if(h instanceof Jo)this.updateLocationInfo(this.locateInternal(a,h));else if(h instanceof du)for(var y=h,x=0;x<y.getNumGeometries();x++){var T=y.getGeometryN(x);this.updateLocationInfo(this.locateInternal(a,T))}else if(h instanceof Gs)for(var F=h,j=0;j<F.getNumGeometries();j++){var ce=F.getGeometryN(j);this.updateLocationInfo(this.locateInternal(a,ce))}else if(h instanceof ai)for(var ke=new va(h);ke.hasNext();){var ft=ke.next();ft!==h&&this.computeLocation(a,ft)}},bu.prototype.locate=function(a,h){return h.isEmpty()?Ae.EXTERIOR:h instanceof To||h instanceof Jo?this.locateInternal(a,h):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(a,h),this._boundaryRule.isInBoundary(this._numBoundaries)?Ae.BOUNDARY:this._numBoundaries>0||this._isIn?Ae.INTERIOR:Ae.EXTERIOR)},bu.prototype.interfaces_=function(){return[]},bu.prototype.getClass=function(){return bu};var aa=function a(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length)a.call(this,arguments[0],a.INSIDE_AREA,arguments[1]);else if(3===arguments.length){var T=arguments[1],F=arguments[2];this._component=arguments[0],this._segIndex=T,this._pt=F}},Kl={INSIDE_AREA:{configurable:!0}};aa.prototype.isInsideArea=function(){return this._segIndex===aa.INSIDE_AREA},aa.prototype.getCoordinate=function(){return this._pt},aa.prototype.getGeometryComponent=function(){return this._component},aa.prototype.getSegmentIndex=function(){return this._segIndex},aa.prototype.interfaces_=function(){return[]},aa.prototype.getClass=function(){return aa},Kl.INSIDE_AREA.get=function(){return-1},Object.defineProperties(aa,Kl);var Al=function(a){this._pts=a||null};Al.prototype.filter=function(a){a instanceof Ko&&this._pts.add(a)},Al.prototype.interfaces_=function(){return[Cs]},Al.prototype.getClass=function(){return Al},Al.getPoints=function(){if(1===arguments.length){var a=arguments[0];return a instanceof Ko?nu.singletonList(a):Al.getPoints(a,new Ve)}if(2===arguments.length){var h=arguments[0],y=arguments[1];return h instanceof Ko?y.add(h):h instanceof ai&&h.apply(new Al(y)),y}};var Pl=function(){this._locations=null,this._locations=arguments[0]};Pl.prototype.filter=function(a){(a instanceof Ko||a instanceof To||a instanceof Jo)&&this._locations.add(new aa(a,0,a.getCoordinate()))},Pl.prototype.interfaces_=function(){return[Cs]},Pl.prototype.getClass=function(){return Pl},Pl.getLocations=function(a){var h=new Ve;return a.apply(new Pl(h)),h};var mi=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new bu,this._minDistanceLocation=null,this._minDistance=Y.MAX_VALUE,2===arguments.length)this._geom=[arguments[0],arguments[1]],this._terminateDistance=0;else if(3===arguments.length){var y=arguments[0],x=arguments[1],T=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=y,this._geom[1]=x,this._terminateDistance=T}};mi.prototype.computeContainmentDistance=function(){if(0===arguments.length){var a=new Array(2).fill(null);if(this.computeContainmentDistance(0,a),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,a)}else if(2===arguments.length){var h=arguments[0],y=arguments[1],x=1-h,T=Ws.getPolygons(this._geom[h]);if(T.size()>0){var F=Pl.getLocations(this._geom[x]);if(this.computeContainmentDistance(F,T,y),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[x]=y[0],this._minDistanceLocation[h]=y[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&At(arguments[0],rt)&&At(arguments[1],rt)){for(var j=arguments[0],ce=arguments[1],ke=arguments[2],ft=0;ft<j.size();ft++)for(var Lt=j.get(ft),$t=0;$t<ce.size();$t++)if(this.computeContainmentDistance(Lt,ce.get($t),ke),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof aa&&arguments[1]instanceof Jo){var Pn=arguments[0],Mn=arguments[1],zn=arguments[2],qn=Pn.getCoordinate();if(Ae.EXTERIOR!==this._ptLocator.locate(qn,Mn))return this._minDistance=0,zn[0]=Pn,zn[1]=new aa(Mn,qn),null}},mi.prototype.computeMinDistanceLinesPoints=function(a,h,y){for(var x=0;x<a.size();x++)for(var T=a.get(x),F=0;F<h.size();F++){var j=h.get(F);if(this.computeMinDistance(T,j,y),this._minDistance<=this._terminateDistance)return null}},mi.prototype.computeFacetDistance=function(){var a=new Array(2).fill(null),h=Us.getLines(this._geom[0]),y=Us.getLines(this._geom[1]),x=Al.getPoints(this._geom[0]),T=Al.getPoints(this._geom[1]);return this.computeMinDistanceLines(h,y,a),this.updateMinDistance(a,!1),this._minDistance<=this._terminateDistance?null:(a[0]=null,a[1]=null,this.computeMinDistanceLinesPoints(h,T,a),this.updateMinDistance(a,!1),this._minDistance<=this._terminateDistance?null:(a[0]=null,a[1]=null,this.computeMinDistanceLinesPoints(y,x,a),this.updateMinDistance(a,!0),this._minDistance<=this._terminateDistance?null:(a[0]=null,a[1]=null,this.computeMinDistancePoints(x,T,a),void this.updateMinDistance(a,!1))))},mi.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},mi.prototype.updateMinDistance=function(a,h){if(null===a[0])return null;h?(this._minDistanceLocation[0]=a[1],this._minDistanceLocation[1]=a[0]):(this._minDistanceLocation[0]=a[0],this._minDistanceLocation[1]=a[1])},mi.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},mi.prototype.computeMinDistance=function(){if(0===arguments.length){if(null!==this._minDistanceLocation||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof To&&arguments[1]instanceof Ko){var a=arguments[0],h=arguments[1],y=arguments[2];if(a.getEnvelopeInternal().distance(h.getEnvelopeInternal())>this._minDistance)return null;for(var x=a.getCoordinates(),T=h.getCoordinate(),F=0;F<x.length-1;F++){var j=Gt.distancePointLine(T,x[F],x[F+1]);if(j<this._minDistance){this._minDistance=j;var ce=new Hn(x[F],x[F+1]).closestPoint(T);y[0]=new aa(a,F,ce),y[1]=new aa(h,0,T)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof To&&arguments[1]instanceof To){var ke=arguments[0],ft=arguments[1],Lt=arguments[2];if(ke.getEnvelopeInternal().distance(ft.getEnvelopeInternal())>this._minDistance)return null;for(var $t=ke.getCoordinates(),Pn=ft.getCoordinates(),Mn=0;Mn<$t.length-1;Mn++)for(var zn=0;zn<Pn.length-1;zn++){var qn=Gt.distanceLineLine($t[Mn],$t[Mn+1],Pn[zn],Pn[zn+1]);if(qn<this._minDistance){this._minDistance=qn;var hi=new Hn($t[Mn],$t[Mn+1]),Sn=new Hn(Pn[zn],Pn[zn+1]),bs=hi.closestPoints(Sn);Lt[0]=new aa(ke,Mn,bs[0]),Lt[1]=new aa(ft,zn,bs[1])}if(this._minDistance<=this._terminateDistance)return null}}},mi.prototype.computeMinDistancePoints=function(a,h,y){for(var x=0;x<a.size();x++)for(var T=a.get(x),F=0;F<h.size();F++){var j=h.get(F),ce=T.getCoordinate().distance(j.getCoordinate());if(ce<this._minDistance&&(this._minDistance=ce,y[0]=new aa(T,0,T.getCoordinate()),y[1]=new aa(j,0,j.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},mi.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new re("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},mi.prototype.computeMinDistanceLines=function(a,h,y){for(var x=0;x<a.size();x++)for(var T=a.get(x),F=0;F<h.size();F++){var j=h.get(F);if(this.computeMinDistance(T,j,y),this._minDistance<=this._terminateDistance)return null}},mi.prototype.interfaces_=function(){return[]},mi.prototype.getClass=function(){return mi},mi.distance=function(a,h){return new mi(a,h).distance()},mi.isWithinDistance=function(a,h,y){return new mi(a,h,y).distance()<=y},mi.nearestPoints=function(a,h){return new mi(a,h).nearestPoints()};var yi=function(){this._pt=[new Q,new Q],this._distance=Y.NaN,this._isNull=!0};yi.prototype.getCoordinates=function(){return this._pt},yi.prototype.getCoordinate=function(a){return this._pt[a]},yi.prototype.setMinimum=function(){if(1===arguments.length){var a=arguments[0];this.setMinimum(a._pt[0],a._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var x=h.distance(y);x<this._distance&&this.initialize(h,y,x)}},yi.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var a=arguments[0],h=arguments[1];this._pt[0].setCoordinate(a),this._pt[1].setCoordinate(h),this._distance=a.distance(h),this._isNull=!1}else if(3===arguments.length){var x=arguments[1],T=arguments[2];this._pt[0].setCoordinate(arguments[0]),this._pt[1].setCoordinate(x),this._distance=T,this._isNull=!1}},yi.prototype.toString=function(){return wt.toLineString(this._pt[0],this._pt[1])},yi.prototype.getDistance=function(){return this._distance},yi.prototype.setMaximum=function(){if(1===arguments.length){var a=arguments[0];this.setMaximum(a._pt[0],a._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var x=h.distance(y);x>this._distance&&this.initialize(h,y,x)}},yi.prototype.interfaces_=function(){return[]},yi.prototype.getClass=function(){return yi};var Qr=function(){};Qr.prototype.interfaces_=function(){return[]},Qr.prototype.getClass=function(){return Qr},Qr.computeDistance=function(){if(arguments[2]instanceof yi&&arguments[0]instanceof To&&arguments[1]instanceof Q)for(var a=arguments[0],h=arguments[1],y=arguments[2],x=new Hn,T=a.getCoordinates(),F=0;F<T.length-1;F++){x.setCoordinates(T[F],T[F+1]);var j=x.closestPoint(h);y.setMinimum(j,h)}else if(arguments[2]instanceof yi&&arguments[0]instanceof Jo&&arguments[1]instanceof Q){var ce=arguments[0],ke=arguments[1],ft=arguments[2];Qr.computeDistance(ce.getExteriorRing(),ke,ft);for(var Lt=0;Lt<ce.getNumInteriorRing();Lt++)Qr.computeDistance(ce.getInteriorRingN(Lt),ke,ft)}else if(arguments[2]instanceof yi&&arguments[0]instanceof Tn&&arguments[1]instanceof Q){var $t=arguments[0],Pn=arguments[1],Mn=arguments[2];if($t instanceof To)Qr.computeDistance($t,Pn,Mn);else if($t instanceof Jo)Qr.computeDistance($t,Pn,Mn);else if($t instanceof ai)for(var zn=$t,qn=0;qn<zn.getNumGeometries();qn++){var hi=zn.getGeometryN(qn);Qr.computeDistance(hi,Pn,Mn)}else Mn.setMinimum($t.getCoordinate(),Pn)}else if(arguments[2]instanceof yi&&arguments[0]instanceof Hn&&arguments[1]instanceof Q){var bs=arguments[1],au=arguments[2],uu=arguments[0].closestPoint(bs);au.setMinimum(uu,bs)}};var ho=function(){this._g0=null,this._g1=null,this._ptDist=new yi,this._densifyFrac=0;var h=arguments[1];this._g0=arguments[0],this._g1=h},us={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};ho.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},ho.prototype.setDensifyFraction=function(a){if(a>1||a<=0)throw new re("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=a},ho.prototype.compute=function(a,h){this.computeOrientedDistance(a,h,this._ptDist),this.computeOrientedDistance(h,a,this._ptDist)},ho.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},ho.prototype.computeOrientedDistance=function(a,h,y){var x=new Ha(h);if(a.apply(x),y.setMaximum(x.getMaxPointDistance()),this._densifyFrac>0){var T=new eo(h,this._densifyFrac);a.apply(T),y.setMaximum(T.getMaxPointDistance())}},ho.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},ho.prototype.interfaces_=function(){return[]},ho.prototype.getClass=function(){return ho},ho.distance=function(){if(2===arguments.length)return new ho(arguments[0],arguments[1]).distance();if(3===arguments.length){var T=arguments[2],F=new ho(arguments[0],arguments[1]);return F.setDensifyFraction(T),F.distance()}},us.MaxPointDistanceFilter.get=function(){return Ha},us.MaxDensifiedByFractionDistanceFilter.get=function(){return eo},Object.defineProperties(ho,us);var Ha=function(){this._maxPtDist=new yi,this._minPtDist=new yi,this._euclideanDist=new Qr,this._geom=null,this._geom=arguments[0]};Ha.prototype.filter=function(a){this._minPtDist.initialize(),Qr.computeDistance(this._geom,a,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Ha.prototype.getMaxPointDistance=function(){return this._maxPtDist},Ha.prototype.interfaces_=function(){return[zr]},Ha.prototype.getClass=function(){return Ha};var eo=function(){this._maxPtDist=new yi,this._minPtDist=new yi,this._geom=null,this._numSubSegs=0;var h=arguments[1];this._geom=arguments[0],this._numSubSegs=Math.trunc(Math.round(1/h))};eo.prototype.filter=function(a,h){if(0===h)return null;for(var y=a.getCoordinate(h-1),x=a.getCoordinate(h),T=(x.x-y.x)/this._numSubSegs,F=(x.y-y.y)/this._numSubSegs,j=0;j<this._numSubSegs;j++){var ft=new Q(y.x+j*T,y.y+j*F);this._minPtDist.initialize(),Qr.computeDistance(this._geom,ft,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},eo.prototype.isDone=function(){return!1},eo.prototype.isGeometryChanged=function(){return!1},eo.prototype.getMaxPointDistance=function(){return this._maxPtDist},eo.prototype.interfaces_=function(){return[lo]},eo.prototype.getClass=function(){return eo};var As=function(a,h,y){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=a||null,this._bufDistance=h||null,this._result=y||null},oh={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};As.prototype.checkMaximumDistance=function(a,h,y){var x=new ho(h,a);if(x.setDensifyFraction(.25),this._maxDistanceFound=x.orientedDistance(),this._maxDistanceFound>y){this._isValid=!1;var T=x.getCoordinates();this._errorLocation=T[1],this._errorIndicator=a.getFactory().createLineString(T),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+wt.toLineString(T[0],T[1])+")"}},As.prototype.isValid=function(){var a=Math.abs(this._bufDistance),h=As.MAX_DISTANCE_DIFF_FRAC*a;return this._minValidDistance=a-h,this._maxValidDistance=a+h,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),As.VERBOSE&&cn.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},As.prototype.checkNegativeValid=function(){if(!(this._input instanceof Jo||this._input instanceof Gs||this._input instanceof ai))return null;var a=this.getPolygonLines(this._input);if(this.checkMinimumDistance(a,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(a,this._result,this._maxValidDistance)},As.prototype.getErrorIndicator=function(){return this._errorIndicator},As.prototype.checkMinimumDistance=function(a,h,y){var x=new mi(a,h,y);if(this._minDistanceFound=x.distance(),this._minDistanceFound<y){this._isValid=!1;var T=x.nearestPoints();this._errorLocation=x.nearestPoints()[1],this._errorIndicator=a.getFactory().createLineString(T),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+wt.toLineString(T[0],T[1])+" )"}},As.prototype.checkPositiveValid=function(){var a=this._result.getBoundary();if(this.checkMinimumDistance(this._input,a,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,a,this._maxValidDistance)},As.prototype.getErrorLocation=function(){return this._errorLocation},As.prototype.getPolygonLines=function(a){for(var h=new Ve,y=new Us(h),x=Ws.getPolygons(a).iterator();x.hasNext();)x.next().apply(y);return a.getFactory().buildGeometry(h)},As.prototype.getErrorMessage=function(){return this._errMsg},As.prototype.interfaces_=function(){return[]},As.prototype.getClass=function(){return As},oh.VERBOSE.get=function(){return!1},oh.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(As,oh);var xo=function(a,h,y){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=a||null,this._distance=h||null,this._result=y||null},Jl={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};xo.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},xo.prototype.checkEnvelope=function(){if(this._distance<0)return null;var a=this._distance*xo.MAX_ENV_DIFF_FRAC;0===a&&(a=.001);var h=new sn(this._input.getEnvelopeInternal());h.expandBy(this._distance);var y=new sn(this._result.getEnvelopeInternal());y.expandBy(a),y.contains(h)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(y)),this.report("Envelope")},xo.prototype.checkDistance=function(){var a=new As(this._input,this._distance,this._result);a.isValid()||(this._isValid=!1,this._errorMsg=a.getErrorMessage(),this._errorLocation=a.getErrorLocation(),this._errorIndicator=a.getErrorIndicator()),this.report("Distance")},xo.prototype.checkArea=function(){var a=this._input.getArea(),h=this._result.getArea();this._distance>0&&a>h&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&a<h&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},xo.prototype.checkPolygonal=function(){this._result instanceof Jo||this._result instanceof Gs||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},xo.prototype.getErrorIndicator=function(){return this._errorIndicator},xo.prototype.getErrorLocation=function(){return this._errorLocation},xo.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},xo.prototype.report=function(a){if(!xo.VERBOSE)return null;cn.out.println("Check "+a+": "+(this._isValid?"passed":"FAILED"))},xo.prototype.getErrorMessage=function(){return this._errorMsg},xo.prototype.interfaces_=function(){return[]},xo.prototype.getClass=function(){return xo},xo.isValidMsg=function(a,h,y){var x=new xo(a,h,y);return x.isValid()?null:x.getErrorMessage()},xo.isValid=function(a,h,y){return!!new xo(a,h,y).isValid()},Jl.VERBOSE.get=function(){return!1},Jl.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(xo,Jl);var Wa=function(){this._pts=null,this._data=null;var h=arguments[1];this._pts=arguments[0],this._data=h};Wa.prototype.getCoordinates=function(){return this._pts},Wa.prototype.size=function(){return this._pts.length},Wa.prototype.getCoordinate=function(a){return this._pts[a]},Wa.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},Wa.prototype.getSegmentOctant=function(a){return a===this._pts.length-1?-1:Tl.octant(this.getCoordinate(a),this.getCoordinate(a+1))},Wa.prototype.setData=function(a){this._data=a},Wa.prototype.getData=function(){return this._data},Wa.prototype.toString=function(){return wt.toLineString(new Ho(this._pts))},Wa.prototype.interfaces_=function(){return[iu]},Wa.prototype.getClass=function(){return Wa};var ii=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new Ve,this._intersectionCount=0,this._keepIntersections=!0,this._li=arguments[0],this._interiorIntersection=null};ii.prototype.getInteriorIntersection=function(){return this._interiorIntersection},ii.prototype.setCheckEndSegmentsOnly=function(a){this._isCheckEndSegmentsOnly=a},ii.prototype.getIntersectionSegments=function(){return this._intSegments},ii.prototype.count=function(){return this._intersectionCount},ii.prototype.getIntersections=function(){return this._intersections},ii.prototype.setFindAllIntersections=function(a){this._findAllIntersections=a},ii.prototype.setKeepIntersections=function(a){this._keepIntersections=a},ii.prototype.processIntersections=function(a,h,y,x){if(!this._findAllIntersections&&this.hasIntersection()||a===y&&h===x||this._isCheckEndSegmentsOnly&&!this.isEndSegment(a,h)&&!this.isEndSegment(y,x))return null;var T=a.getCoordinates()[h],F=a.getCoordinates()[h+1],j=y.getCoordinates()[x],ce=y.getCoordinates()[x+1];this._li.computeIntersection(T,F,j,ce),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=T,this._intSegments[1]=F,this._intSegments[2]=j,this._intSegments[3]=ce,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},ii.prototype.isEndSegment=function(a,h){return 0===h||h>=a.size()-2},ii.prototype.hasIntersection=function(){return null!==this._interiorIntersection},ii.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},ii.prototype.interfaces_=function(){return[_u]},ii.prototype.getClass=function(){return ii},ii.createAllIntersectionsFinder=function(a){var h=new ii(a);return h.setFindAllIntersections(!0),h},ii.createAnyIntersectionFinder=function(a){return new ii(a)},ii.createIntersectionCounter=function(a){var h=new ii(a);return h.setFindAllIntersections(!0),h.setKeepIntersections(!1),h};var an=function(){this._li=new Vt,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0,this._segStrings=arguments[0]};an.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},an.prototype.getIntersections=function(){return this._segInt.getIntersections()},an.prototype.isValid=function(){return this.execute(),this._isValid},an.prototype.setFindAllIntersections=function(a){this._findAllIntersections=a},an.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new ii(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var a=new Oh;if(a.setSegmentIntersector(this._segInt),a.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},an.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Dn(this.getErrorMessage(),this._segInt.getInteriorIntersection())},an.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var a=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+wt.toLineString(a[0],a[1])+" and "+wt.toLineString(a[2],a[3])},an.prototype.interfaces_=function(){return[]},an.prototype.getClass=function(){return an},an.computeIntersections=function(a){var h=new an(a);return h.setFindAllIntersections(!0),h.isValid(),h.getIntersections()};var vr=function a(){this._nv=null,this._nv=new an(a.toSegmentStrings(arguments[0]))};vr.prototype.checkValid=function(){this._nv.checkValid()},vr.prototype.interfaces_=function(){return[]},vr.prototype.getClass=function(){return vr},vr.toSegmentStrings=function(a){for(var h=new Ve,y=a.iterator();y.hasNext();){var x=y.next();h.add(new Wa(x.getCoordinates(),x))}return h},vr.checkValid=function(a){new vr(a).checkValid()};var fo=function(a){this._mapOp=a};fo.prototype.map=function(a){for(var h=new Ve,y=0;y<a.getNumGeometries();y++){var x=this._mapOp.map(a.getGeometryN(y));x.isEmpty()||h.add(x)}return a.getFactory().createGeometryCollection(Bn.toGeometryArray(h))},fo.prototype.interfaces_=function(){return[]},fo.prototype.getClass=function(){return fo},fo.map=function(a,h){return new fo(h).map(a)};var ns=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new Ve,this._resultLineList=new Ve;var h=arguments[1],y=arguments[2];this._op=arguments[0],this._geometryFactory=h,this._ptLocator=y};ns.prototype.collectLines=function(a){for(var h=this._op.getGraph().getEdgeEnds().iterator();h.hasNext();){var y=h.next();this.collectLineEdge(y,a,this._lineEdgesList),this.collectBoundaryTouchEdge(y,a,this._lineEdgesList)}},ns.prototype.labelIsolatedLine=function(a,h){var y=this._ptLocator.locate(a.getCoordinate(),this._op.getArgGeometry(h));a.getLabel().setLocation(h,y)},ns.prototype.build=function(a){return this.findCoveredLineEdges(),this.collectLines(a),this.buildLines(a),this._resultLineList},ns.prototype.collectLineEdge=function(a,h,y){var x=a.getLabel(),T=a.getEdge();a.isLineEdge()&&(a.isVisited()||!ur.isResultOfOp(x,h)||T.isCovered()||(y.add(T),a.setVisitedEdge(!0)))},ns.prototype.findCoveredLineEdges=function(){for(var a=this._op.getGraph().getNodes().iterator();a.hasNext();)a.next().getEdges().findCoveredLineEdges();for(var h=this._op.getGraph().getEdgeEnds().iterator();h.hasNext();){var y=h.next(),x=y.getEdge();if(y.isLineEdge()&&!x.isCoveredSet()){var T=this._op.isCoveredByA(y.getCoordinate());x.setCovered(T)}}},ns.prototype.labelIsolatedLines=function(a){for(var h=a.iterator();h.hasNext();){var y=h.next(),x=y.getLabel();y.isIsolated()&&(x.isNull(0)?this.labelIsolatedLine(y,0):this.labelIsolatedLine(y,1))}},ns.prototype.buildLines=function(a){for(var h=this._lineEdgesList.iterator();h.hasNext();){var y=h.next(),x=this._geometryFactory.createLineString(y.getCoordinates());this._resultLineList.add(x),y.setInResult(!0)}},ns.prototype.collectBoundaryTouchEdge=function(a,h,y){var x=a.getLabel();return a.isLineEdge()||a.isVisited()||a.isInteriorAreaEdge()||a.getEdge().isInResult()?null:(xe.isTrue(!(a.isInResult()||a.getSym().isInResult())||!a.getEdge().isInResult()),void(ur.isResultOfOp(x,h)&&h===ur.INTERSECTION&&(y.add(a.getEdge()),a.setVisitedEdge(!0))))},ns.prototype.interfaces_=function(){return[]},ns.prototype.getClass=function(){return ns};var ua=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new Ve;var h=arguments[1];this._op=arguments[0],this._geometryFactory=h};ua.prototype.filterCoveredNodeToPoint=function(a){var h=a.getCoordinate();if(!this._op.isCoveredByLA(h)){var y=this._geometryFactory.createPoint(h);this._resultPointList.add(y)}},ua.prototype.extractNonCoveredResultNodes=function(a){for(var h=this._op.getGraph().getNodes().iterator();h.hasNext();){var y=h.next();if(!(y.isInResult()||y.isIncidentEdgeInResult()||0!==y.getEdges().getDegree()&&a!==ur.INTERSECTION)){var x=y.getLabel();ur.isResultOfOp(x,a)&&this.filterCoveredNodeToPoint(y)}}},ua.prototype.build=function(a){return this.extractNonCoveredResultNodes(a),this._resultPointList},ua.prototype.interfaces_=function(){return[]},ua.prototype.getClass=function(){return ua};var Mi=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};Mi.prototype.transformPoint=function(a,h){return this._factory.createPoint(this.transformCoordinates(a.getCoordinateSequence(),a))},Mi.prototype.transformPolygon=function(a,h){var y=!0,x=this.transformLinearRing(a.getExteriorRing(),a);null!==x&&x instanceof ta&&!x.isEmpty()||(y=!1);for(var T=new Ve,F=0;F<a.getNumInteriorRing();F++){var j=this.transformLinearRing(a.getInteriorRingN(F),a);null===j||j.isEmpty()||(j instanceof ta||(y=!1),T.add(j))}if(y)return this._factory.createPolygon(x,T.toArray([]));var ce=new Ve;return null!==x&&ce.add(x),ce.addAll(T),this._factory.buildGeometry(ce)},Mi.prototype.createCoordinateSequence=function(a){return this._factory.getCoordinateSequenceFactory().create(a)},Mi.prototype.getInputGeometry=function(){return this._inputGeom},Mi.prototype.transformMultiLineString=function(a,h){for(var y=new Ve,x=0;x<a.getNumGeometries();x++){var T=this.transformLineString(a.getGeometryN(x),a);null!==T&&(T.isEmpty()||y.add(T))}return this._factory.buildGeometry(y)},Mi.prototype.transformCoordinates=function(a,h){return this.copy(a)},Mi.prototype.transformLineString=function(a,h){return this._factory.createLineString(this.transformCoordinates(a.getCoordinateSequence(),a))},Mi.prototype.transformMultiPoint=function(a,h){for(var y=new Ve,x=0;x<a.getNumGeometries();x++){var T=this.transformPoint(a.getGeometryN(x),a);null!==T&&(T.isEmpty()||y.add(T))}return this._factory.buildGeometry(y)},Mi.prototype.transformMultiPolygon=function(a,h){for(var y=new Ve,x=0;x<a.getNumGeometries();x++){var T=this.transformPolygon(a.getGeometryN(x),a);null!==T&&(T.isEmpty()||y.add(T))}return this._factory.buildGeometry(y)},Mi.prototype.copy=function(a){return a.copy()},Mi.prototype.transformGeometryCollection=function(a,h){for(var y=new Ve,x=0;x<a.getNumGeometries();x++){var T=this.transform(a.getGeometryN(x));null!==T&&(this._pruneEmptyGeometry&&T.isEmpty()||y.add(T))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(Bn.toGeometryArray(y)):this._factory.buildGeometry(y)},Mi.prototype.transform=function(a){if(this._inputGeom=a,this._factory=a.getFactory(),a instanceof Ko)return this.transformPoint(a,null);if(a instanceof Sl)return this.transformMultiPoint(a,null);if(a instanceof ta)return this.transformLinearRing(a,null);if(a instanceof To)return this.transformLineString(a,null);if(a instanceof du)return this.transformMultiLineString(a,null);if(a instanceof Jo)return this.transformPolygon(a,null);if(a instanceof Gs)return this.transformMultiPolygon(a,null);if(a instanceof ai)return this.transformGeometryCollection(a,null);throw new re("Unknown Geometry subtype: "+a.getClass().getName())},Mi.prototype.transformLinearRing=function(a,h){var y=this.transformCoordinates(a.getCoordinateSequence(),a);if(null===y)return this._factory.createLinearRing(null);var x=y.size();return x>0&&x<4&&!this._preserveType?this._factory.createLineString(y):this._factory.createLinearRing(y)},Mi.prototype.interfaces_=function(){return[]},Mi.prototype.getClass=function(){return Mi};var Xs=function a(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new Hn,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof To&&"number"==typeof arguments[1]){var y=arguments[1];a.call(this,arguments[0].getCoordinates(),y)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var x=arguments[0],T=arguments[1];this._srcPts=x,this._isClosed=a.isClosed(x),this._snapTolerance=T}};Xs.prototype.snapVertices=function(a,h){for(var y=this._isClosed?a.size()-1:a.size(),x=0;x<y;x++){var T=a.get(x),F=this.findSnapForVertex(T,h);null!==F&&(a.set(x,new Q(F)),0===x&&this._isClosed&&a.set(a.size()-1,new Q(F)))}},Xs.prototype.findSnapForVertex=function(a,h){for(var y=0;y<h.length;y++){if(a.equals2D(h[y]))return null;if(a.distance(h[y])<this._snapTolerance)return h[y]}return null},Xs.prototype.snapTo=function(a){var h=new Ct(this._srcPts);return this.snapVertices(h,a),this.snapSegments(h,a),h.toCoordinateArray()},Xs.prototype.snapSegments=function(a,h){if(0===h.length)return null;var y=h.length;h[0].equals2D(h[h.length-1])&&(y=h.length-1);for(var x=0;x<y;x++){var T=h[x],F=this.findSegmentIndexToSnap(T,a);F>=0&&a.add(F+1,new Q(T),!1)}},Xs.prototype.findSegmentIndexToSnap=function(a,h){for(var y=Y.MAX_VALUE,x=-1,T=0;T<h.size()-1;T++){if(this._seg.p0=h.get(T),this._seg.p1=h.get(T+1),this._seg.p0.equals2D(a)||this._seg.p1.equals2D(a)){if(this._allowSnappingToSourceVertices)continue;return-1}var F=this._seg.distance(a);F<this._snapTolerance&&F<y&&(y=F,x=T)}return x},Xs.prototype.setAllowSnappingToSourceVertices=function(a){this._allowSnappingToSourceVertices=a},Xs.prototype.interfaces_=function(){return[]},Xs.prototype.getClass=function(){return Xs},Xs.isClosed=function(a){return!(a.length<=1)&&a[0].equals2D(a[a.length-1])};var xr=function(a){this._srcGeom=a||null},Ql={SNAP_PRECISION_FACTOR:{configurable:!0}};xr.prototype.snapTo=function(a,h){var y=this.extractTargetCoordinates(a);return new Xu(h,y).transform(this._srcGeom)},xr.prototype.snapToSelf=function(a,h){var y=this.extractTargetCoordinates(this._srcGeom),x=new Xu(a,y,!0).transform(this._srcGeom),T=x;return h&&At(T,Ss)&&(T=x.buffer(0)),T},xr.prototype.computeSnapTolerance=function(a){return this.computeMinimumSegmentLength(a)/10},xr.prototype.extractTargetCoordinates=function(a){for(var h=new ht,y=a.getCoordinates(),x=0;x<y.length;x++)h.add(y[x]);return h.toArray(new Array(0).fill(null))},xr.prototype.computeMinimumSegmentLength=function(a){for(var h=Y.MAX_VALUE,y=0;y<a.length-1;y++){var x=a[y].distance(a[y+1]);x<h&&(h=x)}return h},xr.prototype.interfaces_=function(){return[]},xr.prototype.getClass=function(){return xr},xr.snap=function(a,h,y){var x=new Array(2).fill(null),T=new xr(a);x[0]=T.snapTo(h,y);var F=new xr(h);return x[1]=F.snapTo(x[0],y),x},xr.computeOverlaySnapTolerance=function(){if(1===arguments.length){var a=arguments[0],h=xr.computeSizeBasedSnapTolerance(a),y=a.getPrecisionModel();if(y.getType()===nn.FIXED){var x=1/y.getScale()*2/1.415;x>h&&(h=x)}return h}if(2===arguments.length){var F=arguments[1];return Math.min(xr.computeOverlaySnapTolerance(arguments[0]),xr.computeOverlaySnapTolerance(F))}},xr.computeSizeBasedSnapTolerance=function(a){var h=a.getEnvelopeInternal();return Math.min(h.getHeight(),h.getWidth())*xr.SNAP_PRECISION_FACTOR},xr.snapToSelf=function(a,h,y){return new xr(a).snapToSelf(h,y)},Ql.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(xr,Ql);var Xu=function(a){function h(y,x,T){a.call(this),this._snapTolerance=y||null,this._snapPts=x||null,this._isSelfSnap=void 0!==T&&T}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.snapLine=function(y,x){var T=new Xs(y,this._snapTolerance);return T.setAllowSnappingToSourceVertices(this._isSelfSnap),T.snapTo(x)},h.prototype.transformCoordinates=function(y,x){var T=y.toCoordinateArray(),F=this.snapLine(T,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(F)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Mi),Kn=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Kn.prototype.getCommon=function(){return Y.longBitsToDouble(this._commonBits)},Kn.prototype.add=function(a){var h=Y.doubleToLongBits(a);return this._isFirst?(this._commonBits=h,this._commonSignExp=Kn.signExpBits(this._commonBits),this._isFirst=!1,null):Kn.signExpBits(h)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=Kn.numCommonMostSigMantissaBits(this._commonBits,h),void(this._commonBits=Kn.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},Kn.prototype.toString=function(){if(1===arguments.length){var a=arguments[0],h=Y.longBitsToDouble(a),y="0000000000000000000000000000000000000000000000000000000000000000"+Y.toBinaryString(a),x=y.substring(y.length-64);return x.substring(0,1)+"  "+x.substring(1,12)+"(exp) "+x.substring(12)+" [ "+h+" ]"}},Kn.prototype.interfaces_=function(){return[]},Kn.prototype.getClass=function(){return Kn},Kn.getBit=function(a,h){return a&1<<h?1:0},Kn.signExpBits=function(a){return a>>52},Kn.zeroLowerBits=function(a,h){return a&~((1<<h)-1)},Kn.numCommonMostSigMantissaBits=function(a,h){for(var y=0,x=52;x>=0;x--){if(Kn.getBit(a,x)!==Kn.getBit(h,x))return y;y++}return 52};var la=function(){this._commonCoord=null,this._ccFilter=new Pa},Lc={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};la.prototype.addCommonBits=function(a){var h=new to(this._commonCoord);a.apply(h),a.geometryChanged()},la.prototype.removeCommonBits=function(a){if(0===this._commonCoord.x&&0===this._commonCoord.y)return a;var h=new Q(this._commonCoord);h.x=-h.x,h.y=-h.y;var y=new to(h);return a.apply(y),a.geometryChanged(),a},la.prototype.getCommonCoordinate=function(){return this._commonCoord},la.prototype.add=function(a){a.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},la.prototype.interfaces_=function(){return[]},la.prototype.getClass=function(){return la},Lc.CommonCoordinateFilter.get=function(){return Pa},Lc.Translater.get=function(){return to},Object.defineProperties(la,Lc);var Pa=function(){this._commonBitsX=new Kn,this._commonBitsY=new Kn};Pa.prototype.filter=function(a){this._commonBitsX.add(a.x),this._commonBitsY.add(a.y)},Pa.prototype.getCommonCoordinate=function(){return new Q(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},Pa.prototype.interfaces_=function(){return[zr]},Pa.prototype.getClass=function(){return Pa};var to=function(){this.trans=null,this.trans=arguments[0]};to.prototype.filter=function(a,h){var y=a.getOrdinate(h,0)+this.trans.x,x=a.getOrdinate(h,1)+this.trans.y;a.setOrdinate(h,0,y),a.setOrdinate(h,1,x)},to.prototype.isDone=function(){return!1},to.prototype.isGeometryChanged=function(){return!0},to.prototype.interfaces_=function(){return[lo]},to.prototype.getClass=function(){return to};var Po=function(a,h){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=a,this._geom[1]=h,this.computeSnapTolerance()};Po.prototype.selfSnap=function(a){return new xr(a).snapTo(a,this._snapTolerance)},Po.prototype.removeCommonBits=function(a){this._cbr=new la,this._cbr.add(a[0]),this._cbr.add(a[1]);var h=new Array(2).fill(null);return h[0]=this._cbr.removeCommonBits(a[0].copy()),h[1]=this._cbr.removeCommonBits(a[1].copy()),h},Po.prototype.prepareResult=function(a){return this._cbr.addCommonBits(a),a},Po.prototype.getResultGeometry=function(a){var h=this.snap(this._geom),y=ur.overlayOp(h[0],h[1],a);return this.prepareResult(y)},Po.prototype.checkValid=function(a){a.isValid()||cn.out.println("Snapped geometry is invalid")},Po.prototype.computeSnapTolerance=function(){this._snapTolerance=xr.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},Po.prototype.snap=function(a){var h=this.removeCommonBits(a);return xr.snap(h[0],h[1],this._snapTolerance)},Po.prototype.interfaces_=function(){return[]},Po.prototype.getClass=function(){return Po},Po.overlayOp=function(a,h,y){return new Po(a,h).getResultGeometry(y)},Po.union=function(a,h){return Po.overlayOp(a,h,ur.UNION)},Po.intersection=function(a,h){return Po.overlayOp(a,h,ur.INTERSECTION)},Po.symDifference=function(a,h){return Po.overlayOp(a,h,ur.SYMDIFFERENCE)},Po.difference=function(a,h){return Po.overlayOp(a,h,ur.DIFFERENCE)};var Xo=function(a,h){this._geom=new Array(2).fill(null),this._geom[0]=a,this._geom[1]=h};Xo.prototype.getResultGeometry=function(a){var h=null,y=!1,x=null;try{h=ur.overlayOp(this._geom[0],this._geom[1],a),y=!0}catch(T){if(!(T instanceof Te))throw T;x=T}if(!y)try{h=Po.overlayOp(this._geom[0],this._geom[1],a)}catch(T){throw T instanceof Te?x:T}return h},Xo.prototype.interfaces_=function(){return[]},Xo.prototype.getClass=function(){return Xo},Xo.overlayOp=function(a,h,y){return new Xo(a,h).getResultGeometry(y)},Xo.union=function(a,h){return Xo.overlayOp(a,h,ur.UNION)},Xo.intersection=function(a,h){return Xo.overlayOp(a,h,ur.INTERSECTION)},Xo.symDifference=function(a,h){return Xo.overlayOp(a,h,ur.SYMDIFFERENCE)},Xo.difference=function(a,h){return Xo.overlayOp(a,h,ur.DIFFERENCE)};var An=function(){this.mce=null,this.chainIndex=null;var h=arguments[1];this.mce=arguments[0],this.chainIndex=h};An.prototype.computeIntersections=function(a,h){this.mce.computeIntersectsForChain(this.chainIndex,a.mce,a.chainIndex,h)},An.prototype.interfaces_=function(){return[]},An.prototype.getClass=function(){return An};var po=function a(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var h=arguments[0],y=arguments[1];this._eventType=a.DELETE,this._xValue=h,this._insertEvent=y}else if(3===arguments.length){var x=arguments[0],T=arguments[1],F=arguments[2];this._eventType=a.INSERT,this._label=x,this._xValue=T,this._obj=F}},sh={INSERT:{configurable:!0},DELETE:{configurable:!0}};po.prototype.isDelete=function(){return this._eventType===po.DELETE},po.prototype.setDeleteEventIndex=function(a){this._deleteEventIndex=a},po.prototype.getObject=function(){return this._obj},po.prototype.compareTo=function(a){return this._xValue<a._xValue?-1:this._xValue>a._xValue?1:this._eventType<a._eventType?-1:this._eventType>a._eventType?1:0},po.prototype.getInsertEvent=function(){return this._insertEvent},po.prototype.isInsert=function(){return this._eventType===po.INSERT},po.prototype.isSameLabel=function(a){return null!==this._label&&this._label===a._label},po.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},po.prototype.interfaces_=function(){return[ee]},po.prototype.getClass=function(){return po},sh.INSERT.get=function(){return 1},sh.DELETE.get=function(){return 2},Object.defineProperties(po,sh);var Xa=function(){};Xa.prototype.interfaces_=function(){return[]},Xa.prototype.getClass=function(){return Xa};var no=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var h=arguments[1],y=arguments[2];this._li=arguments[0],this._includeProper=h,this._recordIsolated=y};no.prototype.isTrivialIntersection=function(a,h,y,x){if(a===y&&1===this._li.getIntersectionNum()){if(no.isAdjacentSegments(h,x))return!0;if(a.isClosed()){var T=a.getNumPoints()-1;if(0===h&&x===T||0===x&&h===T)return!0}}return!1},no.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},no.prototype.setIsDoneIfProperInt=function(a){this._isDoneWhenProperInt=a},no.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},no.prototype.isBoundaryPointInternal=function(a,h){for(var y=h.iterator();y.hasNext();){var x=y.next().getCoordinate();if(a.isIntersection(x))return!0}return!1},no.prototype.hasProperIntersection=function(){return this._hasProper},no.prototype.hasIntersection=function(){return this._hasIntersection},no.prototype.isDone=function(){return this._isDone},no.prototype.isBoundaryPoint=function(a,h){return!(null===h||!this.isBoundaryPointInternal(a,h[0])&&!this.isBoundaryPointInternal(a,h[1]))},no.prototype.setBoundaryNodes=function(a,h){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=a,this._bdyNodes[1]=h},no.prototype.addIntersections=function(a,h,y,x){if(a===y&&h===x)return null;this.numTests++;var T=a.getCoordinates()[h],F=a.getCoordinates()[h+1],j=y.getCoordinates()[x],ce=y.getCoordinates()[x+1];this._li.computeIntersection(T,F,j,ce),this._li.hasIntersection()&&(this._recordIsolated&&(a.setIsolated(!1),y.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(a,h,y,x)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(a.addIntersections(this._li,h,0),y.addIntersections(this._li,x,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},no.prototype.interfaces_=function(){return[]},no.prototype.getClass=function(){return no},no.isAdjacentSegments=function(a,h){return 1===Math.abs(a-h)};var Ps=function(a){function h(){a.call(this),this.events=new Ve,this.nOverlaps=null}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.prepareEvents=function(){nu.sort(this.events);for(var y=0;y<this.events.size();y++){var x=this.events.get(y);x.isDelete()&&x.getInsertEvent().setDeleteEventIndex(y)}},h.prototype.computeIntersections=function(){if(1===arguments.length){var y=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var x=0;x<this.events.size();x++){var T=this.events.get(x);if(T.isInsert()&&this.processOverlaps(x,T.getDeleteEventIndex(),T,y),y.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof no&&At(arguments[0],rt)&&At(arguments[1],rt)){var F=arguments[0],j=arguments[1],ce=arguments[2];this.addEdges(F,F),this.addEdges(j,j),this.computeIntersections(ce)}else if("boolean"==typeof arguments[2]&&At(arguments[0],rt)&&arguments[1]instanceof no){var ke=arguments[0],ft=arguments[1];arguments[2]?this.addEdges(ke,null):this.addEdges(ke),this.computeIntersections(ft)}},h.prototype.addEdge=function(y,x){for(var T=y.getMonotoneChainEdge(),F=T.getStartIndexes(),j=0;j<F.length-1;j++){var ce=new An(T,j),ke=new po(x,T.getMinX(j),ce);this.events.add(ke),this.events.add(new po(T.getMaxX(j),ke))}},h.prototype.processOverlaps=function(y,x,T,F){for(var j=T.getObject(),ce=y;ce<x;ce++){var ke=this.events.get(ce);if(ke.isInsert()){var ft=ke.getObject();T.isSameLabel(ke)||(j.computeIntersections(ft,F),this.nOverlaps++)}}},h.prototype.addEdges=function(){if(1===arguments.length)for(var y=arguments[0].iterator();y.hasNext();){var x=y.next();this.addEdge(x,x)}else if(2===arguments.length)for(var F=arguments[1],j=arguments[0].iterator();j.hasNext();){var ce=j.next();this.addEdge(ce,F)}},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Xa),ca=function(){this._min=Y.POSITIVE_INFINITY,this._max=Y.NEGATIVE_INFINITY},li={NodeComparator:{configurable:!0}};ca.prototype.getMin=function(){return this._min},ca.prototype.intersects=function(a,h){return!(this._min>h||this._max<a)},ca.prototype.getMax=function(){return this._max},ca.prototype.toString=function(){return wt.toLineString(new Q(this._min,0),new Q(this._max,0))},ca.prototype.interfaces_=function(){return[]},ca.prototype.getClass=function(){return ca},li.NodeComparator.get=function(){return Oc},Object.defineProperties(ca,li);var Oc=function(){};Oc.prototype.compare=function(a,h){var T=(a._min+a._max)/2,F=(h._min+h._max)/2;return T<F?-1:T>F?1:0},Oc.prototype.interfaces_=function(){return[me]},Oc.prototype.getClass=function(){return Oc};var Nc=function(a){function h(){a.call(this),this._item=null;var x=arguments[1],T=arguments[2];this._min=arguments[0],this._max=x,this._item=T}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.query=function(y,x,T){if(!this.intersects(y,x))return null;T.visitItem(this._item)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(ca),wf=function(a){function h(){a.call(this),this._node1=null,this._node2=null;var x=arguments[1];this._node1=arguments[0],this._node2=x,this.buildExtent(this._node1,this._node2)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.buildExtent=function(y,x){this._min=Math.min(y._min,x._min),this._max=Math.max(y._max,x._max)},h.prototype.query=function(y,x,T){if(!this.intersects(y,x))return null;null!==this._node1&&this._node1.query(y,x,T),null!==this._node2&&this._node2.query(y,x,T)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(ca),hs=function(){this._leaves=new Ve,this._root=null,this._level=0};hs.prototype.buildTree=function(){nu.sort(this._leaves,new ca.NodeComparator);for(var a=this._leaves,h=null,y=new Ve;;){if(this.buildLevel(a,y),1===y.size())return y.get(0);h=a,a=y,y=h}},hs.prototype.insert=function(a,h,y){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new Nc(a,h,y))},hs.prototype.query=function(a,h,y){this.init(),this._root.query(a,h,y)},hs.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},hs.prototype.printNode=function(a){cn.out.println(wt.toLineString(new Q(a._min,this._level),new Q(a._max,this._level)))},hs.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},hs.prototype.buildLevel=function(a,h){this._level++,h.clear();for(var y=0;y<a.size();y+=2){var x=a.get(y);if(null===(y+1<a.size()?a.get(y):null))h.add(x);else{var T=new wf(a.get(y),a.get(y+1));h.add(T)}}},hs.prototype.interfaces_=function(){return[]},hs.prototype.getClass=function(){return hs};var su=function(){this._items=new Ve};su.prototype.visitItem=function(a){this._items.add(a)},su.prototype.getItems=function(){return this._items},su.prototype.interfaces_=function(){return[Ao]},su.prototype.getClass=function(){return su};var Eu=function(){this._index=null;var a=arguments[0];if(!At(a,Ss))throw new re("Argument must be Polygonal");this._index=new Lu(a)},fc={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Eu.prototype.locate=function(a){var h=new tn(a),y=new fs(h);return this._index.query(a.y,a.y,y),h.getLocation()},Eu.prototype.interfaces_=function(){return[hc]},Eu.prototype.getClass=function(){return Eu},fc.SegmentVisitor.get=function(){return fs},fc.IntervalIndexedGeometry.get=function(){return Lu},Object.defineProperties(Eu,fc);var fs=function(){this._counter=null,this._counter=arguments[0]};fs.prototype.visitItem=function(a){var h=a;this._counter.countSegment(h.getCoordinate(0),h.getCoordinate(1))},fs.prototype.interfaces_=function(){return[Ao]},fs.prototype.getClass=function(){return fs};var Lu=function(){this._index=new hs,this.init(arguments[0])};Lu.prototype.init=function(a){for(var h=Us.getLines(a).iterator();h.hasNext();){var y=h.next().getCoordinates();this.addLine(y)}},Lu.prototype.addLine=function(a){for(var h=1;h<a.length;h++){var y=new Hn(a[h-1],a[h]),x=Math.min(y.p0.y,y.p1.y),T=Math.max(y.p0.y,y.p1.y);this._index.insert(x,T,y)}},Lu.prototype.query=function(){if(2===arguments.length){var a=arguments[0],h=arguments[1],y=new su;return this._index.query(a,h,y),y.getItems()}3===arguments.length&&this._index.query(arguments[0],arguments[1],arguments[2])},Lu.prototype.interfaces_=function(){return[]},Lu.prototype.getClass=function(){return Lu};var Zs=function(a){function h(){if(a.call(this),this._parentGeom=null,this._lineEdgeMap=new Wl,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new bu,2===arguments.length){var x=arguments[1],T=ni.OGC_SFS_BOUNDARY_RULE;this._argIndex=arguments[0],this._parentGeom=x,this._boundaryNodeRule=T,null!==x&&this.add(x)}else if(3===arguments.length){var j=arguments[1],ce=arguments[2];this._argIndex=arguments[0],this._parentGeom=j,this._boundaryNodeRule=ce,null!==j&&this.add(j)}}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.insertBoundaryPoint=function(y,x){var T=this._nodes.addNode(x).getLabel(),F=1;T.getLocation(y,pn.ON)===Ae.BOUNDARY&&F++;var j=h.determineBoundary(this._boundaryNodeRule,F);T.setLocation(y,j)},h.prototype.computeSelfNodes=function(){if(2===arguments.length)return this.computeSelfNodes(arguments[0],arguments[1],!1);if(3===arguments.length){var F=arguments[1],j=arguments[2],ce=new no(arguments[0],!0,!1);return ce.setIsDoneIfProperInt(j),this.createEdgeSetIntersector().computeIntersections(this._edges,ce,F||!(this._parentGeom instanceof ta||this._parentGeom instanceof Jo||this._parentGeom instanceof Gs)),this.addSelfIntersectionNodes(this._argIndex),ce}},h.prototype.computeSplitEdges=function(y){for(var x=this._edges.iterator();x.hasNext();)x.next().eiList.addSplitEdges(y)},h.prototype.computeEdgeIntersections=function(y,x,T){var F=new no(x,T,!0);return F.setBoundaryNodes(this.getBoundaryNodes(),y.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,y._edges,F),F},h.prototype.getGeometry=function(){return this._parentGeom},h.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},h.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},h.prototype.addPoint=function(){if(arguments[0]instanceof Ko){var y=arguments[0].getCoordinate();this.insertPoint(this._argIndex,y,Ae.INTERIOR)}else arguments[0]instanceof Q&&this.insertPoint(this._argIndex,arguments[0],Ae.INTERIOR)},h.prototype.addPolygon=function(y){this.addPolygonRing(y.getExteriorRing(),Ae.EXTERIOR,Ae.INTERIOR);for(var x=0;x<y.getNumInteriorRing();x++){var T=y.getInteriorRingN(x);this.addPolygonRing(T,Ae.INTERIOR,Ae.EXTERIOR)}},h.prototype.addEdge=function(y){this.insertEdge(y);var x=y.getCoordinates();this.insertPoint(this._argIndex,x[0],Ae.BOUNDARY),this.insertPoint(this._argIndex,x[x.length-1],Ae.BOUNDARY)},h.prototype.addLineString=function(y){var x=tt.removeRepeatedPoints(y.getCoordinates());if(x.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=x[0],null;var T=new al(x,new fi(this._argIndex,Ae.INTERIOR));this._lineEdgeMap.put(y,T),this.insertEdge(T),xe.isTrue(x.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,x[0]),this.insertBoundaryPoint(this._argIndex,x[x.length-1])},h.prototype.getInvalidPoint=function(){return this._invalidPoint},h.prototype.getBoundaryPoints=function(){for(var y=this.getBoundaryNodes(),x=new Array(y.size()).fill(null),T=0,F=y.iterator();F.hasNext();){var j=F.next();x[T++]=j.getCoordinate().copy()}return x},h.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},h.prototype.addSelfIntersectionNode=function(y,x,T){if(this.isBoundaryNode(y,x))return null;T===Ae.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(y,x):this.insertPoint(y,x,T)},h.prototype.addPolygonRing=function(y,x,T){if(y.isEmpty())return null;var F=tt.removeRepeatedPoints(y.getCoordinates());if(F.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=F[0],null;var j=x,ce=T;Gt.isCCW(F)&&(j=T,ce=x);var ke=new al(F,new fi(this._argIndex,Ae.BOUNDARY,j,ce));this._lineEdgeMap.put(y,ke),this.insertEdge(ke),this.insertPoint(this._argIndex,F[0],Ae.BOUNDARY)},h.prototype.insertPoint=function(y,x,T){var F=this._nodes.addNode(x),j=F.getLabel();null===j?F._label=new fi(y,T):j.setLocation(y,T)},h.prototype.createEdgeSetIntersector=function(){return new Ps},h.prototype.addSelfIntersectionNodes=function(y){for(var x=this._edges.iterator();x.hasNext();)for(var T=x.next(),F=T.getLabel().getLocation(y),j=T.eiList.iterator();j.hasNext();){var ce=j.next();this.addSelfIntersectionNode(y,ce.coord,F)}},h.prototype.add=function(){if(1!==arguments.length)return a.prototype.add.apply(this,arguments);var y=arguments[0];if(y.isEmpty())return null;if(y instanceof Gs&&(this._useBoundaryDeterminationRule=!1),y instanceof Jo)this.addPolygon(y);else if(y instanceof To)this.addLineString(y);else if(y instanceof Ko)this.addPoint(y);else if(y instanceof Sl)this.addCollection(y);else if(y instanceof du)this.addCollection(y);else if(y instanceof Gs)this.addCollection(y);else{if(!(y instanceof ai))throw new Error(y.getClass().getName());this.addCollection(y)}},h.prototype.addCollection=function(y){for(var x=0;x<y.getNumGeometries();x++){var T=y.getGeometryN(x);this.add(T)}},h.prototype.locate=function(y){return At(this._parentGeom,Ss)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new Eu(this._parentGeom)),this._areaPtLocator.locate(y)):this._ptLocator.locate(y,this._parentGeom)},h.prototype.findEdge=function(){return 1===arguments.length?this._lineEdgeMap.get(arguments[0]):a.prototype.findEdge.apply(this,arguments)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.determineBoundary=function(y,x){return y.isInBoundary(x)?Ae.BOUNDARY:Ae.INTERIOR},h}(Do),Rs=function(){if(this._li=new Vt,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var a=arguments[0];this.setComputationPrecision(a.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Zs(0,a)}else if(2===arguments.length){var h=arguments[0],y=arguments[1],x=ni.OGC_SFS_BOUNDARY_RULE;h.getPrecisionModel().compareTo(y.getPrecisionModel())>=0?this.setComputationPrecision(h.getPrecisionModel()):this.setComputationPrecision(y.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Zs(0,h,x),this._arg[1]=new Zs(1,y,x)}else if(3===arguments.length){var T=arguments[0],F=arguments[1],j=arguments[2];T.getPrecisionModel().compareTo(F.getPrecisionModel())>=0?this.setComputationPrecision(T.getPrecisionModel()):this.setComputationPrecision(F.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Zs(0,T,j),this._arg[1]=new Zs(1,F,j)}};Rs.prototype.getArgGeometry=function(a){return this._arg[a].getGeometry()},Rs.prototype.setComputationPrecision=function(a){this._resultPrecisionModel=a,this._li.setPrecisionModel(this._resultPrecisionModel)},Rs.prototype.interfaces_=function(){return[]},Rs.prototype.getClass=function(){return Rs};var Ou=function(){};Ou.prototype.interfaces_=function(){return[]},Ou.prototype.getClass=function(){return Ou},Ou.map=function(){if(arguments[0]instanceof Tn&&At(arguments[1],Ou.MapOp)){for(var a=arguments[0],h=arguments[1],y=new Ve,x=0;x<a.getNumGeometries();x++){var T=h.map(a.getGeometryN(x));null!==T&&y.add(T)}return a.getFactory().buildGeometry(y)}if(At(arguments[0],ye)&&At(arguments[1],Ou.MapOp)){for(var F=arguments[0],j=arguments[1],ce=new Ve,ke=F.iterator();ke.hasNext();){var ft=ke.next(),Lt=j.map(ft);null!==Lt&&ce.add(Lt)}return ce}},Ou.MapOp=function(){};var ur=function(a){function h(){var y=arguments[0];a.call(this,y,arguments[1]),this._ptLocator=new bu,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Wr,this._resultPolyList=new Ve,this._resultLineList=new Ve,this._resultPointList=new Ve,this._graph=new Do(new ou),this._geomFact=y.getFactory()}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.insertUniqueEdge=function(y){var x=this._edgeList.findEqualEdge(y);if(null!==x){var T=x.getLabel(),F=y.getLabel();x.isPointwiseEqual(y)||(F=new fi(y.getLabel())).flip();var j=x.getDepth();j.isNull()&&j.add(T),j.add(F),T.merge(F)}else this._edgeList.add(y)},h.prototype.getGraph=function(){return this._graph},h.prototype.cancelDuplicateResultEdges=function(){for(var y=this._graph.getEdgeEnds().iterator();y.hasNext();){var x=y.next(),T=x.getSym();x.isInResult()&&T.isInResult()&&(x.setInResult(!1),T.setInResult(!1))}},h.prototype.isCoveredByLA=function(y){return!!this.isCovered(y,this._resultLineList)||!!this.isCovered(y,this._resultPolyList)},h.prototype.computeGeometry=function(y,x,T,F){var j=new Ve;return j.addAll(y),j.addAll(x),j.addAll(T),j.isEmpty()?h.createEmptyResult(F,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(j)},h.prototype.mergeSymLabels=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();)y.next().getEdges().mergeSymLabels()},h.prototype.isCovered=function(y,x){for(var T=x.iterator();T.hasNext();){var F=T.next();if(this._ptLocator.locate(y,F)!==Ae.EXTERIOR)return!0}return!1},h.prototype.replaceCollapsedEdges=function(){for(var y=new Ve,x=this._edgeList.iterator();x.hasNext();){var T=x.next();T.isCollapsed()&&(x.remove(),y.add(T.getCollapsedEdge()))}this._edgeList.addAll(y)},h.prototype.updateNodeLabelling=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();){var x=y.next(),T=x.getEdges().getLabel();x.getLabel().merge(T)}},h.prototype.getResultGeometry=function(y){return this.computeOverlay(y),this._resultGeom},h.prototype.insertUniqueEdges=function(y){for(var x=y.iterator();x.hasNext();){var T=x.next();this.insertUniqueEdge(T)}},h.prototype.computeOverlay=function(y){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var x=new Ve;this._arg[0].computeSplitEdges(x),this._arg[1].computeSplitEdges(x),this.insertUniqueEdges(x),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),vr.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(y),this.cancelDuplicateResultEdges();var T=new xs(this._geomFact);T.add(this._graph),this._resultPolyList=T.getPolygons();var F=new ns(this,this._geomFact,this._ptLocator);this._resultLineList=F.build(y);var j=new ua(this,this._geomFact,this._ptLocator);this._resultPointList=j.build(y),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,y)},h.prototype.labelIncompleteNode=function(y,x){var T=this._ptLocator.locate(y.getCoordinate(),this._arg[x].getGeometry());y.getLabel().setLocation(x,T)},h.prototype.copyPoints=function(y){for(var x=this._arg[y].getNodeIterator();x.hasNext();){var T=x.next();this._graph.addNode(T.getCoordinate()).setLabel(y,T.getLabel().getLocation(y))}},h.prototype.findResultAreaEdges=function(y){for(var x=this._graph.getEdgeEnds().iterator();x.hasNext();){var T=x.next(),F=T.getLabel();F.isArea()&&!T.isInteriorAreaEdge()&&h.isResultOfOp(F.getLocation(0,pn.RIGHT),F.getLocation(1,pn.RIGHT),y)&&T.setInResult(!0)}},h.prototype.computeLabelsFromDepths=function(){for(var y=this._edgeList.iterator();y.hasNext();){var x=y.next(),T=x.getLabel(),F=x.getDepth();if(!F.isNull()){F.normalize();for(var j=0;j<2;j++)T.isNull(j)||!T.isArea()||F.isNull(j)||(0===F.getDelta(j)?T.toLine(j):(xe.isTrue(!F.isNull(j,pn.LEFT),"depth of LEFT side has not been initialized"),T.setLocation(j,pn.LEFT,F.getLocation(j,pn.LEFT)),xe.isTrue(!F.isNull(j,pn.RIGHT),"depth of RIGHT side has not been initialized"),T.setLocation(j,pn.RIGHT,F.getLocation(j,pn.RIGHT))))}}},h.prototype.computeLabelling=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();)y.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},h.prototype.labelIncompleteNodes=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();){var x=y.next(),T=x.getLabel();x.isIsolated()&&(T.isNull(0)?this.labelIncompleteNode(x,0):this.labelIncompleteNode(x,1)),x.getEdges().updateLabelling(T)}},h.prototype.isCoveredByA=function(y){return!!this.isCovered(y,this._resultPolyList)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Rs);ur.overlayOp=function(a,h,y){return new ur(a,h).getResultGeometry(y)},ur.intersection=function(a,h){if(a.isEmpty()||h.isEmpty())return ur.createEmptyResult(ur.INTERSECTION,a,h,a.getFactory());if(a.isGeometryCollection()){var y=h;return fo.map(a,{interfaces_:function(){return[Ou.MapOp]},map:function(x){return x.intersection(y)}})}return a.checkNotGeometryCollection(a),a.checkNotGeometryCollection(h),Xo.overlayOp(a,h,ur.INTERSECTION)},ur.symDifference=function(a,h){if(a.isEmpty()||h.isEmpty()){if(a.isEmpty()&&h.isEmpty())return ur.createEmptyResult(ur.SYMDIFFERENCE,a,h,a.getFactory());if(a.isEmpty())return h.copy();if(h.isEmpty())return a.copy()}return a.checkNotGeometryCollection(a),a.checkNotGeometryCollection(h),Xo.overlayOp(a,h,ur.SYMDIFFERENCE)},ur.resultDimension=function(a,h,y){var x=h.getDimension(),T=y.getDimension(),F=-1;switch(a){case ur.INTERSECTION:F=Math.min(x,T);break;case ur.UNION:F=Math.max(x,T);break;case ur.DIFFERENCE:F=x;break;case ur.SYMDIFFERENCE:F=Math.max(x,T)}return F},ur.createEmptyResult=function(a,h,y,x){var T=null;switch(ur.resultDimension(a,h,y)){case-1:T=x.createGeometryCollection(new Array(0).fill(null));break;case 0:T=x.createPoint();break;case 1:T=x.createLineString();break;case 2:T=x.createPolygon()}return T},ur.difference=function(a,h){return a.isEmpty()?ur.createEmptyResult(ur.DIFFERENCE,a,h,a.getFactory()):h.isEmpty()?a.copy():(a.checkNotGeometryCollection(a),a.checkNotGeometryCollection(h),Xo.overlayOp(a,h,ur.DIFFERENCE))},ur.isResultOfOp=function(){if(2===arguments.length){var a=arguments[0],h=arguments[1],y=a.getLocation(0),x=a.getLocation(1);return ur.isResultOfOp(y,x,h)}if(3===arguments.length){var T=arguments[0],F=arguments[1];switch(T===Ae.BOUNDARY&&(T=Ae.INTERIOR),F===Ae.BOUNDARY&&(F=Ae.INTERIOR),arguments[2]){case ur.INTERSECTION:return T===Ae.INTERIOR&&F===Ae.INTERIOR;case ur.UNION:return T===Ae.INTERIOR||F===Ae.INTERIOR;case ur.DIFFERENCE:return T===Ae.INTERIOR&&F!==Ae.INTERIOR;case ur.SYMDIFFERENCE:return T===Ae.INTERIOR&&F!==Ae.INTERIOR||T!==Ae.INTERIOR&&F===Ae.INTERIOR}return!1}},ur.INTERSECTION=1,ur.UNION=2,ur.DIFFERENCE=3,ur.SYMDIFFERENCE=4;var Ra=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new bu,this._seg=new Hn;var a=arguments[0],h=arguments[1];this._g=a,this._boundaryDistanceTolerance=h,this._linework=this.extractLinework(a)};Ra.prototype.isWithinToleranceOfBoundary=function(a){for(var h=0;h<this._linework.getNumGeometries();h++)for(var y=this._linework.getGeometryN(h).getCoordinateSequence(),x=0;x<y.size()-1;x++)if(y.getCoordinate(x,this._seg.p0),y.getCoordinate(x+1,this._seg.p1),this._seg.distance(a)<=this._boundaryDistanceTolerance)return!0;return!1},Ra.prototype.getLocation=function(a){return this.isWithinToleranceOfBoundary(a)?Ae.BOUNDARY:this._ptLocator.locate(a,this._g)},Ra.prototype.extractLinework=function(a){var h=new Vs;a.apply(h);var y=h.getLinework(),x=Bn.toLineStringArray(y);return a.getFactory().createMultiLineString(x)},Ra.prototype.interfaces_=function(){return[]},Ra.prototype.getClass=function(){return Ra};var Vs=function(){this._linework=null,this._linework=new Ve};Vs.prototype.getLinework=function(){return this._linework},Vs.prototype.filter=function(a){if(a instanceof Jo){var h=a;this._linework.add(h.getExteriorRing());for(var y=0;y<h.getNumInteriorRing();y++)this._linework.add(h.getInteriorRingN(y))}},Vs.prototype.interfaces_=function(){return[Cs]},Vs.prototype.getClass=function(){return Vs};var Nu=function(){this._g=null,this._doLeft=!0,this._doRight=!0,this._g=arguments[0]};Nu.prototype.extractPoints=function(a,h,y){for(var x=a.getCoordinates(),T=0;T<x.length-1;T++)this.computeOffsetPoints(x[T],x[T+1],h,y)},Nu.prototype.setSidesToGenerate=function(a,h){this._doLeft=a,this._doRight=h},Nu.prototype.getPoints=function(a){for(var h=new Ve,y=Us.getLines(this._g).iterator();y.hasNext();){var x=y.next();this.extractPoints(x,a,h)}return h},Nu.prototype.computeOffsetPoints=function(a,h,y,x){var T=h.x-a.x,F=h.y-a.y,j=Math.sqrt(T*T+F*F),ce=y*T/j,ke=y*F/j,ft=(h.x+a.x)/2,Lt=(h.y+a.y)/2;if(this._doLeft){var $t=new Q(ft-ke,Lt+ce);x.add($t)}if(this._doRight){var Pn=new Q(ft+ke,Lt-ce);x.add(Pn)}},Nu.prototype.interfaces_=function(){return[]},Nu.prototype.getClass=function(){return Nu};var La=function a(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=a.TOLERANCE,this._testCoords=new Ve;var h=arguments[0],y=arguments[1],x=arguments[2];this._boundaryDistanceTolerance=a.computeBoundaryDistanceTolerance(h,y),this._geom=[h,y,x],this._locFinder=[new Ra(this._geom[0],this._boundaryDistanceTolerance),new Ra(this._geom[1],this._boundaryDistanceTolerance),new Ra(this._geom[2],this._boundaryDistanceTolerance)]},bf={TOLERANCE:{configurable:!0}};La.prototype.reportResult=function(a,h,y){cn.out.println("Overlay result invalid - A:"+Ae.toLocationSymbol(h[0])+" B:"+Ae.toLocationSymbol(h[1])+" expected:"+(y?"i":"e")+" actual:"+Ae.toLocationSymbol(h[2]))},La.prototype.isValid=function(a){return this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]),this.checkValid(a)},La.prototype.checkValid=function(){if(1===arguments.length){for(var a=arguments[0],h=0;h<this._testCoords.size();h++){var y=this._testCoords.get(h);if(!this.checkValid(a,y))return this._invalidLocation=y,!1}return!0}if(2===arguments.length){var x=arguments[0],T=arguments[1];return this._location[0]=this._locFinder[0].getLocation(T),this._location[1]=this._locFinder[1].getLocation(T),this._location[2]=this._locFinder[2].getLocation(T),!!La.hasLocation(this._location,Ae.BOUNDARY)||this.isValidResult(x,this._location)}},La.prototype.addTestPts=function(a){var h=new Nu(a);this._testCoords.addAll(h.getPoints(5*this._boundaryDistanceTolerance))},La.prototype.isValidResult=function(a,h){var y=ur.isResultOfOp(h[0],h[1],a),x=!(y^h[2]===Ae.INTERIOR);return x||this.reportResult(a,h,y),x},La.prototype.getInvalidLocation=function(){return this._invalidLocation},La.prototype.interfaces_=function(){return[]},La.prototype.getClass=function(){return La},La.hasLocation=function(a,h){for(var y=0;y<3;y++)if(a[y]===h)return!0;return!1},La.computeBoundaryDistanceTolerance=function(a,h){return Math.min(xr.computeSizeBasedSnapTolerance(a),xr.computeSizeBasedSnapTolerance(h))},La.isValid=function(a,h,y,x){return new La(a,h,x).isValid(y)},bf.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(La,bf);var Oa=function a(h){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=a.extractFactory(h),this._inputGeoms=h};Oa.prototype.extractElements=function(a,h){if(null===a)return null;for(var y=0;y<a.getNumGeometries();y++){var x=a.getGeometryN(y);this._skipEmpty&&x.isEmpty()||h.add(x)}},Oa.prototype.combine=function(){for(var a=new Ve,h=this._inputGeoms.iterator();h.hasNext();){var y=h.next();this.extractElements(y,a)}return 0===a.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(a)},Oa.prototype.interfaces_=function(){return[]},Oa.prototype.getClass=function(){return Oa},Oa.combine=function(){return 1===arguments.length?new Oa(arguments[0]).combine():2===arguments.length?new Oa(Oa.createList(arguments[0],arguments[1])).combine():3===arguments.length?new Oa(Oa.createList(arguments[0],arguments[1],arguments[2])).combine():void 0},Oa.extractFactory=function(a){return a.isEmpty()?null:a.iterator().next().getFactory()},Oa.createList=function(){if(2===arguments.length){var a=arguments[0],h=arguments[1],y=new Ve;return y.add(a),y.add(h),y}if(3===arguments.length){var x=arguments[0],T=arguments[1],F=arguments[2],j=new Ve;return j.add(x),j.add(T),j.add(F),j}};var so=function(){this._inputPolys=null,this._geomFactory=null,this._inputPolys=arguments[0],null===this._inputPolys&&(this._inputPolys=new Ve)},rd={STRTREE_NODE_CAPACITY:{configurable:!0}};so.prototype.reduceToGeometries=function(a){for(var h=new Ve,y=a.iterator();y.hasNext();){var x=y.next(),T=null;At(x,rt)?T=this.unionTree(x):x instanceof Tn&&(T=x),h.add(T)}return h},so.prototype.extractByEnvelope=function(a,h,y){for(var x=new Ve,T=0;T<h.getNumGeometries();T++){var F=h.getGeometryN(T);F.getEnvelopeInternal().intersects(a)?x.add(F):y.add(F)}return this._geomFactory.buildGeometry(x)},so.prototype.unionOptimized=function(a,h){var y=a.getEnvelopeInternal(),x=h.getEnvelopeInternal();if(!y.intersects(x))return Oa.combine(a,h);if(a.getNumGeometries()<=1&&h.getNumGeometries()<=1)return this.unionActual(a,h);var T=y.intersection(x);return this.unionUsingEnvelopeIntersection(a,h,T)},so.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var a=new cc(so.STRTREE_NODE_CAPACITY),h=this._inputPolys.iterator();h.hasNext();){var y=h.next();a.insert(y.getEnvelopeInternal(),y)}this._inputPolys=null;var x=a.itemsTree();return this.unionTree(x)},so.prototype.binaryUnion=function(){if(1===arguments.length){var a=arguments[0];return this.binaryUnion(a,0,a.size())}if(3===arguments.length){var h=arguments[0],y=arguments[1],x=arguments[2];if(x-y<=1){var T=so.getGeometry(h,y);return this.unionSafe(T,null)}if(x-y==2)return this.unionSafe(so.getGeometry(h,y),so.getGeometry(h,y+1));var F=Math.trunc((x+y)/2),j=this.binaryUnion(h,y,F),ce=this.binaryUnion(h,F,x);return this.unionSafe(j,ce)}},so.prototype.repeatedUnion=function(a){for(var h=null,y=a.iterator();y.hasNext();){var x=y.next();h=null===h?x.copy():h.union(x)}return h},so.prototype.unionSafe=function(a,h){return null===a&&null===h?null:null===a?h.copy():null===h?a.copy():this.unionOptimized(a,h)},so.prototype.unionActual=function(a,h){return so.restrictToPolygons(a.union(h))},so.prototype.unionTree=function(a){var h=this.reduceToGeometries(a);return this.binaryUnion(h)},so.prototype.unionUsingEnvelopeIntersection=function(a,h,y){var x=new Ve,T=this.extractByEnvelope(y,a,x),F=this.extractByEnvelope(y,h,x),j=this.unionActual(T,F);return x.add(j),Oa.combine(x)},so.prototype.bufferUnion=function(){if(1===arguments.length){var a=arguments[0];return a.get(0).getFactory().buildGeometry(a).buffer(0)}if(2===arguments.length){var h=arguments[0],y=arguments[1];return h.getFactory().createGeometryCollection([h,y]).buffer(0)}},so.prototype.interfaces_=function(){return[]},so.prototype.getClass=function(){return so},so.restrictToPolygons=function(a){if(At(a,Ss))return a;var h=Ws.getPolygons(a);return 1===h.size()?h.get(0):a.getFactory().createMultiPolygon(Bn.toPolygonArray(h))},so.getGeometry=function(a,h){return h>=a.size()?null:a.get(h)},so.union=function(a){return new so(a).union()},rd.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(so,rd);var ah=function(){};ah.prototype.interfaces_=function(){return[]},ah.prototype.getClass=function(){return ah},ah.union=function(a,h){if(a.isEmpty()||h.isEmpty()){if(a.isEmpty()&&h.isEmpty())return ur.createEmptyResult(ur.UNION,a,h,a.getFactory());if(a.isEmpty())return h.copy();if(h.isEmpty())return a.copy()}return a.checkNotGeometryCollection(a),a.checkNotGeometryCollection(h),Xo.overlayOp(a,h,ur.UNION)},pe.GeoJSONReader=$n,pe.GeoJSONWriter=eh,pe.OverlayOp=ur,pe.UnionOp=ah,pe.BufferOp=ws,Object.defineProperty(pe,"__esModule",{value:!0})}(Qe)},4703:bt=>{bt.exports=function pe(){for(var he={},de=0;de<arguments.length;de++){var _e=arguments[de];for(var p in _e)Qe.call(_e,p)&&(he[p]=_e[p])}return he};var Qe=Object.prototype.hasOwnProperty},9652:(bt,Qe,pe)=>{"use strict";pe.d(Qe,{x0:()=>p});let p=(H=21)=>crypto.getRandomValues(new Uint8Array(H)).reduce((fe,ve)=>fe+((ve&=63)<36?ve.toString(36):ve<62?(ve-26).toString(36).toUpperCase():ve>62?"-":"_"),"")}},bt=>{bt(bt.s=6198)}]);