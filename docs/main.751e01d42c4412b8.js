(self.webpackChunkmap_app=self.webpackChunkmap_app||[]).push([[179],{6089:(Dt,ot,ve)=>{"use strict";var me=ve(9095),q=ve(4703),Ee="value",p="\n  ",J={};function ye(le){var K=Array.isArray(le);return function(ee){var ae=Ce(J.plainArray,ee);if(ae)return ae;if(K&&ee.length!==le.length)return"an array with "+le.length+" items";for(var oe=0;oe<ee.length;oe++)if(ae=Ce(K?le[oe]:le,ee[oe]))return[oe].concat(ae)}}function Ce(le,K){if(null!=K||le.hasOwnProperty("__required")){var ne=le(K);if(ne)return Array.isArray(ne)?ne:[ne]}}function Pe(le,K){var ne=le.length,ce=le[ne-1],ee=le.slice(0,ne-1);return 0===ee.length&&(ee=[Ee]),K=q(K,{path:ee}),"function"==typeof ce?ce(K):st(K,function It(le){return"must be "+function gt(le){return/^an? /.test(le)?le:/^[aeiou]/i.test(le)?"an "+le:/^[a-z]/i.test(le)?"a "+le:le}(le)+"."}(ce))}function st(le,K){return(mt(le.path)?"Item at position ":"")+le.path.join(".")+" "+K}function mt(le){return"number"==typeof le[le.length-1]||"number"==typeof le[0]}J.assert=function(le,K){return K=K||{},function(ne){var ce=Ce(le,ne);if(ce){var ee=Pe(ce,K);throw K.apiName&&(ee=K.apiName+": "+ee),new Error(ee)}}},J.shape=function(K){var ne=function Mt(le){return Object.keys(le||{}).map(function(K){return{key:K,value:le[K]}})}(K);return function(ee){var ae=Ce(J.plainObject,ee);if(ae)return ae;for(var oe,_e=[],re=0;re<ne.length;re++)(ae=Ce(ne[re].value,ee[oe=ne[re].key]))&&_e.push([oe].concat(ae));return _e.length<2?_e[0]:function(Je){_e=_e.map(function(Ne){return"- "+Ne[0]+": "+Pe(Ne,Je).split("\n").join(p)});var He=Je.path.join(".");return"The following properties"+(He===Ee?"":" of "+He)+" have invalid values:"+p+_e.join(p)}}},J.strictShape=function(K){var ne=J.shape(K);return function(ee){var ae=ne(ee);if(ae)return ae;var oe=Object.keys(ee).reduce(function(te,_e){return void 0===K[_e]&&te.push(_e),te},[]);return 0!==oe.length?function(){return"The following keys are invalid: "+oe.join(", ")}:void 0}},J.arrayOf=function(K){return ye(K)},J.tuple=function(){return ye(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments))},J.required=function(K){function ne(ce){return null==ce?function(ee){return st(ee,mt(ee.path)?"cannot be undefined/null.":"is required.")}:K.apply(this,arguments)}return ne.__required=!0,ne},J.oneOfType=function(){var K=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(ce){var ee=K.map(function(ae){return Ce(ae,ce)}).filter(Boolean);if(ee.length===K.length)return ee.every(function(ae){return 1===ae.length&&"string"==typeof ae[0]})?function qe(le){return le.length<2?le[0]:2===le.length?le.join(" or "):le.slice(0,-1).join(", ")+", or "+le.slice(-1)}(ee.map(function(ae){return ae[0]})):ee.reduce(function(ae,oe){return oe.length>ae.length?oe:ae})}},J.equal=function(K){return function(ce){if(ce!==K)return JSON.stringify(K)}},J.oneOf=function(){var ne=(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments)).map(function(ce){return J.equal(ce)});return J.oneOfType.apply(this,ne)},J.range=function(K){var ne=K[0],ce=K[1];return function(ae){if(Ce(J.number,ae)||ae<ne||ae>ce)return"number between "+ne+" & "+ce+" (inclusive)"}},J.any=function(){},J.boolean=function(K){if("boolean"!=typeof K)return"boolean"},J.number=function(K){if("number"!=typeof K)return"number"},J.plainArray=function(K){if(!Array.isArray(K))return"array"},J.plainObject=function(K){if(!me(K))return"object"},J.string=function(K){if("string"!=typeof K)return"string"},J.func=function(K){if("function"!=typeof K)return"function"},J.validate=Ce,J.processMessage=Pe,Dt.exports=J},9095:Dt=>{"use strict";var ot=Object.prototype.toString;Dt.exports=function(ve){var me;return"[object Object]"===ot.call(ve)&&(null===(me=Object.getPrototypeOf(ve))||me===Object.getPrototypeOf({}))}},2564:(Dt,ot,ve)=>{"use strict";var me=ve(9652).x0;function q(Ee){this.origin=Ee.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=Ee.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=Ee,this.send=this.send.bind(this),this.countries=Ee.countries?Ee.countries.split(","):null,this.types=Ee.types?Ee.types.split(","):null,this.bbox=Ee.bbox?Ee.bbox:null,this.language=Ee.language?Ee.language.split(","):null,this.limit=Ee.limit?+Ee.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(Ee),this.eventQueue=new Array,this.flushInterval=Ee.flushInterval||1e3,this.maxQueueSize=Ee.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}q.prototype={select:function(Ee,p){var J=this.getSelectedIndex(Ee,p),ye=this.getEventPayload("search.select",p);if(ye.resultIndex=J,ye.resultPlaceName=Ee.place_name,ye.resultId=Ee.id,(J!==this.lastSentIndex||ye.queryString!==this.lastSentInput)&&-1!=J&&(this.lastSentIndex=J,this.lastSentInput=ye.queryString,ye.queryString))return this.push(ye)},start:function(Ee){var p=this.getEventPayload("search.start",Ee);if(p.queryString)return this.push(p)},keyevent:function(Ee,p){if(Ee.key&&!Ee.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(Ee.keyCode)){var J=this.getEventPayload("search.keystroke",p);if(J.lastAction=Ee.key,J.queryString)return this.push(J)}},send:function(Ee,p){if(!this.enableEventLogging)return p?p():void 0;var J=this.getRequestOptions(Ee);this.request(J,function(ye){return ye?this.handleError(ye,p):p?p():void 0}.bind(this))},getRequestOptions:function(Ee){return Array.isArray(Ee)||(Ee=[Ee]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(Ee)}},getEventPayload:function(Ee,p){var J;J=p.options.proximity?"object"==typeof p.options.proximity?[p.options.proximity.longitude,p.options.proximity.latitude]:"ip"===p.options.proximity?[999,999]:p.options.proximity:null;var ye=p._map?p._map.getZoom():void 0,Ce={event:Ee,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:p.options.autocomplete,fuzzyMatch:p.options.fuzzyMatch,proximity:J,limit:p.options.limit,routing:p.options.routing,worldview:p.options.worldview,mapZoom:ye,keyboardLocale:this.locale};return Ce.queryString="search.select"===Ee?p.inputString:"search.select"!=Ee&&p._inputEl?p._inputEl.value:p.inputString,Ce},request:function(Ee,p){var J=new XMLHttpRequest;for(var ye in J.onreadystatechange=function(){if(4==this.readyState)return p(204==this.status?null:this.statusText)},J.open(Ee.method,Ee.host+"/"+Ee.path,!0),Ee.headers)J.setRequestHeader(ye,Ee.headers[ye]);J.send(Ee.body)},handleError:function(Ee,p){if(p)return p(Ee)},generateSessionID:function(){return me()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(Ee,p){if(p._typeahead){var ye=Ee.id;return p._typeahead.data.map(function(qe){return qe.id}).indexOf(ye)}},shouldEnableLogging:function(Ee){return!(!1===Ee.enableEventLogging||Ee.origin&&"https://api.mapbox.com"!==Ee.origin||Ee.localGeocoder||Ee.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(Ee,p){this.eventQueue.push(Ee),(this.eventQueue.length>=this.maxQueueSize||p)&&this.flush()},remove:function(){this.flush()}},Dt.exports=q},3424:Dt=>{Dt.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},3569:Dt=>{function ot(){}ot.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const ve={enableHighAccuracy:!0};return new Promise(function(me,q){window.navigator.geolocation.getCurrentPosition(me,q,ve)})}},Dt.exports=ot},8545:(Dt,ot,ve)=>{"use strict";var me=ve(5562),q=ve(3082),Ee=ve(4703),p=ve(9069).EventEmitter,J=ve(3424),ye=ve(9471),Ce=ve(7075),Pe=ve(2564),qe=ve(1753),It=ve(6775),gt=ve(3569),st=ve(2777);function le(K){this._eventEmitter=new p,this.options=Ee({},this.options,K),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new gt}le.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(K){return K.place_name},render:function(K){var ne=K.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+ne[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+ne.splice(1,ne.length).join(",")+"</div></div>"}},addTo:function(K){function ne(ce,ee){if(!document.body.contains(ee))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const ae=ce.onAdd();ee.appendChild(ae)}if(K._controlContainer)K.addControl(this);else if(K instanceof HTMLElement)ne(this,K);else{if("string"!=typeof K)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");{const ce=document.querySelectorAll(K);if(0===ce.length)throw new Error("Element ",K,"not found.");if(ce.length>1)throw new Error("Geocoder can only be added to a single html element");ne(this,ce[0])}}},onAdd:function(K){if(K&&"string"!=typeof K&&(this._map=K),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=Ce(ye({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new Pe(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var ne=this.container=document.createElement("div");ne.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var ce=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",q(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(Je){this.eventManager.keyevent(Je,this)}.bind(this));var ee=document.createElement("div");ee.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var ae=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(ae),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),ee.appendChild(this._clearEl),ee.appendChild(this._loadingEl),ne.appendChild(ce),ne.appendChild(this._inputEl),ne.appendChild(ee),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var oe=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(oe),ee.appendChild(this._geolocateEl),this._showGeolocateButton()}var te=this._typeahead=new me(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),te.getItemValue=this.options.getItemValue;var _e=te.list.draw,re=this._footerNode=function Mt(){var K=document.createElement("div");return K.className="mapboxgl-ctrl-geocoder--powered-by",K.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',K}();return te.list.draw=function(){_e.call(this),re.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),re.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(re)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),ne},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(K){this._hideLoadingIcon();const ne={geometry:{type:"Point",coordinates:[K.coords.longitude,K.coords.latitude]}};this._handleMarker(ne),this._fly(ne),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(ne),this._showClearButton(),this.fresh=!1;const ce={limit:1,language:[this.options.language],query:ne.geometry.coordinates,types:["address"]};this.options.localGeocoderOnly?(this._setInputValue(ne.geometry.coordinates[0]+","+ne.geometry.coordinates[1]),this._eventEmitter.emit("result",{result:ne})):this.geocoderService.reverseGeocode(ce).send().then(function(ee){const ae=ee.body.features[0];if(ae){const oe=st.transformFeatureToGeolocationText(ae,this.options.addressAccuracy);this._setInputValue(oe),ae.user_coordinates=ne.geometry.coordinates,this._eventEmitter.emit("result",{result:ae})}else this._eventEmitter.emit("result",{result:{user_coordinates:ne.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(K){1===K.code?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(K,ne){var ce=document.createElementNS("http://www.w3.org/2000/svg","svg");return ce.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+K),ce.setAttribute("viewBox","0 0 18 18"),ce.setAttribute("xml:space","preserve"),ce.setAttribute("width",18),ce.setAttribute("height",18),ce.innerHTML=ne,ce},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(K){this._inputEl.value=K,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(K){var ne=(K.clipboardData||window.clipboardData).getData("text");ne.length>=this.options.minLength&&this._geocode(ne)},_onKeyDown:function(K){var ne=27,ce=9;if(K.keyCode===ne&&this.options.clearAndBlurOnEsc)return this._clear(K),this._inputEl.blur();var ee=K.target&&K.target.shadowRoot?K.target.shadowRoot.activeElement:K.target;if(!ee||!ee.value)return this.fresh=!0,K.keyCode!==ce&&this.clear(K),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!K.metaKey&&-1===[ce,ne,37,39,13,38,40].indexOf(K.keyCode)&&ee.value.length>=this.options.minLength&&this._geocode(ee.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(K){this.options.clearOnBlur&&this._clearOnBlur(K),this.options.collapsed&&this._collapse()},_onChange:function(){var K=this._typeahead.selected;K&&JSON.stringify(K)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(K),this.options.marker&&this._mapboxgl&&this._handleMarker(K),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(K),this._eventEmitter.emit("result",{result:K}),this.eventManager.select(K,this))},_fly:function(K){var ne;if(K.properties&&J[K.properties.short_code])ne=Ee({},this.options.flyTo),this._map&&this._map.fitBounds(J[K.properties.short_code].bbox,ne);else if(K.bbox){var ce=K.bbox;ne=Ee({},this.options.flyTo),this._map&&this._map.fitBounds([[ce[0],ce[1]],[ce[2],ce[3]]],ne)}else ne=Ee({},{zoom:this.options.zoom},this.options.flyTo),K.center?ne.center=K.center:K.geometry&&K.geometry.type&&"Point"===K.geometry.type&&K.geometry.coordinates&&(ne.center=K.geometry.coordinates),this._map&&this._map.flyTo(ne)},_requestType:function(K,ne){return K.localGeocoderOnly?1:K.reverseGeocode&&st.REVERSE_GEOCODE_COORD_RGX.test(ne)?2:0},_setupConfig:function(K,ne){const ee=/[\s,]+/;var ae=this,oe=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce(function(_e,re){return null==ae.options[re]||(_e[re]=["countries","types","language"].indexOf(re)>-1?ae.options[re].split(ee):ae.options[re],"proximity"===re&&"number"==typeof ae.options[re].longitude&&"number"==typeof ae.options[re].latitude&&(_e[re]=[ae.options[re].longitude,ae.options[re].latitude])),_e},{});switch(K){case 2:var te=ne.split(ee).map(function(_e){return parseFloat(_e,10)});ae.options.flipCoordinates||te.reverse(),oe=Ee(oe,{query:te,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(_e){_e in oe&&delete oe[_e]});break;case 0:{const _e=ne.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(_e)&&(ne=ne.replace(/,/g," ")),oe=Ee(oe,{query:ne})}}return oe},_geocode:function(K){this.inputString=K,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:K});const ne=this._requestType(this.options,K),ce=this._setupConfig(ne,K);var ee;switch(ne){case 1:ee=Promise.resolve();break;case 0:ee=this.geocoderService.forwardGeocode(ce).send();break;case 2:ee=this.geocoderService.reverseGeocode(ce).send()}var ae=this.options.localGeocoder&&this.options.localGeocoder(K)||[],oe=[],te=null;return ee.catch(function(_e){te=_e}.bind(this)).then(function(_e){this._hideLoadingIcon();var re={};return _e?"200"==_e.statusCode&&((re=_e.body).request=_e.request,re.headers=_e.headers):re={type:"FeatureCollection",features:[]},re.config=ce,this.fresh&&(this.eventManager.start(this),this.fresh=!1),re.features=re.features?ae.concat(re.features):ae,this.options.externalGeocoder?(oe=this.options.externalGeocoder(K,re.features)||Promise.resolve([])).then(function(Je){return re.features=re.features?Je.concat(re.features):Je,re},function(){return re}):re}.bind(this)).then(function(_e){if(te)throw te;this.options.filter&&_e.features.length&&(_e.features=_e.features.filter(this.options.filter)),_e.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",_e),this._typeahead.update(_e.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",_e))}.bind(this)).catch(function(_e){this._hideLoadingIcon(),this._hideAttribution(),ae.length&&this.options.localGeocoder||oe.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(ae)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:ae}),this._eventEmitter.emit("error",{error:_e})}.bind(this)),ee},_clear:function(K){K&&K.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(K){this._clear(K),this._inputEl.focus()},_clearOnBlur:function(K){K.relatedTarget&&this._clear(K)},_onQueryResult:function(K){var ne=K.body;if(ne.features.length){var ce=ne.features[0];this._typeahead.selected=ce,this._inputEl.value=ce.place_name,this._onChange()}},_updateProximity:function(){if(this._map&&this.options.trackProximity)if(this._map.getZoom()>9){var K=this._map.getCenter().wrap();this.setProximity({longitude:K.lng,latitude:K.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(K){return this._geocode(K).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderLocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderUserDeniedGeolocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>")},_renderMessage:function(K){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(K)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var K=this.options.language.split(",")[0],ne=It.language(K),ce=qe.placeholder[ne];if(ce)return ce}return"Search"},setInput:function(K){return this._inputEl.value=K,this._typeahead.selected=null,this._typeahead.clear(),K.length>=this.options.minLength&&this._geocode(K),this},setProximity:function(K,ne=!0){return this.options.proximity=K,ne&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(K){return K&&"function"==typeof K&&(this._typeahead.render=K),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(K){var ne=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=K||this.options.language||ne,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(K){return this.options.zoom=K,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(K){return this.options.flyTo=K,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(K){return this.placeholder=K||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(K){return this.options.bbox=K,this},getCountries:function(){return this.options.countries},setCountries:function(K){return this.options.countries=K,this},getTypes:function(){return this.options.types},setTypes:function(K){return this.options.types=K,this},getMinLength:function(){return this.options.minLength},setMinLength:function(K){return this.options.minLength=K,this._typeahead&&(this._typeahead.options.minLength=K),this},getLimit:function(){return this.options.limit},setLimit:function(K){return this.options.limit=K,this._typeahead&&(this._typeahead.options.limit=K),this},getFilter:function(){return this.options.filter},setFilter:function(K){return this.options.filter=K,this},setOrigin:function(K){return this.options.origin=K,this.geocoderService=Ce(ye({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(K){return this.options.accessToken=K,this.geocoderService=Ce(ye({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(K){return this.options.autocomplete=K,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(K){return this.options.fuzzyMatch=K,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(K){return this.options.routing=K,this},getRouting:function(){return this.options.routing},setWorldview:function(K){return this.options.worldview=K,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(K){if(this._map){this._removeMarker();var ce=Ee({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(ce),K.center?this.mapMarker.setLngLat(K.center).addTo(this._map):K.geometry&&K.geometry.type&&"Point"===K.geometry.type&&K.geometry.coordinates&&this.mapMarker.setLngLat(K.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(K,ne){return this._eventEmitter.on(K,ne),this},off:function(K,ne){return this._eventEmitter.removeListener(K,ne),this.eventManager.remove(),this}},Dt.exports=le},1753:Dt=>{"use strict";Dt.exports={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05dc\u05d7\u05e4\u05e9",ja:"\u30b5\u30fc\u30c1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041f\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641c\u7d22",cs:"Vyhled\xe1v\xe1n\xed",hu:"Keres\xe9s",ka:"\u10eb\u10d8\u10d4\u10d1\u10d0",nb:"S\xf8ke",sk:"Vyh\u013ead\xe1vanie",th:"\u0e04\u0e49\u0e19\u0e2b\u0e32",fi:"Hae",is:"Leita",ko:"\uc218\uc0c9",pl:"Szukaj",sl:"Iskanje",fa:"\u062c\u0633\u062a\u062c\u0648",ru:"\u041f\u043e\u0438\u0441\u043a"}}},2777:Dt=>{function ve(q){const Ee=q.address||"",p=q.text||"",J=q.place_name||"",Ce={address:J.split(",")[0],houseNumber:Ee,street:p,placeName:J};return q.context.forEach(function(Pe){const qe=Pe.id.split(".")[0];Ce[qe]=Pe.text}),Ce}Dt.exports={transformFeatureToGeolocationText:function ot(q,Ee){const p=ve(q),J=["address","street","place","country"];if("function"==typeof Ee)return Ee(p);const Ce=J.indexOf(Ee);return(-1===Ce?J:J.slice(Ce)).reduce(function(Pe,qe){return p[qe]?(""!==Pe&&(Pe+=", "),Pe+p[qe]):Pe},"")},getAddressInfo:ve,REVERSE_GEOCODE_COORD_RGX:/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/}},9471:(Dt,ot,ve)=>{"use strict";var me=ve(7454);Dt.exports=me},7454:(Dt,ot,ve)=>{"use strict";var me=ve(753),q=ve(4176);function Ee(J){q.call(this,J)}(Ee.prototype=Object.create(q.prototype)).constructor=Ee,Ee.prototype.sendRequest=me.browserSend,Ee.prototype.abortRequest=me.browserAbort,Dt.exports=function p(J){return new Ee(J)}},753:(Dt,ot,ve)=>{"use strict";var me=ve(4332),q=ve(6158),Ee=ve(9719),p=ve(8829),J={};function Pe(st){var mt=st.total,Mt=st.loaded;return{total:mt,transferred:Mt,percent:100*Mt/mt}}function qe(st,mt){return new Promise(function(Mt,le){mt.onprogress=function(ce){st.emitter.emit(Ee.EVENT_PROGRESS_DOWNLOAD,Pe(ce))};var K=st.file;K&&(mt.upload.onprogress=function(ce){st.emitter.emit(Ee.EVENT_PROGRESS_UPLOAD,Pe(ce))}),mt.onerror=function(ce){le(ce)},mt.onabort=function(){var ce=new q({request:st,type:Ee.ERROR_REQUEST_ABORTED});le(ce)},mt.onload=function(){if(delete J[st.id],mt.status<200||mt.status>=400){var ce=new q({request:st,body:mt.response,statusCode:mt.status});le(ce)}else Mt(mt)};var ne=st.body;"string"==typeof ne?mt.send(ne):ne?mt.send(JSON.stringify(ne)):K?mt.send(K):mt.send(),J[st.id]=mt}).then(function(Mt){return function Ce(st,mt){return new me(st,{body:mt.response,headers:p(mt.getAllResponseHeaders()),statusCode:mt.status})}(st,Mt)})}function It(st,mt){var Mt=st.url(mt),le=new window.XMLHttpRequest;return le.open(st.method,Mt),Object.keys(st.headers).forEach(function(K){le.setRequestHeader(K,st.headers[K])}),le}Dt.exports={browserAbort:function ye(st){var mt=J[st.id];mt&&(mt.abort(),delete J[st.id])},sendRequestXhr:qe,browserSend:function gt(st){return Promise.resolve().then(function(){var mt=It(st,st.client.accessToken);return qe(st,mt)})},createRequestXhr:It}},4176:(Dt,ot,ve)=>{"use strict";var me=ve(8129),q=ve(4538),Ee=ve(9719);function p(J){if(!J||!J.accessToken)throw new Error("Cannot create a client without an access token");me(J.accessToken),this.accessToken=J.accessToken,this.origin=J.origin||Ee.API_ORIGIN}p.prototype.createRequest=function(ye){return new q(this,ye)},Dt.exports=p},6158:(Dt,ot,ve)=>{"use strict";var me=ve(9719);Dt.exports=function q(Ee){var J,p=Ee.type||me.ERROR_HTTP;if(Ee.body)try{J=JSON.parse(Ee.body)}catch{J=Ee.body}else J=null;var ye=Ee.message||null;ye||("string"==typeof J?ye=J:J&&"string"==typeof J.message?ye=J.message:p===me.ERROR_REQUEST_ABORTED&&(ye="Request aborted")),this.message=ye,this.type=p,this.statusCode=Ee.statusCode||null,this.request=Ee.request,this.body=J}},4538:(Dt,ot,ve)=>{"use strict";var me=ve(8129),q=ve(4703),Ee=ve(6661),p=ve(3449),J=ve(9719),ye=1;function Ce(Pe,qe){if(!Pe)throw new Error("MapiRequest requires a client");if(!qe||!qe.path||!qe.method)throw new Error("MapiRequest requires an options object with path and method properties");var It={};qe.body&&(It["content-type"]="application/json");var gt=q(It,qe.headers),st=Object.keys(gt).reduce(function(mt,Mt){return mt[Mt.toLowerCase()]=gt[Mt],mt},{});this.id=ye++,this._options=qe,this.emitter=new Ee,this.client=Pe,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=qe.path,this.method=qe.method,this.origin=qe.origin||Pe.origin,this.query=qe.query||{},this.params=qe.params||{},this.body=qe.body||null,this.file=qe.file||null,this.encoding=qe.encoding||"utf8",this.sendFileAs=qe.sendFileAs||null,this.headers=st}Ce.prototype.url=function(qe){var It=p.prependOrigin(this.path,this.origin);It=p.appendQueryObject(It,this.query);var gt=this.params,st=qe??this.client.accessToken;if(st){It=p.appendQueryParam(It,"access_token",st);var mt=me(st).user;gt=q({ownerId:mt},gt)}return p.interpolateRouteParams(It,gt)},Ce.prototype.send=function(){var qe=this;if(qe.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return qe.sent=!0,qe.client.sendRequest(qe).then(function(It){return qe.response=It,qe.emitter.emit(J.EVENT_RESPONSE,It),It},function(It){throw qe.error=It,qe.emitter.emit(J.EVENT_ERROR,It),It})},Ce.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))},Ce.prototype.eachPage=function(qe){var It=this;function gt(Mt){qe(null,Mt,function le(){delete It._nextPageRequest;var K=Mt.nextPage();K&&(It._nextPageRequest=K,mt(K))})}function st(Mt){qe(Mt,null,function(){})}function mt(Mt){Mt.send().then(gt,st)}mt(this)},Ce.prototype.clone=function(){return this._extend()},Ce.prototype._extend=function(qe){var It=q(this._options,qe);return new Ce(this.client,It)},Dt.exports=Ce},4332:(Dt,ot,ve)=>{"use strict";var me=ve(5699);function q(Ee,p){this.request=Ee,this.headers=p.headers,this.rawBody=p.body,this.statusCode=p.statusCode;try{this.body=JSON.parse(p.body||"{}")}catch{this.body=p.body}this.links=me(this.headers.link)}q.prototype.hasNextPage=function(){return!!this.links.next},q.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},Dt.exports=q},9719:Dt=>{"use strict";Dt.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},8829:Dt=>{"use strict";Dt.exports=function ve(me){var q={};return me&&me.trim().split(/[\r|\n]+/).forEach(function(Ee){var p=function ot(me){var q=me.indexOf(":");return{name:me.substring(0,q).trim().toLowerCase(),value:me.substring(q+1).trim()}}(Ee);q[p.name]=p.value}),q}},5699:Dt=>{"use strict";Dt.exports=function me(q){return q?q.split(/,\s*</).reduce(function(Ee,p){var J=function ve(q){var Ee=q.match(/<?([^>]*)>(.*)/);if(!Ee)return null;var p=Ee[1],J=Ee[2].split(";"),ye=null,Ce=J.reduce(function(Pe,qe){var It=function ot(q){var Ee=q.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return Ee?{key:Ee[1],value:Ee[2]}:null}(qe);return It?"rel"===It.key?(ye||(ye=It.value),Pe):(Pe[It.key]=It.value,Pe):Pe},{});return ye?{url:p,rel:ye,params:Ce}:null}(p);return J?(J.rel.split(/\s+/).forEach(function(Ce){Ee[Ce]||(Ee[Ce]={url:J.url,params:J.params})}),Ee):Ee},{}):{}}},3449:Dt=>{"use strict";function ve(J){return Array.isArray(J)?function ot(J){return J.map(encodeURIComponent).join(",")}(J):encodeURIComponent(String(J))}function me(J,ye,Ce){if(!1===Ce||null===Ce)return J;var Pe=/\?/.test(J)?"&":"?",qe=encodeURIComponent(ye);return void 0!==Ce&&""!==Ce&&!0!==Ce&&(qe+="="+ve(Ce)),""+J+Pe+qe}Dt.exports={appendQueryObject:function q(J,ye){if(!ye)return J;var Ce=J;return Object.keys(ye).forEach(function(Pe){var qe=ye[Pe];void 0!==qe&&(Array.isArray(qe)&&(qe=qe.filter(function(It){return null!=It}).join(",")),Ce=me(Ce,Pe,qe))}),Ce},appendQueryParam:me,prependOrigin:function Ee(J,ye){if(!ye||"http"===J.slice(0,4))return J;var Ce="/"===J[0]?"":"/";return""+ye.replace(/\/$/,"")+Ce+J},interpolateRouteParams:function p(J,ye){return ye?J.replace(/\/:([a-zA-Z0-9]+)/g,function(Ce,Pe){var qe=ye[Pe];if(void 0===qe)throw new Error("Unspecified route parameter "+Pe);return"/"+ve(qe)}):J}}},6661:Dt=>{"use strict";var ot=Object.prototype.hasOwnProperty,ve="~";function me(){}function q(ye,Ce,Pe){this.fn=ye,this.context=Ce,this.once=Pe||!1}function Ee(ye,Ce,Pe,qe,It){if("function"!=typeof Pe)throw new TypeError("The listener must be a function");var gt=new q(Pe,qe||ye,It),st=ve?ve+Ce:Ce;return ye._events[st]?ye._events[st].fn?ye._events[st]=[ye._events[st],gt]:ye._events[st].push(gt):(ye._events[st]=gt,ye._eventsCount++),ye}function p(ye,Ce){0==--ye._eventsCount?ye._events=new me:delete ye._events[Ce]}function J(){this._events=new me,this._eventsCount=0}Object.create&&(me.prototype=Object.create(null),(new me).__proto__||(ve=!1)),J.prototype.eventNames=function(){var Pe,qe,Ce=[];if(0===this._eventsCount)return Ce;for(qe in Pe=this._events)ot.call(Pe,qe)&&Ce.push(ve?qe.slice(1):qe);return Object.getOwnPropertySymbols?Ce.concat(Object.getOwnPropertySymbols(Pe)):Ce},J.prototype.listeners=function(Ce){var qe=this._events[ve?ve+Ce:Ce];if(!qe)return[];if(qe.fn)return[qe.fn];for(var It=0,gt=qe.length,st=new Array(gt);It<gt;It++)st[It]=qe[It].fn;return st},J.prototype.listenerCount=function(Ce){var qe=this._events[ve?ve+Ce:Ce];return qe?qe.fn?1:qe.length:0},J.prototype.emit=function(Ce,Pe,qe,It,gt,st){var mt=ve?ve+Ce:Ce;if(!this._events[mt])return!1;var K,ne,Mt=this._events[mt],le=arguments.length;if(Mt.fn){switch(Mt.once&&this.removeListener(Ce,Mt.fn,void 0,!0),le){case 1:return Mt.fn.call(Mt.context),!0;case 2:return Mt.fn.call(Mt.context,Pe),!0;case 3:return Mt.fn.call(Mt.context,Pe,qe),!0;case 4:return Mt.fn.call(Mt.context,Pe,qe,It),!0;case 5:return Mt.fn.call(Mt.context,Pe,qe,It,gt),!0;case 6:return Mt.fn.call(Mt.context,Pe,qe,It,gt,st),!0}for(ne=1,K=new Array(le-1);ne<le;ne++)K[ne-1]=arguments[ne];Mt.fn.apply(Mt.context,K)}else{var ee,ce=Mt.length;for(ne=0;ne<ce;ne++)switch(Mt[ne].once&&this.removeListener(Ce,Mt[ne].fn,void 0,!0),le){case 1:Mt[ne].fn.call(Mt[ne].context);break;case 2:Mt[ne].fn.call(Mt[ne].context,Pe);break;case 3:Mt[ne].fn.call(Mt[ne].context,Pe,qe);break;case 4:Mt[ne].fn.call(Mt[ne].context,Pe,qe,It);break;default:if(!K)for(ee=1,K=new Array(le-1);ee<le;ee++)K[ee-1]=arguments[ee];Mt[ne].fn.apply(Mt[ne].context,K)}}return!0},J.prototype.on=function(Ce,Pe,qe){return Ee(this,Ce,Pe,qe,!1)},J.prototype.once=function(Ce,Pe,qe){return Ee(this,Ce,Pe,qe,!0)},J.prototype.removeListener=function(Ce,Pe,qe,It){var gt=ve?ve+Ce:Ce;if(!this._events[gt])return this;if(!Pe)return p(this,gt),this;var st=this._events[gt];if(st.fn)st.fn===Pe&&(!It||st.once)&&(!qe||st.context===qe)&&p(this,gt);else{for(var mt=0,Mt=[],le=st.length;mt<le;mt++)(st[mt].fn!==Pe||It&&!st[mt].once||qe&&st[mt].context!==qe)&&Mt.push(st[mt]);Mt.length?this._events[gt]=1===Mt.length?Mt[0]:Mt:p(this,gt)}return this},J.prototype.removeAllListeners=function(Ce){var Pe;return Ce?this._events[Pe=ve?ve+Ce:Ce]&&p(this,Pe):(this._events=new me,this._eventsCount=0),this},J.prototype.off=J.prototype.removeListener,J.prototype.addListener=J.prototype.on,J.prefixed=ve,J.EventEmitter=J,Dt.exports=J},7075:(Dt,ot,ve)=>{"use strict";var me=ve(4703),q=ve(9801),Ee=ve(4313),p=ve(1836),J=ve(497),ye={},Ce=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];ye.forwardGeocode=function(Pe){q.assertShape({query:q.required(q.string),mode:q.oneOf("mapbox.places","mapbox.places-permanent"),countries:q.arrayOf(q.string),proximity:q.oneOf(q.coordinates,"ip"),types:q.arrayOf(q.oneOf(Ce)),autocomplete:q.boolean,bbox:q.arrayOf(q.number),limit:q.number,language:q.arrayOf(q.string),routing:q.boolean,fuzzyMatch:q.boolean,worldview:q.string})(Pe),Pe.mode=Pe.mode||"mapbox.places";var qe=p(me({country:Pe.countries},Ee(Pe,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Ee(Pe,["mode","query"]),query:qe})},ye.reverseGeocode=function(Pe){q.assertShape({query:q.required(q.coordinates),mode:q.oneOf("mapbox.places","mapbox.places-permanent"),countries:q.arrayOf(q.string),types:q.arrayOf(q.oneOf(Ce)),bbox:q.arrayOf(q.number),limit:q.number,language:q.arrayOf(q.string),reverseMode:q.oneOf("distance","score"),routing:q.boolean,worldview:q.string})(Pe),Pe.mode=Pe.mode||"mapbox.places";var qe=p(me({country:Pe.countries},Ee(Pe,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Ee(Pe,["mode","query"]),query:qe})},Dt.exports=J(ye)},497:(Dt,ot,ve)=>{"use strict";var me=ve(4176),q=ve(7454);Dt.exports=function Ee(p){return function(J){var ye;ye=me.prototype.isPrototypeOf(J)?J:q(J);var Ce=Object.create(p);return Ce.client=ye,Ce}}},5621:Dt=>{"use strict";Dt.exports=function ot(ve,me){return Object.keys(ve).reduce(function(q,Ee){return q[Ee]=me(Ee,ve[Ee]),q},{})}},4313:Dt=>{"use strict";Dt.exports=function ot(ve,me){var q=function(Ee,p){return-1!==me.indexOf(Ee)&&void 0!==p};return"function"==typeof me&&(q=me),Object.keys(ve).filter(function(Ee){return q(Ee,ve[Ee])}).reduce(function(Ee,p){return Ee[p]=ve[p],Ee},{})}},1836:(Dt,ot,ve)=>{"use strict";var me=ve(5621);Dt.exports=function q(Ee){return me(Ee,function(p,J){return"boolean"==typeof J?JSON.stringify(J):J})}},9801:(Dt,ot,ve)=>{"use strict";var me=ve(4703),q=ve(6089);Dt.exports=me(q,{file:function Ee(Ce){return typeof window<"u"?Ce instanceof global.Blob||Ce instanceof global.ArrayBuffer?void 0:"Blob or ArrayBuffer":"string"!=typeof Ce&&void 0===Ce.pipe?"Filename or Readable stream":void 0},date:function J(Ce){var Pe="date";if("boolean"==typeof Ce)return Pe;try{var qe=new Date(Ce);if(qe.getTime&&isNaN(qe.getTime()))return Pe}catch{return Pe}},coordinates:function ye(Ce){return q.tuple(q.number,q.number)(Ce)},assertShape:function p(Ce,Pe){return q.assert(q.strictShape(Ce),Pe)}})},8129:(Dt,ot,ve)=>{"use strict";var me=ve(2049),q={};function J(ye,Ce){return Object.prototype.hasOwnProperty.call(ye,Ce)}Dt.exports=function Ee(ye){if(q[ye])return q[ye];var Ce=ye.split("."),Pe=Ce[0],qe=Ce[1];if(!qe)throw new Error("Invalid token");var It=function p(ye){try{return JSON.parse(me.decode(ye))}catch{throw new Error("Invalid token")}}(qe),gt={usage:Pe,user:It.u};return J(It,"a")&&(gt.authorization=It.a),J(It,"exp")&&(gt.expires=1e3*It.exp),J(It,"iat")&&(gt.created=1e3*It.iat),J(It,"scopes")&&(gt.scopes=It.scopes),J(It,"client")&&(gt.client=It.client),J(It,"ll")&&(gt.lastLogin=It.ll),J(It,"iu")&&(gt.impersonator=It.iu),q[ye]=gt,gt}},6198:(Dt,ot,ve)=>{"use strict";function me(e){return"function"==typeof e}function q(e){const n=e(r=>{Error.call(r),r.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const Ee=q(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((r,o)=>`${o+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function p(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class J{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const c of n)c.remove(this);else n.remove(this);const{initialTeardown:r}=this;if(me(r))try{r()}catch(c){t=c instanceof Ee?c.errors:[c]}const{_finalizers:o}=this;if(o){this._finalizers=null;for(const c of o)try{Pe(c)}catch(d){t=t??[],d instanceof Ee?t=[...t,...d.errors]:t.push(d)}}if(t)throw new Ee(t)}}add(t){var n;if(t&&t!==this)if(this.closed)Pe(t);else{if(t instanceof J){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&p(n,t)}remove(t){const{_finalizers:n}=this;n&&p(n,t),t instanceof J&&t._removeParent(this)}}J.EMPTY=(()=>{const e=new J;return e.closed=!0,e})();const ye=J.EMPTY;function Ce(e){return e instanceof J||e&&"closed"in e&&me(e.remove)&&me(e.add)&&me(e.unsubscribe)}function Pe(e){me(e)?e():e.unsubscribe()}const qe={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},It={setTimeout(e,t,...n){const{delegate:r}=It;return r?.setTimeout?r.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=It;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function gt(e){It.setTimeout(()=>{const{onUnhandledError:t}=qe;if(!t)throw e;t(e)})}function st(){}const mt=K("C",void 0,void 0);function K(e,t,n){return{kind:e,value:t,error:n}}let ne=null;function ce(e){if(qe.useDeprecatedSynchronousErrorHandling){const t=!ne;if(t&&(ne={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:r}=ne;if(ne=null,n)throw r}}else e()}class ae extends J{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,Ce(t)&&t.add(this)):this.destination=Ne}static create(t,n,r){return new re(t,n,r)}next(t){this.isStopped?it(function le(e){return K("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?it(function Mt(e){return K("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?it(mt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const oe=Function.prototype.bind;function te(e,t){return oe.call(e,t)}class _e{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(r){Je(r)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(r){Je(r)}else Je(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){Je(n)}}}class re extends ae{constructor(t,n,r){let o;if(super(),me(t)||!t)o={next:t??void 0,error:n??void 0,complete:r??void 0};else{let c;this&&qe.useDeprecatedNextContext?(c=Object.create(t),c.unsubscribe=()=>this.unsubscribe(),o={next:t.next&&te(t.next,c),error:t.error&&te(t.error,c),complete:t.complete&&te(t.complete,c)}):o=t}this.destination=new _e(o)}}function Je(e){qe.useDeprecatedSynchronousErrorHandling?function ee(e){qe.useDeprecatedSynchronousErrorHandling&&ne&&(ne.errorThrown=!0,ne.error=e)}(e):gt(e)}function it(e,t){const{onStoppedNotification:n}=qe;n&&It.setTimeout(()=>n(e,t))}const Ne={closed:!0,next:st,error:function He(e){throw e},complete:st},sn="function"==typeof Symbol&&Symbol.observable||"@@observable";function Bt(e){return e}function bt(e){return 0===e.length?Bt:1===e.length?e[0]:function(n){return e.reduce((r,o)=>o(r),n)}}let Ue=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const r=new e;return r.source=this,r.operator=n,r}subscribe(n,r,o){const c=function Be(e){return e&&e instanceof ae||function Tt(e){return e&&me(e.next)&&me(e.error)&&me(e.complete)}(e)&&Ce(e)}(n)?n:new re(n,r,o);return ce(()=>{const{operator:d,source:_}=this;c.add(d?d.call(c,_):_?this._subscribe(c):this._trySubscribe(c))}),c}_trySubscribe(n){try{return this._subscribe(n)}catch(r){n.error(r)}}forEach(n,r){return new(r=ft(r))((o,c)=>{const d=new re({next:_=>{try{n(_)}catch(E){c(E),d.unsubscribe()}},error:c,complete:o});this.subscribe(d)})}_subscribe(n){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(n)}[sn](){return this}pipe(...n){return bt(n)(this)}toPromise(n){return new(n=ft(n))((r,o)=>{let c;this.subscribe(d=>c=d,d=>o(d),()=>r(c))})}}return e.create=t=>new e(t),e})();function ft(e){var t;return null!==(t=e??qe.Promise)&&void 0!==t?t:Promise}const Xt=q(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Jt=(()=>{class e extends Ue{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const r=new Rn(this,this);return r.operator=n,r}_throwIfClosed(){if(this.closed)throw new Xt}next(n){ce(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(n)}})}error(n){ce(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:r}=this;for(;r.length;)r.shift().error(n)}})}complete(){ce(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:r,isStopped:o,observers:c}=this;return r||o?ye:(this.currentObservers=null,c.push(n),new J(()=>{this.currentObservers=null,p(c,n)}))}_checkFinalizedStatuses(n){const{hasError:r,thrownError:o,isStopped:c}=this;r?n.error(o):c&&n.complete()}asObservable(){const n=new Ue;return n.source=this,n}}return e.create=(t,n)=>new Rn(t,n),e})();class Rn extends Jt{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===r||r.call(n,t)}error(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===r||r.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,r;return null!==(r=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==r?r:ye}}class zt extends Jt{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:r}=this;if(t)throw n;return this._throwIfClosed(),r}next(t){super.next(this._value=t)}}function Jn(e){return me(e?.lift)}function Mn(e){return t=>{if(Jn(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function jn(e,t,n,r,o){return new xn(e,t,n,r,o)}class xn extends ae{constructor(t,n,r,o,c,d){super(t),this.onFinalize=c,this.shouldUnsubscribe=d,this._next=n?function(_){try{n(_)}catch(E){t.error(E)}}:super._next,this._error=o?function(_){try{o(_)}catch(E){t.error(E)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(_){t.error(_)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function Nn(e,t){return Mn((n,r)=>{let o=0;n.subscribe(jn(r,c=>{r.next(e.call(t,c,o++))}))})}function Pi(e){return this instanceof Pi?(this.v=e,this):new Pi(e)}function Ki(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function en(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(c){n[c]=e[c]&&function(d){return new Promise(function(_,E){!function o(c,d,_,E){Promise.resolve(E).then(function(S){c({value:S,done:_})},d)}(_,E,(d=e[c](d)).done,d.value)})}}}const Ft=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Nt(e){return me(e?.then)}function lt(e){return me(e[sn])}function Zt(e){return Symbol.asyncIterator&&me(e?.[Symbol.asyncIterator])}function Cn(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Sn=function Bn(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function ri(e){return me(e?.[Sn])}function li(e){return function ni(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,r=n.apply(e,t||[]),c=[];return o={},d("next"),d("throw"),d("return"),o[Symbol.asyncIterator]=function(){return this},o;function d(B){r[B]&&(o[B]=function(V){return new Promise(function(de,he){c.push([B,V,de,he])>1||_(B,V)})})}function _(B,V){try{!function E(B){B.value instanceof Pi?Promise.resolve(B.value.v).then(S,R):L(c[0][2],B)}(r[B](V))}catch(de){L(c[0][3],de)}}function S(B){_("next",B)}function R(B){_("throw",B)}function L(B,V){B(V),c.shift(),c.length&&_(c[0][0],c[0][1])}}(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:r,done:o}=yield Pi(n.read());if(o)return yield Pi(void 0);yield yield Pi(r)}}finally{n.releaseLock()}})}function Yr(e){return me(e?.getReader)}function Cr(e){if(e instanceof Ue)return e;if(null!=e){if(lt(e))return function fi(e){return new Ue(t=>{const n=e[sn]();if(me(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Ft(e))return function fs(e){return new Ue(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(Nt(e))return function ds(e){return new Ue(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,gt)})}(e);if(Zt(e))return ao(e);if(ri(e))return function Xr(e){return new Ue(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Yr(e))return function ya(e){return ao(li(e))}(e)}throw Cn(e)}function ao(e){return new Ue(t=>{(function Xo(e,t){var n,r,o,c;return function Ct(e,t,n,r){return new(n||(n=Promise))(function(c,d){function _(R){try{S(r.next(R))}catch(L){d(L)}}function E(R){try{S(r.throw(R))}catch(L){d(L)}}function S(R){R.done?c(R.value):function o(c){return c instanceof n?c:new n(function(d){d(c)})}(R.value).then(_,E)}S((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=Ki(e);!(r=yield n.next()).done;)if(t.next(r.value),t.closed)return}catch(d){o={error:d}}finally{try{r&&!r.done&&(c=n.return)&&(yield c.call(n))}finally{if(o)throw o.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function zi(e,t,n,r=0,o=!1){const c=t.schedule(function(){n(),o?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(c),!o)return c}function wo(e,t,n=1/0){return me(t)?wo((r,o)=>Nn((c,d)=>t(r,c,o,d))(Cr(e(r,o))),n):("number"==typeof t&&(n=t),Mn((r,o)=>function pl(e,t,n,r,o,c,d,_){const E=[];let S=0,R=0,L=!1;const B=()=>{L&&!E.length&&!S&&t.complete()},V=he=>S<r?de(he):E.push(he),de=he=>{c&&t.next(he),S++;let Ve=!1;Cr(n(he,R++)).subscribe(jn(t,Ae=>{o?.(Ae),c?V(Ae):t.next(Ae)},()=>{Ve=!0},void 0,()=>{if(Ve)try{for(S--;E.length&&S<r;){const Ae=E.shift();d?zi(t,d,()=>de(Ae)):de(Ae)}B()}catch(Ae){t.error(Ae)}}))};return e.subscribe(jn(t,V,()=>{L=!0,B()})),()=>{_?.()}}(r,o,e,n)))}function uc(e=1/0){return wo(Bt,e)}const Br=new Ue(e=>e.complete());function lc(e){return e[e.length-1]}function _a(e){return function ps(e){return e&&me(e.schedule)}(lc(e))?e.pop():void 0}function Ac(e,t=0){return Mn((n,r)=>{n.subscribe(jn(r,o=>zi(r,e,()=>r.next(o),t),()=>zi(r,e,()=>r.complete(),t),o=>zi(r,e,()=>r.error(o),t)))})}function Za(e,t=0){return Mn((n,r)=>{r.add(e.schedule(()=>n.subscribe(r),t))})}function Ms(e,t){if(!e)throw new Error("Iterable cannot be null");return new Ue(n=>{zi(n,t,()=>{const r=e[Symbol.asyncIterator]();zi(n,t,()=>{r.next().then(o=>{o.done?n.complete():n.next(o.value)})},0,!0)})})}function bs(e,t){return t?function Ds(e,t){if(null!=e){if(lt(e))return function Oa(e,t){return Cr(e).pipe(Za(t),Ac(t))}(e,t);if(Ft(e))return function on(e,t){return new Ue(n=>{let r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if(Nt(e))return function Na(e,t){return Cr(e).pipe(Za(t),Ac(t))}(e,t);if(Zt(e))return Ms(e,t);if(ri(e))return function Wu(e,t){return new Ue(n=>{let r;return zi(n,t,()=>{r=e[Sn](),zi(n,t,()=>{let o,c;try{({value:o,done:c}=r.next())}catch(d){return void n.error(d)}c?n.complete():n.next(o)},0,!0)}),()=>me(r?.return)&&r.return()})}(e,t);if(Yr(e))return function aa(e,t){return Ms(li(e),t)}(e,t)}throw Cn(e)}(e,t):Cr(e)}function Qr(...e){return bs(e,_a(e))}function Pc(e={}){const{connector:t=(()=>new Jt),resetOnError:n=!0,resetOnComplete:r=!0,resetOnRefCountZero:o=!0}=e;return c=>{let d,_,E,S=0,R=!1,L=!1;const B=()=>{_?.unsubscribe(),_=void 0},V=()=>{B(),d=E=void 0,R=L=!1},de=()=>{const he=d;V(),he?.unsubscribe()};return Mn((he,Ve)=>{S++,!L&&!R&&B();const Ae=E=E??t();Ve.add(()=>{S--,0===S&&!L&&!R&&(_=pn(de,o))}),Ae.subscribe(Ve),!d&&S>0&&(d=new re({next:fe=>Ae.next(fe),error:fe=>{L=!0,B(),_=pn(V,n,fe),Ae.error(fe)},complete:()=>{R=!0,B(),_=pn(V,r),Ae.complete()}}),Cr(he).subscribe(d))})(c)}}function pn(e,t,...n){if(!0===t)return void e();if(!1===t)return;const r=new re({next:()=>{r.unsubscribe(),e()}});return Cr(t(...n)).subscribe(r)}function Zr(e,t){return Mn((n,r)=>{let o=null,c=0,d=!1;const _=()=>d&&!o&&r.complete();n.subscribe(jn(r,E=>{o?.unsubscribe();let S=0;const R=c++;Cr(e(E,R)).subscribe(o=jn(r,L=>r.next(t?t(E,L,R,S++):L),()=>{o=null,_()}))},()=>{d=!0,_()}))})}function Ya(e,t){return e===t}function er(e){for(let t in e)if(e[t]===er)return t;throw Error("Could not find renamed property on target object.")}function yo(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(yo).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function Gl(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const Ia=er({__forward_ref__:er});function Qs(e){return e.__forward_ref__=Qs,e.toString=function(){return yo(this())},e}function ur(e){return hh(e)?e():e}function hh(e){return"function"==typeof e&&e.hasOwnProperty(Ia)&&e.__forward_ref__===Qs}function Tn(e){return e&&!!e.\u0275providers}class Hn extends Error{constructor(t,n){super(function Wc(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,n)),this.code=t}}function vr(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():function dr(e){return"string"==typeof e?e:null==e?"":String(e)}(e)}function zs(e,t){throw new Hn(-201,!1)}function Hr(e,t){null==e&&function Mi(e,t,n,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${n} ${r} ${t} <=Actual]`))}(t,e,null,"!=")}function sr(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Ku(e){return{providers:e.providers||[],imports:e.imports||[]}}function cc(e){return Xc(e,ka)||Xc(e,hc)}function Xc(e,t){return e.hasOwnProperty(t)?e[t]:null}function ca(e){return e&&(e.hasOwnProperty(Qi)||e.hasOwnProperty(Ru))?e[Qi]:null}const ka=er({\u0275prov:er}),Qi=er({\u0275inj:er}),hc=er({ngInjectableDef:er}),Ru=er({ngInjectorDef:er});var Rr=(()=>((Rr=Rr||{})[Rr.Default=0]="Default",Rr[Rr.Host=1]="Host",Rr[Rr.Self=2]="Self",Rr[Rr.SkipSelf=4]="SkipSelf",Rr[Rr.Optional=8]="Optional",Rr))();let Yo;function ii(e){const t=Yo;return Yo=e,t}function Ja(e,t,n){const r=cc(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&Rr.Optional?null:void 0!==t?t:void zs(yo(e))}const oi=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Qu={},Si="__NG_DI_FLAG__",Ni="ngTempTokenPath",ml=/\n/gm,Bh="__source";let ei;function $i(e){const t=ei;return ei=e,t}function Nc(e,t=Rr.Default){if(void 0===ei)throw new Hn(-203,!1);return null===ei?Ja(e,void 0,t):ei.get(e,t&Rr.Optional?null:void 0,t)}function fr(e,t=Rr.Default){return(function hr(){return Yo}()||Nc)(ur(e),t)}function qn(e,t=Rr.Default){return fr(e,xu(t))}function xu(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function Fi(e){const t=[];for(let n=0;n<e.length;n++){const r=ur(e[n]);if(Array.isArray(r)){if(0===r.length)throw new Hn(900,!1);let o,c=Rr.Default;for(let d=0;d<r.length;d++){const _=r[d],E=kc(_);"number"==typeof E?-1===E?o=_.token:c|=E:o=_}t.push(fr(o,c))}else t.push(fr(r))}return t}function ha(e,t){return e[Si]=t,e.prototype[Si]=t,e}function kc(e){return e[Si]}function ss(e){return{toString:e}.toString()}var Tl=(()=>((Tl=Tl||{})[Tl.OnPush=0]="OnPush",Tl[Tl.Default=1]="Default",Tl))(),el=(()=>{return(e=el||(el={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",el;var e})();const Ta={},Lr=[],Ou=er({\u0275cmp:er}),Ws=er({\u0275dir:er}),wu=er({\u0275pipe:er}),tl=er({\u0275mod:er}),bu=er({\u0275fac:er}),tu=er({__NG_ELEMENT_ID__:er}),Ps=er({__NG_ENV_ID__:er});function lf(e,t,n){let r=e.length;for(;;){const o=e.indexOf(t,n);if(-1===o)return o;if(0===o||e.charCodeAt(o-1)<=32){const c=t.length;if(o+c===r||e.charCodeAt(o+c)<=32)return o}n=o+1}}function fc(e,t,n){let r=0;for(;r<n.length;){const o=n[r];if("number"==typeof o){if(0!==o)break;r++;const c=n[r++],d=n[r++],_=n[r++];e.setAttribute(t,d,_,c)}else{const c=o,d=n[++r];Fa(c)?e.setProperty(t,c,d):e.setAttribute(t,c,d),r++}}return r}function Rs(e){return 3===e||4===e||6===e}function Fa(e){return 64===e.charCodeAt(0)}function Ba(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const o=t[r];"number"==typeof o?n=o:0===n||fh(e,n,o,null,-1===n||2===n?t[++r]:null)}}return e}function fh(e,t,n,r,o){let c=0,d=e.length;if(-1===t)d=-1;else for(;c<e.length;){const _=e[c++];if("number"==typeof _){if(_===t){d=-1;break}if(_>t){d=c-1;break}}}for(;c<e.length;){const _=e[c];if("number"==typeof _)break;if(_===n){if(null===r)return void(null!==o&&(e[c+1]=o));if(r===e[c+1])return void(e[c+2]=o)}c++,null!==r&&c++,null!==o&&c++}-1!==d&&(e.splice(d,0,t),c=d+1),e.splice(c++,0,n),null!==r&&e.splice(c++,0,r),null!==o&&e.splice(c++,0,o)}const fa="ng-template";function dc(e,t,n){let r=0,o=!0;for(;r<e.length;){let c=e[r++];if("string"==typeof c&&o){const d=e[r++];if(n&&"class"===c&&-1!==lf(d.toLowerCase(),t,0))return!0}else{if(1===c){for(;r<e.length&&"string"==typeof(c=e[r++]);)if(c.toLowerCase()===t)return!0;return!1}"number"==typeof c&&(o=!1)}}return!1}function ql(e){return 4===e.type&&e.value!==fa}function zh(e,t,n){return t===(4!==e.type||n?e.value:fa)}function Of(e,t,n){let r=4;const o=e.attrs||[],c=function Uh(e){for(let t=0;t<e.length;t++)if(Rs(e[t]))return t;return e.length}(o);let d=!1;for(let _=0;_<t.length;_++){const E=t[_];if("number"!=typeof E){if(!d)if(4&r){if(r=2|1&r,""!==E&&!zh(e,E,n)||""===E&&1===t.length){if(Nu(r))return!1;d=!0}}else{const S=8&r?E:t[++_];if(8&r&&null!==e.attrs){if(!dc(e.attrs,S,n)){if(Nu(r))return!1;d=!0}continue}const L=Eu(8&r?"class":E,o,ql(e),n);if(-1===L){if(Nu(r))return!1;d=!0;continue}if(""!==S){let B;B=L>c?"":o[L+1].toLowerCase();const V=8&r?B:null;if(V&&-1!==lf(V,S,0)||2&r&&S!==B){if(Nu(r))return!1;d=!0}}}}else{if(!d&&!Nu(r)&&!Nu(E))return!1;if(d&&Nu(E))continue;d=!1,r=E|1&r}}return Nu(r)||d}function Nu(e){return 0==(1&e)}function Eu(e,t,n,r){if(null===t)return-1;let o=0;if(r||!n){let c=!1;for(;o<t.length;){const d=t[o];if(d===e)return o;if(3===d||6===d)c=!0;else{if(1===d||2===d){let _=t[++o];for(;"string"==typeof _;)_=t[++o];continue}if(4===d)break;if(0===d){o+=4;continue}}o+=c?1:2}return-1}return function Ma(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function ea(e,t,n=!1){for(let r=0;r<t.length;r++)if(Of(e,t[r],n))return!0;return!1}function yl(e,t){return e?":not("+t.trim()+")":t}function Nf(e){let t=e[0],n=1,r=2,o="",c=!1;for(;n<e.length;){let d=e[n];if("string"==typeof d)if(2&r){const _=e[++n];o+="["+d+(_.length>0?'="'+_+'"':"")+"]"}else 8&r?o+="."+d:4&r&&(o+=" "+d);else""!==o&&!Nu(d)&&(t+=yl(c,o),o=""),r=d,c=c||!Nu(r);n++}return""!==o&&(t+=yl(c,o)),t}function un(e){return ss(()=>{const t=Zs(e),n={...t,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===Tl.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:null,data:e.data||{},encapsulation:e.encapsulation||el.Emulated,styles:e.styles||Lr,_:null,schemas:e.schemas||null,tView:null,id:""};lo(n);const r=e.dependencies;return n.directiveDefs=as(r,!1),n.pipeDefs=as(r,!0),n.id=function nu(e){let t=0;const n=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const o of n)t=Math.imul(31,t)+o.charCodeAt(0)<<0;return t+=2147483648,"c"+t}(n),n})}function ir(e){return $r(e)||uo(e)}function Tr(e){return null!==e}function qi(e){return ss(()=>({type:e.type,bootstrap:e.bootstrap||Lr,declarations:e.declarations||Lr,imports:e.imports||Lr,exports:e.exports||Lr,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function eo(e,t){if(null==e)return Ta;const n={};for(const r in e)if(e.hasOwnProperty(r)){let o=e[r],c=o;Array.isArray(o)&&(c=o[1],o=o[0]),n[o]=r,t&&(t[o]=c)}return n}function Vi(e){return ss(()=>{const t=Zs(e);return lo(t),t})}function $r(e){return e[Ou]||null}function uo(e){return e[Ws]||null}function Xs(e){return e[wu]||null}function to(e,t){const n=e[tl]||null;if(!n&&!0===t)throw new Error(`Type ${yo(e)} does not have '\u0275mod' property.`);return n}function Zs(e){const t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,exportAs:e.exportAs||null,standalone:!0===e.standalone,selectors:e.selectors||Lr,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:eo(e.inputs,t),outputs:eo(e.outputs)}}function lo(e){e.features?.forEach(t=>t(e))}function as(e,t){if(!e)return null;const n=t?Xs:ir;return()=>("function"==typeof e?e():e).map(r=>n(r)).filter(Tr)}const Ri=0,bn=1,qr=2,co=3,_o=4,xa=5,io=6,da=7,Ur=8,Bc=9,nl=10,pr=11,pa=12,Dl=13,za=14,vo=15,_s=16,Ls=17,$n=18,ho=19,dh=20,ku=21,fo=22,wa=23,ru=24,Or=25,Vh=1,fd=2,Ys=7,rl=8,Fu=9,js=11;function na(e){return Array.isArray(e)&&"object"==typeof e[Vh]}function Gs(e){return Array.isArray(e)&&!0===e[Vh]}function Bu(e){return 0!=(4&e.flags)}function xr(e){return e.componentOffset>-1}function Cu(e){return 1==(1&e.flags)}function Aa(e){return!!e.template}function Al(e){return 0!=(512&e[qr])}function lr(e,t){return e.hasOwnProperty(bu)?e[bu]:null}let zc=oi.WeakRef??class il{constructor(t){this.ref=t}deref(){return this.ref}},Jm=0,zu=null,kf=!1;function hu(e){const t=zu;return zu=e,t}class Wl{constructor(){this.id=Jm++,this.ref=function Kn(e){return new zc(e)}(this),this.producers=new Map,this.consumers=new Map,this.trackingVersion=0,this.valueVersion=0}consumerPollProducersForChange(){for(const[t,n]of this.producers){const r=n.producerNode.deref();if(void 0!==r&&n.atTrackingVersion===this.trackingVersion){if(r.producerPollStatus(n.seenValueVersion))return!0}else this.producers.delete(t),r?.consumers.delete(this.id)}return!1}producerMayHaveChanged(){const t=kf;kf=!0;try{for(const[n,r]of this.consumers){const o=r.consumerNode.deref();void 0!==o&&o.trackingVersion===r.atTrackingVersion?o.onConsumerDependencyMayHaveChanged():(this.consumers.delete(n),o?.producers.delete(this.id))}}finally{kf=t}}producerAccessed(){if(kf)throw new Error("");if(null===zu)return;let t=zu.producers.get(this.id);void 0===t?(t={consumerNode:zu.ref,producerNode:this.ref,seenValueVersion:this.valueVersion,atTrackingVersion:zu.trackingVersion},zu.producers.set(this.id,t),this.consumers.set(zu.id,t)):(t.seenValueVersion=this.valueVersion,t.atTrackingVersion=zu.trackingVersion)}get hasProducers(){return this.producers.size>0}get producerUpdatesAllowed(){return!1!==zu?.consumerAllowSignalWrites}producerPollStatus(t){return this.valueVersion!==t||(this.onProducerUpdateValueVersion(),this.valueVersion!==t)}}let w=null;const G=()=>{};class X extends Wl{constructor(t,n,r){super(),this.watch=t,this.schedule=n,this.dirty=!1,this.cleanupFn=G,this.registerOnCleanup=o=>{this.cleanupFn=o},this.consumerAllowSignalWrites=r}notify(){this.dirty||this.schedule(this),this.dirty=!0}onConsumerDependencyMayHaveChanged(){this.notify()}onProducerUpdateValueVersion(){}run(){if(this.dirty=!1,0!==this.trackingVersion&&!this.consumerPollProducersForChange())return;const t=hu(this);this.trackingVersion++;try{this.cleanupFn(),this.cleanupFn=G,this.watch(this.registerOnCleanup)}finally{hu(t)}}cleanup(){this.cleanupFn()}}class Z{constructor(t,n,r){this.previousValue=t,this.currentValue=n,this.firstChange=r}isFirstChange(){return this.firstChange}}function se(){return Ie}function Ie(e){return e.type.prototype.ngOnChanges&&(e.setInput=$e),ze}function ze(){const e=We(this),t=e?.current;if(t){const n=e.previous;if(n===Ta)e.previous=t;else for(let r in t)n[r]=t[r];e.current=null,this.ngOnChanges(t)}}function $e(e,t,n,r){const o=this.declaredInputs[n],c=We(e)||function ue(e,t){return e[je]=t}(e,{previous:Ta,current:null}),d=c.current||(c.current={}),_=c.previous,E=_[o];d[o]=new Z(E&&E.currentValue,t,_===Ta),e[r]=t}se.ngInherit=!0;const je="__ngSimpleChanges__";function We(e){return e[je]||null}const Qe=function(e,t,n){};function at(e){for(;Array.isArray(e);)e=e[Ri];return e}function kt(e,t){return at(t[e.index])}function Ht(e,t){const n=t[e];return na(n)?n:n[Ri]}function Gt(e){return 128==(128&e[qr])}function En(e,t){return null==t?null:e[t]}function vn(e){e[Ls]=0}function Ln(e){1024&e[qr]||(e[qr]|=1024,Vr(e,1))}function wr(e){1024&e[qr]&&(e[qr]&=-1025,Vr(e,-1))}function Vr(e,t){let n=e[co];if(null===n)return;n[xa]+=t;let r=n;for(n=n[co];null!==n&&(1===t&&1===r[xa]||-1===t&&0===r[xa]);)n[xa]+=t,r=n,n=n[co]}const Xn={lFrame:Vf(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function ls(){return Xn.bindingsEnabled}function ln(){return Xn.lFrame.lView}function Wr(){return Xn.lFrame.tView}function xs(){let e=zf();for(;null!==e&&64===e.type;)e=e.parent;return e}function zf(){return Xn.lFrame.currentTNode}function Pl(e,t){const n=Xn.lFrame;n.currentTNode=e,n.isParent=t}function mc(){return Xn.lFrame.isParent}function Qm(e,t){const n=Xn.lFrame;n.bindingIndex=n.bindingRootIndex=e,iu(t)}function iu(e){Xn.lFrame.currentDirectiveIndex=e}function Kd(e){Xn.lFrame.currentQueryIndex=e}function v_(e){const t=e[bn];return 2===t.type?t.declTNode:1===t.type?e[io]:null}function ey(e,t,n){if(n&Rr.SkipSelf){let o=t,c=e;for(;!(o=o.parent,null!==o||n&Rr.Host||(o=v_(c),null===o||(c=c[za],10&o.type))););if(null===o)return!1;t=o,e=c}const r=Xn.lFrame=mh();return r.currentTNode=t,r.lView=e,!0}function Zl(e){const t=mh(),n=e[bn];Xn.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function mh(){const e=Xn.lFrame,t=null===e?null:e.child;return null===t?Vf(e):t}function Vf(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function jf(){const e=Xn.lFrame;return Xn.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Uc=jf;function yc(){const e=jf();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function hf(e){Xn.lFrame.selectedIndex=e}let x_=!0;function Vg(){return x_}function Ns(e){x_=e}function Kc(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const c=e.data[n].type.prototype,{ngAfterContentInit:d,ngAfterContentChecked:_,ngAfterViewInit:E,ngAfterViewChecked:S,ngOnDestroy:R}=c;d&&(e.contentHooks??=[]).push(-n,d),_&&((e.contentHooks??=[]).push(n,_),(e.contentCheckHooks??=[]).push(n,_)),E&&(e.viewHooks??=[]).push(-n,E),S&&((e.viewHooks??=[]).push(n,S),(e.viewCheckHooks??=[]).push(n,S)),null!=R&&(e.destroyHooks??=[]).push(n,R)}}function md(e,t,n){Rl(e,t,3,n)}function sl(e,t,n,r){(3&e[qr])===n&&Rl(e,t,n,r)}function Hp(e,t){let n=e[qr];(3&n)===t&&(n&=4095,n+=1,e[qr]=n)}function Rl(e,t,n,r){const c=r??-1,d=t.length-1;let _=0;for(let E=void 0!==r?65535&e[Ls]:0;E<d;E++)if("number"==typeof t[E+1]){if(_=t[E],null!=r&&_>=r)break}else t[E]<0&&(e[Ls]+=65536),(_<c||-1==c)&&(ry(e,n,t,E),e[Ls]=(4294901760&e[Ls])+E+2),E++}function fu(e,t){Qe(4,e,t);const n=hu(null);try{t.call(e)}finally{hu(n),Qe(5,e,t)}}function ry(e,t,n,r){const o=n[r]<0,c=n[r+1],_=e[o?-n[r]:n[r]];o?e[qr]>>12<e[Ls]>>16&&(3&e[qr])===t&&(e[qr]+=4096,fu(_,c)):fu(_,c)}const Jc=-1;class Qc{constructor(t,n,r){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=r}}function _d(e){return e!==Jc}function $h(e){return 32767&e}function vd(e,t){let n=function th(e){return e>>16}(e),r=t;for(;n>0;)r=r[za],n--;return r}let xd=!0;function qh(e){const t=xd;return xd=e,t}const vc=255,bd=5;let Vu=0;const ou={};function ra(e,t){const n=xc(e,t);if(-1!==n)return n;const r=t[bn];r.firstCreatePass&&(e.injectorIndex=t.length,Xp(r.data,e),Xp(t,null),Xp(r.blueprint,null));const o=wc(e,t),c=e.injectorIndex;if(_d(o)){const d=$h(o),_=vd(o,t),E=_[bn].data;for(let S=0;S<8;S++)t[c+S]=_[d+S]|E[d+S]}return t[c+8]=o,c}function Xp(e,t){e.push(0,0,0,0,0,0,0,0,t)}function xc(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function wc(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,o=t;for(;null!==o;){if(r=al(o),null===r)return Jc;if(n++,o=o[za],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return Jc}function jg(e,t,n){!function Wp(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(tu)&&(r=n[tu]),null==r&&(r=n[tu]=Vu++);const o=r&vc;t.data[e+(o>>bd)]|=1<<o}(e,t,n)}function Gg(e,t,n){if(n&Rr.Optional||void 0!==e)return e;zs()}function sy(e,t,n,r){if(n&Rr.Optional&&void 0===r&&(r=null),!(n&(Rr.Self|Rr.Host))){const o=e[Bc],c=ii(void 0);try{return o?o.get(t,r,n&Rr.Optional):Ja(t,r,n&Rr.Optional)}finally{ii(c)}}return Gg(r,0,n)}function $f(e,t,n,r=Rr.Default,o){if(null!==e){if(2048&t[qr]&&!(r&Rr.Self)){const d=function Yp(e,t,n,r,o){let c=e,d=t;for(;null!==c&&null!==d&&2048&d[qr]&&!(512&d[qr]);){const _=yh(c,d,n,r|Rr.Self,ou);if(_!==ou)return _;let E=c.parent;if(!E){const S=d[dh];if(S){const R=S.get(n,ou,r);if(R!==ou)return R}E=al(d),d=d[za]}c=E}return o}(e,t,n,r,ou);if(d!==ou)return d}const c=yh(e,t,n,r,ou);if(c!==ou)return c}return sy(t,n,r,o)}function yh(e,t,n,r,o){const c=function qg(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(tu)?e[tu]:void 0;return"number"==typeof t?t>=0?t&vc:Sd:t}(n);if("function"==typeof c){if(!ey(t,e,r))return r&Rr.Host?Gg(o,0,r):sy(t,n,r,o);try{const d=c(r);if(null!=d||r&Rr.Optional)return d;zs()}finally{Uc()}}else if("number"==typeof c){let d=null,_=xc(e,t),E=Jc,S=r&Rr.Host?t[vo][io]:null;for((-1===_||r&Rr.SkipSelf)&&(E=-1===_?wc(e,t):t[_+8],E!==Jc&&si(r,!1)?(d=t[bn],_=$h(E),t=vd(E,t)):_=-1);-1!==_;){const R=t[bn];if(Cd(c,_,R.data)){const L=$g(_,t,n,d,r,S);if(L!==ou)return L}E=t[_+8],E!==Jc&&si(r,t[bn].data[_+8]===S)&&Cd(c,_,t)?(d=R,_=$h(E),t=vd(E,t)):_=-1}}return o}function $g(e,t,n,r,o,c){const d=t[bn],_=d.data[e+8],R=function Ed(e,t,n,r,o){const c=e.providerIndexes,d=t.data,_=1048575&c,E=e.directiveStart,R=c>>20,B=o?_+R:e.directiveEnd;for(let V=r?_:_+R;V<B;V++){const de=d[V];if(V<E&&n===de||V>=E&&de.type===n)return V}if(o){const V=d[E];if(V&&Aa(V)&&V.type===n)return E}return null}(_,d,n,null==r?xr(_)&&xd:r!=d&&0!=(3&_.type),o&Rr.Host&&c===_);return null!==R?Hh(t,d,R,_):ou}function Hh(e,t,n,r){let o=e[n];const c=t.data;if(function eh(e){return e instanceof Qc}(o)){const d=o;d.resolving&&function Ui(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new Hn(-200,`Circular dependency in DI detected for ${e}${n}`)}(vr(c[n]));const _=qh(d.canSeeViewProviders);d.resolving=!0;const E=d.injectImpl?ii(d.injectImpl):null;ey(e,r,Rr.Default);try{o=e[n]=d.factory(void 0,c,e,r),t.firstCreatePass&&n>=r.directiveStart&&function Ir(e,t,n){const{ngOnChanges:r,ngOnInit:o,ngDoCheck:c}=t.type.prototype;if(r){const d=Ie(t);(n.preOrderHooks??=[]).push(e,d),(n.preOrderCheckHooks??=[]).push(e,d)}o&&(n.preOrderHooks??=[]).push(0-e,o),c&&((n.preOrderHooks??=[]).push(e,c),(n.preOrderCheckHooks??=[]).push(e,c))}(n,c[n],t)}finally{null!==E&&ii(E),qh(_),d.resolving=!1,Uc()}}return o}function Cd(e,t,n){return!!(n[t+(e>>bd)]&1<<e)}function si(e,t){return!(e&Rr.Self||e&Rr.Host&&t)}class Wh{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,r){return $f(this._tNode,this._lView,t,xu(r),n)}}function Sd(){return new Wh(xs(),ln())}function Zp(e){return hh(e)?()=>{const t=Zp(ur(e));return t&&t()}:lr(e)}function al(e){const t=e[bn],n=t.type;return 2===n?t.declTNode:1===n?e[io]:null}const Yl="__parameters__";function vl(e,t,n){return ss(()=>{const r=function Hf(e){return function(...n){if(e){const r=e(...n);for(const o in r)this[o]=r[o]}}}(t);function o(...c){if(this instanceof o)return r.apply(this,c),this;const d=new o(...c);return _.annotation=d,_;function _(E,S,R){const L=E.hasOwnProperty(Yl)?E[Yl]:Object.defineProperty(E,Yl,{value:[]})[Yl];for(;L.length<=R;)L.push(null);return(L[R]=L[R]||[]).push(d),E}}return n&&(o.prototype=Object.create(n.prototype)),o.prototype.ngMetadataName=e,o.annotationCls=o,o})}function ff(e,t){e.forEach(n=>Array.isArray(n)?ff(n,t):t(n))}function Hg(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function Wf(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}const gu=ha(vl("Optional"),8),mf=ha(vl("SkipSelf"),4);function im(e){return 128==(128&e.flags)}var nc=(()=>((nc=nc||{})[nc.Important=1]="Important",nc[nc.DashCase=2]="DashCase",nc))();const Dd=new Map;let l0=0;const Yf="__ngContext__";function Ol(e,t){na(t)?(e[Yf]=t[ho],function h0(e){Dd.set(e[ho],e)}(t)):e[Yf]=t}let cp;function um(e,t){return cp(e,t)}function yf(e){const t=e[co];return Gs(t)?t[co]:t}function hp(e){return lm(e[pa])}function og(e){return lm(e[_o])}function lm(e){for(;null!==e&&!Gs(e);)e=e[_o];return e}function _f(e,t,n,r,o){if(null!=r){let c,d=!1;Gs(r)?c=r:na(r)&&(d=!0,r=r[Ri]);const _=at(r);0===e&&null!==n?null==o?ug(t,n,_):vf(t,n,_,o||null,!0):1===e&&null!==n?vf(t,n,_,o||null,!0):2===e?function cg(e,t,n){const r=Jf(e,t);r&&function mm(e,t,n,r){e.removeChild(t,n,r)}(e,r,t,n)}(t,_,d):3===e&&t.destroyNode(_),null!=c&&function Nl(e,t,n,r,o){const c=n[Ys];c!==at(n)&&_f(t,e,r,c,o);for(let _=js;_<n.length;_++){const E=n[_];gp(E[bn],E,e,t,r,c)}}(t,e,c,n,o)}}function hm(e,t,n){return e.createElement(t,n)}function Sy(e,t){const n=e[Fu],r=n.indexOf(t);wr(t),n.splice(r,1)}function dm(e,t){if(e.length<=js)return;const n=js+t,r=e[n];if(r){const o=r[_s];null!==o&&o!==e&&Sy(o,r),t>0&&(e[n-1][_o]=r[_o]);const c=Wf(e,js+t);!function p0(e,t){gp(e,t,t[pr],2,null,null),t[Ri]=null,t[io]=null}(r[bn],r);const d=c[$n];null!==d&&d.detachView(c[bn]),r[co]=null,r[_o]=null,r[qr]&=-129}return r}function pm(e,t){if(!(256&t[qr])){const n=t[pr];t[wa]?.destroy(),t[ru]?.destroy(),n.destroyNode&&gp(e,t,n,3,null,null),function m0(e){let t=e[pa];if(!t)return ag(e[bn],e);for(;t;){let n=null;if(na(t))n=t[pa];else{const r=t[js];r&&(n=r)}if(!n){for(;t&&!t[_o]&&t!==e;)na(t)&&ag(t[bn],t),t=t[co];null===t&&(t=e),na(t)&&ag(t[bn],t),n=t&&t[_o]}t=n}}(t)}}function ag(e,t){if(!(256&t[qr])){t[qr]&=-129,t[qr]|=256,function N_(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const o=t[n[r]];if(!(o instanceof Qc)){const c=n[r+1];if(Array.isArray(c))for(let d=0;d<c.length;d+=2){const _=o[c[d]],E=c[d+1];Qe(4,_,E);try{E.call(_)}finally{Qe(5,_,E)}}else{Qe(4,o,c);try{c.call(o)}finally{Qe(5,o,c)}}}}}(e,t),function Iy(e,t){const n=e.cleanup,r=t[da];if(null!==n)for(let c=0;c<n.length-1;c+=2)if("string"==typeof n[c]){const d=n[c+3];d>=0?r[d]():r[-d].unsubscribe(),c+=2}else n[c].call(r[n[c+1]]);null!==r&&(t[da]=null);const o=t[ku];if(null!==o){t[ku]=null;for(let c=0;c<o.length;c++)(0,o[c])()}}(e,t),1===t[bn].type&&t[pr].destroy();const n=t[_s];if(null!==n&&Gs(t[co])){n!==t[co]&&Sy(n,t);const r=t[$n];null!==r&&r.detachView(e)}!function f0(e){Dd.delete(e[ho])}(t)}}function gm(e,t,n){return function k_(e,t,n){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[Ri];{const{componentOffset:o}=r;if(o>-1){const{encapsulation:c}=e.data[r.directiveStart+o];if(c===el.None||c===el.Emulated)return null}return kt(r,n)}}(e,t.parent,n)}function vf(e,t,n,r,o){e.insertBefore(t,n,r,o)}function ug(e,t,n){e.appendChild(t,n)}function Kf(e,t,n,r,o){null!==r?vf(e,t,n,r,o):ug(e,t,n)}function Jf(e,t){return e.parentNode(t)}let My,yp,Ty=function dp(e,t,n){return 40&e.type?kt(e,n):null};function lg(e,t,n,r){const o=gm(e,r,t),c=t[pr],_=function ym(e,t,n){return Ty(e,t,n)}(r.parent||t[io],r,t);if(null!=o)if(Array.isArray(n))for(let E=0;E<n.length;E++)Kf(c,o,n[E],_,!1);else Kf(c,o,n,_,!1);void 0!==My&&My(c,r,t,n,o)}function pp(e,t){if(null!==t){const n=t.type;if(3&n)return kt(t,e);if(4&n)return _m(-1,e[t.index]);if(8&n){const r=t.child;if(null!==r)return pp(e,r);{const o=e[t.index];return Gs(o)?_m(-1,o):at(o)}}if(32&n)return um(t,e)()||at(e[t.index]);{const r=Ay(e,t);return null!==r?Array.isArray(r)?r[0]:pp(yf(e[vo]),r):pp(e,t.next)}}return null}function Ay(e,t){return null!==t?e[vo][io].projection[t.projection]:null}function _m(e,t){const n=js+e+1;if(n<t.length){const r=t[n],o=r[bn].firstChild;if(null!==o)return pp(r,o)}return t[Ys]}function Py(e,t,n,r,o,c,d){for(;null!=n;){const _=r[n.index],E=n.type;if(d&&0===t&&(_&&Ol(at(_),r),n.flags|=2),32!=(32&n.flags))if(8&E)Py(e,t,n.child,r,o,c,!1),_f(t,e,o,_,c);else if(32&E){const S=um(n,r);let R;for(;R=S();)_f(t,e,o,R,c);_f(t,e,o,_,c)}else 16&E?Ry(e,t,r,n,o,c):_f(t,e,o,_,c);n=d?n.projectionNext:n.next}}function gp(e,t,n,r,o,c){Py(n,r,e.firstChild,t,o,c,!1)}function Ry(e,t,n,r,o,c){const d=n[vo],E=d[io].projection[r.projection];if(Array.isArray(E))for(let S=0;S<E.length;S++)_f(t,e,o,E[S],c);else{let S=E;const R=d[co];im(r)&&(S.flags|=128),Py(e,t,S,R,o,c,!0)}}function mp(e,t,n){""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n)}function kl(e,t,n){const{mergedAttrs:r,classes:o,styles:c}=n;null!==r&&fc(e,t,r),null!==o&&mp(e,t,o),null!==c&&function Ii(e,t,n){e.setAttribute(t,"style",n)}(e,t,c)}class Kr{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=sr({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const bp=new Kr("ENVIRONMENT_INITIALIZER"),jy=new Kr("INJECTOR",-1),Im=new Kr("INJECTOR_DEF_TYPES");class Tm{get(t,n=Qu){if(n===Qu){const r=new Error(`NullInjectorError: No provider for ${yo(t)}!`);throw r.name="NullInjectorError",r}return n}}function W_(...e){return{\u0275providers:tf(0,e),\u0275fromNgModule:!0}}function tf(e,...t){const n=[],r=new Set;let o;return ff(t,c=>{const d=c;mg(d,n,[],r)&&(o||=[],o.push(d))}),void 0!==o&&Mm(o,n),n}function Mm(e,t){for(let n=0;n<e.length;n++){const{providers:o}=e[n];Dm(o,c=>{t.push(c)})}}function mg(e,t,n,r){if(!(e=ur(e)))return!1;let o=null,c=ca(e);const d=!c&&$r(e);if(c||d){if(d&&!d.standalone)return!1;o=e}else{const E=e.ngModule;if(c=ca(E),!c)return!1;o=E}const _=r.has(o);if(d){if(_)return!1;if(r.add(o),d.dependencies){const E="function"==typeof d.dependencies?d.dependencies():d.dependencies;for(const S of E)mg(S,t,n,r)}}else{if(!c)return!1;{if(null!=c.imports&&!_){let S;r.add(o);try{ff(c.imports,R=>{mg(R,t,n,r)&&(S||=[],S.push(R))})}finally{}void 0!==S&&Mm(S,t)}if(!_){const S=lr(o)||(()=>new o);t.push({provide:o,useFactory:S,deps:Lr},{provide:Im,useValue:o,multi:!0},{provide:bp,useValue:()=>fr(o),multi:!0})}const E=c.providers;null==E||_||Dm(E,R=>{t.push(R)})}}return o!==e&&void 0!==e.providers}function Dm(e,t){for(let n of e)Tn(n)&&(n=n.\u0275providers),Array.isArray(n)?Dm(n,t):t(n)}const I0=er({provide:String,useValue:er});function Gy(e){return null!==e&&"object"==typeof e&&I0 in e}function Ih(e){return"function"==typeof e}const Am=new Kr("Set Injector scope."),Cc={},Pm={};let wf;function bf(){return void 0===wf&&(wf=new Tm),wf}class nf{}class Ep extends nf{get destroyed(){return this._destroyed}constructor(t,n,r,o){super(),this.parent=n,this.source=r,this.scopes=o,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,td(t,d=>this.processProvider(d)),this.records.set(jy,Cp(void 0,this)),o.has("environment")&&this.records.set(nf,Cp(void 0,this));const c=this.records.get(Am);null!=c&&"string"==typeof c.value&&this.scopes.add(c.value),this.injectorDefTypes=new Set(this.get(Im.multi,Lr,Rr.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const n of this._ngOnDestroyHooks)n.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const n of t)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(t){return this.assertNotDestroyed(),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){this.assertNotDestroyed();const n=$i(this),r=ii(void 0);try{return t()}finally{$i(n),ii(r)}}get(t,n=Qu,r=Rr.Default){if(this.assertNotDestroyed(),t.hasOwnProperty(Ps))return t[Ps](this);r=xu(r);const o=$i(this),c=ii(void 0);try{if(!(r&Rr.SkipSelf)){let _=this.records.get(t);if(void 0===_){const E=function D0(e){return"function"==typeof e||"object"==typeof e&&e instanceof Kr}(t)&&cc(t);_=E&&this.injectableDefInScope(E)?Cp(Rm(t),Cc):null,this.records.set(t,_)}if(null!=_)return this.hydrate(t,_)}return(r&Rr.Self?bf():this.parent).get(t,n=r&Rr.Optional&&n===Qu?null:n)}catch(d){if("NullInjectorError"===d.name){if((d[Ni]=d[Ni]||[]).unshift(yo(t)),o)throw d;return function eu(e,t,n,r){const o=e[Ni];throw t[Bh]&&o.unshift(t[Bh]),e.message=function lu(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let o=yo(t);if(Array.isArray(t))o=t.map(yo).join(" -> ");else if("object"==typeof t){let c=[];for(let d in t)if(t.hasOwnProperty(d)){let _=t[d];c.push(d+":"+("string"==typeof _?JSON.stringify(_):yo(_)))}o=`{${c.join(", ")}}`}return`${n}${r?"("+r+")":""}[${o}]: ${e.replace(ml,"\n  ")}`}("\n"+e.message,o,n,r),e.ngTokenPath=o,e[Ni]=null,e}(d,t,"R3InjectorError",this.source)}throw d}finally{ii(c),$i(o)}}resolveInjectorInitializers(){const t=$i(this),n=ii(void 0);try{const r=this.get(bp.multi,Lr,Rr.Self);for(const o of r)o()}finally{$i(t),ii(n)}}toString(){const t=[],n=this.records;for(const r of n.keys())t.push(yo(r));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Hn(205,!1)}processProvider(t){let n=Ih(t=ur(t))?t:ur(t&&t.provide);const r=function Om(e){return Gy(e)?Cp(void 0,e.useValue):Cp(function Z_(e,t,n){let r;if(Ih(e)){const o=ur(e);return lr(o)||Rm(o)}if(Gy(e))r=()=>ur(e.useValue);else if(function $y(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...Fi(e.deps||[]));else if(function ed(e){return!(!e||!e.useExisting)}(e))r=()=>fr(ur(e.useExisting));else{const o=ur(e&&(e.useClass||e.provide));if(!function T0(e){return!!e.deps}(e))return lr(o)||Rm(o);r=()=>new o(...Fi(e.deps))}return r}(e),Cc)}(t);if(Ih(t)||!0!==t.multi)this.records.get(n);else{let o=this.records.get(n);o||(o=Cp(void 0,Cc,!0),o.factory=()=>Fi(o.multi),this.records.set(n,o)),n=t,o.multi.push(t)}this.records.set(n,r)}hydrate(t,n){return n.value===Cc&&(n.value=Pm,n.value=n.factory()),"object"==typeof n.value&&n.value&&function M0(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=ur(t.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}removeOnDestroy(t){const n=this._onDestroyHooks.indexOf(t);-1!==n&&this._onDestroyHooks.splice(n,1)}}function Rm(e){const t=cc(e),n=null!==t?t.factory:lr(e);if(null!==n)return n;if(e instanceof Kr)throw new Hn(204,!1);if(e instanceof Function)return function Lm(e){const t=e.length;if(t>0)throw function df(e,t){const n=[];for(let r=0;r<e;r++)n.push(t);return n}(t,"?"),new Hn(204,!1);const n=function Ju(e){return e&&(e[ka]||e[hc])||null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new Hn(204,!1)}function Cp(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function td(e,t){for(const n of e)Array.isArray(n)?td(n,t):n&&Tn(n)?td(n.\u0275providers,t):t(n)}const Ef=new Kr("AppId",{providedIn:"root",factory:()=>qy}),qy="ng",Y_=new Kr("Platform Initializer"),Pd=new Kr("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),J_=new Kr("CSP nonce",{providedIn:"root",factory:()=>function _p(){if(void 0!==yp)return yp;if(typeof document<"u")return document;throw new Hn(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let Nd=(e,t)=>null;function bg(e,t){return Nd(e,t)}class Tp{}class nv{}class L0{resolveComponentFactory(t){throw function Ky(e){const t=Error(`No component factory found for ${yo(e)}.`);return t.ngComponent=e,t}(t)}}let Mp=(()=>{class e{}return e.NULL=new L0,e})();function rv(){return Sf(xs(),ln())}function Sf(e,t){return new rd(kt(e,t))}let rd=(()=>{class e{constructor(n){this.nativeElement=n}}return e.__NG_ELEMENT_ID__=rv,e})();class iv{}let N0=(()=>{class e{}return e.\u0275prov=sr({token:e,providedIn:"root",factory:()=>null}),e})();class id{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const k0=new id("16.0.5"),Qy={};function Dp(e){for(;e;){e[qr]|=64;const t=yf(e);if(Al(e)&&!t)return e;e=t}return null}function Sc(e){return e.ngOriginalError}class v{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t);this._console.error("ERROR",t),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&Sc(t);for(;n&&Sc(n);)n=Sc(n);return n||null}}const Y=new Kr("",{providedIn:"root",factory:()=>!1});function rr(e){return e instanceof Function?e():e}class xl extends Wl{constructor(){super(...arguments),this.consumerAllowSignalWrites=!1,this._lView=null}set lView(t){this._lView=t}onConsumerDependencyMayHaveChanged(){Dp(this._lView)}onProducerUpdateValueVersion(){}get hasReadASignal(){return this.hasProducers}runInContext(t,n,r){const o=hu(this);this.trackingVersion++;try{t(n,r)}finally{hu(o)}}destroy(){this.trackingVersion++}}let Ra=null;function wl(){return Ra??=new xl,Ra}function ih(e,t){return e[t]??wl()}function Cg(e,t){const n=wl();n.hasReadASignal&&(e[t]=Ra,n.lView=e,Ra=new xl)}const hi={};function V0(e,t=null,n=null,r){const o=px(e,t,n,r);return o.resolveInjectorInitializers(),o}function px(e,t=null,n=null,r,o=new Set){const c=[n||Lr,W_(e)];return r=r||("object"==typeof e?void 0:yo(e)),new Ep(c,t||bf(),r||null,o)}let If=(()=>{class e{static create(n,r){if(Array.isArray(n))return V0({name:""},r,n,"");{const o=n.name??"";return V0({name:o},n.parent,n.providers,o)}}}return e.THROW_IF_NOT_FOUND=Qu,e.NULL=new Tm,e.\u0275prov=sr({token:e,providedIn:"any",factory:()=>fr(jy)}),e.__NG_ELEMENT_ID__=-1,e})();function vi(e,t=Rr.Default){const n=ln();return null===n?fr(e,t):$f(xs(),n,ur(e),t)}function Um(e,t,n,r,o,c,d,_,E,S,R){const L=t.blueprint.slice();return L[Ri]=o,L[qr]=140|r,(null!==S||e&&2048&e[qr])&&(L[qr]|=2048),vn(L),L[co]=L[za]=e,L[Ur]=n,L[nl]=d||e&&e[nl],L[pr]=_||e&&e[pr],L[Bc]=E||e&&e[Bc]||null,L[io]=c,L[ho]=function c0(){return l0++}(),L[fo]=R,L[dh]=S,L[vo]=2==t.type?e[vo]:L,L}function Ap(e,t,n,r,o){let c=e.data[t];if(null===c)c=function av(e,t,n,r,o){const c=zf(),d=mc(),E=e.data[t]=function $(e,t,n,r,o,c){let d=t?t.injectorIndex:-1,_=0;return function Va(){return null!==Xn.skipHydrationRootTNode}()&&(_|=128),{type:n,index:r,insertBeforeIndex:null,injectorIndex:d,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:_,providerIndexes:0,value:o,attrs:c,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,d?c:c&&c.parent,n,t,r,o);return null===e.firstChild&&(e.firstChild=E),null!==c&&(d?null==c.child&&null!==E.parent&&(c.child=E):null===c.next&&(c.next=E,E.prev=c)),E}(e,t,n,r,o),function Uf(){return Xn.lFrame.inI18n}()&&(c.flags|=32);else if(64&c.type){c.type=n,c.value=r,c.attrs=o;const d=function gc(){const e=Xn.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();c.injectorIndex=null===d?-1:d.injectorIndex}return Pl(c,!0),c}function Fd(e,t,n,r){if(0===n)return-1;const o=t.length;for(let c=0;c<n;c++)t.push(r),e.blueprint.push(r),e.data.push(null);return o}function uv(e,t,n,r,o){const c=ih(t,wa),d=function ja(){return Xn.lFrame.selectedIndex}(),_=2&r;try{if(hf(-1),_&&t.length>Or&&function sv(e,t,n,r){if(!r)if(3==(3&t[qr])){const c=e.preOrderCheckHooks;null!==c&&md(t,c,n)}else{const c=e.preOrderHooks;null!==c&&sl(t,c,0,n)}hf(n)}(e,t,Or,!1),Qe(_?2:0,o),_)c.runInContext(n,r,o);else{const S=hu(null);try{n(r,o)}finally{hu(S)}}}finally{_&&null===t[wa]&&Cg(t,wa),hf(d),Qe(_?3:1,o)}}function lv(e,t,n){if(Bu(t)){const r=hu(null);try{const c=t.directiveEnd;for(let d=t.directiveStart;d<c;d++){const _=e.data[d];_.contentQueries&&_.contentQueries(1,n[d],d)}}finally{hu(r)}}}function u(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=f(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}function f(e,t,n,r,o,c,d,_,E,S,R){const L=Or+r,B=L+o,V=function m(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:hi);return n}(L,B),de="function"==typeof S?S():S;return V[bn]={type:e,blueprint:V,template:n,queries:null,viewQuery:_,declTNode:t,data:V.slice().fill(null,L),bindingStartIndex:L,expandoStartIndex:B,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof c?c():c,pipeRegistry:"function"==typeof d?d():d,firstChild:null,schemas:E,consts:de,incompleteFirstPass:!1,ssrId:R}}let A=e=>null;function W(e,t,n,r){for(let o in e)if(e.hasOwnProperty(o)){n=null===n?{}:n;const c=e[o];null===r?Q(n,t,o,c):r.hasOwnProperty(o)&&Q(n,t,r[o],c)}return n}function Q(e,t,n,r){e.hasOwnProperty(n)?e[n].push(t,r):e[n]=[t,r]}function xt(e,t,n,r,o,c){for(let S=0;S<r.length;S++)jg(ra(n,t),e,r[S].type);!function Un(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}(n,e.data.length,r.length);for(let S=0;S<r.length;S++){const R=r[S];R.providersResolver&&R.providersResolver(R)}let d=!1,_=!1,E=Fd(e,t,r.length,null);for(let S=0;S<r.length;S++){const R=r[S];n.mergedAttrs=Ba(n.mergedAttrs,R.hostAttrs),cn(e,n,t,E,R),In(E,R,o),null!==R.contentQueries&&(n.flags|=4),(null!==R.hostBindings||null!==R.hostAttrs||0!==R.hostVars)&&(n.flags|=64);const L=R.type.prototype;!d&&(L.ngOnChanges||L.ngOnInit||L.ngDoCheck)&&((e.preOrderHooks??=[]).push(n.index),d=!0),!_&&(L.ngOnChanges||L.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(n.index),_=!0),E++}!function ie(e,t,n){const o=t.directiveEnd,c=e.data,d=t.attrs,_=[];let E=null,S=null;for(let R=t.directiveStart;R<o;R++){const L=c[R],B=n?n.get(L):null,de=B?B.outputs:null;E=W(L.inputs,R,E,B?B.inputs:null),S=W(L.outputs,R,S,de);const he=null===E||null===d||ql(t)?null:Mr(E,R,d);_.push(he)}null!==E&&(E.hasOwnProperty("class")&&(t.flags|=8),E.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=_,t.inputs=E,t.outputs=S}(e,n,c)}function hn(e,t,n){const r=n.directiveStart,o=n.directiveEnd,c=n.index,d=function Ug(){return Xn.lFrame.currentDirectiveIndex}();try{hf(c);for(let _=r;_<o;_++){const E=e.data[_],S=t[_];iu(_),(null!==E.hostBindings||0!==E.hostVars||null!==E.hostAttrs)&&On(E,S)}}finally{hf(-1),iu(d)}}function On(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function dn(e,t,n){t.componentOffset=n,(e.components??=[]).push(t.index)}function In(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;Aa(t)&&(n[""]=e)}}function cn(e,t,n,r,o){e.data[r]=o;const c=o.factory||(o.factory=lr(o.type)),d=new Qc(c,Aa(o),vi);e.blueprint[r]=d,n[r]=d,function _t(e,t,n,r,o){const c=o.hostBindings;if(c){let d=e.hostBindingOpCodes;null===d&&(d=e.hostBindingOpCodes=[]);const _=~t.index;(function Kt(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(d)!=_&&d.push(_),d.push(n,r,c)}}(e,t,r,Fd(e,n,o.hostVars,hi),o)}function xi(e,t,n,r,o,c){const d=c[t];if(null!==d)for(let _=0;_<d.length;)Vn(r,n,d[_++],d[_++],d[_++])}function Vn(e,t,n,r,o){const c=hu(null);try{null!==e.setInput?e.setInput(t,o,n,r):t[r]=o}finally{hu(c)}}function Mr(e,t,n){let r=null,o=0;for(;o<n.length;){const c=n[o];if(0!==c)if(5!==c){if("number"==typeof c)break;if(e.hasOwnProperty(c)){null===r&&(r=[]);const d=e[c];for(let _=0;_<d.length;_+=2)if(d[_]===t){r.push(c,d[_+1],n[o+1]);break}}o+=2}else o+=2;else o+=4}return r}function go(e,t){const n=e.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const c=n[r+1];if(-1!==c){const d=e.data[c];Kd(n[r]),d.contentQueries(2,t[c],c)}}}function ui(e,t){return e[pa]?e[Dl][_o]=t:e[pa]=t,e[Dl]=t,t}function Fr(e,t,n){Kd(0);const r=hu(null);try{t(e,n)}finally{hu(r)}}function ks(e,t){const n=e[Bc],r=n?n.get(v,null):null;r&&r.handleError(t)}function Is(e,t,n,r,o){for(let c=0;c<n.length;){const d=n[c++],_=n[c++];Vn(e.data[d],t[d],r,_,o)}}function Ca(e,t){const n=Ht(t,e),r=n[bn];!function qa(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])}(r,n);const o=n[Ri];null!==o&&null===n[fo]&&(n[fo]=bg(o,n[Bc])),Ha(r,n,n[Ur])}function Ha(e,t,n){Zl(t);try{const r=e.viewQuery;null!==r&&Fr(1,r,n);const o=e.template;null!==o&&uv(e,t,o,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&go(e,t),e.staticViewQueries&&Fr(2,e.viewQuery,n);const c=e.components;null!==c&&function Fs(e,t){for(let n=0;n<t.length;n++)Ca(e,t[n])}(t,c)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[qr]&=-5,yc()}}let xo=(()=>{class e{constructor(){this.all=new Set,this.queue=new Map}create(n,r,o){const c=typeof Zone>"u"?null:Zone.current,d=new X(n,S=>{this.all.has(S)&&this.queue.set(S,c)},o);let _;this.all.add(d),d.notify();const E=()=>{d.cleanup(),_?.(),this.all.delete(d),this.queue.delete(d)};return _=r?.onDestroy(E),{destroy:E}}flush(){if(0!==this.queue.size)for(const[n,r]of this.queue)this.queue.delete(n),r?r.run(()=>n.run()):n.run()}get isQueueEmpty(){return 0===this.queue.size}}return e.\u0275prov=sr({token:e,providedIn:"root",factory:()=>new e}),e})();function ws(e,t,n){let r=n?e.styles:null,o=n?e.classes:null,c=0;if(null!==t)for(let d=0;d<t.length;d++){const _=t[d];"number"==typeof _?c=_:1==c?o=Gl(o,_):2==c&&(r=Gl(r,_+": "+t[++d]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=o:e.classesWithoutHost=o}function ll(e,t,n,r,o=!1){for(;null!==n;){const c=t[n.index];if(null!==c&&r.push(at(c)),Gs(c)){for(let _=js;_<c.length;_++){const E=c[_],S=E[bn].firstChild;null!==S&&ll(E[bn],E,S,r)}c[Ys]!==c[Ri]&&r.push(c[Ys])}const d=n.type;if(8&d)ll(e,t,n.child,r);else if(32&d){const _=um(n,t);let E;for(;E=_();)r.push(E)}else if(16&d){const _=Ay(t,n);if(Array.isArray(_))r.push(..._);else{const E=yf(t[vo]);ll(E[bn],E,_,r,!0)}}n=o?n.projectionNext:n.next}return r}function La(e,t,n,r=!0){const o=t[nl].rendererFactory;o.begin&&o.begin();try{bl(e,t,e.template,n)}catch(d){throw r&&ks(t,d),d}finally{o.end&&o.end(),t[nl].effectManager?.flush()}}function bl(e,t,n,r){const o=t[qr];if(256!=(256&o)){t[nl].effectManager?.flush(),Zl(t);try{vn(t),function Zi(e){return Xn.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&uv(e,t,n,2,r);const d=3==(3&o);if(d){const S=e.preOrderCheckHooks;null!==S&&md(t,S,null)}else{const S=e.preOrderHooks;null!==S&&sl(t,S,0,null),Hp(t,0)}if(function Tf(e){for(let t=hp(e);null!==t;t=og(t)){if(!t[fd])continue;const n=t[Fu];for(let r=0;r<n.length;r++){Ln(n[r])}}}(t),function hl(e){for(let t=hp(e);null!==t;t=og(t))for(let n=js;n<t.length;n++){const r=t[n],o=r[bn];Gt(r)&&bl(o,r,o.template,r[Ur])}}(t),null!==e.contentQueries&&go(e,t),d){const S=e.contentCheckHooks;null!==S&&md(t,S)}else{const S=e.contentHooks;null!==S&&sl(t,S,1),Hp(t,1)}!function gx(e,t){const n=e.hostBindingOpCodes;if(null===n)return;const r=ih(t,ru);try{for(let o=0;o<n.length;o++){const c=n[o];if(c<0)hf(~c);else{const d=c,_=n[++o],E=n[++o];Qm(_,d),r.runInContext(E,2,t[d])}}}finally{null===t[ru]&&Cg(t,ru),hf(-1)}}(e,t);const _=e.components;null!==_&&function n_(e,t){for(let n=0;n<t.length;n++)Vm(e,t[n])}(t,_);const E=e.viewQuery;if(null!==E&&Fr(2,E,r),d){const S=e.viewCheckHooks;null!==S&&md(t,S)}else{const S=e.viewHooks;null!==S&&sl(t,S,2),Hp(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[qr]&=-73,wr(t)}finally{yc()}}}function Vm(e,t){const n=Ht(t,e);if(Gt(n)){const r=n[bn];80&n[qr]?bl(r,n,r.template,n[Ur]):n[xa]>0&&Ig(n)}}function Ig(e){for(let r=hp(e);null!==r;r=og(r))for(let o=js;o<r.length;o++){const c=r[o];if(Gt(c))if(1024&c[qr]){const d=c[bn];bl(d,c,d.template,c[Ur])}else c[xa]>0&&Ig(c)}const n=e[bn].components;if(null!==n)for(let r=0;r<n.length;r++){const o=Ht(n[r],e);Gt(o)&&o[xa]>0&&Ig(o)}}class jm{get rootNodes(){const t=this._lView,n=t[bn];return ll(n,t,n.firstChild,[])}constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Ur]}set context(t){this._lView[Ur]=t}get destroyed(){return 256==(256&this._lView[qr])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[co];if(Gs(t)){const n=t[rl],r=n?n.indexOf(this):-1;r>-1&&(dm(t,r),Wf(n,r))}this._attachedToViewContainer=!1}pm(this._lView[bn],this._lView)}onDestroy(t){!function or(e,t){if(256==(256&e[qr]))throw new Hn(911,!1);null===e[ku]&&(e[ku]=[]),e[ku].push(t)}(this._lView,t)}markForCheck(){Dp(this._cdRefInjectingView||this._lView)}detach(){this._lView[qr]&=-129}reattach(){this._lView[qr]|=128}detectChanges(){La(this._lView[bn],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Hn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function fm(e,t){gp(e,t,t[pr],2,null,null)}(this._lView[bn],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Hn(902,!1);this._appRef=t}}class mx extends jm{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;La(t[bn],t,t[Ur],!1)}checkNoChanges(){}get context(){return null}}class G0 extends Mp{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=$r(t);return new oh(n,this.ngModule)}}function $0(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}class H0{constructor(t,n){this.injector=t,this.parentInjector=n}get(t,n,r){r=xu(r);const o=this.injector.get(t,Qy,r);return o!==Qy||n===Qy?o:this.parentInjector.get(t,n,r)}}class oh extends nv{get inputs(){return $0(this.componentDef.inputs)}get outputs(){return $0(this.componentDef.outputs)}constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function _l(e){return e.map(Nf).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}create(t,n,r,o){let c=(o=o||this.ngModule)instanceof nf?o:o?.injector;c&&null!==this.componentDef.getStandaloneInjector&&(c=this.componentDef.getStandaloneInjector(c)||c);const d=c?new H0(t,c):t,_=d.get(iv,null);if(null===_)throw new Hn(407,!1);const R={rendererFactory:_,sanitizer:d.get(N0,null),effectManager:d.get(xo,null)},L=_.createRenderer(null,this.componentDef),B=this.componentDef.selectors[0][0]||"div",V=r?function b(e,t,n,r){const c=r.get(Y,!1)||n===el.ShadowDom,d=e.selectRootElement(t,c);return function I(e){A(e)}(d),d}(L,r,this.componentDef.encapsulation,d):hm(L,B,function q0(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(B)),de=this.componentDef.onPush?576:528,he=f(0,null,null,1,0,null,null,null,null,null,null),Ve=Um(null,he,null,de,null,null,R,L,d,null,null);let Ae,fe;Zl(Ve);try{const Oe=this.componentDef;let pt,vt=null;Oe.findHostDirectiveDefs?(pt=[],vt=new Map,Oe.findHostDirectiveDefs(Oe,pt,vt),pt.push(Oe)):pt=[Oe];const Vt=function W0(e,t){const n=e[bn],r=Or;return e[r]=t,Ap(n,r,2,"#host",null)}(Ve,V),$t=function X0(e,t,n,r,o,c,d){const _=o[bn];!function Pp(e,t,n,r){for(const o of e)t.mergedAttrs=Ba(t.mergedAttrs,o.hostAttrs);null!==t.mergedAttrs&&(ws(t,t.mergedAttrs,!0),null!==n&&kl(r,n,t))}(r,e,t,d);let E=null;null!==t&&(E=bg(t,o[Bc]));const S=c.rendererFactory.createRenderer(t,n),R=Um(o,u(n),null,n.onPush?64:16,o[e.index],e,c,S,null,null,E);return _.firstCreatePass&&dn(_,e,r.length-1),ui(o,R),o[e.index]=R}(Vt,V,Oe,pt,Ve,R,L);fe=function Ut(e,t){return e.data[t]}(he,Or),V&&function ub(e,t,n,r){if(r)fc(e,n,["ng-version",k0.full]);else{const{attrs:o,classes:c}=function Lt(e){const t=[],n=[];let r=1,o=2;for(;r<e.length;){let c=e[r];if("string"==typeof c)2===o?""!==c&&t.push(c,e[++r]):8===o&&n.push(c);else{if(!Nu(o))break;o=c}r++}return{attrs:t,classes:n}}(t.selectors[0]);o&&fc(e,n,o),c&&c.length>0&&mp(e,n,c.join(" "))}}(L,Oe,V,r),void 0!==n&&function sh(e,t,n){const r=e.projection=[];for(let o=0;o<t.length;o++){const c=n[o];r.push(null!=c?Array.from(c):null)}}(fe,this.ngContentSelectors,n),Ae=function Z0(e,t,n,r,o,c){const d=xs(),_=o[bn],E=kt(d,o);xt(_,o,d,n,null,r);for(let R=0;R<n.length;R++)Ol(Hh(o,_,d.directiveStart+R,d),o);hn(_,o,d),E&&Ol(E,o);const S=Hh(o,_,d.directiveStart+d.componentOffset,d);if(e[Ur]=o[Ur]=S,null!==c)for(const R of c)R(S,t);return lv(_,d,e),S}($t,Oe,pt,vt,Ve,[ah]),Ha(he,Ve,null)}finally{yc()}return new yx(this.componentType,Ae,Sf(fe,Ve),Ve,fe)}}class yx extends Tp{constructor(t,n,r,o,c){super(),this.location=r,this._rootLView=o,this._tNode=c,this.previousInputValues=null,this.instance=n,this.hostView=this.changeDetectorRef=new mx(o),this.componentType=t}setInput(t,n){const r=this._tNode.inputs;let o;if(null!==r&&(o=r[t])){if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),n))return;const c=this._rootLView;Is(c[bn],c,o,t,n),this.previousInputValues.set(t,n),Dp(Ht(this._tNode.index,c))}}get injector(){return new Wh(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function ah(){const e=xs();Kc(ln()[bn],e)}function mb(e,t,n,r,o){const d=o?"class":"style";Is(e,n,t.inputs[d],d,r)}function i_(e,t,n,r){const o=ln(),c=Wr(),d=Or+e,_=o[pr],E=c.firstCreatePass?function sL(e,t,n,r,o,c){const d=t.consts,E=Ap(t,e,2,r,En(d,o));return function ut(e,t,n,r){if(ls()){const o=null===r?null:{"":-1},c=function tn(e,t){const n=e.directiveRegistry;let r=null,o=null;if(n)for(let c=0;c<n.length;c++){const d=n[c];if(ea(t,d.selectors,!1))if(r||(r=[]),Aa(d))if(null!==d.findHostDirectiveDefs){const _=[];o=o||new Map,d.findHostDirectiveDefs(d,_,o),r.unshift(..._,d),dn(e,t,_.length)}else r.unshift(d),dn(e,t,0);else o=o||new Map,d.findHostDirectiveDefs?.(d,r,o),r.push(d)}return null===r?null:[r,o]}(e,n);let d,_;null===c?d=_=null:[d,_]=c,null!==d&&xt(e,t,n,d,o,_),o&&function mn(e,t,n){if(t){const r=e.localNames=[];for(let o=0;o<t.length;o+=2){const c=n[t[o+1]];if(null==c)throw new Hn(-301,!1);r.push(t[o],c)}}}(n,r,o)}n.mergedAttrs=Ba(n.mergedAttrs,n.attrs)}(t,n,E,En(d,c)),null!==E.attrs&&ws(E,E.attrs,!1),null!==E.mergedAttrs&&ws(E,E.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,E),E}(d,c,o,t,n,r):c.data[d],S=WS(c,o,E,_,t,e);o[d]=S;const R=Cu(E);return Pl(E,!0),kl(_,S,E),32!=(32&E.flags)&&Vg()&&lg(c,o,S,E),0===function bo(){return Xn.lFrame.elementDepthCount}()&&Ol(S,o),function Ko(){Xn.lFrame.elementDepthCount++}(),R&&(function s(e,t,n){ls()&&(function Wt(e,t,n,r){const o=n.directiveStart,c=n.directiveEnd;xr(n)&&function Zn(e,t,n){const r=kt(t,e),d=ui(e,Um(e,u(n),null,n.onPush?64:16,r,t,null,e[nl].rendererFactory.createRenderer(r,n),null,null,null));e[t.index]=d}(t,n,e.data[o+n.componentOffset]),e.firstCreatePass||ra(n,t),Ol(r,t);const d=n.initialInputs;for(let _=o;_<c;_++){const E=e.data[_],S=Hh(t,e,_,n);Ol(S,t),null!==d&&xi(0,_-o,S,E,0,d),Aa(E)&&(Ht(n.index,t)[Ur]=Hh(t,e,_,n))}}(e,t,n,kt(n,t)),64==(64&n.flags)&&hn(e,t,n))}(c,o,E),lv(c,E,o)),null!==r&&function i(e,t,n=kt){const r=t.localNames;if(null!==r){let o=t.index+1;for(let c=0;c<r.length;c+=2){const d=r[c+1],_=-1===d?n(t,e):e[d];e[o++]=_}}}(o,E),i_}function xv(){let e=xs();mc()?function Zc(){Xn.lFrame.isParent=!1}():(e=e.parent,Pl(e,!1));const t=e;(function Iu(e){return Xn.skipHydrationRootTNode===e})(t)&&function Jo(){Xn.skipHydrationRootTNode=null}(),function us(){Xn.lFrame.elementDepthCount--}();const n=Wr();return n.firstCreatePass&&(Kc(n,e),Bu(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function oy(e){return 0!=(8&e.flags)}(t)&&mb(n,t,ln(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Jd(e){return 0!=(16&e.flags)}(t)&&mb(n,t,ln(),t.stylesWithoutHost,!1),xv}function wv(e,t,n,r){return i_(e,t,n,r),xv(),wv}let WS=(e,t,n,r,o,c)=>(Ns(!0),hm(r,o,function _c(){return Xn.lFrame.currentNamespace}()));function Cx(e){return!!e&&"function"==typeof e.then}function YS(e){return!!e&&"function"==typeof e.subscribe}function Sx(e,t,n,r){const o=ln(),c=Wr(),d=xs();return function JS(e,t,n,r,o,c,d){const _=Cu(r),S=e.firstCreatePass&&function bi(e){return e.cleanup||(e.cleanup=[])}(e),R=t[Ur],L=function wi(e){return e[da]||(e[da]=[])}(t);let B=!0;if(3&r.type||d){const he=kt(r,t),Ve=d?d(he):he,Ae=L.length,fe=d?pt=>d(at(pt[r.index])):r.index;let Oe=null;if(!d&&_&&(Oe=function dL(e,t,n,r){const o=e.cleanup;if(null!=o)for(let c=0;c<o.length-1;c+=2){const d=o[c];if(d===n&&o[c+1]===r){const _=t[da],E=o[c+2];return _.length>E?_[E]:null}"string"==typeof d&&(c+=2)}return null}(e,t,o,r.index)),null!==Oe)(Oe.__ngLastListenerFn__||Oe).__ngNextListenerFn__=c,Oe.__ngLastListenerFn__=c,B=!1;else{c=eI(r,t,R,c,!1);const pt=n.listen(Ve,o,c);L.push(c,pt),S&&S.push(o,fe,Ae,Ae+1)}}else c=eI(r,t,R,c,!1);const V=r.outputs;let de;if(B&&null!==V&&(de=V[o])){const he=de.length;if(he)for(let Ve=0;Ve<he;Ve+=2){const vt=t[de[Ve]][de[Ve+1]].subscribe(c),Vt=L.length;L.push(c,vt),S&&S.push(o,r.index,Vt,-(Vt+1))}}}(c,o,o[pr],d,e,t,r),Sx}function QS(e,t,n,r){try{return Qe(6,t,n),!1!==n(r)}catch(o){return ks(e,o),!1}finally{Qe(7,t,n)}}function eI(e,t,n,r,o){return function c(d){if(d===Function)return r;Dp(e.componentOffset>-1?Ht(e.index,t):t);let E=QS(t,n,r,d),S=c.__ngNextListenerFn__;for(;S;)E=QS(t,n,S,d)&&E,S=S.__ngNextListenerFn__;return o&&!1===E&&d.preventDefault(),E}}function Mx(e,t=""){const n=ln(),r=Wr(),o=e+Or,c=r.firstCreatePass?Ap(r,o,1,t,null):r.data[o],d=SI(r,n,c,t,e);n[o]=d,Vg()&&lg(r,n,d,c),Pl(c,!1)}let SI=(e,t,n,r,o)=>(Ns(!0),function cm(e,t){return e.createText(t)}(t[pr],r));const Cv="en-US";let XI=Cv;class Sv{}class xT{}class Pb extends Sv{constructor(t,n,r){super(),this._parent=n,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new G0(this);const o=to(t);this._bootstrapComponents=rr(o.bootstrap),this._r3Injector=px(t,n,[{provide:Sv,useValue:this},{provide:Mp,useValue:this.componentFactoryResolver},...r],yo(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class Rb extends xT{constructor(t){super(),this.moduleType=t}create(t){return new Pb(this.moduleType,t,[])}}class wT extends Sv{constructor(t){super(),this.componentFactoryResolver=new G0(this),this.instance=null;const n=new Ep([...t.providers,{provide:Sv,useValue:this},{provide:Mp,useValue:this.componentFactoryResolver}],t.parent||bf(),t.debugName,new Set(["environment"]));this.injector=n,t.runEnvironmentInitializers&&n.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function Lb(e,t,n=null){return new wT({providers:e,parent:t,debugName:n,runEnvironmentInitializers:!0}).injector}let lN=(()=>{class e{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n.id)){const r=tf(0,n.type),o=r.length>0?Lb([r],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n.id,o)}return this.cachedInjectors.get(n.id)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}}return e.\u0275prov=sr({token:e,providedIn:"environment",factory:()=>new e(fr(nf))}),e})();function bT(e){e.getStandaloneInjector=t=>t.get(lN).getOrCreateStandaloneInjector(e)}function Nb(e){return t=>{setTimeout(e,void 0,t)}}const Dh=class NN extends Jt{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,r){let o=t,c=n||(()=>null),d=r;if(t&&"object"==typeof t){const E=t;o=E.next?.bind(E),c=E.error?.bind(E),d=E.complete?.bind(E)}this.__isAsync&&(c=Nb(c),o&&(o=Nb(o)),d&&(d=Nb(d)));const _=super.subscribe({next:o,error:c,complete:d});return t instanceof J&&t.add(_),_}};let Vd=(()=>{class e{}return e.__NG_ELEMENT_ID__=HN,e})();function HN(){return function zT(e,t){let n;const r=t[e.index];return Gs(r)?n=r:(n=function yi(e,t,n,r){return[e,!0,!1,t,null,0,r,n,null,null,null]}(r,t,null,e),t[e.index]=n,ui(t,n)),UT(n,t,e,r),new FT(n,e,t)}(xs(),ln())}const WN=Vd,FT=class extends WN{constructor(t,n,r){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=r}get element(){return Sf(this._hostTNode,this._hostLView)}get injector(){return new Wh(this._hostTNode,this._hostLView)}get parentInjector(){const t=wc(this._hostTNode,this._hostLView);if(_d(t)){const n=vd(t,this._hostLView),r=$h(t);return new Wh(n[bn].data[r+8],n)}return new Wh(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=BT(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-js}createEmbeddedView(t,n,r){let o,c;"number"==typeof r?o=r:null!=r&&(o=r.index,c=r.injector);const _=t.createEmbeddedViewImpl(n||{},c,null);return this.insertImpl(_,o,false),_}createComponent(t,n,r,o,c){const d=t&&!function Zh(e){return"function"==typeof e}(t);let _;if(d)_=n;else{const he=n||{};_=he.index,r=he.injector,o=he.projectableNodes,c=he.environmentInjector||he.ngModuleRef}const E=d?t:new oh($r(t)),S=r||this.parentInjector;if(!c&&null==E.ngModule){const Ve=(d?S:this.parentInjector).get(nf,null);Ve&&(c=Ve)}$r(E.componentType??{});const V=E.create(S,o,null,c);return this.insertImpl(V.hostView,_,false),V}insert(t,n){return this.insertImpl(t,n,!1)}insertImpl(t,n,r){const o=t._lView,c=o[bn];if(function fn(e){return Gs(e[co])}(o)){const E=this.indexOf(t);if(-1!==E)this.detach(E);else{const S=o[co],R=new FT(S,S[io],S[co]);R.detach(R.indexOf(t))}}const d=this._adjustIndex(n),_=this._lContainer;if(function sg(e,t,n,r){const o=js+r,c=n.length;r>0&&(n[o-1][_o]=t),r<c-js?(t[_o]=n[o],Hg(n,js+r,t)):(n.push(t),t[_o]=null),t[co]=n;const d=t[_s];null!==d&&n!==d&&function fp(e,t){const n=e[Fu];t[vo]!==t[co][co][vo]&&(e[fd]=!0),null===n?e[Fu]=[t]:n.push(t)}(d,t);const _=t[$n];null!==_&&_.insertView(e),t[qr]|=128}(c,o,_,d),!r){const E=_m(d,_),S=o[pr],R=Jf(S,_[Ys]);null!==R&&function g0(e,t,n,r,o,c){r[Ri]=o,r[io]=t,gp(e,r,n,1,o,c)}(c,_[io],S,o,R,E)}return t.attachToViewContainerRef(),Hg(Bb(_),d,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=BT(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),r=dm(this._lContainer,n);r&&(Wf(Bb(this._lContainer),n),pm(r[bn],r))}detach(t){const n=this._adjustIndex(t,-1),r=dm(this._lContainer,n);return r&&null!=Wf(Bb(this._lContainer),n)?new jm(r):null}_adjustIndex(t,n=0){return t??this.length+n}};function BT(e){return e[rl]}function Bb(e){return e[rl]||(e[rl]=[])}let UT=function VT(e,t,n,r){if(e[Ys])return;let o;o=8&n.type?at(r):function XN(e,t){const n=e[pr],r=n.createComment(""),o=kt(t,e);return vf(n,Jf(n,o),r,function Ad(e,t){return e.nextSibling(t)}(n,o),!1),r}(t,n),e[Ys]=o};const Zb=new Kr("Application Initializer");let Yb=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((n,r)=>{this.resolve=n,this.reject=r}),this.appInits=qn(Zb,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const n=[];for(const o of this.appInits){const c=o();if(Cx(c))n.push(c);else if(YS(c)){const d=new Promise((_,E)=>{c.subscribe({complete:_,error:E})});n.push(d)}}const r=()=>{this.done=!0,this.resolve()};Promise.all(n).then(()=>{r()}).catch(o=>{this.reject(o)}),0===n.length&&r(),this.initialized=!0}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),fM=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const Mg=new Kr("LocaleId",{providedIn:"root",factory:()=>qn(Mg,Rr.Optional|Rr.SkipSelf)||function Sk(){return typeof $localize<"u"&&$localize.locale||Cv}()});let dM=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new zt(!1)}add(){this.hasPendingTasks.next(!0);const n=this.taskId++;return this.pendingTasks.add(n),n}remove(n){this.pendingTasks.delete(n),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class Tk{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let pM=(()=>{class e{compileModuleSync(n){return new Rb(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const r=this.compileModuleSync(n),c=rr(to(n).declarations).reduce((d,_)=>{const E=$r(_);return E&&d.push(new oh(E)),d},[]);return new Tk(r,c)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Ak=(()=>Promise.resolve(0))();function Kb(e){typeof Zone>"u"?Ak.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}function yM(...e){}class Gu{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Dh(!1),this.onMicrotaskEmpty=new Dh(!1),this.onStable=new Dh(!1),this.onError=new Dh(!1),typeof Zone>"u")throw new Hn(908,!1);Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!r&&n,o.shouldCoalesceRunChangeDetection=r,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=function Pk(){let e=oi.requestAnimationFrame,t=oi.cancelAnimationFrame;if(typeof Zone<"u"&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function Ok(e){const t=()=>{!function Lk(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(oi,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,Qb(e),e.isCheckStableRunning=!0,Jb(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),Qb(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,o,c,d,_)=>{try{return _M(e),n.invokeTask(o,c,d,_)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===c.type||e.shouldCoalesceRunChangeDetection)&&t(),vM(e)}},onInvoke:(n,r,o,c,d,_,E)=>{try{return _M(e),n.invoke(o,c,d,_,E)}finally{e.shouldCoalesceRunChangeDetection&&t(),vM(e)}},onHasTask:(n,r,o,c)=>{n.hasTask(o,c),r===o&&("microTask"==c.change?(e._hasPendingMicrotasks=c.microTask,Qb(e),Jb(e)):"macroTask"==c.change&&(e.hasPendingMacrotasks=c.macroTask))},onHandleError:(n,r,o,c)=>(n.handleError(o,c),e.runOutsideAngular(()=>e.onError.emit(c)),!1)})}(o)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Gu.isInAngularZone())throw new Hn(909,!1)}static assertNotInAngularZone(){if(Gu.isInAngularZone())throw new Hn(909,!1)}run(t,n,r){return this._inner.run(t,n,r)}runTask(t,n,r,o){const c=this._inner,d=c.scheduleEventTask("NgZoneEvent: "+o,t,Rk,yM,yM);try{return c.runTask(d,n,r)}finally{c.cancelTask(d)}}runGuarded(t,n,r){return this._inner.runGuarded(t,n,r)}runOutsideAngular(t){return this._outer.run(t)}}const Rk={};function Jb(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Qb(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function _M(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function vM(e){e._nesting--,Jb(e)}class Nk{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Dh,this.onMicrotaskEmpty=new Dh,this.onStable=new Dh,this.onError=new Dh}run(t,n,r){return t.apply(n,r)}runGuarded(t,n,r){return t.apply(n,r)}runOutsideAngular(t){return t()}runTask(t,n,r,o){return t.apply(n,r)}}const xM=new Kr("",{providedIn:"root",factory:wM});function wM(){const e=qn(Gu);let t=!0;return function Xu(...e){const t=_a(e),n=function ms(e,t){return"number"==typeof lc(e)?e.pop():t}(e,1/0),r=e;return r.length?1===r.length?Cr(r[0]):uc(n)(bs(r,t)):Br}(new Ue(o=>{t=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{o.next(t),o.complete()})}),new Ue(o=>{let c;e.runOutsideAngular(()=>{c=e.onStable.subscribe(()=>{Gu.assertNotInAngularZone(),Kb(()=>{!t&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(t=!0,o.next(!0))})})});const d=e.onUnstable.subscribe(()=>{Gu.assertInAngularZone(),t&&(t=!1,e.runOutsideAngular(()=>{o.next(!1)}))});return()=>{c.unsubscribe(),d.unsubscribe()}}).pipe(Pc()))}const bM=new Kr(""),Nx=new Kr("");let nE,eE=(()=>{class e{constructor(n,r,o){this._ngZone=n,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,nE||(function kk(e){nE=e}(o),o.addToWindow(r)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Gu.assertNotInAngularZone(),Kb(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Kb(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(n)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,r,o){let c=-1;r&&r>0&&(c=setTimeout(()=>{this._callbacks=this._callbacks.filter(d=>d.timeoutId!==c),n(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:n,timeoutId:c,updateCb:o})}whenStable(n,r,o){if(o&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,r,o),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,r,o){return[]}}return e.\u0275fac=function(n){return new(n||e)(fr(Gu),fr(tE),fr(Nx))},e.\u0275prov=sr({token:e,factory:e.\u0275fac}),e})(),tE=(()=>{class e{constructor(){this._applications=new Map}registerApplication(n,r){this._applications.set(n,r)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,r=!0){return nE?.findTestabilityInTree(this,n,r)??null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})(),Hm=null;const EM=new Kr("AllowMultipleToken"),rE=new Kr("PlatformDestroyListeners"),iE=new Kr("appBootstrapListener");class SM{constructor(t,n){this.name=t,this.token=n}}function TM(e,t,n=[]){const r=`Platform: ${t}`,o=new Kr(r);return(c=[])=>{let d=oE();if(!d||d.injector.get(EM,!1)){const _=[...n,...c,{provide:o,useValue:!0}];e?e(_):function zk(e){if(Hm&&!Hm.get(EM,!1))throw new Hn(400,!1);(function CM(){!function g(e){w=e}(()=>{throw new Hn(600,!1)})})(),Hm=e;const t=e.get(DM);(function IM(e){e.get(Y_,null)?.forEach(n=>n())})(e)}(function MM(e=[],t){return If.create({name:t,providers:[{provide:Am,useValue:"platform"},{provide:rE,useValue:new Set([()=>Hm=null])},...e]})}(_,r))}return function Vk(e){const t=oE();if(!t)throw new Hn(401,!1);return t}()}}function oE(){return Hm?.get(DM)??null}let DM=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,r){const o=function jk(e="zone.js",t){return"noop"===e?new Nk:"zone.js"===e?new Gu(t):e}(r?.ngZone,function AM(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:r?.ngZoneEventCoalescing,runCoalescing:r?.ngZoneRunCoalescing}));return o.run(()=>{const c=function uN(e,t,n){return new Pb(e,t,n)}(n.moduleType,this.injector,function NM(e){return[{provide:Gu,useFactory:e},{provide:bp,multi:!0,useFactory:()=>{const t=qn($k,{optional:!0});return()=>t.initialize()}},{provide:OM,useFactory:Gk},{provide:xM,useFactory:wM}]}(()=>o)),d=c.injector.get(v,null);return o.runOutsideAngular(()=>{const _=o.onError.subscribe({next:E=>{d.handleError(E)}});c.onDestroy(()=>{kx(this._modules,c),_.unsubscribe()})}),function PM(e,t,n){try{const r=n();return Cx(r)?r.catch(o=>{throw t.runOutsideAngular(()=>e.handleError(o)),o}):r}catch(r){throw t.runOutsideAngular(()=>e.handleError(r)),r}}(d,o,()=>{const _=c.injector.get(Yb);return _.runInitializers(),_.donePromise.then(()=>(function ZI(e){Hr(e,"Expected localeId to be defined"),"string"==typeof e&&(XI=e.toLowerCase().replace(/_/g,"-"))}(c.injector.get(Mg,Cv)||Cv),this._moduleDoBootstrap(c),c))})})}bootstrapModule(n,r=[]){const o=RM({},r);return function Fk(e,t,n){const r=new Rb(n);return Promise.resolve(r)}(0,0,n).then(c=>this.bootstrapModuleFactory(c,o))}_moduleDoBootstrap(n){const r=n.injector.get(Mv);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(o=>r.bootstrap(o));else{if(!n.instance.ngDoBootstrap)throw new Hn(-403,!1);n.instance.ngDoBootstrap(r)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Hn(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const n=this._injector.get(rE,null);n&&(n.forEach(r=>r()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(n){return new(n||e)(fr(If))},e.\u0275prov=sr({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();function RM(e,t){return Array.isArray(t)?t.reduce(RM,e):{...e,...t}}let Mv=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=qn(OM),this.zoneIsStable=qn(xM),this.componentTypes=[],this.components=[],this.isStable=qn(dM).hasPendingTasks.pipe(Zr(n=>n?Qr(!1):this.zoneIsStable),function zr(e,t=Bt){return e=e??Ya,Mn((n,r)=>{let o,c=!0;n.subscribe(jn(r,d=>{const _=t(d);(c||!e(o,_))&&(c=!1,o=_,r.next(d))}))})}(),Pc()),this._injector=qn(nf)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,r){const o=n instanceof nv;if(!this._injector.get(Yb).done)throw!o&&function Da(e){const t=$r(e)||uo(e)||Xs(e);return null!==t&&t.standalone}(n),new Hn(405,!1);let d;d=o?n:this._injector.get(Mp).resolveComponentFactory(n),this.componentTypes.push(d.componentType);const _=function Bk(e){return e.isBoundToModule}(d)?void 0:this._injector.get(Sv),S=d.create(If.NULL,[],r||d.selector,_),R=S.location.nativeElement,L=S.injector.get(bM,null);return L?.registerApplication(R),S.onDestroy(()=>{this.detachView(S.hostView),kx(this.components,S),L?.unregisterApplication(R)}),this._loadComponent(S),S}tick(){if(this._runningTick)throw new Hn(101,!1);try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this.internalErrorHandler(n)}finally{this._runningTick=!1}}attachView(n){const r=n;this._views.push(r),r.attachToAppRef(this)}detachView(n){const r=n;kx(this._views,r),r.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);const r=this._injector.get(iE,[]);r.push(...this._bootstrapListeners),r.forEach(o=>o(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>kx(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new Hn(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function kx(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const OM=new Kr("",{providedIn:"root",factory:()=>qn(v).handleError.bind(void 0)});function Gk(){const e=qn(Gu),t=qn(v);return n=>e.runOutsideAngular(()=>t.handleError(n))}let $k=(()=>{class e{constructor(){this.zone=qn(Gu),this.applicationRef=qn(Mv)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();let sE=(()=>{class e{}return e.__NG_ELEMENT_ID__=Hk,e})();function Hk(e){return function Wk(e,t,n){if(xr(e)&&!n){const r=Ht(e.index,t);return new jm(r,r)}return 47&e.type?new jm(t[vo],t):null}(xs(),ln(),16==(16&e))}const sF=TM(null,"core",[]);let aF=(()=>{class e{constructor(n){}}return e.\u0275fac=function(n){return new(n||e)(fr(Mv))},e.\u0275mod=qi({type:e}),e.\u0275inj=Ku({}),e})(),pE=null;function Dv(){return pE}class vF{}const ad=new Kr("DocumentToken");let gE=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:function(){return qn(wF)},providedIn:"platform"}),e})();const xF=new Kr("Location Initialized");let wF=(()=>{class e extends gE{constructor(){super(),this._doc=qn(ad),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Dv().getBaseHref(this._doc)}onPopState(n){const r=Dv().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",n,!1),()=>r.removeEventListener("popstate",n)}onHashChange(n){const r=Dv().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",n,!1),()=>r.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,r,o){this._history.pushState(n,r,o)}replaceState(n,r,o){this._history.replaceState(n,r,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:function(){return new e},providedIn:"platform"}),e})();function mE(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function KM(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Dg(e){return e&&"?"!==e[0]?"?"+e:e}let u_=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:function(){return qn(QM)},providedIn:"root"}),e})();const JM=new Kr("appBaseHref");let QM=(()=>{class e extends u_{constructor(n,r){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??qn(ad).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return mE(this._baseHref,n)}path(n=!1){const r=this._platformLocation.pathname+Dg(this._platformLocation.search),o=this._platformLocation.hash;return o&&n?`${r}${o}`:r}pushState(n,r,o,c){const d=this.prepareExternalUrl(o+Dg(c));this._platformLocation.pushState(n,r,d)}replaceState(n,r,o,c){const d=this.prepareExternalUrl(o+Dg(c));this._platformLocation.replaceState(n,r,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(fr(gE),fr(JM,8))},e.\u0275prov=sr({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),bF=(()=>{class e extends u_{constructor(n,r){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(n){const r=mE(this._baseHref,n);return r.length>0?"#"+r:r}pushState(n,r,o,c){let d=this.prepareExternalUrl(o+Dg(c));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.pushState(n,r,d)}replaceState(n,r,o,c){let d=this.prepareExternalUrl(o+Dg(c));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.replaceState(n,r,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(fr(gE),fr(JM,8))},e.\u0275prov=sr({token:e,factory:e.\u0275fac}),e})(),yE=(()=>{class e{constructor(n){this._subject=new Dh,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const r=this._locationStrategy.getBaseHref();this._basePath=function SF(e){if(new RegExp("^(https?:)?//").test(e)){const[,n]=e.split(/\/\/[^\/]+/);return n}return e}(KM(eD(r))),this._locationStrategy.onPopState(o=>{this._subject.emit({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,r=""){return this.path()==this.normalize(n+Dg(r))}normalize(n){return e.stripTrailingSlash(function CF(e,t){if(!e||!t.startsWith(e))return t;const n=t.substring(e.length);return""===n||["/",";","?","#"].includes(n[0])?n:t}(this._basePath,eD(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,r="",o=null){this._locationStrategy.pushState(o,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Dg(r)),o)}replaceState(n,r="",o=null){this._locationStrategy.replaceState(o,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Dg(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",r){this._urlChangeListeners.forEach(o=>o(n,r))}subscribe(n,r,o){return this._subject.subscribe({next:n,error:r,complete:o})}}return e.normalizeQueryParams=Dg,e.joinWithSlash=mE,e.stripTrailingSlash=KM,e.\u0275fac=function(n){return new(n||e)(fr(u_))},e.\u0275prov=sr({token:e,factory:function(){return function EF(){return new yE(fr(u_))}()},providedIn:"root"}),e})();function eD(e){return e.replace(/\/index.html$/,"")}let z3=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=qi({type:e}),e.\u0275inj=Ku({}),e})();function mD(e){return"server"===e}let G3=(()=>{class e{}return e.\u0275prov=sr({token:e,providedIn:"root",factory:()=>new $3(fr(ad),window)}),e})();class $3{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const n=function q3(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let o=r.currentNode;for(;o;){const c=o.shadowRoot;if(c){const d=c.getElementById(t)||c.querySelector(`[name="${t}"]`);if(d)return d}o=r.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=t)}}scrollToElement(t){const n=t.getBoundingClientRect(),r=n.left+this.window.pageXOffset,o=n.top+this.window.pageYOffset,c=this.offset();this.window.scrollTo(r-c[0],o-c[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=yD(this.window.history)||yD(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function yD(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class vB extends vF{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class OE extends vB{static makeCurrent(){!function _F(e){pE||(pE=e)}(new OE)}onAndCancel(t,n,r){return t.addEventListener(n,r),()=>{t.removeEventListener(n,r)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function xB(){return d1=d1||document.querySelector("base"),d1?d1.getAttribute("href"):null}();return null==n?null:function wB(e){Qx=Qx||document.createElement("a"),Qx.setAttribute("href",e);const t=Qx.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){d1=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return function u3(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const r=n.indexOf("="),[o,c]=-1==r?[n,""]:[n.slice(0,r),n.slice(r+1)];if(o.trim()===t)return decodeURIComponent(c)}return null}(document.cookie,t)}}let Qx,d1=null,EB=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:e.\u0275fac}),e})();const NE=new Kr("EventManagerPlugins");let bD=(()=>{class e{constructor(n,r){this._zone=r,this._eventNameToPlugin=new Map,n.forEach(o=>{o.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,r,o){return this._findPluginFor(r).addEventListener(n,r,o)}getZone(){return this._zone}_findPluginFor(n){let r=this._eventNameToPlugin.get(n);if(r)return r;if(r=this._plugins.find(c=>c.supports(n)),!r)throw new Hn(5101,!1);return this._eventNameToPlugin.set(n,r),r}}return e.\u0275fac=function(n){return new(n||e)(fr(NE),fr(Gu))},e.\u0275prov=sr({token:e,factory:e.\u0275fac}),e})();class ED{constructor(t){this._doc=t}}const kE="ng-app-id";let CD=(()=>{class e{constructor(n,r,o,c={}){this.doc=n,this.appId=r,this.nonce=o,this.platformId=c,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=mD(c),this.resetHostNodes()}addStyles(n){for(const r of n)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(n){for(const r of n)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){const n=this.styleNodesInDOM;n&&(n.forEach(r=>r.remove()),n.clear());for(const r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(const r of this.getAllStyles())this.addStyleToHost(n,r)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(const r of this.hostNodes)this.addStyleToHost(r,n)}onStyleRemoved(n){const r=this.styleRef;r.get(n)?.elements?.forEach(o=>o.remove()),r.delete(n)}collectServerRenderedStyles(){const n=this.doc.head?.querySelectorAll(`style[${kE}="${this.appId}"]`);if(n?.length){const r=new Map;return n.forEach(o=>{null!=o.textContent&&r.set(o.textContent,o)}),r}return null}changeUsageCount(n,r){const o=this.styleRef;if(o.has(n)){const c=o.get(n);return c.usage+=r,c.usage}return o.set(n,{usage:r,elements:[]}),r}getStyleElement(n,r){const o=this.styleNodesInDOM,c=o?.get(r);if(c?.parentNode===n)return o.delete(r),c.removeAttribute(kE),c;{const d=this.doc.createElement("style");return this.nonce&&d.setAttribute("nonce",this.nonce),d.textContent=r,this.platformIsServer&&d.setAttribute(kE,this.appId),d}}addStyleToHost(n,r){const o=this.getStyleElement(n,r);n.appendChild(o);const c=this.styleRef,d=c.get(r)?.elements;d?d.push(o):c.set(r,{elements:[o],usage:1})}resetHostNodes(){const n=this.hostNodes;n.clear(),n.add(this.doc.head)}}return e.\u0275fac=function(n){return new(n||e)(fr(ad),fr(Ef),fr(J_,8),fr(Pd))},e.\u0275prov=sr({token:e,factory:e.\u0275fac}),e})();const FE={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},BE=/%COMP%/g,TB=new Kr("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function ID(e,t){return t.map(n=>n.replace(BE,e))}let TD=(()=>{class e{constructor(n,r,o,c,d,_,E,S=null){this.eventManager=n,this.sharedStylesHost=r,this.appId=o,this.removeStylesOnCompDestory=c,this.doc=d,this.platformId=_,this.ngZone=E,this.nonce=S,this.rendererByCompId=new Map,this.platformIsServer=mD(_),this.defaultRenderer=new zE(n,d,E,this.platformIsServer)}createRenderer(n,r){if(!n||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===el.ShadowDom&&(r={...r,encapsulation:el.Emulated});const o=this.getOrCreateRenderer(n,r);return o instanceof DD?o.applyToHost(n):o instanceof UE&&o.applyStyles(),o}getOrCreateRenderer(n,r){const o=this.rendererByCompId;let c=o.get(r.id);if(!c){const d=this.doc,_=this.ngZone,E=this.eventManager,S=this.sharedStylesHost,R=this.removeStylesOnCompDestory,L=this.platformIsServer;switch(r.encapsulation){case el.Emulated:c=new DD(E,S,r,this.appId,R,d,_,L);break;case el.ShadowDom:return new PB(E,S,n,r,d,_,this.nonce,L);default:c=new UE(E,S,r,R,d,_,L)}c.onDestroy=()=>o.delete(r.id),o.set(r.id,c)}return c}ngOnDestroy(){this.rendererByCompId.clear()}}return e.\u0275fac=function(n){return new(n||e)(fr(bD),fr(CD),fr(Ef),fr(TB),fr(ad),fr(Pd),fr(Gu),fr(J_))},e.\u0275prov=sr({token:e,factory:e.\u0275fac}),e})();class zE{constructor(t,n,r,o){this.eventManager=t,this.doc=n,this.ngZone=r,this.platformIsServer=o,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?this.doc.createElementNS(FE[n]||n,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,n){(MD(t)?t.content:t).appendChild(n)}insertBefore(t,n,r){t&&(MD(t)?t.content:t).insertBefore(n,r)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let r="string"==typeof t?this.doc.querySelector(t):t;if(!r)throw new Hn(5104,!1);return n||(r.textContent=""),r}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,r,o){if(o){n=o+":"+n;const c=FE[o];c?t.setAttributeNS(c,n,r):t.setAttribute(n,r)}else t.setAttribute(n,r)}removeAttribute(t,n,r){if(r){const o=FE[r];o?t.removeAttributeNS(o,n):t.removeAttribute(`${r}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,r,o){o&(nc.DashCase|nc.Important)?t.style.setProperty(n,r,o&nc.Important?"important":""):t.style[n]=r}removeStyle(t,n,r){r&nc.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,r){t[n]=r}setValue(t,n){t.nodeValue=n}listen(t,n,r){if("string"==typeof t&&!(t=Dv().getGlobalEventTarget(this.doc,t)))throw new Error(`Unsupported event target ${t} for event ${n}`);return this.eventManager.addEventListener(t,n,this.decoratePreventDefault(r))}decoratePreventDefault(t){return n=>{if("__ngUnwrap__"===n)return t;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>t(n)):t(n))&&n.preventDefault()}}}function MD(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class PB extends zE{constructor(t,n,r,o,c,d,_,E){super(t,c,d,E),this.sharedStylesHost=n,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const S=ID(o.id,o.styles);for(const R of S){const L=document.createElement("style");_&&L.setAttribute("nonce",_),L.textContent=R,this.shadowRoot.appendChild(L)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,r){return super.insertBefore(this.nodeOrShadowRoot(t),n,r)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class UE extends zE{constructor(t,n,r,o,c,d,_,E){super(t,c,d,_),this.sharedStylesHost=n,this.removeStylesOnCompDestory=o,this.rendererUsageCount=0,this.styles=E?ID(E,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class DD extends UE{constructor(t,n,r,o,c,d,_,E){const S=o+"-"+r.id;super(t,n,r,c,d,_,E,S),this.contentAttr=function MB(e){return"_ngcontent-%COMP%".replace(BE,e)}(S),this.hostAttr=function DB(e){return"_nghost-%COMP%".replace(BE,e)}(S)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,n){const r=super.createElement(t,n);return super.setAttribute(r,this.contentAttr,""),r}}let RB=(()=>{class e extends ED{constructor(n){super(n)}supports(n){return!0}addEventListener(n,r,o){return n.addEventListener(r,o,!1),()=>this.removeEventListener(n,r,o)}removeEventListener(n,r,o){return n.removeEventListener(r,o)}}return e.\u0275fac=function(n){return new(n||e)(fr(ad))},e.\u0275prov=sr({token:e,factory:e.\u0275fac}),e})();const AD=["alt","control","meta","shift"],LB={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},OB={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let NB=(()=>{class e extends ED{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,r,o){const c=e.parseEventName(r),d=e.eventCallback(c.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Dv().onAndCancel(n,c.domEventName,d))}static parseEventName(n){const r=n.toLowerCase().split("."),o=r.shift();if(0===r.length||"keydown"!==o&&"keyup"!==o)return null;const c=e._normalizeKey(r.pop());let d="",_=r.indexOf("code");if(_>-1&&(r.splice(_,1),d="code."),AD.forEach(S=>{const R=r.indexOf(S);R>-1&&(r.splice(R,1),d+=S+".")}),d+=c,0!=r.length||0===c.length)return null;const E={};return E.domEventName=o,E.fullKey=d,E}static matchEventFullKeyCode(n,r){let o=LB[n.key]||n.key,c="";return r.indexOf("code.")>-1&&(o=n.code,c="code."),!(null==o||!o)&&(o=o.toLowerCase()," "===o?o="space":"."===o&&(o="dot"),AD.forEach(d=>{d!==o&&(0,OB[d])(n)&&(c+=d+".")}),c+=o,c===r)}static eventCallback(n,r,o){return c=>{e.matchEventFullKeyCode(c,n)&&o.runGuarded(()=>r(c))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return e.\u0275fac=function(n){return new(n||e)(fr(ad))},e.\u0275prov=sr({token:e,factory:e.\u0275fac}),e})();const zB=TM(sF,"browser",[{provide:Pd,useValue:"browser"},{provide:Y_,useValue:function kB(){OE.makeCurrent()},multi:!0},{provide:ad,useFactory:function BB(){return function Oy(e){yp=e}(document),document},deps:[]}]),UB=new Kr(""),LD=[{provide:Nx,useClass:class bB{addToWindow(t){oi.getAngularTestability=(r,o=!0)=>{const c=t.findTestabilityInTree(r,o);if(null==c)throw new Hn(5103,!1);return c},oi.getAllAngularTestabilities=()=>t.getAllTestabilities(),oi.getAllAngularRootElements=()=>t.getAllRootElements(),oi.frameworkStabilizers||(oi.frameworkStabilizers=[]),oi.frameworkStabilizers.push(r=>{const o=oi.getAllAngularTestabilities();let c=o.length,d=!1;const _=function(E){d=d||E,c--,0==c&&r(d)};o.forEach(function(E){E.whenStable(_)})})}findTestabilityInTree(t,n,r){return null==n?null:t.getTestability(n)??(r?Dv().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null)}},deps:[]},{provide:bM,useClass:eE,deps:[Gu,tE,Nx]},{provide:eE,useClass:eE,deps:[Gu,tE,Nx]}],OD=[{provide:Am,useValue:"root"},{provide:v,useFactory:function FB(){return new v},deps:[]},{provide:NE,useClass:RB,multi:!0,deps:[ad,Gu,Pd]},{provide:NE,useClass:NB,multi:!0,deps:[ad]},TD,CD,bD,{provide:iv,useExisting:TD},{provide:class H3{},useClass:EB,deps:[]},[]];let VB=(()=>{class e{constructor(n){}static withServerTransition(n){return{ngModule:e,providers:[{provide:Ef,useValue:n.appId}]}}}return e.\u0275fac=function(n){return new(n||e)(fr(UB,12))},e.\u0275mod=qi({type:e}),e.\u0275inj=Ku({providers:[...OD,...LD],imports:[z3,aF]}),e})(),ND=(()=>{class e{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}}return e.\u0275fac=function(n){return new(n||e)(fr(ad))},e.\u0275prov=sr({token:e,factory:function(n){let r=null;return r=n?new n:function GB(){return new ND(fr(ad))}(),r},providedIn:"root"}),e})();typeof window<"u"&&window;const{isArray:ZB}=Array,{getPrototypeOf:YB,prototype:KB,keys:JB}=Object;const{isArray:tz}=Array;function jE(...e){const t=_a(e),n=function gs(e){return me(lc(e))?e.pop():void 0}(e),{args:r,keys:o}=function QB(e){if(1===e.length){const t=e[0];if(ZB(t))return{args:t,keys:null};if(function ez(e){return e&&"object"==typeof e&&YB(e)===KB}(t)){const n=JB(t);return{args:n.map(r=>t[r]),keys:n}}}return{args:e,keys:null}}(e);if(0===r.length)return bs([],t);const c=new Ue(function oz(e,t,n=Bt){return r=>{zD(t,()=>{const{length:o}=e,c=new Array(o);let d=o,_=o;for(let E=0;E<o;E++)zD(t,()=>{const S=bs(e[E],t);let R=!1;S.subscribe(jn(r,L=>{c[E]=L,R||(R=!0,_--),_||r.next(n(c.slice()))},()=>{--d||r.complete()}))},r)},r)}}(r,t,o?d=>function iz(e,t){return e.reduce((n,r,o)=>(n[r]=t[o],n),{})}(o,d):Bt));return n?c.pipe(function rz(e){return Nn(t=>function nz(e,t){return tz(t)?e(...t):e(t)}(e,t))}(n)):c}function zD(e,t,n){e?zi(n,e,t):t()}const ew=q(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function GE(...e){return function sz(){return uc(1)}()(bs(e,_a(e)))}function UD(e){return new Ue(t=>{Cr(e()).subscribe(t)})}function p1(e,t){const n=me(e)?e:()=>e,r=o=>o.error(n());return new Ue(t?o=>t.schedule(r,0,o):r)}function $E(){return Mn((e,t)=>{let n=null;e._refCount++;const r=jn(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const o=e._connection,c=n;n=null,o&&(!c||o===c)&&o.unsubscribe(),t.unsubscribe()});e.subscribe(r),r.closed||(n=e.connect())})}class VD extends Ue{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,Jn(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new J;const n=this.getSubject();t.add(this.source.subscribe(jn(n,void 0,()=>{this._teardown(),n.complete()},r=>{this._teardown(),n.error(r)},()=>this._teardown()))),t.closed&&(this._connection=null,t=J.EMPTY)}return t}refCount(){return $E()(this)}}function Av(e){return e<=0?()=>Br:Mn((t,n)=>{let r=0;t.subscribe(jn(n,o=>{++r<=e&&(n.next(o),e<=r&&n.complete())}))})}function Xm(e,t){return Mn((n,r)=>{let o=0;n.subscribe(jn(r,c=>e.call(t,c,o++)&&r.next(c)))})}function tw(e){return Mn((t,n)=>{let r=!1;t.subscribe(jn(n,o=>{r=!0,n.next(o)},()=>{r||n.next(e),n.complete()}))})}function jD(e=uz){return Mn((t,n)=>{let r=!1;t.subscribe(jn(n,o=>{r=!0,n.next(o)},()=>r?n.complete():n.error(e())))})}function uz(){return new ew}function l_(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Xm((o,c)=>e(o,c,r)):Bt,Av(1),n?tw(t):jD(()=>new ew))}function g1(e,t){return me(t)?wo(e,t,1):wo(e,1)}function Ph(e,t,n){const r=me(e)||t||n?{next:e,error:t,complete:n}:e;return r?Mn((o,c)=>{var d;null===(d=r.subscribe)||void 0===d||d.call(r);let _=!0;o.subscribe(jn(c,E=>{var S;null===(S=r.next)||void 0===S||S.call(r,E),c.next(E)},()=>{var E;_=!1,null===(E=r.complete)||void 0===E||E.call(r),c.complete()},E=>{var S;_=!1,null===(S=r.error)||void 0===S||S.call(r,E),c.error(E)},()=>{var E,S;_&&(null===(E=r.unsubscribe)||void 0===E||E.call(r)),null===(S=r.finalize)||void 0===S||S.call(r)}))}):Bt}function c_(e){return Mn((t,n)=>{let c,r=null,o=!1;r=t.subscribe(jn(n,void 0,void 0,d=>{c=Cr(e(d,c_(e)(t))),r?(r.unsubscribe(),r=null,c.subscribe(n)):o=!0})),o&&(r.unsubscribe(),r=null,c.subscribe(n))})}function qE(e){return e<=0?()=>Br:Mn((t,n)=>{let r=[];t.subscribe(jn(n,o=>{r.push(o),e<r.length&&r.shift()},()=>{for(const o of r)n.next(o);n.complete()},void 0,()=>{r=null}))})}function HE(e){return Mn((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}const so="primary",m1=Symbol("RouteTitle");class dz{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function Pv(e){return new dz(e)}function pz(e,t,n){const r=n.path.split("/");if(r.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;const o={};for(let c=0;c<r.length;c++){const d=r[c],_=e[c];if(d.startsWith(":"))o[d.substring(1)]=_;else if(d!==_.path)return null}return{consumed:e.slice(0,r.length),posParams:o}}function Np(e,t){const n=e?Object.keys(e):void 0,r=t?Object.keys(t):void 0;if(!n||!r||n.length!=r.length)return!1;let o;for(let c=0;c<n.length;c++)if(o=n[c],!GD(e[o],t[o]))return!1;return!0}function GD(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();return n.every((o,c)=>r[c]===o)}return e===t}function $D(e){return e.length>0?e[e.length-1]:null}function Zm(e){return function XB(e){return!!e&&(e instanceof Ue||me(e.lift)&&me(e.subscribe))}(e)?e:Cx(e)?bs(Promise.resolve(e)):Qr(e)}const mz={exact:function WD(e,t,n){if(!h_(e.segments,t.segments)||!nw(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const r in t.children)if(!e.children[r]||!WD(e.children[r],t.children[r],n))return!1;return!0},subset:XD},qD={exact:function yz(e,t){return Np(e,t)},subset:function _z(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>GD(e[n],t[n]))},ignored:()=>!0};function HD(e,t,n){return mz[n.paths](e.root,t.root,n.matrixParams)&&qD[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function XD(e,t,n){return ZD(e,t,t.segments,n)}function ZD(e,t,n,r){if(e.segments.length>n.length){const o=e.segments.slice(0,n.length);return!(!h_(o,n)||t.hasChildren()||!nw(o,n,r))}if(e.segments.length===n.length){if(!h_(e.segments,n)||!nw(e.segments,n,r))return!1;for(const o in t.children)if(!e.children[o]||!XD(e.children[o],t.children[o],r))return!1;return!0}{const o=n.slice(0,e.segments.length),c=n.slice(e.segments.length);return!!(h_(e.segments,o)&&nw(e.segments,o,r)&&e.children[so])&&ZD(e.children[so],t,c,r)}}function nw(e,t,n){return t.every((r,o)=>qD[n](e[o].parameters,r.parameters))}class Rv{constructor(t=new Sa([],{}),n={},r=null){this.root=t,this.queryParams=n,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Pv(this.queryParams)),this._queryParamMap}toString(){return wz.serialize(this)}}class Sa{constructor(t,n){this.segments=t,this.children=n,this.parent=null,Object.values(n).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return rw(this)}}class y1{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=Pv(this.parameters)),this._parameterMap}toString(){return JD(this)}}function h_(e,t){return e.length===t.length&&e.every((n,r)=>n.path===t[r].path)}let _1=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:function(){return new WE},providedIn:"root"}),e})();class WE{parse(t){const n=new Rz(t);return new Rv(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${v1(t.root,!0)}`,r=function Cz(e){const t=Object.keys(e).map(n=>{const r=e[n];return Array.isArray(r)?r.map(o=>`${iw(n)}=${iw(o)}`).join("&"):`${iw(n)}=${iw(r)}`}).filter(n=>!!n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${r}${"string"==typeof t.fragment?`#${function bz(e){return encodeURI(e)}(t.fragment)}`:""}`}}const wz=new WE;function rw(e){return e.segments.map(t=>JD(t)).join("/")}function v1(e,t){if(!e.hasChildren())return rw(e);if(t){const n=e.children[so]?v1(e.children[so],!1):"",r=[];return Object.entries(e.children).forEach(([o,c])=>{o!==so&&r.push(`${o}:${v1(c,!1)}`)}),r.length>0?`${n}(${r.join("//")})`:n}{const n=function xz(e,t){let n=[];return Object.entries(e.children).forEach(([r,o])=>{r===so&&(n=n.concat(t(o,r)))}),Object.entries(e.children).forEach(([r,o])=>{r!==so&&(n=n.concat(t(o,r)))}),n}(e,(r,o)=>o===so?[v1(e.children[so],!1)]:[`${o}:${v1(r,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[so]?`${rw(e)}/${n[0]}`:`${rw(e)}/(${n.join("//")})`}}function YD(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function iw(e){return YD(e).replace(/%3B/gi,";")}function XE(e){return YD(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function ow(e){return decodeURIComponent(e)}function KD(e){return ow(e.replace(/\+/g,"%20"))}function JD(e){return`${XE(e.path)}${function Ez(e){return Object.keys(e).map(t=>`;${XE(t)}=${XE(e[t])}`).join("")}(e.parameters)}`}const Sz=/^[^\/()?;#]+/;function ZE(e){const t=e.match(Sz);return t?t[0]:""}const Iz=/^[^\/()?;=#]+/,Mz=/^[^=?&#]+/,Az=/^[^&#]+/;class Rz{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Sa([],{}):new Sa([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(r[so]=new Sa(t,n)),r}parseSegment(){const t=ZE(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Hn(4009,!1);return this.capture(t),new y1(ow(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=function Tz(e){const t=e.match(Iz);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const o=ZE(this.remaining);o&&(r=o,this.capture(r))}t[ow(n)]=ow(r)}parseQueryParam(t){const n=function Dz(e){const t=e.match(Mz);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const d=function Pz(e){const t=e.match(Az);return t?t[0]:""}(this.remaining);d&&(r=d,this.capture(r))}const o=KD(n),c=KD(r);if(t.hasOwnProperty(o)){let d=t[o];Array.isArray(d)||(d=[d],t[o]=d),d.push(c)}else t[o]=c}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=ZE(this.remaining),o=this.remaining[r.length];if("/"!==o&&")"!==o&&";"!==o)throw new Hn(4010,!1);let c;r.indexOf(":")>-1?(c=r.slice(0,r.indexOf(":")),this.capture(c),this.capture(":")):t&&(c=so);const d=this.parseChildren();n[c]=1===Object.keys(d).length?d[so]:new Sa([],d),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Hn(4011,!1)}}function QD(e){return e.segments.length>0?new Sa([],{[so]:e}):e}function eA(e){const t={};for(const r of Object.keys(e.children)){const c=eA(e.children[r]);if(r===so&&0===c.segments.length&&c.hasChildren())for(const[d,_]of Object.entries(c.children))t[d]=_;else(c.segments.length>0||c.hasChildren())&&(t[r]=c)}return function Lz(e){if(1===e.numberOfChildren&&e.children[so]){const t=e.children[so];return new Sa(e.segments.concat(t.segments),t.children)}return e}(new Sa(e.segments,t))}function f_(e){return e instanceof Rv}function tA(e){let t;const o=QD(function n(c){const d={};for(const E of c.children){const S=n(E);d[E.outlet]=S}const _=new Sa(c.url,d);return c===e&&(t=_),_}(e.root));return t??o}function nA(e,t,n,r){let o=e;for(;o.parent;)o=o.parent;if(0===t.length)return YE(o,o,o,n,r);const c=function Nz(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new iA(!0,0,e);let t=0,n=!1;const r=e.reduce((o,c,d)=>{if("object"==typeof c&&null!=c){if(c.outlets){const _={};return Object.entries(c.outlets).forEach(([E,S])=>{_[E]="string"==typeof S?S.split("/"):S}),[...o,{outlets:_}]}if(c.segmentPath)return[...o,c.segmentPath]}return"string"!=typeof c?[...o,c]:0===d?(c.split("/").forEach((_,E)=>{0==E&&"."===_||(0==E&&""===_?n=!0:".."===_?t++:""!=_&&o.push(_))}),o):[...o,c]},[]);return new iA(n,t,r)}(t);if(c.toRoot())return YE(o,o,new Sa([],{}),n,r);const d=function kz(e,t,n){if(e.isAbsolute)return new aw(t,!0,0);if(!n)return new aw(t,!1,NaN);if(null===n.parent)return new aw(n,!0,0);const r=sw(e.commands[0])?0:1;return function Fz(e,t,n){let r=e,o=t,c=n;for(;c>o;){if(c-=o,r=r.parent,!r)throw new Hn(4005,!1);o=r.segments.length}return new aw(r,!1,o-c)}(n,n.segments.length-1+r,e.numberOfDoubleDots)}(c,o,e),_=d.processChildren?w1(d.segmentGroup,d.index,c.commands):oA(d.segmentGroup,d.index,c.commands);return YE(o,d.segmentGroup,_,n,r)}function sw(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function x1(e){return"object"==typeof e&&null!=e&&e.outlets}function YE(e,t,n,r,o){let d,c={};r&&Object.entries(r).forEach(([E,S])=>{c[E]=Array.isArray(S)?S.map(R=>`${R}`):`${S}`}),d=e===t?n:rA(e,t,n);const _=QD(eA(d));return new Rv(_,c,o)}function rA(e,t,n){const r={};return Object.entries(e.children).forEach(([o,c])=>{r[o]=c===t?n:rA(c,t,n)}),new Sa(e.segments,r)}class iA{constructor(t,n,r){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=r,t&&r.length>0&&sw(r[0]))throw new Hn(4003,!1);const o=r.find(x1);if(o&&o!==$D(r))throw new Hn(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class aw{constructor(t,n,r){this.segmentGroup=t,this.processChildren=n,this.index=r}}function oA(e,t,n){if(e||(e=new Sa([],{})),0===e.segments.length&&e.hasChildren())return w1(e,t,n);const r=function zz(e,t,n){let r=0,o=t;const c={match:!1,pathIndex:0,commandIndex:0};for(;o<e.segments.length;){if(r>=n.length)return c;const d=e.segments[o],_=n[r];if(x1(_))break;const E=`${_}`,S=r<n.length-1?n[r+1]:null;if(o>0&&void 0===E)break;if(E&&S&&"object"==typeof S&&void 0===S.outlets){if(!aA(E,S,d))return c;r+=2}else{if(!aA(E,{},d))return c;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}(e,t,n),o=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const c=new Sa(e.segments.slice(0,r.pathIndex),{});return c.children[so]=new Sa(e.segments.slice(r.pathIndex),e.children),w1(c,0,o)}return r.match&&0===o.length?new Sa(e.segments,{}):r.match&&!e.hasChildren()?KE(e,t,n):r.match?w1(e,0,o):KE(e,t,n)}function w1(e,t,n){if(0===n.length)return new Sa(e.segments,{});{const r=function Bz(e){return x1(e[0])?e[0].outlets:{[so]:e}}(n),o={};if(!r[so]&&e.children[so]&&1===e.numberOfChildren&&0===e.children[so].segments.length){const c=w1(e.children[so],t,n);return new Sa(e.segments,c.children)}return Object.entries(r).forEach(([c,d])=>{"string"==typeof d&&(d=[d]),null!==d&&(o[c]=oA(e.children[c],t,d))}),Object.entries(e.children).forEach(([c,d])=>{void 0===r[c]&&(o[c]=d)}),new Sa(e.segments,o)}}function KE(e,t,n){const r=e.segments.slice(0,t);let o=0;for(;o<n.length;){const c=n[o];if(x1(c)){const E=Uz(c.outlets);return new Sa(r,E)}if(0===o&&sw(n[0])){r.push(new y1(e.segments[t].path,sA(n[0]))),o++;continue}const d=x1(c)?c.outlets[so]:`${c}`,_=o<n.length-1?n[o+1]:null;d&&_&&sw(_)?(r.push(new y1(d,sA(_))),o+=2):(r.push(new y1(d,{})),o++)}return new Sa(r,{})}function Uz(e){const t={};return Object.entries(e).forEach(([n,r])=>{"string"==typeof r&&(r=[r]),null!==r&&(t[n]=KE(new Sa([],{}),0,r))}),t}function sA(e){const t={};return Object.entries(e).forEach(([n,r])=>t[n]=`${r}`),t}function aA(e,t,n){return e==n.path&&Np(t,n.parameters)}const b1="imperative";class kp{constructor(t,n){this.id=t,this.url=n}}class JE extends kp{constructor(t,n,r="imperative",o=null){super(t,n),this.type=0,this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class d_ extends kp{constructor(t,n,r){super(t,n),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class uw extends kp{constructor(t,n,r,o){super(t,n),this.reason=r,this.code=o,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class E1 extends kp{constructor(t,n,r,o){super(t,n),this.reason=r,this.code=o,this.type=16}}class QE extends kp{constructor(t,n,r,o){super(t,n),this.error=r,this.target=o,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Vz extends kp{constructor(t,n,r,o){super(t,n),this.urlAfterRedirects=r,this.state=o,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class jz extends kp{constructor(t,n,r,o){super(t,n),this.urlAfterRedirects=r,this.state=o,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Gz extends kp{constructor(t,n,r,o,c){super(t,n),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=c,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class $z extends kp{constructor(t,n,r,o){super(t,n),this.urlAfterRedirects=r,this.state=o,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class qz extends kp{constructor(t,n,r,o){super(t,n),this.urlAfterRedirects=r,this.state=o,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Hz{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Wz{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Xz{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Zz{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Yz{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Kz{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class uA{constructor(t,n,r){this.routerEvent=t,this.position=n,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class Jz{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new C1,this.attachRef=null}}let C1=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(n,r){const o=this.getOrCreateContext(n);o.outlet=r,this.contexts.set(n,o)}onChildOutletDestroyed(n){const r=this.getContext(n);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let r=this.getContext(n);return r||(r=new Jz,this.contexts.set(n,r)),r}getContext(n){return this.contexts.get(n)||null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class lA{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=eC(t,this._root);return n?n.children.map(r=>r.value):[]}firstChild(t){const n=eC(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=tC(t,this._root);return n.length<2?[]:n[n.length-2].children.map(o=>o.value).filter(o=>o!==t)}pathFromRoot(t){return tC(t,this._root).map(n=>n.value)}}function eC(e,t){if(e===t.value)return t;for(const n of t.children){const r=eC(e,n);if(r)return r}return null}function tC(e,t){if(e===t.value)return[t];for(const n of t.children){const r=tC(e,n);if(r.length)return r.unshift(t),r}return[]}class Pg{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function Lv(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class cA extends lA{constructor(t,n){super(t),this.snapshot=n,nC(this,t)}toString(){return this.snapshot.toString()}}function hA(e,t){const n=function Qz(e,t){const d=new lw([],{},{},"",{},so,t,null,{});return new dA("",new Pg(d,[]))}(0,t),r=new zt([new y1("",{})]),o=new zt({}),c=new zt({}),d=new zt({}),_=new zt(""),E=new Ov(r,o,d,_,c,so,t,n.root);return E.snapshot=n.root,new cA(new Pg(E,[]),n)}class Ov{constructor(t,n,r,o,c,d,_,E){this.urlSubject=t,this.paramsSubject=n,this.queryParamsSubject=r,this.fragmentSubject=o,this.dataSubject=c,this.outlet=d,this.component=_,this._futureSnapshot=E,this.title=this.dataSubject?.pipe(Nn(S=>S[m1]))??Qr(void 0),this.url=t,this.params=n,this.queryParams=r,this.fragment=o,this.data=c}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Nn(t=>Pv(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Nn(t=>Pv(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function fA(e,t="emptyOnly"){const n=e.pathFromRoot;let r=0;if("always"!==t)for(r=n.length-1;r>=1;){const o=n[r],c=n[r-1];if(o.routeConfig&&""===o.routeConfig.path)r--;else{if(c.component)break;r--}}return function e4(e){return e.reduce((t,n)=>({params:{...t.params,...n.params},data:{...t.data,...n.data},resolve:{...n.data,...t.resolve,...n.routeConfig?.data,...n._resolvedData}}),{params:{},data:{},resolve:{}})}(n.slice(r))}class lw{get title(){return this.data?.[m1]}constructor(t,n,r,o,c,d,_,E,S){this.url=t,this.params=n,this.queryParams=r,this.fragment=o,this.data=c,this.outlet=d,this.component=_,this.routeConfig=E,this._resolve=S}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Pv(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Pv(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class dA extends lA{constructor(t,n){super(n),this.url=t,nC(this,n)}toString(){return pA(this._root)}}function nC(e,t){t.value._routerState=e,t.children.forEach(n=>nC(e,n))}function pA(e){const t=e.children.length>0?` { ${e.children.map(pA).join(", ")} } `:"";return`${e.value}${t}`}function rC(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Np(t.queryParams,n.queryParams)||e.queryParamsSubject.next(n.queryParams),t.fragment!==n.fragment&&e.fragmentSubject.next(n.fragment),Np(t.params,n.params)||e.paramsSubject.next(n.params),function gz(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Np(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.urlSubject.next(n.url),Np(t.data,n.data)||e.dataSubject.next(n.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function iC(e,t){const n=Np(e.params,t.params)&&function vz(e,t){return h_(e,t)&&e.every((n,r)=>Np(n.parameters,t[r].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||iC(e.parent,t.parent))}let oC=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=so,this.activateEvents=new Dh,this.deactivateEvents=new Dh,this.attachEvents=new Dh,this.detachEvents=new Dh,this.parentContexts=qn(C1),this.location=qn(Vd),this.changeDetector=qn(sE),this.environmentInjector=qn(nf),this.inputBinder=qn(cw,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(n){if(n.name){const{firstChange:r,previousValue:o}=n.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Hn(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Hn(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Hn(4012,!1);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,r){this.activated=n,this._activatedRoute=r,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,r){if(this.isActivated)throw new Hn(4013,!1);this._activatedRoute=n;const o=this.location,d=n.snapshot.component,_=this.parentContexts.getOrCreateContext(this.name).children,E=new t4(n,_,o.injector);this.activated=o.createComponent(d,{index:o.length,injector:E,environmentInjector:r??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=Vi({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[se]}),e})();class t4{constructor(t,n,r){this.route=t,this.childContexts=n,this.parent=r}get(t,n){return t===Ov?this.route:t===C1?this.childContexts:this.parent.get(t,n)}}const cw=new Kr("");let gA=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(n){this.unsubscribeFromRouteData(n),this.subscribeToRouteData(n)}unsubscribeFromRouteData(n){this.outletDataSubscriptions.get(n)?.unsubscribe(),this.outletDataSubscriptions.delete(n)}subscribeToRouteData(n){const{activatedRoute:r}=n,o=jE([r.queryParams,r.params,r.data]).pipe(Zr(([c,d,_],E)=>(_={...c,...d,..._},0===E?Qr(_):Promise.resolve(_)))).subscribe(c=>{if(!n.isActivated||!n.activatedComponentRef||n.activatedRoute!==r||null===r.component)return void this.unsubscribeFromRouteData(n);const d=function yF(e){const t=$r(e);if(!t)return null;const n=new oh(t);return{get selector(){return n.selector},get type(){return n.componentType},get inputs(){return n.inputs},get outputs(){return n.outputs},get ngContentSelectors(){return n.ngContentSelectors},get isStandalone(){return t.standalone}}}(r.component);if(d)for(const{templateName:_}of d.inputs)n.activatedComponentRef.setInput(_,c[_]);else this.unsubscribeFromRouteData(n)});this.outletDataSubscriptions.set(n,o)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:e.\u0275fac}),e})();function S1(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=t.value;const o=function r4(e,t,n){return t.children.map(r=>{for(const o of n.children)if(e.shouldReuseRoute(r.value,o.value.snapshot))return S1(e,r,o);return S1(e,r)})}(e,t,n);return new Pg(r,o)}{if(e.shouldAttach(t.value)){const c=e.retrieve(t.value);if(null!==c){const d=c.route;return d.value._futureSnapshot=t.value,d.children=t.children.map(_=>S1(e,_)),d}}const r=function i4(e){return new Ov(new zt(e.url),new zt(e.params),new zt(e.queryParams),new zt(e.fragment),new zt(e.data),e.outlet,e.component,e)}(t.value),o=t.children.map(c=>S1(e,c));return new Pg(r,o)}}const sC="ngNavigationCancelingError";function mA(e,t){const{redirectTo:n,navigationBehaviorOptions:r}=f_(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,o=yA(!1,0,t);return o.url=n,o.navigationBehaviorOptions=r,o}function yA(e,t,n){const r=new Error("NavigationCancelingError: "+(e||""));return r[sC]=!0,r.cancellationCode=t,n&&(r.url=n),r}function _A(e){return vA(e)&&f_(e.url)}function vA(e){return e&&e[sC]}let xA=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=un({type:e,selectors:[["ng-component"]],standalone:!0,features:[bT],decls:1,vars:0,template:function(n,r){1&n&&wv(0,"router-outlet")},dependencies:[oC],encapsulation:2}),e})();function aC(e){const t=e.children&&e.children.map(aC),n=t?{...e,children:t}:{...e};return!n.component&&!n.loadComponent&&(t||n.loadChildren)&&n.outlet&&n.outlet!==so&&(n.component=xA),n}function qd(e){return e.outlet||so}function I1(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}class h4{constructor(t,n,r,o,c){this.routeReuseStrategy=t,this.futureState=n,this.currState=r,this.forwardEvent=o,this.inputBindingEnabled=c}activate(t){const n=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,r,t),rC(this.futureState.root),this.activateChildRoutes(n,r,t)}deactivateChildRoutes(t,n,r){const o=Lv(n);t.children.forEach(c=>{const d=c.value.outlet;this.deactivateRoutes(c,o[d],r),delete o[d]}),Object.values(o).forEach(c=>{this.deactivateRouteAndItsChildren(c,r)})}deactivateRoutes(t,n,r){const o=t.value,c=n?n.value:null;if(o===c)if(o.component){const d=r.getContext(o.outlet);d&&this.deactivateChildRoutes(t,n,d.children)}else this.deactivateChildRoutes(t,n,r);else c&&this.deactivateRouteAndItsChildren(n,r)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const r=n.getContext(t.value.outlet),o=r&&t.value.component?r.children:n,c=Lv(t);for(const d of Object.keys(c))this.deactivateRouteAndItsChildren(c[d],o);if(r&&r.outlet){const d=r.outlet.detach(),_=r.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:d,route:t,contexts:_})}}deactivateRouteAndOutlet(t,n){const r=n.getContext(t.value.outlet),o=r&&t.value.component?r.children:n,c=Lv(t);for(const d of Object.keys(c))this.deactivateRouteAndItsChildren(c[d],o);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(t,n,r){const o=Lv(n);t.children.forEach(c=>{this.activateRoutes(c,o[c.value.outlet],r),this.forwardEvent(new Kz(c.value.snapshot))}),t.children.length&&this.forwardEvent(new Zz(t.value.snapshot))}activateRoutes(t,n,r){const o=t.value,c=n?n.value:null;if(rC(o),o===c)if(o.component){const d=r.getOrCreateContext(o.outlet);this.activateChildRoutes(t,n,d.children)}else this.activateChildRoutes(t,n,r);else if(o.component){const d=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){const _=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),d.children.onOutletReAttached(_.contexts),d.attachRef=_.componentRef,d.route=_.route.value,d.outlet&&d.outlet.attach(_.componentRef,_.route.value),rC(_.route.value),this.activateChildRoutes(t,null,d.children)}else{const _=I1(o.snapshot);d.attachRef=null,d.route=o,d.injector=_,d.outlet&&d.outlet.activateWith(o,d.injector),this.activateChildRoutes(t,null,d.children)}}else this.activateChildRoutes(t,null,r)}}class wA{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class hw{constructor(t,n){this.component=t,this.route=n}}function f4(e,t,n){const r=e._root;return T1(r,t?t._root:null,n,[r.value])}function Nv(e,t){const n=Symbol(),r=t.get(e,n);return r===n?"function"!=typeof e||function Zo(e){return null!==cc(e)}(e)?t.get(e):e:r}function T1(e,t,n,r,o={canDeactivateChecks:[],canActivateChecks:[]}){const c=Lv(t);return e.children.forEach(d=>{(function p4(e,t,n,r,o={canDeactivateChecks:[],canActivateChecks:[]}){const c=e.value,d=t?t.value:null,_=n?n.getContext(e.value.outlet):null;if(d&&c.routeConfig===d.routeConfig){const E=function g4(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!h_(e.url,t.url);case"pathParamsOrQueryParamsChange":return!h_(e.url,t.url)||!Np(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!iC(e,t)||!Np(e.queryParams,t.queryParams);default:return!iC(e,t)}}(d,c,c.routeConfig.runGuardsAndResolvers);E?o.canActivateChecks.push(new wA(r)):(c.data=d.data,c._resolvedData=d._resolvedData),T1(e,t,c.component?_?_.children:null:n,r,o),E&&_&&_.outlet&&_.outlet.isActivated&&o.canDeactivateChecks.push(new hw(_.outlet.component,d))}else d&&M1(t,_,o),o.canActivateChecks.push(new wA(r)),T1(e,null,c.component?_?_.children:null:n,r,o)})(d,c[d.value.outlet],n,r.concat([d.value]),o),delete c[d.value.outlet]}),Object.entries(c).forEach(([d,_])=>M1(_,n.getContext(d),o)),o}function M1(e,t,n){const r=Lv(e),o=e.value;Object.entries(r).forEach(([c,d])=>{M1(d,o.component?t?t.children.getContext(c):null:t,n)}),n.canDeactivateChecks.push(new hw(o.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,o))}function D1(e){return"function"==typeof e}function bA(e){return e instanceof ew||"EmptyError"===e?.name}const fw=Symbol("INITIAL_VALUE");function kv(){return Zr(e=>jE(e.map(t=>t.pipe(Av(1),function az(...e){const t=_a(e);return Mn((n,r)=>{(t?GE(e,n,t):GE(e,n)).subscribe(r)})}(fw)))).pipe(Nn(t=>{for(const n of t)if(!0!==n){if(n===fw)return fw;if(!1===n||n instanceof Rv)return n}return!0}),Xm(t=>t!==fw),Av(1)))}function EA(e){return function Le(...e){return bt(e)}(Ph(t=>{if(f_(t))throw mA(0,t)}),Nn(t=>!0===t))}class dw{constructor(t){this.segmentGroup=t||null}}class CA{constructor(t){this.urlTree=t}}function Fv(e){return p1(new dw(e))}function SA(e){return p1(new CA(e))}class N4{constructor(t,n){this.urlSerializer=t,this.urlTree=n}noMatchError(t){return new Hn(4002,!1)}lineralizeSegments(t,n){let r=[],o=n.root;for(;;){if(r=r.concat(o.segments),0===o.numberOfChildren)return Qr(r);if(o.numberOfChildren>1||!o.children[so])return p1(new Hn(4e3,!1));o=o.children[so]}}applyRedirectCommands(t,n,r){return this.applyRedirectCreateUrlTree(n,this.urlSerializer.parse(n),t,r)}applyRedirectCreateUrlTree(t,n,r,o){const c=this.createSegmentGroup(t,n.root,r,o);return new Rv(c,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const r={};return Object.entries(t).forEach(([o,c])=>{if("string"==typeof c&&c.startsWith(":")){const _=c.substring(1);r[o]=n[_]}else r[o]=c}),r}createSegmentGroup(t,n,r,o){const c=this.createSegments(t,n.segments,r,o);let d={};return Object.entries(n.children).forEach(([_,E])=>{d[_]=this.createSegmentGroup(t,E,r,o)}),new Sa(c,d)}createSegments(t,n,r,o){return n.map(c=>c.path.startsWith(":")?this.findPosParam(t,c,o):this.findOrReturn(c,r))}findPosParam(t,n,r){const o=r[n.path.substring(1)];if(!o)throw new Hn(4001,!1);return o}findOrReturn(t,n){let r=0;for(const o of n){if(o.path===t.path)return n.splice(r),o;r++}return t}}const uC={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function k4(e,t,n,r,o){const c=lC(e,t,n);return c.matched?(r=function o4(e,t){return e.providers&&!e._injector&&(e._injector=Lb(e.providers,t,`Route: ${e.path}`)),e._injector??t}(t,r),function R4(e,t,n,r){const o=t.canMatch;return o&&0!==o.length?Qr(o.map(d=>{const _=Nv(d,e);return Zm(function w4(e){return e&&D1(e.canMatch)}(_)?_.canMatch(t,n):e.runInContext(()=>_(t,n)))})).pipe(kv(),EA()):Qr(!0)}(r,t,n).pipe(Nn(d=>!0===d?c:{...uC}))):Qr(c)}function lC(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{...uC}:{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const o=(t.matcher||pz)(n,e,t);if(!o)return{...uC};const c={};Object.entries(o.posParams??{}).forEach(([_,E])=>{c[_]=E.path});const d=o.consumed.length>0?{...c,...o.consumed[o.consumed.length-1].parameters}:c;return{matched:!0,consumedSegments:o.consumed,remainingSegments:n.slice(o.consumed.length),parameters:d,positionalParamSegments:o.posParams??{}}}function IA(e,t,n,r){return n.length>0&&function z4(e,t,n){return n.some(r=>pw(e,t,r)&&qd(r)!==so)}(e,n,r)?{segmentGroup:new Sa(t,B4(r,new Sa(n,e.children))),slicedSegments:[]}:0===n.length&&function U4(e,t,n){return n.some(r=>pw(e,t,r))}(e,n,r)?{segmentGroup:new Sa(e.segments,F4(e,0,n,r,e.children)),slicedSegments:n}:{segmentGroup:new Sa(e.segments,e.children),slicedSegments:n}}function F4(e,t,n,r,o){const c={};for(const d of r)if(pw(e,n,d)&&!o[qd(d)]){const _=new Sa([],{});c[qd(d)]=_}return{...o,...c}}function B4(e,t){const n={};n[so]=t;for(const r of e)if(""===r.path&&qd(r)!==so){const o=new Sa([],{});n[qd(r)]=o}return n}function pw(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}class $4{constructor(t,n,r,o,c,d,_){this.injector=t,this.configLoader=n,this.rootComponentType=r,this.config=o,this.urlTree=c,this.paramsInheritanceStrategy=d,this.urlSerializer=_,this.allowRedirects=!0,this.applyRedirects=new N4(this.urlSerializer,this.urlTree)}noMatchError(t){return new Hn(4002,!1)}recognize(){const t=IA(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,so).pipe(c_(n=>{if(n instanceof CA)return this.allowRedirects=!1,this.urlTree=n.urlTree,this.match(n.urlTree);throw n instanceof dw?this.noMatchError(n):n}),Nn(n=>{const r=new lw([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},so,this.rootComponentType,null,{}),o=new Pg(r,n),c=new dA("",o),d=function Oz(e,t,n=null,r=null){return nA(tA(e),t,n,r)}(r,[],this.urlTree.queryParams,this.urlTree.fragment);return d.queryParams=this.urlTree.queryParams,c.url=this.urlSerializer.serialize(d),this.inheritParamsAndData(c._root),{state:c,tree:d}}))}match(t){return this.processSegmentGroup(this.injector,this.config,t.root,so).pipe(c_(r=>{throw r instanceof dw?this.noMatchError(r):r}))}inheritParamsAndData(t){const n=t.value,r=fA(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),t.children.forEach(o=>this.inheritParamsAndData(o))}processSegmentGroup(t,n,r,o){return 0===r.segments.length&&r.hasChildren()?this.processChildren(t,n,r):this.processSegment(t,n,r,r.segments,o,!0)}processChildren(t,n,r){const o=[];for(const c of Object.keys(r.children))"primary"===c?o.unshift(c):o.push(c);return bs(o).pipe(g1(c=>{const d=r.children[c],_=function l4(e,t){const n=e.filter(r=>qd(r)===t);return n.push(...e.filter(r=>qd(r)!==t)),n}(n,c);return this.processSegmentGroup(t,_,d,c)}),function cz(e,t){return Mn(function lz(e,t,n,r,o){return(c,d)=>{let _=n,E=t,S=0;c.subscribe(jn(d,R=>{const L=S++;E=_?e(E,R,L):(_=!0,R),r&&d.next(E)},o&&(()=>{_&&d.next(E),d.complete()})))}}(e,t,arguments.length>=2,!0))}((c,d)=>(c.push(...d),c)),tw(null),function hz(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Xm((o,c)=>e(o,c,r)):Bt,qE(1),n?tw(t):jD(()=>new ew))}(),wo(c=>{if(null===c)return Fv(r);const d=TA(c);return function q4(e){e.sort((t,n)=>t.value.outlet===so?-1:n.value.outlet===so?1:t.value.outlet.localeCompare(n.value.outlet))}(d),Qr(d)}))}processSegment(t,n,r,o,c,d){return bs(n).pipe(g1(_=>this.processSegmentAgainstRoute(_._injector??t,n,_,r,o,c,d).pipe(c_(E=>{if(E instanceof dw)return Qr(null);throw E}))),l_(_=>!!_),c_(_=>{if(bA(_))return function j4(e,t,n){return 0===t.length&&!e.children[n]}(r,o,c)?Qr([]):Fv(r);throw _}))}processSegmentAgainstRoute(t,n,r,o,c,d,_){return function V4(e,t,n,r){return!!(qd(e)===r||r!==so&&pw(t,n,e))&&("**"===e.path||lC(t,e,n).matched)}(r,o,c,d)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,o,r,c,d,_):_&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,o,n,r,c,d):Fv(o):Fv(o)}expandSegmentAgainstRouteUsingRedirect(t,n,r,o,c,d){return"**"===o.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,r,o,d):this.expandRegularSegmentAgainstRouteUsingRedirect(t,n,r,o,c,d)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,r,o){const c=this.applyRedirects.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?SA(c):this.applyRedirects.lineralizeSegments(r,c).pipe(wo(d=>{const _=new Sa(d,{});return this.processSegment(t,n,_,d,o,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,n,r,o,c,d){const{matched:_,consumedSegments:E,remainingSegments:S,positionalParamSegments:R}=lC(n,o,c);if(!_)return Fv(n);const L=this.applyRedirects.applyRedirectCommands(E,o.redirectTo,R);return o.redirectTo.startsWith("/")?SA(L):this.applyRedirects.lineralizeSegments(o,L).pipe(wo(B=>this.processSegment(t,r,n,B.concat(S),d,!1)))}matchSegmentAgainstRoute(t,n,r,o,c,d){let _;if("**"===r.path){const E=o.length>0?$D(o).parameters:{};_=Qr({snapshot:new lw(o,E,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,MA(r),qd(r),r.component??r._loadedComponent??null,r,DA(r)),consumedSegments:[],remainingSegments:[]}),n.children={}}else _=k4(n,r,o,t).pipe(Nn(({matched:E,consumedSegments:S,remainingSegments:R,parameters:L})=>E?{snapshot:new lw(S,L,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,MA(r),qd(r),r.component??r._loadedComponent??null,r,DA(r)),consumedSegments:S,remainingSegments:R}:null));return _.pipe(Zr(E=>null===E?Fv(n):this.getChildConfig(t=r._injector??t,r,o).pipe(Zr(({routes:S})=>{const R=r._loadedInjector??t,{snapshot:L,consumedSegments:B,remainingSegments:V}=E,{segmentGroup:de,slicedSegments:he}=IA(n,B,V,S);if(0===he.length&&de.hasChildren())return this.processChildren(R,S,de).pipe(Nn(Ae=>null===Ae?null:[new Pg(L,Ae)]));if(0===S.length&&0===he.length)return Qr([new Pg(L,[])]);const Ve=qd(r)===c;return this.processSegment(R,S,de,he,Ve?so:c,!0).pipe(Nn(Ae=>[new Pg(L,Ae)]))}))))}getChildConfig(t,n,r){return n.children?Qr({routes:n.children,injector:t}):n.loadChildren?void 0!==n._loadedRoutes?Qr({routes:n._loadedRoutes,injector:n._loadedInjector}):function P4(e,t,n,r){const o=t.canLoad;return void 0===o||0===o.length?Qr(!0):Qr(o.map(d=>{const _=Nv(d,e);return Zm(function y4(e){return e&&D1(e.canLoad)}(_)?_.canLoad(t,n):e.runInContext(()=>_(t,n)))})).pipe(kv(),EA())}(t,n,r).pipe(wo(o=>o?this.configLoader.loadChildren(t,n).pipe(Ph(c=>{n._loadedRoutes=c.routes,n._loadedInjector=c.injector})):function O4(e){return p1(yA(!1,3))}())):Qr({routes:[],injector:t})}}function H4(e){const t=e.value.routeConfig;return t&&""===t.path}function TA(e){const t=[],n=new Set;for(const r of e){if(!H4(r)){t.push(r);continue}const o=t.find(c=>r.value.routeConfig===c.value.routeConfig);void 0!==o?(o.children.push(...r.children),n.add(o)):t.push(r)}for(const r of n){const o=TA(r.children);t.push(new Pg(r.value,o))}return t.filter(r=>!n.has(r))}function MA(e){return e.data||{}}function DA(e){return e.resolve||{}}function AA(e){return"string"==typeof e.title||null===e.title}function cC(e){return Zr(t=>{const n=e(t);return n?bs(n).pipe(Nn(()=>t)):Qr(t)})}const Bv=new Kr("ROUTES");let hC=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=qn(pM)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Qr(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const r=Zm(n.loadComponent()).pipe(Nn(PA),Ph(c=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=c}),HE(()=>{this.componentLoaders.delete(n)})),o=new VD(r,()=>new Jt).pipe($E());return this.componentLoaders.set(n,o),o}loadChildren(n,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Qr({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const c=this.loadModuleFactoryOrRoutes(r.loadChildren).pipe(Nn(_=>{this.onLoadEndListener&&this.onLoadEndListener(r);let E,S;return Array.isArray(_)?S=_:(E=_.create(n).injector,S=E.get(Bv,[],Rr.Self|Rr.Optional).flat()),{routes:S.map(aC),injector:E}}),HE(()=>{this.childrenLoaders.delete(r)})),d=new VD(c,()=>new Jt).pipe($E());return this.childrenLoaders.set(r,d),d}loadModuleFactoryOrRoutes(n){return Zm(n()).pipe(Nn(PA),wo(r=>r instanceof xT||Array.isArray(r)?Qr(r):bs(this.compiler.compileModuleAsync(r))))}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function PA(e){return function Q4(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let gw=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new Jt,this.configLoader=qn(hC),this.environmentInjector=qn(nf),this.urlSerializer=qn(_1),this.rootContexts=qn(C1),this.inputBindingEnabled=null!==qn(cw,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Qr(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=o=>this.events.next(new Wz(o)),this.configLoader.onLoadStartListener=o=>this.events.next(new Hz(o))}complete(){this.transitions?.complete()}handleNavigationRequest(n){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...n,id:r})}setupNavigations(n){return this.transitions=new zt({id:0,currentUrlTree:n.currentUrlTree,currentRawUrl:n.currentUrlTree,extractedUrl:n.urlHandlingStrategy.extract(n.currentUrlTree),urlAfterRedirects:n.urlHandlingStrategy.extract(n.currentUrlTree),rawUrl:n.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:b1,restoredState:null,currentSnapshot:n.routerState.snapshot,targetSnapshot:null,currentRouterState:n.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Xm(r=>0!==r.id),Nn(r=>({...r,extractedUrl:n.urlHandlingStrategy.extract(r.rawUrl)})),Zr(r=>{let o=!1,c=!1;return Qr(r).pipe(Ph(d=>{this.currentNavigation={id:d.id,initialUrl:d.rawUrl,extractedUrl:d.extractedUrl,trigger:d.source,extras:d.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Zr(d=>{const _=n.browserUrlTree.toString(),E=!n.navigated||d.extractedUrl.toString()!==_||_!==n.currentUrlTree.toString();if(!E&&"reload"!==(d.extras.onSameUrlNavigation??n.onSameUrlNavigation)){const R="";return this.events.next(new E1(d.id,n.serializeUrl(r.rawUrl),R,0)),n.rawUrlTree=d.rawUrl,d.resolve(null),Br}if(n.urlHandlingStrategy.shouldProcessUrl(d.rawUrl))return RA(d.source)&&(n.browserUrlTree=d.extractedUrl),Qr(d).pipe(Zr(R=>{const L=this.transitions?.getValue();return this.events.next(new JE(R.id,this.urlSerializer.serialize(R.extractedUrl),R.source,R.restoredState)),L!==this.transitions?.getValue()?Br:Promise.resolve(R)}),function W4(e,t,n,r,o,c){return wo(d=>function G4(e,t,n,r,o,c,d="emptyOnly"){return new $4(e,t,n,r,o,d,c).recognize()}(e,t,n,r,d.extractedUrl,o,c).pipe(Nn(({state:_,tree:E})=>({...d,targetSnapshot:_,urlAfterRedirects:E}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,n.paramsInheritanceStrategy),Ph(R=>{if(r.targetSnapshot=R.targetSnapshot,r.urlAfterRedirects=R.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:R.urlAfterRedirects},"eager"===n.urlUpdateStrategy){if(!R.extras.skipLocationChange){const B=n.urlHandlingStrategy.merge(R.urlAfterRedirects,R.rawUrl);n.setBrowserUrl(B,R)}n.browserUrlTree=R.urlAfterRedirects}const L=new Vz(R.id,this.urlSerializer.serialize(R.extractedUrl),this.urlSerializer.serialize(R.urlAfterRedirects),R.targetSnapshot);this.events.next(L)}));if(E&&n.urlHandlingStrategy.shouldProcessUrl(n.rawUrlTree)){const{id:R,extractedUrl:L,source:B,restoredState:V,extras:de}=d,he=new JE(R,this.urlSerializer.serialize(L),B,V);this.events.next(he);const Ve=hA(0,this.rootComponentType).snapshot;return Qr(r={...d,targetSnapshot:Ve,urlAfterRedirects:L,extras:{...de,skipLocationChange:!1,replaceUrl:!1}})}{const R="";return this.events.next(new E1(d.id,n.serializeUrl(r.extractedUrl),R,1)),n.rawUrlTree=d.rawUrl,d.resolve(null),Br}}),Ph(d=>{const _=new jz(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(_)}),Nn(d=>r={...d,guards:f4(d.targetSnapshot,d.currentSnapshot,this.rootContexts)}),function E4(e,t){return wo(n=>{const{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:c,canDeactivateChecks:d}}=n;return 0===d.length&&0===c.length?Qr({...n,guardsResult:!0}):function C4(e,t,n,r){return bs(e).pipe(wo(o=>function A4(e,t,n,r,o){const c=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return c&&0!==c.length?Qr(c.map(_=>{const E=I1(t)??o,S=Nv(_,E);return Zm(function x4(e){return e&&D1(e.canDeactivate)}(S)?S.canDeactivate(e,t,n,r):E.runInContext(()=>S(e,t,n,r))).pipe(l_())})).pipe(kv()):Qr(!0)}(o.component,o.route,n,t,r)),l_(o=>!0!==o,!0))}(d,r,o,e).pipe(wo(_=>_&&function m4(e){return"boolean"==typeof e}(_)?function S4(e,t,n,r){return bs(t).pipe(g1(o=>GE(function T4(e,t){return null!==e&&t&&t(new Xz(e)),Qr(!0)}(o.route.parent,r),function I4(e,t){return null!==e&&t&&t(new Yz(e)),Qr(!0)}(o.route,r),function D4(e,t,n){const r=t[t.length-1],c=t.slice(0,t.length-1).reverse().map(d=>function d4(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(d)).filter(d=>null!==d).map(d=>UD(()=>Qr(d.guards.map(E=>{const S=I1(d.node)??n,R=Nv(E,S);return Zm(function v4(e){return e&&D1(e.canActivateChild)}(R)?R.canActivateChild(r,e):S.runInContext(()=>R(r,e))).pipe(l_())})).pipe(kv())));return Qr(c).pipe(kv())}(e,o.path,n),function M4(e,t,n){const r=t.routeConfig?t.routeConfig.canActivate:null;if(!r||0===r.length)return Qr(!0);const o=r.map(c=>UD(()=>{const d=I1(t)??n,_=Nv(c,d);return Zm(function _4(e){return e&&D1(e.canActivate)}(_)?_.canActivate(t,e):d.runInContext(()=>_(t,e))).pipe(l_())}));return Qr(o).pipe(kv())}(e,o.route,n))),l_(o=>!0!==o,!0))}(r,c,e,t):Qr(_)),Nn(_=>({...n,guardsResult:_})))})}(this.environmentInjector,d=>this.events.next(d)),Ph(d=>{if(r.guardsResult=d.guardsResult,f_(d.guardsResult))throw mA(0,d.guardsResult);const _=new Gz(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot,!!d.guardsResult);this.events.next(_)}),Xm(d=>!!d.guardsResult||(n.restoreHistory(d),this.cancelNavigationTransition(d,"",3),!1)),cC(d=>{if(d.guards.canActivateChecks.length)return Qr(d).pipe(Ph(_=>{const E=new $z(_.id,this.urlSerializer.serialize(_.extractedUrl),this.urlSerializer.serialize(_.urlAfterRedirects),_.targetSnapshot);this.events.next(E)}),Zr(_=>{let E=!1;return Qr(_).pipe(function X4(e,t){return wo(n=>{const{targetSnapshot:r,guards:{canActivateChecks:o}}=n;if(!o.length)return Qr(n);let c=0;return bs(o).pipe(g1(d=>function Z4(e,t,n,r){const o=e.routeConfig,c=e._resolve;return void 0!==o?.title&&!AA(o)&&(c[m1]=o.title),function Y4(e,t,n,r){const o=function K4(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===o.length)return Qr({});const c={};return bs(o).pipe(wo(d=>function J4(e,t,n,r){const o=I1(t)??r,c=Nv(e,o);return Zm(c.resolve?c.resolve(t,n):o.runInContext(()=>c(t,n)))}(e[d],t,n,r).pipe(l_(),Ph(_=>{c[d]=_}))),qE(1),function fz(e){return Nn(()=>e)}(c),c_(d=>bA(d)?Br:p1(d)))}(c,e,t,r).pipe(Nn(d=>(e._resolvedData=d,e.data=fA(e,n).resolve,o&&AA(o)&&(e.data[m1]=o.title),null)))}(d.route,r,e,t)),Ph(()=>c++),qE(1),wo(d=>c===o.length?Qr(n):Br))})}(n.paramsInheritanceStrategy,this.environmentInjector),Ph({next:()=>E=!0,complete:()=>{E||(n.restoreHistory(_),this.cancelNavigationTransition(_,"",2))}}))}),Ph(_=>{const E=new qz(_.id,this.urlSerializer.serialize(_.extractedUrl),this.urlSerializer.serialize(_.urlAfterRedirects),_.targetSnapshot);this.events.next(E)}))}),cC(d=>{const _=E=>{const S=[];E.routeConfig?.loadComponent&&!E.routeConfig._loadedComponent&&S.push(this.configLoader.loadComponent(E.routeConfig).pipe(Ph(R=>{E.component=R}),Nn(()=>{})));for(const R of E.children)S.push(..._(R));return S};return jE(_(d.targetSnapshot.root)).pipe(tw(),Av(1))}),cC(()=>this.afterPreactivation()),Nn(d=>{const _=function n4(e,t,n){const r=S1(e,t._root,n?n._root:void 0);return new cA(r,t)}(n.routeReuseStrategy,d.targetSnapshot,d.currentRouterState);return r={...d,targetRouterState:_}}),Ph(d=>{n.currentUrlTree=d.urlAfterRedirects,n.rawUrlTree=n.urlHandlingStrategy.merge(d.urlAfterRedirects,d.rawUrl),n.routerState=d.targetRouterState,"deferred"===n.urlUpdateStrategy&&(d.extras.skipLocationChange||n.setBrowserUrl(n.rawUrlTree,d),n.browserUrlTree=d.urlAfterRedirects)}),((e,t,n,r)=>Nn(o=>(new h4(t,o.targetRouterState,o.currentRouterState,n,r).activate(e),o)))(this.rootContexts,n.routeReuseStrategy,d=>this.events.next(d),this.inputBindingEnabled),Av(1),Ph({next:d=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,n.navigated=!0,this.events.next(new d_(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(n.currentUrlTree))),n.titleStrategy?.updateTitle(d.targetRouterState.snapshot),d.resolve(!0)},complete:()=>{o=!0}}),HE(()=>{o||c||this.cancelNavigationTransition(r,"",1),this.currentNavigation?.id===r.id&&(this.currentNavigation=null)}),c_(d=>{if(c=!0,vA(d)){_A(d)||(n.navigated=!0,n.restoreHistory(r,!0));const _=new uw(r.id,this.urlSerializer.serialize(r.extractedUrl),d.message,d.cancellationCode);if(this.events.next(_),_A(d)){const E=n.urlHandlingStrategy.merge(d.url,n.rawUrlTree),S={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===n.urlUpdateStrategy||RA(r.source)};n.scheduleNavigation(E,b1,null,S,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{n.restoreHistory(r,!0);const _=new QE(r.id,this.urlSerializer.serialize(r.extractedUrl),d,r.targetSnapshot??void 0);this.events.next(_);try{r.resolve(n.errorHandler(d))}catch(E){r.reject(E)}}return Br}))}))}cancelNavigationTransition(n,r,o){const c=new uw(n.id,this.urlSerializer.serialize(n.extractedUrl),r,o);this.events.next(c),n.resolve(!1)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function RA(e){return e!==b1}let LA=(()=>{class e{buildTitle(n){let r,o=n.root;for(;void 0!==o;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(c=>c.outlet===so);return r}getResolvedTitleForRoute(n){return n.data[m1]}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:function(){return qn(e5)},providedIn:"root"}),e})(),e5=(()=>{class e extends LA{constructor(n){super(),this.title=n}updateTitle(n){const r=this.buildTitle(n);void 0!==r&&this.title.setTitle(r)}}return e.\u0275fac=function(n){return new(n||e)(fr(ND))},e.\u0275prov=sr({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),t5=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:function(){return qn(r5)},providedIn:"root"}),e})();class n5{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}let r5=(()=>{class e extends n5{}return e.\u0275fac=function(){let t;return function(r){return(t||(t=function Xh(e){return ss(()=>{const t=e.prototype.constructor,n=t[bu]||Zp(t),r=Object.prototype;let o=Object.getPrototypeOf(e.prototype).constructor;for(;o&&o!==r;){const c=o[bu]||Zp(o);if(c&&c!==n)return c;o=Object.getPrototypeOf(o)}return c=>new c})}(e)))(r||e)}}(),e.\u0275prov=sr({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const mw=new Kr("",{providedIn:"root",factory:()=>({})});let i5=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:function(){return qn(o5)},providedIn:"root"}),e})(),o5=(()=>{class e{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,r){return n}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var Mf=(()=>((Mf=Mf||{})[Mf.COMPLETE=0]="COMPLETE",Mf[Mf.FAILED=1]="FAILED",Mf[Mf.REDIRECTING=2]="REDIRECTING",Mf))();function OA(e,t){e.events.pipe(Xm(n=>n instanceof d_||n instanceof uw||n instanceof QE||n instanceof E1),Nn(n=>n instanceof d_||n instanceof E1?Mf.COMPLETE:n instanceof uw&&(0===n.code||1===n.code)?Mf.REDIRECTING:Mf.FAILED),Xm(n=>n!==Mf.REDIRECTING),Av(1)).subscribe(()=>{t()})}function s5(e){throw e}function a5(e,t,n){return t.parse("/")}const u5={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},l5={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Df=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=qn(fM),this.isNgZoneEnabled=!1,this.options=qn(mw,{optional:!0})||{},this.pendingTasks=qn(dM),this.errorHandler=this.options.errorHandler||s5,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||a5,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=qn(i5),this.routeReuseStrategy=qn(t5),this.titleStrategy=qn(LA),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=qn(Bv,{optional:!0})?.flat()??[],this.navigationTransitions=qn(gw),this.urlSerializer=qn(_1),this.location=qn(yE),this.componentInputBindingEnabled=!!qn(cw,{optional:!0}),this.isNgZoneEnabled=qn(Gu)instanceof Gu&&Gu.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Rv,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=hA(0,null),this.navigationTransitions.setupNavigations(this).subscribe(n=>{this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId??0},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const n=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),b1,n)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const r="popstate"===n.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{this.navigateToSyncWithBrowser(n.url,r,n.state)},0)}))}navigateToSyncWithBrowser(n,r,o){const c={replaceUrl:!0},d=o?.navigationId?o:null;if(o){const E={...o};delete E.navigationId,delete E.\u0275routerPageId,0!==Object.keys(E).length&&(c.state=E)}const _=this.parseUrl(n);this.scheduleNavigation(_,r,d,c)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(aC),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,r={}){const{relativeTo:o,queryParams:c,fragment:d,queryParamsHandling:_,preserveFragment:E}=r,S=E?this.currentUrlTree.fragment:d;let L,R=null;switch(_){case"merge":R={...this.currentUrlTree.queryParams,...c};break;case"preserve":R=this.currentUrlTree.queryParams;break;default:R=c||null}null!==R&&(R=this.removeEmptyProps(R));try{L=tA(o?o.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof n[0]||!n[0].startsWith("/"))&&(n=[]),L=this.currentUrlTree.root}return nA(L,n,R,S??null)}navigateByUrl(n,r={skipLocationChange:!1}){const o=f_(n)?n:this.parseUrl(n),c=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(c,b1,null,r)}navigate(n,r={skipLocationChange:!1}){return function c5(e){for(let t=0;t<e.length;t++)if(null==e[t])throw new Hn(4008,!1)}(n),this.navigateByUrl(this.createUrlTree(n,r),r)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let r;try{r=this.urlSerializer.parse(n)}catch(o){r=this.malformedUriErrorHandler(o,this.urlSerializer,n)}return r}isActive(n,r){let o;if(o=!0===r?{...u5}:!1===r?{...l5}:r,f_(n))return HD(this.currentUrlTree,n,o);const c=this.parseUrl(n);return HD(this.currentUrlTree,c,o)}removeEmptyProps(n){return Object.keys(n).reduce((r,o)=>{const c=n[o];return null!=c&&(r[o]=c),r},{})}scheduleNavigation(n,r,o,c,d){if(this.disposed)return Promise.resolve(!1);let _,E,S;d?(_=d.resolve,E=d.reject,S=d.promise):S=new Promise((L,B)=>{_=L,E=B});const R=this.pendingTasks.add();return OA(this,()=>{Promise.resolve().then(()=>this.pendingTasks.remove(R))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:c,resolve:_,reject:E,promise:S,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),S.catch(L=>Promise.reject(L))}setBrowserUrl(n,r){const o=this.urlSerializer.serialize(n);if(this.location.isCurrentPathEqualTo(o)||r.extras.replaceUrl){const d={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId)};this.location.replaceState(o,"",d)}else{const c={...r.extras.state,...this.generateNgRouterState(r.id,(this.browserPageId??0)+1)};this.location.go(o,"",c)}}restoreHistory(n,r=!1){if("computed"===this.canceledNavigationResolution){const c=this.currentPageId-(this.browserPageId??this.currentPageId);0!==c?this.location.historyGo(c):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===c&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,r){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:r}:{navigationId:n}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=sr({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class NA{}let d5=(()=>{class e{constructor(n,r,o,c,d){this.router=n,this.injector=o,this.preloadingStrategy=c,this.loader=d}setUpPreloading(){this.subscription=this.router.events.pipe(Xm(n=>n instanceof d_),g1(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,r){const o=[];for(const c of r){c.providers&&!c._injector&&(c._injector=Lb(c.providers,n,`Route: ${c.path}`));const d=c._injector??n,_=c._loadedInjector??d;(c.loadChildren&&!c._loadedRoutes&&void 0===c.canLoad||c.loadComponent&&!c._loadedComponent)&&o.push(this.preloadConfig(d,c)),(c.children||c._loadedRoutes)&&o.push(this.processRoutes(_,c.children??c._loadedRoutes))}return bs(o).pipe(uc())}preloadConfig(n,r){return this.preloadingStrategy.preload(r,()=>{let o;o=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(n,r):Qr(null);const c=o.pipe(wo(d=>null===d?Qr(void 0):(r._loadedRoutes=d.routes,r._loadedInjector=d.injector,this.processRoutes(d.injector??n,d.routes))));return r.loadComponent&&!r._loadedComponent?bs([c,this.loader.loadComponent(r)]).pipe(uc()):c})}}return e.\u0275fac=function(n){return new(n||e)(fr(Df),fr(pM),fr(nf),fr(NA),fr(hC))},e.\u0275prov=sr({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const dC=new Kr("");let kA=(()=>{class e{constructor(n,r,o,c,d={}){this.urlSerializer=n,this.transitions=r,this.viewportScroller=o,this.zone=c,this.options=d,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},d.scrollPositionRestoration=d.scrollPositionRestoration||"disabled",d.anchorScrolling=d.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof JE?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof d_?(this.lastId=n.id,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.urlAfterRedirects).fragment)):n instanceof E1&&0===n.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof uA&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new uA(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return e.\u0275fac=function(n){!function j0(){throw new Error("invalid")}()},e.\u0275prov=sr({token:e,factory:e.\u0275fac}),e})();function Rg(e,t){return{\u0275kind:e,\u0275providers:t}}function BA(){const e=qn(If);return t=>{const n=e.get(Mv);if(t!==n.components[0])return;const r=e.get(Df),o=e.get(zA);1===e.get(pC)&&r.initialNavigation(),e.get(UA,null,Rr.Optional)?.setUpPreloading(),e.get(dC,null,Rr.Optional)?.init(),r.resetRootComponentType(n.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}const zA=new Kr("",{factory:()=>new Jt}),pC=new Kr("",{providedIn:"root",factory:()=>1}),UA=new Kr("");function y5(e){return Rg(0,[{provide:UA,useExisting:d5},{provide:NA,useExisting:e}])}const VA=new Kr("ROUTER_FORROOT_GUARD"),v5=[yE,{provide:_1,useClass:WE},Df,C1,{provide:Ov,useFactory:function FA(e){return e.routerState.root},deps:[Df]},hC,[]];function x5(){return new SM("Router",Df)}let jA=(()=>{class e{constructor(n){}static forRoot(n,r){return{ngModule:e,providers:[v5,[],{provide:Bv,multi:!0,useValue:n},{provide:VA,useFactory:C5,deps:[[Df,new gu,new mf]]},{provide:mw,useValue:r||{}},r?.useHash?{provide:u_,useClass:bF}:{provide:u_,useClass:QM},{provide:dC,useFactory:()=>{const e=qn(G3),t=qn(Gu),n=qn(mw),r=qn(gw),o=qn(_1);return n.scrollOffset&&e.setOffset(n.scrollOffset),new kA(o,r,e,t,n)}},r?.preloadingStrategy?y5(r.preloadingStrategy).\u0275providers:[],{provide:SM,multi:!0,useFactory:x5},r?.initialNavigation?S5(r):[],r?.bindToComponentInputs?Rg(8,[gA,{provide:cw,useExisting:gA}]).\u0275providers:[],[{provide:GA,useFactory:BA},{provide:iE,multi:!0,useExisting:GA}]]}}static forChild(n){return{ngModule:e,providers:[{provide:Bv,multi:!0,useValue:n}]}}}return e.\u0275fac=function(n){return new(n||e)(fr(VA,8))},e.\u0275mod=qi({type:e}),e.\u0275inj=Ku({}),e})();function C5(e){return"guarded"}function S5(e){return["disabled"===e.initialNavigation?Rg(3,[{provide:Zb,multi:!0,useFactory:()=>{const t=qn(Df);return()=>{t.setUpLocationChangeListener()}}},{provide:pC,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?Rg(2,[{provide:pC,useValue:0},{provide:Zb,multi:!0,deps:[If],useFactory:t=>{const n=t.get(xF,Promise.resolve());return()=>n.then(()=>new Promise(r=>{const o=t.get(Df),c=t.get(zA);OA(o,()=>{r(!0)}),t.get(gw).afterPreactivation=()=>(r(!0),c.closed?Qr(void 0):c),o.initialNavigation()}))}}]).\u0275providers:[]]}const GA=new Kr("");function $A(e,t,n,r,o,c,d){try{var _=e[c](d),E=_.value}catch(S){return void n(S)}_.done?t(E):Promise.resolve(E).then(r,o)}var Lg=ve(9898),qA=ve(8545);const M5_mapbox_accessToken="pk.eyJ1IjoiYWhtZWRtb2hzZW4wOCIsImEiOiJjbGl1MzE5cDEwZW04M2ptOHlvd250cjdoIn0.DxhNH0Z2Qg1ARqOgx9rQqw";var Rh=6371008.8,HA={centimeters:100*Rh,centimetres:100*Rh,degrees:Rh/111325,feet:3.28084*Rh,inches:39.37*Rh,kilometers:Rh/1e3,kilometres:Rh/1e3,meters:Rh,metres:Rh,miles:Rh/1609.344,millimeters:1e3*Rh,millimetres:1e3*Rh,nauticalmiles:Rh/1852,radians:1,yards:1.0936*Rh};function Og(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function yw(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!yC(e[0])||!yC(e[1]))throw new Error("coordinates must contain numbers");return Og({type:"Point",coordinates:e},t,n)}function _w(e,t,n){void 0===n&&(n={});for(var r=0,o=e;r<o.length;r++){var c=o[r];if(c.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var d=0;d<c[c.length-1].length;d++)if(c[c.length-1][d]!==c[0][d])throw new Error("First and last Position are not equivalent.")}return Og({type:"Polygon",coordinates:e},t,n)}function vw(e){return e%360*Math.PI/180}function yC(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function A1(e,t,n){if(null!==e)for(var r,o,c,d,_,E,S,B,R=0,L=0,V=e.type,de="FeatureCollection"===V,he="Feature"===V,Ve=de?e.features.length:1,Ae=0;Ae<Ve;Ae++){_=(B=!!(S=de?e.features[Ae].geometry:he?e.geometry:e)&&"GeometryCollection"===S.type)?S.geometries.length:1;for(var fe=0;fe<_;fe++){var Oe=0,pt=0;if(null!==(d=B?S.geometries[fe]:S)){E=d.coordinates;var vt=d.type;switch(R=!n||"Polygon"!==vt&&"MultiPolygon"!==vt?0:1,vt){case null:break;case"Point":if(!1===t(E,L,Ae,Oe,pt))return!1;L++,Oe++;break;case"LineString":case"MultiPoint":for(r=0;r<E.length;r++){if(!1===t(E[r],L,Ae,Oe,pt))return!1;L++,"MultiPoint"===vt&&Oe++}"LineString"===vt&&Oe++;break;case"Polygon":case"MultiLineString":for(r=0;r<E.length;r++){for(o=0;o<E[r].length-R;o++){if(!1===t(E[r][o],L,Ae,Oe,pt))return!1;L++}"MultiLineString"===vt&&Oe++,"Polygon"===vt&&pt++}"Polygon"===vt&&Oe++;break;case"MultiPolygon":for(r=0;r<E.length;r++){for(pt=0,o=0;o<E[r].length;o++){for(c=0;c<E[r][o].length-R;c++){if(!1===t(E[r][o][c],L,Ae,Oe,pt))return!1;L++}pt++}Oe++}break;case"GeometryCollection":for(r=0;r<d.geometries.length;r++)if(!1===A1(d.geometries[r],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function xw(e,t){!function KA(e,t){var n,r,o,c,d,_,E,S,R,L,B=0,V="FeatureCollection"===e.type,de="Feature"===e.type,he=V?e.features.length:1;for(n=0;n<he;n++){for(S=V?e.features[n].properties:de?e.properties:{},R=V?e.features[n].bbox:de?e.bbox:void 0,L=V?e.features[n].id:de?e.id:void 0,d=(E=!!(_=V?e.features[n].geometry:de?e.geometry:e)&&"GeometryCollection"===_.type)?_.geometries.length:1,o=0;o<d;o++)if(null!==(c=E?_.geometries[o]:_))switch(c.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(c,B,S,R,L))return!1;break;case"GeometryCollection":for(r=0;r<c.geometries.length;r++)if(!1===t(c.geometries[r],B,S,R,L))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,B,S,R,L))return!1;B++}}(e,function(n,r,o,c,d){var E,_=null===n?null:n.type;switch(_){case null:case"Point":case"LineString":case"Polygon":return!1!==t(Og(n,o,{bbox:c,id:d}),r,0)&&void 0}switch(_){case"MultiPoint":E="Point";break;case"MultiLineString":E="LineString";break;case"MultiPolygon":E="Polygon"}for(var S=0;S<n.coordinates.length;S++)if(!1===t(Og({type:E,coordinates:n.coordinates[S]},o),r,S))return!1})}function _C(e){var t=[1/0,1/0,-1/0,-1/0];return A1(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}_C.default=_C;const F5=_C;function vC(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function t2(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var r=vC(e),o=function U5(e){return"Feature"===e.type?e.geometry:e}(t),c=o.type,d=t.bbox,_=o.coordinates;if(d&&!1===function Y5(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(r,d))return!1;"Polygon"===c&&(_=[_]);for(var E=!1,S=0;S<_.length&&!E;S++)if(n2(r,_[S][0],n.ignoreBoundary)){for(var R=!1,L=1;L<_[S].length&&!R;)n2(r,_[S][L],!n.ignoreBoundary)&&(R=!0),L++;R||(E=!0)}return E}function n2(e,t,n){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var o=0,c=t.length-1;o<t.length;c=o++){var d=t[o][0],_=t[o][1],E=t[c][0],S=t[c][1];if(e[1]*(d-E)+_*(E-e[0])+S*(e[0]-d)==0&&(d-e[0])*(E-e[0])<=0&&(_-e[1])*(S-e[1])<=0)return!n;_>e[1]!=S>e[1]&&e[0]<(E-d)*(e[1]-_)/(S-_)+d&&(r=!r)}return r}ve(5943),ve(1335);const J5=function K5(e,t,n){void 0===n&&(n={});var r=vC(e),o=vC(t),c=vw(o[1]-r[1]),d=vw(o[0]-r[0]),_=vw(r[1]),E=vw(o[1]),S=Math.pow(Math.sin(c/2),2)+Math.pow(Math.sin(d/2),2)*Math.cos(_)*Math.cos(E);return function ZA(e,t){void 0===t&&(t="kilometers");var n=HA[t];if(!n)throw new Error(t+" units is invalid");return e*n}(2*Math.atan2(Math.sqrt(S),Math.sqrt(1-S)),n.units)};var i2=new ArrayBuffer(16);new Float64Array(i2),new Uint32Array(i2),ve(3544),function(){function e(t){this.points=t.points||[],this.duration=t.duration||1e4,this.sharpness=t.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=t.stepLength||60,this.length=this.points.length,this.delay=0;for(var n=0;n<this.length;n++)this.points[n].z=this.points[n].z||0;for(n=0;n<this.length-1;n++){var r=this.points[n],o=this.points[n+1];this.centers.push({x:(r.x+o.x)/2,y:(r.y+o.y)/2,z:(r.z+o.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),n=0;n<this.centers.length-1;n++){var c=this.points[n+1].x-(this.centers[n].x+this.centers[n+1].x)/2,d=this.points[n+1].y-(this.centers[n].y+this.centers[n+1].y)/2,_=this.points[n+1].z-(this.centers[n].y+this.centers[n+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[n+1].x+this.sharpness*(this.centers[n].x+c),y:(1-this.sharpness)*this.points[n+1].y+this.sharpness*(this.centers[n].y+d),z:(1-this.sharpness)*this.points[n+1].z+this.sharpness*(this.centers[n].z+_)},{x:(1-this.sharpness)*this.points[n+1].x+this.sharpness*(this.centers[n+1].x+c),y:(1-this.sharpness)*this.points[n+1].y+this.sharpness*(this.centers[n+1].y+d),z:(1-this.sharpness)*this.points[n+1].z+this.sharpness*(this.centers[n+1].z+_)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}e.prototype.cacheSteps=function(t){var n=[],r=this.pos(0);n.push(0);for(var o=0;o<this.duration;o+=10){var c=this.pos(o);Math.sqrt((c.x-r.x)*(c.x-r.x)+(c.y-r.y)*(c.y-r.y)+(c.z-r.z)*(c.z-r.z))>t&&(n.push(o),r=c)}return n},e.prototype.vector=function(t){var n=this.pos(t+10),r=this.pos(t-10);return{angle:180*Math.atan2(n.y-r.y,n.x-r.x)/3.14,speed:Math.sqrt((r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y)+(r.z-n.z)*(r.z-n.z))}},e.prototype.pos=function(t){var n=t-this.delay;n<0&&(n=0),n>this.duration&&(n=this.duration-1);var r=n/this.duration;if(r>=1)return this.points[this.length-1];var o=Math.floor((this.points.length-1)*r);return function pU(e,t,n,r,o){var c=function gU(e){var t=e*e;return[t*e,3*t*(1-e),3*e*(1-e)*(1-e),(1-e)*(1-e)*(1-e)]}(e);return{x:o.x*c[0]+r.x*c[1]+n.x*c[2]+t.x*c[3],y:o.y*c[0]+r.y*c[1]+n.y*c[2]+t.y*c[3],z:o.z*c[0]+r.z*c[1]+n.z*c[2]+t.z*c[3]}}((this.length-1)*r-o,this.points[o],this.controls[o][1],this.controls[o+1][0],this.points[o+1])}}();ve(5469),ve(5406);var w2=Math.PI/180,b2=180/Math.PI,L1=function(e,t){this.lon=e,this.lat=t,this.x=w2*e,this.y=w2*t};L1.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},L1.prototype.antipode=function(){return new L1(this.lon<0?180+this.lon:-1*(180-this.lon),-1*this.lat)};var E2=function(){this.coords=[],this.length=0};E2.prototype.move_to=function(e){this.length++,this.coords.push(e)};var TC=function(e){this.properties=e||{},this.geometries=[]};TC.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var e=[],t=0;t<this.geometries.length;t++)e.push(this.geometries[t].coords);return{geometry:{type:"MultiLineString",coordinates:e},type:"Feature",properties:this.properties}},TC.prototype.wkt=function(){for(var e="",t="LINESTRING(",n=function(c){t+=c[0]+" "+c[1]+","},r=0;r<this.geometries.length;r++){if(0===this.geometries[r].coords.length)return"LINESTRING(empty)";this.geometries[r].coords.forEach(n),e+=t.substring(0,t.length-1)+")"}return e};var MC=function(e,t,n){if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new L1(e.x,e.y),this.end=new L1(t.x,t.y),this.properties=n||{};var r=this.start.x-this.end.x,c=Math.pow(Math.sin((this.start.y-this.end.y)/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(r/2),2);if(this.g=2*Math.asin(Math.sqrt(c)),this.g===Math.PI)throw new Error("it appears "+e.view()+" and "+t.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+e+" and "+t)};MC.prototype.interpolate=function(e){var t=Math.sin((1-e)*this.g)/Math.sin(this.g),n=Math.sin(e*this.g)/Math.sin(this.g),r=t*Math.cos(this.start.y)*Math.cos(this.start.x)+n*Math.cos(this.end.y)*Math.cos(this.end.x),o=t*Math.cos(this.start.y)*Math.sin(this.start.x)+n*Math.cos(this.end.y)*Math.sin(this.end.x),c=t*Math.sin(this.start.y)+n*Math.sin(this.end.y),d=b2*Math.atan2(c,Math.sqrt(Math.pow(r,2)+Math.pow(o,2)));return[b2*Math.atan2(o,r),d]},MC.prototype.Arc=function(e,t){var n=[];if(!e||e<=2)n.push([this.start.lon,this.start.lat]),n.push([this.end.lon,this.end.lat]);else for(var r=1/(e-1),o=0;o<e;++o){var d=this.interpolate(r*o);n.push(d)}for(var _=!1,E=0,S=t&&t.offset?t.offset:10,R=180-S,L=-180+S,B=360-S,V=1;V<n.length;++V){var de=n[V-1][0],he=n[V][0],Ve=Math.abs(he-de);Ve>B&&(he>R&&de<L||de>R&&he<L)?_=!0:Ve>E&&(E=Ve)}var Ae=[];if(_&&E<S){var fe=[];Ae.push(fe);for(var Oe=0;Oe<n.length;++Oe){var pt=parseFloat(n[Oe][0]);if(Oe>0&&Math.abs(pt-n[Oe-1][0])>B){var vt=parseFloat(n[Oe-1][0]),Vt=parseFloat(n[Oe-1][1]),$t=parseFloat(n[Oe][0]),rn=parseFloat(n[Oe][1]);if(vt>-180&&vt<L&&180===$t&&Oe+1<n.length&&n[Oe-1][0]>-180&&n[Oe-1][0]<L){fe.push([-180,n[Oe][1]]),Oe++,fe.push([n[Oe][0],n[Oe][1]]);continue}if(vt>R&&vt<180&&-180===$t&&Oe+1<n.length&&n[Oe-1][0]>R&&n[Oe-1][0]<180){fe.push([180,n[Oe][1]]),Oe++,fe.push([n[Oe][0],n[Oe][1]]);continue}if(vt<L&&$t>R){var dt=vt;vt=$t,$t=dt;var ai=Vt;Vt=rn,rn=ai}if(vt>R&&$t<L&&($t+=360),vt<=180&&$t>=180&&vt<$t){var gr=(180-vt)/($t-vt),Li=gr*rn+(1-gr)*Vt;fe.push([n[Oe-1][0]>R?180:-180,Li]),(fe=[]).push([n[Oe-1][0]>R?-180:180,Li]),Ae.push(fe)}else Ae.push(fe=[]);fe.push([pt,n[Oe][1]])}else fe.push([n[Oe][0],n[Oe][1]])}}else{var Hi=[];Ae.push(Hi);for(var Qn=0;Qn<n.length;++Qn)Hi.push([n[Qn][0],n[Qn][1]])}for(var ti=new TC(this.properties),kr=0;kr<Ae.length;++kr){var Bs=new E2;ti.geometries.push(Bs);for(var Ts=Ae[kr],ro=0;ro<Ts.length;++ro)Bs.move_to(Ts[ro])}return ti},ve(6952);var Eo=[],Co=[],So=[],Io=[],To=[],Mo=[],Do=[],Ao=[],Po=[],Ro=[],Lo=[],Oo=[],No=[],ko=[],Fo=[],Bo=[],zo=[],Uo=[],Vo=[],jo=[],Go=[],$o=[],qo=[],Ho=[];Do[85]=Ro[85]=-1,Ao[85]=Lo[85]=0,Po[85]=Oo[85]=1,Vo[85]=$o[85]=1,jo[85]=qo[85]=0,Go[85]=Ho[85]=1,Eo[85]=Io[85]=0,Co[85]=To[85]=-1,So[85]=Fo[85]=0,Bo[85]=No[85]=0,zo[85]=ko[85]=1,Mo[85]=Uo[85]=1,$o[1]=$o[169]=0,qo[1]=qo[169]=-1,Ho[1]=Ho[169]=0,No[1]=No[169]=-1,ko[1]=ko[169]=0,Fo[1]=Fo[169]=0,Ro[4]=Ro[166]=0,Lo[4]=Lo[166]=-1,Oo[4]=Oo[166]=1,Bo[4]=Bo[166]=1,zo[4]=zo[166]=0,Uo[4]=Uo[166]=0,Do[16]=Do[154]=0,Ao[16]=Ao[154]=1,Po[16]=Po[154]=1,Io[16]=Io[154]=1,To[16]=To[154]=0,Mo[16]=Mo[154]=1,Vo[64]=Vo[106]=0,jo[64]=jo[106]=1,Go[64]=Go[106]=0,Eo[64]=Eo[106]=-1,Co[64]=Co[106]=0,So[64]=So[106]=1,Vo[2]=Vo[168]=0,jo[2]=jo[168]=-1,Go[2]=Go[168]=1,$o[2]=$o[168]=0,qo[2]=qo[168]=-1,Ho[2]=Ho[168]=0,No[2]=No[168]=-1,ko[2]=ko[168]=0,Fo[2]=Fo[168]=0,Bo[2]=Bo[168]=-1,zo[2]=zo[168]=0,Uo[2]=Uo[168]=1,Do[8]=Do[162]=0,Ao[8]=Ao[162]=-1,Po[8]=Po[162]=0,Ro[8]=Ro[162]=0,Lo[8]=Lo[162]=-1,Oo[8]=Oo[162]=1,No[8]=No[162]=1,ko[8]=ko[162]=0,Fo[8]=Fo[162]=1,Bo[8]=Bo[162]=1,zo[8]=zo[162]=0,Uo[8]=Uo[162]=0,Do[32]=Do[138]=0,Ao[32]=Ao[138]=1,Po[32]=Po[138]=1,Ro[32]=Ro[138]=0,Lo[32]=Lo[138]=1,Oo[32]=Oo[138]=0,Eo[32]=Eo[138]=1,Co[32]=Co[138]=0,So[32]=So[138]=0,Io[32]=Io[138]=1,To[32]=To[138]=0,Mo[32]=Mo[138]=1,$o[128]=$o[42]=0,qo[128]=qo[42]=1,Ho[128]=Ho[42]=1,Vo[128]=Vo[42]=0,jo[128]=jo[42]=1,Go[128]=Go[42]=0,Eo[128]=Eo[42]=-1,Co[128]=Co[42]=0,So[128]=So[42]=1,Io[128]=Io[42]=-1,To[128]=To[42]=0,Mo[128]=Mo[42]=0,Ro[5]=Ro[165]=-1,Lo[5]=Lo[165]=0,Oo[5]=Oo[165]=0,$o[5]=$o[165]=1,qo[5]=qo[165]=0,Ho[5]=Ho[165]=0,Bo[20]=Bo[150]=0,zo[20]=zo[150]=1,Uo[20]=Uo[150]=1,Io[20]=Io[150]=0,To[20]=To[150]=-1,Mo[20]=Mo[150]=1,Do[80]=Do[90]=-1,Ao[80]=Ao[90]=0,Po[80]=Po[90]=1,Vo[80]=Vo[90]=1,jo[80]=jo[90]=0,Go[80]=Go[90]=1,No[65]=No[105]=0,ko[65]=ko[105]=1,Fo[65]=Fo[105]=0,Eo[65]=Eo[105]=0,Co[65]=Co[105]=-1,So[65]=So[105]=0,Do[160]=Do[10]=-1,Ao[160]=Ao[10]=0,Po[160]=Po[10]=1,Ro[160]=Ro[10]=-1,Lo[160]=Lo[10]=0,Oo[160]=Oo[10]=0,$o[160]=$o[10]=1,qo[160]=qo[10]=0,Ho[160]=Ho[10]=0,Vo[160]=Vo[10]=1,jo[160]=jo[10]=0,Go[160]=Go[10]=1,Bo[130]=Bo[40]=0,zo[130]=zo[40]=1,Uo[130]=Uo[40]=1,No[130]=No[40]=0,ko[130]=ko[40]=1,Fo[130]=Fo[40]=0,Eo[130]=Eo[40]=0,Co[130]=Co[40]=-1,So[130]=So[40]=0,Io[130]=Io[40]=0,To[130]=To[40]=-1,Mo[130]=Mo[40]=1,Ro[37]=Ro[133]=0,Lo[37]=Lo[133]=1,Oo[37]=Oo[133]=1,$o[37]=$o[133]=0,qo[37]=qo[133]=1,Ho[37]=Ho[133]=0,Eo[37]=Eo[133]=-1,Co[37]=Co[133]=0,So[37]=So[133]=0,Io[37]=Io[133]=1,To[37]=To[133]=0,Mo[37]=Mo[133]=0,Bo[148]=Bo[22]=-1,zo[148]=zo[22]=0,Uo[148]=Uo[22]=0,$o[148]=$o[22]=0,qo[148]=qo[22]=-1,Ho[148]=Ho[22]=1,Vo[148]=Vo[22]=0,jo[148]=jo[22]=1,Go[148]=Go[22]=1,Io[148]=Io[22]=-1,To[148]=To[22]=0,Mo[148]=Mo[22]=1,Do[82]=Do[88]=0,Ao[82]=Ao[88]=-1,Po[82]=Po[88]=1,Bo[82]=Bo[88]=1,zo[82]=zo[88]=0,Uo[82]=Uo[88]=1,No[82]=No[88]=-1,ko[82]=ko[88]=0,Fo[82]=Fo[88]=1,Vo[82]=Vo[88]=0,jo[82]=jo[88]=-1,Go[82]=Go[88]=0,Do[73]=Do[97]=0,Ao[73]=Ao[97]=1,Po[73]=Po[97]=0,Ro[73]=Ro[97]=0,Lo[73]=Lo[97]=-1,Oo[73]=Oo[97]=0,No[73]=No[97]=1,ko[73]=ko[97]=0,Fo[73]=Fo[97]=0,Eo[73]=Eo[97]=1,Co[73]=Co[97]=0,So[73]=So[97]=1,Do[145]=Do[25]=0,Ao[145]=Ao[25]=-1,Po[145]=Po[25]=0,No[145]=No[25]=1,ko[145]=ko[25]=0,Fo[145]=Fo[25]=1,$o[145]=$o[25]=0,qo[145]=qo[25]=1,Ho[145]=Ho[25]=1,Io[145]=Io[25]=-1,To[145]=To[25]=0,Mo[145]=Mo[25]=0,Ro[70]=Ro[100]=0,Lo[70]=Lo[100]=1,Oo[70]=Oo[100]=0,Bo[70]=Bo[100]=-1,zo[70]=zo[100]=0,Uo[70]=Uo[100]=1,Vo[70]=Vo[100]=0,jo[70]=jo[100]=-1,Go[70]=Go[100]=1,Eo[70]=Eo[100]=1,Co[70]=Co[100]=0,So[70]=So[100]=0,Ro[101]=Ro[69]=0,Lo[101]=Lo[69]=1,Oo[101]=Oo[69]=0,Eo[101]=Eo[69]=1,Co[101]=Co[69]=0,So[101]=So[69]=0,$o[149]=$o[21]=0,qo[149]=qo[21]=1,Ho[149]=Ho[21]=1,Io[149]=Io[21]=-1,To[149]=To[21]=0,Mo[149]=Mo[21]=0,Bo[86]=Bo[84]=-1,zo[86]=zo[84]=0,Uo[86]=Uo[84]=1,Vo[86]=Vo[84]=0,jo[86]=jo[84]=-1,Go[86]=Go[84]=1,Do[89]=Do[81]=0,Ao[89]=Ao[81]=-1,Po[89]=Po[81]=0,No[89]=No[81]=1,ko[89]=ko[81]=0,Fo[89]=Fo[81]=1,Do[96]=Do[74]=0,Ao[96]=Ao[74]=1,Po[96]=Po[74]=0,Ro[96]=Ro[74]=-1,Lo[96]=Lo[74]=0,Oo[96]=Oo[74]=1,Vo[96]=Vo[74]=1,jo[96]=jo[74]=0,Go[96]=Go[74]=0,Eo[96]=Eo[74]=1,Co[96]=Co[74]=0,So[96]=So[74]=1,Do[24]=Do[146]=0,Ao[24]=Ao[146]=-1,Po[24]=Po[146]=1,Bo[24]=Bo[146]=1,zo[24]=zo[146]=0,Uo[24]=Uo[146]=1,No[24]=No[146]=0,ko[24]=ko[146]=1,Fo[24]=Fo[146]=1,Io[24]=Io[146]=0,To[24]=To[146]=-1,Mo[24]=Mo[146]=0,Ro[6]=Ro[164]=-1,Lo[6]=Lo[164]=0,Oo[6]=Oo[164]=1,Bo[6]=Bo[164]=-1,zo[6]=zo[164]=0,Uo[6]=Uo[164]=0,$o[6]=$o[164]=0,qo[6]=qo[164]=-1,Ho[6]=Ho[164]=1,Vo[6]=Vo[164]=1,jo[6]=jo[164]=0,Go[6]=Go[164]=0,No[129]=No[41]=0,ko[129]=ko[41]=1,Fo[129]=Fo[41]=1,$o[129]=$o[41]=0,qo[129]=qo[41]=1,Ho[129]=Ho[41]=0,Eo[129]=Eo[41]=-1,Co[129]=Co[41]=0,So[129]=So[41]=0,Io[129]=Io[41]=0,To[129]=To[41]=-1,Mo[129]=Mo[41]=0,Bo[66]=Bo[104]=0,zo[66]=zo[104]=1,Uo[66]=Uo[104]=0,No[66]=No[104]=-1,ko[66]=ko[104]=0,Fo[66]=Fo[104]=1,Vo[66]=Vo[104]=0,jo[66]=jo[104]=-1,Go[66]=Go[104]=0,Eo[66]=Eo[104]=0,Co[66]=Co[104]=-1,So[66]=So[104]=1,Do[144]=Do[26]=-1,Ao[144]=Ao[26]=0,Po[144]=Po[26]=0,$o[144]=$o[26]=1,qo[144]=qo[26]=0,Ho[144]=Ho[26]=1,Vo[144]=Vo[26]=0,jo[144]=jo[26]=1,Go[144]=Go[26]=1,Io[144]=Io[26]=-1,To[144]=To[26]=0,Mo[144]=Mo[26]=1,Ro[36]=Ro[134]=0,Lo[36]=Lo[134]=1,Oo[36]=Oo[134]=1,Bo[36]=Bo[134]=0,zo[36]=zo[134]=1,Uo[36]=Uo[134]=0,Eo[36]=Eo[134]=0,Co[36]=Co[134]=-1,So[36]=So[134]=1,Io[36]=Io[134]=1,To[36]=To[134]=0,Mo[36]=Mo[134]=0,Do[9]=Do[161]=-1,Ao[9]=Ao[161]=0,Po[9]=Po[161]=0,Ro[9]=Ro[161]=0,Lo[9]=Lo[161]=-1,Oo[9]=Oo[161]=0,No[9]=No[161]=1,ko[9]=ko[161]=0,Fo[9]=Fo[161]=0,$o[9]=$o[161]=1,qo[9]=qo[161]=0,Ho[9]=Ho[161]=1,Do[136]=0,Ao[136]=1,Po[136]=1,Ro[136]=0,Lo[136]=1,Oo[136]=0,Bo[136]=-1,zo[136]=0,Uo[136]=1,No[136]=-1,ko[136]=0,Fo[136]=0,$o[136]=0,qo[136]=-1,Ho[136]=0,Vo[136]=0,jo[136]=-1,Go[136]=1,Eo[136]=1,Co[136]=0,So[136]=0,Io[136]=1,To[136]=0,Mo[136]=1,Do[34]=0,Ao[34]=-1,Po[34]=0,Ro[34]=0,Lo[34]=-1,Oo[34]=1,Bo[34]=1,zo[34]=0,Uo[34]=0,No[34]=1,ko[34]=0,Fo[34]=1,$o[34]=0,qo[34]=1,Ho[34]=1,Vo[34]=0,jo[34]=1,Go[34]=0,Eo[34]=-1,Co[34]=0,So[34]=1,Io[34]=-1,To[34]=0,Mo[34]=0,Do[35]=0,Ao[35]=1,Po[35]=1,Ro[35]=0,Lo[35]=-1,Oo[35]=1,Bo[35]=1,zo[35]=0,Uo[35]=0,No[35]=-1,ko[35]=0,Fo[35]=0,$o[35]=0,qo[35]=-1,Ho[35]=0,Vo[35]=0,jo[35]=1,Go[35]=0,Eo[35]=-1,Co[35]=0,So[35]=1,Io[35]=1,To[35]=0,Mo[35]=1,Do[153]=0,Ao[153]=1,Po[153]=1,No[153]=-1,ko[153]=0,Fo[153]=0,$o[153]=0,qo[153]=-1,Ho[153]=0,Io[153]=1,To[153]=0,Mo[153]=1,Ro[102]=0,Lo[102]=-1,Oo[102]=1,Bo[102]=1,zo[102]=0,Uo[102]=0,Vo[102]=0,jo[102]=1,Go[102]=0,Eo[102]=-1,Co[102]=0,So[102]=1,Do[155]=0,Ao[155]=-1,Po[155]=0,No[155]=1,ko[155]=0,Fo[155]=1,$o[155]=0,qo[155]=1,Ho[155]=1,Io[155]=-1,To[155]=0,Mo[155]=0,Ro[103]=0,Lo[103]=1,Oo[103]=0,Bo[103]=-1,zo[103]=0,Uo[103]=1,Vo[103]=0,jo[103]=-1,Go[103]=1,Eo[103]=1,Co[103]=0,So[103]=0,Do[152]=0,Ao[152]=1,Po[152]=1,Bo[152]=-1,zo[152]=0,Uo[152]=1,No[152]=-1,ko[152]=0,Fo[152]=0,$o[152]=0,qo[152]=-1,Ho[152]=0,Vo[152]=0,jo[152]=-1,Go[152]=1,Io[152]=1,To[152]=0,Mo[152]=1,Do[156]=0,Ao[156]=-1,Po[156]=1,Bo[156]=1,zo[156]=0,Uo[156]=1,No[156]=-1,ko[156]=0,Fo[156]=0,$o[156]=0,qo[156]=-1,Ho[156]=0,Vo[156]=0,jo[156]=1,Go[156]=1,Io[156]=-1,To[156]=0,Mo[156]=1,Do[137]=0,Ao[137]=1,Po[137]=1,Ro[137]=0,Lo[137]=1,Oo[137]=0,No[137]=-1,ko[137]=0,Fo[137]=0,$o[137]=0,qo[137]=-1,Ho[137]=0,Eo[137]=1,Co[137]=0,So[137]=0,Io[137]=1,To[137]=0,Mo[137]=1,Do[139]=0,Ao[139]=1,Po[139]=1,Ro[139]=0,Lo[139]=-1,Oo[139]=0,No[139]=1,ko[139]=0,Fo[139]=0,$o[139]=0,qo[139]=1,Ho[139]=0,Eo[139]=-1,Co[139]=0,So[139]=0,Io[139]=1,To[139]=0,Mo[139]=1,Do[98]=0,Ao[98]=-1,Po[98]=0,Ro[98]=0,Lo[98]=-1,Oo[98]=1,Bo[98]=1,zo[98]=0,Uo[98]=0,No[98]=1,ko[98]=0,Fo[98]=1,Vo[98]=0,jo[98]=1,Go[98]=0,Eo[98]=-1,Co[98]=0,So[98]=1,Do[99]=0,Ao[99]=1,Po[99]=0,Ro[99]=0,Lo[99]=-1,Oo[99]=1,Bo[99]=1,zo[99]=0,Uo[99]=0,No[99]=-1,ko[99]=0,Fo[99]=1,Vo[99]=0,jo[99]=-1,Go[99]=0,Eo[99]=1,Co[99]=0,So[99]=1,Ro[38]=0,Lo[38]=-1,Oo[38]=1,Bo[38]=1,zo[38]=0,Uo[38]=0,$o[38]=0,qo[38]=1,Ho[38]=1,Vo[38]=0,jo[38]=1,Go[38]=0,Eo[38]=-1,Co[38]=0,So[38]=1,Io[38]=-1,To[38]=0,Mo[38]=0,Ro[39]=0,Lo[39]=1,Oo[39]=1,Bo[39]=-1,zo[39]=0,Uo[39]=0,$o[39]=0,qo[39]=-1,Ho[39]=1,Vo[39]=0,jo[39]=1,Go[39]=0,Eo[39]=-1,Co[39]=0,So[39]=1,Io[39]=1,To[39]=0,Mo[39]=0;var RC=function(e){return[[e.bottomleft,0],[0,0],[0,e.leftbottom]]},LC=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0]]},OC=function(e){return[[e.topright,1],[1,1],[1,e.righttop]]},NC=function(e){return[[0,e.lefttop],[0,1],[e.topleft,1]]},kC=function(e){return[[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop]]},FC=function(e){return[[e.bottomright,0],[e.bottomleft,0],[1,e.righttop],[1,e.rightbottom]]},BC=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.topleft,1],[e.topright,1]]},zC=function(e){return[[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},Er=[],_r=[],Jr=[],jr=[],Ei=[],_i=[],Wo=[],Qo=[];jr[1]=Ei[1]=18,jr[169]=Ei[169]=18,Jr[4]=_r[4]=12,Jr[166]=_r[166]=12,Er[16]=Qo[16]=4,Er[154]=Qo[154]=4,_i[64]=Wo[64]=22,_i[106]=Wo[106]=22,Jr[2]=_i[2]=17,jr[2]=Ei[2]=18,Jr[168]=_i[168]=17,jr[168]=Ei[168]=18,Er[8]=jr[8]=9,_r[8]=Jr[8]=12,Er[162]=jr[162]=9,_r[162]=Jr[162]=12,Er[32]=Qo[32]=4,_r[32]=Wo[32]=1,Er[138]=Qo[138]=4,_r[138]=Wo[138]=1,Ei[128]=Qo[128]=21,_i[128]=Wo[128]=22,Ei[42]=Qo[42]=21,_i[42]=Wo[42]=22,_r[5]=Ei[5]=14,_r[165]=Ei[165]=14,Jr[20]=Qo[20]=6,Jr[150]=Qo[150]=6,Er[80]=_i[80]=11,Er[90]=_i[90]=11,jr[65]=Wo[65]=3,jr[105]=Wo[105]=3,Er[160]=_i[160]=11,_r[160]=Ei[160]=14,Er[10]=_i[10]=11,_r[10]=Ei[10]=14,Jr[130]=Qo[130]=6,jr[130]=Wo[130]=3,Jr[40]=Qo[40]=6,jr[40]=Wo[40]=3,_r[101]=Wo[101]=1,_r[69]=Wo[69]=1,Ei[149]=Qo[149]=21,Ei[21]=Qo[21]=21,Jr[86]=_i[86]=17,Jr[84]=_i[84]=17,Er[89]=jr[89]=9,Er[81]=jr[81]=9,Er[96]=Wo[96]=0,_r[96]=_i[96]=15,Er[74]=Wo[74]=0,_r[74]=_i[74]=15,Er[24]=Jr[24]=8,jr[24]=Qo[24]=7,Er[146]=Jr[146]=8,jr[146]=Qo[146]=7,_r[6]=_i[6]=15,Jr[6]=Ei[6]=16,_r[164]=_i[164]=15,Jr[164]=Ei[164]=16,jr[129]=Qo[129]=7,Ei[129]=Wo[129]=20,jr[41]=Qo[41]=7,Ei[41]=Wo[41]=20,Jr[66]=Wo[66]=2,jr[66]=_i[66]=19,Jr[104]=Wo[104]=2,jr[104]=_i[104]=19,Er[144]=Ei[144]=10,_i[144]=Qo[144]=23,Er[26]=Ei[26]=10,_i[26]=Qo[26]=23,_r[36]=Qo[36]=5,Jr[36]=Wo[36]=2,_r[134]=Qo[134]=5,Jr[134]=Wo[134]=2,Er[9]=Ei[9]=10,_r[9]=jr[9]=13,Er[161]=Ei[161]=10,_r[161]=jr[161]=13,_r[37]=Qo[37]=5,Ei[37]=Wo[37]=20,_r[133]=Qo[133]=5,Ei[133]=Wo[133]=20,Jr[148]=Ei[148]=16,_i[148]=Qo[148]=23,Jr[22]=Ei[22]=16,_i[22]=Qo[22]=23,Er[82]=Jr[82]=8,jr[82]=_i[82]=19,Er[88]=Jr[88]=8,jr[88]=_i[88]=19,Er[73]=Wo[73]=0,_r[73]=jr[73]=13,Er[97]=Wo[97]=0,_r[97]=jr[97]=13,Er[145]=jr[145]=9,Ei[145]=Qo[145]=21,Er[25]=jr[25]=9,Ei[25]=Qo[25]=21,_r[70]=Wo[70]=1,Jr[70]=_i[70]=17,_r[100]=Wo[100]=1,Jr[100]=_i[100]=17,Er[34]=jr[34]=9,_r[34]=Jr[34]=12,Ei[34]=Qo[34]=21,_i[34]=Wo[34]=22,Er[136]=Qo[136]=4,_r[136]=Wo[136]=1,Jr[136]=_i[136]=17,jr[136]=Ei[136]=18,Er[35]=Qo[35]=4,_r[35]=Jr[35]=12,jr[35]=Ei[35]=18,_i[35]=Wo[35]=22,Er[153]=Qo[153]=4,jr[153]=Ei[153]=18,_r[102]=Jr[102]=12,_i[102]=Wo[102]=22,Er[155]=jr[155]=9,Ei[155]=Qo[155]=23,_r[103]=Wo[103]=1,Jr[103]=_i[103]=17,Er[152]=Qo[152]=4,Jr[152]=_i[152]=17,jr[152]=Ei[152]=18,Er[156]=Jr[156]=8,jr[156]=Ei[156]=18,_i[156]=Qo[156]=23,Er[137]=Qo[137]=4,_r[137]=Wo[137]=1,jr[137]=Ei[137]=18,Er[139]=Qo[139]=4,_r[139]=jr[139]=13,Ei[139]=Wo[139]=20,Er[98]=jr[98]=9,_r[98]=Jr[98]=12,_i[98]=Wo[98]=22,Er[99]=Wo[99]=0,_r[99]=Jr[99]=12,jr[99]=_i[99]=19,_r[38]=Jr[38]=12,Ei[38]=Qo[38]=21,_i[38]=Wo[38]=22,_r[39]=Qo[39]=5,Jr[39]=Ei[39]=16,_i[39]=Wo[39]=22;var cr=[];function jC(e,t,n){return function rV(e){return(e>0)-(e<0)||+e}((t[0]-e[0])*(n[1]-t[1])-(n[0]-t[0])*(t[1]-e[1]))}function z2(e,t){return t.geometry.coordinates[0].every(function(n){return t2(yw(n),e)})}cr[1]=cr[169]=RC,cr[4]=cr[166]=LC,cr[16]=cr[154]=OC,cr[64]=cr[106]=NC,cr[168]=cr[2]=kC,cr[162]=cr[8]=FC,cr[138]=cr[32]=BC,cr[42]=cr[128]=zC,cr[5]=cr[165]=function(e){return[[0,0],[0,e.leftbottom],[1,e.rightbottom],[1,0]]},cr[20]=cr[150]=function(e){return[[1,0],[e.bottomright,0],[e.topright,1],[1,1]]},cr[80]=cr[90]=function(e){return[[1,1],[1,e.righttop],[0,e.lefttop],[0,1]]},cr[65]=cr[105]=function(e){return[[e.bottomleft,0],[0,0],[0,1],[e.topleft,1]]},cr[160]=cr[10]=function(e){return[[1,e.righttop],[1,e.rightbottom],[0,e.leftbottom],[0,e.lefttop]]},cr[130]=cr[40]=function(e){return[[e.topleft,1],[e.topright,1],[e.bottomright,0],[e.bottomleft,0]]},cr[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},cr[101]=cr[69]=function(e){return[[1,e.rightbottom],[1,0],[0,0],[0,1],[e.topleft,1]]},cr[149]=cr[21]=function(e){return[[e.topright,1],[1,1],[1,0],[0,0],[0,e.leftbottom]]},cr[86]=cr[84]=function(e){return[[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[1,1]]},cr[89]=cr[81]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,1]]},cr[96]=cr[74]=function(e){return[[1,e.righttop],[1,e.rightbottom],[0,e.lefttop],[0,1],[e.topleft,1]]},cr[24]=cr[146]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[e.topright,1]]},cr[6]=cr[164]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop]]},cr[129]=cr[41]=function(e){return[[e.topright,1],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topleft,1]]},cr[66]=cr[104]=function(e){return[[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1],[e.topleft,1]]},cr[144]=cr[26]=function(e){return[[1,1],[1,e.righttop],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},cr[36]=cr[134]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[e.topleft,1],[e.topright,1]]},cr[9]=cr[161]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,e.leftbottom]]},cr[37]=cr[133]=function(e){return[[1,e.rightbottom],[1,0],[0,0],[0,e.leftbottom],[e.topleft,1],[e.topright,1]]},cr[148]=cr[22]=function(e){return[[1,1],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},cr[82]=cr[88]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1]]},cr[73]=cr[97]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,1],[e.topleft,1]]},cr[145]=cr[25]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topright,1]]},cr[70]=cr[100]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[e.topleft,1]]},cr[34]=function(e){return[zC(e),FC(e)]},cr[35]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},cr[136]=function(e){return[BC(e),kC(e)]},cr[153]=function(e){return[OC(e),RC(e)]},cr[102]=function(e){return[LC(e),NC(e)]},cr[155]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topright,1]]},cr[103]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[e.topleft,1]]},cr[152]=function(e){return[OC(e),kC(e)]},cr[156]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},cr[137]=function(e){return[BC(e),RC(e)]},cr[139]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topleft,1],[e.topright,1]]},cr[98]=function(e){return[FC(e),NC(e)]},cr[99]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1],[e.topleft,1]]},cr[38]=function(e){return[LC(e),zC(e)]},cr[39]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]};const U2=function(){function e(t){this.id=e.buildId(t),this.coordinates=t,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return e.buildId=function(t){return t.join(",")},e.prototype.removeInnerEdge=function(t){this.innerEdges=this.innerEdges.filter(function(n){return n.from.id!==t.from.id})},e.prototype.removeOuterEdge=function(t){this.outerEdges=this.outerEdges.filter(function(n){return n.to.id!==t.to.id})},e.prototype.addOuterEdge=function(t){this.outerEdges.push(t),this.outerEdgesSorted=!1},e.prototype.sortOuterEdges=function(){var t=this;this.outerEdgesSorted||(this.outerEdges.sort(function(n,r){var o=n.to,c=r.to;if(o.coordinates[0]-t.coordinates[0]>=0&&c.coordinates[0]-t.coordinates[0]<0)return 1;if(o.coordinates[0]-t.coordinates[0]<0&&c.coordinates[0]-t.coordinates[0]>=0)return-1;if(o.coordinates[0]-t.coordinates[0]==0&&c.coordinates[0]-t.coordinates[0]==0)return o.coordinates[1]-t.coordinates[1]>=0||c.coordinates[1]-t.coordinates[1]>=0?o.coordinates[1]-c.coordinates[1]:c.coordinates[1]-o.coordinates[1];var d=jC(t.coordinates,o.coordinates,c.coordinates);return d<0?1:d>0?-1:Math.pow(o.coordinates[0]-t.coordinates[0],2)+Math.pow(o.coordinates[1]-t.coordinates[1],2)-(Math.pow(c.coordinates[0]-t.coordinates[0],2)+Math.pow(c.coordinates[1]-t.coordinates[1],2))}),this.outerEdgesSorted=!0)},e.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},e.prototype.getOuterEdge=function(t){return this.sortOuterEdges(),this.outerEdges[t]},e.prototype.addInnerEdge=function(t){this.innerEdges.push(t)},e}(),uV=function(){function e(t,n){this.from=t,this.to=n,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return e.prototype.getSymetric=function(){return this.symetric||(this.symetric=new e(this.to,this.from),this.symetric.symetric=this),this.symetric},e.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},e.prototype.isEqual=function(t){return this.from.id===t.from.id&&this.to.id===t.to.id},e.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},e.prototype.toLineString=function(){return function gC(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return Og({type:"LineString",coordinates:e},t,n)}([this.from.coordinates,this.to.coordinates])},e.prototype.compareTo=function(t){return jC(t.from.coordinates,t.to.coordinates,this.to.coordinates)},e}(),cV=function(){function e(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return e.prototype.push=function(t){this.edges.push(t),this.polygon=this.envelope=void 0},e.prototype.get=function(t){return this.edges[t]},Object.defineProperty(e.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),e.prototype.forEach=function(t){this.edges.forEach(t)},e.prototype.map=function(t){return this.edges.map(t)},e.prototype.some=function(t){return this.edges.some(t)},e.prototype.isValid=function(){return!0},e.prototype.isHole=function(){var t=this,n=this.edges.reduce(function(d,_,E){return _.from.coordinates[1]>t.edges[d].from.coordinates[1]&&(d=E),d},0),r=(0===n?this.length:n)-1,o=(n+1)%this.length,c=jC(this.edges[r].from.coordinates,this.edges[n].from.coordinates,this.edges[o].from.coordinates);return 0===c?this.edges[r].from.coordinates[0]>this.edges[o].from.coordinates[0]:c>0},e.prototype.toMultiPoint=function(){return function XA(e,t,n){return void 0===n&&(n={}),Og({type:"MultiPoint",coordinates:e},t,n)}(this.edges.map(function(t){return t.from.coordinates}))},e.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var t=this.edges.map(function(n){return n.from.coordinates});return t.push(this.edges[0].from.coordinates),this.polygon=_w([t])},e.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=function _U(e){return function yU(e,t){void 0===t&&(t={});var n=Number(e[0]),r=Number(e[1]),o=Number(e[2]),c=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var d=[n,r];return _w([[d,[o,r],[o,c],[n,c],d]],t.properties,{bbox:e,id:t.id})}(F5(e))}(this.toPolygon())},e.findEdgeRingContaining=function(t,n){var o,c,r=t.getEnvelope();return n.forEach(function(d){var _=d.getEnvelope();if(c&&(o=c.getEnvelope()),!function iV(e,t){var n=e.geometry.coordinates[0].map(function(d){return d[0]}),r=e.geometry.coordinates[0].map(function(d){return d[1]}),o=t.geometry.coordinates[0].map(function(d){return d[0]}),c=t.geometry.coordinates[0].map(function(d){return d[1]});return Math.max.apply(null,n)===Math.max.apply(null,o)&&Math.max.apply(null,r)===Math.max.apply(null,c)&&Math.min.apply(null,n)===Math.min.apply(null,o)&&Math.min.apply(null,r)===Math.min.apply(null,c)}(_,r)&&z2(_,r)){for(var E=t.map(function(de){return de.from.coordinates}),S=void 0,R=function(de){d.some(function(he){return function oV(e,t){return e[0]===t[0]&&e[1]===t[1]}(de,he.from.coordinates)})||(S=de)},L=0,B=E;L<B.length;L++)R(B[L]);S&&d.inside(yw(S))&&(!c||z2(o,_))&&(c=d)}}),c},e.prototype.inside=function(t){return t2(t,this.toPolygon())},e}();function Z2(e){for(var t=e,n=[];t.parent;)n.unshift(t),t=t.parent;return n}!function(){function e(){this.edges=[],this.nodes={}}e.fromGeoJson=function(t){!function hV(e){if(!e)throw new Error("No geojson passed");if("FeatureCollection"!==e.type&&"GeometryCollection"!==e.type&&"MultiLineString"!==e.type&&"LineString"!==e.type&&"Feature"!==e.type)throw new Error("Invalid input type '"+e.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(t);var n=new e;return xw(t,function(r){(function z5(e,t,n){if(!e)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!e||"Feature"!==e.type||!e.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+e.geometry.type)})(r,"LineString","Graph::fromGeoJson"),function R5(e,t,n,r){var o=n;A1(e,function(c,d,_,E,S){o=0===d&&void 0===n?c:t(o,c,d,_,E,S)},r)}(r,function(o,c){if(o){var d=n.getNode(o),_=n.getNode(c);n.addEdge(d,_)}return c})}),n},e.prototype.getNode=function(t){var n=U2.buildId(t),r=this.nodes[n];return r||(r=this.nodes[n]=new U2(t)),r},e.prototype.addEdge=function(t,n){var r=new uV(t,n),o=r.getSymetric();this.edges.push(r),this.edges.push(o)},e.prototype.deleteDangles=function(){var t=this;Object.keys(this.nodes).map(function(n){return t.nodes[n]}).forEach(function(n){return t._removeIfDangle(n)})},e.prototype._removeIfDangle=function(t){var n=this;if(t.innerEdges.length<=1){var r=t.getOuterEdges().map(function(o){return o.to});this.removeNode(t),r.forEach(function(o){return n._removeIfDangle(o)})}},e.prototype.deleteCutEdges=function(){var t=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(n){n.label===n.symetric.label&&(t.removeEdge(n.symetric),t.removeEdge(n))})},e.prototype._computeNextCWEdges=function(t){var n=this;typeof t>"u"?Object.keys(this.nodes).forEach(function(r){return n._computeNextCWEdges(n.nodes[r])}):t.getOuterEdges().forEach(function(r,o){t.getOuterEdge((0===o?t.getOuterEdges().length:o)-1).symetric.next=r})},e.prototype._computeNextCCWEdges=function(t,n){for(var o,c,r=t.getOuterEdges(),d=r.length-1;d>=0;--d){var _=r[d],E=_.symetric,S=void 0,R=void 0;_.label===n&&(S=_),E.label===n&&(R=E),S&&R&&(R&&(c=R),S&&(c&&(c.next=S,c=void 0),o||(o=S)))}c&&(c.next=o)},e.prototype._findLabeledEdgeRings=function(){var t=[],n=0;return this.edges.forEach(function(r){if(!(r.label>=0)){t.push(r);var o=r;do{o.label=n,o=o.next}while(!r.isEqual(o));n++}}),t},e.prototype.getEdgeRings=function(){var t=this;this._computeNextCWEdges(),this.edges.forEach(function(r){r.label=void 0}),this._findLabeledEdgeRings().forEach(function(r){t._findIntersectionNodes(r).forEach(function(o){t._computeNextCCWEdges(o,r.label)})});var n=[];return this.edges.forEach(function(r){r.ring||n.push(t._findEdgeRing(r))}),n},e.prototype._findIntersectionNodes=function(t){var n=[],r=t,o=function(){var c=0;r.from.getOuterEdges().forEach(function(d){d.label===t.label&&++c}),c>1&&n.push(r.from),r=r.next};do{o()}while(!t.isEqual(r));return n},e.prototype._findEdgeRing=function(t){var n=t,r=new cV;do{r.push(n),n.ring=r,n=n.next}while(!t.isEqual(n));return r},e.prototype.removeNode=function(t){var n=this;t.getOuterEdges().forEach(function(r){return n.removeEdge(r)}),t.innerEdges.forEach(function(r){return n.removeEdge(r)}),delete this.nodes[t.id]},e.prototype.removeEdge=function(t){this.edges=this.edges.filter(function(n){return!n.isEqual(t)}),t.deleteEdge()}}(),ve(5013),ve(7470),ve(9475);var Tw={search:function(e,t,n,r){e.cleanDirty();var o=(r=r||{}).heuristic||Tw.heuristics.manhattan,c=r.closest||!1,d=function TV(){return new Y2(function(e){return e.f})}(),_=t;for(t.h=o(t,n),d.push(t);d.size()>0;){var E=d.pop();if(E===n)return Z2(E);E.closed=!0;for(var S=e.neighbors(E),R=0,L=S.length;R<L;++R){var B=S[R];if(!B.closed&&!B.isWall()){var V=E.g+B.getCost(E),de=B.visited;(!de||V<B.g)&&(B.visited=!0,B.parent=E,B.h=B.h||o(B,n),B.g=V,B.f=B.g+B.h,e.markDirty(B),c&&(B.h<_.h||B.h===_.h&&B.g<_.g)&&(_=B),de?d.rescoreElement(B):d.push(B))}}}return c?Z2(_):[]},heuristics:{manhattan:function(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},diagonal:function(e,t){var r=Math.sqrt(2),o=Math.abs(t.x-e.x),c=Math.abs(t.y-e.y);return 1*(o+c)+(r-2)*Math.min(o,c)}},cleanNode:function(e){e.f=0,e.g=0,e.h=0,e.visited=!1,e.closed=!1,e.parent=null}};function Uv(e,t){t=t||{},this.nodes=[],this.diagonal=!!t.diagonal,this.grid=[];for(var n=0;n<e.length;n++){this.grid[n]=[];for(var r=0,o=e[n];r<o.length;r++){var c=new Mw(n,r,o[r]);this.grid[n][r]=c,this.nodes.push(c)}}this.init()}function Mw(e,t,n){this.x=e,this.y=t,this.weight=n}function Y2(e){this.content=[],this.scoreFunction=e}function $C(){this._=null}function Dw(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function N1(e,t){var n=t,r=t.R,o=n.U;o?o.L===n?o.L=r:o.R=r:e._=r,r.U=o,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function k1(e,t){var n=t,r=t.L,o=n.U;o?o.L===n?o.L=r:o.R=r:e._=r,r.U=o,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function K2(e){for(;e.L;)e=e.L;return e}Uv.prototype.init=function(){this.dirtyNodes=[];for(var e=0;e<this.nodes.length;e++)Tw.cleanNode(this.nodes[e])},Uv.prototype.cleanDirty=function(){for(var e=0;e<this.dirtyNodes.length;e++)Tw.cleanNode(this.dirtyNodes[e]);this.dirtyNodes=[]},Uv.prototype.markDirty=function(e){this.dirtyNodes.push(e)},Uv.prototype.neighbors=function(e){var t=[],n=e.x,r=e.y,o=this.grid;return o[n-1]&&o[n-1][r]&&t.push(o[n-1][r]),o[n+1]&&o[n+1][r]&&t.push(o[n+1][r]),o[n]&&o[n][r-1]&&t.push(o[n][r-1]),o[n]&&o[n][r+1]&&t.push(o[n][r+1]),this.diagonal&&(o[n-1]&&o[n-1][r-1]&&t.push(o[n-1][r-1]),o[n+1]&&o[n+1][r-1]&&t.push(o[n+1][r-1]),o[n-1]&&o[n-1][r+1]&&t.push(o[n-1][r+1]),o[n+1]&&o[n+1][r+1]&&t.push(o[n+1][r+1])),t},Uv.prototype.toString=function(){for(var n,r,o,c,e=[],t=this.grid,d=0,_=t.length;d<_;d++){for(n=[],o=0,c=(r=t[d]).length;o<c;o++)n.push(r[o].weight);e.push(n.join(" "))}return e.join("\n")},Mw.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},Mw.prototype.getCost=function(e){return e&&e.x!==this.x&&e.y!==this.y?1.41421*this.weight:this.weight},Mw.prototype.isWall=function(){return 0===this.weight},Y2.prototype={push:function(e){this.content.push(e),this.sinkDown(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e},remove:function(e){var t=this.content.indexOf(e),n=this.content.pop();t!==this.content.length-1&&(this.content[t]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))},size:function(){return this.content.length},rescoreElement:function(e){this.sinkDown(this.content.indexOf(e))},sinkDown:function(e){for(var t=this.content[e];e>0;){var n=(e+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[n]=t,this.content[e]=r,e=n}},bubbleUp:function(e){for(var t=this.content.length,n=this.content[e],r=this.scoreFunction(n);;){var _,o=e+1<<1,c=o-1,d=null;if(c<t&&(_=this.scoreFunction(this.content[c]))<r&&(d=c),o<t&&this.scoreFunction(this.content[o])<(null===d?r:_)&&(d=o),null===d)break;this.content[e]=this.content[d],this.content[d]=n,e=d}}},$C.prototype={constructor:$C,insert:function(e,t){var n,r,o;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=K2(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)n===(r=n.U).L?(o=r.R)&&o.C?(n.C=o.C=!1,r.C=!0,e=r):(e===n.R&&(N1(this,n),n=(e=n).U),n.C=!1,r.C=!0,k1(this,r)):(o=r.L)&&o.C?(n.C=o.C=!1,r.C=!0,e=r):(e===n.L&&(k1(this,n),n=(e=n).U),n.C=!1,r.C=!0,N1(this,r)),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var n,c,d,t=e.U,r=e.L,o=e.R;if(c=r?o?K2(o):r:o,t?t.L===e?t.L=c:t.R=c:this._=c,r&&o?(d=c.C,c.C=e.C,c.L=r,r.U=c,c!==o?(t=c.U,c.U=e.U,t.L=e=c.R,c.R=o,o.U=c):(c.U=t,t=c,e=c.R)):(d=e.C,e=c),e&&(e.U=t),!d){if(e&&e.C)return void(e.C=!1);do{if(e===this._)break;if(e===t.L){if((n=t.R).C&&(n.C=!1,t.C=!0,N1(this,t),n=t.R),n.L&&n.L.C||n.R&&n.R.C){(!n.R||!n.R.C)&&(n.L.C=!1,n.C=!0,k1(this,n),n=t.R),n.C=t.C,t.C=n.R.C=!1,N1(this,t),e=this._;break}}else if((n=t.L).C&&(n.C=!1,t.C=!0,k1(this,t),n=t.L),n.L&&n.L.C||n.R&&n.R.C){(!n.L||!n.L.C)&&(n.R.C=!1,n.C=!0,N1(this,n),n=t.L),n.C=t.C,t.C=n.L.C=!1,k1(this,t),e=this._;break}n.C=!0,e=t,t=t.U}while(!e.C);e&&(e.C=!1)}}};const J2=$C;function F1(e,t,n,r){var o=[null,null],c=lh.push(o)-1;return o.left=e,o.right=t,n&&Aw(o,e,t,n),r&&Aw(o,t,e,r),Af[e.index].halfedges.push(c),Af[t.index].halfedges.push(c),o}function B1(e,t,n){var r=[t,n];return r.left=e,r}function Aw(e,t,n,r){e[0]||e[1]?e.left===n?e[1]=r:e[0]=r:(e[0]=r,e.left=t,e.right=n)}function DV(e,t,n,r,o){var he,c=e[0],d=e[1],_=c[0],E=c[1],L=0,B=1,V=d[0]-_,de=d[1]-E;if(he=t-_,V||!(he>0)){if(he/=V,V<0){if(he<L)return;he<B&&(B=he)}else if(V>0){if(he>B)return;he>L&&(L=he)}if(he=r-_,V||!(he<0)){if(he/=V,V<0){if(he>B)return;he>L&&(L=he)}else if(V>0){if(he<L)return;he<B&&(B=he)}if(he=n-E,de||!(he>0)){if(he/=de,de<0){if(he<L)return;he<B&&(B=he)}else if(de>0){if(he>B)return;he>L&&(L=he)}if(he=o-E,de||!(he<0)){if(he/=de,de<0){if(he>B)return;he>L&&(L=he)}else if(de>0){if(he<L)return;he<B&&(B=he)}return!(L>0)&&!(B<1)||(L>0&&(e[0]=[_+L*V,E+L*de]),B<1&&(e[1]=[_+B*V,E+B*de])),!0}}}}}function AV(e,t,n,r,o){var c=e[1];if(c)return!0;var he,Ve,d=e[0],_=e.left,E=e.right,S=_[0],R=_[1],L=E[0],B=E[1],V=(S+L)/2;if(B===R){if(V<t||V>=r)return;if(S>L){if(d){if(d[1]>=o)return}else d=[V,n];c=[V,o]}else{if(d){if(d[1]<n)return}else d=[V,o];c=[V,n]}}else if(Ve=(R+B)/2-(he=(S-L)/(B-R))*V,he<-1||he>1)if(S>L){if(d){if(d[1]>=o)return}else d=[(n-Ve)/he,n];c=[(o-Ve)/he,o]}else{if(d){if(d[1]<n)return}else d=[(o-Ve)/he,o];c=[(n-Ve)/he,n]}else if(R<B){if(d){if(d[0]>=r)return}else d=[t,he*t+Ve];c=[r,he*r+Ve]}else{if(d){if(d[0]<t)return}else d=[r,he*r+Ve];c=[t,he*t+Ve]}return e[0]=d,e[1]=c,!0}function LV(e,t){var n=e.site,r=t.left,o=t.right;return n===o&&(o=r,r=n),o?Math.atan2(o[1]-r[1],o[0]-r[0]):(n===r?(r=t[1],o=t[0]):(r=t[0],o=t[1]),Math.atan2(r[0]-o[0],o[1]-r[1]))}function Q2(e,t){return t[+(t.left!==e.site)]}function OV(e,t){return t[+(t.left===e.site)]}var qC,eP=[];function FV(){Dw(this),this.x=this.y=this.arc=this.site=this.cy=null}function Vv(e){var t=e.P,n=e.N;if(t&&n){var r=t.site,o=e.site,c=n.site;if(r!==c){var d=o[0],_=o[1],E=r[0]-d,S=r[1]-_,R=c[0]-d,L=c[1]-_,B=2*(E*L-S*R);if(!(B>=-jV)){var V=E*E+S*S,de=R*R+L*L,he=(L*V-S*de)/B,Ve=(E*de-R*V)/B,Ae=eP.pop()||new FV;Ae.arc=e,Ae.site=o,Ae.x=he+d,Ae.y=(Ae.cy=Ve+_)+Math.sqrt(he*he+Ve*Ve),e.circle=Ae;for(var fe=null,Oe=z1._;Oe;)if(Ae.y<Oe.y||Ae.y===Oe.y&&Ae.x<=Oe.x){if(!Oe.L){fe=Oe.P;break}Oe=Oe.L}else{if(!Oe.R){fe=Oe;break}Oe=Oe.R}z1.insert(fe,Ae),fe||(qC=Ae)}}}}function jv(e){var t=e.circle;t&&(t.P||(qC=t.N),z1.remove(t),eP.push(t),Dw(t),e.circle=null)}var tP=[];function BV(){Dw(this),this.edge=this.site=this.circle=null}function nP(e){var t=tP.pop()||new BV;return t.site=e,t}function HC(e){jv(e),Gv.remove(e),tP.push(e),Dw(e)}function zV(e){var t=e.circle,n=t.x,r=t.cy,o=[n,r],c=e.P,d=e.N,_=[e];HC(e);for(var E=c;E.circle&&Math.abs(n-E.circle.x)<Du&&Math.abs(r-E.circle.cy)<Du;)c=E.P,_.unshift(E),HC(E),E=c;_.unshift(E),jv(E);for(var S=d;S.circle&&Math.abs(n-S.circle.x)<Du&&Math.abs(r-S.circle.cy)<Du;)d=S.N,_.push(S),HC(S),S=d;_.push(S),jv(S);var L,R=_.length;for(L=1;L<R;++L)Aw((S=_[L]).edge,(E=_[L-1]).site,S.site,o);(S=_[R-1]).edge=F1((E=_[0]).site,S.site,null,o),Vv(E),Vv(S)}function UV(e){for(var r,o,c,d,t=e[0],n=e[1],_=Gv._;_;)if((c=rP(_,n)-t)>Du)_=_.L;else{if(!((d=t-VV(_,n))>Du)){c>-Du?(r=_.P,o=_):d>-Du?(r=_,o=_.N):r=o=_;break}if(!_.R){r=_;break}_=_.R}!function RV(e){Af[e.index]={site:e,halfedges:[]}}(e);var E=nP(e);if(Gv.insert(r,E),r||o){if(r===o)return jv(r),o=nP(r.site),Gv.insert(E,o),E.edge=o.edge=F1(r.site,E.site),Vv(r),void Vv(o);if(!o)return void(E.edge=F1(r.site,E.site));jv(r),jv(o);var S=r.site,R=S[0],L=S[1],B=e[0]-R,V=e[1]-L,de=o.site,he=de[0]-R,Ve=de[1]-L,Ae=2*(B*Ve-V*he),fe=B*B+V*V,Oe=he*he+Ve*Ve,pt=[(Ve*fe-V*Oe)/Ae+R,(B*Oe-he*fe)/Ae+L];Aw(o.edge,S,de,pt),E.edge=F1(S,e,null,pt),o.edge=F1(e,de,null,pt),Vv(r),Vv(o)}}function rP(e,t){var n=e.site,r=n[0],o=n[1],c=o-t;if(!c)return r;var d=e.P;if(!d)return-1/0;var _=(n=d.site)[0],E=n[1],S=E-t;if(!S)return _;var R=_-r,L=1/c-1/S,B=R/S;return L?(-B+Math.sqrt(B*B-2*L*(R*R/(-2*S)-E+S/2+o-c/2)))/L+r:(r+_)/2}function VV(e,t){var n=e.N;if(n)return rP(n,t);var r=e.site;return r[1]===t?r[0]:1/0}var Gv,Af,z1,lh,Du=1e-6,jV=1e-12;function GV(e,t,n){return(e[0]-n[0])*(t[1]-e[1])-(e[0]-t[0])*(n[1]-e[1])}function $V(e,t){return t[1]-e[1]||t[0]-e[0]}function iP(e,t){var r,o,c,n=e.sort($V).pop();for(lh=[],Af=new Array(e.length),Gv=new J2,z1=new J2;;)if(c=qC,n&&(!c||n[1]<c.y||n[1]===c.y&&n[0]<c.x))(n[0]!==r||n[1]!==o)&&(UV(n),r=n[0],o=n[1]),n=e.pop();else{if(!c)break;zV(c.arc)}if(function NV(){for(var n,r,o,c,e=0,t=Af.length;e<t;++e)if((n=Af[e])&&(c=(r=n.halfedges).length)){var d=new Array(c),_=new Array(c);for(o=0;o<c;++o)d[o]=o,_[o]=LV(n,lh[r[o]]);for(d.sort(function(E,S){return _[S]-_[E]}),o=0;o<c;++o)_[o]=r[d[o]];for(o=0;o<c;++o)r[o]=_[o]}}(),t){var d=+t[0][0],_=+t[0][1],E=+t[1][0],S=+t[1][1];(function PV(e,t,n,r){for(var c,o=lh.length;o--;)AV(c=lh[o],e,t,n,r)&&DV(c,e,t,n,r)&&(Math.abs(c[0][0]-c[1][0])>Du||Math.abs(c[0][1]-c[1][1])>Du)||delete lh[o]})(d,_,E,S),function kV(e,t,n,r){var c,d,_,E,S,R,L,B,V,de,he,Ve,o=Af.length,Ae=!0;for(c=0;c<o;++c)if(d=Af[c]){for(_=d.site,E=(S=d.halfedges).length;E--;)lh[S[E]]||S.splice(E,1);for(E=0,R=S.length;E<R;)he=(de=OV(d,lh[S[E]]))[0],Ve=de[1],B=(L=Q2(d,lh[S[++E%R]]))[0],V=L[1],(Math.abs(he-B)>Du||Math.abs(Ve-V)>Du)&&(S.splice(E,0,lh.push(B1(_,de,Math.abs(he-e)<Du&&r-Ve>Du?[e,Math.abs(B-e)<Du?V:r]:Math.abs(Ve-r)<Du&&n-he>Du?[Math.abs(V-r)<Du?B:n,r]:Math.abs(he-n)<Du&&Ve-t>Du?[n,Math.abs(B-n)<Du?V:t]:Math.abs(Ve-t)<Du&&he-e>Du?[Math.abs(V-t)<Du?B:e,t]:null))-1),++R);R&&(Ae=!1)}if(Ae){var fe,Oe,pt,vt=1/0;for(c=0,Ae=null;c<o;++c)(d=Af[c])&&(pt=(fe=(_=d.site)[0]-e)*fe+(Oe=_[1]-t)*Oe)<vt&&(vt=pt,Ae=d);if(Ae){var Vt=[e,t],$t=[e,r],rn=[n,r],dt=[n,t];Ae.halfedges.push(lh.push(B1(_=Ae.site,Vt,$t))-1,lh.push(B1(_,$t,rn))-1,lh.push(B1(_,rn,dt))-1,lh.push(B1(_,dt,Vt))-1)}}for(c=0;c<o;++c)(d=Af[c])&&(d.halfedges.length||delete Af[c])}(d,_,E,S)}this.edges=lh,this.cells=Af,Gv=z1=lh=Af=null}function Ym(){return new Pw}function Pw(){this.reset()}iP.prototype={constructor:iP,polygons:function(){var e=this.edges;return this.cells.map(function(t){var n=t.halfedges.map(function(r){return Q2(t,e[r])});return n.data=t.site.data,n})},triangles:function(){var e=[],t=this.edges;return this.cells.forEach(function(n,r){if(_=(c=n.halfedges).length)for(var c,_,E,o=n.site,d=-1,S=t[c[_-1]],R=S.left===o?S.right:S.left;++d<_;)E=R,R=(S=t[c[d]]).left===o?S.right:S.left,E&&R&&r<E.index&&r<R.index&&GV(o,E,R)<0&&e.push([o.data,E.data,R.data])}),e},links:function(){return this.edges.filter(function(e){return e.right}).map(function(e){return{source:e.left.data,target:e.right.data}})},find:function(e,t,n){for(var o,_,r=this,c=r._found||0,d=r.cells.length;!(_=r.cells[c]);)if(++c>=d)return null;var E=e-_.site[0],S=t-_.site[1],R=E*E+S*S;do{_=r.cells[o=c],c=null,_.halfedges.forEach(function(L){var B=r.edges[L],V=B.left;if(V!==_.site&&V||(V=B.right)){var de=e-V[0],he=t-V[1],Ve=de*de+he*he;Ve<R&&(R=Ve,c=V.index)}})}while(null!==c);return r._found=o,null==n||R<=n*n?_.site:null}},ve(9855),ve(770),Pw.prototype={constructor:Pw,reset:function(){this.s=this.t=0},add:function(e){gP(Rw,e,this.t),gP(this,Rw.s,this.s),this.s?this.t+=Rw.t:this.s=Rw.t},valueOf:function(){return this.s}};var Rw=new Pw;function gP(e,t,n){var r=e.s=t+n,o=r-t;e.t=t-(r-o)+(n-o)}var qu=Math.PI,af=qu/2,$v=2*qu,vu=qu/180,U1=(Math,Math.atan),qv=Math.atan2,qs=Math.cos,es=(Math,Math,Math,Math,Math,Math.sin),Ng=(Math,Math.sqrt);Math;function Hv(e){return e>1?af:e<-1?-af:Math.asin(e)}function sS(e,t){return[e>qu?e-$v:e<-qu?e+$v:e,t]}function jP(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}Ym(),Ym(),Ym(),sS.invert=sS,function b8(e){1===e.length&&(e=function E8(e){return function(t,n){return jP(e(t),n)}}(e))}(jP),Math.sqrt(50),Math.sqrt(10),Math.sqrt(2);Ym();function SS(){}function pR(e){return function(t,n){var r=qs(t),o=qs(n),c=e(r*o);return[c*o*es(t),c*es(n)]}}function Y1(e){return function(t,n){var r=Ng(t*t+n*n),o=e(r),c=es(o),d=qs(o);return[qv(t*c,r*d),Hv(r&&n*c/r)]}}function TS(e,t){return[e,t]}Ym(),Ym(),Ym(),Ym(),function hR(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}(4.5),SS.prototype={constructor:SS,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},qs(30*vu),function fR(e){return function(t){var n=new SS;for(var r in e)n[r]=e[r];return n.stream=t,n}}({point:function(e,t){this.stream.point(e*vu,t*vu)}}),pR(function(e){return Ng(2/(1+e))}).invert=Y1(function(e){return 2*Hv(e/2)}),pR(function(e){return(e=function i8(e){return e>1?0:e<-1?qu:Math.acos(e)}(e))&&e/es(e)}).invert=Y1(function(e){return e}),TS.invert=TS,Y1(U1),Y1(Hv),Y1(function(e){return 2*U1(e)});var mj=ve(7489);const yj=[{path:"",redirectTo:"/welcome",pathMatch:"full"},{path:"welcome",component:(()=>{class e{constructor(n){this.router=n}navigateToMap(){this.router.navigate(["/map"])}}return e.\u0275fac=function(n){return new(n||e)(vi(Df))},e.\u0275cmp=un({type:e,selectors:[["app-welcome"]],decls:8,vars:0,consts:[[1,"container"],["alt","Luxoft Logo",1,"logo"],[3,"click"]],template:function(n,r){1&n&&(i_(0,"div",0),wv(1,"img",1),i_(2,"h1"),Mx(3,"Welcome to the Automotive ACU Demo"),xv(),i_(4,"p"),Mx(5,"Our system provides comprehensive assistance to make your driving experience safer and more convenient."),xv(),i_(6,"button",2),Sx("click",function(){return r.navigateToMap()}),Mx(7,"Proceed to Map"),xv()())},styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;font-family:Arial,sans-serif;background-color:#fff}h1[_ngcontent-%COMP%]{color:#0033a1;font-weight:600}p[_ngcontent-%COMP%]{color:#4d4d4d;max-width:600px;text-align:center}button[_ngcontent-%COMP%]{margin-top:20px;padding:10px 20px;background-color:#0033a1;color:#fff;border:none;border-radius:4px;cursor:pointer;transition:background-color .3s ease-in-out}button[_ngcontent-%COMP%]:hover{background-color:#0052cc}.logo[_ngcontent-%COMP%]{width:200px;margin-bottom:20px;content:url(luxoft-logo.09c0bc132ec83275.png)}"]}),e})()},{path:"map",component:(()=>{class e{constructor(){this.currentStepIndex=0,this.currentStepGeometryIndex=0,this.numDeltas=100,this.i=0,this.accessToken=M5_mapbox_accessToken,this.timeouts=[],this.startPoint=[],this.endPoint=[],this.animationReferences=[],this.recommendationCounter=0,this.prevoiusCoord=[]}ngOnInit(){this.map=new Lg.Map({accessToken:this.accessToken,container:"map",style:"mapbox://styles/mapbox/streets-v12",center:[31.233334,30.033333],zoom:12}),this.map.addControl(new Lg.NavigationControl({visualizePitch:!0}),"top-left");var n=new qA({accessToken:this.accessToken,mapboxgl:Lg,placeholder:"From: "}).on("result",c=>{this.startPoint=c.result.geometry.coordinates,null!=this.startPoint&&0!=this.startPoint.length&&null!=this.endPoint&&0!=this.endPoint.length&&this.getRoute(this.startPoint,this.endPoint)});this.map.addControl(n,"top-left");var r=new qA({accessToken:this.accessToken,mapboxgl:Lg,placeholder:"To: "}).on("result",c=>{this.endPoint=c.result.geometry.coordinates,null!=this.startPoint&&0!=this.startPoint.length&&null!=this.endPoint&&0!=this.endPoint.length&&this.getRoute(this.startPoint,this.endPoint)});this.map.addControl(r,"top-left"),new Lg.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0}).on("geolocate",c=>{console.log(Object.prototype.toString.call(c)+" "+c.coords.longitude+" "+c.coords.latitude)}),this.map.addControl(new Lg.ScaleControl,"bottom-right")}getRoute(n,r){var o=this;return function T5(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var c=e.apply(t,n);function d(E){$A(c,r,o,d,_,"next",E)}function _(E){$A(c,r,o,d,_,"throw",E)}d(void 0)})}}(function*(){o.mapClear(),yield fetch(`https://api.mapbox.com/directions/v5/mapbox/driving/${n[0]},${n[1]};${r[0]},${r[1]}?steps=true&geometries=geojson&annotations=distance,speed,duration&overview=full&continue_straight=false&notifications=none&roundabout_exits=false&access_token=${o.accessToken}`,{method:"GET"}).then(d=>d.json()).then(d=>{const E=(d=d.routes[0]).legs[0].annotation.speed;o.addRoute(d.geometry.coordinates,"route","#3887be");const S=d.legs[0].steps;let R=0;S.forEach(de=>{R+=de.geometry.coordinates.length}),console.log(R),o.interpolateCoordinates(S),R=0,S.forEach(de=>{R+=de.geometry.coordinates.length}),console.log(R);let L=d.geometry.coordinates;L=S.flatMap(de=>de.geometry.coordinates),o.settingMarker(L[0]),o.settingTrafficLightMarker(L[150]),o.map.zoomIn();var V=requestAnimationFrame(()=>{o.animateMarker2(S,E,1)});o.animationReferences.push(V)})})()}recommendationSystem(n,r,o){const c=n.maneuver.instruction;return 0==o?"traffic light":o>70?"reaching max speed":r>o?`Slow speed down ..., ${c}`:r<o?`Speed  up ..., ${c}`:c}animateMarker2(n,r,o){let c=0,d=0,_=[];const E=()=>{if(c<n.length){const S=n[c].geometry.coordinates;if(this.marker.setLngLat(S[d]),this.map.jumpTo({center:[S[d][0],S[d][1]]}),d++,d===S.length&&(c++,d=0),c<n.length){const B=n[c].distance/1e3/(n[c].duration/3600),V=this.extractArcs(n[c]?.maneuver.modifier,["right","left"]);let de=this.getCurrSpeed(B,o,n[c].maneuver.type,d),he=0==_.length?0:_[_.length-1];0==d&&_.push(de);const Ve=this.recommendationSystem(n[c],he,de),Ae=this.getIconClass(de,V);this.popup.setHTML(`<div><span class="direction-guide-text">${Ve}</span> \n              <i class="${Ae}" style='font-size:32px'></i>\n              </div> <div class="centered-speed colored-speed">${Number.isNaN(de)?0:de} km/h </div>`),o++;const fe=this.getTimeout(de);let Oe=setTimeout(E,fe);this.timeouts.push(Oe)}}};E()}getCurrSpeed(n,r,o,c){let d=this.getApproximatedSpeed(n),_=this.getSpeedforTrafficLight(d,r);return this.speedAdjustmentforManeuver(_,o,c)}speedAdjustmentforManeuver(n,r,o){return("roundabout"===r||"rotary"===r)&&o<=18?Math.floor(.7*n):n}getSpeedforTrafficLight(n,r){return r+5==150?Math.floor(.8*n):r+4==150?Math.floor(.6*n):r+3==150?Math.floor(.5*n):r+2==150?Math.floor(.4*n):r+1==150?Math.floor(.2*n):150==r?0:n}getTimeout(n){return 0==n?4e3:n>0&&n<=50?2e3/n:n>50?3e3/n:5e3/n}getApproximatedSpeed(n){return n>0&&n<=10?8:n>10&&n<=15?12:n>15&&n<=20?17:n>20&&n<=25?23:n>25&&n<=30?27:n>30&&n<=50?42:n>50&&n<=70?64:n>70?80:n}getIconClass(n,r){return n>70?"fas fa-tachometer-alt":0==n?"fas fa-traffic-light":`direction-guide-icon fas fa-arrow-${r}`}settingMarker(n){const r=[n[0],n[1]],o=document.createElement("div");o.className="marker",this.popup=new Lg.Popup({closeButton:!1,closeOnClick:!1,offset:25,focusAfterOpen:!1}).setText("0 km/h"),this.marker=new Lg.Marker(o).setLngLat(r).setPopup(this.popup).addTo(this.map),this.marker.togglePopup()}settingTrafficLightMarker(n){const r=[n[0],n[1]],o=document.createElement("div");o.className="traffic-light",this.trafficLightMarker=new Lg.Marker(o).setLngLat(r).addTo(this.map)}mapClear(){null!=this.marker&&this.marker.remove(),null!=this.trafficLightMarker&&this.trafficLightMarker.remove(),this.clearAnimations(),this.map.getSource("route")&&(this.map.removeLayer("route"),this.map.removeSource("route"))}clearAnimations(){for(const n of this.timeouts)clearTimeout(n);for(const n of this.animationReferences)cancelAnimationFrame(n)}addRoute(n,r,o){this.map.getSource(r)?this.map.getSource(r).setData(n):this.map.addLayer({id:r,type:"line",source:{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:n}}},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":o,"line-width":8,"line-opacity":.8}})}extractArcs(n,r){if(!n)return null;var o="",c=0;for(const d of r){const _=n.indexOf(d);if(-1!==_&&(o=n.slice(_,_+d.length),1==++c)||1===c)break}return o}interpolateCoordinates(n){n.forEach(r=>{let o=0,c=r.geometry.coordinates,d=(0,mj.cloneDeep)(c);for(let E=0;E<c.length-1;E++){let S=c[E],R=c[E+1],L=J5(S,R),B=Math.floor(50*L);for(let V=1;V<B;V++){let de=V/B;d.splice(E+o+1,0,[S[0]+(R[0]-S[0])*de,S[1]+(R[1]-S[1])*de]),o++}}r.geometry.coordinates=d})}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=un({type:e,selectors:[["app-map"]],decls:1,vars:0,consts:[["id","map"]],template:function(n,r){1&n&&wv(0,"div",0)},styles:["body[_ngcontent-%COMP%]{margin:0;padding:0}#map[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:100%}#instructions[_ngcontent-%COMP%]{position:absolute;margin:10px;width:20%;top:0;bottom:75%;padding:10px;background-color:#fff;font-family:sans-serif;right:1%}"]}),e})()}];let _j=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=qi({type:e}),e.\u0275inj=Ku({imports:[jA.forRoot(yj),jA]}),e})(),vj=(()=>{class e{constructor(){this.title="map-app"}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=un({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(n,r){1&n&&wv(0,"router-outlet")},dependencies:[oC]}),e})(),xj=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=qi({type:e,bootstrap:[vj]}),e.\u0275inj=Ku({imports:[VB,_j]}),e})();zB().bootstrapModule(xj).catch(e=>console.error(e))},1503:(Dt,ot,ve)=>{"use strict";var q=ve(3269);function Ee(p){var J=[1/0,1/0,-1/0,-1/0];return q.coordEach(p,function(ye){J[0]>ye[0]&&(J[0]=ye[0]),J[1]>ye[1]&&(J[1]=ye[1]),J[2]<ye[0]&&(J[2]=ye[0]),J[3]<ye[1]&&(J[3]=ye[1])}),J}Ee.default=Ee,ot.Z=Ee},8275:(Dt,ot)=>{"use strict";function ve(He,it,Ne){void 0===Ne&&(Ne={});var sn={type:"Feature"};return(0===Ne.id||Ne.id)&&(sn.id=Ne.id),Ne.bbox&&(sn.bbox=Ne.bbox),sn.properties=it||{},sn.geometry=He,sn}function q(He,it,Ne){if(void 0===Ne&&(Ne={}),!He)throw new Error("coordinates is required");if(!Array.isArray(He))throw new Error("coordinates must be an Array");if(He.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!te(He[0])||!te(He[1]))throw new Error("coordinates must contain numbers");return ve({type:"Point",coordinates:He},it,Ne)}function p(He,it,Ne){void 0===Ne&&(Ne={});for(var sn=0,Bt=He;sn<Bt.length;sn++){var Le=Bt[sn];if(Le.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var bt=0;bt<Le[Le.length-1].length;bt++)if(Le[Le.length-1][bt]!==Le[0][bt])throw new Error("First and last Position are not equivalent.")}return ve({type:"Polygon",coordinates:He},it,Ne)}function ye(He,it,Ne){if(void 0===Ne&&(Ne={}),He.length<2)throw new Error("coordinates must be an array of two or more positions");return ve({type:"LineString",coordinates:He},it,Ne)}function Pe(He,it){void 0===it&&(it={});var Ne={type:"FeatureCollection"};return it.id&&(Ne.id=it.id),it.bbox&&(Ne.bbox=it.bbox),Ne.features=He,Ne}function qe(He,it,Ne){return void 0===Ne&&(Ne={}),ve({type:"MultiLineString",coordinates:He},it,Ne)}function It(He,it,Ne){return void 0===Ne&&(Ne={}),ve({type:"MultiPoint",coordinates:He},it,Ne)}function gt(He,it,Ne){return void 0===Ne&&(Ne={}),ve({type:"MultiPolygon",coordinates:He},it,Ne)}function Mt(He,it){void 0===it&&(it="kilometers");var Ne=ot.factors[it];if(!Ne)throw new Error(it+" units is invalid");return He*Ne}function le(He,it){void 0===it&&(it="kilometers");var Ne=ot.factors[it];if(!Ne)throw new Error(it+" units is invalid");return He/Ne}function ce(He){return He%(2*Math.PI)*180/Math.PI}function te(He){return!isNaN(He)&&null!==He&&!Array.isArray(He)}Object.defineProperty(ot,"__esModule",{value:!0}),ot.earthRadius=6371008.8,ot.factors={centimeters:100*ot.earthRadius,centimetres:100*ot.earthRadius,degrees:ot.earthRadius/111325,feet:3.28084*ot.earthRadius,inches:39.37*ot.earthRadius,kilometers:ot.earthRadius/1e3,kilometres:ot.earthRadius/1e3,meters:ot.earthRadius,metres:ot.earthRadius,miles:ot.earthRadius/1609.344,millimeters:1e3*ot.earthRadius,millimetres:1e3*ot.earthRadius,nauticalmiles:ot.earthRadius/1852,radians:1,yards:1.0936*ot.earthRadius},ot.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/ot.earthRadius,yards:1.0936133},ot.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},ot.feature=ve,ot.geometry=function me(He,it,Ne){switch(void 0===Ne&&(Ne={}),He){case"Point":return q(it).geometry;case"LineString":return ye(it).geometry;case"Polygon":return p(it).geometry;case"MultiPoint":return It(it).geometry;case"MultiLineString":return qe(it).geometry;case"MultiPolygon":return gt(it).geometry;default:throw new Error(He+" is invalid")}},ot.point=q,ot.points=function Ee(He,it,Ne){return void 0===Ne&&(Ne={}),Pe(He.map(function(sn){return q(sn,it)}),Ne)},ot.polygon=p,ot.polygons=function J(He,it,Ne){return void 0===Ne&&(Ne={}),Pe(He.map(function(sn){return p(sn,it)}),Ne)},ot.lineString=ye,ot.lineStrings=function Ce(He,it,Ne){return void 0===Ne&&(Ne={}),Pe(He.map(function(sn){return ye(sn,it)}),Ne)},ot.featureCollection=Pe,ot.multiLineString=qe,ot.multiPoint=It,ot.multiPolygon=gt,ot.geometryCollection=function st(He,it,Ne){return void 0===Ne&&(Ne={}),ve({type:"GeometryCollection",geometries:He},it,Ne)},ot.round=function mt(He,it){if(void 0===it&&(it=0),it&&!(it>=0))throw new Error("precision must be a positive number");var Ne=Math.pow(10,it||0);return Math.round(He*Ne)/Ne},ot.radiansToLength=Mt,ot.lengthToRadians=le,ot.lengthToDegrees=function K(He,it){return ce(le(He,it))},ot.bearingToAzimuth=function ne(He){var it=He%360;return it<0&&(it+=360),it},ot.radiansToDegrees=ce,ot.degreesToRadians=function ee(He){return He%360*Math.PI/180},ot.convertLength=function ae(He,it,Ne){if(void 0===it&&(it="kilometers"),void 0===Ne&&(Ne="kilometers"),!(He>=0))throw new Error("length must be a positive number");return Mt(le(He,it),Ne)},ot.convertArea=function oe(He,it,Ne){if(void 0===it&&(it="meters"),void 0===Ne&&(Ne="kilometers"),!(He>=0))throw new Error("area must be a positive number");var sn=ot.areaFactors[it];if(!sn)throw new Error("invalid original units");var Bt=ot.areaFactors[Ne];if(!Bt)throw new Error("invalid final units");return He/sn*Bt},ot.isNumber=te,ot.isObject=function _e(He){return!!He&&He.constructor===Object},ot.validateBBox=function re(He){if(!He)throw new Error("bbox is required");if(!Array.isArray(He))throw new Error("bbox must be an Array");if(4!==He.length&&6!==He.length)throw new Error("bbox must be an Array of 4 or 6 numbers");He.forEach(function(it){if(!te(it))throw new Error("bbox must only contain numbers")})},ot.validateId=function Je(He){if(!He)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof He))throw new Error("id must be a number or a string")}},3269:(Dt,ot,ve)=>{"use strict";Object.defineProperty(ot,"__esModule",{value:!0});var me=ve(8275);function q(ee,ae,oe){if(null!==ee)for(var te,_e,re,Je,He,it,Ne,Le,sn=0,Bt=0,bt=ee.type,Ue="FeatureCollection"===bt,ft="Feature"===bt,Tt=Ue?ee.features.length:1,Be=0;Be<Tt;Be++){He=(Le=!!(Ne=Ue?ee.features[Be].geometry:ft?ee.geometry:ee)&&"GeometryCollection"===Ne.type)?Ne.geometries.length:1;for(var Xt=0;Xt<He;Xt++){var Jt=0,Rn=0;if(null!==(Je=Le?Ne.geometries[Xt]:Ne)){it=Je.coordinates;var zt=Je.type;switch(sn=!oe||"Polygon"!==zt&&"MultiPolygon"!==zt?0:1,zt){case null:break;case"Point":if(!1===ae(it,Bt,Be,Jt,Rn))return!1;Bt++,Jt++;break;case"LineString":case"MultiPoint":for(te=0;te<it.length;te++){if(!1===ae(it[te],Bt,Be,Jt,Rn))return!1;Bt++,"MultiPoint"===zt&&Jt++}"LineString"===zt&&Jt++;break;case"Polygon":case"MultiLineString":for(te=0;te<it.length;te++){for(_e=0;_e<it[te].length-sn;_e++){if(!1===ae(it[te][_e],Bt,Be,Jt,Rn))return!1;Bt++}"MultiLineString"===zt&&Jt++,"Polygon"===zt&&Rn++}"Polygon"===zt&&Jt++;break;case"MultiPolygon":for(te=0;te<it.length;te++){for(Rn=0,_e=0;_e<it[te].length;_e++){for(re=0;re<it[te][_e].length-sn;re++){if(!1===ae(it[te][_e][re],Bt,Be,Jt,Rn))return!1;Bt++}Rn++}Jt++}break;case"GeometryCollection":for(te=0;te<Je.geometries.length;te++)if(!1===q(Je.geometries[te],ae,oe))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function p(ee,ae){var oe;switch(ee.type){case"FeatureCollection":for(oe=0;oe<ee.features.length&&!1!==ae(ee.features[oe].properties,oe);oe++);break;case"Feature":ae(ee.properties,0)}}function ye(ee,ae){if("Feature"===ee.type)ae(ee,0);else if("FeatureCollection"===ee.type)for(var oe=0;oe<ee.features.length&&!1!==ae(ee.features[oe],oe);oe++);}function qe(ee,ae){var oe,te,_e,re,Je,He,it,Ne,sn,Bt,Le=0,bt="FeatureCollection"===ee.type,Ue="Feature"===ee.type,ft=bt?ee.features.length:1;for(oe=0;oe<ft;oe++){for(Ne=bt?ee.features[oe].properties:Ue?ee.properties:{},sn=bt?ee.features[oe].bbox:Ue?ee.bbox:void 0,Bt=bt?ee.features[oe].id:Ue?ee.id:void 0,Je=(it=!!(He=bt?ee.features[oe].geometry:Ue?ee.geometry:ee)&&"GeometryCollection"===He.type)?He.geometries.length:1,_e=0;_e<Je;_e++)if(null!==(re=it?He.geometries[_e]:He))switch(re.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===ae(re,Le,Ne,sn,Bt))return!1;break;case"GeometryCollection":for(te=0;te<re.geometries.length;te++)if(!1===ae(re.geometries[te],Le,Ne,sn,Bt))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===ae(null,Le,Ne,sn,Bt))return!1;Le++}}function gt(ee,ae){qe(ee,function(oe,te,_e,re,Je){var it,He=null===oe?null:oe.type;switch(He){case null:case"Point":case"LineString":case"Polygon":return!1!==ae(me.feature(oe,_e,{bbox:re,id:Je}),te,0)&&void 0}switch(He){case"MultiPoint":it="Point";break;case"MultiLineString":it="LineString";break;case"MultiPolygon":it="Polygon"}for(var Ne=0;Ne<oe.coordinates.length;Ne++)if(!1===ae(me.feature({type:it,coordinates:oe.coordinates[Ne]},_e),te,Ne))return!1})}function mt(ee,ae){gt(ee,function(oe,te,_e){var re=0;if(oe.geometry){var Je=oe.geometry.type;if("Point"!==Je&&"MultiPoint"!==Je){var He,it=0,Ne=0,sn=0;if(!1===q(oe,function(Bt,Le,bt,Ue,ft){if(void 0===He||te>it||Ue>Ne||ft>sn)return He=Bt,it=te,Ne=Ue,sn=ft,void(re=0);var Tt=me.lineString([He,Bt],oe.properties);if(!1===ae(Tt,te,_e,ft,re))return!1;re++,He=Bt}))return!1}}})}function le(ee,ae){if(!ee)throw new Error("geojson is required");gt(ee,function(oe,te,_e){if(null!==oe.geometry){var Je=oe.geometry.coordinates;switch(oe.geometry.type){case"LineString":if(!1===ae(oe,te,_e,0,0))return!1;break;case"Polygon":for(var He=0;He<Je.length;He++)if(!1===ae(me.lineString(Je[He],oe.properties),te,_e,He))return!1}}})}ot.coordAll=function Pe(ee){var ae=[];return q(ee,function(oe){ae.push(oe)}),ae},ot.coordEach=q,ot.coordReduce=function Ee(ee,ae,oe,te){var _e=oe;return q(ee,function(re,Je,He,it,Ne){_e=0===Je&&void 0===oe?re:ae(_e,re,Je,He,it,Ne)},te),_e},ot.featureEach=ye,ot.featureReduce=function Ce(ee,ae,oe){var te=oe;return ye(ee,function(_e,re){te=0===re&&void 0===oe?_e:ae(te,_e,re)}),te},ot.findPoint=function ce(ee,ae){if(!me.isObject(ae=ae||{}))throw new Error("options is invalid");var He,oe=ae.featureIndex||0,te=ae.multiFeatureIndex||0,_e=ae.geometryIndex||0,re=ae.coordIndex||0,Je=ae.properties;switch(ee.type){case"FeatureCollection":oe<0&&(oe=ee.features.length+oe),Je=Je||ee.features[oe].properties,He=ee.features[oe].geometry;break;case"Feature":Je=Je||ee.properties,He=ee.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":He=ee;break;default:throw new Error("geojson is invalid")}if(null===He)return null;var it=He.coordinates;switch(He.type){case"Point":return me.point(it,Je,ae);case"MultiPoint":return te<0&&(te=it.length+te),me.point(it[te],Je,ae);case"LineString":return re<0&&(re=it.length+re),me.point(it[re],Je,ae);case"Polygon":return _e<0&&(_e=it.length+_e),re<0&&(re=it[_e].length+re),me.point(it[_e][re],Je,ae);case"MultiLineString":return te<0&&(te=it.length+te),re<0&&(re=it[te].length+re),me.point(it[te][re],Je,ae);case"MultiPolygon":return te<0&&(te=it.length+te),_e<0&&(_e=it[te].length+_e),re<0&&(re=it[te][_e].length-re),me.point(it[te][_e][re],Je,ae)}throw new Error("geojson is invalid")},ot.findSegment=function ne(ee,ae){if(!me.isObject(ae=ae||{}))throw new Error("options is invalid");var He,oe=ae.featureIndex||0,te=ae.multiFeatureIndex||0,_e=ae.geometryIndex||0,re=ae.segmentIndex||0,Je=ae.properties;switch(ee.type){case"FeatureCollection":oe<0&&(oe=ee.features.length+oe),Je=Je||ee.features[oe].properties,He=ee.features[oe].geometry;break;case"Feature":Je=Je||ee.properties,He=ee.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":He=ee;break;default:throw new Error("geojson is invalid")}if(null===He)return null;var it=He.coordinates;switch(He.type){case"Point":case"MultiPoint":return null;case"LineString":return re<0&&(re=it.length+re-1),me.lineString([it[re],it[re+1]],Je,ae);case"Polygon":return _e<0&&(_e=it.length+_e),re<0&&(re=it[_e].length+re-1),me.lineString([it[_e][re],it[_e][re+1]],Je,ae);case"MultiLineString":return te<0&&(te=it.length+te),re<0&&(re=it[te].length+re-1),me.lineString([it[te][re],it[te][re+1]],Je,ae);case"MultiPolygon":return te<0&&(te=it.length+te),_e<0&&(_e=it[te].length+_e),re<0&&(re=it[te][_e].length-re-1),me.lineString([it[te][_e][re],it[te][_e][re+1]],Je,ae)}throw new Error("geojson is invalid")},ot.flattenEach=gt,ot.flattenReduce=function st(ee,ae,oe){var te=oe;return gt(ee,function(_e,re,Je){te=0===re&&0===Je&&void 0===oe?_e:ae(te,_e,re,Je)}),te},ot.geomEach=qe,ot.geomReduce=function It(ee,ae,oe){var te=oe;return qe(ee,function(_e,re,Je,He,it){te=0===re&&void 0===oe?_e:ae(te,_e,re,Je,He,it)}),te},ot.lineEach=le,ot.lineReduce=function K(ee,ae,oe){var te=oe;return le(ee,function(_e,re,Je,He){te=0===re&&void 0===oe?_e:ae(te,_e,re,Je,He)}),te},ot.propEach=p,ot.propReduce=function J(ee,ae,oe){var te=oe;return p(ee,function(_e,re){te=0===re&&void 0===oe?_e:ae(te,_e,re)}),te},ot.segmentEach=mt,ot.segmentReduce=function Mt(ee,ae,oe){var te=oe,_e=!1;return mt(ee,function(re,Je,He,it,Ne){te=!1===_e&&void 0===oe?re:ae(te,re,Je,He,it,Ne),_e=!0}),te}},2049:function(Dt,ot,ve){var me;Dt=ve.nmd(Dt),function(q){"object"==typeof global&&global;var ye=function(Mt){this.message=Mt};(ye.prototype=new Error).name="InvalidCharacterError";var Ce=function(Mt){throw new ye(Mt)},Pe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",qe=/[\t\n\f\r ]/g,st={encode:function(Mt){Mt=String(Mt),/[^\0-\xFF]/.test(Mt)&&Ce("The string to be encoded contains characters outside of the Latin1 range.");for(var ce,ee,ae,te,le=Mt.length%3,K="",ne=-1,_e=Mt.length-le;++ne<_e;)ce=Mt.charCodeAt(ne)<<16,ee=Mt.charCodeAt(++ne)<<8,ae=Mt.charCodeAt(++ne),K+=Pe.charAt((te=ce+ee+ae)>>18&63)+Pe.charAt(te>>12&63)+Pe.charAt(te>>6&63)+Pe.charAt(63&te);return 2==le?(ce=Mt.charCodeAt(ne)<<8,ee=Mt.charCodeAt(++ne),K+=Pe.charAt((te=ce+ee)>>10)+Pe.charAt(te>>4&63)+Pe.charAt(te<<2&63)+"="):1==le&&(te=Mt.charCodeAt(ne),K+=Pe.charAt(te>>2)+Pe.charAt(te<<4&63)+"=="),K},decode:function(Mt){var le=(Mt=String(Mt).replace(qe,"")).length;le%4==0&&(le=(Mt=Mt.replace(/==?$/,"")).length),(le%4==1||/[^+a-zA-Z0-9/]/.test(Mt))&&Ce("Invalid character: the string to be decoded is not correctly encoded.");for(var ne,ce,K=0,ee="",ae=-1;++ae<le;)ce=Pe.indexOf(Mt.charAt(ae)),ne=K%4?64*ne+ce:ce,K++%4&&(ee+=String.fromCharCode(255&ne>>(-2*K&6)));return ee},version:"0.1.0"};void 0!==(me=function(){return st}.call(ot,ve,ot,Dt))&&(Dt.exports=me)}()},5834:(Dt,ot,ve)=>{"use strict";var me=ve(5203),q=ve(5685),Ee=q(me("String.prototype.indexOf"));Dt.exports=function(J,ye){var Ce=me(J,!!ye);return"function"==typeof Ce&&Ee(J,".prototype.")>-1?q(Ce):Ce}},5685:(Dt,ot,ve)=>{"use strict";var me=ve(4444),q=ve(5203),Ee=q("%Function.prototype.apply%"),p=q("%Function.prototype.call%"),J=q("%Reflect.apply%",!0)||me.call(p,Ee),ye=q("%Object.getOwnPropertyDescriptor%",!0),Ce=q("%Object.defineProperty%",!0),Pe=q("%Math.max%");if(Ce)try{Ce({},"a",{value:1})}catch{Ce=null}Dt.exports=function(gt){var st=J(me,p,arguments);return ye&&Ce&&ye(st,"length").configurable&&Ce(st,"length",{value:1+Pe(0,gt.length-(arguments.length-1))}),st};var qe=function(){return J(me,Ee,arguments)};Ce?Ce(Dt.exports,"apply",{value:qe}):Dt.exports.apply=qe},1335:(Dt,ot,ve)=>{"use strict";var me=ve(3156),q=ve(7253),Ee=ve(3870),p=ve(7563).orient2d;function J(oe,te,_e){te=Math.max(0,void 0===te?2:te),_e=_e||0;var re=function Mt(oe){for(var te=oe[0],_e=oe[0],re=oe[0],Je=oe[0],He=0;He<oe.length;He++){var it=oe[He];it[0]<te[0]&&(te=it),it[0]>re[0]&&(re=it),it[1]<_e[1]&&(_e=it),it[1]>Je[1]&&(Je=it)}var Ne=[te,_e,re,Je],sn=Ne.slice();for(He=0;He<oe.length;He++)Ee(oe[He],Ne)||sn.push(oe[He]);return function ae(oe){oe.sort(ee);for(var te=[],_e=0;_e<oe.length;_e++){for(;te.length>=2&&gt(te[te.length-2],te[te.length-1],oe[_e])<=0;)te.pop();te.push(oe[_e])}for(var re=[],Je=oe.length-1;Je>=0;Je--){for(;re.length>=2&&gt(re[re.length-2],re[re.length-1],oe[Je])<=0;)re.pop();re.push(oe[Je])}return re.pop(),te.pop(),te.concat(re)}(sn)}(oe),Je=new me(16);Je.toBBox=function(Rn){return{minX:Rn[0],minY:Rn[1],maxX:Rn[0],maxY:Rn[1]}},Je.compareMinX=function(Rn,zt){return Rn[0]-zt[0]},Je.compareMinY=function(Rn,zt){return Rn[1]-zt[1]},Je.load(oe);for(var Ne,He=[],it=0;it<re.length;it++){var sn=re[it];Je.remove(sn),Ne=le(sn,Ne),He.push(Ne)}var Bt=new me(16);for(it=0;it<He.length;it++)Bt.insert(mt(He[it]));for(var Le=te*te,bt=_e*_e;He.length;){var Ue=He.shift(),ft=Ue.p,Tt=Ue.next.p,Be=K(ft,Tt);if(!(Be<bt)){var Xt=Be/Le;(sn=ye(Je,Ue.prev.p,ft,Tt,Ue.next.next.p,Xt,Bt))&&Math.min(K(sn,ft),K(sn,Tt))<=Xt&&(He.push(Ue),He.push(le(sn,Ue)),Je.remove(sn),Bt.remove(Ue),Bt.insert(mt(Ue)),Bt.insert(mt(Ue.next)))}}Ue=Ne;var Jt=[];do{Jt.push(Ue.p),Ue=Ue.next}while(Ue!==Ne);return Jt.push(Ue.p),Jt}function ye(oe,te,_e,re,Je,He,it){for(var Ne=new q([],Ce),sn=oe.data;sn;){for(var Bt=0;Bt<sn.children.length;Bt++){var Le=sn.children[Bt],bt=sn.leaf?ne(Le,_e,re):Pe(_e,re,Le);bt>He||Ne.push({node:Le,dist:bt})}for(;Ne.length&&!Ne.peek().node.children;){var Ue=Ne.pop(),ft=Ue.node,Tt=ne(ft,te,_e),Be=ne(ft,re,Je);if(Ue.dist<Tt&&Ue.dist<Be&&It(_e,ft,it)&&It(re,ft,it))return ft}(sn=Ne.pop())&&(sn=sn.node)}return null}function Ce(oe,te){return oe.dist-te.dist}function Pe(oe,te,_e){if(qe(oe,_e)||qe(te,_e))return 0;var re=ce(oe[0],oe[1],te[0],te[1],_e.minX,_e.minY,_e.maxX,_e.minY);if(0===re)return 0;var Je=ce(oe[0],oe[1],te[0],te[1],_e.minX,_e.minY,_e.minX,_e.maxY);if(0===Je)return 0;var He=ce(oe[0],oe[1],te[0],te[1],_e.maxX,_e.minY,_e.maxX,_e.maxY);if(0===He)return 0;var it=ce(oe[0],oe[1],te[0],te[1],_e.minX,_e.maxY,_e.maxX,_e.maxY);return 0===it?0:Math.min(re,Je,He,it)}function qe(oe,te){return oe[0]>=te.minX&&oe[0]<=te.maxX&&oe[1]>=te.minY&&oe[1]<=te.maxY}function It(oe,te,_e){for(var re=Math.min(oe[0],te[0]),Je=Math.min(oe[1],te[1]),He=Math.max(oe[0],te[0]),it=Math.max(oe[1],te[1]),Ne=_e.search({minX:re,minY:Je,maxX:He,maxY:it}),sn=0;sn<Ne.length;sn++)if(st(Ne[sn].p,Ne[sn].next.p,oe,te))return!1;return!0}function gt(oe,te,_e){return p(oe[0],oe[1],te[0],te[1],_e[0],_e[1])}function st(oe,te,_e,re){return oe!==re&&te!==_e&&gt(oe,te,_e)>0!=gt(oe,te,re)>0&&gt(_e,re,oe)>0!=gt(_e,re,te)>0}function mt(oe){var te=oe.p,_e=oe.next.p;return oe.minX=Math.min(te[0],_e[0]),oe.minY=Math.min(te[1],_e[1]),oe.maxX=Math.max(te[0],_e[0]),oe.maxY=Math.max(te[1],_e[1]),oe}function le(oe,te){var _e={p:oe,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return te?(_e.next=te.next,_e.prev=te,te.next.prev=_e,te.next=_e):(_e.prev=_e,_e.next=_e),_e}function K(oe,te){var _e=oe[0]-te[0],re=oe[1]-te[1];return _e*_e+re*re}function ne(oe,te,_e){var re=te[0],Je=te[1],He=_e[0]-re,it=_e[1]-Je;if(0!==He||0!==it){var Ne=((oe[0]-re)*He+(oe[1]-Je)*it)/(He*He+it*it);Ne>1?(re=_e[0],Je=_e[1]):Ne>0&&(re+=He*Ne,Je+=it*Ne)}return(He=oe[0]-re)*He+(it=oe[1]-Je)*it}function ce(oe,te,_e,re,Je,He,it,Ne){var Jn,Mn,jn,xn,sn=_e-oe,Bt=re-te,Le=it-Je,bt=Ne-He,Ue=oe-Je,ft=te-He,Tt=sn*sn+Bt*Bt,Be=sn*Le+Bt*bt,Xt=Le*Le+bt*bt,Jt=sn*Ue+Bt*ft,Rn=Le*Ue+bt*ft,zt=Tt*Xt-Be*Be,Nn=zt,wn=zt;0===zt?(Mn=0,Nn=1,xn=Rn,wn=Xt):(xn=Tt*Rn-Be*Jt,(Mn=Be*Rn-Xt*Jt)<0?(Mn=0,xn=Rn,wn=Xt):Mn>Nn&&(Mn=Nn,xn=Rn+Be,wn=Xt)),xn<0?(xn=0,-Jt<0?Mn=0:-Jt>Tt?Mn=Nn:(Mn=-Jt,Nn=Tt)):xn>wn&&(xn=wn,-Jt+Be<0?Mn=0:-Jt+Be>Tt?Mn=Nn:(Mn=-Jt+Be,Nn=Tt));var mr=(1-(jn=0===xn?0:xn/wn))*Je+jn*it-((1-(Jn=0===Mn?0:Mn/Nn))*oe+Jn*_e),Pt=(1-jn)*He+jn*Ne-((1-Jn)*te+Jn*re);return mr*mr+Pt*Pt}function ee(oe,te){return oe[0]===te[0]?oe[1]-te[1]:oe[0]-te[0]}q.default&&(q=q.default),Dt.exports=J,Dt.exports.default=J},3156:function(Dt){Dt.exports=function(){"use strict";function ot(le,K,ne,ce,ee){!function ae(oe,te,_e,re,Je){for(;re>_e;){if(re-_e>600){var He=re-_e+1,it=te-_e+1,Ne=Math.log(He),sn=.5*Math.exp(2*Ne/3),Bt=.5*Math.sqrt(Ne*sn*(He-sn)/He)*(it-He/2<0?-1:1);ae(oe,te,Math.max(_e,Math.floor(te-it*sn/He+Bt)),Math.min(re,Math.floor(te+(He-it)*sn/He+Bt)),Je)}var Ue=oe[te],ft=_e,Tt=re;for(ve(oe,_e,te),Je(oe[re],Ue)>0&&ve(oe,_e,re);ft<Tt;){for(ve(oe,ft,Tt),ft++,Tt--;Je(oe[ft],Ue)<0;)ft++;for(;Je(oe[Tt],Ue)>0;)Tt--}0===Je(oe[_e],Ue)?ve(oe,_e,Tt):ve(oe,++Tt,re),Tt<=te&&(_e=Tt+1),te<=Tt&&(re=Tt-1)}}(le,K,ne||0,ce||le.length-1,ee||me)}function ve(le,K,ne){var ce=le[K];le[K]=le[ne],le[ne]=ce}function me(le,K){return le<K?-1:le>K?1:0}var q=function(le){void 0===le&&(le=9),this._maxEntries=Math.max(4,le),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function Ee(le,K,ne){if(!ne)return K.indexOf(le);for(var ce=0;ce<K.length;ce++)if(ne(le,K[ce]))return ce;return-1}function p(le,K){J(le,0,le.children.length,K,le)}function J(le,K,ne,ce,ee){ee||(ee=mt(null)),ee.minX=1/0,ee.minY=1/0,ee.maxX=-1/0,ee.maxY=-1/0;for(var ae=K;ae<ne;ae++){var oe=le.children[ae];ye(ee,le.leaf?ce(oe):oe)}return ee}function ye(le,K){return le.minX=Math.min(le.minX,K.minX),le.minY=Math.min(le.minY,K.minY),le.maxX=Math.max(le.maxX,K.maxX),le.maxY=Math.max(le.maxY,K.maxY),le}function Ce(le,K){return le.minX-K.minX}function Pe(le,K){return le.minY-K.minY}function qe(le){return(le.maxX-le.minX)*(le.maxY-le.minY)}function It(le){return le.maxX-le.minX+(le.maxY-le.minY)}function gt(le,K){return le.minX<=K.minX&&le.minY<=K.minY&&K.maxX<=le.maxX&&K.maxY<=le.maxY}function st(le,K){return K.minX<=le.maxX&&K.minY<=le.maxY&&K.maxX>=le.minX&&K.maxY>=le.minY}function mt(le){return{children:le,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Mt(le,K,ne,ce,ee){for(var ae=[K,ne];ae.length;)if(!((ne=ae.pop())-(K=ae.pop())<=ce)){var oe=K+Math.ceil((ne-K)/ce/2)*ce;ot(le,oe,K,ne,ee),ae.push(K,oe,oe,ne)}}return q.prototype.all=function(){return this._all(this.data,[])},q.prototype.search=function(le){var K=this.data,ne=[];if(!st(le,K))return ne;for(var ce=this.toBBox,ee=[];K;){for(var ae=0;ae<K.children.length;ae++){var oe=K.children[ae],te=K.leaf?ce(oe):oe;st(le,te)&&(K.leaf?ne.push(oe):gt(le,te)?this._all(oe,ne):ee.push(oe))}K=ee.pop()}return ne},q.prototype.collides=function(le){var K=this.data;if(!st(le,K))return!1;for(var ne=[];K;){for(var ce=0;ce<K.children.length;ce++){var ee=K.children[ce],ae=K.leaf?this.toBBox(ee):ee;if(st(le,ae)){if(K.leaf||gt(le,ae))return!0;ne.push(ee)}}K=ne.pop()}return!1},q.prototype.load=function(le){if(!le||!le.length)return this;if(le.length<this._minEntries){for(var K=0;K<le.length;K++)this.insert(le[K]);return this}var ne=this._build(le.slice(),0,le.length-1,0);if(this.data.children.length)if(this.data.height===ne.height)this._splitRoot(this.data,ne);else{if(this.data.height<ne.height){var ce=this.data;this.data=ne,ne=ce}this._insert(ne,this.data.height-ne.height-1,!0)}else this.data=ne;return this},q.prototype.insert=function(le){return le&&this._insert(le,this.data.height-1),this},q.prototype.clear=function(){return this.data=mt([]),this},q.prototype.remove=function(le,K){if(!le)return this;for(var ne,ce,ee,ae=this.data,oe=this.toBBox(le),te=[],_e=[];ae||te.length;){if(ae||(ae=te.pop(),ce=te[te.length-1],ne=_e.pop(),ee=!0),ae.leaf){var re=Ee(le,ae.children,K);if(-1!==re)return ae.children.splice(re,1),te.push(ae),this._condense(te),this}ee||ae.leaf||!gt(ae,oe)?ce?(ne++,ae=ce.children[ne],ee=!1):ae=null:(te.push(ae),_e.push(ne),ne=0,ce=ae,ae=ae.children[0])}return this},q.prototype.toBBox=function(le){return le},q.prototype.compareMinX=function(le,K){return le.minX-K.minX},q.prototype.compareMinY=function(le,K){return le.minY-K.minY},q.prototype.toJSON=function(){return this.data},q.prototype.fromJSON=function(le){return this.data=le,this},q.prototype._all=function(le,K){for(var ne=[];le;)le.leaf?K.push.apply(K,le.children):ne.push.apply(ne,le.children),le=ne.pop();return K},q.prototype._build=function(le,K,ne,ce){var ee,ae=ne-K+1,oe=this._maxEntries;if(ae<=oe)return p(ee=mt(le.slice(K,ne+1)),this.toBBox),ee;ce||(ce=Math.ceil(Math.log(ae)/Math.log(oe)),oe=Math.ceil(ae/Math.pow(oe,ce-1))),(ee=mt([])).leaf=!1,ee.height=ce;var te=Math.ceil(ae/oe),_e=te*Math.ceil(Math.sqrt(oe));Mt(le,K,ne,_e,this.compareMinX);for(var re=K;re<=ne;re+=_e){var Je=Math.min(re+_e-1,ne);Mt(le,re,Je,te,this.compareMinY);for(var He=re;He<=Je;He+=te){var it=Math.min(He+te-1,Je);ee.children.push(this._build(le,He,it,ce-1))}}return p(ee,this.toBBox),ee},q.prototype._chooseSubtree=function(le,K,ne,ce){for(;ce.push(K),!K.leaf&&ce.length-1!==ne;){for(var ee=1/0,ae=1/0,oe=void 0,te=0;te<K.children.length;te++){var _e=K.children[te],re=qe(_e),Je=(He=le,it=_e,(Math.max(it.maxX,He.maxX)-Math.min(it.minX,He.minX))*(Math.max(it.maxY,He.maxY)-Math.min(it.minY,He.minY))-re);Je<ae?(ae=Je,ee=re<ee?re:ee,oe=_e):Je===ae&&re<ee&&(ee=re,oe=_e)}K=oe||K.children[0]}var He,it;return K},q.prototype._insert=function(le,K,ne){var ce=ne?le:this.toBBox(le),ee=[],ae=this._chooseSubtree(ce,this.data,K,ee);for(ae.children.push(le),ye(ae,ce);K>=0&&ee[K].children.length>this._maxEntries;)this._split(ee,K),K--;this._adjustParentBBoxes(ce,ee,K)},q.prototype._split=function(le,K){var ne=le[K],ce=ne.children.length,ee=this._minEntries;this._chooseSplitAxis(ne,ee,ce);var ae=this._chooseSplitIndex(ne,ee,ce),oe=mt(ne.children.splice(ae,ne.children.length-ae));oe.height=ne.height,oe.leaf=ne.leaf,p(ne,this.toBBox),p(oe,this.toBBox),K?le[K-1].children.push(oe):this._splitRoot(ne,oe)},q.prototype._splitRoot=function(le,K){this.data=mt([le,K]),this.data.height=le.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},q.prototype._chooseSplitIndex=function(le,K,ne){for(var ce,ee,ae,oe,te,_e,re,Je=1/0,He=1/0,it=K;it<=ne-K;it++){var Ne=J(le,0,it,this.toBBox),sn=J(le,it,ne,this.toBBox),Bt=(ee=Ne,ae=sn,void 0,void 0,void 0,void 0,oe=Math.max(ee.minX,ae.minX),te=Math.max(ee.minY,ae.minY),_e=Math.min(ee.maxX,ae.maxX),re=Math.min(ee.maxY,ae.maxY),Math.max(0,_e-oe)*Math.max(0,re-te)),Le=qe(Ne)+qe(sn);Bt<Je?(Je=Bt,ce=it,He=Le<He?Le:He):Bt===Je&&Le<He&&(He=Le,ce=it)}return ce||ne-K},q.prototype._chooseSplitAxis=function(le,K,ne){var ce=le.leaf?this.compareMinX:Ce,ee=le.leaf?this.compareMinY:Pe;this._allDistMargin(le,K,ne,ce)<this._allDistMargin(le,K,ne,ee)&&le.children.sort(ce)},q.prototype._allDistMargin=function(le,K,ne,ce){le.children.sort(ce);for(var ee=this.toBBox,ae=J(le,0,K,ee),oe=J(le,ne-K,ne,ee),te=It(ae)+It(oe),_e=K;_e<ne-K;_e++){var re=le.children[_e];ye(ae,le.leaf?ee(re):re),te+=It(ae)}for(var Je=ne-K-1;Je>=K;Je--){var He=le.children[Je];ye(oe,le.leaf?ee(He):He),te+=It(oe)}return te},q.prototype._adjustParentBBoxes=function(le,K,ne){for(var ce=ne;ce>=0;ce--)ye(K[ce],le)},q.prototype._condense=function(le){for(var K=le.length-1,ne=void 0;K>=0;K--)0===le[K].children.length?K>0?(ne=le[K-1].children).splice(ne.indexOf(le[K]),1):this.clear():p(le[K],this.toBBox)},q}()},6952:(Dt,ot,ve)=>{var me=ve(1356),q=ve(3407),Ee=ve(2e3),p=ve(2342),J=ve(9235),ye=ve(2374),Ce=Date.prototype.getTime;function qe(st){return null==st}function It(st){return!(!st||"object"!=typeof st||"number"!=typeof st.length||"function"!=typeof st.copy||"function"!=typeof st.slice||st.length>0&&"number"!=typeof st[0])}Dt.exports=function Pe(st,mt,Mt){var le=Mt||{};return!!(le.strict?Ee(st,mt):st===mt)||(!st||!mt||"object"!=typeof st&&"object"!=typeof mt?le.strict?Ee(st,mt):st==mt:function gt(st,mt,Mt){var le,K;if(typeof st!=typeof mt||qe(st)||qe(mt)||st.prototype!==mt.prototype||q(st)!==q(mt))return!1;var ne=p(st),ce=p(mt);if(ne!==ce)return!1;if(ne||ce)return st.source===mt.source&&J(st)===J(mt);if(ye(st)&&ye(mt))return Ce.call(st)===Ce.call(mt);var ee=It(st),ae=It(mt);if(ee!==ae)return!1;if(ee||ae){if(st.length!==mt.length)return!1;for(le=0;le<st.length;le++)if(st[le]!==mt[le])return!1;return!0}if(typeof st!=typeof mt)return!1;try{var oe=me(st),te=me(mt)}catch{return!1}if(oe.length!==te.length)return!1;for(oe.sort(),te.sort(),le=oe.length-1;le>=0;le--)if(oe[le]!=te[le])return!1;for(le=oe.length-1;le>=0;le--)if(!Pe(st[K=oe[le]],mt[K],Mt))return!1;return!0}(st,mt,le))}},2358:(Dt,ot,ve)=>{"use strict";var me=ve(1356),q="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),Ee=Object.prototype.toString,p=Array.prototype.concat,J=Object.defineProperty,Ce=ve(7027)(),Pe=J&&Ce,qe=function(gt,st,mt,Mt){if(st in gt)if(!0===Mt){if(gt[st]===mt)return}else if(!function(gt){return"function"==typeof gt&&"[object Function]"===Ee.call(gt)}(Mt)||!Mt())return;Pe?J(gt,st,{configurable:!0,enumerable:!1,value:mt,writable:!0}):gt[st]=mt},It=function(gt,st){var mt=arguments.length>2?arguments[2]:{},Mt=me(st);q&&(Mt=p.call(Mt,Object.getOwnPropertySymbols(st)));for(var le=0;le<Mt.length;le+=1)qe(gt,Mt[le],st[Mt[le]],mt[Mt[le]])};It.supportsDescriptors=!!Pe,Dt.exports=It},1817:Dt=>{function ot(ve,me,q,Ee){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(ve,me,q,Ee)}ot.prototype.run=function(ve,me,q,Ee){this._init(ve,me,q,Ee);for(var p=0;p<this._datasetLength;p++)if(1!==this._visited[p]){this._visited[p]=1;var J=this._regionQuery(p);if(J.length<this.minPts)this.noise.push(p);else{var ye=this.clusters.length;this.clusters.push([]),this._addToCluster(p,ye),this._expandCluster(ye,J)}}return this.clusters},ot.prototype._init=function(ve,me,q,Ee){if(ve){if(!(ve instanceof Array))throw Error("Dataset must be of type array, "+typeof ve+" given");this.dataset=ve,this.clusters=[],this.noise=[],this._datasetLength=ve.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}me&&(this.epsilon=me),q&&(this.minPts=q),Ee&&(this.distance=Ee)},ot.prototype._expandCluster=function(ve,me){for(var q=0;q<me.length;q++){var Ee=me[q];if(1!==this._visited[Ee]){this._visited[Ee]=1;var p=this._regionQuery(Ee);p.length>=this.minPts&&(me=this._mergeArrays(me,p))}1!==this._assigned[Ee]&&this._addToCluster(Ee,ve)}},ot.prototype._addToCluster=function(ve,me){this.clusters[me].push(ve),this._assigned[ve]=1},ot.prototype._regionQuery=function(ve){for(var me=[],q=0;q<this._datasetLength;q++)this.distance(this.dataset[ve],this.dataset[q])<this.epsilon&&me.push(q);return me},ot.prototype._mergeArrays=function(ve,me){for(var q=me.length,Ee=0;Ee<q;Ee++){var p=me[Ee];ve.indexOf(p)<0&&ve.push(p)}return ve},ot.prototype._euclideanDistance=function(ve,me){for(var q=0,Ee=Math.min(ve.length,me.length);Ee--;)q+=(ve[Ee]-me[Ee])*(ve[Ee]-me[Ee]);return Math.sqrt(q)},Dt.exports&&(Dt.exports=ot)},4273:Dt=>{function ot(ve,me,q){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(ve,me,q)}ot.prototype.init=function(ve,me,q){this.assignments=[],this.centroids=[],typeof ve<"u"&&(this.dataset=ve),typeof me<"u"&&(this.k=me),typeof q<"u"&&(this.distance=q)},ot.prototype.run=function(ve,me){this.init(ve,me);for(var q=this.dataset.length,Ee=0;Ee<this.k;Ee++)this.centroids[Ee]=this.randomCentroid();for(var p=!0;p;){p=this.assign();for(var J=0;J<this.k;J++){for(var ye=new Array(It),Ce=0,Pe=0;Pe<It;Pe++)ye[Pe]=0;for(var qe=0;qe<q;qe++){var It=this.dataset[qe].length;if(J===this.assignments[qe]){for(Pe=0;Pe<It;Pe++)ye[Pe]+=this.dataset[qe][Pe];Ce++}}if(Ce>0){for(Pe=0;Pe<It;Pe++)ye[Pe]/=Ce;this.centroids[J]=ye}else this.centroids[J]=this.randomCentroid(),p=!0}}return this.getClusters()},ot.prototype.randomCentroid=function(){var me,q,ve=this.dataset.length-1;do{q=Math.round(Math.random()*ve),me=this.dataset[q]}while(this.centroids.indexOf(me)>=0);return me},ot.prototype.assign=function(){for(var q,ve=!1,me=this.dataset.length,Ee=0;Ee<me;Ee++)(q=this.argmin(this.dataset[Ee],this.centroids,this.distance))!=this.assignments[Ee]&&(this.assignments[Ee]=q,ve=!0);return ve},ot.prototype.getClusters=function(){for(var me,ve=new Array(this.k),q=0;q<this.assignments.length;q++)typeof ve[me=this.assignments[q]]>"u"&&(ve[me]=[]),ve[me].push(q);return ve},ot.prototype.argmin=function(ve,me,q){for(var ye,Ee=Number.MAX_VALUE,p=0,J=me.length,Ce=0;Ce<J;Ce++)(ye=q(ve,me[Ce]))<Ee&&(Ee=ye,p=Ce);return p},ot.prototype.distance=function(ve,me){for(var q=0,Ee=Math.min(ve.length,me.length);Ee--;){var p=ve[Ee]-me[Ee];q+=p*p}return Math.sqrt(q)},Dt.exports&&(Dt.exports=ot)},8680:(Dt,ot,ve)=>{if(Dt.exports)var me=ve(8759);function q(Ee,p,J,ye){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(Ee,p,J,ye)}q.prototype.run=function(Ee,p,J,ye){this._init(Ee,p,J,ye);for(var Ce=0,Pe=this.dataset.length;Ce<Pe;Ce++)if(1!==this._processed[Ce]){this._processed[Ce]=1,this.clusters.push([Ce]);var qe=this.clusters.length-1;this._orderedList.push(Ce);var It=new me(null,null,"asc"),gt=this._regionQuery(Ce);void 0!==this._distanceToCore(Ce)&&(this._updateQueue(Ce,gt,It),this._expandCluster(qe,It))}return this.clusters},q.prototype.getReachabilityPlot=function(){for(var Ee=[],p=0,J=this._orderedList.length;p<J;p++){var ye=this._orderedList[p];Ee.push([ye,this._reachability[ye]])}return Ee},q.prototype._init=function(Ee,p,J,ye){if(Ee){if(!(Ee instanceof Array))throw Error("Dataset must be of type array, "+typeof Ee+" given");this.dataset=Ee,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}p&&(this.epsilon=p),J&&(this.minPts=J),ye&&(this.distance=ye)},q.prototype._updateQueue=function(Ee,p,J){var ye=this;this._coreDistance=this._distanceToCore(Ee),p.forEach(function(Ce){if(void 0===ye._processed[Ce]){var Pe=ye.distance(ye.dataset[Ee],ye.dataset[Ce]),qe=Math.max(ye._coreDistance,Pe);void 0===ye._reachability[Ce]?(ye._reachability[Ce]=qe,J.insert(Ce,qe)):qe<ye._reachability[Ce]&&(ye._reachability[Ce]=qe,J.remove(Ce),J.insert(Ce,qe))}})},q.prototype._expandCluster=function(Ee,p){for(var J=p.getElements(),ye=0,Ce=J.length;ye<Ce;ye++){var Pe=J[ye];if(void 0===this._processed[Pe]){var qe=this._regionQuery(Pe);this._processed[Pe]=1,this.clusters[Ee].push(Pe),this._orderedList.push(Pe),void 0!==this._distanceToCore(Pe)&&(this._updateQueue(Pe,qe,p),this._expandCluster(Ee,p))}}},q.prototype._distanceToCore=function(Ee){for(var p=this.epsilon,J=0;J<p;J++)if(this._regionQuery(Ee,J).length>=this.minPts)return J},q.prototype._regionQuery=function(Ee,p){p=p||this.epsilon;for(var J=[],ye=0,Ce=this.dataset.length;ye<Ce;ye++)this.distance(this.dataset[Ee],this.dataset[ye])<p&&J.push(ye);return J},q.prototype._euclideanDistance=function(Ee,p){for(var J=0,ye=Math.min(Ee.length,p.length);ye--;)J+=(Ee[ye]-p[ye])*(Ee[ye]-p[ye]);return Math.sqrt(J)},Dt.exports&&(Dt.exports=q)},8759:Dt=>{function ot(ve,me,q){this._queue=[],this._priorities=[],this._sorting="desc",this._init(ve,me,q)}ot.prototype.insert=function(ve,me){for(var q=this._queue.length,Ee=q;Ee--;){var p=this._priorities[Ee];"desc"===this._sorting?me>p&&(q=Ee):me<p&&(q=Ee)}this._insertAt(ve,me,q)},ot.prototype.remove=function(ve){for(var me=this._queue.length;me--;)if(ve===this._queue[me]){this._queue.splice(me,1),this._priorities.splice(me,1);break}},ot.prototype.forEach=function(ve){this._queue.forEach(ve)},ot.prototype.getElements=function(){return this._queue},ot.prototype.getElementPriority=function(ve){return this._priorities[ve]},ot.prototype.getPriorities=function(){return this._priorities},ot.prototype.getElementsWithPriorities=function(){for(var ve=[],me=0,q=this._queue.length;me<q;me++)ve.push([this._queue[me],this._priorities[me]]);return ve},ot.prototype._init=function(ve,me,q){if(ve&&me){if(this._queue=[],this._priorities=[],ve.length!==me.length)throw new Error("Arrays must have the same length");for(var Ee=0;Ee<ve.length;Ee++)this.insert(ve[Ee],me[Ee])}q&&(this._sorting=q)},ot.prototype._insertAt=function(ve,me,q){this._queue.length===q?(this._queue.push(ve),this._priorities.push(me)):(this._queue.splice(q,0,ve),this._priorities.splice(q,0,me))},Dt.exports&&(Dt.exports=ot)},7470:(Dt,ot,ve)=>{Dt.exports&&(Dt.exports={DBSCAN:ve(1817),KMEANS:ve(4273),OPTICS:ve(8680),PriorityQueue:ve(8759)})},5469:Dt=>{"use strict";function ot(Le,bt,Ue){Ue=Ue||2;var Jt,Rn,zt,Jn,Mn,jn,xn,ft=bt&&bt.length,Tt=ft?bt[0]*Ue:Le.length,Be=ve(Le,0,Tt,Ue,!0),Xt=[];if(!Be||Be.next===Be.prev)return Xt;if(ft&&(Be=function Ce(Le,bt,Ue,ft){var Be,Xt,zt,Tt=[];for(Be=0,Xt=bt.length;Be<Xt;Be++)(zt=ve(Le,bt[Be]*ft,Be<Xt-1?bt[Be+1]*ft:Le.length,ft,!1))===zt.next&&(zt.steiner=!0),Tt.push(le(zt));for(Tt.sort(Pe),Be=0;Be<Tt.length;Be++)Ue=qe(Tt[Be],Ue);return Ue}(Le,bt,Be,Ue)),Le.length>80*Ue){Jt=zt=Le[0],Rn=Jn=Le[1];for(var Nn=Ue;Nn<Tt;Nn+=Ue)(Mn=Le[Nn])<Jt&&(Jt=Mn),(jn=Le[Nn+1])<Rn&&(Rn=jn),Mn>zt&&(zt=Mn),jn>Jn&&(Jn=jn);xn=0!==(xn=Math.max(zt-Jt,Jn-Rn))?32767/xn:0}return q(Be,Xt,Ue,Jt,Rn,xn,0),Xt}function ve(Le,bt,Ue,ft,Tt){var Be,Xt;if(Tt===Bt(Le,bt,Ue,ft)>0)for(Be=bt;Be<Ue;Be+=ft)Xt=it(Be,Le[Be],Le[Be+1],Xt);else for(Be=Ue-ft;Be>=bt;Be-=ft)Xt=it(Be,Le[Be],Le[Be+1],Xt);return Xt&&ee(Xt,Xt.next)&&(Ne(Xt),Xt=Xt.next),Xt}function me(Le,bt){if(!Le)return Le;bt||(bt=Le);var ft,Ue=Le;do{if(ft=!1,Ue.steiner||!ee(Ue,Ue.next)&&0!==ce(Ue.prev,Ue,Ue.next))Ue=Ue.next;else{if(Ne(Ue),(Ue=bt=Ue.prev)===Ue.next)break;ft=!0}}while(ft||Ue!==bt);return bt}function q(Le,bt,Ue,ft,Tt,Be,Xt){if(Le){!Xt&&Be&&function st(Le,bt,Ue,ft){var Tt=Le;do{0===Tt.z&&(Tt.z=Mt(Tt.x,Tt.y,bt,Ue,ft)),Tt.prevZ=Tt.prev,Tt.nextZ=Tt.next,Tt=Tt.next}while(Tt!==Le);Tt.prevZ.nextZ=null,Tt.prevZ=null,function mt(Le){var bt,Ue,ft,Tt,Be,Xt,Jt,Rn,zt=1;do{for(Ue=Le,Le=null,Be=null,Xt=0;Ue;){for(Xt++,ft=Ue,Jt=0,bt=0;bt<zt&&(Jt++,ft=ft.nextZ);bt++);for(Rn=zt;Jt>0||Rn>0&&ft;)0!==Jt&&(0===Rn||!ft||Ue.z<=ft.z)?(Tt=Ue,Ue=Ue.nextZ,Jt--):(Tt=ft,ft=ft.nextZ,Rn--),Be?Be.nextZ=Tt:Le=Tt,Tt.prevZ=Be,Be=Tt;Ue=ft}Be.nextZ=null,zt*=2}while(Xt>1)}(Tt)}(Le,ft,Tt,Be);for(var Rn,zt,Jt=Le;Le.prev!==Le.next;)if(Rn=Le.prev,zt=Le.next,Be?p(Le,ft,Tt,Be):Ee(Le))bt.push(Rn.i/Ue|0),bt.push(Le.i/Ue|0),bt.push(zt.i/Ue|0),Ne(Le),Le=zt.next,Jt=zt.next;else if((Le=zt)===Jt){Xt?1===Xt?q(Le=J(me(Le),bt,Ue),bt,Ue,ft,Tt,Be,2):2===Xt&&ye(Le,bt,Ue,ft,Tt,Be):q(me(Le),bt,Ue,ft,Tt,Be,1);break}}}function Ee(Le){var bt=Le.prev,Ue=Le,ft=Le.next;if(ce(bt,Ue,ft)>=0)return!1;for(var Tt=bt.x,Be=Ue.x,Xt=ft.x,Jt=bt.y,Rn=Ue.y,zt=ft.y,Jn=Tt<Be?Tt<Xt?Tt:Xt:Be<Xt?Be:Xt,Mn=Jt<Rn?Jt<zt?Jt:zt:Rn<zt?Rn:zt,jn=Tt>Be?Tt>Xt?Tt:Xt:Be>Xt?Be:Xt,xn=Jt>Rn?Jt>zt?Jt:zt:Rn>zt?Rn:zt,Nn=ft.next;Nn!==bt;){if(Nn.x>=Jn&&Nn.x<=jn&&Nn.y>=Mn&&Nn.y<=xn&&K(Tt,Jt,Be,Rn,Xt,zt,Nn.x,Nn.y)&&ce(Nn.prev,Nn,Nn.next)>=0)return!1;Nn=Nn.next}return!0}function p(Le,bt,Ue,ft){var Tt=Le.prev,Be=Le,Xt=Le.next;if(ce(Tt,Be,Xt)>=0)return!1;for(var Jt=Tt.x,Rn=Be.x,zt=Xt.x,Jn=Tt.y,Mn=Be.y,jn=Xt.y,xn=Jt<Rn?Jt<zt?Jt:zt:Rn<zt?Rn:zt,Nn=Jn<Mn?Jn<jn?Jn:jn:Mn<jn?Mn:jn,wn=Jt>Rn?Jt>zt?Jt:zt:Rn>zt?Rn:zt,Wi=Jn>Mn?Jn>jn?Jn:jn:Mn>jn?Mn:jn,Sr=Mt(xn,Nn,bt,Ue,ft),Oi=Mt(wn,Wi,bt,Ue,ft),ar=Le.prevZ,mr=Le.nextZ;ar&&ar.z>=Sr&&mr&&mr.z<=Oi;){if(ar.x>=xn&&ar.x<=wn&&ar.y>=Nn&&ar.y<=Wi&&ar!==Tt&&ar!==Xt&&K(Jt,Jn,Rn,Mn,zt,jn,ar.x,ar.y)&&ce(ar.prev,ar,ar.next)>=0||(ar=ar.prevZ,mr.x>=xn&&mr.x<=wn&&mr.y>=Nn&&mr.y<=Wi&&mr!==Tt&&mr!==Xt&&K(Jt,Jn,Rn,Mn,zt,jn,mr.x,mr.y)&&ce(mr.prev,mr,mr.next)>=0))return!1;mr=mr.nextZ}for(;ar&&ar.z>=Sr;){if(ar.x>=xn&&ar.x<=wn&&ar.y>=Nn&&ar.y<=Wi&&ar!==Tt&&ar!==Xt&&K(Jt,Jn,Rn,Mn,zt,jn,ar.x,ar.y)&&ce(ar.prev,ar,ar.next)>=0)return!1;ar=ar.prevZ}for(;mr&&mr.z<=Oi;){if(mr.x>=xn&&mr.x<=wn&&mr.y>=Nn&&mr.y<=Wi&&mr!==Tt&&mr!==Xt&&K(Jt,Jn,Rn,Mn,zt,jn,mr.x,mr.y)&&ce(mr.prev,mr,mr.next)>=0)return!1;mr=mr.nextZ}return!0}function J(Le,bt,Ue){var ft=Le;do{var Tt=ft.prev,Be=ft.next.next;!ee(Tt,Be)&&ae(Tt,ft,ft.next,Be)&&re(Tt,Be)&&re(Be,Tt)&&(bt.push(Tt.i/Ue|0),bt.push(ft.i/Ue|0),bt.push(Be.i/Ue|0),Ne(ft),Ne(ft.next),ft=Le=Be),ft=ft.next}while(ft!==Le);return me(ft)}function ye(Le,bt,Ue,ft,Tt,Be){var Xt=Le;do{for(var Jt=Xt.next.next;Jt!==Xt.prev;){if(Xt.i!==Jt.i&&ne(Xt,Jt)){var Rn=He(Xt,Jt);return Xt=me(Xt,Xt.next),Rn=me(Rn,Rn.next),q(Xt,bt,Ue,ft,Tt,Be,0),void q(Rn,bt,Ue,ft,Tt,Be,0)}Jt=Jt.next}Xt=Xt.next}while(Xt!==Le)}function Pe(Le,bt){return Le.x-bt.x}function qe(Le,bt){var Ue=function It(Le,bt){var Xt,Ue=bt,ft=Le.x,Tt=Le.y,Be=-1/0;do{if(Tt<=Ue.y&&Tt>=Ue.next.y&&Ue.next.y!==Ue.y){var Jt=Ue.x+(Tt-Ue.y)*(Ue.next.x-Ue.x)/(Ue.next.y-Ue.y);if(Jt<=ft&&Jt>Be&&(Be=Jt,Xt=Ue.x<Ue.next.x?Ue:Ue.next,Jt===ft))return Xt}Ue=Ue.next}while(Ue!==bt);if(!Xt)return null;var jn,Rn=Xt,zt=Xt.x,Jn=Xt.y,Mn=1/0;Ue=Xt;do{ft>=Ue.x&&Ue.x>=zt&&ft!==Ue.x&&K(Tt<Jn?ft:Be,Tt,zt,Jn,Tt<Jn?Be:ft,Tt,Ue.x,Ue.y)&&(jn=Math.abs(Tt-Ue.y)/(ft-Ue.x),re(Ue,Le)&&(jn<Mn||jn===Mn&&(Ue.x>Xt.x||Ue.x===Xt.x&&gt(Xt,Ue)))&&(Xt=Ue,Mn=jn)),Ue=Ue.next}while(Ue!==Rn);return Xt}(Le,bt);if(!Ue)return bt;var ft=He(Ue,Le);return me(ft,ft.next),me(Ue,Ue.next)}function gt(Le,bt){return ce(Le.prev,Le,bt.prev)<0&&ce(bt.next,Le,Le.next)<0}function Mt(Le,bt,Ue,ft,Tt){return(Le=1431655765&((Le=858993459&((Le=252645135&((Le=16711935&((Le=(Le-Ue)*Tt|0)|Le<<8))|Le<<4))|Le<<2))|Le<<1))|(bt=1431655765&((bt=858993459&((bt=252645135&((bt=16711935&((bt=(bt-ft)*Tt|0)|bt<<8))|bt<<4))|bt<<2))|bt<<1))<<1}function le(Le){var bt=Le,Ue=Le;do{(bt.x<Ue.x||bt.x===Ue.x&&bt.y<Ue.y)&&(Ue=bt),bt=bt.next}while(bt!==Le);return Ue}function K(Le,bt,Ue,ft,Tt,Be,Xt,Jt){return(Tt-Xt)*(bt-Jt)>=(Le-Xt)*(Be-Jt)&&(Le-Xt)*(ft-Jt)>=(Ue-Xt)*(bt-Jt)&&(Ue-Xt)*(Be-Jt)>=(Tt-Xt)*(ft-Jt)}function ne(Le,bt){return Le.next.i!==bt.i&&Le.prev.i!==bt.i&&!function _e(Le,bt){var Ue=Le;do{if(Ue.i!==Le.i&&Ue.next.i!==Le.i&&Ue.i!==bt.i&&Ue.next.i!==bt.i&&ae(Ue,Ue.next,Le,bt))return!0;Ue=Ue.next}while(Ue!==Le);return!1}(Le,bt)&&(re(Le,bt)&&re(bt,Le)&&function Je(Le,bt){var Ue=Le,ft=!1,Tt=(Le.x+bt.x)/2,Be=(Le.y+bt.y)/2;do{Ue.y>Be!=Ue.next.y>Be&&Ue.next.y!==Ue.y&&Tt<(Ue.next.x-Ue.x)*(Be-Ue.y)/(Ue.next.y-Ue.y)+Ue.x&&(ft=!ft),Ue=Ue.next}while(Ue!==Le);return ft}(Le,bt)&&(ce(Le.prev,Le,bt.prev)||ce(Le,bt.prev,bt))||ee(Le,bt)&&ce(Le.prev,Le,Le.next)>0&&ce(bt.prev,bt,bt.next)>0)}function ce(Le,bt,Ue){return(bt.y-Le.y)*(Ue.x-bt.x)-(bt.x-Le.x)*(Ue.y-bt.y)}function ee(Le,bt){return Le.x===bt.x&&Le.y===bt.y}function ae(Le,bt,Ue,ft){var Tt=te(ce(Le,bt,Ue)),Be=te(ce(Le,bt,ft)),Xt=te(ce(Ue,ft,Le)),Jt=te(ce(Ue,ft,bt));return!!(Tt!==Be&&Xt!==Jt||0===Tt&&oe(Le,Ue,bt)||0===Be&&oe(Le,ft,bt)||0===Xt&&oe(Ue,Le,ft)||0===Jt&&oe(Ue,bt,ft))}function oe(Le,bt,Ue){return bt.x<=Math.max(Le.x,Ue.x)&&bt.x>=Math.min(Le.x,Ue.x)&&bt.y<=Math.max(Le.y,Ue.y)&&bt.y>=Math.min(Le.y,Ue.y)}function te(Le){return Le>0?1:Le<0?-1:0}function re(Le,bt){return ce(Le.prev,Le,Le.next)<0?ce(Le,bt,Le.next)>=0&&ce(Le,Le.prev,bt)>=0:ce(Le,bt,Le.prev)<0||ce(Le,Le.next,bt)<0}function He(Le,bt){var Ue=new sn(Le.i,Le.x,Le.y),ft=new sn(bt.i,bt.x,bt.y),Tt=Le.next,Be=bt.prev;return Le.next=bt,bt.prev=Le,Ue.next=Tt,Tt.prev=Ue,ft.next=Ue,Ue.prev=ft,Be.next=ft,ft.prev=Be,ft}function it(Le,bt,Ue,ft){var Tt=new sn(Le,bt,Ue);return ft?(Tt.next=ft.next,Tt.prev=ft,ft.next.prev=Tt,ft.next=Tt):(Tt.prev=Tt,Tt.next=Tt),Tt}function Ne(Le){Le.next.prev=Le.prev,Le.prev.next=Le.next,Le.prevZ&&(Le.prevZ.nextZ=Le.nextZ),Le.nextZ&&(Le.nextZ.prevZ=Le.prevZ)}function sn(Le,bt,Ue){this.i=Le,this.x=bt,this.y=Ue,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Bt(Le,bt,Ue,ft){for(var Tt=0,Be=bt,Xt=Ue-ft;Be<Ue;Be+=ft)Tt+=(Le[Xt]-Le[Be])*(Le[Be+1]+Le[Xt+1]),Xt=Be;return Tt}Dt.exports=ot,Dt.exports.default=ot,ot.deviation=function(Le,bt,Ue,ft){var Tt=bt&&bt.length,Xt=Math.abs(Bt(Le,0,Tt?bt[0]*Ue:Le.length,Ue));if(Tt)for(var Jt=0,Rn=bt.length;Jt<Rn;Jt++)Xt-=Math.abs(Bt(Le,bt[Jt]*Ue,Jt<Rn-1?bt[Jt+1]*Ue:Le.length,Ue));var Mn=0;for(Jt=0;Jt<ft.length;Jt+=3){var jn=ft[Jt]*Ue,xn=ft[Jt+1]*Ue,Nn=ft[Jt+2]*Ue;Mn+=Math.abs((Le[jn]-Le[Nn])*(Le[xn+1]-Le[jn+1])-(Le[jn]-Le[xn])*(Le[Nn+1]-Le[jn+1]))}return 0===Xt&&0===Mn?0:Math.abs((Mn-Xt)/Xt)},ot.flatten=function(Le){for(var bt=Le[0][0].length,Ue={vertices:[],holes:[],dimensions:bt},ft=0,Tt=0;Tt<Le.length;Tt++){for(var Be=0;Be<Le[Tt].length;Be++)for(var Xt=0;Xt<bt;Xt++)Ue.vertices.push(Le[Tt][Be][Xt]);Tt>0&&Ue.holes.push(ft+=Le[Tt-1].length)}return Ue}},9069:Dt=>{"use strict";var me,ot="object"==typeof Reflect?Reflect:null,ve=ot&&"function"==typeof ot.apply?ot.apply:function(ae,oe,te){return Function.prototype.apply.call(ae,oe,te)};me=ot&&"function"==typeof ot.ownKeys?ot.ownKeys:Object.getOwnPropertySymbols?function(ae){return Object.getOwnPropertyNames(ae).concat(Object.getOwnPropertySymbols(ae))}:function(ae){return Object.getOwnPropertyNames(ae)};var Ee=Number.isNaN||function(ae){return ae!=ae};function p(){p.init.call(this)}Dt.exports=p,Dt.exports.once=function K(ee,ae){return new Promise(function(oe,te){function _e(Je){ee.removeListener(ae,re),te(Je)}function re(){"function"==typeof ee.removeListener&&ee.removeListener("error",_e),oe([].slice.call(arguments))}ce(ee,ae,re,{once:!0}),"error"!==ae&&function ne(ee,ae,oe){"function"==typeof ee.on&&ce(ee,"error",ae,oe)}(ee,_e,{once:!0})})},p.EventEmitter=p,p.prototype._events=void 0,p.prototype._eventsCount=0,p.prototype._maxListeners=void 0;var J=10;function ye(ee){if("function"!=typeof ee)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof ee)}function Ce(ee){return void 0===ee._maxListeners?p.defaultMaxListeners:ee._maxListeners}function Pe(ee,ae,oe,te){var _e,re,Je;if(ye(oe),void 0===(re=ee._events)?(re=ee._events=Object.create(null),ee._eventsCount=0):(void 0!==re.newListener&&(ee.emit("newListener",ae,oe.listener?oe.listener:oe),re=ee._events),Je=re[ae]),void 0===Je)Je=re[ae]=oe,++ee._eventsCount;else if("function"==typeof Je?Je=re[ae]=te?[oe,Je]:[Je,oe]:te?Je.unshift(oe):Je.push(oe),(_e=Ce(ee))>0&&Je.length>_e&&!Je.warned){Je.warned=!0;var He=new Error("Possible EventEmitter memory leak detected. "+Je.length+" "+String(ae)+" listeners added. Use emitter.setMaxListeners() to increase limit");He.name="MaxListenersExceededWarning",He.emitter=ee,He.type=ae,He.count=Je.length,function q(ee){console&&console.warn&&console.warn(ee)}(He)}return ee}function qe(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function It(ee,ae,oe){var te={fired:!1,wrapFn:void 0,target:ee,type:ae,listener:oe},_e=qe.bind(te);return _e.listener=oe,te.wrapFn=_e,_e}function gt(ee,ae,oe){var te=ee._events;if(void 0===te)return[];var _e=te[ae];return void 0===_e?[]:"function"==typeof _e?oe?[_e.listener||_e]:[_e]:oe?function le(ee){for(var ae=new Array(ee.length),oe=0;oe<ae.length;++oe)ae[oe]=ee[oe].listener||ee[oe];return ae}(_e):mt(_e,_e.length)}function st(ee){var ae=this._events;if(void 0!==ae){var oe=ae[ee];if("function"==typeof oe)return 1;if(void 0!==oe)return oe.length}return 0}function mt(ee,ae){for(var oe=new Array(ae),te=0;te<ae;++te)oe[te]=ee[te];return oe}function ce(ee,ae,oe,te){if("function"==typeof ee.on)te.once?ee.once(ae,oe):ee.on(ae,oe);else{if("function"!=typeof ee.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof ee);ee.addEventListener(ae,function _e(re){te.once&&ee.removeEventListener(ae,_e),oe(re)})}}Object.defineProperty(p,"defaultMaxListeners",{enumerable:!0,get:function(){return J},set:function(ee){if("number"!=typeof ee||ee<0||Ee(ee))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+ee+".");J=ee}}),p.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},p.prototype.setMaxListeners=function(ae){if("number"!=typeof ae||ae<0||Ee(ae))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+ae+".");return this._maxListeners=ae,this},p.prototype.getMaxListeners=function(){return Ce(this)},p.prototype.emit=function(ae){for(var oe=[],te=1;te<arguments.length;te++)oe.push(arguments[te]);var _e="error"===ae,re=this._events;if(void 0!==re)_e=_e&&void 0===re.error;else if(!_e)return!1;if(_e){var Je;if(oe.length>0&&(Je=oe[0]),Je instanceof Error)throw Je;var He=new Error("Unhandled error."+(Je?" ("+Je.message+")":""));throw He.context=Je,He}var it=re[ae];if(void 0===it)return!1;if("function"==typeof it)ve(it,this,oe);else{var Ne=it.length,sn=mt(it,Ne);for(te=0;te<Ne;++te)ve(sn[te],this,oe)}return!0},p.prototype.on=p.prototype.addListener=function(ae,oe){return Pe(this,ae,oe,!1)},p.prototype.prependListener=function(ae,oe){return Pe(this,ae,oe,!0)},p.prototype.once=function(ae,oe){return ye(oe),this.on(ae,It(this,ae,oe)),this},p.prototype.prependOnceListener=function(ae,oe){return ye(oe),this.prependListener(ae,It(this,ae,oe)),this},p.prototype.off=p.prototype.removeListener=function(ae,oe){var te,_e,re,Je,He;if(ye(oe),void 0===(_e=this._events))return this;if(void 0===(te=_e[ae]))return this;if(te===oe||te.listener===oe)0==--this._eventsCount?this._events=Object.create(null):(delete _e[ae],_e.removeListener&&this.emit("removeListener",ae,te.listener||oe));else if("function"!=typeof te){for(re=-1,Je=te.length-1;Je>=0;Je--)if(te[Je]===oe||te[Je].listener===oe){He=te[Je].listener,re=Je;break}if(re<0)return this;0===re?te.shift():function Mt(ee,ae){for(;ae+1<ee.length;ae++)ee[ae]=ee[ae+1];ee.pop()}(te,re),1===te.length&&(_e[ae]=te[0]),void 0!==_e.removeListener&&this.emit("removeListener",ae,He||oe)}return this},p.prototype.removeAllListeners=function(ae){var oe,te,_e;if(void 0===(te=this._events))return this;if(void 0===te.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==te[ae]&&(0==--this._eventsCount?this._events=Object.create(null):delete te[ae]),this;if(0===arguments.length){var Je,re=Object.keys(te);for(_e=0;_e<re.length;++_e)"removeListener"!==(Je=re[_e])&&this.removeAllListeners(Je);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(oe=te[ae]))this.removeListener(ae,oe);else if(void 0!==oe)for(_e=oe.length-1;_e>=0;_e--)this.removeListener(ae,oe[_e]);return this},p.prototype.listeners=function(ae){return gt(this,ae,!0)},p.prototype.rawListeners=function(ae){return gt(this,ae,!1)},p.listenerCount=function(ee,ae){return"function"==typeof ee.listenerCount?ee.listenerCount(ae):st.call(ee,ae)},p.prototype.listenerCount=st,p.prototype.eventNames=function(){return this._eventsCount>0?me(this._events):[]}},3457:Dt=>{"use strict";var ve=Array.prototype.slice,me=Object.prototype.toString;Dt.exports=function(p){var J=this;if("function"!=typeof J||"[object Function]"!==me.call(J))throw new TypeError("Function.prototype.bind called on incompatible "+J);for(var Ce,ye=ve.call(arguments,1),qe=Math.max(0,J.length-ye.length),It=[],gt=0;gt<qe;gt++)It.push("$"+gt);if(Ce=Function("binder","return function ("+It.join(",")+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof Ce){var mt=J.apply(this,ye.concat(ve.call(arguments)));return Object(mt)===mt?mt:this}return J.apply(p,ye.concat(ve.call(arguments)))}),J.prototype){var st=function(){};st.prototype=J.prototype,Ce.prototype=new st,st.prototype=null}return Ce}},4444:(Dt,ot,ve)=>{"use strict";var me=ve(3457);Dt.exports=Function.prototype.bind||me},9582:Dt=>{"use strict";var ot=function(){return"string"==typeof function(){}.name},ve=Object.getOwnPropertyDescriptor;if(ve)try{ve([],"length")}catch{ve=null}ot.functionsHaveConfigurableNames=function(){if(!ot()||!ve)return!1;var Ee=ve(function(){},"name");return!!Ee&&!!Ee.configurable};var me=Function.prototype.bind;ot.boundFunctionsHaveNames=function(){return ot()&&"function"==typeof me&&""!==function(){}.bind().name},Dt.exports=ot},5780:Dt=>{var ve;Dt.exports=ve={},ve.simpleFilter=function(me,q){return q.filter(function(Ee){return ve.test(me,Ee)})},ve.test=function(me,q){return null!==ve.match(me,q)},ve.match=function(me,q,Ee){var st,p=0,J=[],ye=q.length,Ce=0,Pe=0,qe=(Ee=Ee||{}).pre||"",It=Ee.post||"",gt=Ee.caseSensitive&&q||q.toLowerCase();me=Ee.caseSensitive&&me||me.toLowerCase();for(var mt=0;mt<ye;mt++)st=q[mt],gt[mt]===me[p]?(st=qe+st+It,p+=1,Pe+=1+Pe):Pe=0,Ce+=Pe,J[J.length]=st;return p===me.length?(Ce=gt===me?1/0:Ce,{rendered:J.join(""),score:Ce}):null},ve.filter=function(me,q,Ee){return q&&0!==q.length?"string"!=typeof me?q:(Ee=Ee||{},q.reduce(function(p,J,ye,Ce){var Pe=J;Ee.extract&&(Pe=Ee.extract(J));var qe=ve.match(me,Pe,Ee);return null!=qe&&(p[p.length]={string:qe.rendered,score:qe.score,index:ye,original:J}),p},[]).sort(function(p,J){return J.score-p.score||p.index-J.index})):[]}},5013:(Dt,ot,ve)=>{var me=ve(6952),q=function(ye){this.precision=ye&&ye.precision?ye.precision:17,this.direction=!(!ye||!ye.direction)&&ye.direction,this.pseudoNode=!(!ye||!ye.pseudoNode)&&ye.pseudoNode,this.objectComparator=ye&&ye.objectComparator?ye.objectComparator:J};function Ee(ye){return ye.coordinates.map(function(Ce){return{type:ye.type.replace("Multi",""),coordinates:Ce}})}function p(ye,Ce){return ye.hasOwnProperty("coordinates")?ye.coordinates.length===Ce.coordinates.length:ye.length===Ce.length}function J(ye,Ce){return me(ye,Ce,{strict:!0})}q.prototype.compare=function(ye,Ce){if(ye.type!==Ce.type||!p(ye,Ce))return!1;switch(ye.type){case"Point":return this.compareCoord(ye.coordinates,Ce.coordinates);case"LineString":return this.compareLine(ye.coordinates,Ce.coordinates,0,!1);case"Polygon":return this.comparePolygon(ye,Ce);case"Feature":return this.compareFeature(ye,Ce);default:if(0===ye.type.indexOf("Multi")){var Pe=this,qe=Ee(ye),It=Ee(Ce);return qe.every(function(gt){return this.some(function(st){return Pe.compare(gt,st)})},It)}}return!1},q.prototype.compareCoord=function(ye,Ce){if(ye.length!==Ce.length)return!1;for(var Pe=0;Pe<ye.length;Pe++)if(ye[Pe].toFixed(this.precision)!==Ce[Pe].toFixed(this.precision))return!1;return!0},q.prototype.compareLine=function(ye,Ce,Pe,qe){if(!p(ye,Ce))return!1;var It=this.pseudoNode?ye:this.removePseudo(ye),gt=this.pseudoNode?Ce:this.removePseudo(Ce);if(!qe||this.compareCoord(It[0],gt[0])||(gt=this.fixStartIndex(gt,It))){var st=this.compareCoord(It[Pe],gt[Pe]);return this.direction||st?this.comparePath(It,gt):!!this.compareCoord(It[Pe],gt[gt.length-(1+Pe)])&&this.comparePath(It.slice().reverse(),gt)}},q.prototype.fixStartIndex=function(ye,Ce){for(var Pe,qe=-1,It=0;It<ye.length;It++)if(this.compareCoord(ye[It],Ce[0])){qe=It;break}return qe>=0&&(Pe=[].concat(ye.slice(qe,ye.length),ye.slice(1,qe+1))),Pe},q.prototype.comparePath=function(ye,Ce){var Pe=this;return ye.every(function(qe,It){return Pe.compareCoord(qe,this[It])},Ce)},q.prototype.comparePolygon=function(ye,Ce){if(this.compareLine(ye.coordinates[0],Ce.coordinates[0],1,!0)){var Pe=ye.coordinates.slice(1,ye.coordinates.length),qe=Ce.coordinates.slice(1,Ce.coordinates.length),It=this;return Pe.every(function(gt){return this.some(function(st){return It.compareLine(gt,st,1,!0)})},qe)}return!1},q.prototype.compareFeature=function(ye,Ce){return!(ye.id!==Ce.id||!this.objectComparator(ye.properties,Ce.properties)||!this.compareBBox(ye,Ce))&&this.compare(ye.geometry,Ce.geometry)},q.prototype.compareBBox=function(ye,Ce){return!!(!ye.bbox&&!Ce.bbox||ye.bbox&&Ce.bbox&&this.compareCoord(ye.bbox,Ce.bbox))},q.prototype.removePseudo=function(ye){return ye},Dt.exports=q},5406:(Dt,ot,ve)=>{var me=ve(7192),q=ve(8275),Ee=ve(3269),p=ve(1503).Z,J=Ee.featureEach,Pe=q.featureCollection;function qe(It){var gt=new me(It);return gt.insert=function(st){if("Feature"!==st.type)throw new Error("invalid feature");return st.bbox=st.bbox?st.bbox:p(st),me.prototype.insert.call(this,st)},gt.load=function(st){var mt=[];return Array.isArray(st)?st.forEach(function(Mt){if("Feature"!==Mt.type)throw new Error("invalid features");Mt.bbox=Mt.bbox?Mt.bbox:p(Mt),mt.push(Mt)}):J(st,function(Mt){if("Feature"!==Mt.type)throw new Error("invalid features");Mt.bbox=Mt.bbox?Mt.bbox:p(Mt),mt.push(Mt)}),me.prototype.load.call(this,mt)},gt.remove=function(st,mt){if("Feature"!==st.type)throw new Error("invalid feature");return st.bbox=st.bbox?st.bbox:p(st),me.prototype.remove.call(this,st,mt)},gt.clear=function(){return me.prototype.clear.call(this)},gt.search=function(st){var mt=me.prototype.search.call(this,this.toBBox(st));return Pe(mt)},gt.collides=function(st){return me.prototype.collides.call(this,this.toBBox(st))},gt.all=function(){var st=me.prototype.all.call(this);return Pe(st)},gt.toJSON=function(){return me.prototype.toJSON.call(this)},gt.fromJSON=function(st){return me.prototype.fromJSON.call(this,st)},gt.toBBox=function(st){var mt;if(st.bbox)mt=st.bbox;else if(Array.isArray(st)&&4===st.length)mt=st;else if(Array.isArray(st)&&6===st.length)mt=[st[0],st[1],st[3],st[4]];else if("Feature"===st.type)mt=p(st);else{if("FeatureCollection"!==st.type)throw new Error("invalid geojson");mt=p(st)}return{minX:mt[0],minY:mt[1],maxX:mt[2],maxY:mt[3]}},gt}Dt.exports=qe,Dt.exports.default=qe},7192:function(Dt){Dt.exports=function(){"use strict";function ot(le,K,ne,ce,ee){!function ae(oe,te,_e,re,Je){for(;re>_e;){if(re-_e>600){var He=re-_e+1,it=te-_e+1,Ne=Math.log(He),sn=.5*Math.exp(2*Ne/3),Bt=.5*Math.sqrt(Ne*sn*(He-sn)/He)*(it-He/2<0?-1:1);ae(oe,te,Math.max(_e,Math.floor(te-it*sn/He+Bt)),Math.min(re,Math.floor(te+(He-it)*sn/He+Bt)),Je)}var Ue=oe[te],ft=_e,Tt=re;for(ve(oe,_e,te),Je(oe[re],Ue)>0&&ve(oe,_e,re);ft<Tt;){for(ve(oe,ft,Tt),ft++,Tt--;Je(oe[ft],Ue)<0;)ft++;for(;Je(oe[Tt],Ue)>0;)Tt--}0===Je(oe[_e],Ue)?ve(oe,_e,Tt):ve(oe,++Tt,re),Tt<=te&&(_e=Tt+1),te<=Tt&&(re=Tt-1)}}(le,K,ne||0,ce||le.length-1,ee||me)}function ve(le,K,ne){var ce=le[K];le[K]=le[ne],le[ne]=ce}function me(le,K){return le<K?-1:le>K?1:0}var q=function(le){void 0===le&&(le=9),this._maxEntries=Math.max(4,le),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function Ee(le,K,ne){if(!ne)return K.indexOf(le);for(var ce=0;ce<K.length;ce++)if(ne(le,K[ce]))return ce;return-1}function p(le,K){J(le,0,le.children.length,K,le)}function J(le,K,ne,ce,ee){ee||(ee=mt(null)),ee.minX=1/0,ee.minY=1/0,ee.maxX=-1/0,ee.maxY=-1/0;for(var ae=K;ae<ne;ae++){var oe=le.children[ae];ye(ee,le.leaf?ce(oe):oe)}return ee}function ye(le,K){return le.minX=Math.min(le.minX,K.minX),le.minY=Math.min(le.minY,K.minY),le.maxX=Math.max(le.maxX,K.maxX),le.maxY=Math.max(le.maxY,K.maxY),le}function Ce(le,K){return le.minX-K.minX}function Pe(le,K){return le.minY-K.minY}function qe(le){return(le.maxX-le.minX)*(le.maxY-le.minY)}function It(le){return le.maxX-le.minX+(le.maxY-le.minY)}function gt(le,K){return le.minX<=K.minX&&le.minY<=K.minY&&K.maxX<=le.maxX&&K.maxY<=le.maxY}function st(le,K){return K.minX<=le.maxX&&K.minY<=le.maxY&&K.maxX>=le.minX&&K.maxY>=le.minY}function mt(le){return{children:le,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Mt(le,K,ne,ce,ee){for(var ae=[K,ne];ae.length;)if(!((ne=ae.pop())-(K=ae.pop())<=ce)){var oe=K+Math.ceil((ne-K)/ce/2)*ce;ot(le,oe,K,ne,ee),ae.push(K,oe,oe,ne)}}return q.prototype.all=function(){return this._all(this.data,[])},q.prototype.search=function(le){var K=this.data,ne=[];if(!st(le,K))return ne;for(var ce=this.toBBox,ee=[];K;){for(var ae=0;ae<K.children.length;ae++){var oe=K.children[ae],te=K.leaf?ce(oe):oe;st(le,te)&&(K.leaf?ne.push(oe):gt(le,te)?this._all(oe,ne):ee.push(oe))}K=ee.pop()}return ne},q.prototype.collides=function(le){var K=this.data;if(!st(le,K))return!1;for(var ne=[];K;){for(var ce=0;ce<K.children.length;ce++){var ee=K.children[ce],ae=K.leaf?this.toBBox(ee):ee;if(st(le,ae)){if(K.leaf||gt(le,ae))return!0;ne.push(ee)}}K=ne.pop()}return!1},q.prototype.load=function(le){if(!le||!le.length)return this;if(le.length<this._minEntries){for(var K=0;K<le.length;K++)this.insert(le[K]);return this}var ne=this._build(le.slice(),0,le.length-1,0);if(this.data.children.length)if(this.data.height===ne.height)this._splitRoot(this.data,ne);else{if(this.data.height<ne.height){var ce=this.data;this.data=ne,ne=ce}this._insert(ne,this.data.height-ne.height-1,!0)}else this.data=ne;return this},q.prototype.insert=function(le){return le&&this._insert(le,this.data.height-1),this},q.prototype.clear=function(){return this.data=mt([]),this},q.prototype.remove=function(le,K){if(!le)return this;for(var ne,ce,ee,ae=this.data,oe=this.toBBox(le),te=[],_e=[];ae||te.length;){if(ae||(ae=te.pop(),ce=te[te.length-1],ne=_e.pop(),ee=!0),ae.leaf){var re=Ee(le,ae.children,K);if(-1!==re)return ae.children.splice(re,1),te.push(ae),this._condense(te),this}ee||ae.leaf||!gt(ae,oe)?ce?(ne++,ae=ce.children[ne],ee=!1):ae=null:(te.push(ae),_e.push(ne),ne=0,ce=ae,ae=ae.children[0])}return this},q.prototype.toBBox=function(le){return le},q.prototype.compareMinX=function(le,K){return le.minX-K.minX},q.prototype.compareMinY=function(le,K){return le.minY-K.minY},q.prototype.toJSON=function(){return this.data},q.prototype.fromJSON=function(le){return this.data=le,this},q.prototype._all=function(le,K){for(var ne=[];le;)le.leaf?K.push.apply(K,le.children):ne.push.apply(ne,le.children),le=ne.pop();return K},q.prototype._build=function(le,K,ne,ce){var ee,ae=ne-K+1,oe=this._maxEntries;if(ae<=oe)return p(ee=mt(le.slice(K,ne+1)),this.toBBox),ee;ce||(ce=Math.ceil(Math.log(ae)/Math.log(oe)),oe=Math.ceil(ae/Math.pow(oe,ce-1))),(ee=mt([])).leaf=!1,ee.height=ce;var te=Math.ceil(ae/oe),_e=te*Math.ceil(Math.sqrt(oe));Mt(le,K,ne,_e,this.compareMinX);for(var re=K;re<=ne;re+=_e){var Je=Math.min(re+_e-1,ne);Mt(le,re,Je,te,this.compareMinY);for(var He=re;He<=Je;He+=te){var it=Math.min(He+te-1,Je);ee.children.push(this._build(le,He,it,ce-1))}}return p(ee,this.toBBox),ee},q.prototype._chooseSubtree=function(le,K,ne,ce){for(;ce.push(K),!K.leaf&&ce.length-1!==ne;){for(var ee=1/0,ae=1/0,oe=void 0,te=0;te<K.children.length;te++){var _e=K.children[te],re=qe(_e),Je=(He=le,it=_e,(Math.max(it.maxX,He.maxX)-Math.min(it.minX,He.minX))*(Math.max(it.maxY,He.maxY)-Math.min(it.minY,He.minY))-re);Je<ae?(ae=Je,ee=re<ee?re:ee,oe=_e):Je===ae&&re<ee&&(ee=re,oe=_e)}K=oe||K.children[0]}var He,it;return K},q.prototype._insert=function(le,K,ne){var ce=ne?le:this.toBBox(le),ee=[],ae=this._chooseSubtree(ce,this.data,K,ee);for(ae.children.push(le),ye(ae,ce);K>=0&&ee[K].children.length>this._maxEntries;)this._split(ee,K),K--;this._adjustParentBBoxes(ce,ee,K)},q.prototype._split=function(le,K){var ne=le[K],ce=ne.children.length,ee=this._minEntries;this._chooseSplitAxis(ne,ee,ce);var ae=this._chooseSplitIndex(ne,ee,ce),oe=mt(ne.children.splice(ae,ne.children.length-ae));oe.height=ne.height,oe.leaf=ne.leaf,p(ne,this.toBBox),p(oe,this.toBBox),K?le[K-1].children.push(oe):this._splitRoot(ne,oe)},q.prototype._splitRoot=function(le,K){this.data=mt([le,K]),this.data.height=le.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},q.prototype._chooseSplitIndex=function(le,K,ne){for(var ce,ee,ae,oe,te,_e,re,Je=1/0,He=1/0,it=K;it<=ne-K;it++){var Ne=J(le,0,it,this.toBBox),sn=J(le,it,ne,this.toBBox),Bt=(ee=Ne,ae=sn,void 0,void 0,void 0,void 0,oe=Math.max(ee.minX,ae.minX),te=Math.max(ee.minY,ae.minY),_e=Math.min(ee.maxX,ae.maxX),re=Math.min(ee.maxY,ae.maxY),Math.max(0,_e-oe)*Math.max(0,re-te)),Le=qe(Ne)+qe(sn);Bt<Je?(Je=Bt,ce=it,He=Le<He?Le:He):Bt===Je&&Le<He&&(He=Le,ce=it)}return ce||ne-K},q.prototype._chooseSplitAxis=function(le,K,ne){var ce=le.leaf?this.compareMinX:Ce,ee=le.leaf?this.compareMinY:Pe;this._allDistMargin(le,K,ne,ce)<this._allDistMargin(le,K,ne,ee)&&le.children.sort(ce)},q.prototype._allDistMargin=function(le,K,ne,ce){le.children.sort(ce);for(var ee=this.toBBox,ae=J(le,0,K,ee),oe=J(le,ne-K,ne,ee),te=It(ae)+It(oe),_e=K;_e<ne-K;_e++){var re=le.children[_e];ye(ae,le.leaf?ee(re):re),te+=It(ae)}for(var Je=ne-K-1;Je>=K;Je--){var He=le.children[Je];ye(oe,le.leaf?ee(He):He),te+=It(oe)}return te},q.prototype._adjustParentBBoxes=function(le,K,ne){for(var ce=ne;ce>=0;ce--)ye(K[ce],le)},q.prototype._condense=function(le){for(var K=le.length-1,ne=void 0;K>=0;K--)0===le[K].children.length?K>0?(ne=le[K-1].children).splice(ne.indexOf(le[K]),1):this.clear():p(le[K],this.toBBox)},q}()},5203:(Dt,ot,ve)=>{"use strict";var me,q=SyntaxError,Ee=Function,p=TypeError,J=function(sn){try{return Ee('"use strict"; return ('+sn+").constructor;")()}catch{}},ye=Object.getOwnPropertyDescriptor;if(ye)try{ye({},"")}catch{ye=null}var Ce=function(){throw new p},Pe=ye?function(){try{return Ce}catch{try{return ye(arguments,"callee").get}catch{return Ce}}}():Ce,qe=ve(2969)(),It=ve(9757)(),gt=Object.getPrototypeOf||(It?function(sn){return sn.__proto__}:null),st={},mt=typeof Uint8Array>"u"||!gt?me:gt(Uint8Array),Mt={"%AggregateError%":typeof AggregateError>"u"?me:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?me:ArrayBuffer,"%ArrayIteratorPrototype%":qe&&gt?gt([][Symbol.iterator]()):me,"%AsyncFromSyncIteratorPrototype%":me,"%AsyncFunction%":st,"%AsyncGenerator%":st,"%AsyncGeneratorFunction%":st,"%AsyncIteratorPrototype%":st,"%Atomics%":typeof Atomics>"u"?me:Atomics,"%BigInt%":typeof BigInt>"u"?me:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?me:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?me:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?me:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?me:Float32Array,"%Float64Array%":typeof Float64Array>"u"?me:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?me:FinalizationRegistry,"%Function%":Ee,"%GeneratorFunction%":st,"%Int8Array%":typeof Int8Array>"u"?me:Int8Array,"%Int16Array%":typeof Int16Array>"u"?me:Int16Array,"%Int32Array%":typeof Int32Array>"u"?me:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":qe&&gt?gt(gt([][Symbol.iterator]())):me,"%JSON%":"object"==typeof JSON?JSON:me,"%Map%":typeof Map>"u"?me:Map,"%MapIteratorPrototype%":typeof Map>"u"||!qe||!gt?me:gt((new Map)[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?me:Promise,"%Proxy%":typeof Proxy>"u"?me:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?me:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?me:Set,"%SetIteratorPrototype%":typeof Set>"u"||!qe||!gt?me:gt((new Set)[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?me:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":qe&&gt?gt(""[Symbol.iterator]()):me,"%Symbol%":qe?Symbol:me,"%SyntaxError%":q,"%ThrowTypeError%":Pe,"%TypedArray%":mt,"%TypeError%":p,"%Uint8Array%":typeof Uint8Array>"u"?me:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?me:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?me:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?me:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?me:WeakMap,"%WeakRef%":typeof WeakRef>"u"?me:WeakRef,"%WeakSet%":typeof WeakSet>"u"?me:WeakSet};if(gt)try{null.error}catch(sn){var le=gt(gt(sn));Mt["%Error.prototype%"]=le}var K=function sn(Bt){var Le;if("%AsyncFunction%"===Bt)Le=J("async function () {}");else if("%GeneratorFunction%"===Bt)Le=J("function* () {}");else if("%AsyncGeneratorFunction%"===Bt)Le=J("async function* () {}");else if("%AsyncGenerator%"===Bt){var bt=sn("%AsyncGeneratorFunction%");bt&&(Le=bt.prototype)}else if("%AsyncIteratorPrototype%"===Bt){var Ue=sn("%AsyncGenerator%");Ue&&gt&&(Le=gt(Ue.prototype))}return Mt[Bt]=Le,Le},ne={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},ce=ve(4444),ee=ve(3164),ae=ce.call(Function.call,Array.prototype.concat),oe=ce.call(Function.apply,Array.prototype.splice),te=ce.call(Function.call,String.prototype.replace),_e=ce.call(Function.call,String.prototype.slice),re=ce.call(Function.call,RegExp.prototype.exec),Je=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,He=/\\(\\)?/g,Ne=function(Bt,Le){var Ue,bt=Bt;if(ee(ne,bt)&&(bt="%"+(Ue=ne[bt])[0]+"%"),ee(Mt,bt)){var ft=Mt[bt];if(ft===st&&(ft=K(bt)),typeof ft>"u"&&!Le)throw new p("intrinsic "+Bt+" exists, but is not available. Please file an issue!");return{alias:Ue,name:bt,value:ft}}throw new q("intrinsic "+Bt+" does not exist!")};Dt.exports=function(Bt,Le){if("string"!=typeof Bt||0===Bt.length)throw new p("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof Le)throw new p('"allowMissing" argument must be a boolean');if(null===re(/^%?[^%]*%?$/,Bt))throw new q("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var bt=function(Bt){var Le=_e(Bt,0,1),bt=_e(Bt,-1);if("%"===Le&&"%"!==bt)throw new q("invalid intrinsic syntax, expected closing `%`");if("%"===bt&&"%"!==Le)throw new q("invalid intrinsic syntax, expected opening `%`");var Ue=[];return te(Bt,Je,function(ft,Tt,Be,Xt){Ue[Ue.length]=Be?te(Xt,He,"$1"):Tt||ft}),Ue}(Bt),Ue=bt.length>0?bt[0]:"",ft=Ne("%"+Ue+"%",Le),Tt=ft.name,Be=ft.value,Xt=!1,Jt=ft.alias;Jt&&(Ue=Jt[0],oe(bt,ae([0,1],Jt)));for(var Rn=1,zt=!0;Rn<bt.length;Rn+=1){var Jn=bt[Rn],Mn=_e(Jn,0,1),jn=_e(Jn,-1);if(('"'===Mn||"'"===Mn||"`"===Mn||'"'===jn||"'"===jn||"`"===jn)&&Mn!==jn)throw new q("property names with quotes must have matching quotes");if(("constructor"===Jn||!zt)&&(Xt=!0),ee(Mt,Tt="%"+(Ue+="."+Jn)+"%"))Be=Mt[Tt];else if(null!=Be){if(!(Jn in Be)){if(!Le)throw new p("base intrinsic for "+Bt+" exists, but the property is not available.");return}if(ye&&Rn+1>=bt.length){var xn=ye(Be,Jn);Be=(zt=!!xn)&&"get"in xn&&!("originalValue"in xn.get)?xn.get:Be[Jn]}else zt=ee(Be,Jn),Be=Be[Jn];zt&&!Xt&&(Mt[Tt]=Be)}}return Be}},7027:(Dt,ot,ve)=>{"use strict";var q=ve(5203)("%Object.defineProperty%",!0),Ee=function(){if(q)try{return q({},"a",{value:1}),!0}catch{return!1}return!1};Ee.hasArrayLengthDefineBug=function(){if(!Ee())return null;try{return 1!==q([],"length",{value:1}).length}catch{return!0}},Dt.exports=Ee},9757:Dt=>{"use strict";var ot={foo:{}},ve=Object;Dt.exports=function(){return{__proto__:ot}.foo===ot.foo&&!({__proto__:null}instanceof ve)}},2969:(Dt,ot,ve)=>{"use strict";var me=typeof Symbol<"u"&&Symbol,q=ve(1983);Dt.exports=function(){return"function"==typeof me&&"function"==typeof Symbol&&"symbol"==typeof me("foo")&&"symbol"==typeof Symbol("bar")&&q()}},1983:Dt=>{"use strict";Dt.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var ve={},me=Symbol("test"),q=Object(me);if("string"==typeof me||"[object Symbol]"!==Object.prototype.toString.call(me)||"[object Symbol]"!==Object.prototype.toString.call(q))return!1;for(me in ve[me]=42,ve)return!1;if("function"==typeof Object.keys&&0!==Object.keys(ve).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(ve).length)return!1;var p=Object.getOwnPropertySymbols(ve);if(1!==p.length||p[0]!==me||!Object.prototype.propertyIsEnumerable.call(ve,me))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var J=Object.getOwnPropertyDescriptor(ve,me);if(42!==J.value||!0!==J.enumerable)return!1}return!0}},6259:(Dt,ot,ve)=>{"use strict";var me=ve(1983);Dt.exports=function(){return me()&&!!Symbol.toStringTag}},3164:(Dt,ot,ve)=>{"use strict";var me=ve(4444);Dt.exports=me.call(Function.call,Object.prototype.hasOwnProperty)},3407:(Dt,ot,ve)=>{"use strict";var me=ve(6259)(),Ee=ve(5834)("Object.prototype.toString"),p=function(Pe){return!(me&&Pe&&"object"==typeof Pe&&Symbol.toStringTag in Pe)&&"[object Arguments]"===Ee(Pe)},J=function(Pe){return!!p(Pe)||null!==Pe&&"object"==typeof Pe&&"number"==typeof Pe.length&&Pe.length>=0&&"[object Array]"!==Ee(Pe)&&"[object Function]"===Ee(Pe.callee)},ye=function(){return p(arguments)}();p.isLegacyArguments=J,Dt.exports=ye?p:J},2374:(Dt,ot,ve)=>{"use strict";var me=Date.prototype.getDay,Ee=Object.prototype.toString,J=ve(6259)();Dt.exports=function(Ce){return"object"==typeof Ce&&null!==Ce&&(J?function(Ce){try{return me.call(Ce),!0}catch{return!1}}(Ce):"[object Date]"===Ee.call(Ce))}},2342:(Dt,ot,ve)=>{"use strict";var Ee,p,J,ye,me=ve(5834),q=ve(6259)();if(q){Ee=me("Object.prototype.hasOwnProperty"),p=me("RegExp.prototype.exec"),J={};var Ce=function(){throw J};ye={toString:Ce,valueOf:Ce},"symbol"==typeof Symbol.toPrimitive&&(ye[Symbol.toPrimitive]=Ce)}var Pe=me("Object.prototype.toString"),qe=Object.getOwnPropertyDescriptor;Dt.exports=q?function(st){if(!st||"object"!=typeof st)return!1;var mt=qe(st,"lastIndex");if(!mt||!Ee(mt,"value"))return!1;try{p(st,ye)}catch(le){return le===J}}:function(st){return!(!st||"object"!=typeof st&&"function"!=typeof st)&&"[object RegExp]"===Pe(st)}},3082:Dt=>{var q=/^\s+|\s+$/g,Ee=/^[-+]0x[0-9a-f]+$/i,p=/^0b[01]+$/i,J=/^0o[0-7]+$/i,ye=parseInt,Ce="object"==typeof global&&global&&global.Object===Object&&global,Pe="object"==typeof self&&self&&self.Object===Object&&self,qe=Ce||Pe||Function("return this")(),gt=Object.prototype.toString,st=Math.max,mt=Math.min,Mt=function(){return qe.Date.now()};function K(ae){var oe=typeof ae;return!!ae&&("object"==oe||"function"==oe)}function ee(ae){if("number"==typeof ae)return ae;if(function ce(ae){return"symbol"==typeof ae||function ne(ae){return!!ae&&"object"==typeof ae}(ae)&&"[object Symbol]"==gt.call(ae)}(ae))return NaN;if(K(ae)){var oe="function"==typeof ae.valueOf?ae.valueOf():ae;ae=K(oe)?oe+"":oe}if("string"!=typeof ae)return 0===ae?ae:+ae;ae=ae.replace(q,"");var te=p.test(ae);return te||J.test(ae)?ye(ae.slice(2),te?2:8):Ee.test(ae)?NaN:+ae}Dt.exports=function le(ae,oe,te){var _e,re,Je,He,it,Ne,sn=0,Bt=!1,Le=!1,bt=!0;if("function"!=typeof ae)throw new TypeError("Expected a function");function Ue(Mn){var jn=_e,xn=re;return _e=re=void 0,sn=Mn,He=ae.apply(xn,jn)}function Be(Mn){var jn=Mn-Ne;return void 0===Ne||jn>=oe||jn<0||Le&&Mn-sn>=Je}function Xt(){var Mn=Mt();if(Be(Mn))return Jt(Mn);it=setTimeout(Xt,function Tt(Mn){var Nn=oe-(Mn-Ne);return Le?mt(Nn,Je-(Mn-sn)):Nn}(Mn))}function Jt(Mn){return it=void 0,bt&&_e?Ue(Mn):(_e=re=void 0,He)}function Jn(){var Mn=Mt(),jn=Be(Mn);if(_e=arguments,re=this,Ne=Mn,jn){if(void 0===it)return function ft(Mn){return sn=Mn,it=setTimeout(Xt,oe),Bt?Ue(Mn):He}(Ne);if(Le)return it=setTimeout(Xt,oe),Ue(Ne)}return void 0===it&&(it=setTimeout(Xt,oe)),He}return oe=ee(oe)||0,K(te)&&(Bt=!!te.leading,Je=(Le="maxWait"in te)?st(ee(te.maxWait)||0,oe):Je,bt="trailing"in te?!!te.trailing:bt),Jn.cancel=function Rn(){void 0!==it&&clearTimeout(it),sn=0,_e=Ne=re=it=void 0},Jn.flush=function zt(){return void 0===it?He:Jt(Mt())},Jn}},7489:function(Dt,ot,ve){var me;Dt=ve.nmd(Dt),function(){var q,ye="Expected a function",Pe="__lodash_hash_undefined__",It="__lodash_placeholder__",Ue=1/0,ft=9007199254740991,Xt=4294967295,zt=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],Jn="[object Arguments]",Mn="[object Array]",xn="[object Boolean]",Nn="[object Date]",Wi="[object Error]",Sr="[object Function]",Oi="[object GeneratorFunction]",ar="[object Map]",mr="[object Number]",Re="[object Object]",Te="[object Promise]",et="[object RegExp]",Ct="[object Set]",Yt="[object String]",yn="[object Symbol]",en="[object WeakMap]",Pr="[object ArrayBuffer]",zn="[object DataView]",Gr="[object Float32Array]",Pi="[object Float64Array]",ni="[object Int8Array]",Ci="[object Int16Array]",Ki="[object Int32Array]",ts="[object Uint8Array]",Hs="[object Uint8ClampedArray]",rt="[object Uint16Array]",xe="[object Uint32Array]",be=/\b__p \+= '';/g,tt=/\b(__p \+=) '' \+/g,ct=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ze=/&(?:amp|lt|gt|quot|#39);/g,Ft=/[&<>"']/g,Nt=RegExp(Ze.source),lt=RegExp(Ft.source),Zt=/<%-([\s\S]+?)%>/g,Cn=/<%([\s\S]+?)%>/g,Bn=/<%=([\s\S]+?)%>/g,Sn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ri=/^\w*$/,li=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Yr=/[\\^$.*+?()[\]{}|]/g,Cr=RegExp(Yr.source),fi=/^\s+/,fs=/\s/,ds=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Xr=/\{\n\/\* \[wrapped with (.+)\] \*/,ao=/,? & /,ya=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Xo=/[()=,{}\[\]\/\s]/,zi=/\\(\\)?/g,pl=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,wo=/\w*$/,uc=/^[-+]0x[0-9a-f]+$/i,Br=/^0b[01]+$/i,Lf=/^\[object .+?Constructor\]$/,ns=/^0o[0-7]+$/i,ps=/^(?:0|[1-9]\d*)$/,lc=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,gs=/($^)/,_a=/['\n\r\u2028\u2029\\]/g,ms="\\ud800-\\udfff",Na="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",on="\\u2700-\\u27bf",Wu="a-z\\xdf-\\xf6\\xf8-\\xff",Xu="A-Z\\xc0-\\xd6\\xd8-\\xde",Qr="\\ufe0e\\ufe0f",Pc="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Zr="["+ms+"]",zr="["+Pc+"]",Ya="["+Na+"]",er="\\d+",di="["+on+"]",yo="["+Wu+"]",Gl="[^"+ms+Pc+er+on+Wu+Xu+"]",Ia="\\ud83c[\\udffb-\\udfff]",ur="[^"+ms+"]",hh="(?:\\ud83c[\\udde6-\\uddff]){2}",Tn="[\\ud800-\\udbff][\\udc00-\\udfff]",Il="["+Xu+"]",Hn="(?:"+yo+"|"+Gl+")",Wc="(?:"+Il+"|"+Gl+")",dr="(?:['\u2019](?:d|ll|m|re|s|t|ve))?",vr="(?:['\u2019](?:D|LL|M|RE|S|T|VE))?",Ui="(?:"+Ya+"|"+Ia+")?",rs="["+Qr+"]?",kh=rs+Ui+"(?:\\u200d(?:"+[ur,hh,Tn].join("|")+")"+rs+Ui+")*",Us="(?:"+[di,hh,Tn].join("|")+")"+kh,Ti="(?:"+[ur+Ya+"?",Ya,hh,Tn,Zr].join("|")+")",gl=RegExp("['\u2019]","g"),ua=RegExp(Ya,"g"),As=RegExp(Ia+"(?="+Ia+")|"+Ti+kh,"g"),Rc=RegExp([Il+"?"+yo+"+"+dr+"(?="+[zr,Il,"$"].join("|")+")",Wc+"+"+vr+"(?="+[zr,Il+Hn,"$"].join("|")+")",Il+"?"+Hn+"+"+dr,Il+"+"+vr,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",er,Us].join("|"),"g"),ys=RegExp("[\\u200d"+ms+Na+Qr+"]"),la=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,va=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Pu=-1,Ji={};Ji[Gr]=Ji[Pi]=Ji[ni]=Ji[Ci]=Ji[Ki]=Ji[ts]=Ji[Hs]=Ji[rt]=Ji[xe]=!0,Ji[Jn]=Ji[Mn]=Ji[Pr]=Ji[xn]=Ji[zn]=Ji[Nn]=Ji[Wi]=Ji[Sr]=Ji[ar]=Ji[mr]=Ji[Re]=Ji[et]=Ji[Ct]=Ji[Yt]=Ji[en]=!1;var Hr={};Hr[Jn]=Hr[Mn]=Hr[Pr]=Hr[zn]=Hr[xn]=Hr[Nn]=Hr[Gr]=Hr[Pi]=Hr[ni]=Hr[Ci]=Hr[Ki]=Hr[ar]=Hr[mr]=Hr[Re]=Hr[et]=Hr[Ct]=Hr[Yt]=Hr[yn]=Hr[ts]=Hr[Hs]=Hr[rt]=Hr[xe]=!0,Hr[Wi]=Hr[Sr]=Hr[en]=!1;var Yu={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},sr=parseFloat,os=parseInt,Ku="object"==typeof global&&global&&global.Object===Object&&global,cc="object"==typeof self&&self&&self.Object===Object&&self,Zo=Ku||cc||Function("return this")(),Xc=ot&&!ot.nodeType&&ot,Ju=Xc&&Dt&&!Dt.nodeType&&Dt,ca=Ju&&Ju.exports===Xc,ka=ca&&Ku.process,Qi=function(){try{return Ju&&Ju.require&&Ju.require("util").types||ka&&ka.binding&&ka.binding("util")}catch{}}(),hc=Qi&&Qi.isArrayBuffer,Ru=Qi&&Qi.isDate,Rr=Qi&&Qi.isMap,Yo=Qi&&Qi.isRegExp,hr=Qi&&Qi.isSet,ii=Qi&&Qi.isTypedArray;function Ja(Lt,un,Qt){switch(Qt.length){case 0:return Lt.call(un);case 1:return Lt.call(un,Qt[0]);case 2:return Lt.call(un,Qt[0],Qt[1]);case 3:return Lt.call(un,Qt[0],Qt[1],Qt[2])}return Lt.apply(un,Qt)}function uu(Lt,un,Qt,ir){for(var Tr=-1,qi=null==Lt?0:Lt.length;++Tr<qi;){var Es=Lt[Tr];un(ir,Es,Qt(Es),Lt)}return ir}function oi(Lt,un){for(var Qt=-1,ir=null==Lt?0:Lt.length;++Qt<ir&&!1!==un(Lt[Qt],Qt,Lt););return Lt}function Lc(Lt,un){for(var Qt=null==Lt?0:Lt.length;Qt--&&!1!==un(Lt[Qt],Qt,Lt););return Lt}function Fh(Lt,un){for(var Qt=-1,ir=null==Lt?0:Lt.length;++Qt<ir;)if(!un(Lt[Qt],Qt,Lt))return!1;return!0}function $l(Lt,un){for(var Qt=-1,ir=null==Lt?0:Lt.length,Tr=0,qi=[];++Qt<ir;){var Es=Lt[Qt];un(Es,Qt,Lt)&&(qi[Tr++]=Es)}return qi}function Qu(Lt,un){return!(null==Lt||!Lt.length)&&Lu(Lt,un,0)>-1}function Si(Lt,un,Qt){for(var ir=-1,Tr=null==Lt?0:Lt.length;++ir<Tr;)if(Qt(un,Lt[ir]))return!0;return!1}function Ni(Lt,un){for(var Qt=-1,ir=null==Lt?0:Lt.length,Tr=Array(ir);++Qt<ir;)Tr[Qt]=un(Lt[Qt],Qt,Lt);return Tr}function ki(Lt,un){for(var Qt=-1,ir=un.length,Tr=Lt.length;++Qt<ir;)Lt[Tr+Qt]=un[Qt];return Lt}function ml(Lt,un,Qt,ir){var Tr=-1,qi=null==Lt?0:Lt.length;for(ir&&qi&&(Qt=Lt[++Tr]);++Tr<qi;)Qt=un(Qt,Lt[Tr],Tr,Lt);return Qt}function Qa(Lt,un,Qt,ir){var Tr=null==Lt?0:Lt.length;for(ir&&Tr&&(Qt=Lt[--Tr]);Tr--;)Qt=un(Qt,Lt[Tr],Tr,Lt);return Qt}function Bh(Lt,un){for(var Qt=-1,ir=null==Lt?0:Lt.length;++Qt<ir;)if(un(Lt[Qt],Qt,Lt))return!0;return!1}var ei=ha("length");function Nc(Lt,un,Qt){var ir;return Qt(Lt,function(Tr,qi,Es){if(un(Tr,qi,Es))return ir=qi,!1}),ir}function fr(Lt,un,Qt,ir){for(var Tr=Lt.length,qi=Qt+(ir?1:-1);ir?qi--:++qi<Tr;)if(un(Lt[qi],qi,Lt))return qi;return-1}function Lu(Lt,un,Qt){return un==un?function Of(Lt,un,Qt){for(var ir=Qt-1,Tr=Lt.length;++ir<Tr;)if(Lt[ir]===un)return ir;return-1}(Lt,un,Qt):fr(Lt,xu,Qt)}function qn(Lt,un,Qt,ir){for(var Tr=Qt-1,qi=Lt.length;++Tr<qi;)if(ir(Lt[Tr],un))return Tr;return-1}function xu(Lt){return Lt!=Lt}function Fi(Lt,un){var Qt=null==Lt?0:Lt.length;return Qt?ss(Lt,un)/Qt:NaN}function ha(Lt){return function(un){return null==un?q:un[Lt]}}function kc(Lt){return function(un){return null==Lt?q:Lt[un]}}function eu(Lt,un,Qt,ir,Tr){return Tr(Lt,function(qi,Es,eo){Qt=ir?(ir=!1,qi):un(Qt,qi,Es,eo)}),Qt}function ss(Lt,un){for(var Qt,ir=-1,Tr=Lt.length;++ir<Tr;){var qi=un(Lt[ir]);qi!==q&&(Qt=Qt===q?qi:Qt+qi)}return Qt}function Tl(Lt,un){for(var Qt=-1,ir=Array(Lt);++Qt<Lt;)ir[Qt]=un(Qt);return ir}function Ta(Lt){return Lt&&Lt.slice(0,ta(Lt)+1).replace(fi,"")}function Lr(Lt){return function(un){return Lt(un)}}function Ou(Lt,un){return Ni(un,function(Qt){return Lt[Qt]})}function Ws(Lt,un){return Lt.has(un)}function wu(Lt,un){for(var Qt=-1,ir=Lt.length;++Qt<ir&&Lu(un,Lt[Qt],0)>-1;);return Qt}function tl(Lt,un){for(var Qt=Lt.length;Qt--&&Lu(un,Lt[Qt],0)>-1;);return Qt}var tu=kc({\u00c0:"A",\u00c1:"A",\u00c2:"A",\u00c3:"A",\u00c4:"A",\u00c5:"A",\u00e0:"a",\u00e1:"a",\u00e2:"a",\u00e3:"a",\u00e4:"a",\u00e5:"a",\u00c7:"C",\u00e7:"c",\u00d0:"D",\u00f0:"d",\u00c8:"E",\u00c9:"E",\u00ca:"E",\u00cb:"E",\u00e8:"e",\u00e9:"e",\u00ea:"e",\u00eb:"e",\u00cc:"I",\u00cd:"I",\u00ce:"I",\u00cf:"I",\u00ec:"i",\u00ed:"i",\u00ee:"i",\u00ef:"i",\u00d1:"N",\u00f1:"n",\u00d2:"O",\u00d3:"O",\u00d4:"O",\u00d5:"O",\u00d6:"O",\u00d8:"O",\u00f2:"o",\u00f3:"o",\u00f4:"o",\u00f5:"o",\u00f6:"o",\u00f8:"o",\u00d9:"U",\u00da:"U",\u00db:"U",\u00dc:"U",\u00f9:"u",\u00fa:"u",\u00fb:"u",\u00fc:"u",\u00dd:"Y",\u00fd:"y",\u00ff:"y",\u00c6:"Ae",\u00e6:"ae",\u00de:"Th",\u00fe:"th",\u00df:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010a:"C",\u010c:"C",\u0107:"c",\u0109:"c",\u010b:"c",\u010d:"c",\u010e:"D",\u0110:"D",\u010f:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011a:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011b:"e",\u011c:"G",\u011e:"G",\u0120:"G",\u0122:"G",\u011d:"g",\u011f:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012a:"I",\u012c:"I",\u012e:"I",\u0130:"I",\u0129:"i",\u012b:"i",\u012d:"i",\u012f:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013b:"L",\u013d:"L",\u013f:"L",\u0141:"L",\u013a:"l",\u013c:"l",\u013e:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014a:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014b:"n",\u014c:"O",\u014e:"O",\u0150:"O",\u014d:"o",\u014f:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015a:"S",\u015c:"S",\u015e:"S",\u0160:"S",\u015b:"s",\u015d:"s",\u015f:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016a:"U",\u016c:"U",\u016e:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016b:"u",\u016d:"u",\u016f:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017b:"Z",\u017d:"Z",\u017a:"z",\u017c:"z",\u017e:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017f:"s"}),Ps=kc({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function lf(Lt){return"\\"+Yu[Lt]}function Rs(Lt){return ys.test(Lt)}function fh(Lt){var un=-1,Qt=Array(Lt.size);return Lt.forEach(function(ir,Tr){Qt[++un]=[Tr,ir]}),Qt}function fa(Lt,un){return function(Qt){return Lt(un(Qt))}}function dc(Lt,un){for(var Qt=-1,ir=Lt.length,Tr=0,qi=[];++Qt<ir;){var Es=Lt[Qt];(Es===un||Es===It)&&(Lt[Qt]=It,qi[Tr++]=Qt)}return qi}function ql(Lt){var un=-1,Qt=Array(Lt.size);return Lt.forEach(function(ir){Qt[++un]=ir}),Qt}function Eu(Lt){return Rs(Lt)?function Ma(Lt){for(var un=As.lastIndex=0;As.test(Lt);)++un;return un}(Lt):ei(Lt)}function ea(Lt){return Rs(Lt)?function Ml(Lt){return Lt.match(As)||[]}(Lt):function Oc(Lt){return Lt.split("")}(Lt)}function ta(Lt){for(var un=Lt.length;un--&&fs.test(Lt.charAt(un)););return un}var Uh=kc({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),_l=function Lt(un){var v,Qt=(un=null==un?Zo:_l.defaults(Zo.Object(),un,_l.pick(Zo,va))).Array,ir=un.Date,Tr=un.Error,qi=un.Function,Es=un.Math,eo=un.Object,Vi=un.RegExp,Xi=un.String,$r=un.TypeError,uo=Qt.prototype,Da=eo.prototype,to=un["__core-js_shared__"],Zs=qi.prototype.toString,lo=Da.hasOwnProperty,as=0,Fc=(v=/[^.]+$/.exec(to&&to.keys&&to.keys.IE_PROTO||""))?"Symbol(src)_1."+v:"",nu=Da.toString,Ri=Zs.call(eo),bn=Zo._,qr=Vi("^"+Zs.call(lo).replace(Yr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),co=ca?un.Buffer:q,_o=un.Symbol,xa=un.Uint8Array,io=co?co.allocUnsafe:q,da=fa(eo.getPrototypeOf,eo),Ur=eo.create,Bc=Da.propertyIsEnumerable,nl=uo.splice,pr=_o?_o.isConcatSpreadable:q,pa=_o?_o.iterator:q,Dl=_o?_o.toStringTag:q,za=function(){try{var v=Xh(eo,"defineProperty");return v({},"",{}),v}catch{}}(),vo=un.clearTimeout!==Zo.clearTimeout&&un.clearTimeout,_s=ir&&ir.now!==Zo.Date.now&&ir.now,Ls=un.setTimeout!==Zo.setTimeout&&un.setTimeout,$n=Es.ceil,ho=Es.floor,dh=eo.getOwnPropertySymbols,ku=co?co.isBuffer:q,fo=un.isFinite,wa=uo.join,ru=fa(eo.keys,eo),Or=Es.max,ba=Es.min,Vh=ir.now,fd=un.parseInt,Ys=Es.random,rl=uo.reverse,Fu=Xh(un,"DataView"),Hl=Xh(un,"Map"),js=Xh(un,"Promise"),cu=Xh(un,"Set"),na=Xh(un,"WeakMap"),Gs=Xh(eo,"create"),Bu=na&&new na,xr={},Cu=gf(Fu),Aa=gf(Hl),Al=gf(js),Su=gf(cu),dd=gf(na),Ua=_o?_o.prototype:q,no=Ua?Ua.valueOf:q,pd=Ua?Ua.toString:q;function ke(v){if($a(v)&&!Ii(v)&&!(v instanceof x)){if(v instanceof y)return v;if(lo.call(v,"__wrapped__"))return cs(v)}return new y(v)}var a=function(){function v(){}return function(T){if(!Pa(T))return{};if(Ur)return Ur(T);v.prototype=T;var F=new v;return v.prototype=q,F}}();function h(){}function y(v,T){this.__wrapped__=v,this.__actions__=[],this.__chain__=!!T,this.__index__=0,this.__values__=q}function x(v){this.__wrapped__=v,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Xt,this.__views__=[]}function pe(v){var T=-1,F=null==v?0:v.length;for(this.clear();++T<F;){var Y=v[T];this.set(Y[0],Y[1])}}function kn(v){var T=-1,F=null==v?0:v.length;for(this.clear();++T<F;){var Y=v[T];this.set(Y[0],Y[1])}}function ma(v){var T=-1,F=null==v?0:v.length;for(this.clear();++T<F;){var Y=v[T];this.set(Y[0],Y[1])}}function zu(v){var T=-1,F=null==v?0:v.length;for(this.__data__=new ma;++T<F;)this.add(v[T])}function Wl(v){var T=this.__data__=new kn(v);this.size=T.size}function Bf(v,T){var F=Ii(v),Y=!F&&Eh(v),we=!F&&!Y&&Gc(v),Xe=!F&&!Y&&!we&&Qf(v),yt=F||Y||we||Xe,At=yt?Tl(v.length,Xi):[],jt=At.length;for(var Pn in v)(T||lo.call(v,Pn))&&(!yt||!("length"==Pn||we&&("offset"==Pn||"parent"==Pn)||Xe&&("buffer"==Pn||"byteLength"==Pn||"byteOffset"==Pn)||vh(Pn,jt)))&&At.push(Pn);return At}function w(v){var T=v.length;return T?v[jh(0,T-1)]:q}function l(v,T){return rp(Rl(v),se(T,0,v.length))}function g(v){return rp(Rl(v))}function C(v,T,F){(F!==q&&!Ec(v[T],F)||F===q&&!(T in v))&&X(v,T,F)}function M(v,T,F){var Y=v[T];(!lo.call(v,T)||!Ec(Y,F)||F===q&&!(T in v))&&X(v,T,F)}function P(v,T){for(var F=v.length;F--;)if(Ec(v[F][0],T))return F;return-1}function k(v,T,F,Y){return ue(v,function(we,Xe,yt){T(Y,we,F(we),yt)}),Y}function z(v,T){return v&&fu(T,Tu(T),v)}function X(v,T,F){"__proto__"==T&&za?za(v,T,{configurable:!0,enumerable:!0,value:F,writable:!0}):v[T]=F}function Z(v,T){for(var F=-1,Y=T.length,we=Qt(Y),Xe=null==v;++F<Y;)we[F]=Xe?q:pg(v,T[F]);return we}function se(v,T,F){return v==v&&(F!==q&&(v=v<=F?v:F),T!==q&&(v=v>=T?v:T)),v}function Ie(v,T,F,Y,we,Xe){var yt,At=1&T,jt=2&T,Pn=4&T;if(F&&(yt=we?F(v,Y,we,Xe):F(v)),yt!==q)return yt;if(!Pa(v))return v;var An=Ii(v);if(An){if(yt=function qf(v){var T=v.length,F=new v.constructor(T);return T&&"string"==typeof v[0]&&lo.call(v,"index")&&(F.index=v.index,F.input=v.input),F}(v),!At)return Rl(v,yt)}else{var Fn=du(v),rr=Fn==Sr||Fn==Oi;if(Gc(v))return ny(v,At);if(Fn==Re||Fn==Jn||rr&&!we){if(yt=jt||rr?{}:Hf(v),!At)return jt?function Jc(v,T){return fu(v,al(v),T)}(v,function G(v,T){return v&&fu(T,ul(T),v)}(yt,v)):function ry(v,T){return fu(v,Yp(v),T)}(v,z(yt,v))}else{if(!Hr[Fn])return we?v:{};yt=function vl(v,T,F){var Y=v.constructor;switch(T){case Pr:return _c(v);case xn:case Nn:return new Y(+v);case zn:return function x_(v,T){var F=T?_c(v.buffer):v.buffer;return new v.constructor(F,v.byteOffset,v.byteLength)}(v,F);case Gr:case Pi:case ni:case Ci:case Ki:case ts:case Hs:case rt:case xe:return Ir(v,F);case ar:return new Y;case mr:case Yt:return new Y(v);case et:return function Vg(v){var T=new v.constructor(v.source,wo.exec(v));return T.lastIndex=v.lastIndex,T}(v);case Ct:return new Y;case yn:return function Ns(v){return no?eo(no.call(v)):{}}(v)}}(v,Fn,At)}}Xe||(Xe=new Wl);var Nr=Xe.get(v);if(Nr)return Nr;Xe.set(v,yt),dg(v)?v.forEach(function(mi){yt.add(Ie(mi,T,F,mi,v,Xe))}):Ny(v)&&v.forEach(function(mi,Gi){yt.set(Gi,Ie(mi,T,F,Gi,v,Xe))});var Yi=An?q:(Pn?jt?Ed:$g:jt?ul:Tu)(v);return oi(Yi||v,function(mi,Gi){Yi&&(mi=v[Gi=mi]),M(yt,Gi,Ie(mi,T,F,Gi,v,Xe))}),yt}function $e(v,T,F){var Y=F.length;if(null==v)return!Y;for(v=eo(v);Y--;){var we=F[Y],yt=v[we];if(yt===q&&!(we in v)||!(0,T[we])(yt))return!1}return!0}function je(v,T,F){if("function"!=typeof v)throw new $r(ye);return pf(function(){v.apply(q,F)},T)}function We(v,T,F,Y){var we=-1,Xe=Qu,yt=!0,At=v.length,jt=[],Pn=T.length;if(!At)return jt;F&&(T=Ni(T,Lr(F))),Y?(Xe=Si,yt=!1):T.length>=200&&(Xe=Ws,yt=!1,T=new zu(T));e:for(;++we<At;){var An=v[we],Fn=null==F?An:F(An);if(An=Y||0!==An?An:0,yt&&Fn==Fn){for(var rr=Pn;rr--;)if(T[rr]===Fn)continue e;jt.push(An)}else Xe(T,Fn,Y)||jt.push(An)}return jt}ke.templateSettings={escape:Zt,evaluate:Cn,interpolate:Bn,variable:"",imports:{_:ke}},(ke.prototype=h.prototype).constructor=ke,(y.prototype=a(h.prototype)).constructor=y,(x.prototype=a(h.prototype)).constructor=x,pe.prototype.clear=function Ge(){this.__data__=Gs?Gs(null):{},this.size=0},pe.prototype.delete=function wt(v){var T=this.has(v)&&delete this.__data__[v];return this.size-=T?1:0,T},pe.prototype.get=function qt(v){var T=this.__data__;if(Gs){var F=T[v];return F===Pe?q:F}return lo.call(T,v)?T[v]:q},pe.prototype.has=function nn(v){var T=this.__data__;return Gs?T[v]!==q:lo.call(T,v)},pe.prototype.set=function Wn(v,T){var F=this.__data__;return this.size+=this.has(v)?0:1,F[v]=Gs&&T===q?Pe:T,this},kn.prototype.clear=function tr(){this.__data__=[],this.size=0},kn.prototype.delete=function lr(v){var T=this.__data__,F=P(T,v);return!(F<0||(F==T.length-1?T.pop():nl.call(T,F,1),--this.size,0))},kn.prototype.get=function ji(v){var T=this.__data__,F=P(T,v);return F<0?q:T[F][1]},kn.prototype.has=function Gn(v){return P(this.__data__,v)>-1},kn.prototype.set=function ga(v,T){var F=this.__data__,Y=P(F,v);return Y<0?(++this.size,F.push([v,T])):F[Y][1]=T,this},ma.prototype.clear=function il(){this.size=0,this.__data__={hash:new pe,map:new(Hl||kn),string:new pe}},ma.prototype.delete=function zc(v){var T=Wh(this,v).delete(v);return this.size-=T?1:0,T},ma.prototype.get=function Kn(v){return Wh(this,v).get(v)},ma.prototype.has=function Bg(v){return Wh(this,v).has(v)},ma.prototype.set=function Jm(v,T){var F=Wh(this,v),Y=F.size;return F.set(v,T),this.size+=F.size==Y?0:1,this},zu.prototype.add=zu.prototype.push=function kf(v){return this.__data__.set(v,Pe),this},zu.prototype.has=function hu(v){return this.__data__.has(v)},Wl.prototype.clear=function __(){this.__data__=new kn,this.size=0},Wl.prototype.delete=function $p(v){var T=this.__data__,F=T.delete(v);return this.size=T.size,F},Wl.prototype.get=function gd(v){return this.__data__.get(v)},Wl.prototype.has=function Ff(v){return this.__data__.has(v)},Wl.prototype.set=function qp(v,T){var F=this.__data__;if(F instanceof kn){var Y=F.__data__;if(!Hl||Y.length<199)return Y.push([v,T]),this.size=++F.size,this;F=this.__data__=new ma(Y)}return F.set(v,T),this.size=F.size,this};var ue=iy(kt),Fe=iy(Dn,!0);function nt(v,T){var F=!0;return ue(v,function(Y,we,Xe){return F=!!T(Y,we,Xe)}),F}function Qe(v,T,F){for(var Y=-1,we=v.length;++Y<we;){var Xe=v[Y],yt=T(Xe);if(null!=yt&&(At===q?yt==yt&&!nh(yt):F(yt,At)))var At=yt,jt=Xe}return jt}function St(v,T){var F=[];return ue(v,function(Y,we,Xe){T(Y,we,Xe)&&F.push(Y)}),F}function at(v,T,F,Y,we){var Xe=-1,yt=v.length;for(F||(F=t0),we||(we=[]);++Xe<yt;){var At=v[Xe];T>0&&F(At)?T>1?at(At,T-1,F,Y,we):ki(we,At):Y||(we[we.length]=At)}return we}var Ot=yd(),Rt=yd(!0);function kt(v,T){return v&&Ot(v,T,Tu)}function Dn(v,T){return v&&Rt(v,T,Tu)}function Ut(v,T){return $l(T,function(F){return $c(v[F])})}function an(v,T){for(var F=0,Y=(T=Os(T,v)).length;null!=v&&F<Y;)v=v[Vc(T[F++])];return F&&F==Y?v:q}function Ht(v,T,F){var Y=T(v);return Ii(v)?Y:ki(Y,F(v))}function gn(v){return null==v?v===q?"[object Undefined]":"[object Null]":Dl&&Dl in eo(v)?function Zp(v){var T=lo.call(v,Dl),F=v[Dl];try{v[Dl]=q;var Y=!0}catch{}var we=nu.call(v);return Y&&(T?v[Dl]=F:delete v[Dl]),we}(v):function Ll(v){return nu.call(v)}(v)}function Gt(v,T){return v>T}function fn(v,T){return null!=v&&lo.call(v,T)}function En(v,T){return null!=v&&T in eo(v)}function Ln(v,T,F){for(var Y=F?Si:Qu,we=v[0].length,Xe=v.length,yt=Xe,At=Qt(Xe),jt=1/0,Pn=[];yt--;){var An=v[yt];yt&&T&&(An=Ni(An,Lr(T))),jt=ba(An.length,jt),At[yt]=!F&&(T||we>=120&&An.length>=120)?new zu(yt&&An):q}An=v[0];var Fn=-1,rr=At[0];e:for(;++Fn<we&&Pn.length<jt;){var Nr=An[Fn],gi=T?T(Nr):Nr;if(Nr=F||0!==Nr?Nr:0,!(rr?Ws(rr,gi):Y(Pn,gi,F))){for(yt=Xe;--yt;){var Yi=At[yt];if(!(Yi?Ws(Yi,gi):Y(v[yt],gi,F)))continue e}rr&&rr.push(gi),Pn.push(Nr)}}return Pn}function Vr(v,T,F){var Y=null==(v=Hg(v,T=Os(T,v)))?v:v[Vc(jc(T))];return null==Y?q:Ja(Y,v,F)}function or(v){return $a(v)&&gn(v)==Jn}function ci(v,T,F,Y,we){return v===T||(null==v||null==T||!$a(v)&&!$a(T)?v!=v&&T!=T:function yr(v,T,F,Y,we,Xe){var yt=Ii(v),At=Ii(T),jt=yt?Mn:du(v),Pn=At?Mn:du(T),An=(jt=jt==Jn?Re:jt)==Re,Fn=(Pn=Pn==Jn?Re:Pn)==Re,rr=jt==Pn;if(rr&&Gc(v)){if(!Gc(T))return!1;yt=!0,An=!1}if(rr&&!An)return Xe||(Xe=new Wl),yt||Qf(v)?Gg(v,T,F,Y,we,Xe):function sy(v,T,F,Y,we,Xe,yt){switch(F){case zn:if(v.byteLength!=T.byteLength||v.byteOffset!=T.byteOffset)return!1;v=v.buffer,T=T.buffer;case Pr:return!(v.byteLength!=T.byteLength||!Xe(new xa(v),new xa(T)));case xn:case Nn:case mr:return Ec(+v,+T);case Wi:return v.name==T.name&&v.message==T.message;case et:case Yt:return v==T+"";case ar:var At=fh;case Ct:if(At||(At=ql),v.size!=T.size&&!(1&Y))return!1;var Pn=yt.get(v);if(Pn)return Pn==T;Y|=2,yt.set(v,T);var An=Gg(At(v),At(T),Y,we,Xe,yt);return yt.delete(v),An;case yn:if(no)return no.call(v)==no.call(T)}return!1}(v,T,jt,F,Y,we,Xe);if(!(1&F)){var Nr=An&&lo.call(v,"__wrapped__"),gi=Fn&&lo.call(T,"__wrapped__");if(Nr||gi){var Yi=Nr?v.value():v,mi=gi?T.value():T;return Xe||(Xe=new Wl),we(Yi,mi,F,Y,Xe)}}return!!rr&&(Xe||(Xe=new Wl),function $f(v,T,F,Y,we,Xe){var yt=1&F,At=$g(v),jt=At.length;if(jt!=$g(T).length&&!yt)return!1;for(var Fn=jt;Fn--;){var rr=At[Fn];if(!(yt?rr in T:lo.call(T,rr)))return!1}var Nr=Xe.get(v),gi=Xe.get(T);if(Nr&&gi)return Nr==T&&gi==v;var Yi=!0;Xe.set(v,T),Xe.set(T,v);for(var mi=yt;++Fn<jt;){var Gi=v[rr=At[Fn]],po=T[rr];if(Y)var Ic=yt?Y(po,Gi,rr,T,v,Xe):Y(Gi,po,rr,v,T,Xe);if(!(Ic===q?Gi===po||we(Gi,po,F,Y,Xe):Ic)){Yi=!1;break}mi||(mi="constructor"==rr)}if(Yi&&!mi){var Tc=v.constructor,xl=T.constructor;Tc!=xl&&"constructor"in v&&"constructor"in T&&!("function"==typeof Tc&&Tc instanceof Tc&&"function"==typeof xl&&xl instanceof xl)&&(Yi=!1)}return Xe.delete(v),Xe.delete(T),Yi}(v,T,F,Y,we,Xe))}(v,T,F,Y,ci,we))}function Ko(v,T,F,Y){var we=F.length,Xe=we,yt=!Y;if(null==v)return!Xe;for(v=eo(v);we--;){var At=F[we];if(yt&&At[2]?At[1]!==v[At[0]]:!(At[0]in v))return!1}for(;++we<Xe;){var jt=(At=F[we])[0],Pn=v[jt],An=At[1];if(yt&&At[2]){if(Pn===q&&!(jt in v))return!1}else{var Fn=new Wl;if(Y)var rr=Y(Pn,An,jt,v,T,Fn);if(!(rr===q?ci(An,Pn,3,Y,Fn):rr))return!1}}return!0}function us(v){return!(!Pa(v)||function ep(v){return!!Fc&&Fc in v}(v))&&($c(v)?qr:Lf).test(gf(v))}function Xl(v){return"function"==typeof v?v:null==v?Bl:"object"==typeof v?Ii(v)?ol(v[0],v[1]):Wr(v):Eg(v)}function pc(v){if(!Kp(v))return ru(v);var T=[];for(var F in eo(v))lo.call(v,F)&&"constructor"!=F&&T.push(F);return T}function Jo(v,T){return v<T}function ln(v,T){var F=-1,Y=kl(v)?Qt(v.length):[];return ue(v,function(we,Xe,yt){Y[++F]=T(we,Xe,yt)}),Y}function Wr(v){var T=Sd(v);return 1==T.length&&T[0][2]?Ga(T[0][0],T[0][1]):function(F){return F===v||Ko(F,v,T)}}function ol(v,T){return w_(v)&&n0(T)?Ga(Vc(v),T):function(F){var Y=pg(F,v);return Y===q&&Y===T?Fl(F,v):ci(T,Y,3)}}function vs(v,T,F,Y,we){v!==T&&Ot(T,function(Xe,yt){if(we||(we=new Wl),Pa(Xe))!function xs(v,T,F,Y,we,Xe,yt){var At=df(v,F),jt=df(T,F),Pn=yt.get(jt);if(Pn)C(v,F,Pn);else{var An=Xe?Xe(At,jt,F+"",v,T,yt):q,Fn=An===q;if(Fn){var rr=Ii(jt),Nr=!rr&&Gc(jt),gi=!rr&&!Nr&&Qf(jt);An=jt,rr||Nr||gi?Ii(At)?An=At:Ea(At)?An=Rl(At):Nr?(Fn=!1,An=ny(jt,!0)):gi?(Fn=!1,An=Ir(jt,!0)):An=[]:ef(jt)||Eh(jt)?(An=At,Eh(At)?An=b0(At):(!Pa(At)||$c(At))&&(An=Hf(jt))):Fn=!1}Fn&&(yt.set(jt,An),we(An,jt,Y,Xe,yt),yt.delete(jt)),C(v,F,An)}}(v,T,yt,F,vs,Y,we);else{var At=Y?Y(df(v,yt),Xe,yt+"",v,T,we):q;At===q&&(At=Xe),C(v,yt,At)}},ul)}function zf(v,T){var F=v.length;if(F)return vh(T+=T<0?F:0,F)?v[T]:q}function gc(v,T,F){T=T.length?Ni(T,function(Xe){return Ii(Xe)?function(yt){return an(yt,1===Xe.length?Xe[0]:Xe)}:Xe}):[Bl];var Y=-1;return T=Ni(T,Lr(si())),function lu(Lt,un){var Qt=Lt.length;for(Lt.sort(un);Qt--;)Lt[Qt]=Lt[Qt].value;return Lt}(ln(v,function(Xe,yt,At){return{criteria:Ni(T,function(Pn){return Pn(Xe)}),index:++Y,value:Xe}}),function(Xe,yt){return function md(v,T,F){for(var Y=-1,we=v.criteria,Xe=T.criteria,yt=we.length,At=F.length;++Y<yt;){var jt=Kc(we[Y],Xe[Y]);if(jt)return Y>=At?jt:jt*("desc"==F[Y]?-1:1)}return v.index-T.index}(Xe,yt,F)})}function mc(v,T,F){for(var Y=-1,we=T.length,Xe={};++Y<we;){var yt=T[Y],At=an(v,yt);F(At,yt)&&Uf(Xe,Os(yt,v),At)}return Xe}function ph(v,T,F,Y){var we=Y?qn:Lu,Xe=-1,yt=T.length,At=v;for(v===T&&(T=Rl(T)),F&&(At=Ni(v,Lr(F)));++Xe<yt;)for(var jt=0,Pn=T[Xe],An=F?F(Pn):Pn;(jt=we(At,An,jt,Y))>-1;)At!==v&&nl.call(At,jt,1),nl.call(v,jt,1);return v}function Wd(v,T){for(var F=v?T.length:0,Y=F-1;F--;){var we=T[F];if(F==Y||we!==Xe){var Xe=we;vh(we)?nl.call(v,we,1):Vf(v,we)}}return v}function jh(v,T){return v+ho(Ys()*(T-v+1))}function Yc(v,T){var F="";if(!v||T<1||T>ft)return F;do{T%2&&(F+=v),(T=ho(T/2))&&(v+=v)}while(T);return F}function Zi(v,T){return Wg(ff(v,T,Bl),v+"")}function Xd(v){return w(ed(v))}function gh(v,T){var F=ed(v);return rp(F,se(T,0,F.length))}function Uf(v,T,F,Y){if(!Pa(v))return v;for(var we=-1,Xe=(T=Os(T,v)).length,yt=Xe-1,At=v;null!=At&&++we<Xe;){var jt=Vc(T[we]),Pn=F;if("__proto__"===jt||"constructor"===jt||"prototype"===jt)return v;if(we!=yt){var An=At[jt];(Pn=Y?Y(An,jt,At):q)===q&&(Pn=Pa(An)?An:vh(T[we+1])?[]:{})}M(At,jt,Pn),At=At[jt]}return v}var zg=Bu?function(v,T){return Bu.set(v,T),v}:Bl,Qm=za?function(v,T){return za(v,"toString",{configurable:!0,enumerable:!1,value:Th(T),writable:!0})}:Bl;function Ug(v){return rp(ed(v))}function iu(v,T,F){var Y=-1,we=v.length;T<0&&(T=-T>we?0:we+T),(F=F>we?we:F)<0&&(F+=we),we=T>F?0:F-T>>>0,T>>>=0;for(var Xe=Qt(we);++Y<we;)Xe[Y]=v[Y+T];return Xe}function Zd(v,T){var F;return ue(v,function(Y,we,Xe){return!(F=T(Y,we,Xe))}),!!F}function Yd(v,T,F){var Y=0,we=null==v?Y:v.length;if("number"==typeof T&&T==T&&we<=2147483647){for(;Y<we;){var Xe=Y+we>>>1,yt=v[Xe];null!==yt&&!nh(yt)&&(F?yt<=T:yt<T)?Y=Xe+1:we=Xe}return we}return Kd(v,T,Bl,F)}function Kd(v,T,F,Y){var we=0,Xe=null==v?0:v.length;if(0===Xe)return 0;for(var yt=(T=F(T))!=T,At=null===T,jt=nh(T),Pn=T===q;we<Xe;){var An=ho((we+Xe)/2),Fn=F(v[An]),rr=Fn!==q,Nr=null===Fn,gi=Fn==Fn,Yi=nh(Fn);if(yt)var mi=Y||gi;else mi=Pn?gi&&(Y||rr):At?gi&&rr&&(Y||!Nr):jt?gi&&rr&&!Nr&&(Y||!Yi):!Nr&&!Yi&&(Y?Fn<=T:Fn<T);mi?we=An+1:Xe=An}return ba(Xe,4294967294)}function v_(v,T){for(var F=-1,Y=v.length,we=0,Xe=[];++F<Y;){var yt=v[F],At=T?T(yt):yt;if(!F||!Ec(At,jt)){var jt=At;Xe[we++]=0===yt?0:yt}}return Xe}function ey(v){return"number"==typeof v?v:nh(v)?NaN:+v}function Zl(v){if("string"==typeof v)return v;if(Ii(v))return Ni(v,Zl)+"";if(nh(v))return pd?pd.call(v):"";var T=v+"";return"0"==T&&1/v==-Ue?"-0":T}function mh(v,T,F){var Y=-1,we=Qu,Xe=v.length,yt=!0,At=[],jt=At;if(F)yt=!1,we=Si;else if(Xe>=200){var Pn=T?null:ra(v);if(Pn)return ql(Pn);yt=!1,we=Ws,jt=new zu}else jt=T?[]:At;e:for(;++Y<Xe;){var An=v[Y],Fn=T?T(An):An;if(An=F||0!==An?An:0,yt&&Fn==Fn){for(var rr=jt.length;rr--;)if(jt[rr]===Fn)continue e;T&&jt.push(Fn),At.push(An)}else we(jt,Fn,F)||(jt!==At&&jt.push(Fn),At.push(An))}return At}function Vf(v,T){return null==(v=Hg(v,T=Os(T,v)))||delete v[Vc(jc(T))]}function jf(v,T,F,Y){return Uf(v,T,F(an(v,T)),Y)}function Uc(v,T,F,Y){for(var we=v.length,Xe=Y?we:-1;(Y?Xe--:++Xe<we)&&T(v[Xe],Xe,v););return F?iu(v,Y?0:Xe,Y?Xe+1:we):iu(v,Y?Xe+1:0,Y?we:Xe)}function yc(v,T){var F=v;return F instanceof x&&(F=F.value()),ml(T,function(Y,we){return we.func.apply(we.thisArg,ki([Y],we.args))},F)}function Gh(v,T,F){var Y=v.length;if(Y<2)return Y?mh(v[0]):[];for(var we=-1,Xe=Qt(Y);++we<Y;)for(var yt=v[we],At=-1;++At<Y;)At!=we&&(Xe[we]=We(Xe[we]||yt,v[At],T,F));return mh(at(Xe,1),T,F)}function cf(v,T,F){for(var Y=-1,we=v.length,Xe=T.length,yt={};++Y<we;)F(yt,v[Y],Y<Xe?T[Y]:q);return yt}function ja(v){return Ea(v)?v:[]}function hf(v){return"function"==typeof v?v:Bl}function Os(v,T){return Ii(v)?v:w_(v,T)?[v]:Md($s(v))}var Kv=Zi;function Gf(v,T,F){var Y=v.length;return F=F===q?Y:F,!T&&F>=Y?v:iu(v,T,F)}var ty=vo||function(v){return Zo.clearTimeout(v)};function ny(v,T){if(T)return v.slice();var F=v.length,Y=io?io(F):new v.constructor(F);return v.copy(Y),Y}function _c(v){var T=new v.constructor(v.byteLength);return new xa(T).set(new xa(v)),T}function Ir(v,T){var F=T?_c(v.buffer):v.buffer;return new v.constructor(F,v.byteOffset,v.length)}function Kc(v,T){if(v!==T){var F=v!==q,Y=null===v,we=v==v,Xe=nh(v),yt=T!==q,At=null===T,jt=T==T,Pn=nh(T);if(!At&&!Pn&&!Xe&&v>T||Xe&&yt&&jt&&!At&&!Pn||Y&&yt&&jt||!F&&jt||!we)return 1;if(!Y&&!Xe&&!Pn&&v<T||Pn&&F&&we&&!Y&&!Xe||At&&F&&we||!yt&&we||!jt)return-1}return 0}function sl(v,T,F,Y){for(var we=-1,Xe=v.length,yt=F.length,At=-1,jt=T.length,Pn=Or(Xe-yt,0),An=Qt(jt+Pn),Fn=!Y;++At<jt;)An[At]=T[At];for(;++we<yt;)(Fn||we<Xe)&&(An[F[we]]=v[we]);for(;Pn--;)An[At++]=v[we++];return An}function Hp(v,T,F,Y){for(var we=-1,Xe=v.length,yt=-1,At=F.length,jt=-1,Pn=T.length,An=Or(Xe-At,0),Fn=Qt(An+Pn),rr=!Y;++we<An;)Fn[we]=v[we];for(var Nr=we;++jt<Pn;)Fn[Nr+jt]=T[jt];for(;++yt<At;)(rr||we<Xe)&&(Fn[Nr+F[yt]]=v[we++]);return Fn}function Rl(v,T){var F=-1,Y=v.length;for(T||(T=Qt(Y));++F<Y;)T[F]=v[F];return T}function fu(v,T,F,Y){var we=!F;F||(F={});for(var Xe=-1,yt=T.length;++Xe<yt;){var At=T[Xe],jt=Y?Y(F[At],v[At],At,F,v):q;jt===q&&(jt=v[At]),we?X(F,At,jt):M(F,At,jt)}return F}function Qc(v,T){return function(F,Y){var we=Ii(F)?uu:k,Xe=T?T():{};return we(F,v,si(Y,2),Xe)}}function eh(v){return Zi(function(T,F){var Y=-1,we=F.length,Xe=we>1?F[we-1]:q,yt=we>2?F[2]:q;for(Xe=v.length>3&&"function"==typeof Xe?(we--,Xe):q,yt&&Kl(F[0],F[1],yt)&&(Xe=we<3?q:Xe,we=1),T=eo(T);++Y<we;){var At=F[Y];At&&v(T,At,Y,Xe)}return T})}function iy(v,T){return function(F,Y){if(null==F)return F;if(!kl(F))return v(F,Y);for(var we=F.length,Xe=T?we:-1,yt=eo(F);(T?Xe--:++Xe<we)&&!1!==Y(yt[Xe],Xe,yt););return F}}function yd(v){return function(T,F,Y){for(var we=-1,Xe=eo(T),yt=Y(T),At=yt.length;At--;){var jt=yt[v?At:++we];if(!1===F(Xe[jt],jt,Xe))break}return T}}function oy(v){return function(T){var F=Rs(T=$s(T))?ea(T):q,Y=F?F[0]:T.charAt(0),we=F?Gf(F,1).join(""):T.slice(1);return Y[v]()+we}}function Jd(v){return function(T){return ml(Ld(wf(T).replace(gl,"")),v,"")}}function Qd(v){return function(){var T=arguments;switch(T.length){case 0:return new v;case 1:return new v(T[0]);case 2:return new v(T[0],T[1]);case 3:return new v(T[0],T[1],T[2]);case 4:return new v(T[0],T[1],T[2],T[3]);case 5:return new v(T[0],T[1],T[2],T[3],T[4]);case 6:return new v(T[0],T[1],T[2],T[3],T[4],T[5]);case 7:return new v(T[0],T[1],T[2],T[3],T[4],T[5],T[6])}var F=a(v.prototype),Y=v.apply(F,T);return Pa(Y)?Y:F}}function _d(v){return function(T,F,Y){var we=eo(T);if(!kl(T)){var Xe=si(F,3);T=Tu(T),F=function(At){return Xe(we[At],At,we)}}var yt=v(T,F,Y);return yt>-1?we[Xe?T[yt]:yt]:q}}function $h(v){return yh(function(T){var F=T.length,Y=F,we=y.prototype.thru;for(v&&T.reverse();Y--;){var Xe=T[Y];if("function"!=typeof Xe)throw new $r(ye);if(we&&!yt&&"wrapper"==qg(Xe))var yt=new y([],!0)}for(Y=yt?Y:F;++Y<F;){var At=qg(Xe=T[Y]),jt="wrapper"==At?Hh(Xe):q;yt=jt&&xh(jt[0])&&424==jt[1]&&!jt[4].length&&1==jt[9]?yt[qg(jt[0])].apply(yt,jt[3]):1==Xe.length&&xh(Xe)?yt[At]():yt.thru(Xe)}return function(){var Pn=arguments,An=Pn[0];if(yt&&1==Pn.length&&Ii(An))return yt.plant(An).value();for(var Fn=0,rr=F?T[Fn].apply(this,Pn):An;++Fn<F;)rr=T[Fn].call(this,rr);return rr}})}function th(v,T,F,Y,we,Xe,yt,At,jt,Pn){var An=128&T,Fn=1&T,rr=2&T,Nr=24&T,gi=512&T,Yi=rr?q:Qd(v);return function mi(){for(var Gi=arguments.length,po=Qt(Gi),Ic=Gi;Ic--;)po[Ic]=arguments[Ic];if(Nr)var Tc=Cd(mi),xl=function bu(Lt,un){for(var Qt=Lt.length,ir=0;Qt--;)Lt[Qt]===un&&++ir;return ir}(po,Tc);if(Y&&(po=sl(po,Y,we,Nr)),Xe&&(po=Hp(po,Xe,yt,Nr)),Gi-=xl,Nr&&Gi<Pn){var Ra=dc(po,Tc);return ou(v,T,th,mi.placeholder,F,po,Ra,At,jt,Pn-Gi)}var wl=Fn?F:this,ih=rr?wl[v]:v;return Gi=po.length,At?po=function Wf(v,T){for(var F=v.length,Y=ba(T.length,F),we=Rl(v);Y--;){var Xe=T[Y];v[Y]=vh(Xe,F)?we[Xe]:q}return v}(po,At):gi&&Gi>1&&po.reverse(),An&&jt<Gi&&(po.length=jt),this&&this!==Zo&&this instanceof mi&&(ih=Yi||Qd(ih)),ih.apply(wl,po)}}function vd(v,T){return function(F,Y){return function wr(v,T,F,Y){return kt(v,function(we,Xe,yt){T(Y,F(we),Xe,yt)}),Y}(F,v,T(Y),{})}}function xd(v,T){return function(F,Y){var we;if(F===q&&Y===q)return T;if(F!==q&&(we=F),Y!==q){if(we===q)return Y;"string"==typeof F||"string"==typeof Y?(F=Zl(F),Y=Zl(Y)):(F=ey(F),Y=ey(Y)),we=v(F,Y)}return we}}function qh(v){return yh(function(T){return T=Ni(T,Lr(si())),Zi(function(F){var Y=this;return v(T,function(we){return Ja(we,Y,F)})})})}function wd(v,T){var F=(T=T===q?" ":Zl(T)).length;if(F<2)return F?Yc(T,v):T;var Y=Yc(T,$n(v/Eu(T)));return Rs(T)?Gf(ea(Y),0,v).join(""):Y.slice(0,v)}function bd(v){return function(T,F,Y){return Y&&"number"!=typeof Y&&Kl(T,F,Y)&&(F=Y=q),T=mu(T),F===q?(F=T,T=0):F=mu(F),function Uu(v,T,F,Y){for(var we=-1,Xe=Or($n((T-v)/(F||1)),0),yt=Qt(Xe);Xe--;)yt[Y?Xe:++we]=v,v+=F;return yt}(T,F,Y=Y===q?T<F?1:-1:mu(Y),v)}}function Vu(v){return function(T,F){return"string"==typeof T&&"string"==typeof F||(T=qc(T),F=qc(F)),v(T,F)}}function ou(v,T,F,Y,we,Xe,yt,At,jt,Pn){var An=8&T;T|=An?32:64,4&(T&=~(An?64:32))||(T&=-4);var Yi=[v,T,we,An?Xe:q,An?yt:q,An?q:Xe,An?q:yt,At,jt,Pn],mi=F.apply(q,Yi);return xh(v)&&uy(mi,Yi),mi.placeholder=Y,ly(mi,v,T)}function Wp(v){var T=Es[v];return function(F,Y){if(F=qc(F),(Y=null==Y?0:ba(Di(Y),292))&&fo(F)){var we=($s(F)+"e").split("e");return+((we=($s(T(we[0]+"e"+(+we[1]+Y)))+"e").split("e"))[0]+"e"+(+we[1]-Y))}return T(F)}}var ra=cu&&1/ql(new cu([,-0]))[1]==Ue?function(v){return new cu(v)}:Zy;function Xp(v){return function(T){var F=du(T);return F==ar?fh(T):F==Ct?function zh(Lt){var un=-1,Qt=Array(Lt.size);return Lt.forEach(function(ir){Qt[++un]=[ir,ir]}),Qt}(T):function el(Lt,un){return Ni(un,function(Qt){return[Qt,Lt[Qt]]})}(T,v(T))}}function xc(v,T,F,Y,we,Xe,yt,At){var jt=2&T;if(!jt&&"function"!=typeof v)throw new $r(ye);var Pn=Y?Y.length:0;if(Pn||(T&=-97,Y=we=q),yt=yt===q?yt:Or(Di(yt),0),At=At===q?At:Di(At),Pn-=we?we.length:0,64&T){var An=Y,Fn=we;Y=we=q}var rr=jt?q:Hh(v),Nr=[v,T,F,Y,we,An,Fn,Xe,yt,At];if(rr&&function Zh(v,T){var F=v[1],Y=T[1],we=F|Y;if(!(we<131)&&!(128==Y&&8==F||128==Y&&256==F&&v[7].length<=T[8]||384==Y&&T[7].length<=T[8]&&8==F))return v;1&Y&&(v[2]=T[2],we|=1&F?0:4);var At=T[3];if(At){var jt=v[3];v[3]=jt?sl(jt,At,T[4]):At,v[4]=jt?dc(v[3],It):T[4]}(At=T[5])&&(v[5]=(jt=v[5])?Hp(jt,At,T[6]):At,v[6]=jt?dc(v[5],It):T[6]),(At=T[7])&&(v[7]=At),128&Y&&(v[8]=null==v[8]?T[8]:ba(v[8],T[8])),null==v[9]&&(v[9]=T[9]),v[0]=T[0],v[1]=we}(Nr,rr),v=Nr[0],T=Nr[1],F=Nr[2],Y=Nr[3],we=Nr[4],!(At=Nr[9]=Nr[9]===q?jt?0:v.length:Or(Nr[9]-Pn,0))&&24&T&&(T&=-25),T&&1!=T)gi=8==T||16==T?function Qv(v,T,F){var Y=Qd(v);return function we(){for(var Xe=arguments.length,yt=Qt(Xe),At=Xe,jt=Cd(we);At--;)yt[At]=arguments[At];var Pn=Xe<3&&yt[0]!==jt&&yt[Xe-1]!==jt?[]:dc(yt,jt);return(Xe-=Pn.length)<F?ou(v,T,th,we.placeholder,q,yt,Pn,q,q,F-Xe):Ja(this&&this!==Zo&&this instanceof we?Y:v,this,yt)}}(v,T,At):32!=T&&33!=T||we.length?th.apply(q,Nr):function vc(v,T,F,Y){var we=1&T,Xe=Qd(v);return function yt(){for(var At=-1,jt=arguments.length,Pn=-1,An=Y.length,Fn=Qt(An+jt),rr=this&&this!==Zo&&this instanceof yt?Xe:v;++Pn<An;)Fn[Pn]=Y[Pn];for(;jt--;)Fn[Pn++]=arguments[++At];return Ja(rr,we?F:this,Fn)}}(v,T,F,Y);else var gi=function Jv(v,T,F){var Y=1&T,we=Qd(v);return function Xe(){return(this&&this!==Zo&&this instanceof Xe?we:v).apply(Y?F:this,arguments)}}(v,T,F);return ly((rr?zg:uy)(gi,Nr),v,T)}function wc(v,T,F,Y){return v===q||Ec(v,Da[F])&&!lo.call(Y,F)?T:v}function jg(v,T,F,Y,we,Xe){return Pa(v)&&Pa(T)&&(Xe.set(T,v),vs(v,T,q,jg,Xe),Xe.delete(T)),v}function e0(v){return ef(v)?q:v}function Gg(v,T,F,Y,we,Xe){var yt=1&F,At=v.length,jt=T.length;if(At!=jt&&!(yt&&jt>At))return!1;var Pn=Xe.get(v),An=Xe.get(T);if(Pn&&An)return Pn==T&&An==v;var Fn=-1,rr=!0,Nr=2&F?new zu:q;for(Xe.set(v,T),Xe.set(T,v);++Fn<At;){var gi=v[Fn],Yi=T[Fn];if(Y)var mi=yt?Y(Yi,gi,Fn,T,v,Xe):Y(gi,Yi,Fn,v,T,Xe);if(mi!==q){if(mi)continue;rr=!1;break}if(Nr){if(!Bh(T,function(Gi,po){if(!Ws(Nr,po)&&(gi===Gi||we(gi,Gi,F,Y,Xe)))return Nr.push(po)})){rr=!1;break}}else if(gi!==Yi&&!we(gi,Yi,F,Y,Xe)){rr=!1;break}}return Xe.delete(v),Xe.delete(T),rr}function yh(v){return Wg(ff(v,q,Jp),v+"")}function $g(v){return Ht(v,Tu,Yp)}function Ed(v){return Ht(v,ul,al)}var Hh=Bu?function(v){return Bu.get(v)}:Zy;function qg(v){for(var T=v.name+"",F=xr[T],Y=lo.call(xr,T)?F.length:0;Y--;){var we=F[Y],Xe=we.func;if(null==Xe||Xe==v)return we.name}return T}function Cd(v){return(lo.call(ke,"placeholder")?ke:v).placeholder}function si(){var v=ke.iteratee||wg;return v=v===wg?Xl:v,arguments.length?v(arguments[0],arguments[1]):v}function Wh(v,T){var F=v.__data__;return function b_(v){var T=typeof v;return"string"==T||"number"==T||"symbol"==T||"boolean"==T?"__proto__"!==v:null===v}(T)?F["string"==typeof T?"string":"hash"]:F.map}function Sd(v){for(var T=Tu(v),F=T.length;F--;){var Y=T[F],we=v[Y];T[F]=[Y,we,n0(we)]}return T}function Xh(v,T){var F=function fc(Lt,un){return null==Lt?q:Lt[un]}(v,T);return us(F)?F:q}var Yp=dh?function(v){return null==v?[]:(v=eo(v),$l(dh(v),function(T){return Bc.call(v,T)}))}:Cf,al=dh?function(v){for(var T=[];v;)ki(T,Yp(v)),v=da(v);return T}:Cf,du=gn;function Td(v,T,F){for(var Y=-1,we=(T=Os(T,v)).length,Xe=!1;++Y<we;){var yt=Vc(T[Y]);if(!(Xe=null!=v&&F(v,yt)))break;v=v[yt]}return Xe||++Y!=we?Xe:!!(we=null==v?0:v.length)&&fg(we)&&vh(yt,we)&&(Ii(v)||Eh(v))}function Hf(v){return"function"!=typeof v.constructor||Kp(v)?{}:a(da(v))}function t0(v){return Ii(v)||Eh(v)||!!(pr&&v&&v[pr])}function vh(v,T){var F=typeof v;return!!(T=T??ft)&&("number"==F||"symbol"!=F&&ps.test(v))&&v>-1&&v%1==0&&v<T}function Kl(v,T,F){if(!Pa(F))return!1;var Y=typeof T;return!!("number"==Y?kl(F)&&vh(T,F.length):"string"==Y&&T in F)&&Ec(F[T],v)}function w_(v,T){if(Ii(v))return!1;var F=typeof v;return!("number"!=F&&"symbol"!=F&&"boolean"!=F&&null!=v&&!nh(v))||ri.test(v)||!Sn.test(v)||null!=T&&v in eo(T)}function xh(v){var T=qg(v),F=ke[T];if("function"!=typeof F||!(T in x.prototype))return!1;if(v===F)return!0;var Y=Hh(F);return!!Y&&v===Y[0]}(Fu&&du(new Fu(new ArrayBuffer(1)))!=zn||Hl&&du(new Hl)!=ar||js&&du(js.resolve())!=Te||cu&&du(new cu)!=Ct||na&&du(new na)!=en)&&(du=function(v){var T=gn(v),F=T==Re?v.constructor:q,Y=F?gf(F):"";if(Y)switch(Y){case Cu:return zn;case Aa:return ar;case Al:return Te;case Su:return Ct;case dd:return en}return T});var tp=to?$c:Tp;function Kp(v){var T=v&&v.constructor;return v===("function"==typeof T&&T.prototype||Da)}function n0(v){return v==v&&!Pa(v)}function Ga(v,T){return function(F){return null!=F&&F[v]===T&&(T!==q||v in eo(F))}}function ff(v,T,F){return T=Or(T===q?v.length-1:T,0),function(){for(var Y=arguments,we=-1,Xe=Or(Y.length-T,0),yt=Qt(Xe);++we<Xe;)yt[we]=Y[T+we];we=-1;for(var At=Qt(T+1);++we<T;)At[we]=Y[we];return At[T]=F(yt),Ja(v,this,At)}}function Hg(v,T){return T.length<2?v:an(v,iu(T,0,-1))}function df(v,T){if(("constructor"!==T||"function"!=typeof v[T])&&"__proto__"!=T)return v[T]}var uy=Jl(zg),pf=Ls||function(v,T){return Zo.setTimeout(v,T)},Wg=Jl(Qm);function ly(v,T,F){var Y=T+"";return Wg(v,function _h(v,T){var F=T.length;if(!F)return v;var Y=F-1;return T[Y]=(F>1?"& ":"")+T[Y],T=T.join(F>2?", ":" "),v.replace(ds,"{\n/* [wrapped with "+T+"] */\n")}(Y,function Xf(v,T){return oi(zt,function(F){var Y="_."+F[0];T&F[1]&&!Qu(v,Y)&&v.push(Y)}),v.sort()}(function Yl(v){var T=v.match(Xr);return T?T[1].split(ao):[]}(Y),F)))}function Jl(v){var T=0,F=0;return function(){var Y=Vh(),we=16-(Y-F);if(F=Y,we>0){if(++T>=800)return arguments[0]}else T=0;return v.apply(q,arguments)}}function rp(v,T){var F=-1,Y=v.length,we=Y-1;for(T=T===q?Y:T;++F<T;){var Xe=jh(F,we),yt=v[Xe];v[Xe]=v[F],v[F]=yt}return v.length=T,v}var Md=function ay(v){var T=Kf(v,function(Y){return 500===F.size&&F.clear(),Y}),F=T.cache;return T}(function(v){var T=[];return 46===v.charCodeAt(0)&&T.push(""),v.replace(li,function(F,Y,we,Xe){T.push(we?Xe.replace(zi,"$1"):Y||F)}),T});function Vc(v){if("string"==typeof v||nh(v))return v;var T=v+"";return"0"==T&&1/v==-Ue?"-0":T}function gf(v){if(null!=v){try{return Zs.call(v)}catch{}try{return v+""}catch{}}return""}function cs(v){if(v instanceof x)return v.clone();var T=new y(v.__wrapped__,v.__chain__);return T.__actions__=Rl(v.__actions__),T.__index__=v.__index__,T.__values__=v.__values__,T}var wh=Zi(function(v,T){return Ea(v)?We(v,at(T,1,Ea,!0)):[]}),Ql=Zi(function(v,T){var F=jc(T);return Ea(F)&&(F=q),Ea(v)?We(v,at(T,1,Ea,!0),si(F,2)):[]}),pu=Zi(function(v,T){var F=jc(T);return Ea(F)&&(F=q),Ea(v)?We(v,at(T,1,Ea,!0),q,F):[]});function Xg(v,T,F){var Y=null==v?0:v.length;if(!Y)return-1;var we=null==F?0:Di(F);return we<0&&(we=Or(Y+we,0)),fr(v,si(T,3),we)}function ip(v,T,F){var Y=null==v?0:v.length;if(!Y)return-1;var we=Y-1;return F!==q&&(we=Di(F),we=F<0?Or(Y+we,0):ba(we,Y-1)),fr(v,si(T,3),we,!0)}function Jp(v){return null!=v&&v.length?at(v,1):[]}function ec(v){return v&&v.length?v[0]:q}var fy=Zi(function(v){var T=Ni(v,ja);return T.length&&T[0]===v[0]?Ln(T):[]}),Kg=Zi(function(v){var T=jc(v),F=Ni(v,ja);return T===jc(F)?T=q:F.pop(),F.length&&F[0]===v[0]?Ln(F,si(T,2)):[]}),I_=Zi(function(v){var T=jc(v),F=Ni(v,ja);return(T="function"==typeof T?T:q)&&F.pop(),F.length&&F[0]===v[0]?Ln(F,q,T):[]});function jc(v){var T=null==v?0:v.length;return T?v[T-1]:q}var Jg=Zi(Qp);function Qp(v,T){return v&&v.length&&T&&T.length?ph(v,T):v}var op=yh(function(v,T){var F=null==v?0:v.length,Y=Z(v,T);return Wd(v,Ni(T,function(we){return vh(we,F)?+we:we}).sort(Kc)),Y});function M_(v){return null==v?v:rl.call(v)}var nm=Zi(function(v){return mh(at(v,1,Ea,!0))}),Jh=Zi(function(v){var T=jc(v);return Ea(T)&&(T=q),mh(at(v,1,Ea,!0),si(T,2))}),tc=Zi(function(v){var T=jc(v);return T="function"==typeof T?T:q,mh(at(v,1,Ea,!0),q,T)});function up(v){if(!v||!v.length)return[];var T=0;return v=$l(v,function(F){if(Ea(F))return T=Or(F.length,T),!0}),Tl(T,function(F){return Ni(v,ha(F))})}function nc(v,T){if(!v||!v.length)return[];var F=up(v);return null==T?F:Ni(F,function(Y){return Ja(T,q,Y)})}var yy=Zi(function(v,T){return Ea(v)?We(v,T):[]}),om=Zi(function(v){return Gh($l(v,Ea))}),A_=Zi(function(v){var T=jc(v);return Ea(T)&&(T=q),Gh($l(v,Ea),si(T,2))}),Zf=Zi(function(v){var T=jc(v);return T="function"==typeof T?T:q,Gh($l(v,Ea),q,T)}),Dd=Zi(up),h0=Zi(function(v){var T=v.length,F=T>1?v[T-1]:q;return F="function"==typeof F?(v.pop(),F):q,nc(v,F)});function _y(v){var T=ke(v);return T.__chain__=!0,T}function sm(v,T){return T(v)}var bc=yh(function(v){var T=v.length,F=T?v[0]:0,Y=this.__wrapped__,we=function(Xe){return Z(Xe,v)};return!(T>1||this.__actions__.length)&&Y instanceof x&&vh(F)?((Y=Y.slice(F,+F+(T?1:0))).__actions__.push({func:sm,args:[we],thisArg:q}),new y(Y,this.__chain__).thru(function(Xe){return T&&!Xe.length&&Xe.push(q),Xe})):this.thru(we)}),am=Qc(function(v,T,F){lo.call(v,F)?++v[F]:X(v,F,1)}),xy=_d(Xg),R_=_d(ip);function cp(v,T){return(Ii(v)?oi:ue)(v,si(T,3))}function um(v,T){return(Ii(v)?Lc:Fe)(v,si(T,3))}var L_=Qc(function(v,T,F){lo.call(v,F)?v[F].push(T):X(v,F,[T])}),d0=Zi(function(v,T,F){var Y=-1,we="function"==typeof T,Xe=kl(v)?Qt(v.length):[];return ue(v,function(yt){Xe[++Y]=we?Ja(T,yt,F):Vr(yt,T,F)}),Xe}),Ey=Qc(function(v,T,F){X(v,F,T)});function hp(v,T){return(Ii(v)?Ni:ln)(v,si(T,3))}var lm=Qc(function(v,T,F){v[F?0:1].push(T)},function(){return[[],[]]}),m0=Zi(function(v,T){if(null==v)return[];var F=T.length;return F>1&&Kl(v,T[0],T[1])?T=[]:F>2&&Kl(T[0],T[1],T[2])&&(T=[T[0]]),gc(v,at(T,1),[])}),sg=_s||function(){return Zo.Date.now()};function Sy(v,T,F){return T=F?q:T,xc(v,128,q,q,q,q,T=v&&null==T?v.length:T)}function dm(v,T){var F;if("function"!=typeof T)throw new $r(ye);return v=Di(v),function(){return--v>0&&(F=T.apply(this,arguments)),v<=1&&(T=q),F}}var pm=Zi(function(v,T,F){var Y=1;if(F.length){var we=dc(F,Cd(pm));Y|=32}return xc(v,Y,T,F,we)}),ag=Zi(function(v,T,F){var Y=3;if(F.length){var we=dc(F,Cd(ag));Y|=32}return xc(T,Y,v,F,we)});function gm(v,T,F){var Y,we,Xe,yt,At,jt,Pn=0,An=!1,Fn=!1,rr=!0;if("function"!=typeof v)throw new $r(ye);function Nr(Ra){var wl=Y,ih=we;return Y=we=q,Pn=Ra,yt=v.apply(ih,wl)}function mi(Ra){var wl=Ra-jt;return jt===q||wl>=T||wl<0||Fn&&Ra-Pn>=Xe}function Gi(){var Ra=sg();if(mi(Ra))return po(Ra);At=pf(Gi,function Yi(Ra){var Cg=T-(Ra-jt);return Fn?ba(Cg,Xe-(Ra-Pn)):Cg}(Ra))}function po(Ra){return At=q,rr&&Y?Nr(Ra):(Y=we=q,yt)}function xl(){var Ra=sg(),wl=mi(Ra);if(Y=arguments,we=this,jt=Ra,wl){if(At===q)return function gi(Ra){return Pn=Ra,At=pf(Gi,T),An?Nr(Ra):yt}(jt);if(Fn)return ty(At),At=pf(Gi,T),Nr(jt)}return At===q&&(At=pf(Gi,T)),yt}return T=qc(T)||0,Pa(F)&&(An=!!F.leading,Xe=(Fn="maxWait"in F)?Or(qc(F.maxWait)||0,T):Xe,rr="trailing"in F?!!F.trailing:rr),xl.cancel=function Ic(){At!==q&&ty(At),Pn=0,Y=jt=we=At=q},xl.flush=function Tc(){return At===q?yt:po(sg())},xl}var k_=Zi(function(v,T){return je(v,1,T)}),vf=Zi(function(v,T,F){return je(v,qc(T)||0,F)});function Kf(v,T){if("function"!=typeof v||null!=T&&"function"!=typeof T)throw new $r(ye);var F=function(){var Y=arguments,we=T?T.apply(this,Y):Y[0],Xe=F.cache;if(Xe.has(we))return Xe.get(we);var yt=v.apply(this,Y);return F.cache=Xe.set(we,yt)||Xe,yt};return F.cache=new(Kf.Cache||ma),F}function mm(v){if("function"!=typeof v)throw new $r(ye);return function(){var T=arguments;switch(T.length){case 0:return!v.call(this);case 1:return!v.call(this,T[0]);case 2:return!v.call(this,T[0],T[1]);case 3:return!v.call(this,T[0],T[1],T[2])}return!v.apply(this,T)}}Kf.Cache=ma;var Jf=Kv(function(v,T){var F=(T=1==T.length&&Ii(T[0])?Ni(T[0],Lr(si())):Ni(at(T,1),Lr(si()))).length;return Zi(function(Y){for(var we=-1,Xe=ba(Y.length,F);++we<Xe;)Y[we]=T[we].call(this,Y[we]);return Ja(v,this,Y)})}),Ad=Zi(function(v,T){var F=dc(T,Cd(Ad));return xc(v,32,q,T,F)}),ym=Zi(function(v,T){var F=dc(T,Cd(ym));return xc(v,64,q,T,F)}),dp=yh(function(v,T){return xc(v,256,q,q,q,T)});function Ec(v,T){return v===T||v!=v&&T!=T}var Ry=Vu(Gt),Nl=Vu(function(v,T){return v>=T}),Eh=or(function(){return arguments}())?or:function(v){return $a(v)&&lo.call(v,"callee")&&!Bc.call(v,"callee")},Ii=Qt.isArray,mp=hc?Lr(hc):function Ar(v){return $a(v)&&gn(v)==Pr};function kl(v){return null!=v&&fg(v.length)&&!$c(v)}function Ea(v){return $a(v)&&kl(v)}var Gc=ku||Tp,y0=Ru?Lr(Ru):function Xn(v){return $a(v)&&gn(v)==Nn};function Oy(v){if(!$a(v))return!1;var T=gn(v);return T==Wi||"[object DOMException]"==T||"string"==typeof v.message&&"string"==typeof v.name&&!ef(v)}function $c(v){if(!Pa(v))return!1;var T=gn(v);return T==Sr||T==Oi||"[object AsyncFunction]"==T||"[object Proxy]"==T}function hg(v){return"number"==typeof v&&v==Di(v)}function fg(v){return"number"==typeof v&&v>-1&&v%1==0&&v<=ft}function Pa(v){var T=typeof v;return null!=v&&("object"==T||"function"==T)}function $a(v){return null!=v&&"object"==typeof v}var Ny=Rr?Lr(Rr):function bo(v){return $a(v)&&du(v)==ar};function xf(v){return"number"==typeof v||$a(v)&&gn(v)==mr}function ef(v){if(!$a(v)||gn(v)!=Re)return!1;var T=da(v);if(null===T)return!0;var F=lo.call(T,"constructor")&&T.constructor;return"function"==typeof F&&F instanceof F&&Zs.call(F)==Ri}var z_=Yo?Lr(Yo):function ls(v){return $a(v)&&gn(v)==et},dg=hr?Lr(hr):function Va(v){return $a(v)&&du(v)==Ct};function ky(v){return"string"==typeof v||!Ii(v)&&$a(v)&&gn(v)==Yt}function nh(v){return"symbol"==typeof v||$a(v)&&gn(v)==yn}var Qf=ii?Lr(ii):function Iu(v){return $a(v)&&fg(v.length)&&!!Ji[gn(v)]},Fy=Vu(Jo),vm=Vu(function(v,T){return v<=T});function Sh(v){if(!v)return[];if(kl(v))return ky(v)?ea(v):Rl(v);if(pa&&v[pa])return function Ba(Lt){for(var un,Qt=[];!(un=Lt.next()).done;)Qt.push(un.value);return Qt}(v[pa]());var T=du(v);return(T==ar?fh:T==Ct?ql:ed)(v)}function mu(v){return v?(v=qc(v))===Ue||v===-Ue?17976931348623157e292*(v<0?-1:1):v==v?v:0:0===v?v:0}function Di(v){var T=mu(v),F=T%1;return T==T?F?T-F:T:0}function xm(v){return v?se(Di(v),0,Xt):0}function qc(v){if("number"==typeof v)return v;if(nh(v))return NaN;if(Pa(v)){var T="function"==typeof v.valueOf?v.valueOf():v;v=Pa(T)?T+"":T}if("string"!=typeof v)return 0===v?v:+v;v=Ta(v);var F=Br.test(v);return F||ns.test(v)?os(v.slice(2),F?2:8):uc.test(v)?NaN:+v}function b0(v){return fu(v,ul(v))}function $s(v){return null==v?"":Zl(v)}var By=eh(function(v,T){if(Kp(T)||kl(T))fu(T,Tu(T),v);else for(var F in T)lo.call(T,F)&&M(v,F,T[F])}),wm=eh(function(v,T){fu(T,ul(T),v)}),zy=eh(function(v,T,F,Y){fu(T,ul(T),v,Y)}),ax=eh(function(v,T,F,Y){fu(T,Tu(T),v,Y)}),j_=yh(Z),vp=Zi(function(v,T){v=eo(v);var F=-1,Y=T.length,we=Y>2?T[2]:q;for(we&&Kl(T[0],T[1],we)&&(Y=1);++F<Y;)for(var Xe=T[F],yt=ul(Xe),At=-1,jt=yt.length;++At<jt;){var Pn=yt[At],An=v[Pn];(An===q||Ec(An,Da[Pn])&&!lo.call(v,Pn))&&(v[Pn]=Xe[Pn])}return v}),G_=Zi(function(v){return v.push(q,jg),Ja(Kr,q,v)});function pg(v,T,F){var Y=null==v?q:an(v,T);return Y===q?F:Y}function Fl(v,T){return null!=v&&Td(v,T,En)}var q_=vd(function(v,T,F){null!=T&&"function"!=typeof T.toString&&(T=nu.call(T)),v[T]=F},Th(Bl)),gg=vd(function(v,T,F){null!=T&&"function"!=typeof T.toString&&(T=nu.call(T)),lo.call(v,T)?v[T].push(F):v[T]=[F]},si),xp=Zi(Vr);function Tu(v){return kl(v)?Bf(v):pc(v)}function ul(v){return kl(v)?Bf(v,!0):function Ks(v){if(!Pa(v))return function np(v){var T=[];if(null!=v)for(var F in eo(v))T.push(F);return T}(v);var T=Kp(v),F=[];for(var Y in v)"constructor"==Y&&(T||!lo.call(v,Y))||F.push(Y);return F}(v)}var wp=eh(function(v,T,F){vs(v,T,F)}),Kr=eh(function(v,T,F,Y){vs(v,T,F,Y)}),bp=yh(function(v,T){var F={};if(null==v)return F;var Y=!1;T=Ni(T,function(Xe){return Xe=Os(Xe,v),Y||(Y=Xe.length>1),Xe}),fu(v,Ed(v),F),Y&&(F=Ie(F,7,e0));for(var we=T.length;we--;)Vf(F,T[we]);return F}),Im=yh(function(v,T){return null==v?{}:function Pl(v,T){return mc(v,T,function(F,Y){return Fl(v,Y)})}(v,T)});function Tm(v,T){if(null==v)return{};var F=Ni(Ed(v),function(Y){return[Y]});return T=si(T),mc(v,F,function(Y,we){return T(Y,we[0])})}var Mm=Xp(Tu),mg=Xp(ul);function ed(v){return null==v?[]:Ou(v,Tu(v))}var Cc=Jd(function(v,T,F){return T=T.toLowerCase(),v+(F?Pm(T):T)});function Pm(v){return xg($s(v).toLowerCase())}function wf(v){return(v=$s(v))&&v.replace(lc,tu).replace(ua,"")}var Rm=Jd(function(v,T,F){return v+(F?"-":"")+T.toLowerCase()}),Lm=Jd(function(v,T,F){return v+(F?" ":"")+T.toLowerCase()}),Om=oy("toLowerCase"),Ef=Jd(function(v,T,F){return v+(F?"_":"")+T.toLowerCase()}),Y_=Jd(function(v,T,F){return v+(F?" ":"")+xg(T)}),vg=Jd(function(v,T,F){return v+(F?" ":"")+T.toUpperCase()}),xg=oy("toUpperCase");function Ld(v,T,F){return v=$s(v),(T=F?q:T)===q?function Fa(Lt){return la.test(Lt)}(v)?function yl(Lt){return Lt.match(Rc)||[]}(v):function $i(Lt){return Lt.match(ya)||[]}(v):v.match(T)||[]}var rf=Zi(function(v,T){try{return Ja(v,q,T)}catch(F){return Oy(F)?F:new Tr(F)}}),Hy=yh(function(v,T){return oi(T,function(F){F=Vc(F),X(v,F,pm(v[F],v))}),v});function Th(v){return function(){return v}}var Od=$h(),nd=$h(!0);function Bl(v){return v}function wg(v){return Xl("function"==typeof v?v:Ie(v,1))}var Fm=Zi(function(v,T){return function(F){return Vr(F,v,T)}}),P0=Zi(function(v,T){return function(F){return Vr(v,F,T)}});function bg(v,T,F){var Y=Tu(T),we=Ut(T,Y);null==F&&(!Pa(T)||!we.length&&Y.length)&&(F=T,T=v,v=this,we=Ut(T,Tu(T)));var Xe=!(Pa(F)&&"chain"in F&&!F.chain),yt=$c(v);return oi(we,function(At){var jt=T[At];v[At]=jt,yt&&(v.prototype[At]=function(){var Pn=this.__chain__;if(Xe||Pn){var An=v(this.__wrapped__);return(An.__actions__=Rl(this.__actions__)).push({func:jt,args:arguments,thisArg:v}),An.__chain__=Pn,An}return jt.apply(v,ki([this.value()],arguments))})}),v}function Zy(){}var cx=qh(Ni),ev=qh(Fh),Yy=qh(Bh);function Eg(v){return w_(v)?ha(Vc(v)):function Zc(v){return function(T){return an(T,v)}}(v)}var tv=bd(),Ip=bd(!0);function Cf(){return[]}function Tp(){return!1}var rv=xd(function(v,T){return v+T},0),Sf=Wp("ceil"),rd=xd(function(v,T){return v/T},1),O0=Wp("floor"),Qy=xd(function(v,T){return v*T},1),Dp=Wp("round"),ov=xd(function(v,T){return v-T},0);return ke.after=function fp(v,T){if("function"!=typeof T)throw new $r(ye);return v=Di(v),function(){if(--v<1)return T.apply(this,arguments)}},ke.ary=Sy,ke.assign=By,ke.assignIn=wm,ke.assignInWith=zy,ke.assignWith=ax,ke.at=j_,ke.before=dm,ke.bind=pm,ke.bindAll=Hy,ke.bindKey=ag,ke.castArray=function Ay(){if(!arguments.length)return[];var v=arguments[0];return Ii(v)?v:[v]},ke.chain=_y,ke.chunk=function cy(v,T,F){T=(F?Kl(v,T,F):T===q)?1:Or(Di(T),0);var Y=null==v?0:v.length;if(!Y||T<1)return[];for(var we=0,Xe=0,yt=Qt($n(Y/T));we<Y;)yt[Xe++]=iu(v,we,we+=T);return yt},ke.compact=function Yh(v){for(var T=-1,F=null==v?0:v.length,Y=0,we=[];++T<F;){var Xe=v[T];Xe&&(we[Y++]=Xe)}return we},ke.concat=function Kh(){var v=arguments.length;if(!v)return[];for(var T=Qt(v-1),F=arguments[0],Y=v;Y--;)T[Y-1]=arguments[Y];return ki(Ii(F)?Rl(F):[F],at(T,1))},ke.cond=function rh(v){var T=null==v?0:v.length,F=si();return v=T?Ni(v,function(Y){if("function"!=typeof Y[1])throw new $r(ye);return[F(Y[0]),Y[1]]}):[],Zi(function(Y){for(var we=-1;++we<T;){var Xe=v[we];if(Ja(Xe[0],this,Y))return Ja(Xe[1],this,Y)}})},ke.conforms=function km(v){return function ze(v){var T=Tu(v);return function(F){return $e(F,v,T)}}(Ie(v,1))},ke.constant=Th,ke.countBy=am,ke.create=function bm(v,T){var F=a(v);return null==T?F:z(F,T)},ke.curry=function Iy(v,T,F){var Y=xc(v,8,q,q,q,q,q,T=F?q:T);return Y.placeholder=Iy.placeholder,Y},ke.curryRight=function N_(v,T,F){var Y=xc(v,16,q,q,q,q,q,T=F?q:T);return Y.placeholder=N_.placeholder,Y},ke.debounce=gm,ke.defaults=vp,ke.defaultsDeep=G_,ke.defer=k_,ke.delay=vf,ke.difference=wh,ke.differenceBy=Ql,ke.differenceWith=pu,ke.drop=function E_(v,T,F){var Y=null==v?0:v.length;return Y?iu(v,(T=F||T===q?1:Di(T))<0?0:T,Y):[]},ke.dropRight=function gu(v,T,F){var Y=null==v?0:v.length;return Y?iu(v,0,(T=Y-(T=F||T===q?1:Di(T)))<0?0:T):[]},ke.dropRightWhile=function C_(v,T){return v&&v.length?Uc(v,si(T,3),!0,!0):[]},ke.dropWhile=function mf(v,T){return v&&v.length?Uc(v,si(T,3),!0):[]},ke.fill=function hy(v,T,F,Y){var we=null==v?0:v.length;return we?(F&&"number"!=typeof F&&Kl(v,T,F)&&(F=0,Y=we),function Et(v,T,F,Y){var we=v.length;for((F=Di(F))<0&&(F=-F>we?0:we+F),(Y=Y===q||Y>we?we:Di(Y))<0&&(Y+=we),Y=F>Y?0:xm(Y);F<Y;)v[F++]=T;return v}(v,T,F,Y)):[]},ke.filter=function ig(v,T){return(Ii(v)?$l:St)(v,si(T,3))},ke.flatMap=function lp(v,T){return at(hp(v,T),1)},ke.flatMapDeep=function wy(v,T){return at(hp(v,T),Ue)},ke.flatMapDepth=function by(v,T,F){return F=F===q?1:Di(F),at(hp(v,T),F)},ke.flatten=Jp,ke.flattenDeep=function Zg(v){return null!=v&&v.length?at(v,Ue):[]},ke.flattenDepth=function S_(v,T){return null!=v&&v.length?at(v,T=T===q?1:Di(T)):[]},ke.flip=function ug(v){return xc(v,512)},ke.flow=Od,ke.flowRight=nd,ke.fromPairs=function r0(v){for(var T=-1,F=null==v?0:v.length,Y={};++T<F;){var we=v[T];Y[we[0]]=we[1]}return Y},ke.functions=function su(v){return null==v?[]:Ut(v,Tu(v))},ke.functionsIn=function rc(v){return null==v?[]:Ut(v,ul(v))},ke.groupBy=L_,ke.initial=function Yg(v){return null!=v&&v.length?iu(v,0,-1):[]},ke.intersection=fy,ke.intersectionBy=Kg,ke.intersectionWith=I_,ke.invert=q_,ke.invertBy=gg,ke.invokeMap=d0,ke.iteratee=wg,ke.keyBy=Ey,ke.keys=Tu,ke.keysIn=ul,ke.map=hp,ke.mapKeys=function ux(v,T){var F={};return T=si(T,3),kt(v,function(Y,we,Xe){X(F,T(Y,we,Xe),Y)}),F},ke.mapValues=function C0(v,T){var F={};return T=si(T,3),kt(v,function(Y,we,Xe){X(F,we,T(Y,we,Xe))}),F},ke.matches=function Wy(v){return Wr(Ie(v,1))},ke.matchesProperty=function Nd(v,T){return ol(v,Ie(T,1))},ke.memoize=Kf,ke.merge=wp,ke.mergeWith=Kr,ke.method=Fm,ke.methodOf=P0,ke.mixin=bg,ke.negate=mm,ke.nthArg=function Q_(v){return v=Di(v),Zi(function(T){return zf(T,v)})},ke.omit=bp,ke.omitBy=function jy(v,T){return Tm(v,mm(si(T)))},ke.once=function rx(v){return dm(2,v)},ke.orderBy=function og(v,T,F,Y){return null==v?[]:(Ii(T)||(T=null==T?[]:[T]),Ii(F=Y?q:F)||(F=null==F?[]:[F]),gc(v,T,F))},ke.over=cx,ke.overArgs=Jf,ke.overEvery=ev,ke.overSome=Yy,ke.partial=Ad,ke.partialRight=ym,ke.partition=lm,ke.pick=Im,ke.pickBy=Tm,ke.property=Eg,ke.propertyOf=function R0(v){return function(T){return null==v?q:an(v,T)}},ke.pull=Jg,ke.pullAll=Qp,ke.pullAllBy=function T_(v,T,F){return v&&v.length&&T&&T.length?ph(v,T,si(F,2)):v},ke.pullAllWith=function py(v,T,F){return v&&v.length&&T&&T.length?ph(v,T,q,F):v},ke.pullAt=op,ke.range=tv,ke.rangeRight=Ip,ke.rearg=dp,ke.reject=function O_(v,T){return(Ii(v)?$l:St)(v,mm(si(T,3)))},ke.remove=function gy(v,T){var F=[];if(!v||!v.length)return F;var Y=-1,we=[],Xe=v.length;for(T=si(T,3);++Y<Xe;){var yt=v[Y];T(yt,Y,v)&&(F.push(yt),we.push(Y))}return Wd(v,we),F},ke.rest=function Ty(v,T){if("function"!=typeof v)throw new $r(ye);return Zi(v,T=T===q?T:Di(T))},ke.reverse=M_,ke.sampleSize=function hm(v,T,F){return T=(F?Kl(v,T,F):T===q)?1:Di(T),(Ii(v)?l:gh)(v,T)},ke.set=function W_(v,T,F){return null==v?v:Uf(v,T,F)},ke.setWith=function tf(v,T,F,Y){return Y="function"==typeof Y?Y:q,null==v?v:Uf(v,T,F,Y)},ke.shuffle=function p0(v){return(Ii(v)?g:Ug)(v)},ke.slice=function sp(v,T,F){var Y=null==v?0:v.length;return Y?(F&&"number"!=typeof F&&Kl(v,T,F)?(T=0,F=Y):(T=null==T?0:Di(T),F=F===q?Y:Di(F)),iu(v,T,F)):[]},ke.sortBy=m0,ke.sortedUniq=function ex(v){return v&&v.length?v_(v):[]},ke.sortedUniqBy=function u0(v,T){return v&&v.length?v_(v,si(T,2)):[]},ke.split=function qy(v,T,F){return F&&"number"!=typeof F&&Kl(v,T,F)&&(T=F=q),(F=F===q?Xt:F>>>0)?(v=$s(v))&&("string"==typeof T||null!=T&&!z_(T))&&!(T=Zl(T))&&Rs(v)?Gf(ea(v),0,F):v.split(T,F):[]},ke.spread=function My(v,T){if("function"!=typeof v)throw new $r(ye);return T=null==T?0:Or(Di(T),0),Zi(function(F){var Y=F[T],we=Gf(F,0,T);return Y&&ki(we,Y),Ja(v,this,we)})},ke.tail=function tx(v){var T=null==v?0:v.length;return T?iu(v,1,T):[]},ke.take=function nx(v,T,F){return v&&v.length?iu(v,0,(T=F||T===q?1:Di(T))<0?0:T):[]},ke.takeRight=function D_(v,T,F){var Y=null==v?0:v.length;return Y?iu(v,(T=Y-(T=F||T===q?1:Di(T)))<0?0:T,Y):[]},ke.takeRightWhile=function eg(v,T){return v&&v.length?Uc(v,si(T,3),!1,!0):[]},ke.takeWhile=function tm(v,T){return v&&v.length?Uc(v,si(T,3)):[]},ke.tap=function f0(v,T){return T(v),v},ke.throttle=function Dy(v,T,F){var Y=!0,we=!0;if("function"!=typeof v)throw new $r(ye);return Pa(F)&&(Y="leading"in F?!!F.leading:Y,we="trailing"in F?!!F.trailing:we),gm(v,T,{leading:Y,maxWait:T,trailing:we})},ke.thru=sm,ke.toArray=Sh,ke.toPairs=Mm,ke.toPairsIn=mg,ke.toPath=function L0(v){return Ii(v)?Ni(v,Vc):nh(v)?[v]:Rl(Md($s(v)))},ke.toPlainObject=b0,ke.transform=function S0(v,T,F){var Y=Ii(v),we=Y||Gc(v)||Qf(v);if(T=si(T,4),null==F){var Xe=v&&v.constructor;F=we?Y?new Xe:[]:Pa(v)&&$c(Xe)?a(da(v)):{}}return(we?oi:kt)(v,function(yt,At,jt){return T(F,yt,At,jt)}),F},ke.unary=function lg(v){return Sy(v,1)},ke.union=nm,ke.unionBy=Jh,ke.unionWith=tc,ke.uniq=function ap(v){return v&&v.length?mh(v):[]},ke.uniqBy=function rm(v,T){return v&&v.length?mh(v,si(T,2)):[]},ke.uniqWith=function im(v,T){return T="function"==typeof T?T:q,v&&v.length?mh(v,q,T):[]},ke.unset=function Dm(v,T){return null==v||Vf(v,T)},ke.unzip=up,ke.unzipWith=nc,ke.update=function I0(v,T,F){return null==v?v:jf(v,T,hf(F))},ke.updateWith=function Gy(v,T,F,Y){return Y="function"==typeof Y?Y:q,null==v?v:jf(v,T,hf(F),Y)},ke.values=ed,ke.valuesIn=function $y(v){return null==v?[]:Ou(v,ul(v))},ke.without=yy,ke.words=Ld,ke.wrap=function pp(v,T){return Ad(hf(T),v)},ke.xor=om,ke.xorBy=A_,ke.xorWith=Zf,ke.zip=Dd,ke.zipObject=function l0(v,T){return cf(v||[],T||[],M)},ke.zipObjectDeep=function c0(v,T){return cf(v||[],T||[],Uf)},ke.zipWith=h0,ke.entries=Mm,ke.entriesIn=mg,ke.extend=wm,ke.extendWith=zy,bg(ke,ke),ke.add=rv,ke.attempt=rf,ke.camelCase=Cc,ke.capitalize=Pm,ke.ceil=Sf,ke.clamp=function Ih(v,T,F){return F===q&&(F=T,T=q),F!==q&&(F=(F=qc(F))==F?F:0),T!==q&&(T=(T=qc(T))==T?T:0),se(qc(v),T,F)},ke.clone=function _m(v){return Ie(v,4)},ke.cloneDeep=function F_(v){return Ie(v,5)},ke.cloneDeepWith=function Py(v,T){return Ie(v,5,T="function"==typeof T?T:q)},ke.cloneWith=function cg(v,T){return Ie(v,4,T="function"==typeof T?T:q)},ke.conformsTo=function gp(v,T){return null==T||$e(v,T,Tu(T))},ke.deburr=wf,ke.defaultTo=function Sp(v,T){return null==v||v!=v?T:v},ke.divide=rd,ke.endsWith=function bf(v,T,F){v=$s(v),T=Zl(T);var Y=v.length,we=F=F===q?Y:se(Di(F),0,Y);return(F-=T.length)>=0&&v.slice(F,we)==T},ke.eq=Ec,ke.escape=function nf(v){return(v=$s(v))&&lt.test(v)?v.replace(Ft,Ps):v},ke.escapeRegExp=function Ep(v){return(v=$s(v))&&Cr.test(v)?v.replace(Yr,"\\$&"):v},ke.every=function rg(v,T,F){var Y=Ii(v)?Fh:nt;return F&&Kl(v,T,F)&&(T=q),Y(v,si(T,3))},ke.find=xy,ke.findIndex=Xg,ke.findKey=function Em(v,T){return Nc(v,si(T,3),kt)},ke.findLast=R_,ke.findLastIndex=ip,ke.findLastKey=function Cm(v,T){return Nc(v,si(T,3),Dn)},ke.floor=O0,ke.forEach=cp,ke.forEachRight=um,ke.forIn=function Sm(v,T){return null==v?v:Ot(v,si(T,3),ul)},ke.forInRight=function E0(v,T){return null==v?v:Rt(v,si(T,3),ul)},ke.forOwn=function Uy(v,T){return v&&kt(v,si(T,3))},ke.forOwnRight=function $_(v,T){return v&&Dn(v,si(T,3))},ke.get=pg,ke.gt=Ry,ke.gte=Nl,ke.has=function Vy(v,T){return null!=v&&Td(v,T,fn)},ke.hasIn=Fl,ke.head=ec,ke.identity=Bl,ke.includes=function yf(v,T,F,Y){v=kl(v)?v:ed(v),F=F&&!Y?Di(F):0;var we=v.length;return F<0&&(F=Or(we+F,0)),ky(v)?F<=we&&v.indexOf(T,F)>-1:!!we&&Lu(v,T,F)>-1},ke.indexOf=function bh(v,T,F){var Y=null==v?0:v.length;if(!Y)return-1;var we=null==F?0:Di(F);return we<0&&(we=Or(Y+we,0)),Lu(v,T,we)},ke.inRange=function X_(v,T,F){return T=mu(T),F===q?(F=T,T=0):F=mu(F),function vn(v,T,F){return v>=ba(T,F)&&v<Or(T,F)}(v=qc(v),T,F)},ke.invoke=xp,ke.isArguments=Eh,ke.isArray=Ii,ke.isArrayBuffer=mp,ke.isArrayLike=kl,ke.isArrayLikeObject=Ea,ke.isBoolean=function Ly(v){return!0===v||!1===v||$a(v)&&gn(v)==xn},ke.isBuffer=Gc,ke.isDate=y0,ke.isElement=function _0(v){return $a(v)&&1===v.nodeType&&!ef(v)},ke.isEmpty=function ix(v){if(null==v)return!0;if(kl(v)&&(Ii(v)||"string"==typeof v||"function"==typeof v.splice||Gc(v)||Qf(v)||Eh(v)))return!v.length;var T=du(v);if(T==ar||T==Ct)return!v.size;if(Kp(v))return!pc(v).length;for(var F in v)if(lo.call(v,F))return!1;return!0},ke.isEqual=function v0(v,T){return ci(v,T)},ke.isEqualWith=function yp(v,T,F){var Y=(F="function"==typeof F?F:q)?F(v,T):q;return Y===q?ci(v,T,q,F):!!Y},ke.isError=Oy,ke.isFinite=function _p(v){return"number"==typeof v&&fo(v)},ke.isFunction=$c,ke.isInteger=hg,ke.isLength=fg,ke.isMap=Ny,ke.isMatch=function x0(v,T){return v===T||Ko(v,T,Sd(T))},ke.isMatchWith=function B_(v,T,F){return F="function"==typeof F?F:q,Ko(v,T,Sd(T),F)},ke.isNaN=function w0(v){return xf(v)&&v!=+v},ke.isNative=function ju(v){if(tp(v))throw new Tr("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return us(v)},ke.isNil=function Qh(v){return null==v},ke.isNull=function Ch(v){return null===v},ke.isNumber=xf,ke.isObject=Pa,ke.isObjectLike=$a,ke.isPlainObject=ef,ke.isRegExp=z_,ke.isSafeInteger=function ox(v){return hg(v)&&v>=-ft&&v<=ft},ke.isSet=dg,ke.isString=ky,ke.isSymbol=nh,ke.isTypedArray=Qf,ke.isUndefined=function U_(v){return v===q},ke.isWeakMap=function V_(v){return $a(v)&&du(v)==en},ke.isWeakSet=function Cs(v){return $a(v)&&"[object WeakSet]"==gn(v)},ke.join=function J1(v,T){return null==v?"":wa.call(v,T)},ke.kebabCase=Rm,ke.last=jc,ke.lastIndexOf=function o0(v,T,F){var Y=null==v?0:v.length;if(!Y)return-1;var we=Y;return F!==q&&(we=(we=Di(F))<0?Or(Y+we,0):ba(we,Y-1)),T==T?function Nu(Lt,un,Qt){for(var ir=Qt+1;ir--;)if(Lt[ir]===un)return ir;return ir}(v,T,we):fr(v,xu,we,!0)},ke.lowerCase=Lm,ke.lowerFirst=Om,ke.lt=Fy,ke.lte=vm,ke.max=function iv(v){return v&&v.length?Qe(v,Bl,Gt):q},ke.maxBy=function zm(v,T){return v&&v.length?Qe(v,si(T,2),Gt):q},ke.mean=function Jy(v){return Fi(v,Bl)},ke.meanBy=function N0(v,T){return Fi(v,si(T,2))},ke.min=function id(v){return v&&v.length?Qe(v,Bl,Jo):q},ke.minBy=function k0(v,T){return v&&v.length?Qe(v,si(T,2),Jo):q},ke.stubArray=Cf,ke.stubFalse=Tp,ke.stubObject=function nv(){return{}},ke.stubString=function Ky(){return""},ke.stubTrue=function Bm(){return!0},ke.multiply=Qy,ke.nth=function dy(v,T){return v&&v.length?zf(v,Di(T)):q},ke.noConflict=function Xy(){return Zo._===this&&(Zo._=bn),this},ke.noop=Zy,ke.now=sg,ke.pad=function Z_(v,T,F){v=$s(v);var Y=(T=Di(T))?Eu(v):0;if(!T||Y>=T)return v;var we=(T-Y)/2;return wd(ho(we),F)+v+wd($n(we),F)},ke.padEnd=function Cp(v,T,F){v=$s(v);var Y=(T=Di(T))?Eu(v):0;return T&&Y<T?v+wd(T-Y,F):v},ke.padStart=function T0(v,T,F){v=$s(v);var Y=(T=Di(T))?Eu(v):0;return T&&Y<T?wd(T-Y,F)+v:v},ke.parseInt=function M0(v,T,F){return F||null==T?T=0:T&&(T=+T),fd($s(v).replace(fi,""),T||0)},ke.random=function Am(v,T,F){if(F&&"boolean"!=typeof F&&Kl(v,T,F)&&(T=F=q),F===q&&("boolean"==typeof T?(F=T,T=q):"boolean"==typeof v&&(F=v,v=q)),v===q&&T===q?(v=0,T=1):(v=mu(v),T===q?(T=v,v=0):T=mu(T)),v>T){var Y=v;v=T,T=Y}if(F||v%1||T%1){var we=Ys();return ba(v+we*(T-v+sr("1e-"+((we+"").length-1))),T)}return jh(v,T)},ke.reduce=function _f(v,T,F){var Y=Ii(v)?ml:eu,we=arguments.length<3;return Y(v,si(T,4),F,we,ue)},ke.reduceRight=function cm(v,T,F){var Y=Ii(v)?Qa:eu,we=arguments.length<3;return Y(v,si(T,4),F,we,Fe)},ke.repeat=function D0(v,T,F){return T=(F?Kl(v,T,F):T===q)?1:Di(T),Yc($s(v),T)},ke.replace=function td(){var v=arguments,T=$s(v[0]);return v.length<3?T:T.replace(v[1],v[2])},ke.result=function H_(v,T,F){var Y=-1,we=(T=Os(T,v)).length;for(we||(we=1,v=q);++Y<we;){var Xe=null==v?q:v[Vc(T[Y])];Xe===q&&(Y=we,Xe=F),v=$c(Xe)?Xe.call(v):Xe}return v},ke.round=Dp,ke.runInContext=Lt,ke.sample=function Cy(v){return(Ii(v)?w:Xd)(v)},ke.size=function g0(v){if(null==v)return 0;if(kl(v))return ky(v)?Eu(v):v.length;var T=du(v);return T==ar||T==Ct?v.size:pc(v).length},ke.snakeCase=Ef,ke.some=function fm(v,T,F){var Y=Ii(v)?Bh:Zd;return F&&Kl(v,T,F)&&(T=q),Y(v,si(T,3))},ke.sortedIndex=function Qg(v,T){return Yd(v,T)},ke.sortedIndexBy=function em(v,T,F){return Kd(v,T,si(F,2))},ke.sortedIndexOf=function s0(v,T){var F=null==v?0:v.length;if(F){var Y=Yd(v,T);if(Y<F&&Ec(v[Y],T))return Y}return-1},ke.sortedLastIndex=function Q1(v,T){return Yd(v,T,!0)},ke.sortedLastIndexBy=function my(v,T,F){return Kd(v,T,si(F,2),!0)},ke.sortedLastIndexOf=function a0(v,T){if(null!=v&&v.length){var Y=Yd(v,T,!0)-1;if(Ec(v[Y],T))return Y}return-1},ke.startCase=Y_,ke.startsWith=function Pd(v,T,F){return v=$s(v),F=null==F?0:se(Di(F),0,v.length),T=Zl(T),v.slice(F,F+T.length)==T},ke.subtract=ov,ke.sum=function F0(v){return v&&v.length?ss(v,Bl):0},ke.sumBy=function Sc(v,T){return v&&v.length?ss(v,si(T,2)):0},ke.template=function lx(v,T,F){var Y=ke.templateSettings;F&&Kl(v,T,F)&&(T=q),v=$s(v),T=zy({},T,Y,wc);var At,jt,we=zy({},T.imports,Y.imports,wc),Xe=Tu(we),yt=Ou(we,Xe),Pn=0,An=T.interpolate||gs,Fn="__p += '",rr=Vi((T.escape||gs).source+"|"+An.source+"|"+(An===Bn?pl:gs).source+"|"+(T.evaluate||gs).source+"|$","g"),Nr="//# sourceURL="+(lo.call(T,"sourceURL")?(T.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Pu+"]")+"\n";v.replace(rr,function(mi,Gi,po,Ic,Tc,xl){return po||(po=Ic),Fn+=v.slice(Pn,xl).replace(_a,lf),Gi&&(At=!0,Fn+="' +\n__e("+Gi+") +\n'"),Tc&&(jt=!0,Fn+="';\n"+Tc+";\n__p += '"),po&&(Fn+="' +\n((__t = ("+po+")) == null ? '' : __t) +\n'"),Pn=xl+mi.length,mi}),Fn+="';\n";var gi=lo.call(T,"variable")&&T.variable;if(gi){if(Xo.test(gi))throw new Tr("Invalid `variable` option passed into `_.template`")}else Fn="with (obj) {\n"+Fn+"\n}\n";Fn=(jt?Fn.replace(be,""):Fn).replace(tt,"$1").replace(ct,"$1;"),Fn="function("+(gi||"obj")+") {\n"+(gi?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(At?", __e = _.escape":"")+(jt?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+Fn+"return __p\n}";var Yi=rf(function(){return qi(Xe,Nr+"return "+Fn).apply(q,yt)});if(Yi.source=Fn,Oy(Yi))throw Yi;return Yi},ke.times=function kd(v,T){if((v=Di(v))<1||v>ft)return[];var F=Xt,Y=ba(v,Xt);T=si(T),v-=Xt;for(var we=Tl(Y,T);++F<v;)T(F);return we},ke.toFinite=mu,ke.toInteger=Di,ke.toLength=xm,ke.toLower=function K_(v){return $s(v).toLowerCase()},ke.toNumber=qc,ke.toSafeInteger=function sx(v){return v?se(Di(v),-ft,ft):0===v?v:0},ke.toString=$s,ke.toUpper=function J_(v){return $s(v).toUpperCase()},ke.trim=function yg(v,T,F){if((v=$s(v))&&(F||T===q))return Ta(v);if(!v||!(T=Zl(T)))return v;var Y=ea(v),we=ea(T);return Gf(Y,wu(Y,we),tl(Y,we)+1).join("")},ke.trimEnd=function Rd(v,T,F){if((v=$s(v))&&(F||T===q))return v.slice(0,ta(v)+1);if(!v||!(T=Zl(T)))return v;var Y=ea(v);return Gf(Y,0,tl(Y,ea(T))+1).join("")},ke.trimStart=function A0(v,T,F){if((v=$s(v))&&(F||T===q))return v.replace(fi,"");if(!v||!(T=Zl(T)))return v;var Y=ea(v);return Gf(Y,wu(Y,ea(T))).join("")},ke.truncate=function _g(v,T){var F=30,Y="...";if(Pa(T)){var we="separator"in T?T.separator:we;F="length"in T?Di(T.length):F,Y="omission"in T?Zl(T.omission):Y}var Xe=(v=$s(v)).length;if(Rs(v)){var yt=ea(v);Xe=yt.length}if(F>=Xe)return v;var At=F-Eu(Y);if(At<1)return Y;var jt=yt?Gf(yt,0,At).join(""):v.slice(0,At);if(we===q)return jt+Y;if(yt&&(At+=jt.length-At),z_(we)){if(v.slice(At).search(we)){var Pn,An=jt;for(we.global||(we=Vi(we.source,$s(wo.exec(we))+"g")),we.lastIndex=0;Pn=we.exec(An);)var Fn=Pn.index;jt=jt.slice(0,Fn===q?At:Fn)}}else if(v.indexOf(Zl(we),At)!=At){var rr=jt.lastIndexOf(we);rr>-1&&(jt=jt.slice(0,rr))}return jt+Y},ke.unescape=function Nm(v){return(v=$s(v))&&Nt.test(v)?v.replace(Ze,Uh):v},ke.uniqueId=function Mp(v){var T=++as;return $s(v)+T},ke.upperCase=vg,ke.upperFirst=xg,ke.each=cp,ke.eachRight=um,ke.first=ec,bg(ke,function(){var v={};return kt(ke,function(T,F){lo.call(ke.prototype,F)||(v[F]=T)}),v}(),{chain:!1}),ke.VERSION="4.17.21",oi(["bind","bindKey","curry","curryRight","partial","partialRight"],function(v){ke[v].placeholder=ke}),oi(["drop","take"],function(v,T){x.prototype[v]=function(F){F=F===q?1:Or(Di(F),0);var Y=this.__filtered__&&!T?new x(this):this.clone();return Y.__filtered__?Y.__takeCount__=ba(F,Y.__takeCount__):Y.__views__.push({size:ba(F,Xt),type:v+(Y.__dir__<0?"Right":"")}),Y},x.prototype[v+"Right"]=function(F){return this.reverse()[v](F).reverse()}}),oi(["filter","map","takeWhile"],function(v,T){var F=T+1,Y=1==F||3==F;x.prototype[v]=function(we){var Xe=this.clone();return Xe.__iteratees__.push({iteratee:si(we,3),type:F}),Xe.__filtered__=Xe.__filtered__||Y,Xe}}),oi(["head","last"],function(v,T){var F="take"+(T?"Right":"");x.prototype[v]=function(){return this[F](1).value()[0]}}),oi(["initial","tail"],function(v,T){var F="drop"+(T?"":"Right");x.prototype[v]=function(){return this.__filtered__?new x(this):this[F](1)}}),x.prototype.compact=function(){return this.filter(Bl)},x.prototype.find=function(v){return this.filter(v).head()},x.prototype.findLast=function(v){return this.reverse().find(v)},x.prototype.invokeMap=Zi(function(v,T){return"function"==typeof v?new x(this):this.map(function(F){return Vr(F,v,T)})}),x.prototype.reject=function(v){return this.filter(mm(si(v)))},x.prototype.slice=function(v,T){v=Di(v);var F=this;return F.__filtered__&&(v>0||T<0)?new x(F):(v<0?F=F.takeRight(-v):v&&(F=F.drop(v)),T!==q&&(F=(T=Di(T))<0?F.dropRight(-T):F.take(T-v)),F)},x.prototype.takeRightWhile=function(v){return this.reverse().takeWhile(v).reverse()},x.prototype.toArray=function(){return this.take(Xt)},kt(x.prototype,function(v,T){var F=/^(?:filter|find|map|reject)|While$/.test(T),Y=/^(?:head|last)$/.test(T),we=ke[Y?"take"+("last"==T?"Right":""):T],Xe=Y||/^find/.test(T);we&&(ke.prototype[T]=function(){var yt=this.__wrapped__,At=Y?[1]:arguments,jt=yt instanceof x,Pn=At[0],An=jt||Ii(yt),Fn=function(Gi){var po=we.apply(ke,ki([Gi],At));return Y&&rr?po[0]:po};An&&F&&"function"==typeof Pn&&1!=Pn.length&&(jt=An=!1);var rr=this.__chain__,gi=Xe&&!rr,Yi=jt&&!this.__actions__.length;if(!Xe&&An){yt=Yi?yt:new x(this);var mi=v.apply(yt,At);return mi.__actions__.push({func:sm,args:[Fn],thisArg:q}),new y(mi,rr)}return gi&&Yi?v.apply(this,At):(mi=this.thru(Fn),gi?Y?mi.value()[0]:mi.value():mi)})}),oi(["pop","push","shift","sort","splice","unshift"],function(v){var T=uo[v],F=/^(?:push|sort|unshift)$/.test(v)?"tap":"thru",Y=/^(?:pop|shift)$/.test(v);ke.prototype[v]=function(){var we=arguments;if(Y&&!this.__chain__){var Xe=this.value();return T.apply(Ii(Xe)?Xe:[],we)}return this[F](function(yt){return T.apply(Ii(yt)?yt:[],we)})}}),kt(x.prototype,function(v,T){var F=ke[T];if(F){var Y=F.name+"";lo.call(xr,Y)||(xr[Y]=[]),xr[Y].push({name:T,func:F})}}),xr[th(q,2).name]=[{name:"wrapper",func:q}],x.prototype.clone=function D(){var v=new x(this.__wrapped__);return v.__actions__=Rl(this.__actions__),v.__dir__=this.__dir__,v.__filtered__=this.__filtered__,v.__iteratees__=Rl(this.__iteratees__),v.__takeCount__=this.__takeCount__,v.__views__=Rl(this.__views__),v},x.prototype.reverse=function U(){if(this.__filtered__){var v=new x(this);v.__dir__=-1,v.__filtered__=!0}else(v=this.clone()).__dir__*=-1;return v},x.prototype.value=function H(){var v=this.__wrapped__.value(),T=this.__dir__,F=Ii(v),Y=T<0,we=F?v.length:0,Xe=function Id(v,T,F){for(var Y=-1,we=F.length;++Y<we;){var Xe=F[Y],yt=Xe.size;switch(Xe.type){case"drop":v+=yt;break;case"dropRight":T-=yt;break;case"take":T=ba(T,v+yt);break;case"takeRight":v=Or(v,T-yt)}}return{start:v,end:T}}(0,we,this.__views__),yt=Xe.start,At=Xe.end,jt=At-yt,Pn=Y?At:yt-1,An=this.__iteratees__,Fn=An.length,rr=0,Nr=ba(jt,this.__takeCount__);if(!F||!Y&&we==jt&&Nr==jt)return yc(v,this.__actions__);var gi=[];e:for(;jt--&&rr<Nr;){for(var Yi=-1,mi=v[Pn+=T];++Yi<Fn;){var Gi=An[Yi],Ic=Gi.type,Tc=(0,Gi.iteratee)(mi);if(2==Ic)mi=Tc;else if(!Tc){if(1==Ic)continue e;break e}}gi[rr++]=mi}return gi},ke.prototype.at=bc,ke.prototype.chain=function tg(){return _y(this)},ke.prototype.commit=function P_(){return new y(this.value(),this.__chain__)},ke.prototype.next=function Yf(){this.__values__===q&&(this.__values__=Sh(this.value()));var v=this.__index__>=this.__values__.length;return{done:v,value:v?q:this.__values__[this.__index__++]}},ke.prototype.plant=function ia(v){for(var T,F=this;F instanceof h;){var Y=cs(F);Y.__index__=0,Y.__values__=q,T?we.__wrapped__=Y:T=Y;var we=Y;F=F.__wrapped__}return we.__wrapped__=v,T},ke.prototype.reverse=function ng(){var v=this.__wrapped__;if(v instanceof x){var T=v;return this.__actions__.length&&(T=new x(this)),(T=T.reverse()).__actions__.push({func:sm,args:[M_],thisArg:q}),new y(T,this.__chain__)}return this.thru(M_)},ke.prototype.toJSON=ke.prototype.valueOf=ke.prototype.value=function vy(){return yc(this.__wrapped__,this.__actions__)},ke.prototype.first=ke.prototype.head,pa&&(ke.prototype[pa]=function Ol(){return this}),ke}();Zo._=_l,(me=function(){return _l}.call(ot,ve,ot,Dt))!==q&&(Dt.exports=me)}.call(this)},9898:function(Dt){Dt.exports=function(){"use strict";var ot,ve,me;function q(p,J){if(ot)if(ve){var ye="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+ot+")(sharedChunk); ("+ve+")(sharedChunk); self.onerror = null;",Ce={};ot(Ce),me=J(Ce),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(me.workerUrl=window.URL.createObjectURL(new Blob([ye],{type:"text/javascript"})))}else ve=J;else ot=J}return q(0,function(p){var J=typeof self<"u"?self:{},ye="2.15.0";let Ce;const Pe={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Ce){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ce=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):s}catch{Ce=s}}return Ce},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Pe.API_URL)return null;try{const s=new URL(Pe.API_URL);return"api.mapbox.cn"===s.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===s.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},qe={supported:!1,testSupport:function(s){!st&&gt&&(mt?Mt(s):It=s)}};let It,gt,st=!1,mt=!1;function Mt(s){const i=s.createTexture();s.bindTexture(s.TEXTURE_2D,i);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,gt),s.isContextLost())return;qe.supported=!0}catch{}s.deleteTexture(i),st=!0}J.document&&(gt=J.document.createElement("img"),gt.onload=function(){It&&Mt(It),It=null,mt=!0},gt.onerror=function(){st=!0,It=null},gt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const le="01";function K(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var ne=ce;function ce(s,i,u,f){this.cx=3*s,this.bx=3*(u-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=u,this.p2y=f}ce.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(void 0===i&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var u=s,f=0;f<8;f++){var m=this.sampleCurveX(u)-s;if(Math.abs(m)<i)return u;var b=this.sampleCurveDerivativeX(u);if(Math.abs(b)<1e-6)break;u-=m/b}var I=0,A=1;for(u=s,f=0;f<20&&(m=this.sampleCurveX(u),!(Math.abs(m-s)<i));f++)s>m?I=u:A=u,u=.5*(A-I)+I;return u},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var ee=K(ne),ae=oe;function oe(s,i){this.x=s,this.y=i}oe.prototype={clone:function(){return new oe(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,i){return this.clone()._rotateAround(s,i)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var i=s.x-this.x,u=s.y-this.y;return i*i+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,i){return Math.atan2(this.x*i-this.y*s,this.x*s+this.y*i)},_matMult:function(s){var i=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=i,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var i=Math.cos(s),u=Math.sin(s),f=u*this.x+i*this.y;return this.x=i*this.x-u*this.y,this.y=f,this},_rotateAround:function(s,i){var u=Math.cos(s),f=Math.sin(s),m=i.y+f*(this.x-i.x)+u*(this.y-i.y);return this.x=i.x+u*(this.x-i.x)-f*(this.y-i.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},oe.convert=function(s){return s instanceof oe?s:Array.isArray(s)?new oe(s[0],s[1]):s};var te=K(ae);const _e=Math.PI/180,re=180/Math.PI;function Je(s){return s*_e}function He(s){return s*re}const it=[[0,0],[1,0],[1,1],[0,1]];function Ne(s){if(s<=0)return 0;if(s>=1)return 1;const i=s*s,u=i*s;return 4*(s<.5?u:3*(s-i)+u-.75)}function sn(s,i,u,f){const m=new ee(s,i,u,f);return function(b){return m.solve(b)}}const Bt=sn(.25,.1,.25,1);function Le(s,i,u){return Math.min(u,Math.max(i,s))}function bt(s,i,u){return(u=Le((u-s)/(i-s),0,1))*u*(3-2*u)}function Ue(s,i,u){const f=u-i,m=((s-i)%f+f)%f+i;return m===i?u:m}function ft(s,i,u){if(!s.length)return u(null,[]);let f=s.length;const m=new Array(s.length);let b=null;s.forEach((I,A)=>{i(I,(O,N)=>{O&&(b=O),m[A]=N,0==--f&&u(b,m)})})}function Tt(s){const i=[];for(const u in s)i.push(s[u]);return i}function Be(s,...i){for(const u of i)for(const f in u)s[f]=u[f];return s}let Xt=1;function Jt(){return Xt++}function Rn(){return function s(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function zt(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Jn(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function Mn(s,i){s.forEach(u=>{i[u]&&(i[u]=i[u].bind(i))})}function jn(s,i){return-1!==s.indexOf(i,s.length-i.length)}function xn(s,i,u){const f={};for(const m in s)f[m]=i.call(u||this,s[m],m,s);return f}function Nn(s,i,u){const f={};for(const m in s)i.call(u||this,s[m],m,s)&&(f[m]=s[m]);return f}function wn(s){return Array.isArray(s)?s.map(wn):"object"==typeof s&&s?xn(s,wn):s}const Wi={};function Sr(s){Wi[s]||(typeof console<"u"&&console.warn(s),Wi[s]=!0)}function Oi(s,i,u){return(u.y-s.y)*(i.x-s.x)>(i.y-s.y)*(u.x-s.x)}function ar(s){let i=0;for(let u,f,m=0,b=s.length,I=b-1;m<b;I=m++)u=s[m],f=s[I],i+=(f.x-u.x)*(u.y+f.y);return i}function mr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Pt(s){const i={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,f,m,b)=>{const I=m||b;return i[f]=!I||I.toLowerCase(),""}),i["max-age"]){const u=parseInt(i["max-age"],10);isNaN(u)?delete i["max-age"]:i["max-age"]=u}return i}let Re=null;function Te(s){if(null==Re){const i=s.navigator?s.navigator.userAgent:null;Re=!!s.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Re}function Se(s){try{const i=J[s];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}}function et(s,i){return[s[4*i],s[4*i+1],s[4*i+2],s[4*i+3]]}const Ct="mapbox-tiles";let _n,en,Yt=500,yn=50;function Dr(){try{return J.caches}catch{}}function Pr(){Dr()&&!_n&&(_n=J.caches.open(Ct))}function zn(s){const i=s.indexOf("?");if(i<0)return s;const f=function(m){const b=m.indexOf("?");return b>0?m.slice(b+1).split("&"):[]}(s).filter(m=>{const b=m.split("=");return"language"===b[0]||"worldview"===b[0]});return f.length?`${s.slice(0,i)}?${f.join("&")}`:s.slice(0,i)}let Gr=1/0;const Pi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Pi);class ni extends Error{constructor(i,u,f){401===u&&Ft(f)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=u,this.url=f}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ci=mr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===J.location.protocol?J.parent:J).location.href,Ki=function(s,i){if(!(/^file:/.test(u=s.url)||/^file:/.test(Ci())&&!/^\w+:/.test(u))){if(J.fetch&&J.Request&&J.AbortController&&J.Request.prototype.hasOwnProperty("signal"))return function(f,m){const b=new J.AbortController,I=new J.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:Ci(),referrerPolicy:f.referrerPolicy,signal:b.signal});let A=!1,O=!1;const N=(j=I.url).indexOf("sku=")>0&&Ft(j);var j;"json"===f.type&&I.headers.set("Accept","application/json");const $=(Q,ie,ge)=>{if(O)return;if(Q&&"SecurityError"!==Q.message&&Sr(Q.toString()),ie&&ge)return W(ie);const De=Date.now();J.fetch(I).then(Ye=>{if(Ye.ok){const ht=N?Ye.clone():null;return W(Ye,ht,De)}return m(new ni(Ye.statusText,Ye.status,f.url))}).catch(Ye=>{"AbortError"!==Ye.name&&m(new Error(`${Ye.message} ${f.url}`))})},W=(Q,ie,ge)=>{("arrayBuffer"===f.type?Q.arrayBuffer():"json"===f.type?Q.json():Q.text()).then(De=>{O||(ie&&ge&&function(Ye,ht,Ke){if(Pr(),!_n)return;const ut={status:ht.status,statusText:ht.statusText,headers:new J.Headers};ht.headers.forEach((Kt,Wt)=>ut.headers.set(Wt,Kt));const xt=Pt(ht.headers.get("Cache-Control")||"");if(xt["no-store"])return;xt["max-age"]&&ut.headers.set("Expires",new Date(Ke+1e3*xt["max-age"]).toUTCString());const _t=ut.headers.get("Expires");_t&&(new Date(_t).getTime()-Ke<42e4||function(Kt,Wt){if(void 0===en)try{new Response(new ReadableStream),en=!0}catch{en=!1}en?Wt(Kt.body):Kt.blob().then(Wt)}(ht,Kt=>{const Wt=new J.Response(Kt,ut);Pr(),_n&&_n.then(hn=>hn.put(zn(Ye.url),Wt)).catch(hn=>Sr(hn.message))}))}(I,ie,ge),A=!0,m(null,De,Q.headers.get("Cache-Control"),Q.headers.get("Expires")))}).catch(De=>{O||m(new Error(De.message))})};return N?function(Q,ie){if(Pr(),!_n)return ie(null);const ge=zn(Q.url);_n.then(De=>{De.match(ge).then(Ye=>{const ht=function(Ke){if(!Ke)return!1;const ut=new Date(Ke.headers.get("Expires")||0),xt=Pt(Ke.headers.get("Cache-Control")||"");return ut>Date.now()&&!xt["no-cache"]}(Ye);De.delete(ge),ht&&De.put(ge,Ye.clone()),ie(null,Ye,ht)}).catch(ie)}).catch(ie)}(I,$):$(null,null),{cancel:()=>{O=!0,A||b.abort()}}}(s,i);if(mr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,i,void 0,!0)}var u;return function(f,m){const b=new J.XMLHttpRequest;b.open(f.method||"GET",f.url,!0),"arrayBuffer"===f.type&&(b.responseType="arraybuffer");for(const I in f.headers)b.setRequestHeader(I,f.headers[I]);return"json"===f.type&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials="include"===f.credentials,b.onerror=()=>{m(new Error(b.statusText))},b.onload=()=>{if((b.status>=200&&b.status<300||0===b.status)&&null!==b.response){let I=b.response;if("json"===f.type)try{I=JSON.parse(b.response)}catch(A){return m(A)}m(null,I,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else m(new ni(b.statusText,b.status,f.url))},b.send(f.body),{cancel:()=>b.abort()}}(s,i)},ts=function(s,i){return Ki(Be(s,{type:"arrayBuffer"}),i)};function Hs(s){const i=J.document.createElement("a");return i.href=s,i.protocol===J.document.location.protocol&&i.host===J.document.location.host}const rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let xe,be;xe=[],be=0;const tt=function(s,i){if(qe.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),be>=Pe.MAX_PARALLEL_IMAGE_REQUESTS){const b={requestParameters:s,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return xe.push(b),b}be++;let u=!1;const f=()=>{if(!u)for(u=!0,be--;xe.length&&be<Pe.MAX_PARALLEL_IMAGE_REQUESTS;){const b=xe.shift(),{requestParameters:I,callback:A,cancelled:O}=b;O||(b.cancel=tt(I,A).cancel)}},m=ts(s,(b,I,A,O)=>{f(),b?i(b):I&&(J.createImageBitmap?function(N,j){const $=new J.Blob([new Uint8Array(N)],{type:"image/png"});J.createImageBitmap($).then(W=>{j(null,W)}).catch(W=>{j(new Error(`Could not load image because of ${W.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(I,(N,j)=>i(N,j,A,O)):function(N,j){const $=new J.Image,W=J.URL;$.onload=()=>{j(null,$),W.revokeObjectURL($.src),$.onload=null,J.requestAnimationFrame(()=>{$.src=rt})},$.onerror=()=>j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Q=new J.Blob([new Uint8Array(N)],{type:"image/png"});$.src=N.byteLength?W.createObjectURL(Q):rt}(I,(N,j)=>i(N,j,A,O)))});return{cancel:()=>{m.cancel(),f()}}},ct="NO_ACCESS_TOKEN";function Ze(s){return 0===s.indexOf("mapbox:")}function Ft(s){return Pe.API_URL_REGEX.test(s)}function Nt(s){return Pe.API_CDN_URL_REGEX.test(s)}function lt(s){return Pe.API_STYLE_REGEX.test(s)&&!Zt(s)}function Zt(s){return Pe.API_SPRITE_REGEX.test(s)}const Cn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Bn(s){const i=s.match(Cn);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function Sn(s){const i=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${i}`}const ri="mapbox.eventData";function li(s){if(!s)return null;const i=s.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(J.atob(i[1]).split("").map(u=>"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Yr{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const u=li(Pe.ACCESS_TOKEN);let f="";return f=u&&u.u?J.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,(m,b)=>String.fromCharCode(+("0x"+b)))):Pe.ACCESS_TOKEN||"",i?`${ri}.${i}:${f}`:`${ri}:${f}`}fetchEventData(){const i=Se("localStorage"),u=this.getStorageKey(),f=this.getStorageKey("uuid");if(i)try{const m=J.localStorage.getItem(u);m&&(this.eventData=JSON.parse(m));const b=J.localStorage.getItem(f);b&&(this.anonId=b)}catch{Sr("Unable to read from LocalStorage")}}saveEventData(){const i=Se("localStorage"),u=this.getStorageKey(),f=this.getStorageKey("uuid");if(i)try{J.localStorage.setItem(f,this.anonId),Object.keys(this.eventData).length>=1&&J.localStorage.setItem(u,JSON.stringify(this.eventData))}catch{Sr("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,u,f,m){if(!Pe.EVENTS_URL)return;const b=Bn(Pe.EVENTS_URL);b.params.push(`access_token=${m||Pe.ACCESS_TOKEN||""}`);const I={event:this.type,created:new Date(i).toISOString()},A=u?Be(I,u):I,O={url:Sn(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};var j;this.pendingRequest=(j=N=>{this.pendingRequest=null,f(N),this.saveEventData(),this.processRequests(m)},Ki(Be(O,{method:"POST"}),j))}queueRequest(i,u){this.queue.push(i),this.processRequests(u)}}const Cr=new class extends Yr{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,i){Pe.EVENTS_URL&&Pe.ACCESS_TOKEN&&Array.isArray(s)&&s.some(u=>Ze(u)||Ft(u))&&this.queueRequest(Date.now(),i)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=li(Pe.ACCESS_TOKEN),u=i?i.u:Pe.ACCESS_TOKEN;let f=u!==this.eventData.tokenU;Jn(this.anonId)||(this.anonId=Rn(),f=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),I=new Date(m),A=(m-this.eventData.lastSuccess)/864e5;f=f||A>=1||A<-1||b.getDate()!==I.getDate()}else f=!0;f?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ye,skuId:le,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=m,this.eventData.tokenU=u)},s):this.processRequests()}},fi=Cr.postTurnstileEvent.bind(Cr),fs=new class extends Yr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,i,u,f){this.skuToken=i,this.errorCb=f,Pe.EVENTS_URL&&(u||Pe.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},u):this.errorCb(new Error(ct)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:u}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),Jn(this.anonId)||(this.anonId=Rn()),this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ye,skuId:le,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):i&&(this.success[i]=!0)},s))}},ds=fs.postMapLoadEvent.bind(fs),Xr=new class extends Yr{constructor(){super("gljs.performance")}postPerformanceEvent(s,i){Pe.EVENTS_URL&&(s||Pe.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},s)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:u}=this.queue.shift(),f=function(m){const b=J.performance.getEntriesByType("resource"),I=J.performance.getEntriesByType("mark"),A=function(W){const Q={};if(W)for(const ie in W)if("other"!==ie)for(const ge of W[ie]){const De=`${ie}ResolveRangeMin`,Ye=`${ie}ResolveRangeMax`,ht=`${ie}RequestCount`,Ke=`${ie}RequestCachedCount`;Q[De]=Math.min(Q[De]||1/0,ge.startTime),Q[Ye]=Math.max(Q[Ye]||-1/0,ge.responseEnd);const ut=xt=>{void 0===Q[xt]&&(Q[xt]=0),++Q[xt]};void 0!==ge.transferSize&&0===ge.transferSize&&ut(Ke),ut(ht)}return Q}(function(W,Q){const ie={};if(W)for(const ge of W){const De=Q(ge);void 0===ie[De]&&(ie[De]=[]),ie[De].push(ge)}return ie}(b,uc)),O=J.devicePixelRatio,N=J.navigator.connection||J.navigator.mozConnection||J.navigator.webkitConnection,j={counters:[],metadata:[],attributes:[]},$=(W,Q,ie)=>{null!=ie&&W.push({name:Q,value:ie.toString()})};for(const W in A)$(j.counters,W,A[W]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&($(j.counters,"interactionRangeMin",m.interactionRange[0]),$(j.counters,"interactionRangeMax",m.interactionRange[1])),I)for(const W of Object.keys(pl)){const Q=pl[W],ie=I.find(ge=>ge.name===Q);ie&&$(j.counters,Q,ie.startTime)}return $(j.counters,"visibilityHidden",m.visibilityHidden),$(j.attributes,"style",function(W){if(W)for(const Q of W){const ie=Q.name.split("?")[0];if(lt(ie)){const ge=ie.split("/").slice(-2);if(2===ge.length)return`mapbox://styles/${ge[0]}/${ge[1]}`}}}(b)),$(j.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),$(j.attributes,"fogEnabled",m.fogEnabled?"true":"false"),$(j.attributes,"projection",m.projection),$(j.attributes,"zoom",m.zoom),$(j.metadata,"devicePixelRatio",O),$(j.metadata,"connectionEffectiveType",N?N.effectiveType:void 0),$(j.metadata,"navigatorUserAgent",J.navigator.userAgent),$(j.metadata,"screenWidth",J.screen.width),$(j.metadata,"screenHeight",J.screen.height),$(j.metadata,"windowWidth",J.innerWidth),$(j.metadata,"windowHeight",J.innerHeight),$(j.metadata,"mapWidth",m.width/O),$(j.metadata,"mapHeight",m.height/O),$(j.metadata,"webglRenderer",m.renderer),$(j.metadata,"webglVendor",m.vendor),$(j.metadata,"sdkVersion",ye),$(j.metadata,"sdkIdentifier","mapbox-gl-js"),j}(u);for(const m of f.metadata);for(const m of f.counters);for(const m of f.attributes);this.postEvent(i,f,()=>{},s)}},ao=Xr.postPerformanceEvent.bind(Xr),ya=new class extends Yr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,i,u,f){if(!Pe.API_URL||!Pe.SESSION_PATH)return;const m=Bn(Pe.API_URL+Pe.SESSION_PATH);m.params.push(`sku=${i||""}`),m.params.push(`access_token=${f||Pe.ACCESS_TOKEN||""}`);const b={url:Sn(m),headers:{"Content-Type":"text/plain"}};var A;this.pendingRequest=(A=I=>{this.pendingRequest=null,u(I),this.saveEventData(),this.processRequests(f)},Ki(Be(b,{method:"GET"}),A))}getSessionAPI(s,i,u,f){this.skuToken=i,this.errorCb=f,Pe.SESSION_PATH&&Pe.API_URL&&(u||Pe.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},u):this.errorCb(new Error(ct)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:u}=this.queue.shift();i&&this.success[i]||this.getSession(u,this.skuToken,f=>{f?this.errorCb(f):i&&(this.success[i]=!0)},s)}},Xo=ya.getSessionAPI.bind(ya),zi=new Set,pl={create:"create",load:"load",fullLoad:"fullLoad"},wo={mark(s){J.performance.mark(s)},measure(s,i,u){J.performance.measure(s,i,u)}};function uc(s){const i=s.name.split("?")[0];return Nt(i)&&i.includes("mapbox-gl.js")?"javascript":Nt(i)&&i.includes("mapbox-gl.css")?"css":Pe.API_FONTS_REGEX.test(i)?"fontRange":Zt(i)?"sprite":lt(i)?"style":Pe.API_TILEJSON_REGEX.test(i)?"tilejson":"other"}const Br=J.performance;function Lf(s){const i=s?s.url.toString():void 0;return Br.getEntriesByName(i)}let ns,ps,lc,gs;const _a={now:()=>void 0!==lc?lc:J.performance.now(),setNow(s){lc=s},restoreNow(){lc=void 0},frame(s){const i=J.requestAnimationFrame(s);return{cancel:()=>J.cancelAnimationFrame(i)}},getImageData(s,i=0){const{width:u,height:f}=s;gs||(gs=J.document.createElement("canvas"));const m=gs.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return(u>gs.width||f>gs.height)&&(gs.width=u,gs.height=f),m.clearRect(-i,-i,u+2*i,f+2*i),m.drawImage(s,0,0,u,f),m.getImageData(-i,-i,u+2*i,f+2*i)},resolveURL:s=>(ns||(ns=J.document.createElement("a")),ns.href=s,ns.href),get devicePixelRatio(){return J.devicePixelRatio},get prefersReducedMotion(){return!!J.matchMedia&&(null==ps&&(ps=J.matchMedia("(prefers-reduced-motion: reduce)")),ps.matches)}};function ms(s,i,u){u[s]&&-1!==u[s].indexOf(i)||(u[s]=u[s]||[],u[s].push(i))}function Ac(s,i,u){if(u&&u[s]){const f=u[s].indexOf(i);-1!==f&&u[s].splice(f,1)}}class Za{constructor(i,u={}){Be(this,u),this.type=i}}class Oa extends Za{constructor(i,u={}){super("error",Be({error:i},u))}}class Na{on(i,u){return this._listeners=this._listeners||{},ms(i,u,this._listeners),this}off(i,u){return Ac(i,u,this._listeners),Ac(i,u,this._oneTimeListeners),this}once(i,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},ms(i,u,this._oneTimeListeners),this):new Promise(f=>this.once(i,f))}fire(i,u){"string"==typeof i&&(i=new Za(i,u||{}));const f=i.type;if(this.listens(f)){i.target=this;const m=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const A of m)A.call(this,i);const b=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const A of b)Ac(f,A,this._oneTimeListeners),A.call(this,i);const I=this._eventedParent;I&&(Be(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),I.fire(i))}else i instanceof Oa&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,u){return this._eventedParent=i,this._eventedParentData=u,this}}var on=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Wu(s,...i){for(const u of i)for(const f in u)s[f]=u[f];return s}function Ms(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function aa(s){if(Array.isArray(s))return s.map(aa);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const i={};for(const u in s)i[u]=aa(s[u]);return i}return Ms(s)}class Ds extends Error{constructor(i,u){super(u),this.message=u,this.key=i}}var bs=Ds;class Xu{constructor(i,u=[]){this.parent=i,this.bindings={};for(const[f,m]of u)this.bindings[f]=m}concat(i){return new Xu(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}var Qr=Xu;const Pc={kind:"null"},pn={kind:"number"},Zr={kind:"string"},zr={kind:"boolean"},Ya={kind:"color"},er={kind:"object"},di={kind:"value"},yo={kind:"collator"},Gl={kind:"formatted"},Ia={kind:"resolvedImage"};function Qs(s,i){return{kind:"array",itemType:s,N:i}}function ur(s){if("array"===s.kind){const i=ur(s.itemType);return"number"==typeof s.N?`array<${i}, ${s.N}>`:"value"===s.itemType.kind?"array":`array<${i}>`}return s.kind}const hh=[Pc,pn,Zr,zr,Ya,Gl,er,Qs(di),Ia];function Tn(s,i){if("error"===i.kind)return null;if("array"===s.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!Tn(s.itemType,i.itemType))&&("number"!=typeof s.N||s.N===i.N))return null}else{if(s.kind===i.kind)return null;if("value"===s.kind)for(const u of hh)if(!Tn(u,i))return null}return`Expected ${ur(s)} but found ${ur(i)} instead.`}function Il(s,i){return i.some(u=>u.kind===s.kind)}function Ka(s,i){return i.some(u=>"null"===u?null===s:"array"===u?Array.isArray(s):"object"===u?s&&!Array.isArray(s)&&"object"==typeof s:u===typeof s)}var Hn,Wc={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function dr(s){return(s=Math.round(s))<0?0:s>255?255:s}function vr(s){return dr("%"===s[s.length-1]?parseFloat(s)/100*255:parseInt(s))}function Ui(s){return(i="%"===s[s.length-1]?parseFloat(s)/100:parseFloat(s))<0?0:i>1?1:i;var i}function rs(s,i,u){return u<0?u+=1:u>1&&(u-=1),6*u<1?s+(i-s)*u*6:2*u<1?i:3*u<2?s+(i-s)*(2/3-u)*6:s}try{Hn={}.parseCSSColor=function(s){var i,u=s.replace(/ /g,"").toLowerCase();if(u in Wc)return Wc[u].slice();if("#"===u[0])return 4===u.length?(i=parseInt(u.substr(1),16))>=0&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null:7===u.length&&(i=parseInt(u.substr(1),16))>=0&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null;var f=u.indexOf("("),m=u.indexOf(")");if(-1!==f&&m+1===u.length){var b=u.substr(0,f),I=u.substr(f+1,m-(f+1)).split(","),A=1;switch(b){case"rgba":if(4!==I.length)return null;A=Ui(I.pop());case"rgb":return 3!==I.length?null:[vr(I[0]),vr(I[1]),vr(I[2]),A];case"hsla":if(4!==I.length)return null;A=Ui(I.pop());case"hsl":if(3!==I.length)return null;var O=(parseFloat(I[0])%360+360)%360/360,N=Ui(I[1]),j=Ui(I[2]),$=j<=.5?j*(N+1):j+N-j*N,W=2*j-$;return[dr(255*rs(W,$,O+1/3)),dr(255*rs(W,$,O)),dr(255*rs(W,$,O-1/3)),A];default:return null}}return null}}catch{}class Zu{constructor(i,u,f,m=1){this.r=i,this.g=u,this.b=f,this.a=m}static parse(i){if(!i)return;if(i instanceof Zu)return i;if("string"!=typeof i)return;const u=Hn(i);return u?new Zu(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3]):void 0}toString(){const[i,u,f,m]=this.toArray();return`rgba(${Math.round(i)},${Math.round(u)},${Math.round(f)},${m})`}toArray(){const{r:i,g:u,b:f,a:m}=this;return 0===m?[0,0,0,0]:[255*i/m,255*u/m,255*f/m,m]}toArray01(){const{r:i,g:u,b:f,a:m}=this;return 0===m?[0,0,0,0]:[i/m,u/m,f/m,m]}toArray01PremultipliedAlpha(){const{r:i,g:u,b:f,a:m}=this;return[i,u,f,m]}}Zu.black=new Zu(0,0,0,1),Zu.white=new Zu(1,1,1,1),Zu.transparent=new Zu(0,0,0,0),Zu.red=new Zu(1,0,0,1),Zu.blue=new Zu(0,0,1,1);var zs=Zu;class is{constructor(i,u,f){this.sensitivity=i?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,u){return this.collator.compare(i,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class kh{constructor(i,u,f,m,b){this.text=i.normalize?i.normalize():i,this.image=u,this.scale=f,this.fontStack=m,this.textColor=b}}class Us{constructor(i){this.sections=i}static fromString(i){return new Us([new kh(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.name.length)}static factory(i){return i instanceof Us?i:Us.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const u of this.sections){if(u.image){i.push(["image",u.image.name]);continue}i.push(u.text);const f={};u.fontStack&&(f["text-font"]=["literal",u.fontStack.split(",")]),u.scale&&(f["font-scale"]=u.scale),u.textColor&&(f["text-color"]=["rgba"].concat(u.textColor.toArray())),i.push(f)}return i}}class Ti{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Ti({name:i,available:!1}):null}serialize(){return["image",this.name]}}function gl(s,i,u,f){return"number"==typeof s&&s>=0&&s<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof u&&u>=0&&u<=255?void 0===f||"number"==typeof f&&f>=0&&f<=1?null:`Invalid rgba value [${[s,i,u,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof f?[s,i,u,f]:[s,i,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ua(s){if(null===s||"string"==typeof s||"boolean"==typeof s||"number"==typeof s||s instanceof zs||s instanceof is||s instanceof Us||s instanceof Ti)return!0;if(Array.isArray(s)){for(const i of s)if(!ua(i))return!1;return!0}if("object"==typeof s){for(const i in s)if(!ua(s[i]))return!1;return!0}return!1}function As(s){if(null===s)return Pc;if("string"==typeof s)return Zr;if("boolean"==typeof s)return zr;if("number"==typeof s)return pn;if(s instanceof zs)return Ya;if(s instanceof is)return yo;if(s instanceof Us)return Gl;if(s instanceof Ti)return Ia;if(Array.isArray(s)){const i=s.length;let u;for(const f of s){const m=As(f);if(u){if(u===m)continue;u=di;break}u=m}return Qs(u||di,i)}return er}function Rc(s){const i=typeof s;return null===s?"":"string"===i||"number"===i||"boolean"===i?String(s):s instanceof zs||s instanceof Us||s instanceof Ti?s.toString():JSON.stringify(s)}class ys{constructor(i,u){this.type=i,this.value=u}static parse(i,u){if(2!==i.length)return u.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!ua(i[1]))return u.error("invalid value");const f=i[1];let m=As(f);const b=u.expectedType;return"array"!==m.kind||0!==m.N||!b||"array"!==b.kind||"number"==typeof b.N&&0!==b.N||(m=b),new ys(m,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof zs?["rgba"].concat(this.value.toArray()):this.value instanceof Us?this.value.serialize():this.value}}var la=ys,va=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const Pu={string:Zr,number:pn,boolean:zr,object:er};class Ji{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");let f,m=1;const b=i[0];if("array"===b){let A,O;if(i.length>2){const N=i[1];if("string"!=typeof N||!(N in Pu)||"object"===N)return u.error('The item type argument of "array" must be one of string, number, boolean',1);A=Pu[N],m++}else A=di;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return u.error('The length argument to "array" must be a positive integer literal',2);O=i[2],m++}f=Qs(A,O)}else f=Pu[b];const I=[];for(;m<i.length;m++){const A=u.parse(i[m],m,di);if(!A)return null;I.push(A)}return new Ji(f,I)}evaluate(i){for(let u=0;u<this.args.length;u++){const f=this.args[u].evaluate(i);if(!Tn(this.type,As(f)))return f;if(u===this.args.length-1)throw new va(`Expected value to be of type ${ur(this.type)}, but found ${ur(As(f))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,u=[i.kind];if("array"===i.kind){const f=i.itemType;if("string"===f.kind||"number"===f.kind||"boolean"===f.kind){u.push(f.kind);const m=i.N;("number"==typeof m||this.args.length>1)&&u.push(m)}}return u.concat(this.args.map(f=>f.serialize()))}}var Hr=Ji;class Mi{constructor(i){this.type=Gl,this.sections=i}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");const f=i[1];if(!Array.isArray(f)&&"object"==typeof f)return u.error("First argument must be an image or text section.");const m=[];let b=!1;for(let I=1;I<=i.length-1;++I){const A=i[I];if(b&&"object"==typeof A&&!Array.isArray(A)){b=!1;let O=null;if(A["font-scale"]&&(O=u.parse(A["font-scale"],1,pn),!O))return null;let N=null;if(A["text-font"]&&(N=u.parse(A["text-font"],1,Qs(Zr)),!N))return null;let j=null;if(A["text-color"]&&(j=u.parse(A["text-color"],1,Ya),!j))return null;const $=m[m.length-1];$.scale=O,$.font=N,$.textColor=j}else{const O=u.parse(i[I],1,di);if(!O)return null;const N=O.type.kind;if("string"!==N&&"value"!==N&&"null"!==N&&"resolvedImage"!==N)return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,m.push({content:O,scale:null,font:null,textColor:null})}}return new Mi(m)}evaluate(i){return new Us(this.sections.map(u=>{const f=u.content.evaluate(i);return As(f)===Ia?new kh("",f,null,null,null):new kh(Rc(f),null,u.scale?u.scale.evaluate(i):null,u.font?u.font.evaluate(i).join(","):null,u.textColor?u.textColor.evaluate(i):null)}))}eachChild(i){for(const u of this.sections)i(u.content),u.scale&&i(u.scale),u.font&&i(u.font),u.textColor&&i(u.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const u of this.sections){i.push(u.content.serialize());const f={};u.scale&&(f["font-scale"]=u.scale.serialize()),u.font&&(f["text-font"]=u.font.serialize()),u.textColor&&(f["text-color"]=u.textColor.serialize()),i.push(f)}return i}}class Vs{constructor(i){this.type=Ia,this.input=i}static parse(i,u){if(2!==i.length)return u.error("Expected two arguments.");const f=u.parse(i[1],1,Zr);return f?new Vs(f):u.error("No image name provided.")}evaluate(i){const u=this.input.evaluate(i),f=Ti.fromString(u);return f&&i.availableImages&&(f.available=i.availableImages.indexOf(u)>-1),f}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Gp={"to-boolean":zr,"to-color":Ya,"to-number":pn,"to-string":Zr};class Yu{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");const f=i[0];if(("to-boolean"===f||"to-string"===f)&&2!==i.length)return u.error("Expected one argument.");const m=Gp[f],b=[];for(let I=1;I<i.length;I++){const A=u.parse(i[I],I,di);if(!A)return null;b.push(A)}return new Yu(m,b)}evaluate(i){if("boolean"===this.type.kind)return!!this.args[0].evaluate(i);if("color"===this.type.kind){let u,f;for(const m of this.args){if(u=m.evaluate(i),f=null,u instanceof zs)return u;if("string"==typeof u){const b=i.parseColor(u);if(b)return b}else if(Array.isArray(u)&&(f=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:gl(u[0],u[1],u[2],u[3]),!f))return new zs(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new va(f||`Could not parse color from value '${"string"==typeof u?u:String(JSON.stringify(u))}'`)}if("number"===this.type.kind){let u=null;for(const f of this.args){if(u=f.evaluate(i),null===u)return 0;const m=Number(u);if(!isNaN(m))return m}throw new va(`Could not convert ${JSON.stringify(u)} to number.`)}return"formatted"===this.type.kind?Us.fromString(Rc(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?Ti.fromString(Rc(this.args[0].evaluate(i))):Rc(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Mi([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Vs(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(u=>{i.push(u.serialize())}),i}}var sr=Yu;const os=["Unknown","Point","LineString","Polygon"];var Ku=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?os[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:u,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*i-s[0])+this.featureDistanceData.bearing[1]*(f*i-s[1])}return 0}parseColor(s){let i=this._parseColorCache[s];return i||(i=this._parseColorCache[s]=zs.parse(s)),i}};class cc{constructor(i,u,f,m){this.name=i,this.type=u,this._evaluate=f,this.args=m}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,u){const f=i[0],m=cc.definitions[f];if(!m)return u.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(m)?m[0]:m.type,I=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,A=I.filter(([N])=>!Array.isArray(N)||N.length===i.length-1);let O=null;for(const[N,j]of A){O=new Oc(u.registry,u.path,null,u.scope);const $=[];let W=!1;for(let Q=1;Q<i.length;Q++){const ie=i[Q],ge=Array.isArray(N)?N[Q-1]:N.type,De=O.parse(ie,1+$.length,ge);if(!De){W=!0;break}$.push(De)}if(!W)if(Array.isArray(N)&&N.length!==$.length)O.error(`Expected ${N.length} arguments, but found ${$.length} instead.`);else{for(let Q=0;Q<$.length;Q++){const ie=Array.isArray(N)?N[Q]:N.type,ge=$[Q];O.concat(Q+1).checkSubtype(ie,ge.type)}if(0===O.errors.length)return new cc(f,b,j,$)}}if(1===A.length)u.errors.push(...O.errors);else{const N=(A.length?A:I).map(([$])=>{return W=$,Array.isArray(W)?`(${W.map(ur).join(", ")})`:`(${ur(W.type)}...)`;var W}).join(" | "),j=[];for(let $=1;$<i.length;$++){const W=u.parse(i[$],1+j.length);if(!W)return null;j.push(ur(W.type))}u.error(`Expected arguments of type ${N}, but found (${j.join(", ")}) instead.`)}return null}static register(i,u){cc.definitions=u;for(const f in u)i[f]=cc}}var Zo=cc;class Xc{constructor(i,u,f){this.type=yo,this.locale=f,this.caseSensitive=i,this.diacriticSensitive=u}static parse(i,u){if(2!==i.length)return u.error("Expected one argument.");const f=i[1];if("object"!=typeof f||Array.isArray(f))return u.error("Collator options argument must be an object.");const m=u.parse(void 0!==f["case-sensitive"]&&f["case-sensitive"],1,zr);if(!m)return null;const b=u.parse(void 0!==f["diacritic-sensitive"]&&f["diacritic-sensitive"],1,zr);if(!b)return null;let I=null;return f.locale&&(I=u.parse(f.locale,1,Zr),!I)?null:new Xc(m,b,I)}evaluate(i){return new is(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const Ju=8192;function ca(s,i){s[0]=Math.min(s[0],i[0]),s[1]=Math.min(s[1],i[1]),s[2]=Math.max(s[2],i[0]),s[3]=Math.max(s[3],i[1])}function ka(s,i){return!(s[0]<=i[0]||s[2]>=i[2]||s[1]<=i[1]||s[3]>=i[3])}function Qi(s,i){const u=(180+s[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,m=Math.pow(2,i.z);return[Math.round(u*m*Ju),Math.round(f*m*Ju)]}function hc(s,i,u){const f=s[0]-i[0],m=s[1]-i[1],b=s[0]-u[0],I=s[1]-u[1];return f*I-b*m==0&&f*b<=0&&m*I<=0}function Ru(s,i){let u=!1;for(let I=0,A=i.length;I<A;I++){const O=i[I];for(let N=0,j=O.length;N<j-1;N++){if(hc(s,O[N],O[N+1]))return!1;(m=O[N])[1]>(f=s)[1]!=(b=O[N+1])[1]>f[1]&&f[0]<(b[0]-m[0])*(f[1]-m[1])/(b[1]-m[1])+m[0]&&(u=!u)}}var f,m,b;return u}function Rr(s,i){for(let u=0;u<i.length;u++)if(Ru(s,i[u]))return!0;return!1}function Yo(s,i,u,f){const m=f[0]-u[0],b=f[1]-u[1],I=(s[0]-u[0])*b-m*(s[1]-u[1]),A=(i[0]-u[0])*b-m*(i[1]-u[1]);return I>0&&A<0||I<0&&A>0}function hr(s,i,u){for(const N of u)for(let j=0;j<N.length-1;++j)if((A=[(I=N[j+1])[0]-(b=N[j])[0],I[1]-b[1]])[0]*(O=[(m=i)[0]-(f=s)[0],m[1]-f[1]])[1]-A[1]*O[0]!=0&&Yo(f,m,b,I)&&Yo(b,I,f,m))return!0;var f,m,b,I,A,O;return!1}function ii(s,i){for(let u=0;u<s.length;++u)if(!Ru(s[u],i))return!1;for(let u=0;u<s.length-1;++u)if(hr(s[u],s[u+1],i))return!1;return!0}function Ja(s,i){for(let u=0;u<i.length;u++)if(ii(s,i[u]))return!0;return!1}function uu(s,i,u){const f=[];for(let m=0;m<s.length;m++){const b=[];for(let I=0;I<s[m].length;I++){const A=Qi(s[m][I],u);ca(i,A),b.push(A)}f.push(b)}return f}function oi(s,i,u){const f=[];for(let m=0;m<s.length;m++){const b=uu(s[m],i,u);f.push(b)}return f}function Lc(s,i,u,f){if(s[0]<u[0]||s[0]>u[2]){const m=.5*f;let b=s[0]-u[0]>m?-f:u[0]-s[0]>m?f:0;0===b&&(b=s[0]-u[2]>m?-f:u[2]-s[0]>m?f:0),s[0]+=b}ca(i,s)}function Fh(s,i,u,f){const m=Math.pow(2,f.z)*Ju,b=[f.x*Ju,f.y*Ju],I=[];if(!s)return I;for(const A of s)for(const O of A){const N=[O.x+b[0],O.y+b[1]];Lc(N,i,u,m),I.push(N)}return I}function $l(s,i,u,f){const m=Math.pow(2,f.z)*Ju,b=[f.x*Ju,f.y*Ju],I=[];if(!s)return I;for(const O of s){const N=[];for(const j of O){const $=[j.x+b[0],j.y+b[1]];ca(i,$),N.push($)}I.push(N)}if(i[2]-i[0]<=m/2){(A=i)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const O of I)for(const N of O)Lc(N,i,u,m)}var A;return I}class Qu{constructor(i,u){this.type=zr,this.geojson=i,this.geometries=u}static parse(i,u){if(2!==i.length)return u.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(ua(i[1])){const f=i[1];if("FeatureCollection"===f.type)for(let m=0;m<f.features.length;++m){const b=f.features[m].geometry.type;if("Polygon"===b||"MultiPolygon"===b)return new Qu(f,f.features[m].geometry)}else if("Feature"===f.type){const m=f.geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new Qu(f,f.geometry)}else if("Polygon"===f.type||"MultiPolygon"===f.type)return new Qu(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(u,f){const m=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],I=u.canonicalID();if(!I)return!1;if("Polygon"===f.type){const A=uu(f.coordinates,b,I),O=Fh(u.geometry(),m,b,I);if(!ka(m,b))return!1;for(const N of O)if(!Ru(N,A))return!1}if("MultiPolygon"===f.type){const A=oi(f.coordinates,b,I),O=Fh(u.geometry(),m,b,I);if(!ka(m,b))return!1;for(const N of O)if(!Rr(N,A))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(u,f){const m=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],I=u.canonicalID();if(!I)return!1;if("Polygon"===f.type){const A=uu(f.coordinates,b,I),O=$l(u.geometry(),m,b,I);if(!ka(m,b))return!1;for(const N of O)if(!ii(N,A))return!1}if("MultiPolygon"===f.type){const A=oi(f.coordinates,b,I),O=$l(u.geometry(),m,b,I);if(!ka(m,b))return!1;for(const N of O)if(!Ja(N,A))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Si=Qu;function Ni(s){if(s instanceof Zo&&("get"===s.name&&1===s.args.length||"feature-state"===s.name||"has"===s.name&&1===s.args.length||"properties"===s.name||"geometry-type"===s.name||"id"===s.name||/^filter-/.test(s.name))||s instanceof Si)return!1;let i=!0;return s.eachChild(u=>{i&&!Ni(u)&&(i=!1)}),i}function ki(s){if(s instanceof Zo&&"feature-state"===s.name)return!1;let i=!0;return s.eachChild(u=>{i&&!ki(u)&&(i=!1)}),i}function ml(s,i){if(s instanceof Zo&&i.indexOf(s.name)>=0)return!1;let u=!0;return s.eachChild(f=>{u&&!ml(f,i)&&(u=!1)}),u}class Qa{constructor(i,u){this.type=u.type,this.name=i,this.boundExpression=u}static parse(i,u){if(2!==i.length||"string"!=typeof i[1])return u.error("'var' expression requires exactly one string literal argument.");const f=i[1];return u.scope.has(f)?new Qa(f,u.scope.get(f)):u.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Bh=Qa;class ei{constructor(i,u=[],f,m=new Qr,b=[]){this.registry=i,this.path=u,this.key=u.map(I=>`[${I}]`).join(""),this.scope=m,this.errors=b,this.expectedType=f}parse(i,u,f,m,b={}){return u?this.concat(u,f,m)._parse(i,b):this._parse(i,b)}_parse(i,u){function f(m,b,I){return"assert"===I?new Hr(b,[m]):"coerce"===I?new sr(b,[m]):m}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=i[0];if("string"!=typeof m)return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[m];if(b){let I=b.parse(i,this);if(!I)return null;if(this.expectedType){const A=this.expectedType,O=I.type;if("string"!==A.kind&&"number"!==A.kind&&"boolean"!==A.kind&&"object"!==A.kind&&"array"!==A.kind||"value"!==O.kind)if("color"!==A.kind&&"formatted"!==A.kind&&"resolvedImage"!==A.kind||"value"!==O.kind&&"string"!==O.kind){if(this.checkSubtype(A,O))return null}else I=f(I,A,u.typeAnnotation||"coerce");else I=f(I,A,u.typeAnnotation||"assert")}if(!(I instanceof la)&&"resolvedImage"!==I.type.kind&&$i(I)){const A=new Ku;try{I=new la(I.type,I.evaluate(A))}catch(O){return this.error(O.message),null}}return I}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,u,f){const m="number"==typeof i?this.path.concat(i):this.path,b=f?this.scope.concat(f):this.scope;return new ei(this.registry,m,u||null,b,this.errors)}error(i,...u){const f=`${this.key}${u.map(m=>`[${m}]`).join("")}`;this.errors.push(new bs(f,i))}checkSubtype(i,u){const f=Tn(i,u);return f&&this.error(f),f}}var Oc=ei;function $i(s){if(s instanceof Bh)return $i(s.boundExpression);if(s instanceof Zo&&"error"===s.name||s instanceof Xc||s instanceof Si)return!1;const i=s instanceof sr||s instanceof Hr;let u=!0;return s.eachChild(f=>{u=i?u&&$i(f):u&&f instanceof la}),!!u&&Ni(s)&&ml(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Nc(s,i){const u=s.length-1;let f,m,b=0,I=u,A=0;for(;b<=I;)if(A=Math.floor((b+I)/2),f=s[A],m=s[A+1],f<=i){if(A===u||i<m)return A;b=A+1}else{if(!(f>i))throw new va("Input is not a number.");I=A-1}return 0}class fr{constructor(i,u,f){this.type=i,this.input=u,this.labels=[],this.outputs=[];for(const[m,b]of f)this.labels.push(m),this.outputs.push(b)}static parse(i,u){if(i.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return u.error("Expected an even number of arguments.");const f=u.parse(i[1],1,pn);if(!f)return null;const m=[];let b=null;u.expectedType&&"value"!==u.expectedType.kind&&(b=u.expectedType);for(let I=1;I<i.length;I+=2){const A=1===I?-1/0:i[I],O=i[I+1],N=I,j=I+1;if("number"!=typeof A)return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(m.length&&m[m.length-1][0]>=A)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',N);const $=u.parse(O,j,b);if(!$)return null;b=b||$.type,m.push([A,$])}return new fr(b,f,m)}evaluate(i){const u=this.labels,f=this.outputs;if(1===u.length)return f[0].evaluate(i);const m=this.input.evaluate(i);if(m<=u[0])return f[0].evaluate(i);const b=u.length;return m>=u[b-1]?f[b-1].evaluate(i):f[Nc(u,m)].evaluate(i)}eachChild(i){i(this.input);for(const u of this.outputs)i(u)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let u=0;u<this.labels.length;u++)u>0&&i.push(this.labels[u]),i.push(this.outputs[u].serialize());return i}}var Lu=fr;function qn(s,i,u){return s*(1-u)+i*u}var xu=Object.freeze({__proto__:null,array:function(s,i,u){return s.map((f,m)=>qn(f,i[m],u))},color:function(s,i,u){return new zs(qn(s.r,i.r,u),qn(s.g,i.g,u),qn(s.b,i.b,u),qn(s.a,i.a,u))},number:qn});const kc=4/29,eu=6/29,lu=3*eu*eu,ss=eu*eu*eu,Tl=Math.PI/180,el=180/Math.PI;function Ta(s){return s>ss?Math.pow(s,1/3):s/lu+kc}function Lr(s){return s>eu?s*s*s:lu*(s-kc)}function Ou(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Ws(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function wu(s){const i=Ws(s.r),u=Ws(s.g),f=Ws(s.b),m=Ta((.4124564*i+.3575761*u+.1804375*f)/.95047),b=Ta((.2126729*i+.7151522*u+.072175*f)/1);return{l:116*b-16,a:500*(m-b),b:200*(b-Ta((.0193339*i+.119192*u+.9503041*f)/1.08883)),alpha:s.a}}function tl(s){let i=(s.l+16)/116,u=isNaN(s.a)?i:i+s.a/500,f=isNaN(s.b)?i:i-s.b/200;return i=1*Lr(i),u=.95047*Lr(u),f=1.08883*Lr(f),new zs(Ou(3.2404542*u-1.5371385*i-.4985314*f),Ou(-.969266*u+1.8760108*i+.041556*f),Ou(.0556434*u-.2040259*i+1.0572252*f),s.alpha)}function bu(s,i,u){const f=i-s;return s+u*(f>180||f<-180?f-360*Math.round(f/360):f)}const tu={forward:wu,reverse:tl,interpolate:function(s,i,u){return{l:qn(s.l,i.l,u),a:qn(s.a,i.a,u),b:qn(s.b,i.b,u),alpha:qn(s.alpha,i.alpha,u)}}},Ps={forward:function(s){const{l:i,a:u,b:f}=wu(s),m=Math.atan2(f,u)*el;return{h:m<0?m+360:m,c:Math.sqrt(u*u+f*f),l:i,alpha:s.a}},reverse:function(s){const i=s.h*Tl,u=s.c;return tl({l:s.l,a:Math.cos(i)*u,b:Math.sin(i)*u,alpha:s.alpha})},interpolate:function(s,i,u){return{h:bu(s.h,i.h,u),c:qn(s.c,i.c,u),l:qn(s.l,i.l,u),alpha:qn(s.alpha,i.alpha,u)}}};var lf=Object.freeze({__proto__:null,hcl:Ps,lab:tu});class fc{constructor(i,u,f,m,b){this.type=i,this.operator=u,this.interpolation=f,this.input=m,this.labels=[],this.outputs=[];for(const[I,A]of b)this.labels.push(I),this.outputs.push(A)}static interpolationFactor(i,u,f,m){let b=0;if("exponential"===i.name)b=Rs(u,i.base,f,m);else if("linear"===i.name)b=Rs(u,1,f,m);else if("cubic-bezier"===i.name){const I=i.controlPoints;b=new ee(I[0],I[1],I[2],I[3]).solve(Rs(u,1,f,m))}return b}static parse(i,u){let[f,m,b,...I]=i;if(!Array.isArray(m)||0===m.length)return u.error("Expected an interpolation type expression.",1);if("linear"===m[0])m={name:"linear"};else if("exponential"===m[0]){const N=m[1];if("number"!=typeof N)return u.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:N}}else{if("cubic-bezier"!==m[0])return u.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const N=m.slice(1);if(4!==N.length||N.some(j=>"number"!=typeof j||j<0||j>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:N}}}if(i.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(b=u.parse(b,2,pn),!b)return null;const A=[];let O=null;"interpolate-hcl"===f||"interpolate-lab"===f?O=Ya:u.expectedType&&"value"!==u.expectedType.kind&&(O=u.expectedType);for(let N=0;N<I.length;N+=2){const j=I[N],$=I[N+1],W=N+3,Q=N+4;if("number"!=typeof j)return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',W);if(A.length&&A[A.length-1][0]>=j)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',W);const ie=u.parse($,Q,O);if(!ie)return null;O=O||ie.type,A.push([j,ie])}return"number"===O.kind||"color"===O.kind||"array"===O.kind&&"number"===O.itemType.kind&&"number"==typeof O.N?new fc(O,f,m,b,A):u.error(`Type ${ur(O)} is not interpolatable.`)}evaluate(i){const u=this.labels,f=this.outputs;if(1===u.length)return f[0].evaluate(i);const m=this.input.evaluate(i);if(m<=u[0])return f[0].evaluate(i);const b=u.length;if(m>=u[b-1])return f[b-1].evaluate(i);const I=Nc(u,m),A=fc.interpolationFactor(this.interpolation,m,u[I],u[I+1]),O=f[I].evaluate(i),N=f[I+1].evaluate(i);return"interpolate"===this.operator?xu[this.type.kind.toLowerCase()](O,N,A):"interpolate-hcl"===this.operator?Ps.reverse(Ps.interpolate(Ps.forward(O),Ps.forward(N),A)):tu.reverse(tu.interpolate(tu.forward(O),tu.forward(N),A))}eachChild(i){i(this.input);for(const u of this.outputs)i(u)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const u=[this.operator,i,this.input.serialize()];for(let f=0;f<this.labels.length;f++)u.push(this.labels[f],this.outputs[f].serialize());return u}}function Rs(s,i,u,f){const m=f-u,b=s-u;return 0===m?0:1===i?b/m:(Math.pow(i,b)-1)/(Math.pow(i,m)-1)}var Fa=fc;class Ba{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expectected at least one argument.");let f=null;const m=u.expectedType;m&&"value"!==m.kind&&(f=m);const b=[];for(const A of i.slice(1)){const O=u.parse(A,1+b.length,f,void 0,{typeAnnotation:"omit"});if(!O)return null;f=f||O.type,b.push(O)}const I=m&&b.some(A=>Tn(m,A.type));return new Ba(I?di:f,b)}evaluate(i){let u,f=null,m=0;for(const b of this.args){if(m++,f=b.evaluate(i),f&&f instanceof Ti&&!f.available&&(u||(u=f),f=null,m===this.args.length))return u;if(null!==f)break}return f}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(u=>{i.push(u.serialize())}),i}}var fh=Ba;class fa{constructor(i,u){this.type=u.type,this.bindings=[].concat(i),this.result=u}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const u of this.bindings)i(u[1]);i(this.result)}static parse(i,u){if(i.length<4)return u.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const f=[];for(let b=1;b<i.length-1;b+=2){const I=i[b];if("string"!=typeof I)return u.error(`Expected string, but found ${typeof I} instead.`,b);if(/[^a-zA-Z0-9_]/.test(I))return u.error("Variable names must contain only alphanumeric characters or '_'.",b);const A=u.parse(i[b+1],b+1);if(!A)return null;f.push([I,A])}const m=u.parse(i[i.length-1],i.length-1,u.expectedType,f);return m?new fa(f,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[u,f]of this.bindings)i.push(u,f.serialize());return i.push(this.result.serialize()),i}}var dc=fa;class ql{constructor(i,u,f){this.type=i,this.index=u,this.input=f}static parse(i,u){if(3!==i.length)return u.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=u.parse(i[1],1,pn),m=u.parse(i[2],2,Qs(u.expectedType||di));return f&&m?new ql(m.type.itemType,f,m):null}evaluate(i){const u=this.index.evaluate(i),f=this.input.evaluate(i);if(u<0)throw new va(`Array index out of bounds: ${u} < 0.`);if(u>=f.length)throw new va(`Array index out of bounds: ${u} > ${f.length-1}.`);if(u!==Math.floor(u))throw new va(`Array index must be an integer, but found ${u} instead.`);return f[u]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var zh=ql;class Of{constructor(i,u){this.type=zr,this.needle=i,this.haystack=u}static parse(i,u){if(3!==i.length)return u.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=u.parse(i[1],1,di),m=u.parse(i[2],2,di);return f&&m?Il(f.type,[zr,Zr,pn,Pc,di])?new Of(f,m):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${ur(f.type)} instead`):null}evaluate(i){const u=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(null==f)return!1;if(!Ka(u,["boolean","string","number","null"]))throw new va(`Expected first argument to be of type boolean, string, number or null, but found ${ur(As(u))} instead.`);if(!Ka(f,["string","array"]))throw new va(`Expected second argument to be of type array or string, but found ${ur(As(f))} instead.`);return f.indexOf(u)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Nu=Of;class Eu{constructor(i,u,f){this.type=pn,this.needle=i,this.haystack=u,this.fromIndex=f}static parse(i,u){if(i.length<=2||i.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=u.parse(i[1],1,di),m=u.parse(i[2],2,di);if(!f||!m)return null;if(!Il(f.type,[zr,Zr,pn,Pc,di]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${ur(f.type)} instead`);if(4===i.length){const b=u.parse(i[3],3,pn);return b?new Eu(f,m,b):null}return new Eu(f,m)}evaluate(i){const u=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!Ka(u,["boolean","string","number","null"]))throw new va(`Expected first argument to be of type boolean, string, number or null, but found ${ur(As(u))} instead.`);if(!Ka(f,["string","array"]))throw new va(`Expected second argument to be of type array or string, but found ${ur(As(f))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(i);return f.indexOf(u,m)}return f.indexOf(u)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var ea=Eu;class ta{constructor(i,u,f,m,b,I){this.inputType=i,this.type=u,this.input=f,this.cases=m,this.outputs=b,this.otherwise=I}static parse(i,u){if(i.length<5)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return u.error("Expected an even number of arguments.");let f,m;u.expectedType&&"value"!==u.expectedType.kind&&(m=u.expectedType);const b={},I=[];for(let N=2;N<i.length-1;N+=2){let j=i[N];const $=i[N+1];Array.isArray(j)||(j=[j]);const W=u.concat(N);if(0===j.length)return W.error("Expected at least one branch label.");for(const ie of j){if("number"!=typeof ie&&"string"!=typeof ie)return W.error("Branch labels must be numbers or strings.");if("number"==typeof ie&&Math.abs(ie)>Number.MAX_SAFE_INTEGER)return W.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof ie&&Math.floor(ie)!==ie)return W.error("Numeric branch labels must be integer values.");if(f){if(W.checkSubtype(f,As(ie)))return null}else f=As(ie);if(void 0!==b[String(ie)])return W.error("Branch labels must be unique.");b[String(ie)]=I.length}const Q=u.parse($,N,m);if(!Q)return null;m=m||Q.type,I.push(Q)}const A=u.parse(i[1],1,di);if(!A)return null;const O=u.parse(i[i.length-1],i.length-1,m);return O?"value"!==A.type.kind&&u.concat(1).checkSubtype(f,A.type)?null:new ta(f,m,A,b,I,O):null}evaluate(i){const u=this.input.evaluate(i);return(As(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],u=Object.keys(this.cases).sort(),f=[],m={};for(const I of u){const A=m[this.cases[I]];void 0===A?(m[this.cases[I]]=f.length,f.push([this.cases[I],[I]])):f[A][1].push(I)}const b=I=>"number"===this.inputType.kind?Number(I):I;for(const[I,A]of f)i.push(1===A.length?b(A[0]):A.map(b)),i.push(this.outputs[I].serialize());return i.push(this.otherwise.serialize()),i}}var Uh=ta;class Ma{constructor(i,u,f){this.type=i,this.branches=u,this.otherwise=f}static parse(i,u){if(i.length<4)return u.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return u.error("Expected an odd number of arguments.");let f;u.expectedType&&"value"!==u.expectedType.kind&&(f=u.expectedType);const m=[];for(let I=1;I<i.length-1;I+=2){const A=u.parse(i[I],I,zr);if(!A)return null;const O=u.parse(i[I+1],I+1,f);if(!O)return null;m.push([A,O]),f=f||O.type}const b=u.parse(i[i.length-1],i.length-1,f);return b?new Ma(f,m,b):null}evaluate(i){for(const[u,f]of this.branches)if(u.evaluate(i))return f.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[u,f]of this.branches)i(u),i(f);i(this.otherwise)}outputDefined(){return this.branches.every(([i,u])=>u.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(u=>{i.push(u.serialize())}),i}}var Ml=Ma;class yl{constructor(i,u,f,m){this.type=i,this.input=u,this.beginIndex=f,this.endIndex=m}static parse(i,u){if(i.length<=2||i.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=u.parse(i[1],1,di),m=u.parse(i[2],2,pn);if(!f||!m)return null;if(!Il(f.type,[Qs(di),Zr,di]))return u.error(`Expected first argument to be of type array or string, but found ${ur(f.type)} instead`);if(4===i.length){const b=u.parse(i[3],3,pn);return b?new yl(f.type,f,m,b):null}return new yl(f.type,f,m)}evaluate(i){const u=this.input.evaluate(i),f=this.beginIndex.evaluate(i);if(!Ka(u,["string","array"]))throw new va(`Expected first argument to be of type array or string, but found ${ur(As(u))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(i);return u.slice(f,m)}return u.slice(f)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Nf=yl;function _l(s,i){return"=="===s||"!="===s?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function Lt(s,i,u,f){return 0===f.compare(i,u)}function un(s,i,u){const f="=="!==s&&"!="!==s;return class IR{constructor(b,I,A){this.type=zr,this.lhs=b,this.rhs=I,this.collator=A,this.hasUntypedArgument="value"===b.type.kind||"value"===I.type.kind}static parse(b,I){if(3!==b.length&&4!==b.length)return I.error("Expected two or three arguments.");const A=b[0];let O=I.parse(b[1],1,di);if(!O)return null;if(!_l(A,O.type))return I.concat(1).error(`"${A}" comparisons are not supported for type '${ur(O.type)}'.`);let N=I.parse(b[2],2,di);if(!N)return null;if(!_l(A,N.type))return I.concat(2).error(`"${A}" comparisons are not supported for type '${ur(N.type)}'.`);if(O.type.kind!==N.type.kind&&"value"!==O.type.kind&&"value"!==N.type.kind)return I.error(`Cannot compare types '${ur(O.type)}' and '${ur(N.type)}'.`);f&&("value"===O.type.kind&&"value"!==N.type.kind?O=new Hr(N.type,[O]):"value"!==O.type.kind&&"value"===N.type.kind&&(N=new Hr(O.type,[N])));let j=null;if(4===b.length){if("string"!==O.type.kind&&"string"!==N.type.kind&&"value"!==O.type.kind&&"value"!==N.type.kind)return I.error("Cannot use collator to compare non-string types.");if(j=I.parse(b[3],3,yo),!j)return null}return new IR(O,N,j)}evaluate(b){const I=this.lhs.evaluate(b),A=this.rhs.evaluate(b);if(f&&this.hasUntypedArgument){const O=As(I),N=As(A);if(O.kind!==N.kind||"string"!==O.kind&&"number"!==O.kind)throw new va(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${O.kind}, ${N.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const O=As(I),N=As(A);if("string"!==O.kind||"string"!==N.kind)return i(b,I,A)}return this.collator?u(b,I,A,this.collator.evaluate(b)):i(b,I,A)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}serialize(){const b=[s];return this.eachChild(I=>{b.push(I.serialize())}),b}}}const Qt=un("==",function(s,i,u){return i===u},Lt),ir=un("!=",function(s,i,u){return i!==u},function(s,i,u,f){return!Lt(0,i,u,f)}),Tr=un("<",function(s,i,u){return i<u},function(s,i,u,f){return f.compare(i,u)<0}),qi=un(">",function(s,i,u){return i>u},function(s,i,u,f){return f.compare(i,u)>0}),Es=un("<=",function(s,i,u){return i<=u},function(s,i,u,f){return f.compare(i,u)<=0}),eo=un(">=",function(s,i,u){return i>=u},function(s,i,u,f){return f.compare(i,u)>=0});class Vi{constructor(i,u,f,m,b,I){this.type=Zr,this.number=i,this.locale=u,this.currency=f,this.unit=m,this.minFractionDigits=b,this.maxFractionDigits=I}static parse(i,u){if(3!==i.length)return u.error("Expected two arguments.");const f=u.parse(i[1],1,pn);if(!f)return null;const m=i[2];if("object"!=typeof m||Array.isArray(m))return u.error("NumberFormat options argument must be an object.");let b=null;if(m.locale&&(b=u.parse(m.locale,1,Zr),!b))return null;let I=null;if(m.currency&&(I=u.parse(m.currency,1,Zr),!I))return null;let A=null;if(m.unit&&(A=u.parse(m.unit,1,Zr),!A))return null;let O=null;if(m["min-fraction-digits"]&&(O=u.parse(m["min-fraction-digits"],1,pn),!O))return null;let N=null;return m["max-fraction-digits"]&&(N=u.parse(m["max-fraction-digits"],1,pn),!N)?null:new Vi(f,b,I,A,O,N)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class Xi{constructor(i){this.type=pn,this.input=i}static parse(i,u){if(2!==i.length)return u.error(`Expected 1 argument, but found ${i.length-1} instead.`);const f=u.parse(i[1],1);return f?"array"!==f.type.kind&&"string"!==f.type.kind&&"value"!==f.type.kind?u.error(`Expected argument of type string or array, but found ${ur(f.type)} instead.`):new Xi(f):null}evaluate(i){const u=this.input.evaluate(i);if("string"==typeof u||Array.isArray(u))return u.length;throw new va(`Expected value to be of type string or array, but found ${ur(As(u))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(u=>{i.push(u.serialize())}),i}}const $r={"==":Qt,"!=":ir,">":qi,"<":Tr,">=":eo,"<=":Es,array:Hr,at:zh,boolean:Hr,case:Ml,coalesce:fh,collator:Xc,format:Mi,image:Vs,in:Nu,"index-of":ea,interpolate:Fa,"interpolate-hcl":Fa,"interpolate-lab":Fa,length:Xi,let:dc,literal:la,match:Uh,number:Hr,"number-format":Vi,object:Hr,slice:Nf,step:Lu,string:Hr,"to-boolean":sr,"to-color":sr,"to-number":sr,"to-string":sr,var:Bh,within:Si};function uo(s,[i,u,f,m]){i=i.evaluate(s),u=u.evaluate(s),f=f.evaluate(s);const b=m?m.evaluate(s):1,I=gl(i,u,f,b);if(I)throw new va(I);return new zs(i/255*b,u/255*b,f/255*b,b)}function Xs(s,i){return s in i}function Da(s,i){const u=i[s];return void 0===u?null:u}function to(s){return{type:s}}Zo.register($r,{error:[{kind:"error"},[Zr],(s,[i])=>{throw new va(i.evaluate(s))}],typeof:[Zr,[di],(s,[i])=>ur(As(i.evaluate(s)))],"to-rgba":[Qs(pn,4),[Ya],(s,[i])=>i.evaluate(s).toArray()],rgb:[Ya,[pn,pn,pn],uo],rgba:[Ya,[pn,pn,pn,pn],uo],has:{type:zr,overloads:[[[Zr],(s,[i])=>Xs(i.evaluate(s),s.properties())],[[Zr,er],(s,[i,u])=>Xs(i.evaluate(s),u.evaluate(s))]]},get:{type:di,overloads:[[[Zr],(s,[i])=>Da(i.evaluate(s),s.properties())],[[Zr,er],(s,[i,u])=>Da(i.evaluate(s),u.evaluate(s))]]},"feature-state":[di,[Zr],(s,[i])=>Da(i.evaluate(s),s.featureState||{})],properties:[er,[],s=>s.properties()],"geometry-type":[Zr,[],s=>s.geometryType()],id:[di,[],s=>s.id()],zoom:[pn,[],s=>s.globals.zoom],pitch:[pn,[],s=>s.globals.pitch||0],"distance-from-center":[pn,[],s=>s.distanceFromCenter()],"heatmap-density":[pn,[],s=>s.globals.heatmapDensity||0],"line-progress":[pn,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[pn,[],s=>s.globals.skyRadialProgress||0],accumulated:[di,[],s=>void 0===s.globals.accumulated?null:s.globals.accumulated],"+":[pn,to(pn),(s,i)=>{let u=0;for(const f of i)u+=f.evaluate(s);return u}],"*":[pn,to(pn),(s,i)=>{let u=1;for(const f of i)u*=f.evaluate(s);return u}],"-":{type:pn,overloads:[[[pn,pn],(s,[i,u])=>i.evaluate(s)-u.evaluate(s)],[[pn],(s,[i])=>-i.evaluate(s)]]},"/":[pn,[pn,pn],(s,[i,u])=>i.evaluate(s)/u.evaluate(s)],"%":[pn,[pn,pn],(s,[i,u])=>i.evaluate(s)%u.evaluate(s)],ln2:[pn,[],()=>Math.LN2],pi:[pn,[],()=>Math.PI],e:[pn,[],()=>Math.E],"^":[pn,[pn,pn],(s,[i,u])=>Math.pow(i.evaluate(s),u.evaluate(s))],sqrt:[pn,[pn],(s,[i])=>Math.sqrt(i.evaluate(s))],log10:[pn,[pn],(s,[i])=>Math.log(i.evaluate(s))/Math.LN10],ln:[pn,[pn],(s,[i])=>Math.log(i.evaluate(s))],log2:[pn,[pn],(s,[i])=>Math.log(i.evaluate(s))/Math.LN2],sin:[pn,[pn],(s,[i])=>Math.sin(i.evaluate(s))],cos:[pn,[pn],(s,[i])=>Math.cos(i.evaluate(s))],tan:[pn,[pn],(s,[i])=>Math.tan(i.evaluate(s))],asin:[pn,[pn],(s,[i])=>Math.asin(i.evaluate(s))],acos:[pn,[pn],(s,[i])=>Math.acos(i.evaluate(s))],atan:[pn,[pn],(s,[i])=>Math.atan(i.evaluate(s))],min:[pn,to(pn),(s,i)=>Math.min(...i.map(u=>u.evaluate(s)))],max:[pn,to(pn),(s,i)=>Math.max(...i.map(u=>u.evaluate(s)))],abs:[pn,[pn],(s,[i])=>Math.abs(i.evaluate(s))],round:[pn,[pn],(s,[i])=>{const u=i.evaluate(s);return u<0?-Math.round(-u):Math.round(u)}],floor:[pn,[pn],(s,[i])=>Math.floor(i.evaluate(s))],ceil:[pn,[pn],(s,[i])=>Math.ceil(i.evaluate(s))],"filter-==":[zr,[Zr,di],(s,[i,u])=>s.properties()[i.value]===u.value],"filter-id-==":[zr,[di],(s,[i])=>s.id()===i.value],"filter-type-==":[zr,[Zr],(s,[i])=>s.geometryType()===i.value],"filter-<":[zr,[Zr,di],(s,[i,u])=>{const f=s.properties()[i.value],m=u.value;return typeof f==typeof m&&f<m}],"filter-id-<":[zr,[di],(s,[i])=>{const u=s.id(),f=i.value;return typeof u==typeof f&&u<f}],"filter->":[zr,[Zr,di],(s,[i,u])=>{const f=s.properties()[i.value],m=u.value;return typeof f==typeof m&&f>m}],"filter-id->":[zr,[di],(s,[i])=>{const u=s.id(),f=i.value;return typeof u==typeof f&&u>f}],"filter-<=":[zr,[Zr,di],(s,[i,u])=>{const f=s.properties()[i.value],m=u.value;return typeof f==typeof m&&f<=m}],"filter-id-<=":[zr,[di],(s,[i])=>{const u=s.id(),f=i.value;return typeof u==typeof f&&u<=f}],"filter->=":[zr,[Zr,di],(s,[i,u])=>{const f=s.properties()[i.value],m=u.value;return typeof f==typeof m&&f>=m}],"filter-id->=":[zr,[di],(s,[i])=>{const u=s.id(),f=i.value;return typeof u==typeof f&&u>=f}],"filter-has":[zr,[di],(s,[i])=>i.value in s.properties()],"filter-has-id":[zr,[],s=>null!==s.id()&&void 0!==s.id()],"filter-type-in":[zr,[Qs(Zr)],(s,[i])=>i.value.indexOf(s.geometryType())>=0],"filter-id-in":[zr,[Qs(di)],(s,[i])=>i.value.indexOf(s.id())>=0],"filter-in-small":[zr,[Zr,Qs(di)],(s,[i,u])=>u.value.indexOf(s.properties()[i.value])>=0],"filter-in-large":[zr,[Zr,Qs(di)],(s,[i,u])=>function(f,m,b,I){for(;b<=I;){const A=b+I>>1;if(m[A]===f)return!0;m[A]>f?I=A-1:b=A+1}return!1}(s.properties()[i.value],u.value,0,u.value.length-1)],all:{type:zr,overloads:[[[zr,zr],(s,[i,u])=>i.evaluate(s)&&u.evaluate(s)],[to(zr),(s,i)=>{for(const u of i)if(!u.evaluate(s))return!1;return!0}]]},any:{type:zr,overloads:[[[zr,zr],(s,[i,u])=>i.evaluate(s)||u.evaluate(s)],[to(zr),(s,i)=>{for(const u of i)if(u.evaluate(s))return!0;return!1}]]},"!":[zr,[zr],(s,[i])=>!i.evaluate(s)],"is-supported-script":[zr,[Zr],(s,[i])=>{const u=s.globals&&s.globals.isSupportedScript;return!u||u(i.evaluate(s))}],upcase:[Zr,[Zr],(s,[i])=>i.evaluate(s).toUpperCase()],downcase:[Zr,[Zr],(s,[i])=>i.evaluate(s).toLowerCase()],concat:[Zr,to(di),(s,i)=>i.map(u=>Rc(u.evaluate(s))).join("")],"resolved-locale":[Zr,[yo],(s,[i])=>i.evaluate(s).resolvedLocale()]});var Zs=$r;function lo(s){return{result:"success",value:s}}function as(s){return{result:"error",value:s}}function Fc(s){return"data-driven"===s["property-type"]}function nu(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function Ri(s){return!!s.expression&&s.expression.interpolated}function bn(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":null===s?"null":typeof s}function qr(s){return"object"==typeof s&&null!==s&&!Array.isArray(s)}function co(s){return s}function _o(s,i){const u="color"===i.type,f=s.stops&&"object"==typeof s.stops[0][0],m=f||!(f||void 0!==s.property),b=s.type||(Ri(i)?"exponential":"interval");if(u&&((s=Wu({},s)).stops&&(s.stops=s.stops.map(N=>[N[0],zs.parse(N[1])])),s.default=zs.parse(s.default?s.default:i.default)),s.colorSpace&&"rgb"!==s.colorSpace&&!lf[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let I,A,O;if("exponential"===b)I=Ur;else if("interval"===b)I=da;else if("categorical"===b){I=io,A=Object.create(null);for(const N of s.stops)A[N[0]]=N[1];O=typeof s.stops[0][0]}else{if("identity"!==b)throw new Error(`Unknown function type "${b}"`);I=Bc}if(f){const N={},j=[];for(let Q=0;Q<s.stops.length;Q++){const ie=s.stops[Q],ge=ie[0].zoom;void 0===N[ge]&&(N[ge]={zoom:ge,type:s.type,property:s.property,default:s.default,stops:[]},j.push(ge)),N[ge].stops.push([ie[0].value,ie[1]])}const $=[];for(const Q of j)$.push([N[Q].zoom,_o(N[Q],i)]);const W={name:"linear"};return{kind:"composite",interpolationType:W,interpolationFactor:Fa.interpolationFactor.bind(void 0,W),zoomStops:$.map(Q=>Q[0]),evaluate:({zoom:Q},ie)=>Ur({stops:$,base:s.base},i,Q).evaluate(Q,ie)}}if(m){const N="exponential"===b?{name:"exponential",base:void 0!==s.base?s.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:Fa.interpolationFactor.bind(void 0,N),zoomStops:s.stops.map(j=>j[0]),evaluate:({zoom:j})=>I(s,i,j,A,O)}}return{kind:"source",evaluate(N,j){const $=j&&j.properties?j.properties[s.property]:void 0;return void 0===$?xa(s.default,i.default):I(s,i,$,A,O)}}}function xa(s,i,u){return void 0!==s?s:void 0!==i?i:void 0!==u?u:void 0}function io(s,i,u,f,m){return xa(typeof u===m?f[u]:void 0,s.default,i.default)}function da(s,i,u){if("number"!==bn(u))return xa(s.default,i.default);const f=s.stops.length;if(1===f||u<=s.stops[0][0])return s.stops[0][1];if(u>=s.stops[f-1][0])return s.stops[f-1][1];const m=Nc(s.stops.map(b=>b[0]),u);return s.stops[m][1]}function Ur(s,i,u){const f=void 0!==s.base?s.base:1;if("number"!==bn(u))return xa(s.default,i.default);const m=s.stops.length;if(1===m||u<=s.stops[0][0])return s.stops[0][1];if(u>=s.stops[m-1][0])return s.stops[m-1][1];const b=Nc(s.stops.map(j=>j[0]),u),I=function(j,$,W,Q){const ie=Q-W,ge=j-W;return 0===ie?0:1===$?ge/ie:(Math.pow($,ge)-1)/(Math.pow($,ie)-1)}(u,f,s.stops[b][0],s.stops[b+1][0]),A=s.stops[b][1],O=s.stops[b+1][1];let N=xu[i.type]||co;if(s.colorSpace&&"rgb"!==s.colorSpace){const j=lf[s.colorSpace];N=($,W)=>j.reverse(j.interpolate(j.forward($),j.forward(W),I))}return"function"==typeof A.evaluate?{evaluate(...j){const $=A.evaluate.apply(void 0,j),W=O.evaluate.apply(void 0,j);if(void 0!==$&&void 0!==W)return N($,W,I)}}:N(A,O,I)}function Bc(s,i,u){return"color"===i.type?u=zs.parse(u):"formatted"===i.type?u=Us.fromString(u.toString()):"resolvedImage"===i.type?u=Ti.fromString(u.toString()):bn(u)===i.type||"enum"===i.type&&i.values[u]||(u=void 0),xa(u,s.default,i.default)}class nl{constructor(i,u){var f;this.expression=i,this._warningHistory={},this._evaluator=new Ku,this._defaultValue=u?"color"===(f=u).type&&(qr(f.default)||Array.isArray(f.default))?new zs(0,0,0,0):"color"===f.type?zs.parse(f.default)||null:void 0===f.default?null:f.default:null,this._enumValues=u&&"enum"===u.type?u.values:null}evaluateWithoutErrorHandling(i,u,f,m,b,I,A,O){return this._evaluator.globals=i,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=m||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=I,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=O||null,this.expression.evaluate(this._evaluator)}evaluate(i,u,f,m,b,I,A,O){this._evaluator.globals=i,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=I||null,this._evaluator.featureTileCoord=A||null,this._evaluator.featureDistanceData=O||null;try{const N=this.expression.evaluate(this._evaluator);if(null==N||"number"==typeof N&&N!=N)return this._defaultValue;if(this._enumValues&&!(N in this._enumValues))throw new va(`Expected value to be one of ${Object.keys(this._enumValues).map(j=>JSON.stringify(j)).join(", ")}, but found ${JSON.stringify(N)} instead.`);return N}catch(N){return this._warningHistory[N.message]||(this._warningHistory[N.message]=!0,typeof console<"u"&&console.warn(N.message)),this._defaultValue}}}function pr(s){return Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0]in Zs}function pa(s,i){const u=new Oc(Zs,[],i?function(m){const b={color:Ya,string:Zr,number:pn,enum:Zr,boolean:zr,formatted:Gl,resolvedImage:Ia};return"array"===m.type?Qs(b[m.value]||di,m.length):b[m.type]}(i):void 0),f=u.parse(s,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return f?lo(new nl(f,i)):as(u.errors)}class Dl{constructor(i,u){this.kind=i,this._styleExpression=u,this.isStateDependent="constant"!==i&&!ki(u.expression)}evaluateWithoutErrorHandling(i,u,f,m,b,I){return this._styleExpression.evaluateWithoutErrorHandling(i,u,f,m,b,I)}evaluate(i,u,f,m,b,I){return this._styleExpression.evaluate(i,u,f,m,b,I)}}class za{constructor(i,u,f,m){this.kind=i,this.zoomStops=f,this._styleExpression=u,this.isStateDependent="camera"!==i&&!ki(u.expression),this.interpolationType=m}evaluateWithoutErrorHandling(i,u,f,m,b,I){return this._styleExpression.evaluateWithoutErrorHandling(i,u,f,m,b,I)}evaluate(i,u,f,m,b,I){return this._styleExpression.evaluate(i,u,f,m,b,I)}interpolationFactor(i,u,f){return this.interpolationType?Fa.interpolationFactor(this.interpolationType,i,u,f):0}}function vo(s,i){if("error"===(s=pa(s,i)).result)return s;const u=s.value.expression,f=Ni(u);if(!f&&!Fc(i))return as([new bs("","data expressions not supported")]);const m=ml(u,["zoom","pitch","distance-from-center"]);if(!m&&!nu(i))return as([new bs("","zoom expressions not supported")]);const b=Ls(u);return b||m?b instanceof bs?as([b]):b instanceof Fa&&!Ri(i)?as([new bs("",'"interpolate" expressions cannot be used with this property')]):lo(b?new za(f?"camera":"composite",s.value,b.labels,b instanceof Fa?b.interpolation:void 0):new Dl(f?"constant":"source",s.value)):as([new bs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class _s{constructor(i,u){this._parameters=i,this._specification=u,Wu(this,_o(this._parameters,this._specification))}static deserialize(i){return new _s(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Ls(s){let i=null;if(s instanceof dc)i=Ls(s.result);else if(s instanceof fh){for(const u of s.args)if(i=Ls(u),i)break}else(s instanceof Lu||s instanceof Fa)&&s.input instanceof Zo&&"zoom"===s.input.name&&(i=s);return i instanceof bs||s.eachChild(u=>{const f=Ls(u);f instanceof bs?i=f:!i&&f?i=new bs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&f&&i!==f&&(i=new bs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}class $n{constructor(i,u,f,m){this.message=(i?`${i}: `:"")+f,m&&(this.identifier=m),null!=u&&u.__line__&&(this.line=u.__line__)}}function ho(s){const i=s.key,u=s.value,f=s.valueSpec||{},m=s.objectElementValidators||{},b=s.style,I=s.styleSpec;let A=[];const O=bn(u);if("object"!==O)return[new $n(i,u,`object expected, ${O} found`)];for(const N in u){const j=N.split(".")[0];let $;m[j]?$=m[j]:f[j]?$=U:m["*"]?$=m["*"]:f["*"]&&($=U),$?A=A.concat($({key:(i&&`${i}.`)+N,value:u[N],valueSpec:f[j]||f["*"],style:b,styleSpec:I,object:u,objectKey:N},u)):A.push(new $n(i,u[N],`unknown property "${N}"`))}for(const N in f)m[N]||f[N].required&&void 0===f[N].default&&void 0===u[N]&&A.push(new $n(i,u,`missing required property "${N}"`));return A}function dh(s){const i=s.value,u=s.valueSpec,f=s.style,m=s.styleSpec,b=s.key,I=s.arrayElementValidator||U;if("array"!==bn(i))return[new $n(b,i,`array expected, ${bn(i)} found`)];if(u.length&&i.length!==u.length)return[new $n(b,i,`array length ${u.length} expected, length ${i.length} found`)];if(u["min-length"]&&i.length<u["min-length"])return[new $n(b,i,`array length at least ${u["min-length"]} expected, length ${i.length} found`)];let A={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};m.$version<7&&(A.function=u.function),"object"===bn(u.value)&&(A=u.value);let O=[];for(let N=0;N<i.length;N++)O=O.concat(I({array:i,arrayIndex:N,value:i[N],valueSpec:A,style:f,styleSpec:m,key:`${b}[${N}]`}));return O}function ku(s){const i=s.key,u=s.value,f=s.valueSpec;let m=bn(u);if("number"===m&&u!=u&&(m="NaN"),"number"!==m)return[new $n(i,u,`number expected, ${m} found`)];if("minimum"in f){let b=f.minimum;if("array"===bn(f.minimum)&&(b=f.minimum[s.arrayIndex]),u<b)return[new $n(i,u,`${u} is less than the minimum value ${b}`)]}if("maximum"in f){let b=f.maximum;if("array"===bn(f.maximum)&&(b=f.maximum[s.arrayIndex]),u>b)return[new $n(i,u,`${u} is greater than the maximum value ${b}`)]}return[]}function fo(s){const i=s.valueSpec,u=Ms(s.value.type);let f,m,b,I={};const A="categorical"!==u&&void 0===s.value.property,O=!A,N="array"===bn(s.value.stops)&&"array"===bn(s.value.stops[0])&&"object"===bn(s.value.stops[0][0]),j=ho({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(Q){if("identity"===u)return[new $n(Q.key,Q.value,'identity function may not have a "stops" property')];let ie=[];const ge=Q.value;return ie=ie.concat(dh({key:Q.key,value:ge,valueSpec:Q.valueSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:$})),"array"===bn(ge)&&0===ge.length&&ie.push(new $n(Q.key,ge,"array must have at least one stop")),ie},default:function(Q){return U({key:Q.key,value:Q.value,valueSpec:i,style:Q.style,styleSpec:Q.styleSpec})}}});return"identity"===u&&A&&j.push(new $n(s.key,s.value,'missing required property "property"')),"identity"===u||s.value.stops||j.push(new $n(s.key,s.value,'missing required property "stops"')),"exponential"===u&&s.valueSpec.expression&&!Ri(s.valueSpec)&&j.push(new $n(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(O&&!Fc(s.valueSpec)?j.push(new $n(s.key,s.value,"property functions not supported")):A&&!nu(s.valueSpec)&&j.push(new $n(s.key,s.value,"zoom functions not supported"))),"categorical"!==u&&!N||void 0!==s.value.property||j.push(new $n(s.key,s.value,'"property" property is required')),j;function $(Q){let ie=[];const ge=Q.value,De=Q.key;if("array"!==bn(ge))return[new $n(De,ge,`array expected, ${bn(ge)} found`)];if(2!==ge.length)return[new $n(De,ge,`array length 2 expected, length ${ge.length} found`)];if(N){if("object"!==bn(ge[0]))return[new $n(De,ge,`object expected, ${bn(ge[0])} found`)];if(void 0===ge[0].zoom)return[new $n(De,ge,"object stop key must have zoom")];if(void 0===ge[0].value)return[new $n(De,ge,"object stop key must have value")];const Ye=Ms(ge[0].zoom);if("number"!=typeof Ye)return[new $n(De,ge[0].zoom,"stop zoom values must be numbers")];if(b&&b>Ye)return[new $n(De,ge[0].zoom,"stop zoom values must appear in ascending order")];Ye!==b&&(b=Ye,m=void 0,I={}),ie=ie.concat(ho({key:`${De}[0]`,value:ge[0],valueSpec:{zoom:{}},style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:ku,value:W}}))}else ie=ie.concat(W({key:`${De}[0]`,value:ge[0],valueSpec:{},style:Q.style,styleSpec:Q.styleSpec},ge));return pr(aa(ge[1]))?ie.concat([new $n(`${De}[1]`,ge[1],"expressions are not allowed in function stops.")]):ie.concat(U({key:`${De}[1]`,value:ge[1],valueSpec:i,style:Q.style,styleSpec:Q.styleSpec}))}function W(Q,ie){const ge=bn(Q.value),De=Ms(Q.value),Ye=null!==Q.value?Q.value:ie;if(f){if(ge!==f)return[new $n(Q.key,Ye,`${ge} stop domain type must match previous stop domain type ${f}`)]}else f=ge;if("number"!==ge&&"string"!==ge&&"boolean"!==ge&&"number"!=typeof De&&"string"!=typeof De&&"boolean"!=typeof De)return[new $n(Q.key,Ye,"stop domain value must be a number, string, or boolean")];if("number"!==ge&&"categorical"!==u){let ht=`number expected, ${ge} found`;return Fc(i)&&void 0===u&&(ht+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $n(Q.key,Ye,ht)]}return"categorical"!==u||"number"!==ge||"number"==typeof De&&isFinite(De)&&Math.floor(De)===De?"categorical"!==u&&"number"===ge&&"number"==typeof De&&"number"==typeof m&&void 0!==m&&De<m?[new $n(Q.key,Ye,"stop domain values must appear in ascending order")]:(m=De,"categorical"===u&&De in I?[new $n(Q.key,Ye,"stop domain values must be unique")]:(I[De]=!0,[])):[new $n(Q.key,Ye,`integer expected, found ${String(De)}`)]}}function wa(s){const i=("property"===s.expressionContext?vo:pa)(aa(s.value),s.valueSpec);if("error"===i.result)return i.value.map(f=>new $n(`${s.key}${f.key}`,s.value,f.message));const u=i.value.expression||i.value._styleExpression.expression;if("property"===s.expressionContext&&"text-font"===s.propertyKey&&!u.outputDefined())return[new $n(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===s.expressionContext&&"layout"===s.propertyType&&!ki(u))return[new $n(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===s.expressionContext)return ru(u,s);if(s.expressionContext&&0===s.expressionContext.indexOf("cluster")){if(!ml(u,["zoom","feature-state"]))return[new $n(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===s.expressionContext&&!Ni(u))return[new $n(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ru(s,i){const u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const m of i.valueSpec.expression.parameters)u.delete(m);if(0===u.size)return[];const f=[];return s instanceof Zo&&u.has(s.name)?[new $n(i.key,i.value,`["${s.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(s.eachChild(m=>{f.push(...ru(m,i))}),f)}function Or(s){const i=s.key,u=s.value,f=s.valueSpec,m=[];return Array.isArray(f.values)?-1===f.values.indexOf(Ms(u))&&m.push(new $n(i,u,`expected one of [${f.values.join(", ")}], ${JSON.stringify(u)} found`)):-1===Object.keys(f.values).indexOf(Ms(u))&&m.push(new $n(i,u,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(u)} found`)),m}function ba(s){if(!0===s||!1===s)return!0;if(!Array.isArray(s)||0===s.length)return!1;switch(s[0]){case"has":return s.length>=2&&"$id"!==s[1]&&"$type"!==s[1];case"in":return s.length>=3&&("string"!=typeof s[1]||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==s.length||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const i of s.slice(1))if(!ba(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}function Vh(s,i="fill"){if(null==s)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ba(s)||(s=cu(s));const u=s;let f=!0;try{f=function(N){if(!rl(N))return N;let j=aa(N);return Ys(j),j=fd(j),j}(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(u,null,2)}\n        `)}const m=on[`filter_${i}`],b=pa(f,m);let I=null;if("error"===b.result)throw new Error(b.value.map(N=>`${N.key}: ${N.message}`).join(", "));I=(N,j,$)=>b.value.evaluate(N,j,{},$);let A=null,O=null;if(f!==u){const N=pa(u,m);if("error"===N.result)throw new Error(N.value.map(j=>`${j.key}: ${j.message}`).join(", "));A=(j,$,W,Q,ie)=>N.value.evaluate(j,$,{},W,void 0,void 0,Q,ie),O=!Ni(N.value.expression)}return{filter:I,dynamicFilter:A||void 0,needGeometry:js(f),needFeature:!!O}}function fd(s){if(!Array.isArray(s))return s;const i=function(u){if(Fu.has(u[0]))for(let f=1;f<u.length;f++)if(rl(u[f]))return!0;return u}(s);return!0===i?i:i.map(u=>fd(u))}function Ys(s){let i=!1;const u=[];if("case"===s[0]){for(let f=1;f<s.length-1;f+=2)i=i||rl(s[f]),u.push(s[f+1]);u.push(s[s.length-1])}else if("match"===s[0]){i=i||rl(s[1]);for(let f=2;f<s.length-1;f+=2)u.push(s[f+1]);u.push(s[s.length-1])}else if("step"===s[0]){i=i||rl(s[1]);for(let f=1;f<s.length-1;f+=2)u.push(s[f+1])}i&&(s.length=0,s.push("any",...u));for(let f=1;f<s.length;f++)Ys(s[f])}function rl(s){if(!Array.isArray(s))return!1;if("pitch"===(i=s[0])||"distance-from-center"===i)return!0;var i;for(let u=1;u<s.length;u++)if(rl(s[u]))return!0;return!1}const Fu=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Hl(s,i){return s<i?-1:s>i?1:0}function js(s){if(!Array.isArray(s))return!1;if("within"===s[0])return!0;for(let i=1;i<s.length;i++)if(js(s[i]))return!0;return!1}function cu(s){if(!s)return!0;const i=s[0];return s.length<=1?"any"!==i:"=="===i?na(s[1],s[2],"=="):"!="===i?xr(na(s[1],s[2],"==")):"<"===i||">"===i||"<="===i||">="===i?na(s[1],s[2],i):"any"===i?(u=s.slice(1),["any"].concat(u.map(cu))):"all"===i?["all"].concat(s.slice(1).map(cu)):"none"===i?["all"].concat(s.slice(1).map(cu).map(xr)):"in"===i?Gs(s[1],s.slice(2)):"!in"===i?xr(Gs(s[1],s.slice(2))):"has"===i?Bu(s[1]):"!has"===i?xr(Bu(s[1])):"within"!==i||s;var u}function na(s,i,u){switch(s){case"$type":return[`filter-type-${u}`,i];case"$id":return[`filter-id-${u}`,i];default:return[`filter-${u}`,s,i]}}function Gs(s,i){if(0===i.length)return!1;switch(s){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(u=>typeof u!=typeof i[0])?["filter-in-large",s,["literal",i.sort(Hl)]]:["filter-in-small",s,["literal",i]]}}function Bu(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function xr(s){return["!",s]}function Cu(s){return ba(aa(s.value))?wa(Wu({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):Aa(s)}function Aa(s){const i=s.value,u=s.key;if("array"!==bn(i))return[new $n(u,i,`array expected, ${bn(i)} found`)];const f=s.styleSpec;let m,b=[];if(i.length<1)return[new $n(u,i,"filter array must have at least 1 element")];switch(b=b.concat(Or({key:`${u}[0]`,value:i[0],valueSpec:f.filter_operator,style:s.style,styleSpec:s.styleSpec})),Ms(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===Ms(i[1])&&b.push(new $n(u,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&b.push(new $n(u,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(m=bn(i[1]),"string"!==m&&b.push(new $n(`${u}[1]`,i[1],`string expected, ${m} found`)));for(let I=2;I<i.length;I++)m=bn(i[I]),"$type"===Ms(i[1])?b=b.concat(Or({key:`${u}[${I}]`,value:i[I],valueSpec:f.geometry_type,style:s.style,styleSpec:s.styleSpec})):"string"!==m&&"number"!==m&&"boolean"!==m&&b.push(new $n(`${u}[${I}]`,i[I],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let I=1;I<i.length;I++)b=b.concat(Aa({key:`${u}[${I}]`,value:i[I],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":m=bn(i[1]),2!==i.length?b.push(new $n(u,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==m&&b.push(new $n(`${u}[1]`,i[1],`string expected, ${m} found`));break;case"within":m=bn(i[1]),2!==i.length?b.push(new $n(u,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==m&&b.push(new $n(`${u}[1]`,i[1],`object expected, ${m} found`))}return b}function Al(s,i){const u=s.key,f=s.style,m=s.styleSpec,b=s.value,I=s.objectKey,A=m[`${i}_${s.layerType}`];if(!A)return[];const O=I.match(/^(.*)-transition$/);if("paint"===i&&O&&A[O[1]]&&A[O[1]].transition)return U({key:u,value:b,valueSpec:m.transition,style:f,styleSpec:m});const N=s.valueSpec||A[I];if(!N)return[new $n(u,b,`unknown property "${I}"`)];let j;if("string"===bn(b)&&Fc(N)&&!N.tokens&&(j=/^{([^}]+)}$/.exec(b))){const W=`\`{ "type": "identity", "property": ${j?JSON.stringify(j[1]):'"_"'} }\``;return[new $n(u,b,`"${I}" does not support interpolation syntax\nUse an identity property function instead: ${W}.`)]}const $=[];return"symbol"===s.layerType&&("text-field"===I&&f&&!f.glyphs&&$.push(new $n(u,b,'use of "text-field" requires a style "glyphs" property')),"text-font"===I&&qr(aa(b))&&"identity"===Ms(b.type)&&$.push(new $n(u,b,'"text-font" does not support identity functions'))),$.concat(U({key:s.key,value:b,valueSpec:N,style:f,styleSpec:m,expressionContext:"property",propertyType:i,propertyKey:I}))}function Su(s){return Al(s,"paint")}function dd(s){return Al(s,"layout")}function Ua(s){let i=[];const u=s.value,f=s.key,m=s.style,b=s.styleSpec;u.type||u.ref||i.push(new $n(f,u,'either "type" or "ref" is required'));let I=Ms(u.type);const A=Ms(u.ref);if(u.id){const O=Ms(u.id);for(let N=0;N<s.arrayIndex;N++){const j=m.layers[N];Ms(j.id)===O&&i.push(new $n(f,u.id,`duplicate layer id "${u.id}", previously used at line ${j.id.__line__}`))}}if("ref"in u){let O;["type","source","source-layer","filter","layout"].forEach(N=>{N in u&&i.push(new $n(f,u[N],`"${N}" is prohibited for ref layers`))}),m.layers.forEach(N=>{Ms(N.id)===A&&(O=N)}),O?O.ref?i.push(new $n(f,u.ref,"ref cannot reference another ref layer")):I=Ms(O.type):"string"==typeof A&&i.push(new $n(f,u.ref,`ref layer "${A}" not found`))}else if("background"!==I&&"sky"!==I)if(u.source){const O=m.sources&&m.sources[u.source],N=O&&Ms(O.type);O?"vector"===N&&"raster"===I?i.push(new $n(f,u.source,`layer "${u.id}" requires a raster source`)):"raster"===N&&"raster"!==I?i.push(new $n(f,u.source,`layer "${u.id}" requires a vector source`)):"vector"!==N||u["source-layer"]?"raster-dem"===N&&"hillshade"!==I?i.push(new $n(f,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==I||!u.paint||!u.paint["line-gradient"]&&!u.paint["line-trim-offset"]||"geojson"===N&&O.lineMetrics||i.push(new $n(f,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new $n(f,u,`layer "${u.id}" must specify a "source-layer"`)):i.push(new $n(f,u.source,`source "${u.source}" not found`))}else i.push(new $n(f,u,'missing required property "source"'));return i=i.concat(ho({key:f,value:u,valueSpec:b.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>U({key:`${f}.type`,value:u.type,valueSpec:b.layer.type,style:s.style,styleSpec:s.styleSpec,object:u,objectKey:"type"}),filter:O=>Cu(Wu({layerType:I},O)),layout:O=>ho({layer:u,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":N=>dd(Wu({layerType:I},N))}}),paint:O=>ho({layer:u,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":N=>Su(Wu({layerType:I},N))}})}})),i}function no(s){const i=s.value,u=s.key,f=bn(i);return"string"!==f?[new $n(u,i,`string expected, ${f} found`)]:[]}const pd={promoteId:function({key:s,value:i}){if("string"===bn(i))return no({key:s,value:i});{const u=[];for(const f in i)u.push(...no({key:`${s}.${f}`,value:i[f]}));return u}}};function ke(s){const i=s.value,u=s.key,f=s.styleSpec,m=s.style;if(!i.type)return[new $n(u,i,'"type" is required')];const b=Ms(i.type);let I;switch(b){case"vector":case"raster":case"raster-dem":return I=ho({key:u,value:i,valueSpec:f[`source_${b.replace("-","_")}`],style:s.style,styleSpec:f,objectElementValidators:pd}),I;case"geojson":if(I=ho({key:u,value:i,valueSpec:f.source_geojson,style:m,styleSpec:f,objectElementValidators:pd}),i.cluster)for(const A in i.clusterProperties){const[O,N]=i.clusterProperties[A],j="string"==typeof O?[O,["accumulated"],["get",A]]:O;I.push(...wa({key:`${u}.${A}.map`,value:N,expressionContext:"cluster-map"})),I.push(...wa({key:`${u}.${A}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return I;case"video":return ho({key:u,value:i,valueSpec:f.source_video,style:m,styleSpec:f});case"image":return ho({key:u,value:i,valueSpec:f.source_image,style:m,styleSpec:f});case"canvas":return[new $n(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Or({key:`${u}.type`,value:i.type,valueSpec:{values:a(f)},style:m,styleSpec:f})}}function a(s){return s.source.reduce((i,u)=>{const f=s[u];return"enum"===f.type.type&&(i=i.concat(Object.keys(f.type.values))),i},[])}function h(s){const i=s.value,u=s.styleSpec,f=u.light,m=s.style;let b=[];const I=bn(i);if(void 0===i)return b;if("object"!==I)return b=b.concat([new $n("light",i,`object expected, ${I} found`)]),b;for(const A in i){const O=A.match(/^(.*)-transition$/);b=b.concat(O&&f[O[1]]&&f[O[1]].transition?U({key:A,value:i[A],valueSpec:u.transition,style:m,styleSpec:u}):f[A]?U({key:A,value:i[A],valueSpec:f[A],style:m,styleSpec:u}):[new $n(A,i[A],`unknown property "${A}"`)])}return b}function y(s){const i=s.value,u=s.key,f=s.style,m=s.styleSpec,b=m.terrain;let I=[];const A=bn(i);if(void 0===i)return I;if("object"!==A)return I=I.concat([new $n("terrain",i,`object expected, ${A} found`)]),I;for(const O in i){const N=O.match(/^(.*)-transition$/);I=I.concat(N&&b[N[1]]&&b[N[1]].transition?U({key:O,value:i[O],valueSpec:m.transition,style:f,styleSpec:m}):b[O]?U({key:O,value:i[O],valueSpec:b[O],style:f,styleSpec:m}):[new $n(O,i[O],`unknown property "${O}"`)])}if(i.source){const O=f.sources&&f.sources[i.source],N=O&&Ms(O.type);O?"raster-dem"!==N&&I.push(new $n(u,i.source,`terrain cannot be used with a source of type ${String(N)}, it only be used with a "raster-dem" source type`)):I.push(new $n(u,i.source,`source "${i.source}" not found`))}else I.push(new $n(u,i,'terrain is missing required property "source"'));return I}function x(s){const i=s.value,u=s.style,f=s.styleSpec,m=f.fog;let b=[];const I=bn(i);if(void 0===i)return b;if("object"!==I)return b=b.concat([new $n("fog",i,`object expected, ${I} found`)]),b;for(const A in i){const O=A.match(/^(.*)-transition$/);b=b.concat(O&&m[O[1]]&&m[O[1]].transition?U({key:A,value:i[A],valueSpec:f.transition,style:u,styleSpec:f}):m[A]?U({key:A,value:i[A],valueSpec:m[A],style:u,styleSpec:f}):[new $n(A,i[A],`unknown property "${A}"`)])}return b}const D={"*":()=>[],array:dh,boolean:function(s){const i=s.value,u=s.key,f=bn(i);return"boolean"!==f?[new $n(u,i,`boolean expected, ${f} found`)]:[]},number:ku,color:function(s){const i=s.key,u=s.value,f=bn(u);return"string"!==f?[new $n(i,u,`color expected, ${f} found`)]:null===Hn(u)?[new $n(i,u,`color expected, "${u}" found`)]:[]},enum:Or,filter:Cu,function:fo,layer:Ua,object:ho,source:ke,light:h,terrain:y,fog:x,string:no,formatted:function(s){return 0===no(s).length?[]:wa(s)},resolvedImage:function(s){return 0===no(s).length?[]:wa(s)},projection:function(s){const i=s.value,u=s.styleSpec,f=u.projection,m=s.style;let b=[];const I=bn(i);if("object"===I)for(const A in i)b=b.concat(U({key:A,value:i[A],valueSpec:f[A],style:m,styleSpec:u}));else"string"!==I&&(b=b.concat([new $n("projection",i,`object or string expected, ${I} found`)]));return b}};function U(s){const i=s.value,u=s.valueSpec,f=s.styleSpec;return u.expression&&qr(Ms(i))?fo(s):u.expression&&pr(aa(i))?wa(s):u.type&&D[u.type]?D[u.type](s):ho(Wu({},s,{valueSpec:u.type?f[u.type]:u}))}function H(s){const i=s.value,u=s.key,f=no(s);return f.length||(-1===i.indexOf("{fontstack}")&&f.push(new $n(u,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&f.push(new $n(u,i,'"glyphs" url must include a "{range}" token'))),f}function pe(s,i=on){return qt(U({key:"",value:s,valueSpec:i.$root,styleSpec:i,style:s,objectElementValidators:{glyphs:H,"*":()=>[]}}))}const Ge=s=>qt(Su(s)),wt=s=>qt(dd(s));function qt(s){return s.slice().sort((i,u)=>i.line&&u.line?i.line-u.line:0)}function nn(s,i){let u=!1;if(i&&i.length)for(const f of i)s.fire(new Oa(new Error(f.message))),u=!0;return u}var Wn=tr,kn=3;function tr(s,i,u){var f=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var m=new Int32Array(this.arrayBuffer);s=m[0],this.d=(i=m[1])+2*(u=m[2]);for(var b=0;b<this.d*this.d;b++){var I=m[kn+b],A=m[kn+b+1];f.push(I===A?null:m.subarray(I,A))}var O=m[kn+f.length+1];this.keys=m.subarray(m[kn+f.length],O),this.bboxes=m.subarray(O),this.insert=this._insertReadonly}else{this.d=i+2*u;for(var N=0;N<this.d*this.d;N++)f.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=s,this.padding=u,this.scale=i/s,this.uid=0;var j=u/i*s;this.min=-j,this.max=s+j}tr.prototype.insert=function(s,i,u,f,m){this._forEachCell(i,u,f,m,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(i),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(m)},tr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},tr.prototype._insertCell=function(s,i,u,f,m,b){this.cells[m].push(b)},tr.prototype.query=function(s,i,u,f,m){var b=this.min,I=this.max;if(s<=b&&i<=b&&I<=u&&I<=f&&!m)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(s,i,u,f,this._queryCell,A,{},m),A},tr.prototype._queryCell=function(s,i,u,f,m,b,I,A){var O=this.cells[m];if(null!==O)for(var N=this.keys,j=this.bboxes,$=0;$<O.length;$++){var W=O[$];if(void 0===I[W]){var Q=4*W;(A?A(j[Q+0],j[Q+1],j[Q+2],j[Q+3]):s<=j[Q+2]&&i<=j[Q+3]&&u>=j[Q+0]&&f>=j[Q+1])?(I[W]=!0,b.push(N[W])):I[W]=!1}}},tr.prototype._forEachCell=function(s,i,u,f,m,b,I,A){for(var O=this._convertToCellCoord(s),N=this._convertToCellCoord(i),j=this._convertToCellCoord(u),$=this._convertToCellCoord(f),W=O;W<=j;W++)for(var Q=N;Q<=$;Q++){var ie=this.d*Q+W;if((!A||A(this._convertFromCellCoord(W),this._convertFromCellCoord(Q),this._convertFromCellCoord(W+1),this._convertFromCellCoord(Q+1)))&&m.call(this,s,i,u,f,ie,b,I,A))return}},tr.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},tr.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},tr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,i=kn+this.cells.length+1+1,u=0,f=0;f<this.cells.length;f++)u+=this.cells[f].length;var m=new Int32Array(i+u+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var b=i,I=0;I<s.length;I++){var A=s[I];m[kn+I]=b,m.set(A,b),b+=A.length}return m[kn+s.length]=b,m.set(this.keys,b),m[kn+s.length+1]=b+=this.keys.length,m.set(this.bboxes,b),b+=this.bboxes.length,m.buffer};var lr=K(Wn);const ji={};function Gn(s,i,u={}){Object.defineProperty(s,"_classRegistryKey",{value:i,writeable:!1}),ji[i]={klass:s,omit:u.omit||[]}}Gn(Object,"Object"),lr.serialize=function(s,i){const u=s.toArrayBuffer();return i&&i.push(u),{buffer:u}},lr.deserialize=function(s){return new lr(s.buffer)},Object.defineProperty(lr,"name",{value:"Grid"}),Gn(lr,"Grid"),Gn(zs,"Color"),Gn(Error,"Error"),Gn(ni,"AJAXError"),Gn(Ti,"ResolvedImage"),Gn(_s,"StylePropertyFunction"),Gn(nl,"StyleExpression",{omit:["_evaluator"]}),Gn(za,"ZoomDependentExpression"),Gn(Dl,"ZoomConstantExpression"),Gn(Zo,"CompoundExpression",{omit:["_evaluate"]});for(const s in Zs)ji[Zs[s]._classRegistryKey]||Gn(Zs[s],`Expression${s}`);function ga(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&"ArrayBuffer"===s.constructor.name)}function ma(s){return J.ImageBitmap&&s instanceof J.ImageBitmap}function il(s,i){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(ga(s)||ma(s))return i&&i.push(s),s;if(ArrayBuffer.isView(s)){const u=s;return i&&i.push(u.buffer),u}if(s instanceof J.ImageData)return i&&i.push(s.data.buffer),s;if(Array.isArray(s)){const u=[];for(const f of s)u.push(il(f,i));return u}if("object"==typeof s){const u=s.constructor,f=u._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${f}`);const m=u.serialize?u.serialize(s,i):{};if(!u.serialize){for(const b in s)s.hasOwnProperty(b)&&(ji[f].omit.indexOf(b)>=0||(m[b]=il(s[b],i)));s instanceof Error&&(m.message=s.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==f&&(m.$name=f),m}throw new Error("can't serialize object of type "+typeof s)}function zc(s){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||ga(s)||ma(s)||ArrayBuffer.isView(s)||s instanceof J.ImageData)return s;if(Array.isArray(s))return s.map(zc);if("object"==typeof s){const i=s.$name||"Object",{klass:u}=ji[i];if(!u)throw new Error(`can't deserialize unregistered class ${i}`);if(u.deserialize)return u.deserialize(s);const f=Object.create(u.prototype);for(const m of Object.keys(s))"$name"!==m&&(f[m]=zc(s[m]));return f}throw new Error("can't deserialize object of type "+typeof s)}const Kn={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Bg(s){for(const i of s)if(kf(i.charCodeAt(0)))return!0;return!1}function Jm(s){for(const i of s)if(!zu(i.charCodeAt(0)))return!1;return!0}function zu(s){return!(Kn.Arabic(s)||Kn["Arabic Supplement"](s)||Kn["Arabic Extended-A"](s)||Kn["Arabic Presentation Forms-A"](s)||Kn["Arabic Presentation Forms-B"](s))}function kf(s){return!(746!==s&&747!==s&&(s<4352||!(Kn["Bopomofo Extended"](s)||Kn.Bopomofo(s)||Kn["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||Kn["CJK Compatibility Ideographs"](s)||Kn["CJK Compatibility"](s)||Kn["CJK Radicals Supplement"](s)||Kn["CJK Strokes"](s)||!(!Kn["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||12336===s)||Kn["CJK Unified Ideographs Extension A"](s)||Kn["CJK Unified Ideographs"](s)||Kn["Enclosed CJK Letters and Months"](s)||Kn["Hangul Compatibility Jamo"](s)||Kn["Hangul Jamo Extended-A"](s)||Kn["Hangul Jamo Extended-B"](s)||Kn["Hangul Jamo"](s)||Kn["Hangul Syllables"](s)||Kn.Hiragana(s)||Kn["Ideographic Description Characters"](s)||Kn.Kanbun(s)||Kn["Kangxi Radicals"](s)||Kn["Katakana Phonetic Extensions"](s)||Kn.Katakana(s)&&12540!==s||!(!Kn["Halfwidth and Fullwidth Forms"](s)||65288===s||65289===s||65293===s||s>=65306&&s<=65310||65339===s||65341===s||65343===s||s>=65371&&s<=65503||65507===s||s>=65512&&s<=65519)||!(!Kn["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||Kn["Unified Canadian Aboriginal Syllabics"](s)||Kn["Unified Canadian Aboriginal Syllabics Extended"](s)||Kn["Vertical Forms"](s)||Kn["Yijing Hexagram Symbols"](s)||Kn["Yi Syllables"](s)||Kn["Yi Radicals"](s))))}function hu(s){return!(kf(s)||(i=s,Kn["Latin-1 Supplement"](i)&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||Kn["General Punctuation"](i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||Kn["Letterlike Symbols"](i)||Kn["Number Forms"](i)||Kn["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||Kn["Control Pictures"](i)&&9251!==i||Kn["Optical Character Recognition"](i)||Kn["Enclosed Alphanumerics"](i)||Kn["Geometric Shapes"](i)||Kn["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Kn["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Kn["CJK Symbols and Punctuation"](i)||Kn.Katakana(i)||Kn["Private Use Area"](i)||Kn["CJK Compatibility Forms"](i)||Kn["Small Form Variants"](i)||Kn["Halfwidth and Fullwidth Forms"](i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i}function Wl(s){return s>=1424&&s<=2303||Kn["Arabic Presentation Forms-A"](s)||Kn["Arabic Presentation Forms-B"](s)}function __(s,i){return!(!i&&Wl(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||Kn.Khmer(s))}function $p(s){for(const i of s)if(Wl(i.charCodeAt(0)))return!0;return!1}const gd="deferred",Ff="loading",qp="loaded";let Bf=null,w="unavailable",l=null;const g=function(s){s&&"string"==typeof s&&s.indexOf("NetworkError")>-1&&(w="error"),Bf&&Bf(s)};function C(){M.fire(new Za("pluginStateChange",{pluginStatus:w,pluginURL:l}))}const M=new Na,P=function(){return w},k=function(){if(w!==gd||!l)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");w=Ff,C(),l&&ts({url:l},s=>{s?g(s):(w=qp,C())})},z={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>w===qp||null!=z.applyArabicShaping,isLoading:()=>w===Ff,setState(s){w=s.pluginStatus,l=s.pluginURL},isParsed:()=>null!=z.applyArabicShaping&&null!=z.processBidirectionalText&&null!=z.processStyledBidirectionalText,getPluginURL:()=>l};class G{constructor(i,u){this.zoom=i,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.transition=u.transition,this.pitch=u.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(i){return function(u,f){for(const m of u)if(!__(m.charCodeAt(0),f))return!1;return!0}(i,z.isLoaded())}}class X{constructor(i,u){this.property=i,this.value=u,this.expression=function(f,m){if(qr(f))return new _s(f,m);if(pr(f)){const b=vo(f,m);if("error"===b.result)throw new Error(b.value.map(I=>`${I.key}: ${I.message}`).join(", "));return b.value}{let b=f;return"string"==typeof f&&"color"===m.type&&(b=zs.parse(f)),{kind:"constant",evaluate:()=>b}}}(void 0===u?i.specification.default:u,i.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,u,f){return this.property.possiblyEvaluate(this,i,u,f)}}class Z{constructor(i){this.property=i,this.value=new X(i,void 0)}transitioned(i,u){return new Ie(this.property,this.value,u,Be({},i.transition,this.transition),i.now)}untransitioned(){return new Ie(this.property,this.value,null,{},0)}}class se{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return wn(this._values[i].value.value)}setValue(i,u){this._values.hasOwnProperty(i)||(this._values[i]=new Z(this._values[i].property)),this._values[i].value=new X(this._values[i].property,null===u?void 0:wn(u))}getTransition(i){return wn(this._values[i].transition)}setTransition(i,u){this._values.hasOwnProperty(i)||(this._values[i]=new Z(this._values[i].property)),this._values[i].transition=wn(u)||void 0}serialize(){const i={};for(const u of Object.keys(this._values)){const f=this.getValue(u);void 0!==f&&(i[u]=f);const m=this.getTransition(u);void 0!==m&&(i[`${u}-transition`]=m)}return i}transitioned(i,u){const f=new ze(this._properties);for(const m of Object.keys(this._values))f._values[m]=this._values[m].transitioned(i,u._values[m]);return f}untransitioned(){const i=new ze(this._properties);for(const u of Object.keys(this._values))i._values[u]=this._values[u].untransitioned();return i}}class Ie{constructor(i,u,f,m,b){const I=m.delay||0,A=m.duration||0;b=b||0,this.property=i,this.value=u,this.begin=b+I,this.end=this.begin+A,i.specification.transition&&(m.delay||m.duration)&&(this.prior=f)}possiblyEvaluate(i,u,f){const m=i.now||0,b=this.value.possiblyEvaluate(i,u,f),I=this.prior;if(I){if(m>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(m<this.begin)return I.possiblyEvaluate(i,u,f);{const A=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(I.possiblyEvaluate(i,u,f),b,Ne(A))}}return b}}class ze{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,u,f){const m=new We(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].possiblyEvaluate(i,u,f);return m}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class $e{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return wn(this._values[i].value)}setValue(i,u){this._values[i]=new X(this._values[i].property,null===u?void 0:wn(u))}serialize(){const i={};for(const u of Object.keys(this._values)){const f=this.getValue(u);void 0!==f&&(i[u]=f)}return i}possiblyEvaluate(i,u,f){const m=new We(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].possiblyEvaluate(i,u,f);return m}}class je{constructor(i,u,f){this.property=i,this.value=u,this.parameters=f}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,u,f,m){return this.property.evaluate(this.value,this.parameters,i,u,f,m)}}class We{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class ue{constructor(i){this.specification=i}possiblyEvaluate(i,u){return i.expression.evaluate(u)}interpolate(i,u,f){const m=xu[this.specification.type];return m?m(i,u,f):i}}class Fe{constructor(i,u){this.specification=i,this.overrides=u}possiblyEvaluate(i,u,f,m){return new je(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(u,null,{},f,m)}:i.expression,u)}interpolate(i,u,f){if("constant"!==i.value.kind||"constant"!==u.value.kind)return i;if(void 0===i.value.value||void 0===u.value.value)return new je(this,{kind:"constant",value:void 0},i.parameters);const m=xu[this.specification.type];return m?new je(this,{kind:"constant",value:m(i.value.value,u.value.value,f)},i.parameters):i}evaluate(i,u,f,m,b,I){return"constant"===i.kind?i.value:i.evaluate(u,f,m,b,I)}}class nt{constructor(i){this.specification=i}possiblyEvaluate(i,u,f,m){return!!i.expression.evaluate(u,null,{},f,m)}interpolate(){return!1}}class Qe{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const u=new G(0,{});for(const f in i){const m=i[f];m.specification.overridable&&this.overridableProperties.push(f);const b=this.defaultPropertyValues[f]=new X(m,void 0),I=this.defaultTransitionablePropertyValues[f]=new Z(m);this.defaultTransitioningPropertyValues[f]=I.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=b.possiblyEvaluate(u)}}}function Et(s,i){return 256*(s=Le(Math.floor(s),0,255))+Le(Math.floor(i),0,255)}Gn(Fe,"DataDrivenProperty"),Gn(ue,"DataConstantProperty"),Gn(nt,"ColorRampProperty");const St={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class at{constructor(i,u){this._structArray=i,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ot{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,u){return i._trim(),u&&(i.isTransferred=!0,u.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const u=Object.create(this.prototype);return u.arrayBuffer=i.arrayBuffer,u.length=i.length,u.capacity=i.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Rt(s,i=1){let u=0,f=0;return{members:s.map(m=>{const b=St[m.type].BYTES_PER_ELEMENT,I=u=kt(u,Math.max(i,b)),A=m.components||1;return f=Math.max(f,b),u+=b*A,{name:m.name,type:m.type,components:A,offset:I}}),size:kt(u,Math.max(f,i)),alignment:i}}function kt(s,i){return Math.ceil(s/i)*i}class Dn extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,u)}emplace(i,u,f){const m=2*i;return this.int16[m+0]=u,this.int16[m+1]=f,i}}Dn.prototype.bytesPerElement=4,Gn(Dn,"StructArrayLayout2i4");class Ut extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,i,u,f)}emplace(i,u,f,m){const b=3*i;return this.int16[b+0]=u,this.int16[b+1]=f,this.int16[b+2]=m,i}}Ut.prototype.bytesPerElement=6,Gn(Ut,"StructArrayLayout3i6");class an extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,i,u,f,m)}emplace(i,u,f,m,b){const I=4*i;return this.int16[I+0]=u,this.int16[I+1]=f,this.int16[I+2]=m,this.int16[I+3]=b,i}}an.prototype.bytesPerElement=8,Gn(an,"StructArrayLayout4i8");class Ht extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f,m,b,I,A){const O=this.length;return this.resize(O+1),this.emplace(O,i,u,f,m,b,I,A)}emplace(i,u,f,m,b,I,A,O){const N=6*i,j=12*i,$=3*i;return this.int16[N+0]=u,this.int16[N+1]=f,this.uint8[j+4]=m,this.uint8[j+5]=b,this.uint8[j+6]=I,this.uint8[j+7]=A,this.float32[$+2]=O,i}}Ht.prototype.bytesPerElement=12,Gn(Ht,"StructArrayLayout2i4ub1f12");class gn extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,i,u,f,m)}emplace(i,u,f,m,b){const I=4*i;return this.float32[I+0]=u,this.float32[I+1]=f,this.float32[I+2]=m,this.float32[I+3]=b,i}}gn.prototype.bytesPerElement=16,Gn(gn,"StructArrayLayout4f16");class Gt extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f,m,b){const I=this.length;return this.resize(I+1),this.emplace(I,i,u,f,m,b)}emplace(i,u,f,m,b,I){const A=6*i,O=3*i;return this.uint16[A+0]=u,this.uint16[A+1]=f,this.uint16[A+2]=m,this.uint16[A+3]=b,this.float32[O+2]=I,i}}Gt.prototype.bytesPerElement=12,Gn(Gt,"StructArrayLayout4ui1f12");class fn extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,i,u,f,m)}emplace(i,u,f,m,b){const I=4*i;return this.uint16[I+0]=u,this.uint16[I+1]=f,this.uint16[I+2]=m,this.uint16[I+3]=b,i}}fn.prototype.bytesPerElement=8,Gn(fn,"StructArrayLayout4ui8");class En extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,f,m,b,I){const A=this.length;return this.resize(A+1),this.emplace(A,i,u,f,m,b,I)}emplace(i,u,f,m,b,I,A){const O=6*i;return this.int16[O+0]=u,this.int16[O+1]=f,this.int16[O+2]=m,this.int16[O+3]=b,this.int16[O+4]=I,this.int16[O+5]=A,i}}En.prototype.bytesPerElement=12,Gn(En,"StructArrayLayout6i12");class vn extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,f,m,b,I,A,O,N,j,$,W){const Q=this.length;return this.resize(Q+1),this.emplace(Q,i,u,f,m,b,I,A,O,N,j,$,W)}emplace(i,u,f,m,b,I,A,O,N,j,$,W,Q){const ie=12*i;return this.int16[ie+0]=u,this.int16[ie+1]=f,this.int16[ie+2]=m,this.int16[ie+3]=b,this.uint16[ie+4]=I,this.uint16[ie+5]=A,this.uint16[ie+6]=O,this.uint16[ie+7]=N,this.int16[ie+8]=j,this.int16[ie+9]=$,this.int16[ie+10]=W,this.int16[ie+11]=Q,i}}vn.prototype.bytesPerElement=24,Gn(vn,"StructArrayLayout4i4ui4i24");class Ln extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f,m,b,I){const A=this.length;return this.resize(A+1),this.emplace(A,i,u,f,m,b,I)}emplace(i,u,f,m,b,I,A){const O=10*i,N=5*i;return this.int16[O+0]=u,this.int16[O+1]=f,this.int16[O+2]=m,this.float32[N+2]=b,this.float32[N+3]=I,this.float32[N+4]=A,i}}Ln.prototype.bytesPerElement=20,Gn(Ln,"StructArrayLayout3i3f20");class wr extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.uint32[1*i+0]=u,i}}wr.prototype.bytesPerElement=4,Gn(wr,"StructArrayLayout1ul4");class Vr extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,f,m,b,I,A,O,N,j,$,W,Q){const ie=this.length;return this.resize(ie+1),this.emplace(ie,i,u,f,m,b,I,A,O,N,j,$,W,Q)}emplace(i,u,f,m,b,I,A,O,N,j,$,W,Q,ie){const ge=20*i,De=10*i;return this.int16[ge+0]=u,this.int16[ge+1]=f,this.int16[ge+2]=m,this.int16[ge+3]=b,this.int16[ge+4]=I,this.float32[De+3]=A,this.float32[De+4]=O,this.float32[De+5]=N,this.float32[De+6]=j,this.int16[ge+14]=$,this.uint32[De+8]=W,this.uint16[ge+18]=Q,this.uint16[ge+19]=ie,i}}Vr.prototype.bytesPerElement=40,Gn(Vr,"StructArrayLayout5i4f1i1ul2ui40");class or extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,f,m,b,I,A){const O=this.length;return this.resize(O+1),this.emplace(O,i,u,f,m,b,I,A)}emplace(i,u,f,m,b,I,A,O){const N=8*i;return this.int16[N+0]=u,this.int16[N+1]=f,this.int16[N+2]=m,this.int16[N+4]=b,this.int16[N+5]=I,this.int16[N+6]=A,this.int16[N+7]=O,i}}or.prototype.bytesPerElement=16,Gn(or,"StructArrayLayout3i2i2i16");class Ar extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,f,m,b){const I=this.length;return this.resize(I+1),this.emplace(I,i,u,f,m,b)}emplace(i,u,f,m,b,I){const A=4*i,O=8*i;return this.float32[A+0]=u,this.float32[A+1]=f,this.float32[A+2]=m,this.int16[O+6]=b,this.int16[O+7]=I,i}}Ar.prototype.bytesPerElement=16,Gn(Ar,"StructArrayLayout2f1f2i16");class Xn extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,i,u,f,m)}emplace(i,u,f,m,b){const I=12*i,A=3*i;return this.uint8[I+0]=u,this.uint8[I+1]=f,this.float32[A+1]=m,this.float32[A+2]=b,i}}Xn.prototype.bytesPerElement=12,Gn(Xn,"StructArrayLayout2ub2f12");class ci extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,i,u,f)}emplace(i,u,f,m){const b=3*i;return this.float32[b+0]=u,this.float32[b+1]=f,this.float32[b+2]=m,i}}ci.prototype.bytesPerElement=12,Gn(ci,"StructArrayLayout3f12");class yr extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,i,u,f)}emplace(i,u,f,m){const b=3*i;return this.uint16[b+0]=u,this.uint16[b+1]=f,this.uint16[b+2]=m,i}}yr.prototype.bytesPerElement=6,Gn(yr,"StructArrayLayout3ui6");class bo extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,u,f,m,b,I,A,O,N,j,$,W,Q,ie,ge,De,Ye,ht,Ke,ut,xt){const _t=this.length;return this.resize(_t+1),this.emplace(_t,i,u,f,m,b,I,A,O,N,j,$,W,Q,ie,ge,De,Ye,ht,Ke,ut,xt)}emplace(i,u,f,m,b,I,A,O,N,j,$,W,Q,ie,ge,De,Ye,ht,Ke,ut,xt,_t){const Kt=30*i,Wt=15*i,hn=60*i;return this.int16[Kt+0]=u,this.int16[Kt+1]=f,this.int16[Kt+2]=m,this.float32[Wt+2]=b,this.float32[Wt+3]=I,this.uint16[Kt+8]=A,this.uint16[Kt+9]=O,this.uint32[Wt+5]=N,this.uint32[Wt+6]=j,this.uint32[Wt+7]=$,this.uint16[Kt+16]=W,this.uint16[Kt+17]=Q,this.uint16[Kt+18]=ie,this.float32[Wt+10]=ge,this.float32[Wt+11]=De,this.uint8[hn+48]=Ye,this.uint8[hn+49]=ht,this.uint8[hn+50]=Ke,this.uint32[Wt+13]=ut,this.int16[Kt+28]=xt,this.uint8[hn+58]=_t,i}}bo.prototype.bytesPerElement=60,Gn(bo,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ko extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,u,f,m,b,I,A,O,N,j,$,W,Q,ie,ge,De,Ye,ht,Ke,ut,xt,_t,Kt,Wt,hn,On,tn,dn,mn,In){const Un=this.length;return this.resize(Un+1),this.emplace(Un,i,u,f,m,b,I,A,O,N,j,$,W,Q,ie,ge,De,Ye,ht,Ke,ut,xt,_t,Kt,Wt,hn,On,tn,dn,mn,In)}emplace(i,u,f,m,b,I,A,O,N,j,$,W,Q,ie,ge,De,Ye,ht,Ke,ut,xt,_t,Kt,Wt,hn,On,tn,dn,mn,In,Un){const cn=38*i,Zn=19*i;return this.int16[cn+0]=u,this.int16[cn+1]=f,this.int16[cn+2]=m,this.float32[Zn+2]=b,this.float32[Zn+3]=I,this.int16[cn+8]=A,this.int16[cn+9]=O,this.int16[cn+10]=N,this.int16[cn+11]=j,this.int16[cn+12]=$,this.int16[cn+13]=W,this.uint16[cn+14]=Q,this.uint16[cn+15]=ie,this.uint16[cn+16]=ge,this.uint16[cn+17]=De,this.uint16[cn+18]=Ye,this.uint16[cn+19]=ht,this.uint16[cn+20]=Ke,this.uint16[cn+21]=ut,this.uint16[cn+22]=xt,this.uint16[cn+23]=_t,this.uint16[cn+24]=Kt,this.uint16[cn+25]=Wt,this.uint16[cn+26]=hn,this.uint16[cn+27]=On,this.uint16[cn+28]=tn,this.uint32[Zn+15]=dn,this.float32[Zn+16]=mn,this.float32[Zn+17]=In,this.float32[Zn+18]=Un,i}}Ko.prototype.bytesPerElement=76,Gn(Ko,"StructArrayLayout3i2f6i15ui1ul3f76");class us extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.float32[1*i+0]=u,i}}us.prototype.bytesPerElement=4,Gn(us,"StructArrayLayout1f4");class ls extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f,m,b){const I=this.length;return this.resize(I+1),this.emplace(I,i,u,f,m,b)}emplace(i,u,f,m,b,I){const A=5*i;return this.float32[A+0]=u,this.float32[A+1]=f,this.float32[A+2]=m,this.float32[A+3]=b,this.float32[A+4]=I,i}}ls.prototype.bytesPerElement=20,Gn(ls,"StructArrayLayout5f20");class Va extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,i,u,f,m)}emplace(i,u,f,m,b){const I=6*i;return this.uint32[3*i+0]=u,this.uint16[I+2]=f,this.uint16[I+3]=m,this.uint16[I+4]=b,i}}Va.prototype.bytesPerElement=12,Gn(Va,"StructArrayLayout1ul3ui12");class Iu extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,u)}emplace(i,u,f){const m=2*i;return this.uint16[m+0]=u,this.uint16[m+1]=f,i}}Iu.prototype.bytesPerElement=4,Gn(Iu,"StructArrayLayout2ui4");class Xl extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.uint16[1*i+0]=u,i}}Xl.prototype.bytesPerElement=2,Gn(Xl,"StructArrayLayout1ui2");class pc extends Ot{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,u)}emplace(i,u,f){const m=2*i;return this.float32[m+0]=u,this.float32[m+1]=f,i}}pc.prototype.bytesPerElement=8,Gn(pc,"StructArrayLayout2f8");class Ks extends at{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ks.prototype.size=40;class Jo extends Vr{get(i){return new Ks(this,i)}}Gn(Jo,"CollisionBoxArray");class ln extends at{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}ln.prototype.size=60;class Wr extends bo{get(i){return new ln(this,i)}}Gn(Wr,"PlacedSymbolArray");class ol extends at{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(i){this._structArray.uint32[this._pos4+15]=i}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ol.prototype.size=76;class vs extends Ko{get(i){return new ol(this,i)}}Gn(vs,"SymbolInstanceArray");class xs extends us{getoffsetX(i){return this.float32[1*i+0]}}Gn(xs,"GlyphOffsetArray");class zf extends Dn{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}Gn(zf,"SymbolLineVertexArray");class gc extends at{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}gc.prototype.size=12;class Pl extends Va{get(i){return new gc(this,i)}}Gn(Pl,"FeatureIndexArray");class mc extends Iu{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}Gn(mc,"FillExtrusionCentroidArray");const Zc=Rt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ph=Rt([{name:"a_dash",components:4,type:"Uint16"}]);var Wd={exports:{}},Zi=function(s,i){var u,f,m,b,I,A,O,N;for(f=s.length-(u=3&s.length),m=i,I=3432918353,A=461845907,N=0;N<f;)O=255&s.charCodeAt(N)|(255&s.charCodeAt(++N))<<8|(255&s.charCodeAt(++N))<<16|(255&s.charCodeAt(++N))<<24,++N,m=27492+(65535&(b=5*(65535&(m=(m^=O=(65535&(O=(O=(65535&O)*I+(((O>>>16)*I&65535)<<16)&4294967295)<<15|O>>>17))*A+(((O>>>16)*A&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(O=0,u){case 3:O^=(255&s.charCodeAt(N+2))<<16;case 2:O^=(255&s.charCodeAt(N+1))<<8;case 1:m^=O=(65535&(O=(O=(65535&(O^=255&s.charCodeAt(N)))*I+(((O>>>16)*I&65535)<<16)&4294967295)<<15|O>>>17))*A+(((O>>>16)*A&65535)<<16)&4294967295}return m^=s.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0},Xd=function(s,i){for(var u,f=s.length,m=i^f,b=0;f>=4;)u=1540483477*(65535&(u=255&s.charCodeAt(b)|(255&s.charCodeAt(++b))<<8|(255&s.charCodeAt(++b))<<16|(255&s.charCodeAt(++b))<<24))+((1540483477*(u>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++b;switch(f){case 3:m^=(255&s.charCodeAt(b+2))<<16;case 2:m^=(255&s.charCodeAt(b+1))<<8;case 1:m=1540483477*(65535&(m^=255&s.charCodeAt(b)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};Wd.exports=Zi,Wd.exports.murmur3=Zi,Wd.exports.murmur2=Xd;var gh=K(Wd.exports);class Uf{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,u,f,m){this.ids.push(zg(i)),this.positions.push(u,f,m)}getPositions(i){const u=zg(i);let f=0,m=this.ids.length-1;for(;f<m;){const I=f+m>>1;this.ids[I]>=u?m=I:f=I+1}const b=[];for(;this.ids[f]===u;)b.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return b}static serialize(i,u){const f=new Float64Array(i.ids),m=new Uint32Array(i.positions);return Qm(f,m,0,f.length-1),u&&u.push(f.buffer,m.buffer),{ids:f,positions:m}}static deserialize(i){const u=new Uf;return u.ids=i.ids,u.positions=i.positions,u.indexed=!0,u}}function zg(s){const i=+s;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:gh(String(s))}function Qm(s,i,u,f){for(;u<f;){const m=s[u+f>>1];let b=u-1,I=f+1;for(;;){do{b++}while(s[b]<m);do{I--}while(s[I]>m);if(b>=I)break;Ug(s,b,I),Ug(i,3*b,3*I),Ug(i,3*b+1,3*I+1),Ug(i,3*b+2,3*I+2)}I-u<f-I?(Qm(s,i,u,I),u=I+1):(Qm(s,i,I+1,f),f=I)}}function Ug(s,i,u){const f=s[i];s[i]=s[u],s[u]=f}Gn(Uf,"FeaturePositionMap");class iu{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,u){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,u),this.initialized=!0),!!this.location}}class Zd extends iu{constructor(i){super(i),this.current=0}set(i,u,f){this.fetchUniformLocation(i,u)&&this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))}}class Yd extends iu{constructor(i){super(i),this.current=[0,0,0,0]}set(i,u,f){this.fetchUniformLocation(i,u)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3])))}}class Kd extends iu{constructor(i){super(i),this.current=zs.transparent}set(i,u,f){this.fetchUniformLocation(i,u)&&(f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a)))}}const v_=new Float32Array(16),ey=new Float32Array(9),Zl=new Float32Array(4);function mh(s){return[Et(255*s.r,255*s.g),Et(255*s.b,255*s.a)]}class Vf{constructor(i,u,f){this.value=i,this.uniformNames=u.map(m=>`u_${m}`),this.type=f}setUniform(i,u,f,m,b){u.set(i,b,m.constantOr(this.value))}getBinding(i,u){return"color"===this.type?new Kd(i):new Zd(i)}}class jf{constructor(i,u){this.uniformNames=u.map(f=>`u_${f}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(i){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br)}setUniform(i,u,f,m,b){const I="u_pattern"===b||"u_dash"===b?this.pattern:"u_pixel_ratio"===b?this.pixelRatio:null;I&&u.set(i,b,I)}getBinding(i,u){return"u_pattern"===u||"u_dash"===u?new Yd(i):new Zd(i)}}class Uc{constructor(i,u,f,m){this.expression=i,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===f?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(i,u,f,m,b,I){const A=this.paintVertexArray.length,O=this.expression.evaluate(new G(0),u,{},b,m,I);this.paintVertexArray.resize(i),this._setPaintValue(A,i,O)}updatePaintArray(i,u,f,m,b){const I=this.expression.evaluate({zoom:0},f,m,void 0,b);this._setPaintValue(i,u,I)}_setPaintValue(i,u,f){if("color"===this.type){const m=mh(f);for(let b=i;b<u;b++)this.paintVertexArray.emplace(b,m[0],m[1])}else{for(let m=i;m<u;m++)this.paintVertexArray.emplace(m,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class yc{constructor(i,u,f,m,b,I){this.expression=i,this.uniformNames=u.map(A=>`u_${A}_t`),this.type=f,this.useIntegerZoom=m,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=u.map(A=>({name:`a_${A}`,type:"Float32",components:"color"===f?4:2,offset:0})),this.paintVertexArray=new I}populatePaintArray(i,u,f,m,b,I){const A=this.expression.evaluate(new G(this.zoom),u,{},b,m,I),O=this.expression.evaluate(new G(this.zoom+1),u,{},b,m,I),N=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(N,i,A,O)}updatePaintArray(i,u,f,m,b){const I=this.expression.evaluate({zoom:this.zoom},f,m,void 0,b),A=this.expression.evaluate({zoom:this.zoom+1},f,m,void 0,b);this._setPaintValue(i,u,I,A)}_setPaintValue(i,u,f,m){if("color"===this.type){const b=mh(f),I=mh(m);for(let A=i;A<u;A++)this.paintVertexArray.emplace(A,b[0],b[1],I[0],I[1])}else{for(let b=i;b<u;b++)this.paintVertexArray.emplace(b,f,m);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(m))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,u,f,m,b){const I=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,A=Le(this.expression.interpolationFactor(I,this.zoom,this.zoom+1),0,1);u.set(i,b,A)}getBinding(i,u){return new Zd(i)}}class Gh{constructor(i,u,f,m,b){this.expression=i,this.layerId=b,this.paintVertexAttributes=("array"===f?ph:Zc).members;for(let I=0;I<u.length;++I);this.paintVertexArray=new m}populatePaintArray(i,u,f){const m=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(m,i,u.patterns&&u.patterns[this.layerId],f)}updatePaintArray(i,u,f,m,b,I){this._setPaintValues(i,u,f.patterns&&f.patterns[this.layerId],I)}_setPaintValues(i,u,f,m){if(!m||!f)return;const b=m[f];if(!b)return;const{tl:I,br:A,pixelRatio:O}=b;for(let N=i;N<u;N++)this.paintVertexArray.emplace(N,I[0],I[1],A[0],A[1],O)}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cf{constructor(i,u,f=(()=>!0)){this.binders={},this._buffers=[];const m=[];for(const b in i.paint._values){if(!f(b))continue;const I=i.paint.get(b);if(!(I instanceof je&&Fc(I.property.specification)))continue;const A=Os(b,i.type),O=I.value,N=I.property.specification.type,j=!!I.property.useIntegerZoom,$="line-dasharray"===b||b.endsWith("pattern"),W="line-dasharray"===b&&"constant"!==i.layout.get("line-cap").value.kind;if("constant"!==O.kind||W)if("source"===O.kind||W||$){const Q=ty(b,N,"source");this.binders[b]=$?new Gh(O,A,N,Q,i.id):new Uc(O,A,N,Q),m.push(`/a_${b}`)}else{const Q=ty(b,N,"composite");this.binders[b]=new yc(O,A,N,j,u,Q),m.push(`/z_${b}`)}else this.binders[b]=$?new jf(O.value,A):new Vf(O.value,A,N),m.push(`/u_${b}`)}this.cacheKey=m.sort().join("")}getMaxValue(i){const u=this.binders[i];return u instanceof Uc||u instanceof yc?u.maxValue:0}populatePaintArrays(i,u,f,m,b,I){for(const A in this.binders){const O=this.binders[A];(O instanceof Uc||O instanceof yc||O instanceof Gh)&&O.populatePaintArray(i,u,f,m,b,I)}}setConstantPatternPositions(i){for(const u in this.binders){const f=this.binders[u];f instanceof jf&&f.setConstantPatternPositions(i)}}updatePaintArrays(i,u,f,m,b,I){let A=!1;for(const O in i){const N=u.getPositions(O);for(const j of N){const $=f.feature(j.index);for(const W in this.binders){const Q=this.binders[W];if((Q instanceof Uc||Q instanceof yc||Q instanceof Gh)&&!0===Q.expression.isStateDependent){const ie=m.paint.get(W);Q.expression=ie.value,Q.updatePaintArray(j.start,j.end,$,i[O],b,I),A=!0}}}}return A}defines(){const i=[];for(const u in this.binders){const f=this.binders[u];(f instanceof Vf||f instanceof jf)&&i.push(...f.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return i}getBinderAttributes(){const i=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Uc||f instanceof yc||f instanceof Gh)for(let m=0;m<f.paintVertexAttributes.length;m++)i.push(f.paintVertexAttributes[m].name)}return i}getBinderUniforms(){const i=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Vf||f instanceof jf||f instanceof yc)for(const m of f.uniformNames)i.push(m)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const u=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof Vf||m instanceof jf||m instanceof yc)for(const b of m.uniformNames)u.push({name:b,property:f,binding:m.getBinding(i,b)})}return u}setUniforms(i,u,f,m,b){for(const{name:I,property:A,binding:O}of f)this.binders[A].setUniform(i,O,b,m.get(A),I)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const u=this.binders[i];(u instanceof Uc||u instanceof yc||u instanceof Gh)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(i){for(const u in this.binders){const f=this.binders[u];(f instanceof Uc||f instanceof yc||f instanceof Gh)&&f.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const u=this.binders[i];(u instanceof Uc||u instanceof yc||u instanceof Gh)&&u.destroy()}}}class ja{constructor(i,u,f=(()=>!0)){this.programConfigurations={};for(const m of i)this.programConfigurations[m.id]=new cf(m,u,f);this.needsUpload=!1,this._featureMap=new Uf,this._bufferOffset=0}populatePaintArrays(i,u,f,m,b,I,A){for(const O in this.programConfigurations)this.programConfigurations[O].populatePaintArrays(i,u,m,b,I,A);void 0!==u.id&&this._featureMap.add(u.id,f,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,u,f,m,b){for(const I of f)this.needsUpload=this.programConfigurations[I.id].updatePaintArrays(i,this._featureMap,u,I,m,b)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const hf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Os(s,i){return hf[s]||[s.replace(`${i}-`,"").replace(/-/g,"_")]}const Kv={"line-pattern":{source:Gt,composite:Gt},"fill-pattern":{source:Gt,composite:Gt},"fill-extrusion-pattern":{source:Gt,composite:Gt},"line-dasharray":{source:fn,composite:fn}},Gf={color:{source:pc,composite:gn},number:{source:us,composite:pc}};function ty(s,i,u){const f=Kv[s];return f&&f[u]||Gf[i][u]}Gn(Vf,"ConstantBinder"),Gn(jf,"PatternConstantBinder"),Gn(Uc,"SourceExpressionBinder"),Gn(Gh,"PatternCompositeBinder"),Gn(yc,"CompositeExpressionBinder"),Gn(cf,"ProgramConfiguration",{omit:["_buffers"]}),Gn(ja,"ProgramConfigurationSet");const ny="-transition";class _c extends Na{constructor(i,u){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==i.type&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&"sky"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),u.layout&&(this._unevaluatedLayout=new $e(u.layout)),u.paint)){this._transitionablePaint=new se(u.paint);for(const f in i.paint)this.setPaintProperty(f,i.paint[f],{validate:!1});for(const f in i.layout)this.setLayoutProperty(f,i.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new We(u.paint)}}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,u,f={}){null!=u&&this._validate(wt,`layers.${this.id}.layout.${i}`,i,u,f)||("visibility"!==i?this._unevaluatedLayout.setValue(i,u):this.visibility=u)}getPaintProperty(i){return jn(i,ny)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,u,f={}){if(null!=u&&this._validate(Ge,`layers.${this.id}.paint.${i}`,i,u,f))return!1;if(jn(i,ny))return this._transitionablePaint.setTransition(i.slice(0,-11),u||void 0),!1;{const m=this._transitionablePaint._values[i],b=m.value.isDataDriven(),I=m.value;this._transitionablePaint.setValue(i,u),this._handleSpecialPaintPropertyUpdate(i);const A=this._transitionablePaint._values[i].value,O=A.isDataDriven(),N=jn(i,"pattern")||"line-dasharray"===i;return O||b||N||this._handleOverridablePaintPropertyUpdate(i,I,A)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,u,f){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,u){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,u)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Nn(i,(u,f)=>!(void 0===u||"layout"===f&&!Object.keys(u).length||"paint"===f&&!Object.keys(u).length))}_validate(i,u,f,m,b={}){return(!b||!1!==b.validate)&&nn(this,i.call(pe,{key:u,layerType:this.type,objectKey:f,value:m,styleSpec:on,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const u=this.paint.get(i);if(u instanceof je&&Fc(u.property.specification)&&("source"===u.value.kind||"composite"===u.value.kind)&&u.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Vh(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const x_=Rt([{name:"a_pos",components:2,type:"Int16"}],4),Vg=Rt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ns{constructor(i=[]){this.segments=i}prepareSegment(i,u,f,m){let b=this.segments[this.segments.length-1];return i>Ns.MAX_VERTEX_ARRAY_LENGTH&&Sr(`Max vertices per segment is ${Ns.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!b||b.vertexLength+i>Ns.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==m)&&(b={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},void 0!==m&&(b.sortKey=m),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const i of this.segments)for(const u in i.vaos)i.vaos[u].destroy()}static simpleSegment(i,u,f,m){return new Ns([{vertexOffset:i,primitiveOffset:u,vertexLength:f,primitiveLength:m,vaos:{},sortKey:0}])}}Ns.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Gn(Ns,"SegmentVector");var Ir=8192;class Kc{constructor(i,u){i&&(u?this.setSouthWest(i).setNorthEast(u):4===i.length?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof cs?new cs(i.lng,i.lat):cs.convert(i),this}setSouthWest(i){return this._sw=i instanceof cs?new cs(i.lng,i.lat):cs.convert(i),this}extend(i){const u=this._sw,f=this._ne;let m,b;if(i instanceof cs)m=i,b=i;else{if(!(i instanceof Kc))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(Kc.convert(i)):this.extend(cs.convert(i)):"object"==typeof i&&null!==i&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(cs.convert(i)):this;if(m=i._sw,b=i._ne,!m||!b)return this}return u||f?(u.lng=Math.min(m.lng,u.lng),u.lat=Math.min(m.lat,u.lat),f.lng=Math.max(b.lng,f.lng),f.lat=Math.max(b.lat,f.lat)):(this._sw=new cs(m.lng,m.lat),this._ne=new cs(b.lng,b.lat)),this}getCenter(){return new cs((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new cs(this.getWest(),this.getNorth())}getSouthEast(){return new cs(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:u,lat:f}=cs.convert(i);let m=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&m}static convert(i){return!i||i instanceof Kc?i:new Kc(i)}}var md=1e-6,sl=typeof Float32Array<"u"?Float32Array:Array;function Hp(){var s=new sl(9);return sl!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function Rl(s,i,u){var f=i[0],m=i[1],b=i[2],I=i[3],A=i[4],O=i[5],N=i[6],j=i[7],$=i[8],W=u[0],Q=u[1],ie=u[2],ge=u[3],De=u[4],Ye=u[5],ht=u[6],Ke=u[7],ut=u[8];return s[0]=W*f+Q*I+ie*N,s[1]=W*m+Q*A+ie*j,s[2]=W*b+Q*O+ie*$,s[3]=ge*f+De*I+Ye*N,s[4]=ge*m+De*A+Ye*j,s[5]=ge*b+De*O+Ye*$,s[6]=ht*f+Ke*I+ut*N,s[7]=ht*m+Ke*A+ut*j,s[8]=ht*b+Ke*O+ut*$,s}function fu(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function ry(s,i){var u=i[0],f=i[1],m=i[2],b=i[3],I=i[4],A=i[5],O=i[6],N=i[7],j=i[8],$=i[9],W=i[10],Q=i[11],ie=i[12],ge=i[13],De=i[14],Ye=i[15],ht=u*A-f*I,Ke=u*O-m*I,ut=u*N-b*I,xt=f*O-m*A,_t=f*N-b*A,Kt=m*N-b*O,Wt=j*ge-$*ie,hn=j*De-W*ie,On=j*Ye-Q*ie,tn=$*De-W*ge,dn=$*Ye-Q*ge,mn=W*Ye-Q*De,In=ht*mn-Ke*dn+ut*tn+xt*On-_t*hn+Kt*Wt;return In?(s[0]=(A*mn-O*dn+N*tn)*(In=1/In),s[1]=(m*dn-f*mn-b*tn)*In,s[2]=(ge*Kt-De*_t+Ye*xt)*In,s[3]=(W*_t-$*Kt-Q*xt)*In,s[4]=(O*On-I*mn-N*hn)*In,s[5]=(u*mn-m*On+b*hn)*In,s[6]=(De*ut-ie*Kt-Ye*Ke)*In,s[7]=(j*Kt-W*ut+Q*Ke)*In,s[8]=(I*dn-A*On+N*Wt)*In,s[9]=(f*On-u*dn-b*Wt)*In,s[10]=(ie*_t-ge*ut+Ye*ht)*In,s[11]=($*ut-j*_t-Q*ht)*In,s[12]=(A*hn-I*tn-O*Wt)*In,s[13]=(u*tn-f*hn+m*Wt)*In,s[14]=(ge*Ke-ie*xt-De*ht)*In,s[15]=(j*xt-$*Ke+W*ht)*In,s):null}function Jc(s,i,u){var f=i[0],m=i[1],b=i[2],I=i[3],A=i[4],O=i[5],N=i[6],j=i[7],$=i[8],W=i[9],Q=i[10],ie=i[11],ge=i[12],De=i[13],Ye=i[14],ht=i[15],Ke=u[0],ut=u[1],xt=u[2],_t=u[3];return s[0]=Ke*f+ut*A+xt*$+_t*ge,s[1]=Ke*m+ut*O+xt*W+_t*De,s[2]=Ke*b+ut*N+xt*Q+_t*Ye,s[3]=Ke*I+ut*j+xt*ie+_t*ht,s[4]=(Ke=u[4])*f+(ut=u[5])*A+(xt=u[6])*$+(_t=u[7])*ge,s[5]=Ke*m+ut*O+xt*W+_t*De,s[6]=Ke*b+ut*N+xt*Q+_t*Ye,s[7]=Ke*I+ut*j+xt*ie+_t*ht,s[8]=(Ke=u[8])*f+(ut=u[9])*A+(xt=u[10])*$+(_t=u[11])*ge,s[9]=Ke*m+ut*O+xt*W+_t*De,s[10]=Ke*b+ut*N+xt*Q+_t*Ye,s[11]=Ke*I+ut*j+xt*ie+_t*ht,s[12]=(Ke=u[12])*f+(ut=u[13])*A+(xt=u[14])*$+(_t=u[15])*ge,s[13]=Ke*m+ut*O+xt*W+_t*De,s[14]=Ke*b+ut*N+xt*Q+_t*Ye,s[15]=Ke*I+ut*j+xt*ie+_t*ht,s}function Qc(s,i,u){var f,m,b,I,A,O,N,j,$,W,Q,ie,ge=u[0],De=u[1],Ye=u[2];return i===s?(s[12]=i[0]*ge+i[4]*De+i[8]*Ye+i[12],s[13]=i[1]*ge+i[5]*De+i[9]*Ye+i[13],s[14]=i[2]*ge+i[6]*De+i[10]*Ye+i[14],s[15]=i[3]*ge+i[7]*De+i[11]*Ye+i[15]):(m=i[1],b=i[2],I=i[3],A=i[4],O=i[5],N=i[6],j=i[7],$=i[8],W=i[9],Q=i[10],ie=i[11],s[0]=f=i[0],s[1]=m,s[2]=b,s[3]=I,s[4]=A,s[5]=O,s[6]=N,s[7]=j,s[8]=$,s[9]=W,s[10]=Q,s[11]=ie,s[12]=f*ge+A*De+$*Ye+i[12],s[13]=m*ge+O*De+W*Ye+i[13],s[14]=b*ge+N*De+Q*Ye+i[14],s[15]=I*ge+j*De+ie*Ye+i[15]),s}function eh(s,i,u){var f=u[0],m=u[1],b=u[2];return s[0]=i[0]*f,s[1]=i[1]*f,s[2]=i[2]*f,s[3]=i[3]*f,s[4]=i[4]*m,s[5]=i[5]*m,s[6]=i[6]*m,s[7]=i[7]*m,s[8]=i[8]*b,s[9]=i[9]*b,s[10]=i[10]*b,s[11]=i[11]*b,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s}function iy(s,i,u){var f=Math.sin(u),m=Math.cos(u),b=i[4],I=i[5],A=i[6],O=i[7],N=i[8],j=i[9],$=i[10],W=i[11];return i!==s&&(s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[4]=b*m+N*f,s[5]=I*m+j*f,s[6]=A*m+$*f,s[7]=O*m+W*f,s[8]=N*m-b*f,s[9]=j*m-I*f,s[10]=$*m-A*f,s[11]=W*m-O*f,s}function yd(s,i,u){var f=Math.sin(u),m=Math.cos(u),b=i[0],I=i[1],A=i[2],O=i[3],N=i[8],j=i[9],$=i[10],W=i[11];return i!==s&&(s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=b*m-N*f,s[1]=I*m-j*f,s[2]=A*m-$*f,s[3]=O*m-W*f,s[8]=b*f+N*m,s[9]=I*f+j*m,s[10]=A*f+$*m,s[11]=O*f+W*m,s}function Jv(s,i){return s[0]=i[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=i[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function oy(s,i,u){var f,m,b,I=u[0],A=u[1],O=u[2],N=Math.hypot(I,A,O);return N<md?null:(I*=N=1/N,A*=N,O*=N,f=Math.sin(i),m=Math.cos(i),s[0]=I*I*(b=1-m)+m,s[1]=A*I*b+O*f,s[2]=O*I*b-A*f,s[3]=0,s[4]=I*A*b-O*f,s[5]=A*A*b+m,s[6]=O*A*b+I*f,s[7]=0,s[8]=I*O*b+A*f,s[9]=A*O*b-I*f,s[10]=O*O*b+m,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,i=arguments.length;i--;)s+=arguments[i]*arguments[i];return Math.sqrt(s)});var Jd=Jc;function Qd(){var s=new sl(3);return sl!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Qv(s){var i=new sl(3);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i}function _d(s){return Math.hypot(s[0],s[1],s[2])}function $h(s,i,u){var f=new sl(3);return f[0]=s,f[1]=i,f[2]=u,f}function th(s,i,u){return s[0]=i[0]+u[0],s[1]=i[1]+u[1],s[2]=i[2]+u[2],s}function vd(s,i,u){return s[0]=i[0]-u[0],s[1]=i[1]-u[1],s[2]=i[2]-u[2],s}function xd(s,i,u){return s[0]=i[0]*u[0],s[1]=i[1]*u[1],s[2]=i[2]*u[2],s}function qh(s,i,u){return s[0]=Math.min(i[0],u[0]),s[1]=Math.min(i[1],u[1]),s[2]=Math.min(i[2],u[2]),s}function wd(s,i,u){return s[0]=Math.max(i[0],u[0]),s[1]=Math.max(i[1],u[1]),s[2]=Math.max(i[2],u[2]),s}function vc(s,i,u){return s[0]=i[0]*u,s[1]=i[1]*u,s[2]=i[2]*u,s}function bd(s,i,u,f){return s[0]=i[0]+u[0]*f,s[1]=i[1]+u[1]*f,s[2]=i[2]+u[2]*f,s}function Vu(s,i){var u=i[0],f=i[1],m=i[2],b=u*u+f*f+m*m;return b>0&&(b=1/Math.sqrt(b)),s[0]=i[0]*b,s[1]=i[1]*b,s[2]=i[2]*b,s}function ou(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]}function Wp(s,i,u){var f=i[0],m=i[1],b=i[2],I=u[0],A=u[1],O=u[2];return s[0]=m*O-b*A,s[1]=b*I-f*O,s[2]=f*A-m*I,s}function ra(s,i,u){var f=i[0],m=i[1],b=i[2],I=u[3]*f+u[7]*m+u[11]*b+u[15];return s[0]=(u[0]*f+u[4]*m+u[8]*b+u[12])/(I=I||1),s[1]=(u[1]*f+u[5]*m+u[9]*b+u[13])/I,s[2]=(u[2]*f+u[6]*m+u[10]*b+u[14])/I,s}function Xp(s,i,u){var f=u[0],m=u[1],b=u[2],I=i[0],A=i[1],O=i[2],N=m*O-b*A,j=b*I-f*O,$=f*A-m*I,W=m*$-b*j,Q=b*N-f*$,ie=f*j-m*N,ge=2*u[3];return j*=ge,$*=ge,Q*=2,ie*=2,s[0]=I+(N*=ge)+(W*=2),s[1]=A+j+Q,s[2]=O+$+ie,s}var xc,wc=vd,jg=xd,e0=_d;function Gg(s,i,u){return s[0]=i[0]*u,s[1]=i[1]*u,s[2]=i[2]*u,s[3]=i[3]*u,s}function sy(s,i){var u=i[0],f=i[1],m=i[2],b=i[3],I=u*u+f*f+m*m+b*b;return I>0&&(I=1/Math.sqrt(I)),s[0]=u*I,s[1]=f*I,s[2]=m*I,s[3]=b*I,s}function $f(s,i,u){var f=i[0],m=i[1],b=i[2],I=i[3];return s[0]=u[0]*f+u[4]*m+u[8]*b+u[12]*I,s[1]=u[1]*f+u[5]*m+u[9]*b+u[13]*I,s[2]=u[2]*f+u[6]*m+u[10]*b+u[14]*I,s[3]=u[3]*f+u[7]*m+u[11]*b+u[15]*I,s}function yh(){var s=new sl(4);return sl!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function $g(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function Ed(s,i,u){u*=.5;var f=i[0],m=i[1],b=i[2],I=i[3],A=Math.sin(u),O=Math.cos(u);return s[0]=f*O+I*A,s[1]=m*O+b*A,s[2]=b*O-m*A,s[3]=I*O-f*A,s}function Hh(s,i,u){u*=.5;var f=i[0],m=i[1],b=i[2],I=i[3],A=Math.sin(u),O=Math.cos(u);return s[0]=f*O-b*A,s[1]=m*O+I*A,s[2]=b*O+f*A,s[3]=I*O-m*A,s}Qd(),xc=new sl(4),sl!=Float32Array&&(xc[0]=0,xc[1]=0,xc[2]=0,xc[3]=0);var qg=sy;Qd(),$h(1,0,0),$h(0,1,0),yh(),yh(),Hp();const Cd=Rt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:si}=Cd,Wh=Rt([{name:"a_pos_3",components:3,type:"Int16"}]);var Sd=Rt([{name:"a_pos",type:"Int16",components:2}]);class Xh{constructor(i,u){this.pos=i,this.dir=u}intersectsPlane(i,u,f){const m=ou(u,this.dir);if(Math.abs(m)<1e-6)return!1;const b=((i[0]-this.pos[0])*u[0]+(i[1]-this.pos[1])*u[1]+(i[2]-this.pos[2])*u[2])/m;return f[0]=this.pos[0]+this.dir[0]*b,f[1]=this.pos[1]+this.dir[1]*b,f[2]=this.pos[2]+this.dir[2]*b,!0}closestPointOnSphere(i,u,f){if(ge=(Q=this.pos)[0],De=Q[1],Ye=Q[2],ht=(ie=i)[0],Ke=ie[1],ut=ie[2],Math.abs(ge-ht)<=md*Math.max(1,Math.abs(ge),Math.abs(ht))&&Math.abs(De-Ke)<=md*Math.max(1,Math.abs(De),Math.abs(Ke))&&Math.abs(Ye-ut)<=md*Math.max(1,Math.abs(Ye),Math.abs(ut))||0===u)return f[0]=f[1]=f[2]=0,!1;var Q,ie,ge,De,Ye,ht,Ke,ut;const[m,b,I]=this.dir,A=this.pos[0]-i[0],O=this.pos[1]-i[1],N=this.pos[2]-i[2],j=m*m+b*b+I*I,$=2*(A*m+O*b+N*I),W=$*$-4*j*(A*A+O*O+N*N-u*u);if(W<0){const Q=Math.max(-$/2,0),ie=A+m*Q,ge=O+b*Q,De=N+I*Q,Ye=Math.hypot(ie,ge,De);return f[0]=ie*u/Ye,f[1]=ge*u/Ye,f[2]=De*u/Ye,!1}{const Q=(-$-Math.sqrt(W))/(2*j);if(Q<0){const ie=Math.hypot(A,O,N);return f[0]=A*u/ie,f[1]=O*u/ie,f[2]=N*u/ie,!1}return f[0]=A+m*Q,f[1]=O+b*Q,f[2]=N+I*Q,!0}}}class Zp{constructor(i,u,f,m,b){this.TL=i,this.TR=u,this.BR=f,this.BL=m,this.horizon=b}static fromInvProjectionMatrix(i,u,f){const m=[-1,1,1],b=[1,1,1],I=[1,-1,1],A=[-1,-1,1],O=ra(m,m,i),N=ra(b,b,i),j=ra(I,I,i),$=ra(A,A,i);return new Zp(O,N,j,$,u/f)}}class Yp{constructor(i,u){this.points=i,this.planes=u}static fromInvProjectionMatrix(i,u,f,m){const b=Math.pow(2,f),I=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(O=>{const N=$f([],O,i),j=1/N[3]/u*b;return($=N)[0]=(W=N)[0]*(Q=[j,j,m?1/N[3]:j,j])[0],$[1]=W[1]*Q[1],$[2]=W[2]*Q[2],$[3]=W[3]*Q[3],$;var $,W,Q}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(O=>{const N=Vu([],Wp([],wc([],I[O[0]],I[O[1]]),wc([],I[O[2]],I[O[1]]))),j=-ou(N,I[O[1]]);return N.concat(j)});return new Yp(I,A)}}class al{static fromPoints(i){const u=[1/0,1/0,1/0],f=[-1/0,-1/0,-1/0];for(const m of i)qh(u,u,m),wd(f,f,m);return new al(u,f)}static applyTransform(i,u){const f=i.getCorners();for(let m=0;m<f.length;++m)ra(f[m],f[m],u);return al.fromPoints(f)}constructor(i,u){this.min=i,this.max=u,this.center=vc([],th([],this.min,this.max),.5)}quadrant(i){const u=[i%2==0,i<2],f=Qv(this.min),m=Qv(this.max);for(let b=0;b<u.length;b++)f[b]=u[b]?this.min[b]:this.center[b],m[b]=u[b]?this.center[b]:this.max[b];return m[2]=this.max[2],new al(f,m)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,u=this.max;return[[i[0],i[1],i[2]],[u[0],i[1],i[2]],[u[0],u[1],i[2]],[i[0],u[1],i[2]],[i[0],i[1],u[2]],[u[0],i[1],u[2]],[u[0],u[1],u[2]],[i[0],u[1],u[2]]]}intersects(i){const u=this.getCorners();let f=!0;for(let m=0;m<i.planes.length;m++){const b=i.planes[m];let I=0;for(let A=0;A<u.length;A++)I+=ou(b,u[A])+b[3]>=0;if(0===I)return 0;I!==u.length&&(f=!1)}if(f)return 2;for(let m=0;m<3;m++){let b=Number.MAX_VALUE,I=-Number.MAX_VALUE;for(let A=0;A<i.points.length;A++){const O=i.points[A][m]-this.min[m];b=Math.min(b,O),I=Math.max(I,O)}if(I<0||b>this.max[m]-this.min[m])return 0}return 1}}const du=5,Id=6,Yl=Ir/Math.PI/2,Td=16383,Hf=[64,32,16],vl=-Yl,_h=Yl,t0=[new al([vl,vl,vl],[_h,_h,_h]),new al([vl,vl,vl],[0,0,_h]),new al([0,vl,vl],[_h,0,_h]),new al([vl,0,vl],[0,_h,_h]),new al([0,0,vl],[_h,_h,_h])];function vh(s){return s*Yl/Vc}function Kl(s,i,u,f=!0){const m=vc([],s._camera.position,s.worldSize),b=[i,u,1,1];$f(b,b,s.pixelMatrixInverse),Gg(b,b,1/b[3]);const I=Vu([],wc([],b,m)),A=s.globeMatrix,O=[A[12],A[13],A[14]],N=wc([],O,m),j=_d(N),$=Vu([],N),W=s.worldSize/(2*Math.PI),Q=ou($,I),ie=Math.asin(W/j);if(ie<Math.acos(Q)){if(!f)return null;const On=[],tn=[];vc(On,I,j/Q),Vu(tn,wc(tn,On,N)),Vu(I,th(I,N,vc(I,tn,Math.tan(ie)*j)))}const ge=[];new Xh(m,I).closestPointOnSphere(O,W,ge);const De=Vu([],et(A,0)),Ye=Vu([],et(A,1)),ht=Vu([],et(A,2)),Ke=ou(De,ge),ut=ou(Ye,ge),xt=ou(ht,ge),_t=He(Math.asin(-ut/W));let Kt=He(Math.atan2(Ke,xt));Kt=s.center.lng+function(On,tn){const dn=(tn-On+180)%360-180;return dn<-180?dn+360:dn}(s.center.lng,Kt);const Wt=Yh(Kt),hn=Le(Kh(_t),0,1);return new mf(Wt,hn)}class w_{constructor(i,u,f){this.a=wc([],i,f),this.b=wc([],u,f),this.center=f;const m=Vu([],this.a),b=Vu([],this.b);this.angle=Math.acos(ou(m,b))}}function b_(s,i){if(0===s.angle)return null;let u;return u=0===s.a[i]?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[i]/s.a[i]/Math.sin(s.angle)-1/Math.tan(s.angle)),u<0||u>1?null:function(f,m,b,I){const A=Math.sin(b);return f*(Math.sin((1-I)*b)/A)+m*(Math.sin(I*b)/A)}(s.a[i],s.b[i],s.angle,Le(u,0,1))+s.center[i]}function xh(s){if(s.z<=1)return t0[s.z+2*s.y+s.x];const i=ay(Ga(s));return al.fromPoints(i)}function ep(s,i,u){return vc(s,s,1-u),bd(s,s,i,u)}function tp(s,i){const u=pf(i.zoom);if(0===u)return xh(s);const f=Ga(s),m=ay(f),b=Yh(f.getWest())*i.worldSize,I=Yh(f.getEast())*i.worldSize,A=Kh(f.getNorth())*i.worldSize,O=Kh(f.getSouth())*i.worldSize,N=[b,A,0],j=[I,A,0],$=[b,O,0],W=[I,O,0],Q=ry([],i.globeMatrix);return ra(N,N,Q),ra(j,j,Q),ra($,$,Q),ra(W,W,Q),m[0]=ep(m[0],$,u),m[1]=ep(m[1],W,u),m[2]=ep(m[2],j,u),m[3]=ep(m[3],N,u),al.fromPoints(m)}function Kp(s,i,u){for(const f of s)ra(f,f,i),vc(f,f,u)}function Ga({x:s,y:i,z:u}){const f=1/(1<<u),m=new cs(Ql(s*f),pu((i+1)*f)),b=new cs(Ql((s+1)*f),pu(i*f));return new Kc(m,b)}function ay(s){const i=Je(s.getNorth()),u=Je(s.getSouth()),f=Math.cos(i),m=Math.cos(u),b=Math.sin(i),I=Math.sin(u),A=s.getWest(),O=s.getEast();return[Zh(m,I,A),Zh(m,I,O),Zh(f,b,O),Zh(f,b,A)]}function Zh(s,i,u,f=Yl){return u=Je(u),[s*Math.sin(u)*f,-i*f,s*Math.cos(u)*f]}function np(s,i,u){return Zh(Math.cos(Je(s)),Math.sin(Je(s)),i,u)}function Ll(s,i,u,f){const m=1<<u.z,b=(s/Ir+u.x)/m;return np(pu((i/Ir+u.y)/m),Ql(b),f)}function ff({min:s,max:i}){return Td/Math.max(i[0]-s[0],i[1]-s[1],i[2]-s[2])}const Hg=new Float64Array(16);function Wf(s){const i=ff(s),u=Jv(Hg,[i,i,i]);return Qc(u,u,((f=[])[0]=-(m=s.min)[0],f[1]=-m[1],f[2]=-m[2],f));var f,m}function df(s){const i=(f=s.min,(u=Hg)[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=f[0],u[13]=f[1],u[14]=f[2],u[15]=1,u);var u,f;const m=1/ff(s);return eh(i,i,[m,m,m])}function uy(s,i,u,f,m){const b=function(O){const N=Ir/(2*Math.PI);return O/(2*Math.PI)/N}(u),I=[s,i,-u/(2*Math.PI)],A=fu(new Float64Array(16));return Qc(A,A,I),eh(A,A,[b,b,b]),iy(A,A,Je(-m)),yd(A,A,Je(-f)),A}function pf(s){return bt(du,Id,s)}function Wg(s,i){const u=np(i.lat,i.lng);return I=(m=vd([],function(ie){const ge=np(ie._center.lat,ie._center.lng);let De=Wp([],$h(0,1,0),ge);const Ye=oy([],-ie.angle,ge);De=ra(De,De,Ye),oy(Ye,-ie._pitch,De);const ht=Vu([],ge);return vc(ht,ht,vh(ie.cameraToCenterDistance/ie.pixelsPerMeter)),ra(ht,ht,Ye),th([],ge,ht)}(s),u))[0],A=m[1],O=m[2],N=(b=u)[0],j=b[1],$=b[2],Q=(W=Math.sqrt(I*I+A*A+O*O)*Math.sqrt(N*N+j*j+$*$))&&ou(m,b)/W,Math.acos(Math.min(Math.max(Q,-1),1));var m,b,I,A,O,N,j,$,W,Q}function ly(s,i){return Wg(s,i)>Math.PI/2*1.01}const Jl=Je(85),rp=Math.cos(Jl),Md=Math.sin(Jl),Vc=6371008.8,gf=2*Math.PI*Vc;class Xf{constructor(i,u){if(isNaN(i)||isNaN(u))throw new Error(`Invalid LngLat object: (${i}, ${u})`);if(this.lng=+i,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Xf(Ue(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const u=Math.PI/180,f=this.lat*u,m=i.lat*u,b=Math.sin(f)*Math.sin(m)+Math.cos(f)*Math.cos(m)*Math.cos((i.lng-this.lng)*u);return Vc*Math.acos(Math.min(b,1))}toBounds(i=0){const u=360*i/40075017,f=u/Math.cos(Math.PI/180*this.lat);return new Kc(new Xf(this.lng-f,this.lat-u),new Xf(this.lng+f,this.lat+u))}toEcef(i){const u=vh(i);return np(this.lat,this.lng,Yl+u)}static convert(i){if(i instanceof Xf)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new Xf(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new Xf(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var cs=Xf;function cy(s){return gf*Math.cos(s*Math.PI/180)}function Yh(s){return(180+s)/360}function Kh(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function wh(s,i){return s/cy(i)}function Ql(s){return 360*s-180}function pu(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function E_(s,i){return s*cy(pu(i))}const gu=85.051129;function C_(s){return 1/Math.cos(s*Math.PI/180)}class mf{constructor(i,u,f=0){this.x=+i,this.y=+u,this.z=+f}static fromLngLat(i,u=0){const f=cs.convert(i);return new mf(Yh(f.lng),Kh(f.lat),wh(u,f.lat))}toLngLat(){return new cs(Ql(this.x),pu(this.y))}toAltitude(){return E_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/gf*C_(pu(this.y))}}function hy(s,i,u,f,m,b,I,A,O){const N=(i+f)/2,j=(u+m)/2,$=new te(N,j);A($),function(W,Q,ie,ge,De,Ye){const ht=ie-De,Ke=ge-Ye;return Math.abs((ge-Q)*ht-(ie-W)*Ke)/Math.hypot(ht,Ke)}($.x,$.y,b.x,b.y,I.x,I.y)>=O?(hy(s,i,u,N,j,b,$,A,O),hy(s,N,j,f,m,$,I,A,O)):s.push(I)}function Xg(s,i,u){let f=s[0],m=f.x,b=f.y;i(f);const I=[f];for(let A=1;A<s.length;A++){const O=s[A],{x:N,y:j}=O;i(O),hy(I,m,b,N,j,f,O,i,u),m=N,b=j,f=O}return I}function ip(s,i,u,f){if(f(i,u)){const m=i.add(u)._mult(.5);ip(s,i,m,f),ip(s,m,u,f)}else s.push(u)}function Jp(s,i){let u=s[0];const f=[u];for(let m=1;m<s.length;m++){const b=s[m];ip(f,u,b,i),u=b}return f}const Zg=Math.pow(2,14)-1,S_=-Zg-1;function r0(s,i){const u=Math.round(s.x*i),f=Math.round(s.y*i);return s.x=Le(u,S_,Zg),s.y=Le(f,S_,Zg),(u<s.x||u>s.x+1||f<s.y||f>s.y+1)&&Sr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function ec(s,i,u){const f=s.loadGeometry(),m=s.extent,b=Ir/m;if(i&&u&&u.projection.isReprojectedInTileSpace){const I=1<<i.z,{scale:A,x:O,y:N,projection:j}=u,$=W=>{const Q=Ql((i.x+W.x/m)/I),ie=pu((i.y+W.y/m)/I),ge=j.project(Q,ie);W.x=(ge.x*A-O)*m,W.y=(ge.y*A-N)*m};for(let W=0;W<f.length;W++)if(1!==s.type)f[W]=Xg(f[W],$,1);else{const Q=[];for(const ie of f[W])ie.x<0||ie.x>=m||ie.y<0||ie.y>=m||($(ie),Q.push(ie));f[W]=Q}}for(const I of f)for(const A of I)r0(A,b);return f}function bh(s,i){return{type:s.type,id:s.id,properties:s.properties,geometry:i?ec(s):[]}}function Yg(s,i,u,f,m){s.emplaceBack(2*i+(f+1)/2,2*u+(m+1)/2)}function fy(s,i,u){s.emplaceBack(i.x,i.y,i.z,16384*u[0],16384*u[1],16384*u[2])}class Kg{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new Dn,this.indexArray=new yr,this.segments=new Ns,this.programConfigurations=new ja(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,f,m){const b=this.layers[0],I=[];let A=null;"circle"===b.type&&(A=b.layout.get("circle-sort-key"));for(const{feature:N,id:j,index:$,sourceLayerIndex:W}of i){const Q=this.layers[0]._featureFilter.needGeometry,ie=bh(N,Q);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),ie,f))continue;const ge=A?A.evaluate(ie,{},f):void 0,De={id:j,properties:N.properties,type:N.type,sourceLayerIndex:W,index:$,geometry:Q?ie.geometry:ec(N,f,m),patterns:{},sortKey:ge};I.push(De)}A&&I.sort((N,j)=>N.sortKey-j.sortKey);let O=null;"globe"===m.projection.name&&(this.globeExtVertexArray=new En,O=m.projection);for(const N of I){const{geometry:j,index:$,sourceLayerIndex:W}=N,Q=i[$].feature;this.addFeature(N,j,$,u.availableImages,f,O),u.featureIndex.insert(Q,j,$,W,this.index)}}update(i,u,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,f,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,x_.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,Vg.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,u,f,m,b,I){for(const A of u)for(const O of A){const N=O.x,j=O.y;if(N<0||N>=Ir||j<0||j>=Ir)continue;if(I){const Q=I.projectTilePoint(N,j,b),ie=I.upVector(b,N,j),ge=this.globeExtVertexArray;fy(ge,Q,ie),fy(ge,Q,ie),fy(ge,Q,ie),fy(ge,Q,ie)}const $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),W=$.vertexLength;Yg(this.layoutVertexArray,N,j,-1,-1),Yg(this.layoutVertexArray,N,j,1,-1),Yg(this.layoutVertexArray,N,j,1,1),Yg(this.layoutVertexArray,N,j,-1,1),this.indexArray.emplaceBack(W,W+1,W+2),this.indexArray.emplaceBack(W,W+2,W+3),$.vertexLength+=4,$.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,{},m,b)}}function I_(s,i){for(let u=0;u<s.length;u++)if(op(i,s[u]))return!0;for(let u=0;u<i.length;u++)if(op(s,i[u]))return!0;return!!dy(s,i)}function J1(s,i,u){return!!op(s,i)||!!Qp(i,s,u)}function jc(s,i){if(1===s.length)return py(i,s[0]);for(let u=0;u<i.length;u++){const f=i[u];for(let m=0;m<f.length;m++)if(op(s,f[m]))return!0}for(let u=0;u<s.length;u++)if(py(i,s[u]))return!0;for(let u=0;u<i.length;u++)if(dy(s,i[u]))return!0;return!1}function o0(s,i,u){if(s.length>1){if(dy(s,i))return!0;for(let f=0;f<i.length;f++)if(Qp(i[f],s,u))return!0}for(let f=0;f<s.length;f++)if(Qp(s[f],i,u))return!0;return!1}function dy(s,i){if(0===s.length||0===i.length)return!1;for(let u=0;u<s.length-1;u++){const f=s[u],m=s[u+1];for(let b=0;b<i.length-1;b++)if(Jg(f,m,i[b],i[b+1]))return!0}return!1}function Jg(s,i,u,f){return Oi(s,u,f)!==Oi(i,u,f)&&Oi(s,i,u)!==Oi(s,i,f)}function Qp(s,i,u){const f=u*u;if(1===i.length)return s.distSqr(i[0])<f;for(let m=1;m<i.length;m++)if(T_(s,i[m-1],i[m])<f)return!0;return!1}function T_(s,i,u){const f=i.distSqr(u);if(0===f)return s.distSqr(i);const m=((s.x-i.x)*(u.x-i.x)+(s.y-i.y)*(u.y-i.y))/f;return s.distSqr(m<0?i:m>1?u:u.sub(i)._mult(m)._add(i))}function py(s,i){let u,f,m,b=!1;for(let I=0;I<s.length;I++){u=s[I];for(let A=0,O=u.length-1;A<u.length;O=A++)f=u[A],m=u[O],f.y>i.y!=m.y>i.y&&i.x<(m.x-f.x)*(i.y-f.y)/(m.y-f.y)+f.x&&(b=!b)}return b}function op(s,i){let u=!1;for(let f=0,m=s.length-1;f<s.length;m=f++){const b=s[f],I=s[m];b.y>i.y!=I.y>i.y&&i.x<(I.x-b.x)*(i.y-b.y)/(I.y-b.y)+b.x&&(u=!u)}return u}function gy(s,i,u,f,m){for(const I of s)if(i<=I.x&&u<=I.y&&f>=I.x&&m>=I.y)return!0;const b=[new te(i,u),new te(i,m),new te(f,m),new te(f,u)];if(s.length>2)for(const I of b)if(op(s,I))return!0;for(let I=0;I<s.length-1;I++)if(M_(s[I],s[I+1],b))return!0;return!1}function M_(s,i,u){const f=u[0],m=u[2];if(s.x<f.x&&i.x<f.x||s.x>m.x&&i.x>m.x||s.y<f.y&&i.y<f.y||s.y>m.y&&i.y>m.y)return!1;const b=Oi(s,i,u[0]);return b!==Oi(s,i,u[1])||b!==Oi(s,i,u[2])||b!==Oi(s,i,u[3])}function sp(s,i,u){const f=i.paint.get(s).value;return"constant"===f.kind?f.value:u.programConfigurations.get(i.id).getMaxValue(s)}function Qg(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function em(s,i,u,f,m){if(!i[0]&&!i[1])return s;const b=te.convert(i)._mult(m);"viewport"===u&&b._rotate(-f);const I=[];for(let A=0;A<s.length;A++)I.push(s[A].sub(b));return I}function s0(s,i,u,f){const m=te.convert(s)._mult(f);return"viewport"===i&&m._rotate(-u),m}Gn(Kg,"CircleBucket",{omit:["layers"]});const Q1=new Qe({"circle-sort-key":new Fe(on.layout_circle["circle-sort-key"])});var my={paint:new Qe({"circle-radius":new Fe(on.paint_circle["circle-radius"]),"circle-color":new Fe(on.paint_circle["circle-color"]),"circle-blur":new Fe(on.paint_circle["circle-blur"]),"circle-opacity":new Fe(on.paint_circle["circle-opacity"]),"circle-translate":new ue(on.paint_circle["circle-translate"]),"circle-translate-anchor":new ue(on.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ue(on.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ue(on.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fe(on.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fe(on.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fe(on.paint_circle["circle-stroke-opacity"])}),layout:Q1};function a0(s,i,u,f,m,b,I,A,O){if(b&&s.queryGeometry.isAboveHorizon)return!1;b&&(O*=s.pixelToTileUnitsFactor);const N=s.tileID.canonical,j=u.projection.upVectorScale(N,u.center.lat,u.worldSize).metersToTile;for(const $ of i)for(const W of $){const Q=W.add(A),ie=m&&u.elevation?u.elevation.exaggeration()*m.getElevationAt(Q.x,Q.y,!0):0,ge=u.projection.projectTilePoint(Q.x,Q.y,N);if(ie>0){const Ke=u.projection.upVector(N,Q.x,Q.y);ge.x+=Ke[0]*j*ie,ge.y+=Ke[1]*j*ie,ge.z+=Ke[2]*j*ie}const De=b?Q:ex(ge.x,ge.y,ge.z,f),Ye=b?s.tilespaceRays.map(Ke=>nx(Ke,ie)):s.queryGeometry.screenGeometry,ht=$f([],[ge.x,ge.y,ge.z,1],f);if(!I&&b?O*=ht[3]/u.cameraToCenterDistance:I&&!b&&(O*=u.cameraToCenterDistance/ht[3]),b){const Ke=pu((W.y/Ir+N.y)/(1<<N.z));O/=u.projection.pixelsPerMeter(Ke,1)/wh(1,Ke)}if(J1(Ye,De,O))return!0}return!1}function ex(s,i,u,f){const m=$f([],[s,i,u,1],f);return new te(m[0]/m[3],m[1]/m[3])}const u0=$h(0,0,0),tx=$h(0,0,1);function nx(s,i){const u=Qd();return u0[2]=i,s.intersectsPlane(u0,tx,u),new te(u[0],u[1])}class D_ extends Kg{}function eg(s,{width:i,height:u},f,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==i*u*f)throw new RangeError("mismatched image size")}else m=new Uint8Array(i*u*f);return s.width=i,s.height=u,s.data=m,s}function tm(s,i,u){const{width:f,height:m}=i;f===s.width&&m===s.height||(nm(s,i,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,f),height:Math.min(s.height,m)},u),s.width=f,s.height=m,s.data=i.data)}function nm(s,i,u,f,m,b){if(0===m.width||0===m.height)return i;if(m.width>s.width||m.height>s.height||u.x>s.width-m.width||u.y>s.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>i.width||m.height>i.height||f.x>i.width-m.width||f.y>i.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const I=s.data,A=i.data;for(let O=0;O<m.height;O++){const N=((u.y+O)*s.width+u.x)*b,j=((f.y+O)*i.width+f.x)*b;for(let $=0;$<m.width*b;$++)A[j+$]=I[N+$]}return i}Gn(D_,"HeatmapBucket",{omit:["layers"]});class Jh{constructor(i,u){eg(this,i,1,u)}resize(i){tm(this,new Jh(i),1)}clone(){return new Jh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,u,f,m,b){nm(i,u,f,m,b,1)}}class tc{constructor(i,u){eg(this,i,4,u)}resize(i){tm(this,new tc(i),4)}replace(i,u){u?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new tc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,u,f,m,b){nm(i,u,f,m,b,4)}}Gn(Jh,"AlphaImage"),Gn(tc,"RGBAImage");var ap={paint:new Qe({"heatmap-radius":new Fe(on.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fe(on.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ue(on.paint_heatmap["heatmap-intensity"]),"heatmap-color":new nt(on.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ue(on.paint_heatmap["heatmap-opacity"])})};function rm(s){const i={},u=s.resolution||256,f=s.clips?s.clips.length:1,m=s.image||new tc({width:u,height:f}),b=(I,A,O)=>{i[s.evaluationKey]=O;const N=s.expression.evaluate(i);m.data[I+A+0]=Math.floor(255*N.r/N.a),m.data[I+A+1]=Math.floor(255*N.g/N.a),m.data[I+A+2]=Math.floor(255*N.b/N.a),m.data[I+A+3]=Math.floor(255*N.a)};if(s.clips)for(let I=0,A=0;I<f;++I,A+=4*u)for(let O=0,N=0;O<u;O++,N+=4){const j=O/(u-1),{start:$,end:W}=s.clips[I];b(A,N,$*(1-j)+W*j)}else for(let I=0,A=0;I<u;I++,A+=4)b(0,A,I/(u-1));return m}var im={paint:new Qe({"hillshade-illumination-direction":new ue(on.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ue(on.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ue(on.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ue(on.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ue(on.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ue(on.paint_hillshade["hillshade-accent-color"])})};const up=Rt([{name:"a_pos",components:2,type:"Int16"}],4),{members:nc}=up;var yy={exports:{}};function om(s,i,u){u=u||2;var f,m,b,I,A,O,N,j=i&&i.length,$=j?i[0]*u:s.length,W=A_(s,0,$,u,!0),Q=[];if(!W||W.next===W.prev)return Q;if(j&&(W=function(ge,De,Ye,ht){var Ke,ut,xt,_t=[];for(Ke=0,ut=De.length;Ke<ut;Ke++)(xt=A_(ge,De[Ke]*ht,Ke<ut-1?De[Ke+1]*ht:ge.length,ht,!1))===xt.next&&(xt.steiner=!0),_t.push(P_(xt));for(_t.sort(f0),Ke=0;Ke<_t.length;Ke++)Ye=sm(_t[Ke],Ye);return Ye}(s,i,W,u)),s.length>80*u){f=b=s[0],m=I=s[1];for(var ie=u;ie<$;ie+=u)(A=s[ie])<f&&(f=A),(O=s[ie+1])<m&&(m=O),A>b&&(b=A),O>I&&(I=O);N=0!==(N=Math.max(b-f,I-m))?32767/N:0}return Dd(W,Q,u,f,m,N,0),Q}function A_(s,i,u,f,m){var b,I;if(m===by(s,i,u,f)>0)for(b=i;b<u;b+=f)I=R_(b,s[b],s[b+1],I);else for(b=u-f;b>=i;b-=f)I=R_(b,s[b],s[b+1],I);return I&&ng(I,I.next)&&(lp(I),I=I.next),I}function Zf(s,i){if(!s)return s;i||(i=s);var u,f=s;do{if(u=!1,f.steiner||!ng(f,f.next)&&0!==ia(f.prev,f,f.next))f=f.next;else{if(lp(f),(f=i=f.prev)===f.next)break;u=!0}}while(u||f!==i);return i}function Dd(s,i,u,f,m,b,I){if(s){!I&&b&&function(j,$,W,Q){var ie=j;do{0===ie.z&&(ie.z=tg(ie.x,ie.y,$,W,Q)),ie.prevZ=ie.prev,ie.nextZ=ie.next,ie=ie.next}while(ie!==j);ie.prevZ.nextZ=null,ie.prevZ=null,function(ge){var De,Ye,ht,Ke,ut,xt,_t,Kt,Wt=1;do{for(Ye=ge,ge=null,ut=null,xt=0;Ye;){for(xt++,ht=Ye,_t=0,De=0;De<Wt&&(_t++,ht=ht.nextZ);De++);for(Kt=Wt;_t>0||Kt>0&&ht;)0!==_t&&(0===Kt||!ht||Ye.z<=ht.z)?(Ke=Ye,Ye=Ye.nextZ,_t--):(Ke=ht,ht=ht.nextZ,Kt--),ut?ut.nextZ=Ke:ge=Ke,Ke.prevZ=ut,ut=Ke;Ye=ht}ut.nextZ=null,Wt*=2}while(xt>1)}(ie)}(s,f,m,b);for(var A,O,N=s;s.prev!==s.next;)if(A=s.prev,O=s.next,b?c0(s,f,m,b):l0(s))i.push(A.i/u|0),i.push(s.i/u|0),i.push(O.i/u|0),lp(s),s=O.next,N=O.next;else if((s=O)===N){I?1===I?Dd(s=h0(Zf(s),i,u),i,u,f,m,b,2):2===I&&_y(s,i,u,f,m,b):Dd(Zf(s),i,u,f,m,b,1);break}}}function l0(s){var i=s.prev,u=s,f=s.next;if(ia(i,u,f)>=0)return!1;for(var m=i.x,b=u.x,I=f.x,A=i.y,O=u.y,N=f.y,j=m<b?m<I?m:I:b<I?b:I,$=A<O?A<N?A:N:O<N?O:N,W=m>b?m>I?m:I:b>I?b:I,Q=A>O?A>N?A:N:O>N?O:N,ie=f.next;ie!==i;){if(ie.x>=j&&ie.x<=W&&ie.y>=$&&ie.y<=Q&&Yf(m,A,b,O,I,N,ie.x,ie.y)&&ia(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function c0(s,i,u,f){var m=s.prev,b=s,I=s.next;if(ia(m,b,I)>=0)return!1;for(var A=m.x,O=b.x,N=I.x,j=m.y,$=b.y,W=I.y,Q=A<O?A<N?A:N:O<N?O:N,ie=j<$?j<W?j:W:$<W?$:W,ge=A>O?A>N?A:N:O>N?O:N,De=j>$?j>W?j:W:$>W?$:W,Ye=tg(Q,ie,i,u,f),ht=tg(ge,De,i,u,f),Ke=s.prevZ,ut=s.nextZ;Ke&&Ke.z>=Ye&&ut&&ut.z<=ht;){if(Ke.x>=Q&&Ke.x<=ge&&Ke.y>=ie&&Ke.y<=De&&Ke!==m&&Ke!==I&&Yf(A,j,O,$,N,W,Ke.x,Ke.y)&&ia(Ke.prev,Ke,Ke.next)>=0||(Ke=Ke.prevZ,ut.x>=Q&&ut.x<=ge&&ut.y>=ie&&ut.y<=De&&ut!==m&&ut!==I&&Yf(A,j,O,$,N,W,ut.x,ut.y)&&ia(ut.prev,ut,ut.next)>=0))return!1;ut=ut.nextZ}for(;Ke&&Ke.z>=Ye;){if(Ke.x>=Q&&Ke.x<=ge&&Ke.y>=ie&&Ke.y<=De&&Ke!==m&&Ke!==I&&Yf(A,j,O,$,N,W,Ke.x,Ke.y)&&ia(Ke.prev,Ke,Ke.next)>=0)return!1;Ke=Ke.prevZ}for(;ut&&ut.z<=ht;){if(ut.x>=Q&&ut.x<=ge&&ut.y>=ie&&ut.y<=De&&ut!==m&&ut!==I&&Yf(A,j,O,$,N,W,ut.x,ut.y)&&ia(ut.prev,ut,ut.next)>=0)return!1;ut=ut.nextZ}return!0}function h0(s,i,u){var f=s;do{var m=f.prev,b=f.next.next;!ng(m,b)&&vy(m,f,f.next,b)&&ig(m,b)&&ig(b,m)&&(i.push(m.i/u|0),i.push(f.i/u|0),i.push(b.i/u|0),lp(f),lp(f.next),f=s=b),f=f.next}while(f!==s);return Zf(f)}function _y(s,i,u,f,m,b){var I=s;do{for(var A=I.next.next;A!==I.prev;){if(I.i!==A.i&&Ol(I,A)){var O=xy(I,A);return I=Zf(I,I.next),O=Zf(O,O.next),Dd(I,i,u,f,m,b,0),void Dd(O,i,u,f,m,b,0)}A=A.next}I=I.next}while(I!==s)}function f0(s,i){return s.x-i.x}function sm(s,i){var u=function(m,b){var I,A=b,O=m.x,N=m.y,j=-1/0;do{if(N<=A.y&&N>=A.next.y&&A.next.y!==A.y){var $=A.x+(N-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if($<=O&&$>j&&(j=$,I=A.x<A.next.x?A:A.next,$===O))return I}A=A.next}while(A!==b);if(!I)return null;var W,Q=I,ie=I.x,ge=I.y,De=1/0;A=I;do{O>=A.x&&A.x>=ie&&O!==A.x&&Yf(N<ge?O:j,N,ie,ge,N<ge?j:O,N,A.x,A.y)&&(W=Math.abs(N-A.y)/(O-A.x),ig(A,m)&&(W<De||W===De&&(A.x>I.x||A.x===I.x&&bc(I,A)))&&(I=A,De=W)),A=A.next}while(A!==Q);return I}(s,i);if(!u)return i;var f=xy(u,s);return Zf(f,f.next),Zf(u,u.next)}function bc(s,i){return ia(s.prev,s,i.prev)<0&&ia(i.next,s,s.next)<0}function tg(s,i,u,f,m){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-u)*m|0)|s<<8))|s<<4))|s<<2))|s<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-f)*m|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function P_(s){var i=s,u=s;do{(i.x<u.x||i.x===u.x&&i.y<u.y)&&(u=i),i=i.next}while(i!==s);return u}function Yf(s,i,u,f,m,b,I,A){return(m-I)*(i-A)>=(s-I)*(b-A)&&(s-I)*(f-A)>=(u-I)*(i-A)&&(u-I)*(b-A)>=(m-I)*(f-A)}function Ol(s,i){return s.next.i!==i.i&&s.prev.i!==i.i&&!function(u,f){var m=u;do{if(m.i!==u.i&&m.next.i!==u.i&&m.i!==f.i&&m.next.i!==f.i&&vy(m,m.next,u,f))return!0;m=m.next}while(m!==u);return!1}(s,i)&&(ig(s,i)&&ig(i,s)&&function(u,f){var m=u,b=!1,I=(u.x+f.x)/2,A=(u.y+f.y)/2;do{m.y>A!=m.next.y>A&&m.next.y!==m.y&&I<(m.next.x-m.x)*(A-m.y)/(m.next.y-m.y)+m.x&&(b=!b),m=m.next}while(m!==u);return b}(s,i)&&(ia(s.prev,s,i.prev)||ia(s,i.prev,i))||ng(s,i)&&ia(s.prev,s,s.next)>0&&ia(i.prev,i,i.next)>0)}function ia(s,i,u){return(i.y-s.y)*(u.x-i.x)-(i.x-s.x)*(u.y-i.y)}function ng(s,i){return s.x===i.x&&s.y===i.y}function vy(s,i,u,f){var m=rg(ia(s,i,u)),b=rg(ia(s,i,f)),I=rg(ia(u,f,s)),A=rg(ia(u,f,i));return m!==b&&I!==A||!(0!==m||!am(s,u,i))||!(0!==b||!am(s,f,i))||!(0!==I||!am(u,s,f))||!(0!==A||!am(u,i,f))}function am(s,i,u){return i.x<=Math.max(s.x,u.x)&&i.x>=Math.min(s.x,u.x)&&i.y<=Math.max(s.y,u.y)&&i.y>=Math.min(s.y,u.y)}function rg(s){return s>0?1:s<0?-1:0}function ig(s,i){return ia(s.prev,s,s.next)<0?ia(s,i,s.next)>=0&&ia(s,s.prev,i)>=0:ia(s,i,s.prev)<0||ia(s,s.next,i)<0}function xy(s,i){var u=new wy(s.i,s.x,s.y),f=new wy(i.i,i.x,i.y),m=s.next,b=i.prev;return s.next=i,i.prev=s,u.next=m,m.prev=u,f.next=u,u.prev=f,b.next=f,f.prev=b,f}function R_(s,i,u,f){var m=new wy(s,i,u);return f?(m.next=f.next,m.prev=f,f.next.prev=m,f.next=m):(m.prev=m,m.next=m),m}function lp(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function wy(s,i,u){this.i=s,this.x=i,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function by(s,i,u,f){for(var m=0,b=i,I=u-f;b<u;b+=f)m+=(s[I]-s[b])*(s[b+1]+s[I+1]),I=b;return m}yy.exports=om,yy.exports.default=om,om.deviation=function(s,i,u,f){var m=i&&i.length,b=Math.abs(by(s,0,m?i[0]*u:s.length,u));if(m)for(var I=0,A=i.length;I<A;I++)b-=Math.abs(by(s,i[I]*u,I<A-1?i[I+1]*u:s.length,u));var O=0;for(I=0;I<f.length;I+=3){var N=f[I]*u,j=f[I+1]*u,$=f[I+2]*u;O+=Math.abs((s[N]-s[$])*(s[j+1]-s[N+1])-(s[N]-s[j])*(s[$+1]-s[N+1]))}return 0===b&&0===O?0:Math.abs((O-b)/b)},om.flatten=function(s){for(var i=s[0][0].length,u={vertices:[],holes:[],dimensions:i},f=0,m=0;m<s.length;m++){for(var b=0;b<s[m].length;b++)for(var I=0;I<i;I++)u.vertices.push(s[m][b][I]);m>0&&u.holes.push(f+=s[m-1].length)}return u};var cp=K(yy.exports);function um(s,i,u,f,m){L_(s,i,u||0,f||s.length-1,m||d0)}function L_(s,i,u,f,m){for(;f>u;){if(f-u>600){var b=f-u+1,I=i-u+1,A=Math.log(b),O=.5*Math.exp(2*A/3),N=.5*Math.sqrt(A*O*(b-O)/b)*(I-b/2<0?-1:1);L_(s,i,Math.max(u,Math.floor(i-I*O/b+N)),Math.min(f,Math.floor(i+(b-I)*O/b+N)),m)}var j=s[i],$=u,W=f;for(yf(s,u,i),m(s[f],j)>0&&yf(s,u,f);$<W;){for(yf(s,$,W),$++,W--;m(s[$],j)<0;)$++;for(;m(s[W],j)>0;)W--}0===m(s[u],j)?yf(s,u,W):yf(s,++W,f),W<=i&&(u=W+1),i<=W&&(f=W-1)}}function yf(s,i,u){var f=s[i];s[i]=s[u],s[u]=f}function d0(s,i){return s<i?-1:s>i?1:0}function Ey(s,i){const u=s.length;if(u<=1)return[s];const f=[];let m,b;for(let I=0;I<u;I++){const A=ar(s[I]);0!==A&&(s[I].area=Math.abs(A),void 0===b&&(b=A<0),b===A<0?(m&&f.push(m),m=[s[I]]):m.push(s[I]))}if(m&&f.push(m),i>1)for(let I=0;I<f.length;I++)f[I].length<=i||(um(f[I],i,1,f[I].length-1,hp),f[I]=f[I].slice(0,i));return f}function hp(s,i){return i.area-s.area}function og(s,i,u){const f=u.patternDependencies;let m=!1;for(const b of i){const I=b.paint.get(`${s}-pattern`);I.isConstant()||(m=!0);const A=I.constantOr(null);A&&(m=!0,f[A]=!0)}return m}function lm(s,i,u,f,m){const b=m.patternDependencies;for(const I of i){const A=I.paint.get(`${s}-pattern`).value;if("constant"!==A.kind){let O=A.evaluate({zoom:f},u,{},m.availableImages);O=O&&O.name?O.name:O,b[O]=!0,u.patterns[I.id]=O}}return u}class _f{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Dn,this.indexArray=new yr,this.indexArray2=new Iu,this.programConfigurations=new ja(i.layers,i.zoom),this.segments=new Ns,this.segments2=new Ns,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.projection=i.projection}populate(i,u,f,m){this.hasPattern=og("fill",this.layers,u);const b=this.layers[0].layout.get("fill-sort-key"),I=[];for(const{feature:A,id:O,index:N,sourceLayerIndex:j}of i){const $=this.layers[0]._featureFilter.needGeometry,W=bh(A,$);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),W,f))continue;const Q=b?b.evaluate(W,{},f,u.availableImages):void 0,ie={id:O,properties:A.properties,type:A.type,sourceLayerIndex:j,index:N,geometry:$?W.geometry:ec(A,f,m),patterns:{},sortKey:Q};I.push(ie)}b&&I.sort((A,O)=>A.sortKey-O.sortKey);for(const A of I){const{geometry:O,index:N,sourceLayerIndex:j}=A;if(this.hasPattern){const $=lm("fill",this.layers,A,this.zoom,u);this.patternFeatures.push($)}else this.addFeature(A,O,N,f,{},u.availableImages);u.featureIndex.insert(i[N].feature,O,N,j,this.index)}}update(i,u,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,f,m)}addFeatures(i,u,f,m,b){for(const I of this.patternFeatures)this.addFeature(I,I.geometry,I.index,u,f,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,nc),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,u,f,m,b,I=[]){for(const A of Ey(u,500)){let O=0;for(const ie of A)O+=ie.length;const N=this.segments.prepareSegment(O,this.layoutVertexArray,this.indexArray),j=N.vertexLength,$=[],W=[];for(const ie of A){if(0===ie.length)continue;ie!==A[0]&&W.push($.length/2);const ge=this.segments2.prepareSegment(ie.length,this.layoutVertexArray,this.indexArray2),De=ge.vertexLength;this.layoutVertexArray.emplaceBack(ie[0].x,ie[0].y),this.indexArray2.emplaceBack(De+ie.length-1,De),$.push(ie[0].x),$.push(ie[0].y);for(let Ye=1;Ye<ie.length;Ye++)this.layoutVertexArray.emplaceBack(ie[Ye].x,ie[Ye].y),this.indexArray2.emplaceBack(De+Ye-1,De+Ye),$.push(ie[Ye].x),$.push(ie[Ye].y);ge.vertexLength+=ie.length,ge.primitiveLength+=ie.length}const Q=cp($,W);for(let ie=0;ie<Q.length;ie+=3)this.indexArray.emplaceBack(j+Q[ie],j+Q[ie+1],j+Q[ie+2]);N.vertexLength+=O,N.primitiveLength+=Q.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,b,I,m)}}Gn(_f,"FillBucket",{omit:["layers","patternFeatures"]});const cm=new Qe({"fill-sort-key":new Fe(on.layout_fill["fill-sort-key"])});var O_={paint:new Qe({"fill-antialias":new ue(on.paint_fill["fill-antialias"]),"fill-opacity":new Fe(on.paint_fill["fill-opacity"]),"fill-color":new Fe(on.paint_fill["fill-color"]),"fill-outline-color":new Fe(on.paint_fill["fill-outline-color"]),"fill-translate":new ue(on.paint_fill["fill-translate"]),"fill-translate-anchor":new ue(on.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fe(on.paint_fill["fill-pattern"])}),layout:cm};const Cy=Rt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),hm=Rt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),p0=Rt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:g0}=Cy;var fm={},m0=ae,sg=fp;function fp(s,i,u,f,m){this.properties={},this.extent=u,this.type=0,this._pbf=s,this._geometry=-1,this._keys=f,this._values=m,s.readFields(Sy,this,i)}function Sy(s,i,u){1==s?i.id=u.readVarint():2==s?function(f,m){for(var b=f.readVarint()+f.pos;f.pos<b;){var I=m._keys[f.readVarint()],A=m._values[f.readVarint()];m.properties[I]=A}}(u,i):3==s?i.type=u.readVarint():4==s&&(i._geometry=u.pos)}function dm(s){for(var i,u,f=0,m=0,b=s.length,I=b-1;m<b;I=m++)f+=((u=s[I]).x-(i=s[m]).x)*(i.y+u.y);return f}fp.types=["Unknown","Point","LineString","Polygon"],fp.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var i,u=s.readVarint()+s.pos,f=1,m=0,b=0,I=0,A=[];s.pos<u;){if(m<=0){var O=s.readVarint();f=7&O,m=O>>3}if(m--,1===f||2===f)b+=s.readSVarint(),I+=s.readSVarint(),1===f&&(i&&A.push(i),i=[]),i.push(new m0(b,I));else{if(7!==f)throw new Error("unknown command "+f);i&&i.push(i[0].clone())}}return i&&A.push(i),A},fp.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var i=s.readVarint()+s.pos,u=1,f=0,m=0,b=0,I=1/0,A=-1/0,O=1/0,N=-1/0;s.pos<i;){if(f<=0){var j=s.readVarint();u=7&j,f=j>>3}if(f--,1===u||2===u)(m+=s.readSVarint())<I&&(I=m),m>A&&(A=m),(b+=s.readSVarint())<O&&(O=b),b>N&&(N=b);else if(7!==u)throw new Error("unknown command "+u)}return[I,O,A,N]},fp.prototype.toGeoJSON=function(s,i,u){var f,m,b=this.extent*Math.pow(2,u),I=this.extent*s,A=this.extent*i,O=this.loadGeometry(),N=fp.types[this.type];function j(Q){for(var ie=0;ie<Q.length;ie++){var ge=Q[ie];Q[ie]=[360*(ge.x+I)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(ge.y+A)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var $=[];for(f=0;f<O.length;f++)$[f]=O[f][0];j(O=$);break;case 2:for(f=0;f<O.length;f++)j(O[f]);break;case 3:for(O=function(Q){var ie=Q.length;if(ie<=1)return[Q];for(var ge,De,Ye=[],ht=0;ht<ie;ht++){var Ke=dm(Q[ht]);0!==Ke&&(void 0===De&&(De=Ke<0),De===Ke<0?(ge&&Ye.push(ge),ge=[Q[ht]]):ge.push(Q[ht]))}return ge&&Ye.push(ge),Ye}(O),f=0;f<O.length;f++)for(m=0;m<O[f].length;m++)j(O[f][m])}1===O.length?O=O[0]:N="Multi"+N;var W={type:"Feature",geometry:{type:N,coordinates:O},properties:this.properties};return"id"in this&&(W.id=this.id),W};var pm=sg,ag=Iy;function Iy(s,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(N_,this,i),this.length=this._features.length}function N_(s,i,u){15===s?i.version=u.readVarint():1===s?i.name=u.readString():5===s?i.extent=u.readVarint():2===s?i._features.push(u.pos):3===s?i._keys.push(u.readString()):4===s&&i._values.push(function(f){for(var m=null,b=f.readVarint()+f.pos;f.pos<b;){var I=f.readVarint()>>3;m=1===I?f.readString():2===I?f.readFloat():3===I?f.readDouble():4===I?f.readVarint64():5===I?f.readVarint():6===I?f.readSVarint():7===I?f.readBoolean():null}return m}(u))}Iy.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var i=this._pbf.readVarint()+this._pbf.pos;return new pm(this._pbf,i,this.extent,this._keys,this._values)};var gm=ag;function k_(s,i,u){if(3===s){var f=new gm(u,u.readVarint()+u.pos);f.length&&(i[f.name]=f)}}var vf=fm.VectorTile=function(s,i){this.layers=s.readFields(k_,{},i)},ug=fm.VectorTileFeature=sg;function Kf(s,i,u,f){const m=[],b=0===f?(I,A,O,N,j,$)=>{I.push(new te($,O+($-A)/(N-A)*(j-O)))}:(I,A,O,N,j,$)=>{I.push(new te(A+($-O)/(j-O)*(N-A),$))};for(const I of s){const A=[];for(const O of I){if(O.length<=2)continue;const N=[];for(let W=0;W<O.length-1;W++){const Q=O[W].x,ie=O[W].y,ge=O[W+1].x,De=O[W+1].y,Ye=0===f?Q:ie,ht=0===f?ge:De;Ye<i?ht>i&&b(N,Q,ie,ge,De,i):Ye>u?ht<u&&b(N,Q,ie,ge,De,u):N.push(O[W]),ht<i&&Ye>=i&&b(N,Q,ie,ge,De,i),ht>u&&Ye<=u&&b(N,Q,ie,ge,De,u)}let j=O[O.length-1];const $=0===f?j.x:j.y;$>=i&&$<=u&&N.push(j),N.length&&(j=N[N.length-1],N[0].x===j.x&&N[0].y===j.y||N.push(N[0]),A.push(N))}A.length&&m.push(A)}return m}fm.VectorTileLayer=ag;const mm=ug.types,rx=Math.pow(2,13);function Jf(s,i,u,f,m,b,I,A){s.emplaceBack((i<<1)+I,(u<<1)+b,(Math.floor(f*rx)<<1)+m,Math.round(A))}function Ad(s,i,u){s.emplaceBack(i.x,i.y,i.z,16384*u[0],16384*u[1],16384*u[2])}class ym{constructor(){this.acc=new te(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new te(i.x,i.y),this.max=new te(i.x,i.y))}append(i,u){this.currentPolyCount.edges++,this.acc._add(i);const f=this.min,m=this.max;i.x<f.x?f.x=i.x:i.x>m.x&&(m.x=i.x),i.y<f.y?f.y=i.y:i.y>m.y&&(m.y=i.y),((0===i.x||i.x===Ir)&&i.x===u.x)!=((0===i.y||i.y===Ir)&&i.y===u.y)&&this.processBorderOverlap(i,u),u.x<0!=i.x<0&&this.addBorderIntersection(0,qn(u.y,i.y,(0-u.x)/(i.x-u.x))),u.x>Ir!=i.x>Ir&&this.addBorderIntersection(1,qn(u.y,i.y,(Ir-u.x)/(i.x-u.x))),u.y<0!=i.y<0&&this.addBorderIntersection(2,qn(u.x,i.x,(0-u.y)/(i.y-u.y))),u.y>Ir!=i.y>Ir&&this.addBorderIntersection(3,qn(u.x,i.x,(Ir-u.y)/(i.y-u.y)))}addBorderIntersection(i,u){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const f=this.borders[i];u<f[0]&&(f[0]=u),u>f[1]&&(f[1]=u)}processBorderOverlap(i,u){if(i.x===u.x){if(i.y===u.y)return;const f=0===i.x?0:1;this.addBorderIntersection(f,u.y),this.addBorderIntersection(f,i.y)}else{const f=0===i.y?2:3;this.addBorderIntersection(f,u.x),this.addBorderIntersection(f,i.x)}}centroid(){const i=this.polyCount.reduce((u,f)=>u+f.edges,0);return 0!==i?this.acc.div(i)._round():new te(0,0)}span(){return new te(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,u)=>i+ +(u[0]!==Number.MAX_VALUE),0)}}class dp{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.layoutVertexArray=new an,this.centroidVertexArray=new mc,this.indexArray=new yr,this.programConfigurations=new ja(i.layers,i.zoom),this.segments=new Ns,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.enableTerrain=i.enableTerrain}populate(i,u,f,m){this.features=[],this.hasPattern=og("fill-extrusion",this.layers,u),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(b){const I=Math.exp(Math.PI*(1-b.y/(1<<b.z)*2));return 80150034*I/(I*I+1)/Ir/(1<<b.z)}(f),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:b,id:I,index:A,sourceLayerIndex:O}of i){const N=this.layers[0]._featureFilter.needGeometry,j=bh(b,N);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),j,f))continue;const $={id:I,sourceLayerIndex:O,index:A,geometry:N?j.geometry:ec(b,f,m),properties:b.properties,type:b.type,patterns:{}},W=this.layoutVertexArray.length;this.hasPattern?this.features.push(lm("fill-extrusion",this.layers,$,this.zoom,u)):this.addFeature($,$.geometry,A,f,{},u.availableImages,m),u.featureIndex.insert(b,$.geometry,A,O,this.index,W)}this.sortBorders()}addFeatures(i,u,f,m,b){for(const I of this.features){const{geometry:A}=I;this.addFeature(I,A,I.index,u,f,m,b)}this.sortBorders()}update(i,u,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,f,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,g0),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,p0.members,!0))),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,hm.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,u,f,m,b,I,A){const O=[new te(0,0),new te(Ir,Ir)],N=A.projection,j="globe"===N.name,$=this.enableTerrain&&!j?new ym:null,W="Polygon"===mm[i.type];j&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new En);const Q=Ey(u,500);for(let Ye=Q.length-1;Ye>=0;Ye--){const ht=Q[Ye];(0===ht.length||(ie=ht[0]).every(Ke=>Ke.x<=0)||ie.every(Ke=>Ke.x>=Ir)||ie.every(Ke=>Ke.y<=0)||ie.every(Ke=>Ke.y>=Ir))&&Q.splice(Ye,1)}var ie;let ge;if(j)ge=cg(Q,O,m);else{ge=[];for(const Ye of Q)ge.push({polygon:Ye,bounds:O})}const De=W?this.edgeRadius:0;for(const{polygon:Ye,bounds:ht}of ge){let Ke=0,ut=0;for(const _t of Ye)W&&!_t[0].equals(_t[_t.length-1])&&_t.push(_t[0]),ut+=W?_t.length-1:_t.length;const xt=this.segments.prepareSegment((W?5:4)*ut,this.layoutVertexArray,this.indexArray);if(W){const _t=[],Kt=[];Ke=xt.vertexLength;for(const hn of Ye){let On,tn;hn.length&&hn!==Ye[0]&&Kt.push(_t.length/2),On=hn[1].sub(hn[0])._perp()._unit();for(let dn=1;dn<hn.length;dn++){const mn=hn[dn],In=hn[dn===hn.length-1?1:dn+1];let{x:Un,y:cn}=mn;if(De){tn=In.sub(mn)._perp()._unit();const Zn=On.add(tn)._unit(),nr=De*Math.min(4,1/(On.x*Zn.x+On.y*Zn.y));Un+=nr*Zn.x,cn+=nr*Zn.y,On=tn}Jf(this.layoutVertexArray,Un,cn,0,0,1,1,0),xt.vertexLength++,_t.push(mn.x,mn.y),j&&Ad(this.layoutVertexExtArray,N.projectTilePoint(Un,cn,m),N.upVector(m,Un,cn))}}const Wt=cp(_t,Kt);for(let hn=0;hn<Wt.length;hn+=3)this.indexArray.emplaceBack(Ke+Wt[hn],Ke+Wt[hn+2],Ke+Wt[hn+1]),xt.primitiveLength++}for(const _t of Ye){$&&_t.length&&$.startRing(_t[0]);let Kt,Wt,hn,On=_t.length>4&&pp(_t[_t.length-2],_t[0],_t[1]),tn=De?My(_t[_t.length-2],_t[0],_t[1],De):0;Wt=_t[1].sub(_t[0])._perp()._unit();let dn=!0;for(let mn=1,In=0;mn<_t.length;mn++){let Un=_t[mn-1],cn=_t[mn];const Zn=_t[mn===_t.length-1?1:mn+1];if($&&W&&$.currentPolyCount.top++,lg(cn,Un,ht)){De&&(Wt=Zn.sub(cn)._perp()._unit(),dn=!dn);continue}$&&$.append(cn,Un);const nr=cn.sub(Un)._perp(),Yn=nr.x/(Math.abs(nr.x)+Math.abs(nr.y)),xi=nr.y>0?1:0,Vn=Un.dist(cn);if(In+Vn>32768&&(In=0),De){hn=Zn.sub(cn)._perp()._unit();let ui=Dy(Un,cn,Zn,Ty(Wt,hn),De);isNaN(ui)&&(ui=0);const Fr=cn.sub(Un)._unit();Un=Un.add(Fr.mult(tn))._round(),cn=cn.add(Fr.mult(-ui))._round(),tn=ui,Wt=hn}const Mr=xt.vertexLength,yi=_t.length>4&&pp(Un,cn,Zn);let go=Ay(In,On,dn);if(Jf(this.layoutVertexArray,Un.x,Un.y,Yn,xi,0,0,go),Jf(this.layoutVertexArray,Un.x,Un.y,Yn,xi,0,1,go),In+=Vn,go=Ay(In,yi,!dn),On=yi,Jf(this.layoutVertexArray,cn.x,cn.y,Yn,xi,0,0,go),Jf(this.layoutVertexArray,cn.x,cn.y,Yn,xi,0,1,go),xt.vertexLength+=4,this.indexArray.emplaceBack(Mr+0,Mr+1,Mr+2),this.indexArray.emplaceBack(Mr+1,Mr+3,Mr+2),xt.primitiveLength+=2,De){const ui=Ke+(1===mn?_t.length-2:mn-2),Fr=1===mn?Ke:ui+1;if(this.indexArray.emplaceBack(Mr+1,ui,Mr+3),this.indexArray.emplaceBack(ui,Fr,Mr+3),xt.primitiveLength+=2,void 0===Kt&&(Kt=Mr),!lg(Zn,_t[mn],ht)){const oa=mn===_t.length-1?Kt:xt.vertexLength;this.indexArray.emplaceBack(Mr+2,Mr+3,oa),this.indexArray.emplaceBack(Mr+3,oa+1,oa),this.indexArray.emplaceBack(Mr+3,Fr,oa+1),xt.primitiveLength+=3}dn=!dn}if(j){const ui=this.layoutVertexExtArray,Fr=N.projectTilePoint(Un.x,Un.y,m),oa=N.projectTilePoint(cn.x,cn.y,m),wi=N.upVector(m,Un.x,Un.y),bi=N.upVector(m,cn.x,cn.y);Ad(ui,Fr,wi),Ad(ui,Fr,wi),Ad(ui,oa,bi),Ad(ui,oa,bi)}}W&&(Ke+=_t.length-1)}}if($&&$.polyCount.length>0){if($.borders){$.vertexArrayOffset=this.centroidVertexArray.length;const Ye=$.borders,ht=this.featuresOnBorder.push($)-1;for(let Ke=0;Ke<4;Ke++)Ye[Ke][0]!==Number.MAX_VALUE&&this.borders[Ke].push(ht)}this.encodeCentroid($.borders?void 0:$.centroid(),$)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,b,I,m)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((u,f)=>this.featuresOnBorder[u].borders[i][0]-this.featuresOnBorder[f].borders[i][0])}encodeCentroid(i,u,f=!0){let m,b;if(i)if(0!==i.y){const A=u.span()._mult(this.tileToMeter);m=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(A.x/10)),b=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(A.y/10))}else m=Math.ceil(7*(i.x+450)),b=0;else m=0,b=+f;let I=f?this.centroidVertexArray.length:u.vertexArrayOffset;for(const A of u.polyCount){f&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*A.edges+A.top);for(let O=0;O<A.top;O++)this.centroidVertexArray.emplace(I++,m,b);for(let O=0;O<2*A.edges;O++)this.centroidVertexArray.emplace(I++,0,b),this.centroidVertexArray.emplace(I++,m,b)}}}function Ty(s,i){const u=s.add(i)._unit();return s.x*u.x+s.y*u.y}function My(s,i,u,f){const m=i.sub(s)._perp()._unit(),b=u.sub(i)._perp()._unit();return Dy(s,i,u,Ty(m,b),f)}function Dy(s,i,u,f,m){const b=Math.sqrt(1-f*f);return Math.min(s.dist(i)/3,i.dist(u)/3,m*b/f)}function lg(s,i,u){return s.x<u[0].x&&i.x<u[0].x||s.x>u[1].x&&i.x>u[1].x||s.y<u[0].y&&i.y<u[0].y||s.y>u[1].y&&i.y>u[1].y}function pp(s,i,u){if(s.x<0||s.x>=Ir||i.x<0||i.x>=Ir||u.x<0||u.x>=Ir)return!1;const f=u.sub(i),m=f.perp(),b=s.sub(i);return(f.x*b.x+f.y*b.y)/Math.sqrt((f.x*f.x+f.y*f.y)*(b.x*b.x+b.y*b.y))>-.866&&m.x*b.x+m.y*b.y<0}function Ay(s,i,u){const f=i?2|s:-3&s;return u?1|f:-2&f}function _m(){const s=Math.PI/32,i=Math.tan(s),u=Vc;return u*Math.sqrt(1+2*i*i)-u}function cg(s,i,u){const f=1<<u.z,m=Ql(u.x/f),b=Ql((u.x+1)/f),I=pu(u.y/f),A=pu((u.y+1)/f);return function(O,N,j,$,W=0,Q){const ie=[];if(!O.length||!j||!$)return ie;const ge=(_t,Kt)=>{for(const Wt of _t)ie.push({polygon:Wt,bounds:Kt})},De=Math.ceil(Math.log2(j)),Ye=Math.ceil(Math.log2($)),ht=De-Ye,Ke=[];for(let _t=0;_t<Math.abs(ht);_t++)Ke.push(ht>0?0:1);for(let _t=0;_t<Math.min(De,Ye);_t++)Ke.push(0),Ke.push(1);let ut=O;if(ut=Kf(ut,N[0].y-W,N[1].y+W,1),ut=Kf(ut,N[0].x-W,N[1].x+W,0),!ut.length)return ie;const xt=[];for(Ke.length?xt.push({polygons:ut,bounds:N,depth:0}):ge(ut,N);xt.length;){const _t=xt.pop(),Kt=_t.depth,Wt=Ke[Kt],hn=_t.bounds[0],On=_t.bounds[1],tn=0===Wt?hn.x:hn.y,dn=0===Wt?On.x:On.y,mn=Q?Q(Wt,tn,dn):.5*(tn+dn),In=Kf(_t.polygons,tn-W,mn+W,Wt),Un=Kf(_t.polygons,mn-W,dn+W,Wt);if(In.length){const cn=[hn,new te(0===Wt?mn:On.x,1===Wt?mn:On.y)];Ke.length>Kt+1?xt.push({polygons:In,bounds:cn,depth:Kt+1}):ge(In,cn)}if(Un.length){const cn=[new te(0===Wt?mn:hn.x,1===Wt?mn:hn.y),On];Ke.length>Kt+1?xt.push({polygons:Un,bounds:cn,depth:Kt+1}):ge(Un,cn)}}return ie}(s,i,Math.ceil((b-m)/11.25),Math.ceil((I-A)/11.25),1,(O,N,j)=>{if(0===O)return.5*(N+j);{const $=pu((u.y+N/Ir)/f);return(Kh(.5*(pu((u.y+j/Ir)/f)+$))*f-u.y)*Ir}})}Gn(dp,"FillExtrusionBucket",{omit:["layers","features"]}),Gn(ym,"PartMetadata");const F_=new Qe({"fill-extrusion-edge-radius":new ue(on["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Py={paint:new Qe({"fill-extrusion-opacity":new ue(on["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fe(on["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ue(on["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ue(on["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fe(on["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Fe(on["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fe(on["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ue(on["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ue(on["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ue(on["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new ue(on["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:F_};function gp(s,i,u){var f=2*Math.PI*6378137/256/Math.pow(2,u);return[s*f-2*Math.PI*6378137/2,i*f-2*Math.PI*6378137/2]}class Ec{constructor(i,u,f){this.z=i,this.x=u,this.y=f,this.key=Eh(0,i,i,u,f)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,u){const f=(I=this.y,A=this.z,O=gp(256*(b=this.x),256*(I=Math.pow(2,A)-I-1),A),N=gp(256*(b+1),256*(I+1),A),O[0]+","+O[1]+","+N[0]+","+N[1]),m=function(b,I,A){let O,N="";for(let j=b;j>0;j--)O=1<<j-1,N+=(I&O?1:0)+(A&O?2:0);return N}(this.z,this.x,this.y);var b,I,A,O,N;return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===u?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",f)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ry{constructor(i,u){this.wrap=i,this.canonical=u,this.key=Eh(i,u.z,u.z,u.x,u.y)}}class Nl{constructor(i,u,f,m,b){this.overscaledZ=i,this.wrap=u,this.canonical=new Ec(f,+m,+b),this.key=0===u&&i===f?this.canonical.key:Eh(u,i,f,m,b)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const u=this.canonical.z-i;return i>this.canonical.z?new Nl(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Nl(i,this.wrap,i,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(i,u=!0){if(this.overscaledZ===i&&u)return this.key;if(i>this.canonical.z)return Eh(this.wrap*+u,i,this.canonical.z,this.canonical.x,this.canonical.y);{const f=this.canonical.z-i;return Eh(this.wrap*+u,i,i,this.canonical.x>>f,this.canonical.y>>f)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const u=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>u&&i.canonical.y===this.canonical.y>>u}children(i){if(this.overscaledZ>=i)return[new Nl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,f=2*this.canonical.x,m=2*this.canonical.y;return[new Nl(u,this.wrap,u,f,m),new Nl(u,this.wrap,u,f+1,m),new Nl(u,this.wrap,u,f,m+1),new Nl(u,this.wrap,u,f+1,m+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Nl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Nl(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ry(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Eh(s,i,u,f,m){const b=1<<Math.min(u,22);let I=b*(m%b)+f%b;return s&&u<22&&(I+=b*b*((s<0?-2*s-1:2*s)%(1<<2*(22-u)))),16*(32*I+u)+(i-u)}Gn(Ec,"CanonicalTileID"),Gn(Nl,"OverscaledTileID",{omit:["projMatrix"]});class Ii extends te{constructor(i,u,f){super(i,u),this.z=f}}function mp(s,i){return s.x*i.x+s.y*i.y}function kl(s,i){if(1===s.length){let u=0;const f=i[u++];let m;for(;!m||f.equals(m);)if(m=i[u++],!m)return 1/0;for(;u<i.length;u++){const b=i[u],I=s[0],A=m.sub(f),O=b.sub(f),N=I.sub(f),j=mp(A,A),$=mp(A,O),W=mp(O,O),Q=mp(N,A),ie=mp(N,O),ge=j*W-$*$,De=(W*Q-$*ie)/ge,Ye=(j*ie-$*Q)/ge,ht=f.z*(1-De-Ye)+m.z*De+b.z*Ye;if(isFinite(ht))return ht}return 1/0}{let u=1/0;for(const f of i)u=Math.min(u,f.z);return u}}function Ea(s,i,u,f,m,b,I,A){const O=I*m.getElevationAt(s,i,!0,!0),N=0!==b[0],j=N?0===b[1]?I*(b[0]/7-450):I*function($,W,Q){const ie=Math.floor(W[0]/8),ge=Math.floor(W[1]/8),De=10*(W[0]-8*ie),Ye=10*(W[1]-8*ge),ht=$.getElevationAt(ie,ge,!0,!0),Ke=$.getMeterToDEM(Q),ut=Math.floor(.5*(De*Ke-1)),xt=Math.floor(.5*(Ye*Ke-1)),_t=$.tileCoordToPixel(ie,ge),Kt=2*ut+1,Wt=2*xt+1,hn=(nr=Kt,Yn=Wt,[(Un=$).getElevationAtPixel(cn=_t.x-ut,Zn=_t.y-xt,!0),Un.getElevationAtPixel(cn+Yn,Zn,!0),Un.getElevationAtPixel(cn,Zn+Yn,!0),Un.getElevationAtPixel(cn+nr,Zn+Yn,!0)]),On=Math.abs(hn[0]-hn[1]),tn=Math.abs(hn[2]-hn[3]),dn=Math.abs(hn[0]-hn[2])+Math.abs(hn[1]-hn[3]),mn=Math.min(.25,.5*Ke*(On+tn)/Kt),In=Math.min(.25,.5*Ke*dn/Wt);var Un,cn,Zn,nr,Yn;return ht+Math.max(mn*De,In*Ye)}(m,b,A):O;return{base:O+(0===u)?-1:u,top:N?Math.max(j+f,O+u+2):O+f}}const Ly=Rt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Gc}=Ly,y0=Rt([{name:"a_packed",components:4,type:"Float32"}]),{members:_0}=y0,ix=ug.types,v0=Math.cos(Math.PI/180*37.5);class yp{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Ht,this.layoutVertexArray2=new gn,this.indexArray=new yr,this.programConfigurations=new ja(i.layers,i.zoom),this.segments=new Ns,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,f,m){this.hasPattern=og("line",this.layers,u);const b=this.layers[0].layout.get("line-sort-key"),I=[];for(const{feature:j,id:$,index:W,sourceLayerIndex:Q}of i){const ie=this.layers[0]._featureFilter.needGeometry,ge=bh(j,ie);if(!this.layers[0]._featureFilter.filter(new G(this.zoom),ge,f))continue;const De=b?b.evaluate(ge,{},f):void 0,Ye={id:$,properties:j.properties,type:j.type,sourceLayerIndex:Q,index:W,geometry:ie?ge.geometry:ec(j,f,m),patterns:{},sortKey:De};I.push(Ye)}b&&I.sort((j,$)=>j.sortKey-$.sortKey);const{lineAtlas:A,featureIndex:O}=u,N=this.addConstantDashes(A);for(const j of I){const{geometry:$,index:W,sourceLayerIndex:Q}=j;if(N&&this.addFeatureDashes(j,A),this.hasPattern){const ie=lm("line",this.layers,j,this.zoom,u);this.patternFeatures.push(ie)}else this.addFeature(j,$,W,f,A.positions,u.availableImages);O.insert(i[W].feature,$,W,Q,this.index)}}addConstantDashes(i){let u=!1;for(const f of this.layers){const m=f.paint.get("line-dasharray").value,b=f.layout.get("line-cap").value;if("constant"!==m.kind||"constant"!==b.kind)u=!0;else{const I=b.value,A=m.value;if(!A)continue;i.addDash(A,I)}}return u}addFeatureDashes(i,u){const f=this.zoom;for(const m of this.layers){const b=m.paint.get("line-dasharray").value,I=m.layout.get("line-cap").value;if("constant"===b.kind&&"constant"===I.kind)continue;let A,O;if("constant"===b.kind){if(A=b.value,!A)continue}else A=b.evaluate({zoom:f},i);O="constant"===I.kind?I.value:I.evaluate({zoom:f},i),u.addDash(A,O),i.patterns[m.id]=u.getKey(A,O)}}update(i,u,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,f,m)}addFeatures(i,u,f,m,b){for(const I of this.patternFeatures)this.addFeature(I,I.geometry,I.index,u,f,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,_0)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Gc),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,u,f,m,b,I){const A=this.layers[0].layout,O=A.get("line-join").evaluate(i,{}),N=A.get("line-cap").evaluate(i,{}),j=A.get("line-miter-limit"),$=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const W of u)this.addLine(W,i,O,N,j,$);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,b,I,m)}addLine(i,u,f,m,b,I){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ye=0;Ye<i.length-1;Ye++)this.totalDistance+=i[Ye].dist(i[Ye+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A="Polygon"===ix[u.type];let O=i.length;for(;O>=2&&i[O-1].equals(i[O-2]);)O--;let N=0;for(;N<O-1&&i[N].equals(i[N+1]);)N++;if(O<(A?3:2))return;"bevel"===f&&(b=1.05);const j=this.overscaling<=16?15*Ir/(512*this.overscaling):0,$=this.segments.prepareSegment(10*O,this.layoutVertexArray,this.indexArray);let W,Q,ie,ge,De;this.e1=this.e2=-1,A&&(W=i[O-2],De=i[N].sub(W)._unit()._perp());for(let Ye=N;Ye<O;Ye++){if(ie=Ye===O-1?A?i[N+1]:void 0:i[Ye+1],ie&&i[Ye].equals(ie))continue;De&&(ge=De),W&&(Q=W),W=i[Ye],De=ie?ie.sub(W)._unit()._perp():ge,ge=ge||De;let ht=ge.add(De);0===ht.x&&0===ht.y||ht._unit();const Ke=ge.x*De.x+ge.y*De.y,ut=ht.x*De.x+ht.y*De.y,xt=0!==ut?1/ut:1/0,_t=2*Math.sqrt(2-2*ut),Kt=ut<v0&&Q&&ie,Wt=ge.x*De.y-ge.y*De.x>0;if(Kt&&Ye>N){const tn=W.dist(Q);if(tn>2*j){const dn=W.sub(W.sub(Q)._mult(j/tn)._round());this.updateDistance(Q,dn),this.addCurrentVertex(dn,ge,0,0,$),Q=dn}}const hn=Q&&ie;let On=hn?f:A?"butt":m;if(hn&&"round"===On&&(xt<I?On="miter":xt<=2&&(On="fakeround")),"miter"===On&&xt>b&&(On="bevel"),"bevel"===On&&(xt>2&&(On="flipbevel"),xt<b&&(On="miter")),Q&&this.updateDistance(Q,W),"miter"===On)ht._mult(xt),this.addCurrentVertex(W,ht,0,0,$);else if("flipbevel"===On){if(xt>100)ht=De.mult(-1);else{const tn=xt*ge.add(De).mag()/ge.sub(De).mag();ht._perp()._mult(tn*(Wt?-1:1))}this.addCurrentVertex(W,ht,0,0,$),this.addCurrentVertex(W,ht.mult(-1),0,0,$)}else if("bevel"===On||"fakeround"===On){const tn=-Math.sqrt(xt*xt-1),dn=Wt?tn:0,mn=Wt?0:tn;if(Q&&this.addCurrentVertex(W,ge,dn,mn,$),"fakeround"===On){const In=Math.round(180*_t/Math.PI/20);for(let Un=1;Un<In;Un++){let cn=Un/In;if(.5!==cn){const nr=cn-.5;cn+=cn*nr*(cn-1)*((1.0904+Ke*(Ke*(3.55645-1.43519*Ke)-3.2452))*nr*nr+(.848013+Ke*(.215638*Ke-1.06021)))}const Zn=De.sub(ge)._mult(cn)._add(ge)._unit()._mult(Wt?-1:1);this.addHalfVertex(W,Zn.x,Zn.y,!1,Wt,0,$)}}ie&&this.addCurrentVertex(W,De,-dn,-mn,$)}else if("butt"===On)this.addCurrentVertex(W,ht,0,0,$);else if("square"===On){const tn=Q?1:-1;Q||this.addCurrentVertex(W,ht,tn,tn,$),this.addCurrentVertex(W,ht,0,0,$),Q&&this.addCurrentVertex(W,ht,tn,tn,$)}else"round"===On&&(Q&&(this.addCurrentVertex(W,ge,0,0,$),this.addCurrentVertex(W,ge,1,1,$,!0)),ie&&(this.addCurrentVertex(W,De,-1,-1,$,!0),this.addCurrentVertex(W,De,0,0,$)));if(Kt&&Ye<O-1){const tn=W.dist(ie);if(tn>2*j){const dn=W.add(ie.sub(W)._mult(j/tn)._round());this.updateDistance(W,dn),this.addCurrentVertex(dn,De,0,0,$),W=dn}}}}addCurrentVertex(i,u,f,m,b,I=!1){const A=u.y*m-u.x,O=-u.y-u.x*m;this.addHalfVertex(i,u.x+u.y*f,u.y-u.x*f,I,!1,f,b),this.addHalfVertex(i,A,O,I,!0,-m,b)}addHalfVertex({x:i,y:u},f,m,b,I,A,O){this.layoutVertexArray.emplaceBack((i<<1)+(b?1:0),(u<<1)+(I?1:0),Math.round(63*f)+128,Math.round(63*m)+128,1+(0===A?0:A<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const N=O.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,N),O.primitiveLength++),I?this.e2=N:this.e1=N}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,u){this.distance+=i.dist(u),this.updateScaledDistance()}}Gn(yp,"LineBucket",{omit:["layers","patternFeatures"]});const Oy=new Qe({"line-cap":new Fe(on.layout_line["line-cap"]),"line-join":new Fe(on.layout_line["line-join"]),"line-miter-limit":new ue(on.layout_line["line-miter-limit"]),"line-round-limit":new ue(on.layout_line["line-round-limit"]),"line-sort-key":new Fe(on.layout_line["line-sort-key"])});var _p={paint:new Qe({"line-opacity":new Fe(on.paint_line["line-opacity"]),"line-color":new Fe(on.paint_line["line-color"]),"line-translate":new ue(on.paint_line["line-translate"]),"line-translate-anchor":new ue(on.paint_line["line-translate-anchor"]),"line-width":new Fe(on.paint_line["line-width"]),"line-gap-width":new Fe(on.paint_line["line-gap-width"]),"line-offset":new Fe(on.paint_line["line-offset"]),"line-blur":new Fe(on.paint_line["line-blur"]),"line-dasharray":new Fe(on.paint_line["line-dasharray"]),"line-pattern":new Fe(on.paint_line["line-pattern"]),"line-gradient":new nt(on.paint_line["line-gradient"]),"line-trim-offset":new ue(on.paint_line["line-trim-offset"])}),layout:Oy};const $c=new class extends Fe{possiblyEvaluate(s,i){return i=new G(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(s,i)}evaluate(s,i,u,f){return i=Be({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(s,i,u,f)}}(_p.paint.properties["line-width"].specification);function hg(s,i){return i>0?i+2*s:s}$c.useIntegerZoom=!0;const fg=Rt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Pa=Rt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),$a=Rt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Rt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ny=Rt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),x0=Rt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Rt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const B_=Rt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),w0=Rt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Rt([{name:"triangle",components:3,type:"Uint16"}]),Rt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Rt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Rt([{type:"Float32",name:"offsetX"}]),Rt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ju=24;const Ch=128;function Qh(s,i){const{expression:u}=i;if("constant"===u.kind)return{kind:"constant",layoutSize:u.evaluate(new G(s+1))};if("source"===u.kind)return{kind:"source"};{const{zoomStops:f,interpolationType:m}=u;let b=0;for(;b<f.length&&f[b]<=s;)b++;b=Math.max(0,b-1);let I=b;for(;I<f.length&&f[I]<s+1;)I++;I=Math.min(f.length-1,I);const A=f[b],O=f[I];return"composite"===u.kind?{kind:"composite",minZoom:A,maxZoom:O,interpolationType:m}:{kind:"camera",minZoom:A,maxZoom:O,minSize:u.evaluate(new G(A)),maxSize:u.evaluate(new G(O)),interpolationType:m}}}function xf(s,{uSize:i,uSizeT:u},{lowerSize:f,upperSize:m}){return"source"===s.kind?f/Ch:"composite"===s.kind?qn(f/Ch,m/Ch,u):i}function ef(s,i){let u=0,f=0;if("constant"===s.kind)f=s.layoutSize;else if("source"!==s.kind){const{interpolationType:m,minZoom:b,maxZoom:I}=s,A=m?Le(Fa.interpolationFactor(m,i,b,I),0,1):0;"camera"===s.kind?f=qn(s.minSize,s.maxSize,A):u=A}return{uSizeT:u,uSize:f}}var z_=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ch,evaluateSizeForFeature:xf,evaluateSizeForZoom:ef,getSizeData:Qh});function ox(s,i,u){return s.sections.forEach(f=>{f.text=function(m,b,I){const A=b.layout.get("text-transform").evaluate(I,{});return"uppercase"===A?m=m.toLocaleUpperCase():"lowercase"===A&&(m=m.toLocaleLowerCase()),z.applyArabicShaping&&(m=z.applyArabicShaping(m)),m}(f.text,i,u)}),s}const dg={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function ky(s){return"\ufe36"===s||"\ufe48"===s||"\ufe38"===s||"\ufe44"===s||"\ufe42"===s||"\ufe3e"===s||"\ufe3c"===s||"\ufe3a"===s||"\ufe18"===s||"\ufe40"===s||"\ufe10"===s||"\ufe13"===s||"\ufe14"===s||"\uff40"===s||"\uffe3"===s||"\ufe11"===s||"\ufe12"===s}function nh(s){return"\ufe35"===s||"\ufe47"===s||"\ufe37"===s||"\ufe43"===s||"\ufe41"===s||"\ufe3d"===s||"\ufe3b"===s||"\ufe39"===s||"\ufe17"===s||"\ufe3f"===s}var Qf=Cs,U_=function(s,i,u,f,m){var b,I,A=8*m-f-1,O=(1<<A)-1,N=O>>1,j=-7,$=u?m-1:0,W=u?-1:1,Q=s[i+$];for($+=W,b=Q&(1<<-j)-1,Q>>=-j,j+=A;j>0;b=256*b+s[i+$],$+=W,j-=8);for(I=b&(1<<-j)-1,b>>=-j,j+=f;j>0;I=256*I+s[i+$],$+=W,j-=8);if(0===b)b=1-N;else{if(b===O)return I?NaN:1/0*(Q?-1:1);I+=Math.pow(2,f),b-=N}return(Q?-1:1)*I*Math.pow(2,b-f)},V_=function(s,i,u,f,m,b){var I,A,O,N=8*b-m-1,j=(1<<N)-1,$=j>>1,W=23===m?Math.pow(2,-24)-Math.pow(2,-77):0,Q=f?0:b-1,ie=f?1:-1,ge=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(A=isNaN(i)?1:0,I=j):(I=Math.floor(Math.log(i)/Math.LN2),i*(O=Math.pow(2,-I))<1&&(I--,O*=2),(i+=I+$>=1?W/O:W*Math.pow(2,1-$))*O>=2&&(I++,O/=2),I+$>=j?(A=0,I=j):I+$>=1?(A=(i*O-1)*Math.pow(2,m),I+=$):(A=i*Math.pow(2,$-1)*Math.pow(2,m),I=0));m>=8;s[u+Q]=255&A,Q+=ie,A/=256,m-=8);for(I=I<<m|A,N+=m;N>0;s[u+Q]=255&I,Q+=ie,I/=256,N-=8);s[u+Q-ie]|=128*ge};function Cs(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Cs.Varint=0,Cs.Fixed64=1,Cs.Bytes=2,Cs.Fixed32=5;var Fy=4294967296,vm=1/Fy,Sh=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function mu(s){return s.type===Cs.Bytes?s.readVarint()+s.pos:s.pos+1}function xm(s,i,u){var f=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));u.realloc(f);for(var m=u.pos-1;m>=s;m--)u.buf[m+f]=u.buf[m]}function qc(s,i){for(var u=0;u<s.length;u++)i.writeVarint(s[u])}function b0(s,i){for(var u=0;u<s.length;u++)i.writeSVarint(s[u])}function sx(s,i){for(var u=0;u<s.length;u++)i.writeFloat(s[u])}function $s(s,i){for(var u=0;u<s.length;u++)i.writeDouble(s[u])}function By(s,i){for(var u=0;u<s.length;u++)i.writeBoolean(s[u])}function wm(s,i){for(var u=0;u<s.length;u++)i.writeFixed32(s[u])}function zy(s,i){for(var u=0;u<s.length;u++)i.writeSFixed32(s[u])}function ax(s,i){for(var u=0;u<s.length;u++)i.writeFixed64(s[u])}function j_(s,i){for(var u=0;u<s.length;u++)i.writeSFixed64(s[u])}function bm(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+16777216*s[i+3]}function vp(s,i,u){s[u]=i,s[u+1]=i>>>8,s[u+2]=i>>>16,s[u+3]=i>>>24}function G_(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+(s[i+3]<<24)}Cs.prototype={destroy:function(){this.buf=null},readFields:function(s,i,u){for(u=u||this.length;this.pos<u;){var f=this.readVarint(),m=f>>3,b=this.pos;this.type=7&f,s(m,i,this),this.pos===b&&this.skip(f)}return i},readMessage:function(s,i){return this.readFields(s,i,this.readVarint()+this.pos)},readFixed32:function(){var s=bm(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=G_(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=bm(this.buf,this.pos)+bm(this.buf,this.pos+4)*Fy;return this.pos+=8,s},readSFixed64:function(){var s=bm(this.buf,this.pos)+G_(this.buf,this.pos+4)*Fy;return this.pos+=8,s},readFloat:function(){var s=U_(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=U_(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var i,u,f=this.buf;return i=127&(u=f[this.pos++]),u<128?i:(i|=(127&(u=f[this.pos++]))<<7,u<128?i:(i|=(127&(u=f[this.pos++]))<<14,u<128?i:(i|=(127&(u=f[this.pos++]))<<21,u<128?i:function(m,b,I){var A,O,N=I.buf;if(A=(112&(O=N[I.pos++]))>>4,O<128||(A|=(127&(O=N[I.pos++]))<<3,O<128)||(A|=(127&(O=N[I.pos++]))<<10,O<128)||(A|=(127&(O=N[I.pos++]))<<17,O<128)||(A|=(127&(O=N[I.pos++]))<<24,O<128)||(A|=(1&(O=N[I.pos++]))<<31,O<128))return function Di(s,i,u){return u?4294967296*i+(s>>>0):4294967296*(i>>>0)+(s>>>0)}(m,A,b);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(u=f[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,i=this.pos;return this.pos=s,s-i>=12&&Sh?Sh.decode(this.buf.subarray(i,s)):function(u,f,m){for(var b="",I=f;I<m;){var A,O,N,j=u[I],$=null,W=j>239?4:j>223?3:j>191?2:1;if(I+W>m)break;1===W?j<128&&($=j):2===W?128==(192&(A=u[I+1]))&&($=(31&j)<<6|63&A)<=127&&($=null):3===W?(O=u[I+2],128==(192&(A=u[I+1]))&&128==(192&O)&&(($=(15&j)<<12|(63&A)<<6|63&O)<=2047||$>=55296&&$<=57343)&&($=null)):4===W&&(O=u[I+2],N=u[I+3],128==(192&(A=u[I+1]))&&128==(192&O)&&128==(192&N)&&(($=(15&j)<<18|(63&A)<<12|(63&O)<<6|63&N)<=65535||$>=1114112)&&($=null)),null===$?($=65533,W=1):$>65535&&($-=65536,b+=String.fromCharCode($>>>10&1023|55296),$=56320|1023&$),b+=String.fromCharCode($),I+=W}return b}(this.buf,i,s)},readBytes:function(){var s=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,s);return this.pos=s,i},readPackedVarint:function(s,i){if(this.type!==Cs.Bytes)return s.push(this.readVarint(i));var u=mu(this);for(s=s||[];this.pos<u;)s.push(this.readVarint(i));return s},readPackedSVarint:function(s){if(this.type!==Cs.Bytes)return s.push(this.readSVarint());var i=mu(this);for(s=s||[];this.pos<i;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Cs.Bytes)return s.push(this.readBoolean());var i=mu(this);for(s=s||[];this.pos<i;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Cs.Bytes)return s.push(this.readFloat());var i=mu(this);for(s=s||[];this.pos<i;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Cs.Bytes)return s.push(this.readDouble());var i=mu(this);for(s=s||[];this.pos<i;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Cs.Bytes)return s.push(this.readFixed32());var i=mu(this);for(s=s||[];this.pos<i;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Cs.Bytes)return s.push(this.readSFixed32());var i=mu(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Cs.Bytes)return s.push(this.readFixed64());var i=mu(this);for(s=s||[];this.pos<i;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Cs.Bytes)return s.push(this.readSFixed64());var i=mu(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed64());return s},skip:function(s){var i=7&s;if(i===Cs.Varint)for(;this.buf[this.pos++]>127;);else if(i===Cs.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Cs.Fixed32)this.pos+=4;else{if(i!==Cs.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(s,i){this.writeVarint(s<<3|i)},realloc:function(s){for(var i=this.length||16;i<this.pos+s;)i*=2;if(i!==this.length){var u=new Uint8Array(i);u.set(this.buf),this.buf=u,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),vp(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),vp(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),vp(this.buf,-1&s,this.pos),vp(this.buf,Math.floor(s*vm),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),vp(this.buf,-1&s,this.pos),vp(this.buf,Math.floor(s*vm),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(i,u){var f,m,b,A;if(i>=0?(f=i%4294967296|0,m=i/4294967296|0):(m=~(-i/4294967296),4294967295^(f=~(-i%4294967296))?f=f+1|0:(f=0,m=m+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),b=f,(A=u).buf[A.pos++]=127&b|128,b>>>=7,A.buf[A.pos++]=127&b|128,b>>>=7,A.buf[A.pos++]=127&b|128,b>>>=7,A.buf[A.pos++]=127&b|128,A.buf[A.pos]=127&(b>>>=7),function(b,I){var A=(7&b)<<4;I.buf[I.pos++]|=A|((b>>>=3)?128:0),b&&(I.buf[I.pos++]=127&b|((b>>>=7)?128:0),b&&(I.buf[I.pos++]=127&b|((b>>>=7)?128:0),b&&(I.buf[I.pos++]=127&b|((b>>>=7)?128:0),b&&(I.buf[I.pos++]=127&b|((b>>>=7)?128:0),b&&(I.buf[I.pos++]=127&b)))))}(m,u)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var i=this.pos;this.pos=function(f,m,b){for(var I,A,O=0;O<m.length;O++){if((I=m.charCodeAt(O))>55295&&I<57344){if(!A){I>56319||O+1===m.length?(f[b++]=239,f[b++]=191,f[b++]=189):A=I;continue}if(I<56320){f[b++]=239,f[b++]=191,f[b++]=189,A=I;continue}I=A-55296<<10|I-56320|65536,A=null}else A&&(f[b++]=239,f[b++]=191,f[b++]=189,A=null);I<128?f[b++]=I:(I<2048?f[b++]=I>>6|192:(I<65536?f[b++]=I>>12|224:(f[b++]=I>>18|240,f[b++]=I>>12&63|128),f[b++]=I>>6&63|128),f[b++]=63&I|128)}return b}(this.buf,s,this.pos);var u=this.pos-i;u>=128&&xm(i,u,this),this.pos=i-1,this.writeVarint(u),this.pos+=u},writeFloat:function(s){this.realloc(4),V_(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),V_(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var i=s.length;this.writeVarint(i),this.realloc(i);for(var u=0;u<i;u++)this.buf[this.pos++]=s[u]},writeRawMessage:function(s,i){this.pos++;var u=this.pos;s(i,this);var f=this.pos-u;f>=128&&xm(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeMessage:function(s,i,u){this.writeTag(s,Cs.Bytes),this.writeRawMessage(i,u)},writePackedVarint:function(s,i){i.length&&this.writeMessage(s,qc,i)},writePackedSVarint:function(s,i){i.length&&this.writeMessage(s,b0,i)},writePackedBoolean:function(s,i){i.length&&this.writeMessage(s,By,i)},writePackedFloat:function(s,i){i.length&&this.writeMessage(s,sx,i)},writePackedDouble:function(s,i){i.length&&this.writeMessage(s,$s,i)},writePackedFixed32:function(s,i){i.length&&this.writeMessage(s,wm,i)},writePackedSFixed32:function(s,i){i.length&&this.writeMessage(s,zy,i)},writePackedFixed64:function(s,i){i.length&&this.writeMessage(s,ax,i)},writePackedSFixed64:function(s,i){i.length&&this.writeMessage(s,j_,i)},writeBytesField:function(s,i){this.writeTag(s,Cs.Bytes),this.writeBytes(i)},writeFixed32Field:function(s,i){this.writeTag(s,Cs.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(s,i){this.writeTag(s,Cs.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(s,i){this.writeTag(s,Cs.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(s,i){this.writeTag(s,Cs.Fixed64),this.writeSFixed64(i)},writeVarintField:function(s,i){this.writeTag(s,Cs.Varint),this.writeVarint(i)},writeSVarintField:function(s,i){this.writeTag(s,Cs.Varint),this.writeSVarint(i)},writeStringField:function(s,i){this.writeTag(s,Cs.Bytes),this.writeString(i)},writeFloatField:function(s,i){this.writeTag(s,Cs.Fixed32),this.writeFloat(i)},writeDoubleField:function(s,i){this.writeTag(s,Cs.Fixed64),this.writeDouble(i)},writeBooleanField:function(s,i){this.writeVarintField(s,!!i)}};var Em=K(Qf);const Cm=3;function Sm(s,i,u){i.glyphs=[],1===s&&u.readMessage(E0,i)}function E0(s,i,u){if(3===s){const{id:f,bitmap:m,width:b,height:I,left:A,top:O,advance:N}=u.readMessage(Uy,{});i.glyphs.push({id:f,bitmap:new Jh({width:b+2*Cm,height:I+2*Cm},m),metrics:{width:b,height:I,left:A,top:O,advance:N}})}else 4===s?i.ascender=u.readSVarint():5===s&&(i.descender=u.readSVarint())}function Uy(s,i,u){1===s?i.id=u.readVarint():2===s?i.bitmap=u.readBytes():3===s?i.width=u.readVarint():4===s?i.height=u.readVarint():5===s?i.left=u.readSVarint():6===s?i.top=u.readSVarint():7===s&&(i.advance=u.readVarint())}const $_=Cm;function su(s){let i=0,u=0;for(const I of s)i+=I.w*I.h,u=Math.max(u,I.w);s.sort((I,A)=>A.h-I.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),u),h:1/0}];let m=0,b=0;for(const I of s)for(let A=f.length-1;A>=0;A--){const O=f[A];if(!(I.w>O.w||I.h>O.h)){if(I.x=O.x,I.y=O.y,b=Math.max(b,I.y+I.h),m=Math.max(m,I.x+I.w),I.w===O.w&&I.h===O.h){const N=f.pop();A<f.length&&(f[A]=N)}else I.h===O.h?(O.x+=I.w,O.w-=I.w):I.w===O.w?(O.y+=I.h,O.h-=I.h):(f.push({x:O.x+I.w,y:O.y,w:O.w-I.w,h:I.h}),O.y+=I.h,O.h-=I.h);break}}return{w:m,h:b,fill:i/(m*b)||0}}const rc=1;class pg{constructor(i,{pixelRatio:u,version:f,stretchX:m,stretchY:b,content:I}){this.paddedRect=i,this.pixelRatio=u,this.stretchX=m,this.stretchY=b,this.content=I,this.version=f}get tl(){return[this.paddedRect.x+rc,this.paddedRect.y+rc]}get br(){return[this.paddedRect.x+this.paddedRect.w-rc,this.paddedRect.y+this.paddedRect.h-rc]}get displaySize(){return[(this.paddedRect.w-2*rc)/this.pixelRatio,(this.paddedRect.h-2*rc)/this.pixelRatio]}}class Vy{constructor(i,u){const f={},m={};this.haveRenderCallbacks=[];const b=[];this.addImages(i,f,b),this.addImages(u,m,b);const{w:I,h:A}=su(b),O=new tc({width:I||1,height:A||1});for(const N in i){const j=i[N],$=f[N].paddedRect;tc.copy(j.data,O,{x:0,y:0},{x:$.x+rc,y:$.y+rc},j.data)}for(const N in u){const j=u[N],$=m[N].paddedRect,W=$.x+rc,Q=$.y+rc,ie=j.data.width,ge=j.data.height;tc.copy(j.data,O,{x:0,y:0},{x:W,y:Q},j.data),tc.copy(j.data,O,{x:0,y:ge-1},{x:W,y:Q-1},{width:ie,height:1}),tc.copy(j.data,O,{x:0,y:0},{x:W,y:Q+ge},{width:ie,height:1}),tc.copy(j.data,O,{x:ie-1,y:0},{x:W-1,y:Q},{width:1,height:ge}),tc.copy(j.data,O,{x:0,y:0},{x:W+ie,y:Q},{width:1,height:ge})}this.image=O,this.iconPositions=f,this.patternPositions=m}addImages(i,u,f){for(const m in i){const b=i[m],I={x:0,y:0,w:b.data.width+2*rc,h:b.data.height+2*rc};f.push(I),u[m]=new pg(I,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(i,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>i.hasImage(f)),i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in i.updatedImages)this.patchUpdatedImage(this.iconPositions[f],i.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],i.getImage(f),u)}patchUpdatedImage(i,u,f){if(!i||!u||i.version===u.version)return;i.version=u.version;const[m,b]=i.tl;f.update(u.data,void 0,{x:m,y:b})}}Gn(pg,"ImagePosition"),Gn(Vy,"ImageAtlas");const Fl={horizontal:1,vertical:2,horizontalOnly:3},q_=-17;class gg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,u){const f=new gg;return f.scale=i||1,f.fontStack=u,f}static forImage(i){const u=new gg;return u.imageName=i,u}}class xp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,u){const f=new xp;for(let m=0;m<i.sections.length;m++){const b=i.sections[m];b.image?f.addImageSection(b):f.addTextSection(b,u)}return f}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(i){this.text=function(u,f){let m="";for(let b=0;b<u.length;b++){const I=u.charCodeAt(b+1)||null,A=u.charCodeAt(b-1)||null;m+=!f&&(I&&hu(I)&&!dg[u[b+1]]||A&&hu(A)&&!dg[u[b-1]])||!dg[u[b]]?u[b]:dg[u[b]]}return m}(this.text,i)}trim(){let i=0;for(let f=0;f<this.text.length&&ul[this.text.charCodeAt(f)];f++)i++;let u=this.text.length;for(let f=this.text.length-1;f>=0&&f>=i&&ul[this.text.charCodeAt(f)];f--)u--;this.text=this.text.substring(i,u),this.sectionIndex=this.sectionIndex.slice(i,u)}substring(i,u){const f=new xp;return f.text=this.text.substring(i,u),f.sectionIndex=this.sectionIndex.slice(i,u),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,u)=>Math.max(i,this.sections[u].scale),0)}addTextSection(i,u){this.text+=i.text,this.sections.push(gg.forText(i.scale,i.fontStack||u));const f=this.sections.length-1;for(let m=0;m<i.text.length;++m)this.sectionIndex.push(f)}addImageSection(i){const u=i.image?i.image.name:"";if(0===u.length)return void Sr("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(gg.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Sr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Tu(s,i,u,f,m,b,I,A,O,N,j,$,W,Q,ie){const ge=xp.fromFeature(s,m);$===Fl.vertical&&ge.verticalizePunctuation(W);let De=[];const Ye=function(_t,Kt,Wt,hn,On,tn){if(!_t)return[];const dn=[],mn=function(Zn,nr,Yn,xi,Vn,Mr){let yi=0;for(let go=0;go<Zn.length();go++){const ui=Zn.getSection(go);yi+=C0(Zn.getCharCode(go),ui,xi,Vn,nr,Mr)}return yi/Math.max(1,Math.ceil(yi/Yn))}(_t,Kt,Wt,hn,On,tn),In=_t.text.indexOf("\u200b")>=0;let Un=0;for(let Zn=0;Zn<_t.length();Zn++){const nr=_t.getSection(Zn),Yn=_t.getCharCode(Zn);if(ul[Yn]||(Un+=C0(Yn,nr,hn,On,Kt,tn)),Zn<_t.length()-1){const xi=!((cn=Yn)<11904||!(Kn["Bopomofo Extended"](cn)||Kn.Bopomofo(cn)||Kn["CJK Compatibility Forms"](cn)||Kn["CJK Compatibility Ideographs"](cn)||Kn["CJK Compatibility"](cn)||Kn["CJK Radicals Supplement"](cn)||Kn["CJK Strokes"](cn)||Kn["CJK Symbols and Punctuation"](cn)||Kn["CJK Unified Ideographs Extension A"](cn)||Kn["CJK Unified Ideographs"](cn)||Kn["Enclosed CJK Letters and Months"](cn)||Kn["Halfwidth and Fullwidth Forms"](cn)||Kn.Hiragana(cn)||Kn["Ideographic Description Characters"](cn)||Kn["Kangxi Radicals"](cn)||Kn["Katakana Phonetic Extensions"](cn)||Kn.Katakana(cn)||Kn["Vertical Forms"](cn)||Kn["Yi Radicals"](cn)||Kn["Yi Syllables"](cn)));(ux[Yn]||xi||nr.imageName)&&dn.push(bp(Zn+1,Un,mn,dn,Kr(Yn,_t.getCharCode(Zn+1),xi&&In),!1))}}var cn;return jy(bp(_t.length(),Un,mn,dn,0,!0))}(ge,N,b,i,f,Q),{processBidirectionalText:ht,processStyledBidirectionalText:Ke}=z;if(ht&&1===ge.sections.length){const _t=ht(ge.toString(),Ye);for(const Kt of _t){const Wt=new xp;Wt.text=Kt,Wt.sections=ge.sections;for(let hn=0;hn<Kt.length;hn++)Wt.sectionIndex.push(0);De.push(Wt)}}else if(Ke){const _t=Ke(ge.text,ge.sectionIndex,Ye);for(const Kt of _t){const Wt=new xp;Wt.text=Kt[0],Wt.sectionIndex=Kt[1],Wt.sections=ge.sections,De.push(Wt)}}else De=function(_t,Kt){const Wt=[],hn=_t.text;let On=0;for(const tn of Kt)Wt.push(_t.substring(On,tn)),On=tn;return On<hn.length&&Wt.push(_t.substring(On,hn.length)),Wt}(ge,Ye);const ut=[],xt={positionedLines:ut,text:ge.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:$,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(_t,Kt,Wt,hn,On,tn,dn,mn,In,Un,cn,Zn){let nr=0,Yn=0,xi=0;const Vn="right"===mn?1:"left"===mn?0:.5;let Mr=!1;for(const wi of On){const bi=wi.getSections();for(const Ss of bi){if(Ss.imageName)continue;const ks=Kt[Ss.fontStack];if(ks&&(Mr=void 0!==ks.ascender&&void 0!==ks.descender,!Mr))break}if(!Mr)break}let yi=0;for(const wi of On){wi.trim();const bi=wi.getMaxScale(),Ss=(bi-1)*ju,ks={positionedGlyphs:[],lineOffset:0};_t.positionedLines[yi]=ks;const Is=ks.positionedGlyphs;let oo=0;if(!wi.length()){Yn+=tn,++yi;continue}let Ca=0,qa=0;for(let Fs=0;Fs<wi.length();Fs++){const Mu=wi.getSection(Fs),yu=wi.getSectionIndex(Fs),Wa=wi.getCharCode(Fs);let xo=Mu.scale,_u=null,ws=null,ll=null,La=ju,zl=0;const cl=!(In===Fl.horizontal||!cn&&!kf(Wa)||cn&&(ul[Wa]||(go=Wa,Kn.Arabic(go)||Kn["Arabic Supplement"](go)||Kn["Arabic Extended-A"](go)||Kn["Arabic Presentation Forms-A"](go)||Kn["Arabic Presentation Forms-B"](go))));if(Mu.imageName){const bl=hn[Mu.imageName];if(!bl)continue;ll=Mu.imageName,_t.iconsInText=_t.iconsInText||!0,ws=bl.paddedRect;const hl=bl.displaySize;xo=xo*ju/Zn,_u={width:hl[0],height:hl[1],left:rc,top:-$_,advance:cl?hl[1]:hl[0],localGlyph:!1},zl=Mr?-_u.height*xo:q_+bi*ju-hl[1]*xo,La=_u.advance;const Tf=(cl?hl[0]:hl[1])*xo-ju*bi;Tf>0&&Tf>oo&&(oo=Tf)}else{const bl=Wt[Mu.fontStack];if(!bl)continue;bl[Wa]&&(ws=bl[Wa]);const hl=Kt[Mu.fontStack];if(!hl)continue;const Tf=hl.glyphs[Wa];if(!Tf)continue;if(_u=Tf.metrics,La=8203!==Wa?ju:0,Mr){const Vm=void 0!==hl.ascender?Math.abs(hl.ascender):0,Ig=void 0!==hl.descender?Math.abs(hl.descender):0,n_=(Vm+Ig)*xo;Ca<n_&&(Ca=n_,qa=(Vm-Ig)/2*xo),zl=-Vm*xo}else zl=q_+(bi-xo)*ju}cl?(_t.verticalizable=!0,Is.push({glyph:Wa,imageName:ll,x:nr,y:Yn+zl,vertical:cl,scale:xo,localGlyph:_u.localGlyph,fontStack:Mu.fontStack,sectionIndex:yu,metrics:_u,rect:ws}),nr+=La*xo+Un):(Is.push({glyph:Wa,imageName:ll,x:nr,y:Yn+zl,vertical:cl,scale:xo,localGlyph:_u.localGlyph,fontStack:Mu.fontStack,sectionIndex:yu,metrics:_u,rect:ws}),nr+=_u.advance*xo+Un)}0!==Is.length&&(xi=Math.max(nr-Un,xi),Mr?Tm(Is,Vn,oo,qa,tn*bi/2):Tm(Is,Vn,oo,0,tn/2)),nr=0;const Ha=tn*bi+oo;ks.lineOffset=Math.max(oo,Ss),Yn+=Ha,++yi}var go;const ui=Yn,{horizontalAlign:Fr,verticalAlign:oa}=Im(dn);(function(wi,bi,Ss,ks,Is,oo){const Ca=(bi-Ss)*Is,qa=-oo*ks;for(const Ha of wi)for(const Fs of Ha.positionedGlyphs)Fs.x+=Ca,Fs.y+=qa})(_t.positionedLines,Vn,Fr,oa,xi,ui),_t.top+=-oa*ui,_t.bottom=_t.top+ui,_t.left+=-Fr*xi,_t.right=_t.left+xi,_t.hasBaseline=Mr}(xt,i,u,f,De,I,A,O,$,N,W,ie),!function(_t){for(const Kt of _t)if(0!==Kt.positionedGlyphs.length)return!1;return!0}(ut)&&xt}const ul={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ux={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function C0(s,i,u,f,m,b){if(i.imageName){const I=f[i.imageName];return I?I.displaySize[0]*i.scale*ju/b+m:0}{const I=u[i.fontStack],A=I&&I.glyphs[s];return A?A.metrics.advance*i.scale+m:0}}function wp(s,i,u,f){const m=Math.pow(s-i,2);return f?s<i?m/2:2*m:m+Math.abs(u)*u}function Kr(s,i,u){let f=0;return 10===s&&(f-=1e4),u&&(f+=150),40!==s&&65288!==s||(f+=50),41!==i&&65289!==i||(f+=50),f}function bp(s,i,u,f,m,b){let I=null,A=wp(i,u,m,b);for(const O of f){const N=wp(i-O.x,u,m,b)+O.badness;N<=A&&(I=O,A=N)}return{index:s,x:i,priorBreak:I,badness:A}}function jy(s){return s?jy(s.priorBreak).concat(s.index):[]}function Im(s){let i=.5,u=.5;switch(s){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:i,verticalAlign:u}}function Tm(s,i,u,f,m){if(!(i||u||f||m))return;const b=s.length-1,I=s[b],A=(I.x+I.metrics.advance*I.scale)*i;for(let O=0;O<=b;O++)s[O].x-=A,s[O].y+=u+f+m}function H_(s,i,u){const{horizontalAlign:f,verticalAlign:m}=Im(u),b=i[0]-s.displaySize[0]*f,I=i[1]-s.displaySize[1]*m;return{image:s,top:I,bottom:I+s.displaySize[1],left:b,right:b+s.displaySize[0]}}function W_(s,i,u,f,m,b){const I=s.image;let A;if(I.content){const De=I.content,Ye=I.pixelRatio||1;A=[De[0]/Ye,De[1]/Ye,I.displaySize[0]-De[2]/Ye,I.displaySize[1]-De[3]/Ye]}const O=i.left*b,N=i.right*b;let j,$,W,Q;"width"===u||"both"===u?(Q=m[0]+O-f[3],$=m[0]+N+f[1]):(Q=m[0]+(O+N-I.displaySize[0])/2,$=Q+I.displaySize[0]);const ie=i.top*b,ge=i.bottom*b;return"height"===u||"both"===u?(j=m[1]+ie-f[0],W=m[1]+ge+f[2]):(j=m[1]+(ie+ge-I.displaySize[1])/2,W=j+I.displaySize[1]),{image:I,top:j,right:$,bottom:W,left:Q,collisionPadding:A}}class tf extends te{constructor(i,u,f,m,b){super(i,u),this.angle=m,this.z=f,void 0!==b&&(this.segment=b)}clone(){return new tf(this.x,this.y,this.z,this.angle,this.segment)}}function Mm(s,i,u,f,m){if(void 0===i.segment)return!0;let b=i,I=i.segment+1,A=0;for(;A>-u/2;){if(I--,I<0)return!1;A-=s[I].dist(b),b=s[I]}A+=s[I].dist(s[I+1]),I++;const O=[];let N=0;for(;A<u/2;){const j=s[I],$=s[I+1];if(!$)return!1;let W=s[I-1].angleTo(j)-j.angleTo($);for(W=Math.abs((W+3*Math.PI)%(2*Math.PI)-Math.PI),O.push({distance:A,angleDelta:W}),N+=W;A-O[0].distance>f;)N-=O.shift().angleDelta;if(N>m)return!1;I++,A+=j.dist($)}return!0}function mg(s){let i=0;for(let u=0;u<s.length-1;u++)i+=s[u].dist(s[u+1]);return i}function S0(s,i,u){return s?.6*i*u:0}function Dm(s,i){return Math.max(s?s.right-s.left:0,i?i.right-i.left:0)}function I0(s,i,u,f,m,b){const I=S0(u,m,b),A=Dm(u,f)*b;let O=0;const N=mg(s)/2;for(let j=0;j<s.length-1;j++){const $=s[j],W=s[j+1],Q=$.dist(W);if(O+Q>N){const ie=(N-O)/Q,ge=qn($.x,W.x,ie),De=qn($.y,W.y,ie),Ye=new tf(ge,De,0,W.angleTo($),j);return!I||Mm(s,Ye,A,I,i)?Ye:void 0}O+=Q}}function Gy(s,i,u,f,m,b,I,A,O){const N=S0(f,b,I),j=Dm(f,m),$=j*I,W=0===s[0].x||s[0].x===O||0===s[0].y||s[0].y===O;return i-$<i/4&&(i=$+i/4),ed(s,W?i/2*A%i:(j/2+2*b)*I*A%i,i,N,u,$,W,!1,O)}function ed(s,i,u,f,m,b,I,A,O){const N=b/2,j=mg(s);let $=0,W=i-u,Q=[];for(let ie=0;ie<s.length-1;ie++){const ge=s[ie],De=s[ie+1],Ye=ge.dist(De),ht=De.angleTo(ge);for(;W+u<$+Ye;){W+=u;const Ke=(W-$)/Ye,ut=qn(ge.x,De.x,Ke),xt=qn(ge.y,De.y,Ke);if(ut>=0&&ut<O&&xt>=0&&xt<O&&W-N>=0&&W+N<=j){const _t=new tf(ut,xt,0,ht,ie);_t._round(),f&&!Mm(s,_t,b,f,m)||Q.push(_t)}}$+=Ye}return A||Q.length||I||(Q=ed(s,$/2,u,f,m,b,I,!0,O)),Q}function $y(s,i,u,f,m){const b=[];for(let I=0;I<s.length;I++){const A=s[I];let O;for(let N=0;N<A.length-1;N++){let j=A[N],$=A[N+1];j.x<i&&$.x<i||(j.x<i?j=new te(i,j.y+(i-j.x)/($.x-j.x)*($.y-j.y))._round():$.x<i&&($=new te(i,j.y+(i-j.x)/($.x-j.x)*($.y-j.y))._round()),j.y<u&&$.y<u||(j.y<u?j=new te(j.x+(u-j.y)/($.y-j.y)*($.x-j.x),u)._round():$.y<u&&($=new te(j.x+(u-j.y)/($.y-j.y)*($.x-j.x),u)._round()),j.x>=f&&$.x>=f||(j.x>=f?j=new te(f,j.y+(f-j.x)/($.x-j.x)*($.y-j.y))._round():$.x>=f&&($=new te(f,j.y+(f-j.x)/($.x-j.x)*($.y-j.y))._round()),j.y>=m&&$.y>=m||(j.y>=m?j=new te(j.x+(m-j.y)/($.y-j.y)*($.x-j.x),m)._round():$.y>=m&&($=new te(j.x+(m-j.y)/($.y-j.y)*($.x-j.x),m)._round()),O&&j.equals(O[O.length-1])||(O=[j],b.push(O)),O.push($)))))}}return b}Gn(tf,"Anchor");const Ih=1e20;function X_(s,i,u,f,m,b,I,A,O){for(let N=i;N<i+f;N++)Am(s,u*b+N,b,m,I,A,O);for(let N=u;N<u+m;N++)Am(s,N*b+i,1,f,I,A,O)}function Am(s,i,u,f,m,b,I){b[0]=0,I[0]=-Ih,I[1]=Ih,m[0]=s[i];for(let A=1,O=0,N=0;A<f;A++){m[A]=s[i+A*u];const j=A*A;do{const $=b[O];N=(m[A]-m[$]+j-$*$)/(A-$)/2}while(N<=I[O]&&--O>-1);O++,b[O]=A,I[O]=N,I[O+1]=Ih}for(let A=0,O=0;A<f;A++){for(;I[O+1]<A;)O++;const N=b[O],j=A-N;s[i+A*u]=m[N]+j*j}}const Cc=2,Pm={none:0,ideographs:1,all:2};class wf{constructor(i,u,f){this.requestManager=i,this.localGlyphMode=u,this.localFontFamily=f,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,u){const f=[];for(const m in i)for(const b of i[m])f.push({stack:m,id:b});ft(f,({stack:m,id:b},I)=>{let A=this.entries[m];A||(A=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let O=A.glyphs[b];if(void 0!==O)return void I(null,{stack:m,id:b,glyph:O});if(O=this._tinySDF(A,m,b),O)return A.glyphs[b]=O,void I(null,{stack:m,id:b,glyph:O});const N=Math.floor(b/256);if(256*N>65535)return void I(new Error("glyphs > 65535 not supported"));if(A.ranges[N])return void I(null,{stack:m,id:b,glyph:O});let j=A.requests[N];j||(j=A.requests[N]=[],wf.loadGlyphRange(m,N,this.url,this.requestManager,($,W)=>{if(W){A.ascender=W.ascender,A.descender=W.descender;for(const Q in W.glyphs)this._doesCharSupportLocalGlyph(+Q)||(A.glyphs[+Q]=W.glyphs[+Q]);A.ranges[N]=!0}for(const Q of j)Q($,W);delete A.requests[N]})),j.push(($,W)=>{$?I($):W&&I(null,{stack:m,id:b,glyph:W.glyphs[b]||null})})},(m,b)=>{if(m)u(m);else if(b){const I={};for(const{stack:A,id:O,glyph:N}of b)void 0===I[A]&&(I[A]={}),void 0===I[A].glyphs&&(I[A].glyphs={}),I[A].glyphs[O]=N&&{id:N.id,bitmap:N.bitmap.clone(),metrics:N.metrics},I[A].ascender=this.entries[A].ascender,I[A].descender=this.entries[A].descender;u(null,I)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==Pm.none&&(this.localGlyphMode===Pm.all?!!this.localFontFamily:!!this.localFontFamily&&(Kn["CJK Unified Ideographs"](i)||Kn["Hangul Syllables"](i)||Kn.Hiragana(i)||Kn.Katakana(i)||Kn["CJK Symbols and Punctuation"](i)))}_tinySDF(i,u,f){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(f))return;let b=i.tinySDF;if(!b){let ge="400";/bold/i.test(u)?ge="900":/medium/i.test(u)?ge="500":/light/i.test(u)&&(ge="200"),b=i.tinySDF=new wf.TinySDF({fontFamily:m,fontWeight:ge,fontSize:24*Cc,buffer:3*Cc,radius:8*Cc}),b.fontWeight=ge}if(this.localGlyphs[b.fontWeight][f])return this.localGlyphs[b.fontWeight][f];const I=String.fromCharCode(f),{data:A,width:O,height:N,glyphWidth:j,glyphHeight:$,glyphLeft:W,glyphTop:Q,glyphAdvance:ie}=b.draw(I);return this.localGlyphs[b.fontWeight][f]={id:f,bitmap:new Jh({width:O,height:N},A),metrics:{width:j/Cc,height:$/Cc,left:W/Cc,top:Q/Cc-27,advance:ie/Cc,localGlyph:!0}}}}wf.loadGlyphRange=function(s,i,u,f,m){const b=256*i,I=b+255,A=f.transformRequest(f.normalizeGlyphsURL(u).replace("{fontstack}",s).replace("{range}",`${b}-${I}`),Pi.Glyphs);ts(A,(O,N)=>{if(O)m(O);else if(N){const j={},$=new Em(N).readFields(Sm,{});for(const W of $.glyphs)j[W.id]=W;m(null,{glyphs:j,ascender:$.ascender,descender:$.descender})}})},wf.TinySDF=class{constructor({fontSize:s=24,buffer:i=3,radius:u=8,cutoff:f=.25,fontFamily:m="sans-serif",fontWeight:b="normal",fontStyle:I="normal"}={}){this.buffer=i,this.cutoff=f,this.radius=u;const A=this.size=s+4*i,O=this._createCanvas(A),N=this.ctx=O.getContext("2d",{willReadFrequently:!0});N.font=`${I} ${b} ${s}px ${m}`,N.textBaseline="alphabetic",N.textAlign="left",N.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(s){const i=document.createElement("canvas");return i.width=i.height=s,i}draw(s){const{width:i,actualBoundingBoxAscent:u,actualBoundingBoxDescent:f,actualBoundingBoxLeft:m,actualBoundingBoxRight:b}=this.ctx.measureText(s),I=Math.ceil(u),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-m))),O=Math.min(this.size-this.buffer,I+Math.ceil(f)),N=A+2*this.buffer,j=O+2*this.buffer,$=Math.max(N*j,0),W=new Uint8ClampedArray($),Q={data:W,width:N,height:j,glyphWidth:A,glyphHeight:O,glyphTop:I,glyphLeft:0,glyphAdvance:i};if(0===A||0===O)return Q;const{ctx:ie,buffer:ge,gridInner:De,gridOuter:Ye}=this;ie.clearRect(ge,ge,A,O),ie.fillText(s,ge,ge+I);const ht=ie.getImageData(ge,ge,A,O);Ye.fill(Ih,0,$),De.fill(0,0,$);for(let Ke=0;Ke<O;Ke++)for(let ut=0;ut<A;ut++){const xt=ht.data[4*(Ke*A+ut)+3]/255;if(0===xt)continue;const _t=(Ke+ge)*N+ut+ge;if(1===xt)Ye[_t]=0,De[_t]=Ih;else{const Kt=.5-xt;Ye[_t]=Kt>0?Kt*Kt:0,De[_t]=Kt<0?Kt*Kt:0}}X_(Ye,0,0,N,j,N,this.f,this.v,this.z),X_(De,ge,ge,A,O,N,this.f,this.v,this.z);for(let Ke=0;Ke<$;Ke++){const ut=Math.sqrt(Ye[Ke])-Math.sqrt(De[Ke]);W[Ke]=Math.round(255-255*(ut/this.radius+this.cutoff))}return Q}};const bf=rc;function nf(s,i,u,f){const m=[],b=s.image,I=b.pixelRatio,A=b.paddedRect.w-2*bf,O=b.paddedRect.h-2*bf,N=s.right-s.left,j=s.bottom-s.top,$=b.stretchX||[[0,A]],W=b.stretchY||[[0,O]],Q=(tn,dn)=>tn+dn[1]-dn[0],ie=$.reduce(Q,0),ge=W.reduce(Q,0),De=A-ie,Ye=O-ge;let ht=0,Ke=ie,ut=0,xt=ge,_t=0,Kt=De,Wt=0,hn=Ye;if(b.content&&f){const tn=b.content;ht=Ep($,0,tn[0]),ut=Ep(W,0,tn[1]),Ke=Ep($,tn[0],tn[2]),xt=Ep(W,tn[1],tn[3]),_t=tn[0]-ht,Wt=tn[1]-ut,Kt=tn[2]-tn[0]-Ke,hn=tn[3]-tn[1]-xt}const On=(tn,dn,mn,In)=>{const Un=Lm(tn.stretch-ht,Ke,N,s.left),cn=Om(tn.fixed-_t,Kt,tn.stretch,ie),Zn=Lm(dn.stretch-ut,xt,j,s.top),nr=Om(dn.fixed-Wt,hn,dn.stretch,ge),Yn=Lm(mn.stretch-ht,Ke,N,s.left),xi=Om(mn.fixed-_t,Kt,mn.stretch,ie),Vn=Lm(In.stretch-ut,xt,j,s.top),Mr=Om(In.fixed-Wt,hn,In.stretch,ge),yi=new te(Un,Zn),go=new te(Yn,Zn),ui=new te(Yn,Vn),Fr=new te(Un,Vn),oa=new te(cn/I,nr/I),wi=new te(xi/I,Mr/I),bi=i*Math.PI/180;if(bi){const Is=Math.sin(bi),oo=Math.cos(bi),Ca=[oo,-Is,Is,oo];yi._matMult(Ca),go._matMult(Ca),Fr._matMult(Ca),ui._matMult(Ca)}const Ss=tn.stretch+tn.fixed,ks=dn.stretch+dn.fixed;return{tl:yi,tr:go,bl:Fr,br:ui,tex:{x:b.paddedRect.x+bf+Ss,y:b.paddedRect.y+bf+ks,w:mn.stretch+mn.fixed-Ss,h:In.stretch+In.fixed-ks},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:oa,pixelOffsetBR:wi,minFontScaleX:Kt/I/N,minFontScaleY:hn/I/j,isSDF:u}};if(f&&(b.stretchX||b.stretchY)){const tn=Rm($,De,ie),dn=Rm(W,Ye,ge);for(let mn=0;mn<tn.length-1;mn++){const In=tn[mn],Un=tn[mn+1];for(let cn=0;cn<dn.length-1;cn++)m.push(On(In,dn[cn],Un,dn[cn+1]))}}else m.push(On({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:O+1}));return m}function Ep(s,i,u){let f=0;for(const m of s)f+=Math.max(i,Math.min(u,m[1]))-Math.max(i,Math.min(u,m[0]));return f}function Rm(s,i,u){const f=[{fixed:-bf,stretch:0}];for(const[m,b]of s){const I=f[f.length-1];f.push({fixed:m-I.stretch,stretch:I.stretch}),f.push({fixed:m-I.stretch,stretch:I.stretch+(b-m)})}return f.push({fixed:i+bf,stretch:u}),f}function Lm(s,i,u,f){return s/i*u+f}function Om(s,i,u,f){return s-i*u/f}function Z_(s,i,u,f){const m=i+s.positionedLines[f].lineOffset;return 0===f?u+m/2:u+(m+(i+s.positionedLines[f-1].lineOffset))/2}class Cp{constructor(i=[],u=T0){if(this.data=i,this.length=this.data.length,this.compare=u,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const i=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:u,compare:f}=this,m=u[i];for(;i>0;){const b=i-1>>1,I=u[b];if(f(m,I)>=0)break;u[i]=I,i=b}u[i]=m}_down(i){const{data:u,compare:f}=this,m=this.length>>1,b=u[i];for(;i<m;){let I=1+(i<<1),A=u[I];const O=I+1;if(O<this.length&&f(u[O],A)<0&&(I=O,A=u[O]),f(A,b)>=0)break;u[i]=A,i=I}u[i]=b}}function T0(s,i){return s<i?-1:s>i?1:0}function M0(s,i=1,u=!1){let f=1/0,m=1/0,b=-1/0,I=-1/0;const A=s[0];for(let Q=0;Q<A.length;Q++){const ie=A[Q];(!Q||ie.x<f)&&(f=ie.x),(!Q||ie.y<m)&&(m=ie.y),(!Q||ie.x>b)&&(b=ie.x),(!Q||ie.y>I)&&(I=ie.y)}const O=Math.min(b-f,I-m);let N=O/2;const j=new Cp([],D0);if(0===O)return new te(f,m);for(let Q=f;Q<b;Q+=O)for(let ie=m;ie<I;ie+=O)j.push(new td(Q+N,ie+N,N,s));let $=function(Q){let ie=0,ge=0,De=0;const Ye=Q[0];for(let ht=0,Ke=Ye.length,ut=Ke-1;ht<Ke;ut=ht++){const xt=Ye[ht],_t=Ye[ut],Kt=xt.x*_t.y-_t.x*xt.y;ge+=(xt.x+_t.x)*Kt,De+=(xt.y+_t.y)*Kt,ie+=3*Kt}return new td(ge/ie,De/ie,0,Q)}(s),W=j.length;for(;j.length;){const Q=j.pop();(Q.d>$.d||!$.d)&&($=Q,u&&console.log("found best %d after %d probes",Math.round(1e4*Q.d)/1e4,W)),Q.max-$.d<=i||(N=Q.h/2,j.push(new td(Q.p.x-N,Q.p.y-N,N,s)),j.push(new td(Q.p.x+N,Q.p.y-N,N,s)),j.push(new td(Q.p.x-N,Q.p.y+N,N,s)),j.push(new td(Q.p.x+N,Q.p.y+N,N,s)),W+=4)}return u&&(console.log(`num probes: ${W}`),console.log(`best distance: ${$.d}`)),$.p}function D0(s,i){return i.max-s.max}class td{constructor(i,u,f,m){this.p=new te(i,u),this.h=f,this.d=function(b,I){let A=!1,O=1/0;for(let N=0;N<I.length;N++){const j=I[N];for(let $=0,W=j.length,Q=W-1;$<W;Q=$++){const ie=j[$],ge=j[Q];ie.y>b.y!=ge.y>b.y&&b.x<(ge.x-ie.x)*(b.y-ie.y)/(ge.y-ie.y)+ie.x&&(A=!A),O=Math.min(O,T_(b,ie,ge))}}return(A?1:-1)*Math.sqrt(O)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}}const Ef=7,qy=Number.POSITIVE_INFINITY,Y_=Math.sqrt(2);function Pd(s,[i,u]){let f=0,m=0;if(u===qy){i<0&&(i=0);const b=i/Y_;switch(s){case"top-right":case"top-left":m=b-Ef;break;case"bottom-right":case"bottom-left":m=-b+Ef;break;case"bottom":m=-i+Ef;break;case"top":m=i-Ef}switch(s){case"top-right":case"bottom-right":f=-b;break;case"top-left":case"bottom-left":f=b;break;case"left":f=i;break;case"right":f=-i}}else{switch(i=Math.abs(i),u=Math.abs(u),s){case"top-right":case"top-left":case"top":m=u-Ef;break;case"bottom-right":case"bottom-left":case"bottom":m=-u+Ef}switch(s){case"top-right":case"bottom-right":case"right":f=-i;break;case"top-left":case"bottom-left":case"left":f=i}}return[f,m]}function lx(s,i,u,f,m,b,I,A,O,N){s.createArrays(),s.tilePixelRatio=Ir/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const j=s.layers[0].layout,$=s.layers[0]._unevaluatedLayout._values,W={};if("composite"===s.textSizeData.kind){const{minZoom:ge,maxZoom:De}=s.textSizeData;W.compositeTextSizes=[$["text-size"].possiblyEvaluate(new G(ge),A),$["text-size"].possiblyEvaluate(new G(De),A)]}if("composite"===s.iconSizeData.kind){const{minZoom:ge,maxZoom:De}=s.iconSizeData;W.compositeIconSizes=[$["icon-size"].possiblyEvaluate(new G(ge),A),$["icon-size"].possiblyEvaluate(new G(De),A)]}W.layoutTextSize=$["text-size"].possiblyEvaluate(new G(O+1),A),W.layoutIconSize=$["icon-size"].possiblyEvaluate(new G(O+1),A),W.textMaxSize=$["text-size"].possiblyEvaluate(new G(18),A);const Q="map"===j.get("text-rotation-alignment")&&"point"!==j.get("symbol-placement"),ie=j.get("text-size");for(const ge of s.features){const De=j.get("text-font").evaluate(ge,{},A).join(","),Ye=ie.evaluate(ge,{},A),ht=W.layoutTextSize.evaluate(ge,{},A),Ke=(W.layoutIconSize.evaluate(ge,{},A),{horizontal:{},vertical:void 0}),ut=ge.text;let xt,_t=[0,0];if(ut){const hn=ut.toString(),On=j.get("text-letter-spacing").evaluate(ge,{},A)*ju,tn=j.get("text-line-height").evaluate(ge,{},A)*ju,dn=Jm(hn)?On:0,mn=j.get("text-anchor").evaluate(ge,{},A),In=j.get("text-variable-anchor");if(!In){const Yn=j.get("text-radial-offset").evaluate(ge,{},A);_t=Yn?Pd(mn,[Yn*ju,qy]):j.get("text-offset").evaluate(ge,{},A).map(xi=>xi*ju)}let Un=Q?"center":j.get("text-justify").evaluate(ge,{},A);const cn="point"===j.get("symbol-placement"),Zn=cn?j.get("text-max-width").evaluate(ge,{},A)*ju:1/0,nr=Yn=>{s.allowVerticalPlacement&&Bg(hn)&&(Ke.vertical=Tu(ut,i,u,m,De,Zn,tn,mn,Yn,dn,_t,Fl.vertical,!0,ht,Ye))};if(!Q&&In){const Yn="auto"===Un?In.map(Vn=>K_(Vn)):[Un];let xi=!1;for(let Vn=0;Vn<Yn.length;Vn++){const Mr=Yn[Vn];if(!Ke.horizontal[Mr])if(xi)Ke.horizontal[Mr]=Ke.horizontal[0];else{const yi=Tu(ut,i,u,m,De,Zn,tn,"center",Mr,dn,_t,Fl.horizontal,!1,ht,Ye);yi&&(Ke.horizontal[Mr]=yi,xi=1===yi.positionedLines.length)}}nr("left")}else{if("auto"===Un&&(Un=K_(mn)),cn||j.get("text-writing-mode").indexOf("horizontal")>=0||!Bg(hn)){const Yn=Tu(ut,i,u,m,De,Zn,tn,mn,Un,dn,_t,Fl.horizontal,!1,ht,Ye);Yn&&(Ke.horizontal[Un]=Yn)}nr(cn?"left":Un)}}let Kt=!1;if(ge.icon&&ge.icon.name){const hn=f[ge.icon.name];hn&&(xt=H_(m[ge.icon.name],j.get("icon-offset").evaluate(ge,{},A),j.get("icon-anchor").evaluate(ge,{},A)),Kt=hn.sdf,void 0===s.sdfIcons?s.sdfIcons=hn.sdf:s.sdfIcons!==hn.sdf&&Sr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(hn.pixelRatio!==s.pixelRatio||0!==j.get("icon-rotate").constantOr(1))&&(s.iconsNeedLinear=!0))}const Wt=_g(Ke.horizontal)||Ke.vertical;s.iconsInText||(s.iconsInText=!!Wt&&Wt.iconsInText),(Wt||xt)&&J_(s,ge,Ke,xt,f,W,ht,0,_t,Kt,I,A,N)}b&&s.generateCollisionDebugBuffers(O,s.collisionBoxArray)}function K_(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function J_(s,i,u,f,m,b,I,A,O,N,j,$,W){let Q=b.textMaxSize.evaluate(i,{},$);void 0===Q&&(Q=I);const ie=s.layers[0].layout,ge=ie.get("icon-offset").evaluate(i,{},$),De=_g(u.horizontal)||u.vertical,Ye="globe"===W.name,ht=ju,Ke=I/ht,ut=s.tilePixelRatio*Q/ht,xt=(mn=s.overscaling,s.zoom>18&&mn>2&&(mn>>=1),Math.max(Ir/(512*mn),1)*ie.get("symbol-spacing")),_t=ie.get("text-padding")*s.tilePixelRatio,Kt=ie.get("icon-padding")*s.tilePixelRatio,Wt=Je(ie.get("text-max-angle")),hn="map"===ie.get("text-rotation-alignment")&&"point"!==ie.get("symbol-placement"),On="map"===ie.get("icon-rotation-alignment")&&"point"!==ie.get("symbol-placement"),tn=ie.get("symbol-placement"),dn=xt/2;var mn;const In=ie.get("icon-text-fit");let Un;f&&"none"!==In&&(s.allowVerticalPlacement&&u.vertical&&(Un=W_(f,u.vertical,In,ie.get("icon-text-fit-padding"),ge,Ke)),De&&(f=W_(f,De,In,ie.get("icon-text-fit-padding"),ge,Ke)));const cn=(Zn,nr,Yn)=>{if(nr.x<0||nr.x>=Ir||nr.y<0||nr.y>=Ir)return;let xi=null;if(Ye){const{x:Vn,y:Mr,z:yi}=W.projectTilePoint(nr.x,nr.y,Yn);xi={anchor:new tf(Vn,Mr,yi,0,void 0),up:W.upVector(Yn,nr.x,nr.y)}}!function(Vn,Mr,yi,go,ui,Fr,oa,wi,bi,Ss,ks,Is,oo,Ca,qa,Ha,Fs,Mu,yu,Wa,xo,_u,ws,ll,La){const zl=Vn.addToLineVertexArray(Mr,go);let cl,bl,hl,Tf,Vm,Ig,n_,jm=0,mx=0,G0=0,$0=0,q0=-1,H0=-1;const oh={};let yx=gh("");const Gm=yi?yi.anchor:Mr;let W0=0,X0=0;if(void 0===bi._unevaluatedLayout.getValue("text-radial-offset")?[W0,X0]=bi.layout.get("text-offset").evaluate(xo,{},La).map(sh=>sh*ju):(W0=bi.layout.get("text-radial-offset").evaluate(xo,{},La)*ju,X0=qy),Vn.allowVerticalPlacement&&ui.vertical){const sh=ui.vertical;if(qa)Ig=vg(sh),wi&&(n_=vg(wi));else{const ah=bi.layout.get("text-rotate").evaluate(xo,{},La)+90;hl=Nm(Ss,Gm,Mr,ks,Is,oo,sh,Ca,ah,Ha),wi&&(Tf=Nm(Ss,Gm,Mr,ks,Is,oo,wi,Mu,ah))}}if(Fr){const sh=bi.layout.get("icon-rotate").evaluate(xo,{},La),ah="none"!==bi.layout.get("icon-text-fit"),$m=nf(Fr,sh,ws,ah),cv=wi?nf(wi,sh,ws,ah):void 0;bl=Nm(Ss,Gm,Mr,ks,Is,oo,Fr,Mu,sh),jm=4*$m.length;const _x=Vn.iconSizeData;let Bd=null;"source"===_x.kind?(Bd=[Ch*bi.layout.get("icon-size").evaluate(xo,{},La)],Bd[0]>Rd&&Sr(`${Vn.layerIds[0]}: Value for "icon-size" is >= ${yg}. Reduce your "icon-size".`)):"composite"===_x.kind&&(Bd=[Ch*_u.compositeIconSizes[0].evaluate(xo,{},La),Ch*_u.compositeIconSizes[1].evaluate(xo,{},La)],(Bd[0]>Rd||Bd[1]>Rd)&&Sr(`${Vn.layerIds[0]}: Value for "icon-size" is >= ${yg}. Reduce your "icon-size".`)),Vn.addSymbols(Vn.icon,$m,Bd,Wa,yu,xo,!1,yi,Mr,zl.lineStartIndex,zl.lineLength,-1,ll,La),q0=Vn.icon.placedSymbolArray.length-1,cv&&(mx=4*cv.length,Vn.addSymbols(Vn.icon,cv,Bd,Wa,yu,xo,Fl.vertical,yi,Mr,zl.lineStartIndex,zl.lineLength,-1,ll,La),H0=Vn.icon.placedSymbolArray.length-1)}for(const sh in ui.horizontal){const ah=ui.horizontal[sh];cl||(yx=gh(ah.text),qa?Vm=vg(ah):cl=Nm(Ss,Gm,Mr,ks,Is,oo,ah,Ca,bi.layout.get("text-rotate").evaluate(xo,{},La),Ha));const $m=1===ah.positionedLines.length;if(G0+=A0(Vn,yi,Mr,ah,oa,bi,qa,xo,Ha,zl,ui.vertical?Fl.horizontal:Fl.horizontalOnly,$m?Object.keys(ui.horizontal):[sh],oh,q0,_u,ll,La),$m)break}ui.vertical&&($0+=A0(Vn,yi,Mr,ui.vertical,oa,bi,qa,xo,Ha,zl,Fl.vertical,["vertical"],oh,H0,_u,ll,La));let Pp=-1;const Z0=(sh,ah)=>sh?Math.max(sh,ah):ah;Pp=Z0(Vm,Pp),Pp=Z0(Ig,Pp),Pp=Z0(n_,Pp);const ub=Pp>-1?1:0;Vn.glyphOffsetArray.length>=kd.MAX_GLYPHS&&Sr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==xo.sortKey&&Vn.addToSortKeyRanges(Vn.symbolInstances.length,xo.sortKey),Vn.symbolInstances.emplaceBack(Gm.x,Gm.y,Gm.z,Mr.x,Mr.y,oh.right>=0?oh.right:-1,oh.center>=0?oh.center:-1,oh.left>=0?oh.left:-1,oh.vertical>=0?oh.vertical:-1,q0,H0,yx,void 0!==cl?cl:Vn.collisionBoxArray.length,void 0!==cl?cl+1:Vn.collisionBoxArray.length,void 0!==hl?hl:Vn.collisionBoxArray.length,void 0!==hl?hl+1:Vn.collisionBoxArray.length,void 0!==bl?bl:Vn.collisionBoxArray.length,void 0!==bl?bl+1:Vn.collisionBoxArray.length,Tf||Vn.collisionBoxArray.length,Tf?Tf+1:Vn.collisionBoxArray.length,ks,G0,$0,jm,mx,ub,0,W0,X0,Pp)}(s,nr,xi,Zn,u,f,m,Un,s.layers[0],s.collisionBoxArray,i.index,i.sourceLayerIndex,s.index,_t,hn,O,0,Kt,On,ge,i,b,N,j,$)};if("line"===tn)for(const Zn of $y(i.geometry,0,0,Ir,Ir)){const nr=Gy(Zn,xt,Wt,u.vertical||De,f,ht,ut,s.overscaling,Ir);for(const Yn of nr)De&&xg(s,De.text,dn,Yn)||cn(Zn,Yn,$)}else if("line-center"===tn){for(const Zn of i.geometry)if(Zn.length>1){const nr=I0(Zn,Wt,u.vertical||De,f,ht,ut);nr&&cn(Zn,nr,$)}}else if("Polygon"===i.type)for(const Zn of Ey(i.geometry,0)){const nr=M0(Zn,16);cn(Zn[0],new tf(nr.x,nr.y,0,0,void 0),$)}else if("LineString"===i.type)for(const Zn of i.geometry)cn(Zn,new tf(Zn[0].x,Zn[0].y,0,0,void 0),$);else if("Point"===i.type)for(const Zn of i.geometry)for(const nr of Zn)cn([nr],new tf(nr.x,nr.y,0,0,void 0),$)}const yg=255,Rd=yg*Ch;function A0(s,i,u,f,m,b,I,A,O,N,j,$,W,Q,ie,ge,De){const Ye=function(ut,xt,_t,Kt,Wt,hn,On,tn){const dn=[];if(0===xt.positionedLines.length)return dn;const mn=Kt.layout.get("text-rotate").evaluate(hn,{})*Math.PI/180,In=function(Yn){const xi=Yn[0],Vn=Yn[1],Mr=xi*Vn;return Mr>0?[xi,-Vn]:Mr<0?[-xi,Vn]:0===xi?[Vn,xi]:[Vn,-xi]}(_t);let Un=Math.abs(xt.top-xt.bottom);for(const Yn of xt.positionedLines)Un-=Yn.lineOffset;const cn=xt.positionedLines.length,Zn=Un/cn;let nr=xt.top-_t[1];for(let Yn=0;Yn<cn;++Yn){const xi=xt.positionedLines[Yn];nr=Z_(xt,Zn,nr,Yn);for(const Vn of xi.positionedGlyphs){if(!Vn.rect)continue;const Mr=Vn.rect||{};let yi=$_+1,go=!0,ui=1,Fr=0;if(Vn.imageName){const ws=On[Vn.imageName];if(!ws)continue;if(ws.sdf){Sr("SDF images are not supported in formatted text and will be ignored.");continue}go=!1,ui=ws.pixelRatio,yi=rc/ui}const oa=(Wt||tn)&&Vn.vertical,wi=Vn.metrics.advance*Vn.scale/2,bi=Vn.metrics,Ss=Vn.rect;if(null===Ss)continue;tn&&xt.verticalizable&&(Fr=Vn.imageName?wi-Vn.metrics.width*Vn.scale/2:0);const ks=Wt?[Vn.x+wi,Vn.y]:[0,0];let Is=[0,0],oo=[0,0],Ca=!1;Wt||(oa?(oo=[Vn.x+wi+In[0],Vn.y+In[1]-Fr],Ca=!0):Is=[Vn.x+wi+_t[0],Vn.y+_t[1]-Fr]);const qa=Ss.w*Vn.scale/(ui*(Vn.localGlyph?Cc:1)),Ha=Ss.h*Vn.scale/(ui*(Vn.localGlyph?Cc:1));let Fs,Mu,yu,Wa;if(oa){const ws=Vn.y-nr,ll=new te(-wi,wi-ws),La=-Math.PI/2,zl=new te(...oo);Fs=new te(-wi+Is[0],Is[1]),Fs._rotateAround(La,ll)._add(zl),Fs.x+=-ws+wi,Fs.y-=(bi.left-yi)*Vn.scale;const cl=Vn.imageName?bi.advance*Vn.scale:ju*Vn.scale,bl=String.fromCharCode(Vn.glyph);ky(bl)?Fs.x+=(1-yi)*Vn.scale:nh(bl)?Fs.x+=cl-bi.height*Vn.scale+(-yi-1)*Vn.scale:Fs.x+=Vn.imageName||bi.width+2*yi===Ss.w&&bi.height+2*yi===Ss.h?(cl-Ha)/2:(cl-(bi.height+2*yi)*Vn.scale)/2,Mu=new te(Fs.x,Fs.y-qa),yu=new te(Fs.x+Ha,Fs.y),Wa=new te(Fs.x+Ha,Fs.y-qa)}else{const ws=(bi.left-yi)*Vn.scale-wi+Is[0],ll=(-bi.top-yi)*Vn.scale+Is[1],La=ws+qa,zl=ll+Ha;Fs=new te(ws,ll),Mu=new te(La,ll),yu=new te(ws,zl),Wa=new te(La,zl)}if(mn){let ws;ws=Wt?new te(0,0):Ca?new te(In[0],In[1]):new te(_t[0],_t[1]),Fs._rotateAround(mn,ws),Mu._rotateAround(mn,ws),yu._rotateAround(mn,ws),Wa._rotateAround(mn,ws)}const xo=new te(0,0),_u=new te(0,0);dn.push({tl:Fs,tr:Mu,bl:yu,br:Wa,tex:Mr,writingMode:xt.writingMode,glyphOffset:ks,sectionIndex:Vn.sectionIndex,isSDF:go,pixelOffsetTL:xo,pixelOffsetBR:_u,minFontScaleX:0,minFontScaleY:0})}}return dn}(0,f,O,b,I,A,m,s.allowVerticalPlacement),ht=s.textSizeData;let Ke=null;"source"===ht.kind?(Ke=[Ch*b.layout.get("text-size").evaluate(A,{},De)],Ke[0]>Rd&&Sr(`${s.layerIds[0]}: Value for "text-size" is >= ${yg}. Reduce your "text-size".`)):"composite"===ht.kind&&(Ke=[Ch*ie.compositeTextSizes[0].evaluate(A,{},De),Ch*ie.compositeTextSizes[1].evaluate(A,{},De)],(Ke[0]>Rd||Ke[1]>Rd)&&Sr(`${s.layerIds[0]}: Value for "text-size" is >= ${yg}. Reduce your "text-size".`)),s.addSymbols(s.text,Ye,Ke,O,I,A,j,i,u,N.lineStartIndex,N.lineLength,Q,ge,De);for(const ut of $)W[ut]=s.text.placedSymbolArray.length-1;return 4*Ye.length}function _g(s){for(const i in s)return s[i];return null}function Nm(s,i,u,f,m,b,I,A,O,N){let j=I.top,$=I.bottom,W=I.left,Q=I.right;const ie=I.collisionPadding;if(ie&&(W-=ie[0],j-=ie[1],Q+=ie[2],$+=ie[3]),O){const ge=new te(W,j),De=new te(Q,j),Ye=new te(W,$),ht=new te(Q,$),Ke=Je(O);let ut=new te(0,0);N&&(ut=new te(N[0],N[1])),ge._rotateAround(Ke,ut),De._rotateAround(Ke,ut),Ye._rotateAround(Ke,ut),ht._rotateAround(Ke,ut),W=Math.min(ge.x,De.x,Ye.x,ht.x),Q=Math.max(ge.x,De.x,Ye.x,ht.x),j=Math.min(ge.y,De.y,Ye.y,ht.y),$=Math.max(ge.y,De.y,Ye.y,ht.y)}return s.emplaceBack(i.x,i.y,i.z,u.x,u.y,W,j,Q,$,A,f,m,b),s.length-1}function vg(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const i=s.bottom-s.top;return i>0?Math.max(10,i):null}function xg(s,i,u,f){const m=s.compareText;if(i in m){const b=m[i];for(let I=b.length-1;I>=0;I--)if(f.dist(b[I])<u)return!0}else m[i]=[];return m[i].push(f),!1}function Ld(s,i){const u=s.fovAboveCenter,f=s.elevation?s.elevation.getMinElevationBelowMSL()*i:0,m=(s._camera.position[2]*s.worldSize-f)/Math.cos(s._pitch),b=Math.sin(u)*m/Math.sin(Math.max(Math.PI/2-s._pitch-u,.01)),I=Math.sin(s._pitch)*b+m;return Math.min(1.01*I,m*(1/s._horizonShift))}function rf(s,i){if(!i.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:i};const u=Math.pow(2,-s.z),f=s.x*u,m=(s.x+1)*u,b=s.y*u,I=(s.y+1)*u,A=Ql(f),O=Ql(m),N=pu(b),j=pu(I),$=i.project(A,N),W=i.project(O,N),Q=i.project(O,j),ie=i.project(A,j);let ge=Math.min($.x,W.x,Q.x,ie.x),De=Math.min($.y,W.y,Q.y,ie.y),Ye=Math.max($.x,W.x,Q.x,ie.x),ht=Math.max($.y,W.y,Q.y,ie.y);const Ke=u/16;function ut(_t,Kt,Wt,hn,On,tn){const dn=(Wt+On)/2,mn=(hn+tn)/2,In=i.project(Ql(dn),pu(mn)),Un=Math.max(0,ge-In.x,De-In.y,In.x-Ye,In.y-ht);ge=Math.min(ge,In.x),Ye=Math.max(Ye,In.x),De=Math.min(De,In.y),ht=Math.max(ht,In.y),Un>Ke&&(ut(_t,In,Wt,hn,dn,mn),ut(In,Kt,dn,mn,On,tn))}ut($,W,f,b,m,b),ut(W,Q,m,b,m,I),ut(Q,ie,m,I,f,I),ut(ie,$,f,I,f,b),ge-=Ke,De-=Ke,Ye+=Ke,ht+=Ke;const xt=1/Math.max(Ye-ge,ht-De);return{scale:xt,x:ge*xt,y:De*xt,x2:Ye*xt,y2:ht*xt,projection:i}}const Hy=fu(new Float32Array(16));class rh{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,u){return{x:0,y:0,z:0}}unproject(i,u){return new cs(0,0)}projectTilePoint(i,u,f){return{x:i,y:u,z:0}}locationPoint(i,u,f=!0){return i._coordinatePoint(i.locationCoordinate(u),f)}pixelsPerMeter(i,u){return wh(1,i)*u}pixelSpaceConversion(i,u,f){return 1}farthestPixelDistance(i){return Ld(i,i.pixelsPerMeter)}pointCoordinate(i,u,f,m){const b=i.horizonLineFromTop(!1),I=new te(u,Math.max(b,f));return i.rayIntersectionCoordinate(i.pointRayIntersection(I,m))}pointCoordinate3D(i,u,f){const m=new te(u,f);if(i.elevation)return i.elevation.pointCoordinate(m);{const b=this.pointCoordinate(i,m.x,m.y,0);return[b.x,b.y,b.z]}}isPointAboveHorizon(i,u){if(i.elevation)return!this.pointCoordinate3D(i,u.x,u.y);const f=i.horizonLineFromTop();return u.y<f}createInversionMatrix(i,u){return Hy}createTileMatrix(i,u,f){let m,b,I;const A=f.canonical,O=fu(new Float64Array(16));if(this.isReprojectedInTileSpace){const N=rf(A,this);m=1,b=N.x+f.wrap*N.scale,I=N.y,eh(O,O,[m/N.scale,m/N.scale,i.pixelsPerMeter/u])}else m=u/i.zoomScale(A.z),b=(A.x+Math.pow(2,A.z)*f.wrap)*m,I=A.y*m;return Qc(O,O,[b,I,0]),eh(O,O,[m/Ir,m/Ir,1]),O}upVector(i,u,f){return[0,0,1]}upVectorScale(i,u,f){return{metersToTile:1}}}class km extends rh{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[u,f]=this.parallels=i.parallels||[29.5,45.5],m=Math.sin(Je(u));this.n=(m+Math.sin(Je(f)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(i,u){const{n:f,c:m,r0:b}=this,I=Je(i-this.center[0]),A=Je(u),O=Math.sqrt(m-2*f*Math.sin(A))/f;return{x:O*Math.sin(I*f),y:O*Math.cos(I*f)-b,z:0}}unproject(i,u){const{n:f,c:m,r0:b}=this,I=b+u;let A=Math.atan2(i,Math.abs(I))*Math.sign(I);I*f<0&&(A-=Math.PI*Math.sign(i)*Math.sign(I));const O=Je(this.center[0])*f;A=Ue(A,-Math.PI-O,Math.PI-O);const N=Le(He(A/f)+this.center[0],-180,180),j=Math.asin(Le((m-(i*i+I*I)*f*f)/(2*f),-1,1)),$=Le(He(j),-gu,gu);return new cs(N,$)}}const Th=1.340264,Sp=-.081106,Od=893e-6,nd=.003796,Bl=Math.sqrt(3)/2;class wg extends rh{project(i,u){u=u/180*Math.PI,i=i/180*Math.PI;const f=Math.asin(Bl*Math.sin(u)),m=f*f,b=m*m*m;return{x:.5*(i*Math.cos(f)/(Bl*(Th+3*Sp*m+b*(7*Od+9*nd*m)))/Math.PI+.5),y:1-.5*(f*(Th+Sp*m+b*(Od+nd*m))/Math.PI+1),z:0}}unproject(i,u){i=(2*i-.5)*Math.PI;let f=u=(2*(1-u)-1)*Math.PI,m=f*f,b=m*m*m;for(let j,$,W,Q=0;Q<12&&($=f*(Th+Sp*m+b*(Od+nd*m))-u,W=Th+3*Sp*m+b*(7*Od+9*nd*m),j=$/W,f=Le(f-j,-Math.PI/3,Math.PI/3),m=f*f,b=m*m*m,!(Math.abs(j)<1e-12));++Q);const I=Bl*i*(Th+3*Sp*m+b*(7*Od+9*nd*m))/Math.cos(f),A=Math.asin(Math.sin(f)/Bl),O=Le(180*I/Math.PI,-180,180),N=Le(180*A/Math.PI,-gu,gu);return new cs(O,N)}}class Wy extends rh{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,u){return{x:.5+i/360,y:.5-u/360,z:0}}unproject(i,u){const f=360*(i-.5),m=Le(360*(.5-u),-gu,gu);return new cs(f,m)}}const Nd=Math.PI/2;function Fm(s){return Math.tan((Nd+s)/2)}class P0 extends rh{constructor(i){super(i),this.center=i.center||[0,30];const[u,f]=this.parallels=i.parallels||[30,30];let m=Je(u),b=Je(f);this.southernCenter=m+b<0,this.southernCenter&&(m=-m,b=-b);const I=Math.cos(m),A=Fm(m);this.n=m===b?Math.sin(m):Math.log(I/Math.cos(b))/Math.log(Fm(b)/A),this.f=I*Math.pow(Fm(m),this.n)/this.n}project(i,u){u=Je(u),this.southernCenter&&(u=-u),i=Je(i-this.center[0]);const f=1e-6,{n:m,f:b}=this;b>0?u<-Nd+f&&(u=-Nd+f):u>Nd-f&&(u=Nd-f);const I=b/Math.pow(Fm(u),m);let A=I*Math.sin(m*i),O=b-I*Math.cos(m*i);return A=.5*(A/Math.PI+.5),O=.5*(O/Math.PI+.5),{x:A,y:this.southernCenter?O:1-O,z:0}}unproject(i,u){i=(2*i-.5)*Math.PI,this.southernCenter&&(u=1-u),u=(2*(1-u)-.5)*Math.PI;const{n:f,f:m}=this,b=m-u,I=Math.sign(b),A=Math.sign(f)*Math.sqrt(i*i+b*b);let O=Math.atan2(i,Math.abs(b))*I;b*f<0&&(O-=Math.PI*Math.sign(i)*I);const N=Le(He(O/f)+this.center[0],-180,180),j=Le(He(2*Math.atan(Math.pow(m/A,1/f))-Nd),-gu,gu);return new cs(N,this.southernCenter?-j:j)}}class bg extends rh{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,u){return{x:Yh(i),y:Kh(u),z:0}}unproject(i,u){const f=Ql(i),m=pu(u);return new cs(f,m)}}const Xy=Je(gu);class Zy extends rh{project(i,u){const f=(u=Je(u))*u,m=f*f;return{x:.5*((i=Je(i))*(.8707-.131979*f+m*(m*(.003971*f-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(u*(1.007226+f*(.015085+m*(.028874*f-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(i,u){i=(2*i-.5)*Math.PI;let f=u=(2*(1-u)-1)*Math.PI,m=25,b=0,I=f*f;do{I=f*f;const N=I*I;b=(f*(1.007226+I*(.015085+N*(.028874*I-.044475-.005916*N)))-u)/(1.007226+I*(.045255+N*(.259866*I-.311325-.005916*11*N))),f=Le(f-b,-Xy,Xy)}while(Math.abs(b)>1e-6&&--m>0);I=f*f;const A=Le(He(i/(.8707+I*(I*(I*I*I*(.003971-.001529*I)-.013791)-.131979))),-180,180),O=He(f);return new cs(A,O)}}const Q_=Je(gu);class cx extends rh{project(i,u){u=Je(u),i=Je(i);const f=Math.cos(u),m=2/Math.PI,b=Math.acos(f*Math.cos(i/2)),I=Math.sin(b)/b,A=.5*(i*m+2*f*Math.sin(i/2)/I)||0,O=.5*(u+Math.sin(u)/I)||0;return{x:.5*(A/Math.PI+.5),y:1-.5*(O/Math.PI+1),z:0}}unproject(i,u){let f=i=(2*i-.5)*Math.PI,m=u=(2*(1-u)-1)*Math.PI,b=25;const I=1e-6;let A=0,O=0;do{const N=Math.cos(m),j=Math.sin(m),$=2*j*N,W=j*j,Q=N*N,ie=Math.cos(f/2),ge=Math.sin(f/2),De=2*ie*ge,Ye=ge*ge,ht=1-Q*ie*ie,Ke=ht?1/ht:0,ut=ht?Math.acos(N*ie)*Math.sqrt(1/ht):0,xt=.5*(2*ut*N*ge+2*f/Math.PI)-i,_t=.5*(ut*j+m)-u,Kt=.5*Ke*(Q*Ye+ut*N*ie*W)+1/Math.PI,Wt=Ke*(De*$/4-ut*j*ge),hn=.125*Ke*($*ge-ut*j*Q*De),On=.5*Ke*(W*ie+ut*Ye*N)+.5,tn=Wt*hn-On*Kt;A=(_t*Wt-xt*On)/tn,O=(xt*hn-_t*Kt)/tn,f=Le(f-A,-Math.PI,Math.PI),m=Le(m-O,-Q_,Q_)}while((Math.abs(A)>I||Math.abs(O)>I)&&--b>0);return new cs(He(f),He(m))}}class ev extends rh{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Je(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,u){const{scale:f,cosPhi:m}=this;return{x:Je(i)*m*f+.5,y:-Math.sin(Je(u))/m*f+.5,z:0}}unproject(i,u){const{scale:f,cosPhi:m}=this,b=-(u-.5)/f,I=Le(He((i-.5)/f)/m,-180,180),A=Math.asin(Le(b*m,-1,1)),O=Le(He(A),-gu,gu);return new cs(I,O)}}class Yy extends bg{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,u,f){const m=Ll(i,u,f);return ra(m,m,Wf(xh(f))),{x:m[0],y:m[1],z:m[2]}}locationPoint(i,u){const f=np(u.lat,u.lng),m=Vu([],f),b=i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(u),i._centerAltitude):i._centerAltitude;bd(f,f,m,wh(1,0)*Ir*b);const I=fu(new Float64Array(16));return Jc(I,i.pixelMatrix,i.globeMatrix),ra(f,f,I),new te(f[0],f[1])}pixelsPerMeter(i,u){return wh(1,0)*u}pixelSpaceConversion(i,u,f){const m=wh(1,i)*u,b=qn(wh(1,45)*u,m,f);return this.pixelsPerMeter(i,u)/b}createTileMatrix(i,u,f){const m=df(xh(f.canonical));return Jc(new Float64Array(16),i.globeMatrix,m)}createInversionMatrix(i,u){const{center:f}=i,m=Wf(xh(u));return yd(m,m,Je(f.lng)),iy(m,m,Je(f.lat)),eh(m,m,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(i,u,f,m){return Kl(i,u,f,!0)||new mf(0,0)}pointCoordinate3D(i,u,f){const m=this.pointCoordinate(i,u,f,0);return[m.x,m.y,m.z]}isPointAboveHorizon(i,u){return!Kl(i,u.x,u.y,!1)}farthestPixelDistance(i){const u=function(m,b){const I=m.cameraToCenterDistance,A=m._centerAltitude*b,O=m._camera,N=m._camera.forward(),j=th([],vc([],N,-I),[0,0,A]),$=m.worldSize/(2*Math.PI),W=[0,0,-$],Q=m.width/m.height,ie=Math.tan(m.fovAboveCenter),ge=vc([],O.up(),ie),De=vc([],O.right(),ie*Q),Ye=Vu([],th([],th([],N,ge),De)),ht=[];let Ke;if(new Xh(j,Ye).closestPointOnSphere(W,$,ht)){const ut=th([],ht,W),xt=wc([],ut,j);Ke=Math.cos(m.fovAboveCenter)*_d(xt)}else{const ut=wc([],j,W),xt=wc([],W,j);Vu(xt,xt);const _t=_d(ut)-$;Ke=Math.sqrt(_t*(_t+2*$));const Kt=Math.acos(Ke/($+_t))-Math.acos(ou(N,xt));Ke*=Math.cos(Kt)}return 1.01*Ke}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),f=pf(i.zoom);if(f>0){const m=Ld(i,wh(1,i.center.lat)*i.worldSize),b=i.worldSize/(2*Math.PI),I=Math.max(i.width,i.height)/i.worldSize*Math.PI;return qn(u,m+b*(1-Math.cos(I)),Math.pow(f,10))}return u}upVector(i,u,f){return Ll(u,f,i,1)}upVectorScale(i){return{metersToTile:vh(ff(xh(i)))}}}function Eg(s){const i=s.parallels,u=!!i&&Math.abs(i[0]+i[1])<.01;switch(s.name){case"mercator":return new bg(s);case"equirectangular":return new Wy(s);case"naturalEarth":return new Zy(s);case"equalEarth":return new wg(s);case"winkelTripel":return new cx(s);case"albers":return u?new ev(s):new km(s);case"lambertConformalConic":return u?new ev(s):new P0(s);case"globe":return new Yy(s)}throw new Error(`Invalid projection name: ${s.name}`)}const R0=ug.types,tv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ip(s,i,u,f,m,b,I,A,O,N,j,$,W){const Q=A?Math.min(Rd,Math.round(A[0])):0,ie=A?Math.min(Rd,Math.round(A[1])):0;s.emplaceBack(i,u,Math.round(32*f),Math.round(32*m),b,I,(Q<<1)+(O?1:0),ie,16*N,16*j,256*$,256*W)}function Cf(s,i,u,f,m,b,I){s.emplaceBack(i,u,f,m,b,I)}function Tp(s,i,u,f,m){s.emplaceBack(i,u,f,m),s.emplaceBack(i,u,f,m),s.emplaceBack(i,u,f,m),s.emplaceBack(i,u,f,m)}function nv(s){for(const i of s.sections)if($p(i.text))return!0;return!1}class Ky{constructor(i){this.layoutVertexArray=new vn,this.indexArray=new yr,this.programConfigurations=i,this.segments=new Ns,this.dynamicLayoutVertexArray=new gn,this.opacityVertexArray=new wr,this.placedSymbolArray=new Wr,this.globeExtVertexArray=new Ln}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(i,u,f,m){this.isEmpty()||(f&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,fg.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,$a.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,tv,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,Pa.members,!0)),this.opacityVertexBuffer.itemSize=1),(f||m)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Gn(Ky,"SymbolBuffers");class Bm{constructor(i,u,f){this.layoutVertexArray=new i,this.layoutAttributes=u,this.indexArray=new f,this.segments=new Ns,this.collisionVertexArray=new Xn,this.collisionVertexArrayExt=new ci}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Ny.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,x0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Gn(Bm,"CollisionBuffers");class kd{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(I=>I.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=fu([]),this.placementViewportMatrix=fu([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Qh(this.zoom,u["text-size"]),this.iconSizeData=Qh(this.zoom,u["icon-size"]);const f=this.layers[0].layout,m=f.get("symbol-sort-key"),b=f.get("symbol-z-order");this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==b&&void 0!==m.constantOr(1),this.sortFeaturesByY=("viewport-y"===b||"auto"===b&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=f.get("text-writing-mode").map(I=>Fl[I]),this.stateDependentLayerIds=this.layers.filter(I=>I.isStateDependent()).map(I=>I.id),this.sourceID=i.sourceID,this.projection=i.projection}createArrays(){this.text=new Ky(new ja(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Ky(new ja(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new xs,this.lineVertexArray=new zf,this.symbolInstances=new vs}calculateGlyphDependencies(i,u,f,m,b){for(let I=0;I<i.length;I++)if(u[i.charCodeAt(I)]=!0,m&&b){const A=dg[i.charAt(I)];A&&(u[A.charCodeAt(0)]=!0)}}populate(i,u,f,m){const b=this.layers[0],I=b.layout,A="globe"===this.projection.name,O=I.get("text-font"),N=I.get("text-field"),j=I.get("icon-image"),$=("constant"!==N.value.kind||N.value.value instanceof Us&&!N.value.value.isEmpty()||N.value.value.toString().length>0)&&("constant"!==O.value.kind||O.value.value.length>0),W="constant"!==j.value.kind||!!j.value.value||Object.keys(j.parameters).length>0,Q=I.get("symbol-sort-key");if(this.features=[],!$&&!W)return;const ie=u.iconDependencies,ge=u.glyphDependencies,De=u.availableImages,Ye=new G(this.zoom);for(const{feature:ht,id:Ke,index:ut,sourceLayerIndex:xt}of i){const _t=b._featureFilter.needGeometry,Kt=bh(ht,_t);if(!b._featureFilter.filter(Ye,Kt,f))continue;if(_t||(Kt.geometry=ec(ht,f,m)),A&&1!==ht.type&&f.z<=5){const tn=Kt.geometry,dn=.98078528056,mn=(In,Un)=>ou(Ll(In.x,In.y,f,1),Ll(Un.x,Un.y,f,1))<dn;for(let In=0;In<tn.length;In++)tn[In]=Jp(tn[In],mn)}let Wt,hn;if($){const tn=b.getValueAndResolveTokens("text-field",Kt,f,De),dn=Us.factory(tn);nv(dn)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===P()||this.hasRTLText&&z.isParsed())&&(Wt=ox(dn,b,Kt))}if(W){const tn=b.getValueAndResolveTokens("icon-image",Kt,f,De);hn=tn instanceof Ti?tn:Ti.fromString(tn)}if(!Wt&&!hn)continue;const On=this.sortFeaturesByKey?Q.evaluate(Kt,{},f):void 0;if(this.features.push({id:Ke,text:Wt,icon:hn,index:ut,sourceLayerIndex:xt,geometry:Kt.geometry,properties:ht.properties,type:R0[ht.type],sortKey:On}),hn&&(ie[hn.name]=!0),Wt){const tn=O.evaluate(Kt,{},f).join(","),dn="map"===I.get("text-rotation-alignment")&&"point"!==I.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Fl.vertical)>=0;for(const mn of Wt.sections)if(mn.image)ie[mn.image.name]=!0;else{const In=Bg(Wt.toString()),Un=mn.fontStack||tn,cn=ge[Un]=ge[Un]||{};this.calculateGlyphDependencies(mn.text,cn,dn,this.allowVerticalPlacement,In)}}}"line"===I.get("symbol-placement")&&(this.features=function(ht){const Ke={},ut={},xt=[];let _t=0;function Kt(tn){xt.push(ht[tn]),_t++}function Wt(tn,dn,mn){const In=ut[tn];return delete ut[tn],ut[dn]=In,xt[In].geometry[0].pop(),xt[In].geometry[0]=xt[In].geometry[0].concat(mn[0]),In}function hn(tn,dn,mn){const In=Ke[dn];return delete Ke[dn],Ke[tn]=In,xt[In].geometry[0].shift(),xt[In].geometry[0]=mn[0].concat(xt[In].geometry[0]),In}function On(tn,dn,mn){const In=mn?dn[0][dn[0].length-1]:dn[0][0];return`${tn}:${In.x}:${In.y}`}for(let tn=0;tn<ht.length;tn++){const dn=ht[tn],mn=dn.geometry,In=dn.text?dn.text.toString():null;if(!In){Kt(tn);continue}const Un=On(In,mn),cn=On(In,mn,!0);if(Un in ut&&cn in Ke&&ut[Un]!==Ke[cn]){const Zn=hn(Un,cn,mn),nr=Wt(Un,cn,xt[Zn].geometry);delete Ke[Un],delete ut[cn],ut[On(In,xt[nr].geometry,!0)]=nr,xt[Zn].geometry=null}else Un in ut?Wt(Un,cn,mn):cn in Ke?hn(Un,cn,mn):(Kt(tn),Ke[Un]=_t-1,ut[cn]=_t-1)}return xt.filter(tn=>tn.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ht,Ke)=>ht.sortKey-Ke.sortKey)}update(i,u,f,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,u,this.layers,f,m),this.icon.programConfigurations.updatePaintArrays(i,u,this.layers,f,m))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Eg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,u){const f=this.lineVertexArray.length;if(void 0!==i.segment)for(const{x:m,y:b}of u)this.lineVertexArray.emplaceBack(m,b);return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(i,u,f,m,b,I,A,O,N,j,$,W,Q,ie){const ge=i.indexArray,De=i.layoutVertexArray,Ye=i.globeExtVertexArray,ht=i.segments.prepareSegment(4*u.length,De,ge,this.canOverlap?I.sortKey:void 0),Ke=this.glyphOffsetArray.length,ut=ht.vertexLength,xt=this.allowVerticalPlacement&&A===Fl.vertical?Math.PI/2:0,_t=I.text&&I.text.sections;for(let Wt=0;Wt<u.length;Wt++){const{tl:hn,tr:On,bl:tn,br:dn,tex:mn,pixelOffsetTL:In,pixelOffsetBR:Un,minFontScaleX:cn,minFontScaleY:Zn,glyphOffset:nr,isSDF:Yn,sectionIndex:xi}=u[Wt],Vn=ht.vertexLength,Mr=nr[1];if(Ip(De,N.x,N.y,hn.x,Mr+hn.y,mn.x,mn.y,f,Yn,In.x,In.y,cn,Zn),Ip(De,N.x,N.y,On.x,Mr+On.y,mn.x+mn.w,mn.y,f,Yn,Un.x,In.y,cn,Zn),Ip(De,N.x,N.y,tn.x,Mr+tn.y,mn.x,mn.y+mn.h,f,Yn,In.x,Un.y,cn,Zn),Ip(De,N.x,N.y,dn.x,Mr+dn.y,mn.x+mn.w,mn.y+mn.h,f,Yn,Un.x,Un.y,cn,Zn),O){const{x:yi,y:go,z:ui}=O.anchor,[Fr,oa,wi]=O.up;Cf(Ye,yi,go,ui,Fr,oa,wi),Cf(Ye,yi,go,ui,Fr,oa,wi),Cf(Ye,yi,go,ui,Fr,oa,wi),Cf(Ye,yi,go,ui,Fr,oa,wi),Tp(i.dynamicLayoutVertexArray,yi,go,ui,xt)}else Tp(i.dynamicLayoutVertexArray,N.x,N.y,N.z,xt);ge.emplaceBack(Vn,Vn+1,Vn+2),ge.emplaceBack(Vn+1,Vn+2,Vn+3),ht.vertexLength+=4,ht.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(nr[0]),Wt!==u.length-1&&xi===u[Wt+1].sectionIndex||i.programConfigurations.populatePaintArrays(De.length,I,I.index,{},Q,ie,_t&&_t[xi])}const Kt=O?O.anchor:N;i.placedSymbolArray.emplaceBack(Kt.x,Kt.y,Kt.z,N.x,N.y,Ke,this.glyphOffsetArray.length-Ke,ut,j,$,N.segment,f?f[0]:0,f?f[1]:0,m[0],m[1],A,0,!1,0,W,0)}_commitLayoutVertex(i,u,f,m,b,I,A){i.emplaceBack(u,f,m,b,I,Math.round(A.x),Math.round(A.y))}_addCollisionDebugVertices(i,u,f,m,b,I,A){const O=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),N=O.vertexLength,j=A.tileAnchorX,$=A.tileAnchorY;for(let Q=0;Q<4;Q++)f.collisionVertexArray.emplaceBack(0,0,0,0);f.collisionVertexArrayExt.emplaceBack(u,-i.padding,-i.padding),f.collisionVertexArrayExt.emplaceBack(u,i.padding,-i.padding),f.collisionVertexArrayExt.emplaceBack(u,i.padding,i.padding),f.collisionVertexArrayExt.emplaceBack(u,-i.padding,i.padding),this._commitLayoutVertex(f.layoutVertexArray,m,b,I,j,$,new te(i.x1,i.y1)),this._commitLayoutVertex(f.layoutVertexArray,m,b,I,j,$,new te(i.x2,i.y1)),this._commitLayoutVertex(f.layoutVertexArray,m,b,I,j,$,new te(i.x2,i.y2)),this._commitLayoutVertex(f.layoutVertexArray,m,b,I,j,$,new te(i.x1,i.y2)),O.vertexLength+=4;const W=f.indexArray;W.emplaceBack(N,N+1),W.emplaceBack(N+1,N+2),W.emplaceBack(N+2,N+3),W.emplaceBack(N+3,N),O.primitiveLength+=4}_addTextDebugCollisionBoxes(i,u,f,m,b,I){for(let A=m;A<b;A++){const O=f.get(A),N=this.getSymbolInstanceTextSize(i,I,u,A);this._addCollisionDebugVertices(O,N,this.textCollisionBox,O.projectedAnchorX,O.projectedAnchorY,O.projectedAnchorZ,I)}}_addIconDebugCollisionBoxes(i,u,f,m,b,I){for(let A=m;A<b;A++){const O=f.get(A),N=this.getSymbolInstanceIconSize(i,u,I.placedIconSymbolIndex);this._addCollisionDebugVertices(O,N,this.iconCollisionBox,O.projectedAnchorX,O.projectedAnchorY,O.projectedAnchorZ,I)}}generateCollisionDebugBuffers(i,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Bm(or,B_.members,Iu),this.iconCollisionBox=new Bm(or,B_.members,Iu);const f=ef(this.iconSizeData,i),m=ef(this.textSizeData,i);for(let b=0;b<this.symbolInstances.length;b++){const I=this.symbolInstances.get(b);this._addTextDebugCollisionBoxes(m,i,u,I.textBoxStartIndex,I.textBoxEndIndex,I),this._addTextDebugCollisionBoxes(m,i,u,I.verticalTextBoxStartIndex,I.verticalTextBoxEndIndex,I),this._addIconDebugCollisionBoxes(f,i,u,I.iconBoxStartIndex,I.iconBoxEndIndex,I),this._addIconDebugCollisionBoxes(f,i,u,I.verticalIconBoxStartIndex,I.verticalIconBoxEndIndex,I)}}getSymbolInstanceTextSize(i,u,f,m){const b=this.text.placedSymbolArray.get(u.rightJustifiedTextSymbolIndex>=0?u.rightJustifiedTextSymbolIndex:u.centerJustifiedTextSymbolIndex>=0?u.centerJustifiedTextSymbolIndex:u.leftJustifiedTextSymbolIndex>=0?u.leftJustifiedTextSymbolIndex:u.verticalPlacedTextSymbolIndex>=0?u.verticalPlacedTextSymbolIndex:m),I=xf(this.textSizeData,i,b)/ju;return this.tilePixelRatio*I}getSymbolInstanceIconSize(i,u,f){const m=this.icon.placedSymbolArray.get(f),b=xf(this.iconSizeData,i,m);return this.tilePixelRatio*b}_commitDebugCollisionVertexUpdate(i,u,f){i.emplaceBack(u,-f,-f),i.emplaceBack(u,f,-f),i.emplaceBack(u,f,f),i.emplaceBack(u,-f,f)}_updateTextDebugCollisionBoxes(i,u,f,m,b,I){for(let A=m;A<b;A++){const O=f.get(A),N=this.getSymbolInstanceTextSize(i,I,u,A);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,N,O.padding)}}_updateIconDebugCollisionBoxes(i,u,f,m,b,I){for(let A=m;A<b;A++){const O=f.get(A),N=this.getSymbolInstanceIconSize(i,u,I);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,N,O.padding)}}updateCollisionDebugBuffers(i,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=ef(this.iconSizeData,i),m=ef(this.textSizeData,i);for(let b=0;b<this.symbolInstances.length;b++){const I=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(m,i,u,I.textBoxStartIndex,I.textBoxEndIndex,I),this._updateTextDebugCollisionBoxes(m,i,u,I.verticalTextBoxStartIndex,I.verticalTextBoxEndIndex,I),this._updateIconDebugCollisionBoxes(f,i,u,I.iconBoxStartIndex,I.iconBoxEndIndex,I.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(f,i,u,I.verticalIconBoxStartIndex,I.verticalIconBoxEndIndex,I.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,u,f,m,b,I,A,O,N){const j={};if(u<f){const{x1:$,y1:W,x2:Q,y2:ie,padding:ge,projectedAnchorX:De,projectedAnchorY:Ye,projectedAnchorZ:ht,tileAnchorX:Ke,tileAnchorY:ut,featureIndex:xt}=i.get(u);j.textBox={x1:$,y1:W,x2:Q,y2:ie,padding:ge,projectedAnchorX:De,projectedAnchorY:Ye,projectedAnchorZ:ht,tileAnchorX:Ke,tileAnchorY:ut},j.textFeatureIndex=xt}if(m<b){const{x1:$,y1:W,x2:Q,y2:ie,padding:ge,projectedAnchorX:De,projectedAnchorY:Ye,projectedAnchorZ:ht,tileAnchorX:Ke,tileAnchorY:ut,featureIndex:xt}=i.get(m);j.verticalTextBox={x1:$,y1:W,x2:Q,y2:ie,padding:ge,projectedAnchorX:De,projectedAnchorY:Ye,projectedAnchorZ:ht,tileAnchorX:Ke,tileAnchorY:ut},j.verticalTextFeatureIndex=xt}if(I<A){const{x1:$,y1:W,x2:Q,y2:ie,padding:ge,projectedAnchorX:De,projectedAnchorY:Ye,projectedAnchorZ:ht,tileAnchorX:Ke,tileAnchorY:ut,featureIndex:xt}=i.get(I);j.iconBox={x1:$,y1:W,x2:Q,y2:ie,padding:ge,projectedAnchorX:De,projectedAnchorY:Ye,projectedAnchorZ:ht,tileAnchorX:Ke,tileAnchorY:ut},j.iconFeatureIndex=xt}if(O<N){const{x1:$,y1:W,x2:Q,y2:ie,padding:ge,projectedAnchorX:De,projectedAnchorY:Ye,projectedAnchorZ:ht,tileAnchorX:Ke,tileAnchorY:ut,featureIndex:xt}=i.get(O);j.verticalIconBox={x1:$,y1:W,x2:Q,y2:ie,padding:ge,projectedAnchorX:De,projectedAnchorY:Ye,projectedAnchorZ:ht,tileAnchorX:Ke,tileAnchorY:ut},j.verticalIconFeatureIndex=xt}return j}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,u){const f=i.placedSymbolArray.get(u),m=f.vertexStartIndex+4*f.numGlyphs;for(let b=f.vertexStartIndex;b<m;b+=4)i.indexArray.emplaceBack(b,b+1,b+2),i.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const u=Math.sin(i),f=Math.cos(i),m=[],b=[],I=[];for(let A=0;A<this.symbolInstances.length;++A){I.push(A);const O=this.symbolInstances.get(A);m.push(0|Math.round(u*O.tileAnchorX+f*O.tileAnchorY)),b.push(O.featureIndex)}return I.sort((A,O)=>m[A]-m[O]||b[O]-b[A]),I}addToSortKeyRanges(i,u){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const f=this.symbolInstances.get(u);this.featureSortOrder.push(f.featureIndex);const{rightJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:b,leftJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:A,placedIconSymbolIndex:O,verticalPlacedIconSymbolIndex:N}=f;m>=0&&this.addIndicesForPlacedSymbol(this.text,m),b>=0&&b!==m&&this.addIndicesForPlacedSymbol(this.text,b),I>=0&&I!==b&&I!==m&&this.addIndicesForPlacedSymbol(this.text,I),A>=0&&this.addIndicesForPlacedSymbol(this.text,A),O>=0&&this.addIndicesForPlacedSymbol(this.icon,O),N>=0&&this.addIndicesForPlacedSymbol(this.icon,N)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Gn(kd,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),kd.MAX_GLYPHS=65535,kd.addDynamicAttributes=Tp;const L0=new Qe({"symbol-placement":new ue(on.layout_symbol["symbol-placement"]),"symbol-spacing":new ue(on.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ue(on.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fe(on.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ue(on.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ue(on.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ue(on.layout_symbol["icon-ignore-placement"]),"icon-optional":new ue(on.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ue(on.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fe(on.layout_symbol["icon-size"]),"icon-text-fit":new ue(on.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ue(on.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fe(on.layout_symbol["icon-image"]),"icon-rotate":new Fe(on.layout_symbol["icon-rotate"]),"icon-padding":new ue(on.layout_symbol["icon-padding"]),"icon-keep-upright":new ue(on.layout_symbol["icon-keep-upright"]),"icon-offset":new Fe(on.layout_symbol["icon-offset"]),"icon-anchor":new Fe(on.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ue(on.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ue(on.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ue(on.layout_symbol["text-rotation-alignment"]),"text-field":new Fe(on.layout_symbol["text-field"]),"text-font":new Fe(on.layout_symbol["text-font"]),"text-size":new Fe(on.layout_symbol["text-size"]),"text-max-width":new Fe(on.layout_symbol["text-max-width"]),"text-line-height":new Fe(on.layout_symbol["text-line-height"]),"text-letter-spacing":new Fe(on.layout_symbol["text-letter-spacing"]),"text-justify":new Fe(on.layout_symbol["text-justify"]),"text-radial-offset":new Fe(on.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ue(on.layout_symbol["text-variable-anchor"]),"text-anchor":new Fe(on.layout_symbol["text-anchor"]),"text-max-angle":new ue(on.layout_symbol["text-max-angle"]),"text-writing-mode":new ue(on.layout_symbol["text-writing-mode"]),"text-rotate":new Fe(on.layout_symbol["text-rotate"]),"text-padding":new ue(on.layout_symbol["text-padding"]),"text-keep-upright":new ue(on.layout_symbol["text-keep-upright"]),"text-transform":new Fe(on.layout_symbol["text-transform"]),"text-offset":new Fe(on.layout_symbol["text-offset"]),"text-allow-overlap":new ue(on.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ue(on.layout_symbol["text-ignore-placement"]),"text-optional":new ue(on.layout_symbol["text-optional"])});var Mp={paint:new Qe({"icon-opacity":new Fe(on.paint_symbol["icon-opacity"]),"icon-color":new Fe(on.paint_symbol["icon-color"]),"icon-halo-color":new Fe(on.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fe(on.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fe(on.paint_symbol["icon-halo-blur"]),"icon-translate":new ue(on.paint_symbol["icon-translate"]),"icon-translate-anchor":new ue(on.paint_symbol["icon-translate-anchor"]),"text-opacity":new Fe(on.paint_symbol["text-opacity"]),"text-color":new Fe(on.paint_symbol["text-color"],{runtimeType:Ya,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Fe(on.paint_symbol["text-halo-color"]),"text-halo-width":new Fe(on.paint_symbol["text-halo-width"]),"text-halo-blur":new Fe(on.paint_symbol["text-halo-blur"]),"text-translate":new ue(on.paint_symbol["text-translate"]),"text-translate-anchor":new ue(on.paint_symbol["text-translate-anchor"])}),layout:L0};class rv{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Pc,this.defaultValue=i}evaluate(i){if(i.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(i.formattedSection))return u.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Gn(rv,"FormatSectionOverride",{omit:["defaultValue"]});class Sf extends _c{constructor(i){super(i,Mp)}recalculate(i,u){super.recalculate(i,u),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const f=this.layout.get("text-writing-mode");if(f){const m=[];for(const b of f)m.indexOf(b)<0&&m.push(b);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(i,u,f,m){const b=this.layout.get(i).evaluate(u,{},f,m),I=this._unevaluatedLayout._values[i];return I.isDataDriven()||pr(I.value)||!b?b:(A=u.properties,b.replace(/{([^{}]+)}/g,(N,j)=>j in A?String(A[j]):""));var A}createBucket(i){return new kd(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of Mp.paint.overridableProperties){if(!Sf.hasPaintOverride(this.layout,i))continue;const u=this.paint.get(i),f=new rv(u),m=new nl(f,u.property.specification);let b=null;b="constant"===u.value.kind||"source"===u.value.kind?new Dl("source",m):new za("composite",m,u.value.zoomStops,u.value._interpolationType),this.paint._values[i]=new je(u.property,b,u.parameters)}}_handleOverridablePaintPropertyUpdate(i,u,f){return!(!this.layout||u.isDataDriven()||f.isDataDriven())&&Sf.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,u){const f=i.get("text-field"),m=Mp.paint.properties[u];let b=!1;const I=A=>{for(const O of A)if(m.overrides&&m.overrides.hasOverride(O))return void(b=!0)};if("constant"===f.value.kind&&f.value.value instanceof Us)I(f.value.value.sections);else if("source"===f.value.kind){const A=N=>{b||(N instanceof la&&As(N.value)===Gl?I(N.value.sections):N instanceof Mi?I(N.sections):N.eachChild(A))},O=f.value;O._styleExpression&&A(O._styleExpression.expression)}return b}getProgramConfiguration(i){return new cf(this,i)}}var rd={paint:new Qe({"background-color":new ue(on.paint_background["background-color"]),"background-pattern":new ue(on.paint_background["background-pattern"]),"background-opacity":new ue(on.paint_background["background-opacity"])})},O0={paint:new Qe({"raster-opacity":new ue(on.paint_raster["raster-opacity"]),"raster-hue-rotate":new ue(on.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ue(on.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ue(on.paint_raster["raster-brightness-max"]),"raster-saturation":new ue(on.paint_raster["raster-saturation"]),"raster-contrast":new ue(on.paint_raster["raster-contrast"]),"raster-resampling":new ue(on.paint_raster["raster-resampling"]),"raster-fade-duration":new ue(on.paint_raster["raster-fade-duration"])})};class iv extends _c{constructor(i){super(i,{}),this.implementation=i}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var zm={paint:new Qe({"sky-type":new ue(on.paint_sky["sky-type"]),"sky-atmosphere-sun":new ue(on.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ue(on.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ue(on.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ue(on.paint_sky["sky-gradient-radius"]),"sky-gradient":new nt(on.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ue(on.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ue(on.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ue(on.paint_sky["sky-opacity"])})};function Jy(s,i,u){const f=[0,0,1],m=$g([]);return Hh(m,m,u?-Je(s)+Math.PI:Je(s)),Ed(m,m,-Je(i)),Xp(f,f,m),Vu(f,f)}const N0={circle:class extends _c{constructor(s){super(s,my)}createBucket(s){return new Kg(s)}queryRadius(s){const i=s;return sp("circle-radius",this,i)+sp("circle-stroke-width",this,i)+Qg(this.paint.get("circle-translate"))}queryIntersectsFeature(s,i,u,f,m,b,I,A){const O=s0(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),b.angle,s.pixelToTileUnitsFactor),N=this.paint.get("circle-radius").evaluate(i,u)+this.paint.get("circle-stroke-width").evaluate(i,u);return a0(s,f,b,I,A,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),O,N)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new cf(this,s)}},heatmap:class extends _c{createBucket(s){return new D_(s)}constructor(s){super(s,ap),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"heatmap-color"===s&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=rm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return sp("heatmap-radius",this,s)}queryIntersectsFeature(s,i,u,f,m,b,I,A){const O=this.paint.get("heatmap-radius").evaluate(i,u);return a0(s,f,b,I,A,!0,!0,new te(0,0),O)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new cf(this,s)}},hillshade:class extends _c{constructor(s){super(s,im)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends _c{constructor(s){super(s,O_)}getProgramIds(){const s=this.paint.get("fill-pattern"),i=s&&s.constantOr(1),u=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&u.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),u}getProgramConfiguration(s){return new cf(this,s)}recalculate(s,i){super.recalculate(s,i);const u=this.paint._values["fill-outline-color"];"constant"===u.value.kind&&void 0===u.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new _f(s)}queryRadius(){return Qg(this.paint.get("fill-translate"))}queryIntersectsFeature(s,i,u,f,m,b){return!s.queryGeometry.isAboveHorizon&&jc(em(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),b.angle,s.pixelToTileUnitsFactor),f)}isTileClipped(){return!0}},"fill-extrusion":class extends _c{constructor(s){super(s,Py)}createBucket(s){return new dp(s)}queryRadius(){return Qg(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new cf(this,s)}queryIntersectsFeature(s,i,u,f,m,b,I,A,O){const N=s0(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),b.angle,s.pixelToTileUnitsFactor),j=this.paint.get("fill-extrusion-height").evaluate(i,u),$=this.paint.get("fill-extrusion-base").evaluate(i,u),W=[0,0],Q=A&&b.elevation,ie=b.elevation?b.elevation.exaggeration():1,ge=s.tile.getBucket(this);if(Q&&ge instanceof dp){const ut=ge.centroidVertexArray,xt=O+1;xt<ut.length&&(W[0]=ut.geta_centroid_pos0(xt),W[1]=ut.geta_centroid_pos1(xt))}if(0===W[0]&&1===W[1])return!1;"globe"===b.projection.name&&(f=cg([f],[new te(0,0),new te(Ir,Ir)],s.tileID.canonical).map(ut=>ut.polygon).flat());const De=Q?A:null,[Ye,ht]=(xt=f,_t=$,Kt=j,Wt=N,hn=I,On=De,tn=W,dn=ie,mn=b.center.lat,"globe"===(ut=b).projection.name?function(Un,cn,Zn,nr,Yn,xi,Vn,Mr,yi,go,ui){const Fr=[],oa=[],wi=Un.projection.upVectorScale(ui,Un.center.lat,Un.worldSize).metersToTile,bi=[0,0,0,1],Ss=[0,0,0,1],ks=(oo,Ca,qa,Ha)=>{oo[0]=Ca,oo[1]=qa,oo[2]=Ha,oo[3]=1},Is=_m();Zn>0&&(Zn+=Is),nr+=Is;for(const oo of cn){const Ca=[],qa=[];for(const Ha of oo){const Fs=Ha.x+Yn.x,Mu=Ha.y+Yn.y,yu=Un.projection.projectTilePoint(Fs,Mu,ui),Wa=Un.projection.upVector(ui,Ha.x,Ha.y);let xo=Zn,_u=nr;if(Vn){const ws=Ea(Fs,Mu,Zn,nr,Vn,Mr,yi,go);xo+=ws.base,_u+=ws.top}0!==Zn?ks(bi,yu.x+Wa[0]*wi*xo,yu.y+Wa[1]*wi*xo,yu.z+Wa[2]*wi*xo):ks(bi,yu.x,yu.y,yu.z),ks(Ss,yu.x+Wa[0]*wi*_u,yu.y+Wa[1]*wi*_u,yu.z+Wa[2]*wi*_u),ra(bi,bi,xi),ra(Ss,Ss,xi),Ca.push(new Ii(bi[0],bi[1],bi[2])),qa.push(new Ii(Ss[0],Ss[1],Ss[2]))}Fr.push(Ca),oa.push(qa)}return[Fr,oa]}(ut,xt,_t,Kt,Wt,hn,On,tn,dn,mn,s.tileID.canonical):On?function(Un,cn,Zn,nr,Yn,xi,Vn,Mr,yi){const go=[],ui=[],Fr=[0,0,0,1];for(const oa of Un){const wi=[],bi=[];for(const Ss of oa){const ks=Ss.x+nr.x,Is=Ss.y+nr.y,oo=Ea(ks,Is,cn,Zn,xi,Vn,Mr,yi);Fr[0]=ks,Fr[1]=Is,Fr[2]=oo.base,Fr[3]=1,$f(Fr,Fr,Yn),Fr[3]=Math.max(Fr[3],1e-5);const Ca=new Ii(Fr[0]/Fr[3],Fr[1]/Fr[3],Fr[2]/Fr[3]);Fr[0]=ks,Fr[1]=Is,Fr[2]=oo.top,Fr[3]=1,$f(Fr,Fr,Yn),Fr[3]=Math.max(Fr[3],1e-5);const qa=new Ii(Fr[0]/Fr[3],Fr[1]/Fr[3],Fr[2]/Fr[3]);wi.push(Ca),bi.push(qa)}go.push(wi),ui.push(bi)}return[go,ui]}(xt,_t,Kt,Wt,hn,On,tn,dn,mn):function(Un,cn,Zn,nr,Yn){const xi=[],Vn=[],Mr=Yn[8]*cn,yi=Yn[9]*cn,go=Yn[10]*cn,ui=Yn[11]*cn,Fr=Yn[8]*Zn,oa=Yn[9]*Zn,wi=Yn[10]*Zn,bi=Yn[11]*Zn;for(const Ss of Un){const ks=[],Is=[];for(const oo of Ss){const Ca=oo.x+nr.x,qa=oo.y+nr.y,Ha=Yn[0]*Ca+Yn[4]*qa+Yn[12],Fs=Yn[1]*Ca+Yn[5]*qa+Yn[13],Mu=Yn[2]*Ca+Yn[6]*qa+Yn[14],yu=Yn[3]*Ca+Yn[7]*qa+Yn[15],Wa=Ha+Mr,xo=Fs+yi,_u=Mu+go,ws=Math.max(yu+ui,1e-5),ll=Ha+Fr,La=Fs+oa,zl=Mu+wi,cl=Math.max(yu+bi,1e-5);ks.push(new Ii(Wa/ws,xo/ws,_u/ws)),Is.push(new Ii(ll/cl,La/cl,zl/cl))}xi.push(ks),Vn.push(Is)}return[xi,Vn]}(xt,_t,Kt,Wt,hn)),Ke=s.queryGeometry;var ut,xt,_t,Kt,Wt,hn,On,tn,dn,mn;return function(ut,xt,_t){let Kt=1/0;jc(_t,xt)&&(Kt=kl(_t,xt[0]));for(let Wt=0;Wt<xt.length;Wt++){const hn=xt[Wt],On=ut[Wt];for(let tn=0;tn<hn.length-1;tn++){const dn=hn[tn],mn=[dn,hn[tn+1],On[tn+1],On[tn],dn];I_(_t,mn)&&(Kt=Math.min(Kt,kl(_t,mn)))}}return Kt!==1/0&&Kt}(Ye,ht,Ke.isPointQuery()?Ke.screenBounds:Ke.screenGeometry)}},line:class extends _c{constructor(s){super(s,_p),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if("line-gradient"===s){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof Lu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,i){super.recalculate(s,i),this.paint._values["line-floorwidth"]=$c.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new yp(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new cf(this,s)}queryRadius(s){const i=s,u=hg(sp("line-width",this,i),sp("line-gap-width",this,i)),f=sp("line-offset",this,i);return u/2+Math.abs(f)+Qg(this.paint.get("line-translate"))}queryIntersectsFeature(s,i,u,f,m,b){if(s.queryGeometry.isAboveHorizon)return!1;const I=em(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),b.angle,s.pixelToTileUnitsFactor),A=s.pixelToTileUnitsFactor/2*hg(this.paint.get("line-width").evaluate(i,u),this.paint.get("line-gap-width").evaluate(i,u)),O=this.paint.get("line-offset").evaluate(i,u);return O&&(f=function(N,j){const $=[],W=new te(0,0);for(let Q=0;Q<N.length;Q++){const ie=N[Q],ge=[];for(let De=0;De<ie.length;De++){const Ye=ie[De],ht=ie[De+1],Ke=0===De?W:Ye.sub(ie[De-1])._unit()._perp(),ut=De===ie.length-1?W:ht.sub(Ye)._unit()._perp(),xt=Ke._add(ut)._unit();xt._mult(1/(xt.x*ut.x+xt.y*ut.y)),ge.push(xt._mult(j)._add(Ye))}$.push(ge)}return $}(f,O*s.pixelToTileUnitsFactor)),function(N,j,$){for(let W=0;W<j.length;W++){const Q=j[W];if(N.length>=3)for(let ie=0;ie<Q.length;ie++)if(op(N,Q[ie]))return!0;if(o0(N,Q,$))return!0}return!1}(I,f,A)}isTileClipped(){return!0}},symbol:Sf,background:class extends _c{constructor(s){super(s,rd)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends _c{constructor(s){super(s,O0)}getProgramIds(){return["raster"]}},sky:class extends _c{constructor(s){super(s,zm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"sky-gradient"===s?this._updateColorRamp():"sky-atmosphere-sun"!==s&&"sky-atmosphere-halo-color"!==s&&"sky-atmosphere-color"!==s&&"sky-atmosphere-sun-intensity"!==s||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=rm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(s,i){if("atmosphere"===this.paint.get("sky-type")){const f=this.paint.get("sky-atmosphere-sun"),m=!f,b=s.style.light,I=b.properties.get("position");return m&&"viewport"===b.properties.get("anchor")&&Sr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?Jy(I.azimuthal,90-I.polar,i):Jy(f[0],90-f[1],i)}const u=this.paint.get("sky-gradient-center");return Jy(u[0],90-u[1],i)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return"atmosphere"===s?["skyboxCapture","skybox"]:"gradient"===s?["skyboxGradient"]:null}}};class id{constructor(i,u,f,m){this.context=i,this.format=f,this.texture=i.gl.createTexture(),this.update(u,m)}update(i,u,f){const{width:m,height:b}=i,{context:I}=this,{gl:A}=I,{HTMLImageElement:O,HTMLCanvasElement:N,HTMLVideoElement:j,ImageData:$,ImageBitmap:W}=J;if(A.bindTexture(A.TEXTURE_2D,this.texture),I.pixelStoreUnpackFlipY.set(!1),I.pixelStoreUnpack.set(1),I.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!u||!1!==u.premultiply)),f||this.size&&this.size[0]===m&&this.size[1]===b){const{x:Q,y:ie}=f||{x:0,y:0};i instanceof O||i instanceof N||i instanceof j||i instanceof $||W&&i instanceof W?A.texSubImage2D(A.TEXTURE_2D,0,Q,ie,A.RGBA,A.UNSIGNED_BYTE,i):A.texSubImage2D(A.TEXTURE_2D,0,Q,ie,m,b,A.RGBA,A.UNSIGNED_BYTE,i.data)}else this.size=[m,b],i instanceof O||i instanceof N||i instanceof j||i instanceof $||W&&i instanceof W?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,i):A.texImage2D(A.TEXTURE_2D,0,this.format,m,b,0,this.format,A.UNSIGNED_BYTE,i.data);this.useMipmap=!!(u&&u.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&A.generateMipmap(A.TEXTURE_2D)}bind(i,u){const{context:f}=this,{gl:m}=f;m.bindTexture(m.TEXTURE_2D,this.texture),i!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,i),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?i===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_NEAREST:i),this.filter=i),u!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,u),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class k0{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Qy{constructor(){this.tasks={},this.taskQueue=[],Mn(["process"],this),this.invoker=new k0(this.process),this.nextId=0}add(i,u){const f=this.nextId++,m=function({type:b,isSymbolTile:I,zoom:A}){return A=A||0,"message"===b?0:"maybePrepare"!==b||I?"parseTile"!==b||I?"parseTile"===b&&I?300-A:"maybePrepare"===b&&I?400-A:500:200-A:100-A}(u);if(0===m){mr();try{i()}finally{}return{cancel:()=>{}}}return this.tasks[f]={fn:i,metadata:u,priority:m,id:f},this.taskQueue.push(f),this.invoker.trigger(),{cancel:()=>{delete this.tasks[f]}}}process(){mr();try{if(this.taskQueue=this.taskQueue.filter(f=>!!this.tasks[f]),!this.taskQueue.length)return;const i=this.pick();if(null===i)return;const u=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!u)return;u.fn()}finally{}}pick(){let i=null,u=1/0;for(let m=0;m<this.taskQueue.length;m++){const b=this.tasks[this.taskQueue[m]];b.priority<u&&(u=b.priority,i=m)}if(null===i)return null;const f=this.taskQueue[i];return this.taskQueue.splice(i,1),f}remove(){this.invoker.remove()}}class Dp{constructor(i){this._stringToNumber={},this._numberToString=[];for(let u=0;u<i.length;u++){const f=i[u];this._stringToNumber[f]=u,this._numberToString[u]=f}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const ov=["tile","layer","source","sourceLayer","state"];class F0{constructor(i,u,f,m,b){this.type="Feature",this._vectorTileFeature=i,this._z=u,this._x=f,this._y=m,this.properties=i.properties,this.id=b}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(i.id=this.id);for(const u of ov)void 0!==this[u]&&(i[u]=this[u]);return i}}const v=33,T=new Uint16Array(8184);for(let s=0;s<2046;s++){let i=s+2,u=0,f=0,m=0,b=0,I=0,A=0;for(1&i?m=b=I=32:u=f=A=32;(i>>=1)>1;){const N=u+m>>1,j=f+b>>1;1&i?(m=u,b=f,u=I,f=A):(u=m,f=b,m=I,b=A),I=N,A=j}const O=4*s;T[O+0]=u,T[O+1]=f,T[O+2]=m,T[O+3]=b}const F=new Uint16Array(2178),Y=new Uint8Array(1089),we=new Uint16Array(1089);function Xe(s){return 0===s?-.03125:32===s?.03125:0}var yt=Rt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const At={type:2,extent:Ir,loadGeometry:()=>[[new te(0,0),new te(Ir+1,0),new te(Ir+1,Ir+1),new te(0,Ir+1),new te(0,0)]]};class jt{constructor(i,u,f,m,b){this.tileID=i,this.uid=Jt(),this.uses=0,this.tileSize=u,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(i){const u=i+this.timeAdded;u<_a.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=rf(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,u,f){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(m,b){const I={};if(!b)return I;for(const A of m){const O=A.layerIds.map(N=>b.getLayer(N)).filter(Boolean);if(0!==O.length){A.layers=O,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map(N=>O.filter(j=>j.id===N)[0]));for(const N of O)I[N.id]=A}}return I}(i.buckets,u.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const b=this.buckets[m];if(b instanceof kd){if(this.hasSymbolBuckets=!0,!f)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const b=this.buckets[m];if(b instanceof kd&&b.hasRTLText){this.hasRTLText=!0,z.isLoading()||z.isLoaded()||"deferred"!==P()||k();break}}this.queryPadding=0;for(const m in this.buckets){const b=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(m).queryRadius(b))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new Jo}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.id]}upload(i){for(const f in this.buckets){const m=this.buckets[f];m.uploadPending()&&m.upload(i)}const u=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new id(i,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new id(i,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new id(i,this.lineAtlas.image,u.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,u,f,m,b,I,A,O){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:m,pixelPosMatrix:A,transform:I,params:b,tileTransform:this.tileTransform},i,u,f):{}}querySourceFeatures(i,u){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const m=f.loadVTLayers(),b=u?u.sourceLayer:"",I=m._geojsonTileLayer||m[b];if(!I)return;const A=Vh(u&&u.filter),{z:O,x:N,y:j}=this.tileID.canonical,$={z:O,x:N,y:j};for(let W=0;W<I.length;W++){const Q=I.feature(W);if(A.needGeometry){const De=bh(Q,!0);if(!A.filter(new G(this.tileID.overscaledZ),De,this.tileID.canonical))continue}else if(!A.filter(new G(this.tileID.overscaledZ),Q))continue;const ie=f.getId(Q,b),ge=new F0(Q,O,N,j,ie);ge.tile=$,i.push(ge)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const u=this.expirationTime;if(i.cacheControl){const f=Pt(i.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const f=Date.now();let m=!1;if(this.expirationTime>f)m=!1;else if(u)if(this.expirationTime<u)m=!0;else{const b=this.expirationTime-u;b?this.expirationTime=f+Math.max(b,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(i,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(i).length||!u)return;const f=this.latestFeatureIndex.loadVTLayers(),m=u.style.listImages();for(const b in this.buckets){if(!u.style.hasLayer(b))continue;const I=this.buckets[b],A=I.layers[0].sourceLayer||"_geojsonTileLayer",O=f[A],N=i[A];if(!O||!N||0===Object.keys(N).length)continue;if(I.update(N,O,m,this.imageAtlas&&this.imageAtlas.patternPositions||{}),I instanceof yp||I instanceof _f){const $=u.style._getSourceCache(I.layers[0].source);u._terrain&&u._terrain.enabled&&$&&I.programConfigurations.needsUpload&&u._terrain._clearRenderCacheForTile($.id,this.tileID)}const j=u&&u.style&&u.style.getLayer(b);j&&(this.queryPadding=Math.max(this.queryPadding,j.queryRadius(I)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<_a.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=_a.now()+i}setTexture(i,u){const f=u.context,m=f.gl;this.texture=this.texture||u.getTileTexture(i.width),this.texture?this.texture.update(i,{useMipmap:!0}):(this.texture=new id(f,i,m.RGBA,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(i,u){const f={};for(const m of u)f[m]=!0;this.dependencies[i]=f}hasDependency(i,u){for(const f of i){const m=this.dependencies[f];if(m)for(const b of u)if(m[b])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,u){if(!u||"mercator"===u.name||this._tileDebugBuffer)return;const f=ec(At,this.tileID.canonical,this.tileTransform)[0],m=new Dn,b=new Xl;for(let I=0;I<f.length;I++){const{x:A,y:O}=f[I];m.emplaceBack(A,O),b.emplaceBack(I)}b.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(b),this._tileDebugBuffer=i.createVertexBuffer(m,Sd.members),this._tileDebugSegments=Ns.simpleSegment(0,0,m.length,b.length)}_makeTileBoundsBuffers(i,u){if(this._tileBoundsBuffer||!u||"mercator"===u.name)return;const f=ec(At,this.tileID.canonical,this.tileTransform)[0];let m,b;if(this.isRaster){const I=function(A,O){const N=rf(A,O),j=Math.pow(2,A.z);for(let De=0;De<v;De++)for(let Ye=0;Ye<v;Ye++){const ht=Ql((A.x+(Ye+Xe(Ye))/32)/j),Ke=pu((A.y+(De+Xe(De))/32)/j),ut=O.project(ht,Ke),xt=De*v+Ye;F[2*xt+0]=Math.round((ut.x*N.scale-N.x)*Ir),F[2*xt+1]=Math.round((ut.y*N.scale-N.y)*Ir)}Y.fill(0),we.fill(0);for(let De=2045;De>=0;De--){const Ye=4*De,ht=T[Ye+0],Ke=T[Ye+1],ut=T[Ye+2],xt=T[Ye+3],_t=ht+ut>>1,Kt=Ke+xt>>1,Wt=_t+Kt-Ke,hn=Kt+ht-_t,On=Ke*v+ht,tn=xt*v+ut,dn=Kt*v+_t,mn=Math.hypot((F[2*On+0]+F[2*tn+0])/2-F[2*dn+0],(F[2*On+1]+F[2*tn+1])/2-F[2*dn+1])>=16;Y[dn]=Y[dn]||(mn?1:0),De<1022&&(Y[dn]=Y[dn]||Y[(Ke+hn>>1)*v+(ht+Wt>>1)]||Y[(xt+hn>>1)*v+(ut+Wt>>1)])}const $=new an,W=new yr;let Q=0;function ie(De,Ye){const ht=Ye*v+De;return 0===we[ht]&&($.emplaceBack(F[2*ht+0],F[2*ht+1],De*Ir/32,Ye*Ir/32),we[ht]=++Q),we[ht]-1}function ge(De,Ye,ht,Ke,ut,xt){const _t=De+ht>>1,Kt=Ye+Ke>>1;if(Math.abs(De-ut)+Math.abs(Ye-xt)>1&&Y[Kt*v+_t])ge(ut,xt,De,Ye,_t,Kt),ge(ht,Ke,ut,xt,_t,Kt);else{const Wt=ie(De,Ye),hn=ie(ht,Ke),On=ie(ut,xt);W.emplaceBack(Wt,hn,On)}}return ge(0,0,32,32,32,0),ge(32,32,0,0,0,32),{vertices:$,indices:W}}(this.tileID.canonical,u);m=I.vertices,b=I.indices}else{m=new an,b=new yr;for(const{x:A,y:O}of f)m.emplaceBack(A,O,0,0);const I=cp(m.int16,void 0,4);for(let A=0;A<I.length;A+=3)b.emplaceBack(I[A],I[A+1],I[A+2])}this._tileBoundsBuffer=i.createVertexBuffer(m,yt.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(b),this._tileBoundsSegments=Ns.simpleSegment(0,0,m.length,b.length)}_makeGlobeTileDebugBuffers(i,u){const f=u.projection;if(!f||"globe"!==f.name||u.freezeTileCoverage)return;const m=this.tileID.canonical,b=Wf(tp(m,u)),I=pf(u.zoom);let A;I>0&&(A=ry(new Float64Array(16),u.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,m,u,b,A,I),this._makeGlobeTileDebugTextBuffer(i,m,u,b,A,I)}_globePoint(i,u,f,m,b,I,A){let O=Ll(i,u,f);if(I){const N=1<<f.z,j=Yh(m.center.lng),$=Kh(m.center.lat),W=(f.x+.5)/N-j;let Q=0;W>.5?Q=-1:W<-.5&&(Q=1);let ie=(i/Ir+f.x)/N+Q,ge=(u/Ir+f.y)/N;ie=(ie-j)*m._pixelsPerMercatorPixel+j,ge=(ge-$)*m._pixelsPerMercatorPixel+$;const De=[ie*m.worldSize,ge*m.worldSize,0];ra(De,De,I),O=ep(O,De,A)}return ra(O,O,b)}_makeGlobeTileDebugBorderBuffer(i,u,f,m,b,I){const A=new Dn,O=new Xl,N=new Ut,j=(W,Q,ie,ge,De)=>{const Ye=(ie-W)/(De-1),ht=(ge-Q)/(De-1),Ke=A.length;for(let ut=0;ut<De;ut++){const xt=W+ut*Ye,_t=Q+ut*ht;A.emplaceBack(xt,_t);const Kt=this._globePoint(xt,_t,u,f,m,b,I);N.emplaceBack(Kt[0],Kt[1],Kt[2]),O.emplaceBack(Ke+ut)}},$=Ir;j(0,0,$,0,16),j($,0,$,$,16),j($,$,0,$,16),j(0,$,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(O),this._tileDebugBuffer=i.createVertexBuffer(A,Sd.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(N,Wh.members),this._tileDebugSegments=Ns.simpleSegment(0,0,A.length,O.length)}_makeGlobeTileDebugTextBuffer(i,u,f,m,b,I){const A=Ir/4,O=new Dn,N=new yr,j=new Ut,$=25;N.reserve(32),O.reserve($),j.reserve($);const W=(Q,ie)=>$*Q+ie;for(let Q=0;Q<$;Q++){const ie=Q*A;for(let ge=0;ge<$;ge++){const De=ge*A;O.emplaceBack(De,ie);const Ye=this._globePoint(De,ie,u,f,m,b,I);j.emplaceBack(Ye[0],Ye[1],Ye[2])}}for(let Q=0;Q<4;Q++)for(let ie=0;ie<4;ie++){const ge=W(Q,ie),De=W(Q,ie+1),Ye=W(Q+1,ie),ht=W(Q+1,ie+1);N.emplaceBack(ge,De,Ye),N.emplaceBack(Ye,De,ht)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(N),this._tileDebugTextBuffer=i.createVertexBuffer(O,Sd.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(j,Wh.members),this._tileDebugTextSegments=Ns.simpleSegment(0,0,$,32)}}class Pn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,u,f){const m=String(u);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][m]=this.stateChanges[i][m]||{},Be(this.stateChanges[i][m],f),null===this.deletedStates[i]){this.deletedStates[i]={};for(const b in this.state[i])b!==m&&(this.deletedStates[i][b]=null)}else if(this.deletedStates[i]&&null===this.deletedStates[i][m]){this.deletedStates[i][m]={};for(const b in this.state[i][m])f[b]||(this.deletedStates[i][m][b]=null)}else for(const b in f)this.deletedStates[i]&&this.deletedStates[i][m]&&null===this.deletedStates[i][m][b]&&delete this.deletedStates[i][m][b]}removeFeatureState(i,u,f){if(null===this.deletedStates[i])return;const m=String(u);if(this.deletedStates[i]=this.deletedStates[i]||{},f&&void 0!==u)null!==this.deletedStates[i][m]&&(this.deletedStates[i][m]=this.deletedStates[i][m]||{},this.deletedStates[i][m][f]=null);else if(void 0!==u)if(this.stateChanges[i]&&this.stateChanges[i][m])for(f in this.deletedStates[i][m]={},this.stateChanges[i][m])this.deletedStates[i][m][f]=null;else this.deletedStates[i][m]=null;else this.deletedStates[i]=null}getState(i,u){const f=String(u),m=Be({},(this.state[i]||{})[f],(this.stateChanges[i]||{})[f]);if(null===this.deletedStates[i])return{};if(this.deletedStates[i]){const b=this.deletedStates[i][u];if(null===b)return{};for(const I in b)delete m[I]}return m}initializeTileState(i,u){i.setFeatureState(this.state,u)}coalesceChanges(i,u){const f={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const b={};for(const I in this.stateChanges[m])this.state[m][I]||(this.state[m][I]={}),Be(this.state[m][I],this.stateChanges[m][I]),b[I]=this.state[m][I];f[m]=b}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const b={};if(null===this.deletedStates[m])for(const I in this.state[m])b[I]={},this.state[m][I]={};else for(const I in this.deletedStates[m]){if(null===this.deletedStates[m][I])this.state[m][I]={};else if(this.state[m][I])for(const A of Object.keys(this.deletedStates[m][I]))delete this.state[m][I][A];b[I]=this.state[m][I]}f[m]=f[m]||{},Be(f[m],b)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(f).length)for(const m in i)i[m].setFeatureState(f,u)}}class An{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,u){const f=this.toIdx(i,u);return{min:this.minimums[f],max:this.maximums[f]}}isLeaf(i,u){return this.leaves[this.toIdx(i,u)]}toIdx(i,u){return u*this.size+i}}function Fn(s,i,u,f){let m=0,b=Number.MAX_VALUE;for(let I=0;I<3;I++)if(Math.abs(f[I])<1e-15){if(u[I]<s[I]||u[I]>i[I])return null}else{const A=1/f[I];let O=(s[I]-u[I])*A,N=(i[I]-u[I])*A;if(O>N){const j=O;O=N,N=j}if(O>m&&(m=O),N<b&&(b=N),m>b)return null}return m}function rr(s,i,u,f,m,b,I,A,O,N,j){const $=f-s,W=m-i,Q=b-u,ie=I-s,ge=A-i,De=O-u,Ye=j[1]*De-j[2]*ge,ht=j[2]*ie-j[0]*De,Ke=j[0]*ge-j[1]*ie,ut=$*Ye+W*ht+Q*Ke;if(Math.abs(ut)<1e-15)return null;const xt=1/ut,_t=N[0]-s,Kt=N[1]-i,Wt=N[2]-u,hn=(_t*Ye+Kt*ht+Wt*Ke)*xt;if(hn<0||hn>1)return null;const On=Kt*Q-Wt*W,tn=Wt*$-_t*Q,dn=_t*W-Kt*$,mn=(j[0]*On+j[1]*tn+j[2]*dn)*xt;return mn<0||hn+mn>1?null:(ie*On+ge*tn+De*dn)*xt}function Nr(s,i,u){return(s-i)/(u-i)}function gi(s,i,u,f,m,b,I,A,O){const N=1<<u,j=b-f,$=I-m,W=(s+1)/N*j+f,Q=(i+0)/N*$+m,ie=(i+1)/N*$+m;A[0]=(s+0)/N*j+f,A[1]=Q,O[0]=W,O[1]=ie}class Yi{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const u=function(b){const I=Math.ceil(Math.log2(b.dim/8)),A=[];let O=Math.ceil(Math.pow(2,I));const N=1/O,j=(Q,ie,ge,De,Ye)=>{const ht=De?1:0,Ke=(Q+1)*ge-ht,ut=ie*ge,xt=(ie+1)*ge-ht;Ye[0]=Q*ge,Ye[1]=ut,Ye[2]=Ke,Ye[3]=xt};let $=new An(O);const W=[];for(let Q=0;Q<O*O;Q++){j(Q%O,Math.floor(Q/O),N,!1,W);const ie=Gi(W[0],W[1],b),ge=Gi(W[2],W[1],b),De=Gi(W[2],W[3],b),Ye=Gi(W[0],W[3],b);$.minimums.push(Math.min(ie,ge,De,Ye)),$.maximums.push(Math.max(ie,ge,De,Ye)),$.leaves.push(1)}for(A.push($),O/=2;O>=1;O/=2){const Q=A[A.length-1];$=new An(O);for(let ie=0;ie<O*O;ie++){j(ie%O,Math.floor(ie/O),2,!0,W);const ge=Q.getElevation(W[0],W[1]),De=Q.getElevation(W[2],W[1]),Ye=Q.getElevation(W[2],W[3]),ht=Q.getElevation(W[0],W[3]),Ke=Q.isLeaf(W[0],W[1]),ut=Q.isLeaf(W[2],W[1]),xt=Q.isLeaf(W[2],W[3]),_t=Q.isLeaf(W[0],W[3]),Kt=Math.min(ge.min,De.min,Ye.min,ht.min),Wt=Math.max(ge.max,De.max,Ye.max,ht.max),hn=Ke&&ut&&xt&&_t;$.maximums.push(Wt),$.minimums.push(Kt),$.leaves.push(Wt-Kt<=5&&hn?1:0)}A.push($)}return A}(this.dem),f=u.length-1,m=u[f];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(u,0,0,f,0)}raycastRoot(i,u,f,m,b,I,A=1){return Fn([i,u,-100],[f,m,this.maximums[0]*A],b,I)}raycast(i,u,f,m,b,I,A=1){if(!this.nodeCount)return null;const O=this.raycastRoot(i,u,f,m,b,I,A);if(null==O)return null;const N=[],j=[],$=[],W=[],Q=[{idx:0,t:O,nodex:0,nodey:0,depth:0}];for(;Q.length>0;){const{idx:ie,t:ge,nodex:De,nodey:Ye,depth:ht}=Q.pop();if(this.leaves[ie]){gi(De,Ye,ht,i,u,f,m,$,W);const ut=1<<ht,xt=(De+0)/ut,_t=(De+1)/ut,Kt=(Ye+0)/ut,Wt=(Ye+1)/ut,hn=Gi(xt,Kt,this.dem)*A,On=Gi(_t,Kt,this.dem)*A,tn=Gi(_t,Wt,this.dem)*A,dn=Gi(xt,Wt,this.dem)*A,mn=rr($[0],$[1],hn,W[0],$[1],On,W[0],W[1],tn,b,I),In=rr(W[0],W[1],tn,$[0],W[1],dn,$[0],$[1],hn,b,I),Un=Math.min(null!==mn?mn:Number.MAX_VALUE,null!==In?In:Number.MAX_VALUE);if(Un!==Number.MAX_VALUE)return Un;{const cn=bd([],b,I,ge);if(mi(hn,On,dn,tn,Nr(cn[0],$[0],W[0]),Nr(cn[1],$[1],W[1]))>=cn[2])return ge}continue}let Ke=0;for(let ut=0;ut<this._siblingOffset.length;ut++){gi((De<<1)+this._siblingOffset[ut][0],(Ye<<1)+this._siblingOffset[ut][1],ht+1,i,u,f,m,$,W),$[2]=-100,W[2]=this.maximums[this.childOffsets[ie]+ut]*A;const xt=Fn($,W,b,I);if(null!=xt){const _t=xt;N[ut]=_t;let Kt=!1;for(let Wt=0;Wt<Ke&&!Kt;Wt++)_t>=N[j[Wt]]&&(j.splice(Wt,0,ut),Kt=!0);Kt||(j[Ke]=ut),Ke++}}for(let ut=0;ut<Ke;ut++){const xt=j[ut];Q.push({idx:this.childOffsets[ie]+xt,t:N[xt],nodex:(De<<1)+this._siblingOffset[xt][0],nodey:(Ye<<1)+this._siblingOffset[xt][1],depth:ht+1})}}return null}_addNode(i,u,f){return this.minimums.push(i),this.maximums.push(u),this.leaves.push(f),this.childOffsets.push(0),this.nodeCount++}_construct(i,u,f,m,b){if(1===i[m].isLeaf(u,f))return;this.childOffsets[b]||(this.childOffsets[b]=this.nodeCount);const I=m-1,A=i[I];let O=0,N=0;for(let j=0;j<this._siblingOffset.length;j++){const $=2*u+this._siblingOffset[j][0],W=2*f+this._siblingOffset[j][1],Q=A.getElevation($,W),ie=A.isLeaf($,W),ge=this._addNode(Q.min,Q.max,ie);ie&&(O|=1<<j),N||(N=ge)}for(let j=0;j<this._siblingOffset.length;j++)O&1<<j||this._construct(i,2*u+this._siblingOffset[j][0],2*f+this._siblingOffset[j][1],I,N+j)}}function mi(s,i,u,f,m,b){return qn(qn(s,u,b),qn(i,f,b),m)}function Gi(s,i,u){const f=u.dim,m=Le(s*f-.5,0,f-1),b=Le(i*f-.5,0,f-1),I=Math.floor(m),A=Math.floor(b),O=Math.min(I+1,f-1),N=Math.min(A+1,f-1);return mi(u.get(I,A),u.get(O,A),u.get(I,N),u.get(O,N),m-I,b-A)}const po={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Ic(s,i,u){return(256*s*256+256*i+u)/10-1e4}function Tc(s,i,u){return 256*s+i+u/256-32768}class xl{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,u,f,m=!1,b=!1){if(this.uid=i,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&"mapbox"!==f&&"terrarium"!==f)return Sr(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=u.height;const I=this.dim=u.height-2,A=new Uint32Array(u.data.buffer);if(this.pixels=new Uint8Array(u.data.buffer),this.encoding=f||"mapbox",this.borderReady=m,!m){for(let O=0;O<I;O++)A[this._idx(-1,O)]=A[this._idx(0,O)],A[this._idx(I,O)]=A[this._idx(I-1,O)],A[this._idx(O,-1)]=A[this._idx(O,0)],A[this._idx(O,I)]=A[this._idx(O,I-1)];A[this._idx(-1,-1)]=A[this._idx(0,0)],A[this._idx(I,-1)]=A[this._idx(I-1,0)],A[this._idx(-1,I)]=A[this._idx(0,I-1)],A[this._idx(I,I)]=A[this._idx(I-1,I-1)],b&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Yi(this)}get(i,u,f=!1){f&&(i=Le(i,-1,this.dim),u=Le(u,-1,this.dim));const m=4*this._idx(i,u);return("terrarium"===this.encoding?Tc:Ic)(this.pixels[m],this.pixels[m+1],this.pixels[m+2])}static getUnpackVector(i){return po[i]}get unpackVector(){return po[this.encoding]}_idx(i,u){if(i<-1||i>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(i+1)}static pack(i,u){const f=[0,0,0,0],m=xl.getUnpackVector(u);let b=Math.floor((i+m[3])/m[2]);return f[2]=b%256,b=Math.floor(b/256),f[1]=b%256,b=Math.floor(b/256),f[0]=b,f}getPixels(){return new tc({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,u,f){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let m=u*this.dim,b=u*this.dim+this.dim,I=f*this.dim,A=f*this.dim+this.dim;switch(u){case-1:m=b-1;break;case 1:b=m+1}switch(f){case-1:I=A-1;break;case 1:A=I+1}const O=-u*this.dim,N=-f*this.dim;for(let j=I;j<A;j++)for(let $=m;$<b;$++){const W=4*this._idx($,j),Q=4*this._idx($+O,j+N);this.pixels[W+0]=i.pixels[Q+0],this.pixels[W+1]=i.pixels[Q+1],this.pixels[W+2]=i.pixels[Q+2],this.pixels[W+3]=i.pixels[Q+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Gn(xl,"DEMData"),Gn(Yi,"DemMinMaxQuadTree",{omit:["dem"]});class Ra{constructor(i,u){this.max=i,this.onRemove=u,this.reset()}reset(){for(const i in this.data)for(const u of this.data[i])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(i,u,f){const m=i.wrapped().key;void 0===this.data[m]&&(this.data[m]=[]);const b={value:u,timeout:void 0};if(void 0!==f&&(b.timeout=setTimeout(()=>{this.remove(i,b)},f)),this.data[m].push(b),this.order.push(m),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const u=this.data[i].shift();return u.timeout&&clearTimeout(u.timeout),0===this.data[i].length&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),u.value}getByKey(i){const u=this.data[i];return u?u[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,u){if(!this.has(i))return this;const f=i.wrapped().key,m=void 0===u?0:this.data[f].indexOf(u),b=this.data[f][m];return this.data[f].splice(m,1),b.timeout&&clearTimeout(b.timeout),0===this.data[f].length&&delete this.data[f],this.onRemove(b.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(i){const u=[];for(const f in this.data)for(const m of this.data[f])i(m.value)||u.push(m);for(const f of u)this.remove(f.value.tileID,f)}}class wl{constructor(i,u,f){this.func=i,this.mask=u,this.range=f}}wl.ReadOnly=!1,wl.ReadWrite=!0,wl.disabled=new wl(519,wl.ReadOnly,[0,1]);class Cg{constructor(i,u,f,m,b,I){this.test=i,this.ref=u,this.mask=f,this.fail=m,this.depthFail=b,this.pass=I}}Cg.disabled=new Cg({func:519,mask:0},0,0,7680,7680,7680);class hi{constructor(i,u,f){this.blendFunction=i,this.blendColor=u,this.mask=f}}hi.Replace=[1,0],hi.disabled=new hi(hi.Replace,zs.transparent,[!1,!1,!1,!1]),hi.unblended=new hi(hi.Replace,zs.transparent,[!0,!0,!0,!0]),hi.alphaBlended=new hi([1,771],zs.transparent,[!0,!0,!0,!0]);class od{constructor(i,u,f){this.enable=i,this.mode=u,this.frontFace=f}}od.disabled=new od(!1,1029,2305),od.backCCW=new od(!0,1029,2305),od.backCW=new od(!0,1029,2304),od.frontCW=new od(!0,1028,2304),od.frontCCW=new od(!0,1028,2305);class Sg extends Na{constructor(i,u,f){super(),this.id=i,this._onlySymbols=f,u.on("data",m=>{"source"===m.dataType&&"metadata"===m.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===m.dataType&&"content"===m.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),u.on("error",()=>{this._sourceErrored=!0}),this._source=u,this._tiles={},this._cache=new Ra(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Pn,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(i){this.map=i,this._minTileCacheSize=void 0===this._minTileCacheSize&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const u=this._tiles[i];if("loaded"!==u.state&&"errored"!==u.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,u){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,u)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const f=this._tiles[u];f.upload(i),f.prepare(this.map.style.imageManager)}}getIds(){return Tt(this._tiles).map(i=>i.tileID).sort(z0).map(i=>i.key)}getRenderableIds(i){const u=[];for(const f in this._tiles)this._isIdRenderable(+f,i)&&u.push(this._tiles[f]);return i?u.sort((f,m)=>{const b=f.tileID,I=m.tileID,A=new te(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),O=new te(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-I.overscaledZ||O.y-A.y||O.x-A.x}).map(f=>f.tileID.key):u.map(f=>f.tileID).sort(z0).map(f=>f.key)}hasRenderableParent(i){const u=this.findLoadedParent(i,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(i,u){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(u||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)"errored"!==this._tiles[i].state&&this._reloadTile(+i,"reloading")}}_reloadTile(i,u){const f=this._tiles[i];f&&("loading"!==f.state&&(f.state=u),this._loadTile(f,this._tileLoaded.bind(this,f,i,u)))}_tileLoaded(i,u,f,m){if(m)if(i.state="errored",404!==m.status)this._source.fire(new Oa(m,{tile:i}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform);else i.timeAdded=_a.now(),"expired"===f&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(u,i),"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new Za("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const u=this.getRenderableIds();for(let m=0;m<u.length;m++){const b=u[m];if(i.neighboringTiles&&i.neighboringTiles[b]){const I=this.getTileByID(b);f(i,I),f(I,i)}}function f(m,b){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let I=b.tileID.canonical.x-m.tileID.canonical.x;const A=b.tileID.canonical.y-m.tileID.canonical.y,O=Math.pow(2,m.tileID.canonical.z),N=b.tileID.key;0===I&&0===A||Math.abs(A)>1||(Math.abs(I)>1&&(1===Math.abs(I+O)?I+=O:1===Math.abs(I-O)&&(I-=O)),b.dem&&m.dem&&(m.dem.backfillBorder(b.dem,I,A),m.neighboringTiles&&m.neighboringTiles[N]&&(m.neighboringTiles[N].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,u,f,m){for(const b in this._tiles){let I=this._tiles[b];if(m[b]||!I.hasData()||I.tileID.overscaledZ<=u||I.tileID.overscaledZ>f)continue;let A=I.tileID;for(;I&&I.tileID.overscaledZ>u+1;){const N=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[N.key],I&&I.hasData()&&(A=N)}let O=A;for(;O.overscaledZ>u;)if(O=O.scaledTo(O.overscaledZ-1),i[O.key]){m[A.key]=A;break}}}findLoadedParent(i,u){if(i.key in this._loadedParentTiles){const f=this._loadedParentTiles[i.key];return f&&f.tileID.overscaledZ>=u?f:null}for(let f=i.overscaledZ-1;f>=u;f--){const m=i.scaledTo(f),b=this._getLoadedTile(m);if(b)return b}}_getLoadedTile(i){const u=this._tiles[i.key];return u&&u.hasData()?u:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,u){u=u||this._source.tileSize;const f=Math.ceil(i.width/u)+1,m=Math.ceil(i.height/u)+1,b=Math.floor(f*m*5),I="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,b):b,A="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,I):I;this._cache.setMaxSize(A)}handleWrapJump(i){const u=Math.round((i-(void 0===this._prevLng?i:this._prevLng))/360);if(this._prevLng=i,u){const f={};for(const m in this._tiles){const b=this._tiles[m];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+u),f[b.tileID.key]=b}this._tiles=f;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(i,u,f){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;let m;this.updateCacheSize(i,u),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new Nl(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(m=i.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(m=m.filter(A=>this._source.hasTile(A)))):m=[];const b=this._updateRetainedTiles(m);if(hx(this._source.type)&&0!==m.length){const A={},O={},N=Object.keys(b);for(const $ of N){const W=b[$],Q=this._tiles[$];if(!Q||Q.fadeEndTime&&Q.fadeEndTime<=_a.now())continue;const ie=this.findLoadedParent(W,Math.max(W.overscaledZ-Sg.maxOverzooming,this._source.minzoom));ie&&(this._addTile(ie.tileID),A[ie.tileID.key]=ie.tileID),O[$]=W}const j=m[m.length-1].overscaledZ;for(const $ in this._tiles){const W=this._tiles[$];if(b[$]||!W.hasData())continue;let Q=W.tileID;for(;Q.overscaledZ>j;){Q=Q.scaledTo(Q.overscaledZ-1);const ie=this._tiles[Q.key];if(ie&&ie.hasData()&&O[Q.key]){b[$]=W.tileID;break}}}for(const $ in A)b[$]||(this._coveredTiles[$]=!0,b[$]=A[$])}for(const A in b)this._tiles[A].clearFadeHold();const I=function(A,O){const N=[];for(const j in A)j in O||N.push(j);return N}(this._tiles,b);for(const A of I){const O=this._tiles[A];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(+A)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const u={};if(0===i.length)return u;const f={},m=i.reduce((N,j)=>Math.min(N,j.overscaledZ),1/0),b=i[0].overscaledZ,I=Math.max(b-Sg.maxOverzooming,this._source.minzoom),A=Math.max(b+Sg.maxUnderzooming,this._source.minzoom),O={};for(const N of i){const j=this._addTile(N);u[N.key]=N,j.hasData()||m<this._source.maxzoom&&(O[N.key]=N)}this._retainLoadedChildren(O,m,A,u);for(const N of i){let j=this._tiles[N.key];if(j.hasData())continue;if(N.canonical.z>=this._source.maxzoom){const W=N.children(this._source.maxzoom)[0],Q=this.getTile(W);if(Q&&Q.hasData()){u[W.key]=W;continue}}else{const W=N.children(this._source.maxzoom);if(u[W[0].key]&&u[W[1].key]&&u[W[2].key]&&u[W[3].key])continue}let $=j.wasRequested();for(let W=N.overscaledZ-1;W>=I;--W){const Q=N.scaledTo(W);if(f[Q.key]||(f[Q.key]=!0,j=this.getTile(Q),!j&&$&&(j=this._addTile(Q)),j&&(u[Q.key]=Q,$=j.wasRequested(),j.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const u=[];let f,m=this._tiles[i].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){f=this._loadedParentTiles[m.key];break}u.push(m.key);const b=m.scaledTo(m.overscaledZ-1);if(f=this._getLoadedTile(b),f)break;m=b}for(const b of u)this._loadedParentTiles[b]=f}}_addTile(i){let u=this._tiles[i.key];if(u)return u;u=this._cache.getAndRemove(i),u&&(this._setTileReloadTimer(i.key,u),u.tileID=i,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,u)));const f=!!u;if(!f){const m=this.map?this.map.painter:null;u=new jt(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom,m,this._isRaster),this._loadTile(u,this._tileLoaded.bind(this,u,i.key,u.state))}return u?(u.uses++,this._tiles[i.key]=u,f||this._source.fire(new Za("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u):null}_setTileReloadTimer(i,u){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const f=u.getExpiryTimeout();f&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},f))}_removeTile(i){const u=this._tiles[i];u&&(u.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),u.uses>0||(u.hasData()&&"reloading"!==u.state?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,u,f){const m=[],b=this.transform;if(!b)return m;const I="globe"===b.projection.name,A=Yh(b.center.lng);for(const O in this._tiles){const N=this._tiles[O];if(f&&N.clearQueryDebugViz(),N.holdingForFade())continue;let j;if(I){const $=N.tileID.canonical;if(0===$.z){const W=[Math.abs(Le(A,...e_($,-1))-A),Math.abs(Le(A,...e_($,1))-A)];j=[0,2*W.indexOf(Math.min(...W))-1]}else{const W=[Math.abs(Le(A,...e_($,-1))-A),Math.abs(Le(A,...e_($,0))-A),Math.abs(Le(A,...e_($,1))-A)];j=[W.indexOf(Math.min(...W))-1]}}else j=[0];for(const $ of j){const W=i.containsTile(N,b,u,$);W&&m.push(W)}}return m}getVisibleCoordinates(i){const u=this.getRenderableIds(i).map(f=>this._tiles[f].tileID);for(const f of u)f.projMatrix=this.transform.calculateProjMatrix(f.toUnwrapped());return u}hasTransition(){if(this._source.hasTransition())return!0;if(hx(this._source.type))for(const i in this._tiles){const u=this._tiles[i];if(void 0!==u.fadeEndTime&&u.fadeEndTime>=_a.now())return!0}return!1}setFeatureState(i,u,f){this._state.updateState(i=i||"_geojsonTileLayer",u,f)}removeFeatureState(i,u,f){this._state.removeFeatureState(i=i||"_geojsonTileLayer",u,f)}getFeatureState(i,u){return this._state.getState(i=i||"_geojsonTileLayer",u)}setDependencies(i,u,f){const m=this._tiles[i];m&&m.setDependencies(u,f)}reloadTilesForDependencies(i,u){for(const f in this._tiles)this._tiles[f].hasDependency(i,u)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(i,u))}_preloadTiles(i,u){if(!this._sourceLoaded){const A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(i,u))};return void this._source.on("data",A)}const f=new Map,m=Array.isArray(i)?i:[i],b=this.map.painter.terrain,I=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const A of m){const O=A.coveringTiles({tileSize:I,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const N of O)f.set(N.key,N);this.usedForTerrain&&A.updateElevation(!1)}ft(Array.from(f.values()),(A,O)=>{const N=new jt(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(N,j=>{"raster-dem"===this._source.type&&N.dem&&this._backfillDEM(N),O(j,N)})},u)}}function z0(s,i){const u=Math.abs(2*s.wrap)-+(s.wrap<0),f=Math.abs(2*i.wrap)-+(i.wrap<0);return s.overscaledZ-i.overscaledZ||f-u||i.canonical.y-s.canonical.y||i.canonical.x-s.canonical.x}function hx(s){return"raster"===s||"image"===s||"video"===s||"custom"===s}function e_(s,i){const u=1<<s.z;return[s.x/u+i,(s.x+1)/u+i]}Sg.maxOverzooming=10,Sg.maxUnderzooming=3;class t_{constructor(i,u,f){this._demTile=i,this._dem=this._demTile.dem,this._scale=u,this._offset=f}static create(i,u,f){const m=f||i.findDEMTileFor(u);if(!m||!m.dem)return;const b=m.dem,I=m.tileID,A=1<<u.canonical.z-I.canonical.z;return new t_(m,m.tileSize/Ir/A,[(u.canonical.x/A-I.canonical.x)*b.dim,(u.canonical.y/A-I.canonical.y)*b.dim])}tileCoordToPixel(i,u){const f=u*this._scale+this._offset[1],m=Math.floor(i*this._scale+this._offset[0]),b=Math.floor(f);return new te(m,b)}getElevationAt(i,u,f,m){const b=i*this._scale+this._offset[0],I=u*this._scale+this._offset[1],A=Math.floor(b),O=Math.floor(I),N=this._dem;return m=!!m,f?qn(qn(N.get(A,O,m),N.get(A,O+1,m),I-O),qn(N.get(A+1,O,m),N.get(A+1,O+1,m),I-O),b-A):N.get(A,O,m)}getElevationAtPixel(i,u,f){return this._dem.get(i,u,!!f)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*wh(1,i)*this._dem.stride}}class fx{constructor(i,u){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new lr(Ir,16,0),this.featureIndexArray=new Pl,this.promoteId=u}insert(i,u,f,m,b,I=0){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,m,b,I);const O=this.grid;for(let N=0;N<u.length;N++){const j=u[N],$=[1/0,1/0,-1/0,-1/0];for(let W=0;W<j.length;W++){const Q=j[W];$[0]=Math.min($[0],Q.x),$[1]=Math.min($[1],Q.y),$[2]=Math.max($[2],Q.x),$[3]=Math.max($[3],Q.y)}$[0]<Ir&&$[1]<Ir&&$[2]>=0&&$[3]>=0&&O.insert(A,$[0],$[1],$[2],$[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new vf(new Em(this.rawTileData)).layers,this.sourceLayerCoder=new Dp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,u,f,m){this.loadVTLayers();const b=i.params||{},I=Vh(b.filter),A=i.tileResult,O=i.transform,N=A.bufferedTilespaceBounds,j=this.grid.query(N.min.x,N.min.y,N.max.x,N.max.y,(ie,ge,De,Ye)=>gy(A.bufferedTilespaceGeometry,ie,ge,De,Ye));j.sort(sb);let $=null;O.elevation&&j.length>0&&($=t_.create(O.elevation,this.tileID));const W={};let Q;for(let ie=0;ie<j.length;ie++){const ge=j[ie];if(ge===Q)continue;Q=ge;const De=this.featureIndexArray.get(ge);let Ye=null;this.loadMatchingFeature(W,De,I,b.layers,b.availableImages,u,f,m,(ht,Ke,ut,xt=0)=>(Ye||(Ye=ec(ht,this.tileID.canonical,i.tileTransform)),Ke.queryIntersectsFeature(A,ht,ut,Ye,this.z,i.transform,i.pixelPosMatrix,$,xt)))}return W}loadMatchingFeature(i,u,f,m,b,I,A,O,N){const{featureIndex:j,bucketIndex:$,sourceLayerIndex:W,layoutVertexArrayOffset:Q}=u,ie=this.bucketLayerIDs[$];if(m&&!function(ht,Ke){for(let ut=0;ut<ht.length;ut++)if(Ke.indexOf(ht[ut])>=0)return!0;return!1}(m,ie))return;const ge=this.sourceLayerCoder.decode(W),De=this.vtLayers[ge].feature(j);if(f.needGeometry){const ht=bh(De,!0);if(!f.filter(new G(this.tileID.overscaledZ),ht,this.tileID.canonical))return}else if(!f.filter(new G(this.tileID.overscaledZ),De))return;const Ye=this.getId(De,ge);for(let ht=0;ht<ie.length;ht++){const Ke=ie[ht];if(m&&m.indexOf(Ke)<0)continue;const ut=I[Ke];if(!ut)continue;let xt={};void 0!==Ye&&O&&(xt=O.getState(ut.sourceLayer||"_geojsonTileLayer",Ye));const _t=Be({},A[Ke]);_t.paint=U0(_t.paint,ut.paint,De,xt,b),_t.layout=U0(_t.layout,ut.layout,De,xt,b);const Kt=!N||N(De,ut,xt,Q);if(!Kt)continue;const Wt=new F0(De,this.z,this.x,this.y,Ye);Wt.layer=_t;let hn=i[Ke];void 0===hn&&(hn=i[Ke]=[]),hn.push({featureIndex:j,feature:Wt,intersectionZ:Kt})}}lookupSymbolFeatures(i,u,f,m,b,I,A,O){const N={};this.loadVTLayers();const j=Vh(b);for(const $ of i)this.loadMatchingFeature(N,{bucketIndex:f,sourceLayerIndex:m,featureIndex:$,layoutVertexArrayOffset:0},j,I,A,O,u);return N}loadFeature(i){const{featureIndex:u,sourceLayerIndex:f}=i;this.loadVTLayers();const m=this.sourceLayerCoder.decode(f),b=this.vtFeatures[m];if(b[u])return b[u];const I=this.vtLayers[m].feature(u);return b[u]=I,I}hasLayer(i){for(const u of this.bucketLayerIDs)for(const f of u)if(i===f)return!0;return!1}getId(i,u){let f=i.id;if(this.promoteId){const m="string"==typeof this.promoteId?this.promoteId:this.promoteId[u];null!=m&&(f=i.properties[m]),"boolean"==typeof f&&(f=Number(f))}return f}}function U0(s,i,u,f,m){return xn(s,(b,I)=>{const A=i instanceof We?i.get(I):null;return A&&A.evaluate?A.evaluate(u,f,m):A})}function sb(s,i){return i-s}Gn(fx,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class dx{constructor(i,u){this.width=i,this.height=u,this.nextRow=0,this.image=new Jh({width:i,height:u}),this.positions={},this.uploaded=!1}getDash(i,u){const f=this.getKey(i,u);return this.positions[f]}trim(){const i=this.width,u=this.height=zt(this.nextRow);this.image.resize({width:i,height:u})}getKey(i,u){return i.join(",")+u}getDashRanges(i,u,f){const m=[];let b=i.length%2==1?-i[i.length-1]*f:0,I=i[0]*f,A=!0;m.push({left:b,right:I,isDash:A,zeroLength:0===i[0]});let O=i[0];for(let N=1;N<i.length;N++){A=!A;const j=i[N];b=O*f,O+=j,I=O*f,m.push({left:b,right:I,isDash:A,zeroLength:0===j})}return m}addRoundDash(i,u,f){const m=u/2;for(let b=-f;b<=f;b++){const I=this.width*(this.nextRow+f+b);let A=0,O=i[A];for(let N=0;N<this.width;N++){N/O.right>1&&(O=i[++A]);const j=Math.abs(N-O.left),$=Math.abs(N-O.right),W=Math.min(j,$);let Q;const ie=b/f*(m+1);if(O.isDash){const ge=m-Math.abs(ie);Q=Math.sqrt(W*W+ge*ge)}else Q=m-Math.sqrt(W*W+ie*ie);this.image.data[I+N]=Math.max(0,Math.min(255,Q+128))}}}addRegularDash(i,u){for(let O=i.length-1;O>=0;--O){const N=i[O],j=i[O+1];N.zeroLength?i.splice(O,1):j&&j.isDash===N.isDash&&(j.left=N.left,i.splice(O,1))}const f=i[0],m=i[i.length-1];f.isDash===m.isDash&&(f.left=m.left-this.width,m.right=f.right+this.width);const b=this.width*this.nextRow;let I=0,A=i[I];for(let O=0;O<this.width;O++){O/A.right>1&&(A=i[++I]);const N=Math.abs(O-A.left),j=Math.abs(O-A.right),$=Math.min(N,j);this.image.data[b+O]=Math.max(0,Math.min(255,(A.isDash?$:-$)+u+128))}}addDash(i,u){const f=this.getKey(i,u);if(this.positions[f])return this.positions[f];const m="round"===u,b=m?7:0,I=2*b+1;if(this.nextRow+I>this.height)return Sr("LineAtlas out of space"),null;0===i.length&&i.push(1);let A=0;for(let j=0;j<i.length;j++)i[j]<0&&(Sr("Negative value is found in line dasharray, replacing values with 0"),i[j]=0),A+=i[j];if(0!==A){const j=this.width/A,$=this.getDashRanges(i,this.width,j);m?this.addRoundDash($,j,b):this.addRegularDash($,"square"===u?.5*j:0)}const O=this.nextRow+b;this.nextRow+=I;const N={tl:[O,b],br:[A,0]};return this.positions[f]=N,N}}Gn(dx,"LineAtlas");const ab=1*Cc;class V0{constructor(i){const u={},f=[];for(const A in i){const O=i[A],N=u[A]={};for(const j in O.glyphs){const $=O.glyphs[+j];if(!$||0===$.bitmap.width||0===$.bitmap.height)continue;const W=$.metrics.localGlyph?ab:1,Q={x:0,y:0,w:$.bitmap.width+2*W,h:$.bitmap.height+2*W};f.push(Q),N[j]=Q}}const{w:m,h:b}=su(f),I=new Jh({width:m||1,height:b||1});for(const A in i){const O=i[A];for(const N in O.glyphs){const j=O.glyphs[+N];if(!j||0===j.bitmap.width||0===j.bitmap.height)continue;const $=u[A][N],W=j.metrics.localGlyph?ab:1;Jh.copy(j.bitmap,I,{x:0,y:0},{x:$.x+W,y:$.y+W},j.bitmap)}}this.image=I,this.positions=u}}Gn(V0,"GlyphAtlas");class px{constructor(i){this.tileID=new Nl(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.canonical=i.tileID.canonical,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile,this.tileTransform=rf(i.tileID.canonical,i.projection),this.projection=i.projection}parse(i,u,f,m,b){this.status="parsing",this.data=i,this.collisionBoxArray=new Jo;const I=new Dp(Object.keys(i.layers).sort()),A=new fx(this.tileID,this.promoteId);A.bucketLayerIDs=[];const O={},N=new dx(256,256),j={featureIndex:A,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:N,availableImages:f},$=u.familiesBySource[this.source];for(const xt in $){const _t=i.layers[xt];if(!_t)continue;let Kt=!1,Wt=!1;for(const tn of $[xt])"symbol"===tn[0].type?Kt=!0:Wt=!0;if(!0===this.isSymbolTile&&!Kt||!1===this.isSymbolTile&&!Wt)continue;1===_t.version&&Sr(`Vector tile source "${this.source}" layer "${xt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const hn=I.encode(xt),On=[];for(let tn=0;tn<_t.length;tn++){const dn=_t.feature(tn),mn=A.getId(dn,xt);On.push({feature:dn,id:mn,index:tn,sourceLayerIndex:hn})}for(const tn of $[xt]){const dn=tn[0];void 0!==this.isSymbolTile&&"symbol"===dn.type!==this.isSymbolTile||dn.minzoom&&this.zoom<Math.floor(dn.minzoom)||dn.maxzoom&&this.zoom>=dn.maxzoom||"none"!==dn.visibility&&(If(tn,this.zoom,f),(O[dn.id]=dn.createBucket({index:A.bucketLayerIDs.length,layers:tn,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:hn,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:f})).populate(On,j,this.tileID.canonical,this.tileTransform),A.bucketLayerIDs.push(tn.map(mn=>mn.id)))}}let W,Q,ie,ge;N.trim();const De={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ye=()=>{if(W)return b(W);if(Q&&ie&&ge){const xt=new V0(Q),_t=new Vy(ie,ge);for(const Kt in O){const Wt=O[Kt];Wt instanceof kd?(If(Wt.layers,this.zoom,f),lx(Wt,Q,xt.positions,ie,_t.iconPositions,this.showCollisionBoxes,f,this.tileID.canonical,this.tileZoom,this.projection)):Wt.hasPattern&&(Wt instanceof yp||Wt instanceof _f||Wt instanceof dp)&&(If(Wt.layers,this.zoom,f),Wt.addFeatures(j,this.tileID.canonical,_t.patternPositions,f,this.tileTransform))}this.status="done",b(null,{buckets:Tt(O).filter(Kt=>!Kt.isEmpty()),featureIndex:A,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xt.image,lineAtlas:N,imageAtlas:_t,glyphMap:this.returnDependencies?Q:null,iconMap:this.returnDependencies?ie:null,glyphPositions:this.returnDependencies?xt.positions:null})}},ht=xn(j.glyphDependencies,xt=>Object.keys(xt).map(Number));Object.keys(ht).length?m.send("getGlyphs",{uid:this.uid,stacks:ht},(xt,_t)=>{W||(W=xt,Q=_t,Ye())},void 0,!1,De):Q={};const Ke=Object.keys(j.iconDependencies);Ke.length?m.send("getImages",{icons:Ke,source:this.source,tileID:this.tileID,type:"icons"},(xt,_t)=>{W||(W=xt,ie=_t,Ye())},void 0,!1,De):ie={};const ut=Object.keys(j.patternDependencies);ut.length?m.send("getImages",{icons:ut,source:this.source,tileID:this.tileID,type:"patterns"},(xt,_t)=>{W||(W=xt,ge=_t,Ye())},void 0,!1,De):ge={},Ye()}}function If(s,i,u){const f=new G(i);for(const m of s)m.recalculate(f,u)}class vi{constructor(i){this.entries={},this.scheduler=i}request(i,u,f,m){const b=this.entries[i]=this.entries[i]||{callbacks:[]};if(b.result){const[I,A]=b.result;return this.scheduler?this.scheduler.add(()=>{m(I,A)},u):m(I,A),()=>{}}return b.callbacks.push(m),b.cancel||(b.cancel=f((I,A)=>{b.result=[I,A];for(const O of b.callbacks)this.scheduler?this.scheduler.add(()=>{O(I,A)},u):O(I,A);setTimeout(()=>delete this.entries[i],3e3)})),()=>{b.result||(b.callbacks=b.callbacks.filter(I=>I!==m),b.callbacks.length||(b.cancel(),delete this.entries[i]))}}}function j0(s,i,u){const f=JSON.stringify(s.request);return s.data&&(this.deduped.entries[f]={result:[null,s.data]}),this.deduped.request(f,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},m=>{const b=ts(s.request,(I,A,O,N)=>{I?m(I):A&&m(null,{vectorTile:u?void 0:new vf(new Em(A)),rawData:A,cacheControl:O,expires:N})});return()=>{b.cancel(),m()}},i)}const gx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Um{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,f]=new Uint8Array(i,0,2);if(219!==u)throw new Error("Data does not appear to be in a KDBush format.");const m=f>>4;if(1!==m)throw new Error(`Got v${m} data when expected v1.`);const b=gx[15&f];if(!b)throw new Error("Unrecognized array type.");const[I]=new Uint16Array(i,2,1),[A]=new Uint32Array(i,4,1);return new Um(A,I,b,i)}constructor(i,u=64,f=Float64Array,m){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=f,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const b=gx.indexOf(this.ArrayType),I=2*i*this.ArrayType.BYTES_PER_ELEMENT,A=i*this.IndexArrayType.BYTES_PER_ELEMENT,O=(8-A%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${f}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+A+O,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+I+A+O),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+A+O,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=i)}add(i,u){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=i,this.coords[this._pos++]=u,f}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return Ap(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,u,f,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:I,nodeSize:A}=this,O=[0,b.length-1,0],N=[];for(;O.length;){const j=O.pop()||0,$=O.pop()||0,W=O.pop()||0;if($-W<=A){for(let De=W;De<=$;De++){const Ye=I[2*De],ht=I[2*De+1];Ye>=i&&Ye<=f&&ht>=u&&ht<=m&&N.push(b[De])}continue}const Q=W+$>>1,ie=I[2*Q],ge=I[2*Q+1];ie>=i&&ie<=f&&ge>=u&&ge<=m&&N.push(b[Q]),(0===j?i<=ie:u<=ge)&&(O.push(W),O.push(Q-1),O.push(1-j)),(0===j?f>=ie:m>=ge)&&(O.push(Q+1),O.push($),O.push(1-j))}return N}within(i,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:b,nodeSize:I}=this,A=[0,m.length-1,0],O=[],N=f*f;for(;A.length;){const j=A.pop()||0,$=A.pop()||0,W=A.pop()||0;if($-W<=I){for(let De=W;De<=$;De++)lv(b[2*De],b[2*De+1],i,u)<=N&&O.push(m[De]);continue}const Q=W+$>>1,ie=b[2*Q],ge=b[2*Q+1];lv(ie,ge,i,u)<=N&&O.push(m[Q]),(0===j?i-f<=ie:u-f<=ge)&&(A.push(W),A.push(Q-1),A.push(1-j)),(0===j?i+f>=ie:u+f>=ge)&&(A.push(Q+1),A.push($),A.push(1-j))}return O}}function Ap(s,i,u,f,m,b){if(m-f<=u)return;const I=f+m>>1;av(s,i,I,f,m,b),Ap(s,i,u,f,I-1,1-b),Ap(s,i,u,I+1,m,1-b)}function av(s,i,u,f,m,b){for(;m>f;){if(m-f>600){const N=m-f+1,j=u-f+1,$=Math.log(N),W=.5*Math.exp(2*$/3),Q=.5*Math.sqrt($*W*(N-W)/N)*(j-N/2<0?-1:1);av(s,i,u,Math.max(f,Math.floor(u-j*W/N+Q)),Math.min(m,Math.floor(u+(N-j)*W/N+Q)),b)}const I=i[2*u+b];let A=f,O=m;for(Fd(s,i,f,u),i[2*m+b]>I&&Fd(s,i,f,m);A<O;){for(Fd(s,i,A,O),A++,O--;i[2*A+b]<I;)A++;for(;i[2*O+b]>I;)O--}i[2*f+b]===I?Fd(s,i,f,O):(O++,Fd(s,i,O,m)),O<=u&&(f=O+1),u<=O&&(m=O-1)}}function Fd(s,i,u,f){uv(s,u,f),uv(i,2*u,2*f),uv(i,2*u+1,2*f+1)}function uv(s,i,u){const f=s[i];s[i]=s[u],s[u]=f}function lv(s,i,u,f){const m=s-u,b=i-f;return m*m+b*b}p.ARRAY_TYPE=sl,p.AUTH_ERR_MSG=ct,p.Aabb=al,p.Actor=class{constructor(s,i,u){this.target=s,this.parent=i,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Mn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=mr()?s:J,this.scheduler=new Qy}send(s,i,u,f,m=!1,b){const I=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=b,this.callbacks[I]=u);const A=Te(this.globalScope)?void 0:[];return this.target.postMessage({id:I,type:s,hasCallback:!!u,targetMapId:f,mustQueue:m,sourceMapId:this.mapId,data:il(i,A)},A),{cancel:()=>{u&&delete this.callbacks[I],this.target.postMessage({id:I,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(s){const i=s.data,u=i.id;if(u&&(!i.targetMapId||this.mapId===i.targetMapId))if("<cancel>"===i.type){const f=this.cancelCallbacks[u];delete this.cancelCallbacks[u],f&&f.cancel()}else if(i.mustQueue||mr()){const f=this.callbacks[u];this.cancelCallbacks[u]=this.scheduler.add(()=>this.processTask(u,i),f&&f.metadata||{type:"message"})}else this.processTask(u,i)}processTask(s,i){if("<response>"===i.type){const u=this.callbacks[s];delete this.callbacks[s],u&&(i.error?u(zc(i.error)):u(null,zc(i.data)))}else{const u=Te(this.globalScope)?void 0:[],f=i.hasCallback?(b,I)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:b?il(b):null,data:il(I,u)},u)}:b=>{},m=zc(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,m,f);else if(this.parent.getWorkerSource){const b=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,b[0],m.source)[b[1]](m,f)}else f(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=Ec,p.Color=zs,p.ColorMode=hi,p.CullFaceMode=od,p.DEMData=xl,p.DataConstantProperty=ue,p.DedupedRequest=vi,p.DepthMode=wl,p.EXTENT=Ir,p.Elevation=class{isDataAvailableAtPoint(s){const i=this._source();if(this.isUsingMockSource()||!i||s.y<0||s.y>1)return!1;const u=i.getSource().maxzoom,f=1<<u,m=Math.floor(s.x),b=Math.floor((s.x-m)*f),I=Math.floor(s.y*f),A=this.findDEMTileFor(new Nl(u,m,u,b,I));return!(!A||!A.dem)}getAtPointOrZero(s,i=0){return this.getAtPoint(s,i)||0}getAtPoint(s,i,u=!0){if(this.isUsingMockSource())return null;null==i&&(i=null);const f=this._source();if(!f||s.y<0||s.y>1)return i;const m=f.getSource().maxzoom,b=1<<m,I=Math.floor(s.x),A=s.x-I,O=new Nl(m,I,m,Math.floor(A*b),Math.floor(s.y*b)),N=this.findDEMTileFor(O);if(!N||!N.dem)return i;const j=N.dem,$=1<<N.tileID.canonical.z,W=(A*$-N.tileID.canonical.x)*j.dim,Q=(s.y*$-N.tileID.canonical.y)*j.dim,ie=Math.floor(W),ge=Math.floor(Q);return(u?this.exaggeration():1)*qn(qn(j.get(ie,ge),j.get(ie,ge+1),Q-ge),qn(j.get(ie+1,ge),j.get(ie+1,ge+1),Q-ge),W-ie)}getAtTileOffset(s,i,u){const f=1<<s.canonical.z;return this.getAtPointOrZero(new mf(s.wrap+(s.canonical.x+i/Ir)/f,(s.canonical.y+u/Ir)/f))}getAtTileOffsetFunc(s,i,u,f){return m=>{const b=this.getAtTileOffset(s,m.x,m.y),I=f.upVector(s.canonical,m.x,m.y);return vc(I,I,b*f.upVectorScale(s.canonical,i,u).metersToTile),I}}getForTilePoints(s,i,u,f){if(this.isUsingMockSource())return!1;const m=t_.create(this,s,f);return!!m&&(i.forEach(b=>{b[2]=this.exaggeration()*m.getElevationAt(b[0],b[1],u)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(s);if(!i||!i.dem)return null;const u=i.dem.tree,f=i.tileID,m=1<<s.canonical.z-f.canonical.z;let b=s.canonical.x/m-f.canonical.x,I=s.canonical.y/m-f.canonical.y,A=0;for(let O=0;O<s.canonical.z-f.canonical.z&&!u.leaves[A];O++){b*=2,I*=2;const N=2*Math.floor(I)+Math.floor(b);A=u.childOffsets[A]+N,b%=1,I%=1}return{min:this.exaggeration()*u.minimums[A],max:this.exaggeration()*u.maximums[A]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,i,u){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=Oa,p.EvaluationParameters=G,p.Event=Za,p.Evented=Na,p.FillExtrusionBucket=dp,p.Frustum=Yp,p.FrustumCorners=Zp,p.GLOBE_RADIUS=Yl,p.GLOBE_SCALE_MATCH_LATITUDE=45,p.GLOBE_ZOOM_THRESHOLD_MAX=Id,p.GLOBE_ZOOM_THRESHOLD_MIN=du,p.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_fillGridMeshWithLods(s,i){const u=new Dn,f=new yr,m=[],b=s+1+2,I=i[0]+1,A=i[0]+1+(1+i.length),O=(N,j,$)=>{let W=N===b-1?N-2:0===N?N:N-1;return W+=$?24575:0,[W,j]};for(let N=0;N<b;++N)u.emplaceBack(...O(N,0,!0));for(let N=0;N<I;++N)for(let j=0;j<b;++j)u.emplaceBack(...O(j,N,(0===j||j===b-1)&&!0));for(let N=0;N<i.length;++N){const j=i[N];for(let $=0;$<b;++$)u.emplaceBack(...O($,j,!0))}for(let N=0;N<i.length;++N){const j=f.length,$=i[N]+1+2,W=new yr;for(let ge=0;ge<$-1;ge++){const De=ge===$-2,Ye=De?b*(A-i.length+N-ge):b;for(let ht=0;ht<b-1;ht++){const Ke=ge*b+ht;0===ge||De||0===ht||ht===b-2?(W.emplaceBack(Ke+1,Ke,Ke+Ye),W.emplaceBack(Ke+Ye,Ke+Ye+1,Ke+1)):(f.emplaceBack(Ke+1,Ke,Ke+Ye),f.emplaceBack(Ke+Ye,Ke+Ye+1,Ke+1))}}const Q=Ns.simpleSegment(0,j,u.length,f.length-j);for(let ge=0;ge<W.uint16.length;ge+=3)f.emplaceBack(W.uint16[ge],W.uint16[ge+1],W.uint16[ge+2]);const ie=Ns.simpleSegment(0,j,u.length,f.length-j);m.push({withoutSkirts:Q,withSkirts:ie})}return{vertices:u,indices:f,segments:m}}_createGrid(s){const i=this._fillGridMeshWithLods(64,Hf);this._gridSegments=i.segments,this._gridBuffer=s.createVertexBuffer(i.vertices,Sd.members),this._gridIndexBuffer=s.createIndexBuffer(i.indices,!0)}_createPoles(s){const i=new yr;for(let m=0;m<=64;m++)i.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=s.createIndexBuffer(i,!0);const u=new ls,f=new ls;this._poleSegments=[];for(let m=0,b=0;m<du;m++){const I=360/(1<<m);u.emplaceBack(0,-Yl,0,.5,0),f.emplaceBack(0,-Yl,0,.5,1);for(let A=0;A<=64;A++){const O=A/64,N=qn(0,I,O),[j,$,W]=Zh(rp,Md,N,Yl);u.emplaceBack(j,$,W,O,0),f.emplaceBack(j,$,W,O,1)}this._poleSegments.push(Ns.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(u,si,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(f,si,!1)}getGridBuffers(s,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,i){if(!this._wireframeSegments){const u=new Iu,f=64,m=f+1+2,b=1;this._wireframeSegments=[];for(let I=0,A=0;I<Hf.length;I++){const O=Hf[I];for(let j=b;j<O+b;j++)for(let $=b;$<f+b;$++){const W=j*m+$;u.emplaceBack(W,W+1),u.emplaceBack(W,W+m),u.emplaceBack(W,W+m+1)}const N=O*f*3;this._wireframeSegments.push(Ns.simpleSegment(0,A,(O+1)*m,N)),A+=N}this._wireframeIndexBuffer=s.createIndexBuffer(u)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[i]]}},p.GlyphManager=wf,p.ImagePosition=pg,p.KDBush=Um,p.LivePerformanceUtils=wo,p.LngLat=cs,p.LngLatBounds=Kc,p.LocalGlyphMode=Pm,p.MAX_MERCATOR_LATITUDE=gu,p.MercatorCoordinate=mf,p.ONE_EM=ju,p.OverscaledTileID=Nl,p.PerformanceMarkers=pl,p.Point=te,p.Properties=Qe,p.RGBAImage=tc,p.Ray=Xh,p.RequestManager=class{constructor(s,i,u){this._transformRequestFn=s,this._customAccessToken=i,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const s=function(){let i="";for(let u=0;u<10;u++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",le,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,i){return this._transformRequestFn&&this._transformRequestFn(s,i)||{url:s}}normalizeStyleURL(s,i){if(!Ze(s))return s;const u=Bn(s);return u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||i)}normalizeGlyphsURL(s,i){if(!Ze(s))return s;const u=Bn(s);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||i)}normalizeSourceURL(s,i,u,f){if(!Ze(s))return s;const m=Bn(s);return m.path=`/v4/${m.authority}.json`,m.params.push("secure"),u&&m.params.push(`language=${u}`),f&&m.params.push(`worldview=${f}`),this._makeAPIURL(m,this._customAccessToken||i)}normalizeSpriteURL(s,i,u,f){const m=Bn(s);return Ze(s)?(m.path=`/styles/v1${m.path}/sprite${i}${u}`,this._makeAPIURL(m,this._customAccessToken||f)):(m.path+=`${i}${u}`,Sn(m))}normalizeTileURL(s,i,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Ze(s))return s;const f=Bn(s);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||u&&"raster"!==f.authority&&512===u?"@2x":""}${qe.supported?".webp":"$1"}`),"raster"===f.authority?f.path=`/${Pe.RASTER_URL_PREFIX}${f.path}`:(f.path=f.path.replace(/^.+\/v4\//,"/"),f.path=`/${Pe.TILE_URL_VERSION}${f.path}`);const m=this._customAccessToken||function(b){for(const I of b){const A=I.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(f.params)||Pe.ACCESS_TOKEN;return Pe.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&f.params.push(`sku=${this._skuToken}`),this._makeAPIURL(f,m)}canonicalizeTileURL(s,i){const u=Bn(s);if(!u.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!u.path.match(/\.[\w]+$/))return s;let f="mapbox://";u.path.match(/^\/raster\/v1\//)?f+=`raster/${u.path.replace(`/${Pe.RASTER_URL_PREFIX}/`,"")}`:f+=`tiles/${u.path.replace(`/${Pe.TILE_URL_VERSION}/`,"")}`;let m=u.params;return i&&(m=m.filter(b=>!b.match(/^access_token=/))),m.length&&(f+=`?${m.join("&")}`),f}canonicalizeTileset(s,i){const u=!!i&&Ze(i),f=[];for(const m of s.tiles||[])Ft(m)?f.push(this.canonicalizeTileURL(m,u)):f.push(m);return f}_makeAPIURL(s,i){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",f=Bn(Pe.API_URL);if(s.protocol=f.protocol,s.authority=f.authority,"http"===s.protocol){const m=s.params.indexOf("secure");m>=0&&s.params.splice(m,1)}if("/"!==f.path&&(s.path=`${f.path}${s.path}`),!Pe.REQUIRE_ACCESS_TOKEN)return Sn(s);if(i=i||Pe.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return s.params=s.params.filter(m=>-1===m.indexOf("access_token")),s.params.push(`access_token=${i||""}`),Sn(s)}},p.ResourceType=Pi,p.SegmentVector=Ns,p.SourceCache=Sg,p.StencilMode=Cg,p.StructArrayLayout1ui2=Xl,p.StructArrayLayout2f1f2i16=Ar,p.StructArrayLayout2i4=Dn,p.StructArrayLayout2ui4=Iu,p.StructArrayLayout3f12=ci,p.StructArrayLayout3ui6=yr,p.StructArrayLayout4i8=an,p.StructArrayLayout5f20=ls,p.Texture=id,p.Tile=jt,p.Transitionable=se,p.Uniform1f=Zd,p.Uniform1i=class extends iu{constructor(s){super(s),this.current=0}set(s,i,u){this.fetchUniformLocation(s,i)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},p.Uniform2f=class extends iu{constructor(s){super(s),this.current=[0,0]}set(s,i,u){this.fetchUniformLocation(s,i)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}},p.Uniform3f=class extends iu{constructor(s){super(s),this.current=[0,0,0]}set(s,i,u){this.fetchUniformLocation(s,i)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}},p.Uniform4f=Yd,p.UniformColor=Kd,p.UniformMatrix2f=class extends iu{constructor(s){super(s),this.current=Zl}set(s,i,u){if(this.fetchUniformLocation(s,i))for(let f=0;f<4;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}},p.UniformMatrix3f=class extends iu{constructor(s){super(s),this.current=ey}set(s,i,u){if(this.fetchUniformLocation(s,i))for(let f=0;f<9;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix3fv(this.location,!1,u);break}}},p.UniformMatrix4f=class extends iu{constructor(s){super(s),this.current=v_}set(s,i,u){if(this.fetchUniformLocation(s,i)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let f=1;f<16;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}},p.UnwrappedTileID=Ry,p.ValidationError=$n,p.VectorTileFeature=ug,p.VectorTileWorkerSource=class extends Na{constructor(s,i,u,f,m){super(),this.actor=s,this.layerIndex=i,this.availableImages=u,this.loadVectorData=m||j0,this.loading={},this.loaded={},this.deduped=new vi(s.scheduler),this.isSpriteLoaded=f,this.scheduler=s.scheduler}loadTile(s,i){const u=s.uid,f=s&&s.request,m=f&&f.collectResourceTiming,b=this.loading[u]=new px(s);b.abort=this.loadVectorData(s,(I,A)=>{const O=!this.loading[u];if(delete this.loading[u],O||I||!A)return b.status="done",O||(this.loaded[u]=b),i(I);const N=A.rawData,j={};A.expires&&(j.expires=A.expires),A.cacheControl&&(j.cacheControl=A.cacheControl),b.vectorTile=A.vectorTile||new vf(new Em(N));const $=()=>{b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,(W,Q)=>{if(W||!Q)return i(W);const ie={};if(m){const ge=Lf(f);ge.length>0&&(ie.resourceTiming=JSON.parse(JSON.stringify(ge)))}i(null,Be({rawTileData:N.slice(0)},Q,j,ie))})};this.isSpriteLoaded?$():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add($,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):$()}),this.loaded=this.loaded||{},this.loaded[u]=b})}reloadTile(s,i){const u=this.loaded,f=s.uid,m=this;if(u&&u[f]){const b=u[f];b.showCollisionBoxes=s.showCollisionBoxes,b.enableTerrain=!!s.enableTerrain,b.projection=s.projection,b.tileTransform=rf(s.tileID.canonical,s.projection);const I=(A,O)=>{const N=b.reloadCallback;N&&(delete b.reloadCallback,b.parse(b.vectorTile,m.layerIndex,this.availableImages,m.actor,N)),i(A,O)};"parsing"===b.status?b.reloadCallback=I:"done"===b.status&&(b.vectorTile?b.parse(b.vectorTile,this.layerIndex,this.availableImages,this.actor,I):I())}}abortTile(s,i){const u=s.uid,f=this.loading[u];f&&(f.abort&&f.abort(),delete this.loading[u]),i()}removeTile(s,i){const u=this.loaded,f=s.uid;u&&u[f]&&delete u[f],i()}},p.WritingMode=Fl,p.ZoomDependentExpression=za,p.add=th,p.addDynamicAttributes=Tp,p.adjoint=function(s,i){var u=i[0],f=i[1],m=i[2],b=i[3],I=i[4],A=i[5],O=i[6],N=i[7],j=i[8];return s[0]=I*j-A*N,s[1]=m*N-f*j,s[2]=f*A-m*I,s[3]=A*O-b*j,s[4]=u*j-m*O,s[5]=m*b-u*A,s[6]=b*N-I*O,s[7]=f*O-u*N,s[8]=u*I-f*b,s},p.asyncAll=ft,p.bezier=sn,p.bindAll=Mn,p.boundsAttributes=yt,p.bufferConvexPolygon=function(s,i){const u=[];for(let f=0;f<s.length;f++){const m=Ue(f-1,-1,s.length-1),b=Ue(f+1,-1,s.length-1),I=s[f],A=s[b],O=s[m].sub(I).unit(),N=A.sub(I).unit(),j=N.angleWithSep(O.x,O.y),$=O.add(N).unit().mult(-1*i/Math.sin(j/2));u.push(I.add($))}return u},p.cacheEntryPossiblyAdded=function(s){Gr++,Gr>yn&&(s.getActor().send("enforceCacheSizeLimit",Yt),Gr=0)},p.calculateGlobeLabelMatrix=function(s,i){const{x:u,y:f}=s.point,m=uy(u,f,s.worldSize/s._pixelsPerMercatorPixel,0,0);return Jc(m,m,df(xh(i)))},p.calculateGlobeMatrix=function(s){const{x:i,y:u}=s.point,{lng:f,lat:m}=s._center;return uy(i,u,s.worldSize,f,m)},p.calculateGlobeMercatorMatrix=function(s){const i=s.pixelsPerMeter,u=i/wh(1,s.center.lat),f=fu(new Float64Array(16));return Qc(f,f,[s.point.x,s.point.y,0]),eh(f,f,[u,u,i]),Float32Array.from(f)},p.circumferenceAtLatitude=cy,p.clamp=Le,p.clearTileCache=function(s){if(!Dr())return;const i=J.caches.delete(Ct);s&&i.catch(s).then(()=>s())},p.clipLine=$y,p.clone=function(s){var i=new sl(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},p.clone$1=wn,p.collisionCircleLayout=w0,p.config=Pe,p.conjugate=function(s,i){return s[0]=-i[0],s[1]=-i[1],s[2]=-i[2],s[3]=i[3],s},p.create=function(){var s=new sl(16);return sl!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},p.create$1=Hp,p.createExpression=pa,p.createLayout=Rt,p.createStyleLayer=function(s){return"custom"===s.type?new iv(s):new N0[s.type](s)},p.cross=Wp,p.degToRad=Je,p.distance=function(s,i){return Math.hypot(i[0]-s[0],i[1]-s[1],i[2]-s[2])},p.div=function(s,i,u){return s[0]=i[0]/u[0],s[1]=i[1]/u[1],s[2]=i[2]/u[2],s},p.dot=ou,p.earthRadius=Vc,p.ease=Bt,p.easeCubicInOut=Ne,p.ecefToLatLng=function([s,i,u]){const f=Math.hypot(s,i,u),m=Math.atan2(s,u),b=.5*Math.PI-Math.acos(-i/f);return new cs(He(m),He(b))},p.emitValidationErrors=nn,p.endsWith=jn,p.enforceCacheSizeLimit=function(s){Pr(),_n&&_n.then(i=>{i.keys().then(u=>{for(let f=0;f<u.length-s;f++)i.delete(u[f])})})},p.evaluateSizeForFeature=xf,p.evaluateSizeForZoom=ef,p.evaluateVariableOffset=Pd,p.evented=M,p.exactEquals=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]&&s[3]===i[3]},p.exactEquals$1=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]},p.exported=_a,p.exported$1=qe,p.extend=Be,p.extend$1=Wu,p.fillExtrusionHeightLift=_m,p.filterObject=Nn,p.fromMat4=function(s,i){return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[4],s[4]=i[5],s[5]=i[6],s[6]=i[8],s[7]=i[9],s[8]=i[10],s},p.fromQuat=function(s,i){var u=i[0],f=i[1],m=i[2],b=i[3],I=u+u,A=f+f,O=m+m,N=u*I,j=f*I,$=f*A,W=m*I,Q=m*A,ie=m*O,ge=b*I,De=b*A,Ye=b*O;return s[0]=1-$-ie,s[1]=j+Ye,s[2]=W-De,s[3]=0,s[4]=j-Ye,s[5]=1-N-ie,s[6]=Q+ge,s[7]=0,s[8]=W+De,s[9]=Q-ge,s[10]=1-N-$,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},p.fromRotation=function(s,i){var u=Math.sin(i),f=Math.cos(i);return s[0]=f,s[1]=u,s[2]=0,s[3]=-u,s[4]=f,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},p.fromScaling=Jv,p.furthestTileCorner=function(s){const i=Math.round((s+45+360)%360/90)%4;return it[i]},p.getAABBPointSquareDist=function(s,i,u){let f=0;for(let m=0;m<2;++m){const b=u?u[m]:0;s[m]>b&&(f+=(s[m]-b)*(s[m]-b)),i[m]<b&&(f+=(b-i[m])*(b-i[m]))}return f},p.getAnchorAlignment=Im,p.getAnchorJustification=K_,p.getBounds=function(s){let i=1/0,u=1/0,f=-1/0,m=-1/0;for(const b of s)i=Math.min(i,b.x),u=Math.min(u,b.y),f=Math.max(f,b.x),m=Math.max(m,b.y);return{min:new te(i,u),max:new te(f,m)}},p.getColumn=et,p.getDefaultExportFromCjs=K,p.getGridMatrix=function(s,i,u,f){const m=i.getNorth(),b=i.getSouth(),I=i.getWest(),A=i.getEast(),O=1<<s.z,N=A-I,j=m-b,$=N/64,W=-j/Hf[u],Q=[0,$,0,W,0,0,m,I,0];if(s.z>0){const ie=180/f;Rl(Q,Q,[ie/N+1,0,0,0,ie/j+1,0,-.5*ie/$,.5*ie/W,1])}return Q[2]=O,Q[5]=s.x,Q[8]=s.y,Q},p.getImage=tt,p.getJSON=function(s,i){return Ki(Be(s,{type:"json"}),i)},p.getLatitudinalLod=function(s){const i=gu-5;s=Le(s,-i,i)/i*90;const u=Math.pow(Math.abs(Math.sin(Je(s))),3);return Math.round(u*(Hf.length-1))},p.getMapSessionAPI=Xo,p.getPerformanceMeasurement=Lf,p.getProjection=Eg,p.getRTLTextPluginStatus=P,p.getReferrer=Ci,p.getTilePoint=function(s,{x:i,y:u},f=0){return new te(((i-f)*s.scale-s.x)*Ir,(u*s.scale-s.y)*Ir)},p.getTileVec3=function(s,i,u=0){return $h(((i.x-u)*s.scale-s.x)*Ir,(i.y*s.scale-s.y)*Ir,E_(i.z,i.y))},p.getVideo=function(s,i){const u=J.document.createElement("video");u.muted=!0,u.onloadstart=function(){i(null,u)};for(let f=0;f<s.length;f++){const m=J.document.createElement("source");Hs(s[f])||(u.crossOrigin="Anonymous"),m.src=s[f],u.appendChild(m)}return{cancel:()=>{}}},p.globeCenterToScreenPoint=function(s){const i=[0,0,0],u=fu(new Float64Array(16));return Jc(u,s.pixelMatrix,s.globeMatrix),ra(i,i,u),new te(i[0],i[1])},p.globeDenormalizeECEF=df,p.globeECEFOrigin=function(s,i){const u=[0,0,0];return ra(u,u,Wf(xh(i.canonical))),ra(u,u,s),u},p.globeMetersToEcef=vh,p.globeNormalizeECEF=Wf,p.globePixelsToTileUnits=function(s,i){return Ir/(512*Math.pow(2,s))*ff(xh(i))},p.globePoleMatrixForTile=function(s,i,u){const f=fu(new Float64Array(16)),m=(i/(1<<s)-.5)*Math.PI*2;return yd(f,u.globeMatrix,m),Float32Array.from(f)},p.globeTileBounds=xh,p.globeTiltAtLngLat=Wg,p.globeToMercatorTransition=pf,p.globeUseCustomAntiAliasing=function(s,i,u){const f=pf(u.zoom),m=s.style.map._antialias,b=!!i.extStandardDerivatives,I=i.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return 0===f&&!m&&!I&&b},p.identity=fu,p.identity$1=$g,p.invert=ry,p.isFullscreen=function(){return!!J.document.fullscreenElement||!!J.document.webkitFullscreenElement},p.isLngLatBehindGlobe=ly,p.isMapAuthenticated=function(s){return zi.has(s)},p.isMapboxURL=Ze,p.isSafariWithAntialiasingBug=function(s){const i=s.navigator?s.navigator.userAgent:null;return!!Te(s)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=pu,p.latLngToECEF=np,p.len=e0,p.length=_d,p.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},p.lngFromMercatorX=Ql,p.loadVectorTile=j0,p.makeRequest=Ki,p.mapValue=function(s,i,u,f,m){return Le((s-i)/(u-i)*(m-f)+f,f,m)},p.mercatorScale=C_,p.mercatorXfromLng=Yh,p.mercatorYfromLat=Kh,p.mercatorZfromAltitude=wh,p.mul=Jd,p.mul$1=jg,p.multiply=Jc,p.multiply$1=Rl,p.multiply$2=xd,p.nextPowerOfTwo=zt,p.normalize=Vu,p.normalize$1=qg,p.normalize$2=sy,p.number=qn,p.ortho=function(s,i,u,f,m,b,I){var A=1/(i-u),O=1/(f-m),N=1/(b-I);return s[0]=-2*A,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*O,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*N,s[11]=0,s[12]=(i+u)*A,s[13]=(m+f)*O,s[14]=(I+b)*N,s[15]=1,s},p.pbf=Qf,p.perspective=function(s,i,u,f,m){var b,I=1/Math.tan(i/2);return s[0]=I/u,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=I,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,null!=m&&m!==1/0?(s[10]=(m+f)*(b=1/(f-m)),s[14]=2*m*f*b):(s[10]=-1,s[14]=-2*f),s},p.pick=function(s,i){const u={};for(let f=0;f<i.length;f++){const m=i[f];m in s&&(u[m]=s[m])}return u},p.plugin=z,p.pointGeometry=ae,p.polesInViewport=function(s){const i=fu(new Float64Array(16));Jc(i,s.pixelMatrix,s.globeMatrix);const u=[0,vl,0],f=[0,_h,0];return ra(u,u,i),ra(f,f,i),[u[0]>0&&u[0]<=s.width&&u[1]>0&&u[1]<=s.height&&!ly(s,new cs(s.center.lat,90)),f[0]>0&&f[0]<=s.width&&f[1]>0&&f[1]<=s.height&&!ly(s,new cs(s.center.lat,-90))]},p.polygonContainsPoint=op,p.polygonIntersectsBox=gy,p.polygonIntersectsPolygon=I_,p.polygonizeBounds=function(s,i,u=0,f=!0){const m=new te(u,u),b=s.sub(m),I=i.add(m),A=[b,new te(I.x,b.y),I,new te(b.x,I.y)];return f&&A.push(b.clone()),A},p.posAttributes=Sd,p.postMapLoadEvent=ds,p.postPerformanceEvent=ao,p.postTurnstileEvent=fi,p.potpack=su,p.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},p.radToDeg=He,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(s){return s({pluginStatus:w,pluginURL:l}),M.on("pluginStateChange",s),s},p.removeAuthState=function(s){zi.delete(s)},p.renderColorRamp=rm,p.resample=Xg,p.rotateX=iy,p.rotateX$1=Ed,p.rotateY=yd,p.rotateY$1=Hh,p.rotateZ=function(s,i,u){var f=Math.sin(u),m=Math.cos(u),b=i[0],I=i[1],A=i[2],O=i[3],N=i[4],j=i[5],$=i[6],W=i[7];return i!==s&&(s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=b*m+N*f,s[1]=I*m+j*f,s[2]=A*m+$*f,s[3]=O*m+W*f,s[4]=N*m-b*f,s[5]=j*m-I*f,s[6]=$*m-A*f,s[7]=W*m-O*f,s},p.rotateZ$1=function(s,i,u){u*=.5;var f=i[0],m=i[1],b=i[2],I=i[3],A=Math.sin(u),O=Math.cos(u);return s[0]=f*O+m*A,s[1]=m*O-f*A,s[2]=b*O+I*A,s[3]=I*O-b*A,s},p.scale=eh,p.scale$1=Gg,p.scale$2=vc,p.scaleAndAdd=bd,p.set=function(s,i,u,f){return s[0]=i,s[1]=u,s[2]=f,s},p.setCacheLimits=function(s,i){Yt=s,yn=i},p.setColumn=function(s,i,u){s[4*i+0]=u[0],s[4*i+1]=u[1],s[4*i+2]=u[2],s[4*i+3]=u[3]},p.setRTLTextPlugin=function(s,i,u=!1){if(w===gd||w===Ff||w===qp)throw new Error("setRTLTextPlugin cannot be called multiple times.");l=_a.resolveURL(s),w=gd,Bf=i,C(),u||k()},p.smoothstep=bt,p.spec=on,p.squaredLength=function(s){var i=s[0],u=s[1],f=s[2];return i*i+u*u+f*f},p.storeAuthState=function(s,i){i?zi.add(s):zi.delete(s)},p.sub=wc,p.subtract=vd,p.symbolSize=z_,p.tileAABB=function(s,i,u,f,m,b,I,A,O){if("globe"===O.name)return function n0(s,i,u){const f=i/s.worldSize,m=s.globeMatrix;if(u.z<=1){const Wt=xh(u).getCorners();return Kp(Wt,m,f),al.fromPoints(Wt)}const b=Ga(u),I=ay(b);Kp(I,m,f);const A=Number.MAX_VALUE,O=[-A,-A,-A],N=[A,A,A];if(b.contains(s.center)){for(const On of I)qh(N,N,On),wd(O,O,On);O[2]=0;const Wt=s.point,hn=[Wt.x*f,Wt.y*f,0];return qh(N,N,hn),wd(O,O,hn),new al(N,O)}const j=[m[12]*f,m[13]*f,m[14]*f],$=b.getCenter(),W=Le(s.center.lat,-gu,gu),Q=Le($.lat,-gu,gu),ie=Yh(s.center.lng),ge=Kh(W);let De=ie-Yh($.lng);const Ye=ge-Kh(Q);De>.5?De-=1:De<-.5&&(De+=1);let ht=0;Math.abs(De)>Math.abs(Ye)?ht=De>=0?1:3:(ht=Ye>=0?0:2,bd(j,j,[m[4]*f,m[5]*f,m[6]*f],-Math.sin(Je(Ye>=0?b.getSouth():b.getNorth()))*Yl));const Ke=I[ht],ut=I[(ht+1)%4],xt=new w_(Ke,ut,j),_t=[b_(xt,0)||Ke[0],b_(xt,1)||Ke[1],b_(xt,2)||Ke[2]],Kt=pf(s.zoom);if(Kt>0){const Wt=function({x:On,y:tn,z:dn},mn,In,Un,cn){const Zn=1/(1<<dn);let nr=On*Zn,Yn=nr+Zn,xi=tn*Zn,Vn=xi+Zn,Mr=0;const yi=(nr+Yn)/2-Un;return yi>.5?Mr=-1:yi<-.5&&(Mr=1),nr=((nr+Mr)*mn-(Un*=mn))*In+Un,Yn=((Yn+Mr)*mn-Un)*In+Un,xi=(xi*mn-(cn*=mn))*In+cn,Vn=(Vn*mn-cn)*In+cn,[[nr,Vn,0],[Yn,Vn,0],[Yn,xi,0],[nr,xi,0]]}(u,i,s._pixelsPerMercatorPixel,ie,ge);for(let On=0;On<I.length;On++)ep(I[On],Wt[On],Kt);const hn=th([],Wt[ht],Wt[(ht+1)%4]);vc(hn,hn,.5),ep(_t,hn,Kt)}for(const Wt of I)qh(N,N,Wt),wd(O,O,Wt);return N[2]=Math.min(Ke[2],ut[2]),qh(N,N,_t),wd(O,O,_t),new al(N,O)}(s,i,new Ec(u,f,m));const N=rf({z:u,x:f,y:m},O);return new al([(b+N.x/N.scale)*i,i*(N.y/N.scale),I],[(b+N.x2/N.scale)*i,i*(N.y2/N.scale),A])},p.tileCornersToBounds=Ga,p.tileTransform=rf,p.transformMat3=function(s,i,u){var f=i[0],m=i[1],b=i[2];return s[0]=f*u[0]+m*u[3]+b*u[6],s[1]=f*u[1]+m*u[4]+b*u[7],s[2]=f*u[2]+m*u[5]+b*u[8],s},p.transformMat4=ra,p.transformMat4$1=$f,p.transformQuat=Xp,p.transitionTileAABBinECEF=tp,p.translate=Qc,p.transpose=function(s,i){if(s===i){var u=i[1],f=i[2],m=i[5];s[1]=i[3],s[2]=i[6],s[3]=u,s[5]=i[7],s[6]=f,s[7]=m}else s[0]=i[0],s[1]=i[3],s[2]=i[6],s[3]=i[1],s[4]=i[4],s[5]=i[7],s[6]=i[2],s[7]=i[5],s[8]=i[8];return s},p.triggerPluginCompletionEvent=g,p.uniqueId=Jt,p.updateGlobeVertexNormal=function(s,i,u,f,m){const b=5*i+2;s.float32[b+0]=u,s.float32[b+1]=f,s.float32[b+2]=m},p.validateCustomStyleLayer=function(s){const i=[],u=s.id;return void 0===u&&i.push({message:`layers.${u}: missing required property "id"`}),void 0===s.render&&i.push({message:`layers.${u}: missing required method "render"`}),s.renderingMode&&"2d"!==s.renderingMode&&"3d"!==s.renderingMode&&i.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),i},p.validateFilter=s=>qt(Cu(s)),p.validateFog=s=>qt(x(s)),p.validateLayer=s=>qt(Ua(s)),p.validateLight=s=>qt(h(s)),p.validateSource=s=>qt(ke(s)),p.validateStyle=pe,p.validateTerrain=s=>qt(y(s)),p.values=Tt,p.vectorTile=fm,p.version=ye,p.warnOnce=Sr,p.window=J,p.wrap=Ue}),q(0,function(p){function J(rt){if("number"==typeof rt||"boolean"==typeof rt||"string"==typeof rt||null==rt)return JSON.stringify(rt);if(Array.isArray(rt)){let be="[";for(const tt of rt)be+=`${J(tt)},`;return`${be}]`}let xe="{";for(const be of Object.keys(rt).sort())xe+=`${be}:${J(rt[be])},`;return`${xe}}`}function ye(rt){let xe="";for(const be of p.refProperties)xe+=`/${J(rt[be])}`;return xe}class Ce{constructor(xe){this.keyCache={},xe&&this.replace(xe)}replace(xe){this._layerConfigs={},this._layers={},this.update(xe,[])}update(xe,be){for(const ct of xe)this._layerConfigs[ct.id]=ct,(this._layers[ct.id]=p.createStyleLayer(ct)).compileFilter(),this.keyCache[ct.id]&&delete this.keyCache[ct.id];for(const ct of be)delete this.keyCache[ct],delete this._layerConfigs[ct],delete this._layers[ct];this.familiesBySource={};const tt=function(ct,Ze){const Ft={};for(let lt=0;lt<ct.length;lt++){const Zt=Ze&&Ze[ct[lt].id]||ye(ct[lt]);Ze&&(Ze[ct[lt].id]=Zt);let Cn=Ft[Zt];Cn||(Cn=Ft[Zt]=[]),Cn.push(ct[lt])}const Nt=[];for(const lt in Ft)Nt.push(Ft[lt]);return Nt}(p.values(this._layerConfigs),this.keyCache);for(const ct of tt){const Ze=ct.map(Bn=>this._layers[Bn.id]),Ft=Ze[0];if("none"===Ft.visibility)continue;const Nt=Ft.source||"";let lt=this.familiesBySource[Nt];lt||(lt=this.familiesBySource[Nt]={});const Zt=Ft.sourceLayer||"_geojsonTileLayer";let Cn=lt[Zt];Cn||(Cn=lt[Zt]=[]),Cn.push(Ze)}}}class Pe{loadTile(xe,be){const{uid:tt,encoding:ct,rawImageData:Ze,padding:Ft,buildQuadTree:Nt}=xe,lt=p.window.ImageBitmap&&Ze instanceof p.window.ImageBitmap?this.getImageData(Ze,Ft):Ze;be(null,new p.DEMData(tt,lt,ct,Ft<1,Nt))}getImageData(xe,be){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(xe.width,xe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=xe.width,this.offscreenCanvas.height=xe.height,this.offscreenCanvasContext.drawImage(xe,0,0,xe.width,xe.height);const tt=this.offscreenCanvasContext.getImageData(-be,-be,xe.width+2*be,xe.height+2*be);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),tt}}function qe(rt,xe){if(0!==rt.length){It(rt[0],xe);for(var be=1;be<rt.length;be++)It(rt[be],!xe)}}function It(rt,xe){for(var be=0,tt=0,ct=0,Ze=rt.length,Ft=Ze-1;ct<Ze;Ft=ct++){var Nt=(rt[ct][0]-rt[Ft][0])*(rt[Ft][1]+rt[ct][1]),lt=be+Nt;tt+=Math.abs(be)>=Math.abs(Nt)?be-lt+Nt:Nt-lt+be,be=lt}be+tt>=0!=!!xe&&rt.reverse()}var gt=p.getDefaultExportFromCjs(function rt(xe,be){var tt,ct=xe&&xe.type;if("FeatureCollection"===ct)for(tt=0;tt<xe.features.length;tt++)rt(xe.features[tt],be);else if("GeometryCollection"===ct)for(tt=0;tt<xe.geometries.length;tt++)rt(xe.geometries[tt],be);else if("Feature"===ct)rt(xe.geometry,be);else if("Polygon"===ct)qe(xe.coordinates,be);else if("MultiPolygon"===ct)for(tt=0;tt<xe.coordinates.length;tt++)qe(xe.coordinates[tt],be);return xe});const st=p.VectorTileFeature.prototype.toGeoJSON;var mt={exports:{}},Mt=p.pointGeometry,le=p.vectorTile.VectorTileFeature,K=ne;function ne(rt,xe){this.options=xe||{},this.features=rt,this.length=rt.length}function ce(rt,xe){this.id="number"==typeof rt.id?rt.id:void 0,this.type=rt.type,this.rawGeometry=1===rt.type?[rt.geometry]:rt.geometry,this.properties=rt.tags,this.extent=xe||4096}ne.prototype.feature=function(rt){return new ce(this.features[rt],this.options.extent)},ce.prototype.loadGeometry=function(){var rt=this.rawGeometry;this.geometry=[];for(var xe=0;xe<rt.length;xe++){for(var be=rt[xe],tt=[],ct=0;ct<be.length;ct++)tt.push(new Mt(be[ct][0],be[ct][1]));this.geometry.push(tt)}return this.geometry},ce.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var rt=this.geometry,xe=1/0,be=-1/0,tt=1/0,ct=-1/0,Ze=0;Ze<rt.length;Ze++)for(var Ft=rt[Ze],Nt=0;Nt<Ft.length;Nt++){var lt=Ft[Nt];xe=Math.min(xe,lt.x),be=Math.max(be,lt.x),tt=Math.min(tt,lt.y),ct=Math.max(ct,lt.y)}return[xe,tt,be,ct]},ce.prototype.toGeoJSON=le.prototype.toGeoJSON;var ee=p.pbf,ae=K;function oe(rt){var xe=new ee;return function(be,tt){for(var ct in be.layers)tt.writeMessage(3,te,be.layers[ct])}(rt,xe),xe.finish()}function te(rt,xe){var be;xe.writeVarintField(15,rt.version||1),xe.writeStringField(1,rt.name||""),xe.writeVarintField(5,rt.extent||4096);var tt={keys:[],values:[],keycache:{},valuecache:{}};for(be=0;be<rt.length;be++)tt.feature=rt.feature(be),xe.writeMessage(2,_e,tt);var ct=tt.keys;for(be=0;be<ct.length;be++)xe.writeStringField(3,ct[be]);var Ze=tt.values;for(be=0;be<Ze.length;be++)xe.writeMessage(4,Ne,Ze[be])}function _e(rt,xe){var be=rt.feature;void 0!==be.id&&xe.writeVarintField(1,be.id),xe.writeMessage(2,re,rt),xe.writeVarintField(3,be.type),xe.writeMessage(4,it,be)}function re(rt,xe){var be=rt.feature,tt=rt.keys,ct=rt.values,Ze=rt.keycache,Ft=rt.valuecache;for(var Nt in be.properties){var lt=be.properties[Nt],Zt=Ze[Nt];if(null!==lt){void 0===Zt&&(tt.push(Nt),Ze[Nt]=Zt=tt.length-1),xe.writeVarint(Zt);var Cn=typeof lt;"string"!==Cn&&"boolean"!==Cn&&"number"!==Cn&&(lt=JSON.stringify(lt));var Bn=Cn+":"+lt,Sn=Ft[Bn];void 0===Sn&&(ct.push(lt),Ft[Bn]=Sn=ct.length-1),xe.writeVarint(Sn)}}}function Je(rt,xe){return(xe<<3)+(7&rt)}function He(rt){return rt<<1^rt>>31}function it(rt,xe){for(var be=rt.loadGeometry(),tt=rt.type,ct=0,Ze=0,Ft=be.length,Nt=0;Nt<Ft;Nt++){var lt=be[Nt],Zt=1;1===tt&&(Zt=lt.length),xe.writeVarint(Je(1,Zt));for(var Cn=3===tt?lt.length-1:lt.length,Bn=0;Bn<Cn;Bn++){1===Bn&&1!==tt&&xe.writeVarint(Je(2,Cn-1));var Sn=lt[Bn].x-ct,ri=lt[Bn].y-Ze;xe.writeVarint(He(Sn)),xe.writeVarint(He(ri)),ct+=Sn,Ze+=ri}3===tt&&xe.writeVarint(Je(7,1))}}function Ne(rt,xe){var be=typeof rt;"string"===be?xe.writeStringField(1,rt):"boolean"===be?xe.writeBooleanField(7,rt):"number"===be&&(rt%1!=0?xe.writeDoubleField(3,rt):rt<0?xe.writeSVarintField(6,rt):xe.writeVarintField(5,rt))}mt.exports=oe,mt.exports.fromVectorTileJs=oe,mt.exports.fromGeojsonVt=function(rt,xe){xe=xe||{};var be={};for(var tt in rt)be[tt]=new ae(rt[tt].features,xe),be[tt].name=tt,be[tt].version=xe.version,be[tt].extent=xe.extent;return oe({layers:be})},mt.exports.GeoJSONWrapper=ae;var sn=p.getDefaultExportFromCjs(mt.exports);const Bt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:rt=>rt},Le=Math.fround||(bt=new Float32Array(1),rt=>(bt[0]=+rt,bt[0]));var bt;const Ue=3,ft=5,Tt=6;class Be{constructor(xe){this.options=Object.assign(Object.create(Bt),xe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(xe){const{log:be,minZoom:tt,maxZoom:ct}=this.options;be&&console.time("total time");const Ze=`prepare ${xe.length} points`;be&&console.time(Ze),this.points=xe;const Ft=[];for(let lt=0;lt<xe.length;lt++){const Zt=xe[lt];if(!Zt.geometry)continue;const[Cn,Bn]=Zt.geometry.coordinates,Sn=Le(Rn(Cn)),ri=Le(zt(Bn));Ft.push(Sn,ri,1/0,lt,-1,1),this.options.reduce&&Ft.push(0)}let Nt=this.trees[ct+1]=this._createTree(Ft);be&&console.timeEnd(Ze);for(let lt=ct;lt>=tt;lt--){const Zt=+Date.now();Nt=this.trees[lt]=this._createTree(this._cluster(Nt,lt)),be&&console.log("z%d: %d clusters in %dms",lt,Nt.numItems,+Date.now()-Zt)}return be&&console.timeEnd("total time"),this}getClusters(xe,be){let tt=((xe[0]+180)%360+360)%360-180;const ct=Math.max(-90,Math.min(90,xe[1]));let Ze=180===xe[2]?180:((xe[2]+180)%360+360)%360-180;const Ft=Math.max(-90,Math.min(90,xe[3]));if(xe[2]-xe[0]>=360)tt=-180,Ze=180;else if(tt>Ze){const Bn=this.getClusters([tt,ct,180,Ft],be),Sn=this.getClusters([-180,ct,Ze,Ft],be);return Bn.concat(Sn)}const Nt=this.trees[this._limitZoom(be)],lt=Nt.range(Rn(tt),zt(Ft),Rn(Ze),zt(ct)),Zt=Nt.data,Cn=[];for(const Bn of lt){const Sn=this.stride*Bn;Cn.push(Zt[Sn+ft]>1?Xt(Zt,Sn,this.clusterProps):this.points[Zt[Sn+Ue]])}return Cn}getChildren(xe){const be=this._getOriginId(xe),tt=this._getOriginZoom(xe),ct="No cluster with the specified id.",Ze=this.trees[tt];if(!Ze)throw new Error(ct);const Ft=Ze.data;if(be*this.stride>=Ft.length)throw new Error(ct);const Nt=this.options.radius/(this.options.extent*Math.pow(2,tt-1)),lt=Ze.within(Ft[be*this.stride],Ft[be*this.stride+1],Nt),Zt=[];for(const Cn of lt){const Bn=Cn*this.stride;Ft[Bn+4]===xe&&Zt.push(Ft[Bn+ft]>1?Xt(Ft,Bn,this.clusterProps):this.points[Ft[Bn+Ue]])}if(0===Zt.length)throw new Error(ct);return Zt}getLeaves(xe,be,tt){const ct=[];return this._appendLeaves(ct,xe,be=be||10,tt=tt||0,0),ct}getTile(xe,be,tt){const ct=this.trees[this._limitZoom(xe)],Ze=Math.pow(2,xe),{extent:Ft,radius:Nt}=this.options,lt=Nt/Ft,Zt=(tt-lt)/Ze,Cn=(tt+1+lt)/Ze,Bn={features:[]};return this._addTileFeatures(ct.range((be-lt)/Ze,Zt,(be+1+lt)/Ze,Cn),ct.data,be,tt,Ze,Bn),0===be&&this._addTileFeatures(ct.range(1-lt/Ze,Zt,1,Cn),ct.data,Ze,tt,Ze,Bn),be===Ze-1&&this._addTileFeatures(ct.range(0,Zt,lt/Ze,Cn),ct.data,-1,tt,Ze,Bn),Bn.features.length?Bn:null}getClusterExpansionZoom(xe){let be=this._getOriginZoom(xe)-1;for(;be<=this.options.maxZoom;){const tt=this.getChildren(xe);if(be++,1!==tt.length)break;xe=tt[0].properties.cluster_id}return be}_appendLeaves(xe,be,tt,ct,Ze){const Ft=this.getChildren(be);for(const Nt of Ft){const lt=Nt.properties;if(lt&&lt.cluster?Ze+lt.point_count<=ct?Ze+=lt.point_count:Ze=this._appendLeaves(xe,lt.cluster_id,tt,ct,Ze):Ze<ct?Ze++:xe.push(Nt),xe.length===tt)break}return Ze}_createTree(xe){const be=new p.KDBush(xe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let tt=0;tt<xe.length;tt+=this.stride)be.add(xe[tt],xe[tt+1]);return be.finish(),be.data=xe,be}_addTileFeatures(xe,be,tt,ct,Ze,Ft){for(const Nt of xe){const lt=Nt*this.stride,Zt=be[lt+ft]>1;let Cn,Bn,Sn;if(Zt)Cn=Jt(be,lt,this.clusterProps),Bn=be[lt],Sn=be[lt+1];else{const Yr=this.points[be[lt+Ue]];Cn=Yr.properties;const[Cr,fi]=Yr.geometry.coordinates;Bn=Rn(Cr),Sn=zt(fi)}const ri={type:1,geometry:[[Math.round(this.options.extent*(Bn*Ze-tt)),Math.round(this.options.extent*(Sn*Ze-ct))]],tags:Cn};let li;li=Zt||this.options.generateId?be[lt+Ue]:this.points[be[lt+Ue]].id,void 0!==li&&(ri.id=li),Ft.features.push(ri)}}_limitZoom(xe){return Math.max(this.options.minZoom,Math.min(Math.floor(+xe),this.options.maxZoom+1))}_cluster(xe,be){const{radius:tt,extent:ct,reduce:Ze,minPoints:Ft}=this.options,Nt=tt/(ct*Math.pow(2,be)),lt=xe.data,Zt=[],Cn=this.stride;for(let Bn=0;Bn<lt.length;Bn+=Cn){if(lt[Bn+2]<=be)continue;lt[Bn+2]=be;const Sn=lt[Bn],ri=lt[Bn+1],li=xe.within(lt[Bn],lt[Bn+1],Nt),Yr=lt[Bn+ft];let Cr=Yr;for(const fi of li){const fs=fi*Cn;lt[fs+2]>be&&(Cr+=lt[fs+ft])}if(Cr>Yr&&Cr>=Ft){let fi,fs=Sn*Yr,ds=ri*Yr,Xr=-1;const ao=((Bn/Cn|0)<<5)+(be+1)+this.points.length;for(const ya of li){const Xo=ya*Cn;if(lt[Xo+2]<=be)continue;lt[Xo+2]=be;const zi=lt[Xo+ft];fs+=lt[Xo]*zi,ds+=lt[Xo+1]*zi,lt[Xo+4]=ao,Ze&&(fi||(fi=this._map(lt,Bn,!0),Xr=this.clusterProps.length,this.clusterProps.push(fi)),Ze(fi,this._map(lt,Xo)))}lt[Bn+4]=ao,Zt.push(fs/Cr,ds/Cr,1/0,ao,-1,Cr),Ze&&Zt.push(Xr)}else{for(let fi=0;fi<Cn;fi++)Zt.push(lt[Bn+fi]);if(Cr>1)for(const fi of li){const fs=fi*Cn;if(!(lt[fs+2]<=be)){lt[fs+2]=be;for(let ds=0;ds<Cn;ds++)Zt.push(lt[fs+ds])}}}}return Zt}_getOriginId(xe){return xe-this.points.length>>5}_getOriginZoom(xe){return(xe-this.points.length)%32}_map(xe,be,tt){if(xe[be+ft]>1){const Ft=this.clusterProps[xe[be+Tt]];return tt?Object.assign({},Ft):Ft}const ct=this.points[xe[be+Ue]].properties,Ze=this.options.map(ct);return tt&&Ze===ct?Object.assign({},Ze):Ze}}function Xt(rt,xe,be){return{type:"Feature",id:rt[xe+Ue],properties:Jt(rt,xe,be),geometry:{type:"Point",coordinates:[(tt=rt[xe],360*(tt-.5)),Jn(rt[xe+1])]}};var tt}function Jt(rt,xe,be){const tt=rt[xe+ft],ct=tt>=1e4?`${Math.round(tt/1e3)}k`:tt>=1e3?Math.round(tt/100)/10+"k":tt,Ze=rt[xe+Tt],Ft=-1===Ze?{}:Object.assign({},be[Ze]);return Object.assign(Ft,{cluster:!0,cluster_id:rt[xe+Ue],point_count:tt,point_count_abbreviated:ct})}function Rn(rt){return rt/360+.5}function zt(rt){const xe=Math.sin(rt*Math.PI/180),be=.5-.25*Math.log((1+xe)/(1-xe))/Math.PI;return be<0?0:be>1?1:be}function Jn(rt){const xe=(180-360*rt)*Math.PI/180;return 360*Math.atan(Math.exp(xe))/Math.PI-90}function Mn(rt,xe,be,tt){for(var ct,Ze=tt,Ft=be-xe>>1,Nt=be-xe,lt=rt[xe],Zt=rt[xe+1],Cn=rt[be],Bn=rt[be+1],Sn=xe+3;Sn<be;Sn+=3){var ri=jn(rt[Sn],rt[Sn+1],lt,Zt,Cn,Bn);if(ri>Ze)ct=Sn,Ze=ri;else if(ri===Ze){var li=Math.abs(Sn-Ft);li<Nt&&(ct=Sn,Nt=li)}}Ze>tt&&(ct-xe>3&&Mn(rt,xe,ct,tt),rt[ct+2]=Ze,be-ct>3&&Mn(rt,ct,be,tt))}function jn(rt,xe,be,tt,ct,Ze){var Ft=ct-be,Nt=Ze-tt;if(0!==Ft||0!==Nt){var lt=((rt-be)*Ft+(xe-tt)*Nt)/(Ft*Ft+Nt*Nt);lt>1?(be=ct,tt=Ze):lt>0&&(be+=Ft*lt,tt+=Nt*lt)}return(Ft=rt-be)*Ft+(Nt=xe-tt)*Nt}function xn(rt,xe,be,tt){var ct={id:void 0===rt?null:rt,type:xe,geometry:be,tags:tt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ze){var Ft=Ze.geometry,Nt=Ze.type;if("Point"===Nt||"MultiPoint"===Nt||"LineString"===Nt)Nn(Ze,Ft);else if("Polygon"===Nt||"MultiLineString"===Nt)for(var lt=0;lt<Ft.length;lt++)Nn(Ze,Ft[lt]);else if("MultiPolygon"===Nt)for(lt=0;lt<Ft.length;lt++)for(var Zt=0;Zt<Ft[lt].length;Zt++)Nn(Ze,Ft[lt][Zt])}(ct),ct}function Nn(rt,xe){for(var be=0;be<xe.length;be+=3)rt.minX=Math.min(rt.minX,xe[be]),rt.minY=Math.min(rt.minY,xe[be+1]),rt.maxX=Math.max(rt.maxX,xe[be]),rt.maxY=Math.max(rt.maxY,xe[be+1])}function wn(rt,xe,be,tt){if(xe.geometry){var ct=xe.geometry.coordinates,Ze=xe.geometry.type,Ft=Math.pow(be.tolerance/((1<<be.maxZoom)*be.extent),2),Nt=[],lt=xe.id;if(be.promoteId?lt=xe.properties[be.promoteId]:be.generateId&&(lt=tt||0),"Point"===Ze)Wi(ct,Nt);else if("MultiPoint"===Ze)for(var Zt=0;Zt<ct.length;Zt++)Wi(ct[Zt],Nt);else if("LineString"===Ze)Sr(ct,Nt,Ft,!1);else if("MultiLineString"===Ze){if(be.lineMetrics){for(Zt=0;Zt<ct.length;Zt++)Sr(ct[Zt],Nt=[],Ft,!1),rt.push(xn(lt,"LineString",Nt,xe.properties));return}Oi(ct,Nt,Ft,!1)}else if("Polygon"===Ze)Oi(ct,Nt,Ft,!0);else{if("MultiPolygon"!==Ze){if("GeometryCollection"===Ze){for(Zt=0;Zt<xe.geometry.geometries.length;Zt++)wn(rt,{id:lt,geometry:xe.geometry.geometries[Zt],properties:xe.properties},be,tt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Zt=0;Zt<ct.length;Zt++){var Cn=[];Oi(ct[Zt],Cn,Ft,!0),Nt.push(Cn)}}rt.push(xn(lt,Ze,Nt,xe.properties))}}function Wi(rt,xe){xe.push(ar(rt[0])),xe.push(mr(rt[1])),xe.push(0)}function Sr(rt,xe,be,tt){for(var ct,Ze,Ft=0,Nt=0;Nt<rt.length;Nt++){var lt=ar(rt[Nt][0]),Zt=mr(rt[Nt][1]);xe.push(lt),xe.push(Zt),xe.push(0),Nt>0&&(Ft+=tt?(ct*Zt-lt*Ze)/2:Math.sqrt(Math.pow(lt-ct,2)+Math.pow(Zt-Ze,2))),ct=lt,Ze=Zt}var Cn=xe.length-3;xe[2]=1,Mn(xe,0,Cn,be),xe[Cn+2]=1,xe.size=Math.abs(Ft),xe.start=0,xe.end=xe.size}function Oi(rt,xe,be,tt){for(var ct=0;ct<rt.length;ct++){var Ze=[];Sr(rt[ct],Ze,be,tt),xe.push(Ze)}}function ar(rt){return rt/360+.5}function mr(rt){var xe=Math.sin(rt*Math.PI/180),be=.5-.25*Math.log((1+xe)/(1-xe))/Math.PI;return be<0?0:be>1?1:be}function Pt(rt,xe,be,tt,ct,Ze,Ft,Nt){if(tt/=xe,Ze>=(be/=xe)&&Ft<tt)return rt;if(Ft<be||Ze>=tt)return null;for(var lt=[],Zt=0;Zt<rt.length;Zt++){var Cn=rt[Zt],Bn=Cn.geometry,Sn=Cn.type,ri=0===ct?Cn.minX:Cn.minY,li=0===ct?Cn.maxX:Cn.maxY;if(ri>=be&&li<tt)lt.push(Cn);else if(!(li<be||ri>=tt)){var Yr=[];if("Point"===Sn||"MultiPoint"===Sn)Re(Bn,Yr,be,tt,ct);else if("LineString"===Sn)Te(Bn,Yr,be,tt,ct,!1,Nt.lineMetrics);else if("MultiLineString"===Sn)et(Bn,Yr,be,tt,ct,!1);else if("Polygon"===Sn)et(Bn,Yr,be,tt,ct,!0);else if("MultiPolygon"===Sn)for(var Cr=0;Cr<Bn.length;Cr++){var fi=[];et(Bn[Cr],fi,be,tt,ct,!0),fi.length&&Yr.push(fi)}if(Yr.length){if(Nt.lineMetrics&&"LineString"===Sn){for(Cr=0;Cr<Yr.length;Cr++)lt.push(xn(Cn.id,Sn,Yr[Cr],Cn.tags));continue}"LineString"!==Sn&&"MultiLineString"!==Sn||(1===Yr.length?(Sn="LineString",Yr=Yr[0]):Sn="MultiLineString"),"Point"!==Sn&&"MultiPoint"!==Sn||(Sn=3===Yr.length?"Point":"MultiPoint"),lt.push(xn(Cn.id,Sn,Yr,Cn.tags))}}}return lt.length?lt:null}function Re(rt,xe,be,tt,ct){for(var Ze=0;Ze<rt.length;Ze+=3){var Ft=rt[Ze+ct];Ft>=be&&Ft<=tt&&(xe.push(rt[Ze]),xe.push(rt[Ze+1]),xe.push(rt[Ze+2]))}}function Te(rt,xe,be,tt,ct,Ze,Ft){for(var Nt,lt,Zt=Se(rt),Cn=0===ct?Yt:yn,Bn=rt.start,Sn=0;Sn<rt.length-3;Sn+=3){var ri=rt[Sn],li=rt[Sn+1],Yr=rt[Sn+2],Cr=rt[Sn+3],fi=rt[Sn+4],fs=0===ct?ri:li,ds=0===ct?Cr:fi,Xr=!1;Ft&&(Nt=Math.sqrt(Math.pow(ri-Cr,2)+Math.pow(li-fi,2))),fs<be?ds>be&&(lt=Cn(Zt,ri,li,Cr,fi,be),Ft&&(Zt.start=Bn+Nt*lt)):fs>tt?ds<tt&&(lt=Cn(Zt,ri,li,Cr,fi,tt),Ft&&(Zt.start=Bn+Nt*lt)):Ct(Zt,ri,li,Yr),ds<be&&fs>=be&&(lt=Cn(Zt,ri,li,Cr,fi,be),Xr=!0),ds>tt&&fs<=tt&&(lt=Cn(Zt,ri,li,Cr,fi,tt),Xr=!0),!Ze&&Xr&&(Ft&&(Zt.end=Bn+Nt*lt),xe.push(Zt),Zt=Se(rt)),Ft&&(Bn+=Nt)}var ao=rt.length-3;ri=rt[ao],li=rt[ao+1],Yr=rt[ao+2],(fs=0===ct?ri:li)>=be&&fs<=tt&&Ct(Zt,ri,li,Yr),ao=Zt.length-3,Ze&&ao>=3&&(Zt[ao]!==Zt[0]||Zt[ao+1]!==Zt[1])&&Ct(Zt,Zt[0],Zt[1],Zt[2]),Zt.length&&xe.push(Zt)}function Se(rt){var xe=[];return xe.size=rt.size,xe.start=rt.start,xe.end=rt.end,xe}function et(rt,xe,be,tt,ct,Ze){for(var Ft=0;Ft<rt.length;Ft++)Te(rt[Ft],xe,be,tt,ct,Ze,!1)}function Ct(rt,xe,be,tt){rt.push(xe),rt.push(be),rt.push(tt)}function Yt(rt,xe,be,tt,ct,Ze){var Ft=(Ze-xe)/(tt-xe);return rt.push(Ze),rt.push(be+(ct-be)*Ft),rt.push(1),Ft}function yn(rt,xe,be,tt,ct,Ze){var Ft=(Ze-be)/(ct-be);return rt.push(xe+(tt-xe)*Ft),rt.push(Ze),rt.push(1),Ft}function _n(rt,xe){for(var be=[],tt=0;tt<rt.length;tt++){var ct,Ze=rt[tt],Ft=Ze.type;if("Point"===Ft||"MultiPoint"===Ft||"LineString"===Ft)ct=en(Ze.geometry,xe);else if("MultiLineString"===Ft||"Polygon"===Ft){ct=[];for(var Nt=0;Nt<Ze.geometry.length;Nt++)ct.push(en(Ze.geometry[Nt],xe))}else if("MultiPolygon"===Ft)for(ct=[],Nt=0;Nt<Ze.geometry.length;Nt++){for(var lt=[],Zt=0;Zt<Ze.geometry[Nt].length;Zt++)lt.push(en(Ze.geometry[Nt][Zt],xe));ct.push(lt)}be.push(xn(Ze.id,Ft,ct,Ze.tags))}return be}function en(rt,xe){var be=[];be.size=rt.size,void 0!==rt.start&&(be.start=rt.start,be.end=rt.end);for(var tt=0;tt<rt.length;tt+=3)be.push(rt[tt]+xe,rt[tt+1],rt[tt+2]);return be}function Dr(rt,xe){if(rt.transformed)return rt;var be,tt,ct,Ze=1<<rt.z,Ft=rt.x,Nt=rt.y;for(be=0;be<rt.features.length;be++){var lt=rt.features[be],Zt=lt.geometry,Cn=lt.type;if(lt.geometry=[],1===Cn)for(tt=0;tt<Zt.length;tt+=2)lt.geometry.push(Pr(Zt[tt],Zt[tt+1],xe,Ze,Ft,Nt));else for(tt=0;tt<Zt.length;tt++){var Bn=[];for(ct=0;ct<Zt[tt].length;ct+=2)Bn.push(Pr(Zt[tt][ct],Zt[tt][ct+1],xe,Ze,Ft,Nt));lt.geometry.push(Bn)}}return rt.transformed=!0,rt}function Pr(rt,xe,be,tt,ct,Ze){return[Math.round(be*(rt*tt-ct)),Math.round(be*(xe*tt-Ze))]}function zn(rt,xe,be,tt,ct){for(var Ze=xe===ct.maxZoom?0:ct.tolerance/((1<<xe)*ct.extent),Ft={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:be,y:tt,z:xe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Nt=0;Nt<rt.length;Nt++){Ft.numFeatures++,Gr(Ft,rt[Nt],Ze,ct);var lt=rt[Nt].minX,Zt=rt[Nt].minY,Cn=rt[Nt].maxX,Bn=rt[Nt].maxY;lt<Ft.minX&&(Ft.minX=lt),Zt<Ft.minY&&(Ft.minY=Zt),Cn>Ft.maxX&&(Ft.maxX=Cn),Bn>Ft.maxY&&(Ft.maxY=Bn)}return Ft}function Gr(rt,xe,be,tt){var ct=xe.geometry,Ze=xe.type,Ft=[];if("Point"===Ze||"MultiPoint"===Ze)for(var Nt=0;Nt<ct.length;Nt+=3)Ft.push(ct[Nt]),Ft.push(ct[Nt+1]),rt.numPoints++,rt.numSimplified++;else if("LineString"===Ze)Pi(Ft,ct,rt,be,!1,!1);else if("MultiLineString"===Ze||"Polygon"===Ze)for(Nt=0;Nt<ct.length;Nt++)Pi(Ft,ct[Nt],rt,be,"Polygon"===Ze,0===Nt);else if("MultiPolygon"===Ze)for(var lt=0;lt<ct.length;lt++){var Zt=ct[lt];for(Nt=0;Nt<Zt.length;Nt++)Pi(Ft,Zt[Nt],rt,be,!0,0===Nt)}if(Ft.length){var Cn=xe.tags||null;if("LineString"===Ze&&tt.lineMetrics){for(var Bn in Cn={},xe.tags)Cn[Bn]=xe.tags[Bn];Cn.mapbox_clip_start=ct.start/ct.size,Cn.mapbox_clip_end=ct.end/ct.size}var Sn={geometry:Ft,type:"Polygon"===Ze||"MultiPolygon"===Ze?3:"LineString"===Ze||"MultiLineString"===Ze?2:1,tags:Cn};null!==xe.id&&(Sn.id=xe.id),rt.features.push(Sn)}}function Pi(rt,xe,be,tt,ct,Ze){var Ft=tt*tt;if(tt>0&&xe.size<(ct?Ft:tt))be.numPoints+=xe.length/3;else{for(var Nt=[],lt=0;lt<xe.length;lt+=3)(0===tt||xe[lt+2]>Ft)&&(be.numSimplified++,Nt.push(xe[lt]),Nt.push(xe[lt+1])),be.numPoints++;ct&&function(Zt,Cn){for(var Bn=0,Sn=0,ri=Zt.length,li=ri-2;Sn<ri;li=Sn,Sn+=2)Bn+=(Zt[Sn]-Zt[li])*(Zt[Sn+1]+Zt[li+1]);if(Bn>0===Cn)for(Sn=0,ri=Zt.length;Sn<ri/2;Sn+=2){var Yr=Zt[Sn],Cr=Zt[Sn+1];Zt[Sn]=Zt[ri-2-Sn],Zt[Sn+1]=Zt[ri-1-Sn],Zt[ri-2-Sn]=Yr,Zt[ri-1-Sn]=Cr}}(Nt,Ze),rt.push(Nt)}}function ni(rt,xe){var be=(xe=this.options=function(ct,Ze){for(var Ft in Ze)ct[Ft]=Ze[Ft];return ct}(Object.create(this.options),xe)).debug;if(be&&console.time("preprocess data"),xe.maxZoom<0||xe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(xe.promoteId&&xe.generateId)throw new Error("promoteId and generateId cannot be used together.");var ct,Ze,Ft,Nt,lt,Zt,tt=function(ct,Ze){var Ft=[];if("FeatureCollection"===ct.type)for(var Nt=0;Nt<ct.features.length;Nt++)wn(Ft,ct.features[Nt],Ze,Nt);else wn(Ft,"Feature"===ct.type?ct:{geometry:ct},Ze);return Ft}(rt,xe);this.tiles={},this.tileCoords=[],be&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",xe.indexMaxZoom,xe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Nt=ct=tt,lt=Pt(ct,1,-1-(Ft=(Ze=xe).buffer/Ze.extent),Ft,0,-1,2,Ze),Zt=Pt(ct,1,1-Ft,2+Ft,0,-1,2,Ze),(lt||Zt)&&(Nt=Pt(ct,1,-Ft,1+Ft,0,-1,2,Ze)||[],lt&&(Nt=_n(lt,1).concat(Nt)),Zt&&(Nt=Nt.concat(_n(Zt,-1)))),(tt=Nt).length&&this.splitTile(tt,0,0,0),be&&(tt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ci(rt,xe,be){return 32*((1<<rt)*be+xe)+rt}function Ki(rt,xe){const be=rt.tileID.canonical;if(!this._geoJSONIndex)return xe(null,null);const tt=this._geoJSONIndex.getTile(be.z,be.x,be.y);if(!tt)return xe(null,null);const ct=new class{constructor(Ft){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=Ft.length,this._features=Ft}feature(Ft){return new class{constructor(Nt){this._feature=Nt,this.extent=p.EXTENT,this.type=Nt.type,this.properties=Nt.tags,"id"in Nt&&!isNaN(Nt.id)&&(this.id=parseInt(Nt.id,10))}loadGeometry(){if(1===this._feature.type){const Nt=[];for(const lt of this._feature.geometry)Nt.push([new p.Point(lt[0],lt[1])]);return Nt}{const Nt=[];for(const lt of this._feature.geometry){const Zt=[];for(const Cn of lt)Zt.push(new p.Point(Cn[0],Cn[1]));Nt.push(Zt)}return Nt}}toGeoJSON(Nt,lt,Zt){return st.call(this,Nt,lt,Zt)}}(this._features[Ft])}}(tt.features);let Ze=sn(ct);0===Ze.byteOffset&&Ze.byteLength===Ze.buffer.byteLength||(Ze=new Uint8Array(Ze)),xe(null,{vectorTile:ct,rawData:Ze.buffer})}ni.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ni.prototype.splitTile=function(rt,xe,be,tt,ct,Ze,Ft){for(var Nt=[rt,xe,be,tt],lt=this.options,Zt=lt.debug;Nt.length;){tt=Nt.pop(),be=Nt.pop(),xe=Nt.pop(),rt=Nt.pop();var Cn=1<<xe,Bn=Ci(xe,be,tt),Sn=this.tiles[Bn];if(!Sn&&(Zt>1&&console.time("creation"),Sn=this.tiles[Bn]=zn(rt,xe,be,tt,lt),this.tileCoords.push({z:xe,x:be,y:tt}),Zt)){Zt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",xe,be,tt,Sn.numFeatures,Sn.numPoints,Sn.numSimplified),console.timeEnd("creation"));var ri="z"+xe;this.stats[ri]=(this.stats[ri]||0)+1,this.total++}if(Sn.source=rt,ct){if(xe===lt.maxZoom||xe===ct)continue;var li=1<<ct-xe;if(be!==Math.floor(Ze/li)||tt!==Math.floor(Ft/li))continue}else if(xe===lt.indexMaxZoom||Sn.numPoints<=lt.indexMaxPoints)continue;if(Sn.source=null,0!==rt.length){Zt>1&&console.time("clipping");var Yr,Cr,fi,fs,ds,Xr,ao=.5*lt.buffer/lt.extent,ya=.5-ao,Xo=.5+ao,zi=1+ao;Yr=Cr=fi=fs=null,ds=Pt(rt,Cn,be-ao,be+Xo,0,Sn.minX,Sn.maxX,lt),Xr=Pt(rt,Cn,be+ya,be+zi,0,Sn.minX,Sn.maxX,lt),rt=null,ds&&(Yr=Pt(ds,Cn,tt-ao,tt+Xo,1,Sn.minY,Sn.maxY,lt),Cr=Pt(ds,Cn,tt+ya,tt+zi,1,Sn.minY,Sn.maxY,lt),ds=null),Xr&&(fi=Pt(Xr,Cn,tt-ao,tt+Xo,1,Sn.minY,Sn.maxY,lt),fs=Pt(Xr,Cn,tt+ya,tt+zi,1,Sn.minY,Sn.maxY,lt),Xr=null),Zt>1&&console.timeEnd("clipping"),Nt.push(Yr||[],xe+1,2*be,2*tt),Nt.push(Cr||[],xe+1,2*be,2*tt+1),Nt.push(fi||[],xe+1,2*be+1,2*tt),Nt.push(fs||[],xe+1,2*be+1,2*tt+1)}}},ni.prototype.getTile=function(rt,xe,be){var tt=this.options,ct=tt.extent,Ze=tt.debug;if(rt<0||rt>24)return null;var Ft=1<<rt,Nt=Ci(rt,xe=(xe%Ft+Ft)%Ft,be);if(this.tiles[Nt])return Dr(this.tiles[Nt],ct);Ze>1&&console.log("drilling down to z%d-%d-%d",rt,xe,be);for(var lt,Zt=rt,Cn=xe,Bn=be;!lt&&Zt>0;)Zt--,Cn=Math.floor(Cn/2),Bn=Math.floor(Bn/2),lt=this.tiles[Ci(Zt,Cn,Bn)];return lt&&lt.source?(Ze>1&&console.log("found parent tile z%d-%d-%d",Zt,Cn,Bn),Ze>1&&console.time("drilling down"),this.splitTile(lt.source,Zt,Cn,Bn,rt,xe,be),Ze>1&&console.timeEnd("drilling down"),this.tiles[Nt]?Dr(this.tiles[Nt],ct):null):null};class ts extends p.VectorTileWorkerSource{constructor(xe,be,tt,ct,Ze){super(xe,be,tt,ct,Ki),Ze&&(this.loadGeoJSON=Ze)}loadData(xe,be){const tt=xe&&xe.request,ct=tt&&tt.collectResourceTiming;this.loadGeoJSON(xe,(Ze,Ft)=>{if(Ze||!Ft)return be(Ze);if("object"!=typeof Ft)return be(new Error(`Input data given to '${xe.source}' is not a valid GeoJSON object.`));{gt(Ft,!0);try{if(xe.filter){const lt=p.createExpression(xe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===lt.result)throw new Error(lt.value.map(Cn=>`${Cn.key}: ${Cn.message}`).join(", "));Ft={type:"FeatureCollection",features:Ft.features.filter(Cn=>lt.value.evaluate({zoom:0},Cn))}}this._geoJSONIndex=xe.cluster?new Be(function({superclusterOptions:lt,clusterProperties:Zt}){if(!Zt||!lt)return lt;const Cn={},Bn={},Sn={accumulated:null,zoom:0},ri={properties:null},li=Object.keys(Zt);for(const Yr of li){const[Cr,fi]=Zt[Yr],fs=p.createExpression(fi),ds=p.createExpression("string"==typeof Cr?[Cr,["accumulated"],["get",Yr]]:Cr);Cn[Yr]=fs.value,Bn[Yr]=ds.value}return lt.map=Yr=>{ri.properties=Yr;const Cr={};for(const fi of li)Cr[fi]=Cn[fi].evaluate(Sn,ri);return Cr},lt.reduce=(Yr,Cr)=>{ri.properties=Cr;for(const fi of li)Sn.accumulated=Yr[fi],Yr[fi]=Bn[fi].evaluate(Sn,ri)},lt}(xe)).load(Ft.features):new ni(lt=Ft,xe.geojsonVtOptions)}catch(lt){return be(lt)}this.loaded={};const Nt={};if(ct){const lt=p.getPerformanceMeasurement(tt);lt&&(Nt.resourceTiming={},Nt.resourceTiming[xe.source]=JSON.parse(JSON.stringify(lt)))}be(null,Nt)}var lt})}reloadTile(xe,be){const tt=this.loaded;return tt&&tt[xe.uid]?super.reloadTile(xe,be):this.loadTile(xe,be)}loadGeoJSON(xe,be){if(xe.request)p.getJSON(xe.request,be);else{if("string"!=typeof xe.data)return be(new Error(`Input data given to '${xe.source}' is not a valid GeoJSON object.`));try{return be(null,JSON.parse(xe.data))}catch{return be(new Error(`Input data given to '${xe.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(xe,be){try{be(null,this._geoJSONIndex.getClusterExpansionZoom(xe.clusterId))}catch(tt){be(tt)}}getClusterChildren(xe,be){try{be(null,this._geoJSONIndex.getChildren(xe.clusterId))}catch(tt){be(tt)}}getClusterLeaves(xe,be){try{be(null,this._geoJSONIndex.getLeaves(xe.clusterId,xe.limit,xe.offset))}catch(tt){be(tt)}}}class Hs{constructor(xe){this.self=xe,this.actor=new p.Actor(xe,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:ts},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(be,tt)=>{if(this.workerSourceTypes[be])throw new Error(`Worker source with name "${be}" already registered.`);this.workerSourceTypes[be]=tt},this.self.registerRTLTextPlugin=be=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=be.applyArabicShaping,p.plugin.processBidirectionalText=be.processBidirectionalText,p.plugin.processStyledBidirectionalText=be.processStyledBidirectionalText}}clearCaches(xe,be,tt){delete this.layerIndexes[xe],delete this.availableImages[xe],delete this.workerSources[xe],delete this.demWorkerSources[xe],tt()}checkIfReady(xe,be,tt){tt()}setReferrer(xe,be){this.referrer=be}spriteLoaded(xe,be){this.isSpriteLoaded[xe]=be;for(const tt in this.workerSources[xe]){const ct=this.workerSources[xe][tt];for(const Ze in ct)ct[Ze]instanceof p.VectorTileWorkerSource&&(ct[Ze].isSpriteLoaded=be,ct[Ze].fire(new p.Event("isSpriteLoaded")))}}setImages(xe,be,tt){this.availableImages[xe]=be;for(const ct in this.workerSources[xe]){const Ze=this.workerSources[xe][ct];for(const Ft in Ze)Ze[Ft].availableImages=be}tt()}enableTerrain(xe,be,tt){this.terrain=be,tt()}setProjection(xe,be){this.projections[xe]=p.getProjection(be)}setLayers(xe,be,tt){this.getLayerIndex(xe).replace(be),tt()}updateLayers(xe,be,tt){this.getLayerIndex(xe).update(be.layers,be.removedIds),tt()}loadTile(xe,be,tt){const ct=this.enableTerrain?p.extend({enableTerrain:this.terrain},be):be;ct.projection=this.projections[xe]||this.defaultProjection,this.getWorkerSource(xe,be.type,be.source).loadTile(ct,tt)}loadDEMTile(xe,be,tt){const ct=this.enableTerrain?p.extend({buildQuadTree:this.terrain},be):be;this.getDEMWorkerSource(xe,be.source).loadTile(ct,tt)}reloadTile(xe,be,tt){const ct=this.enableTerrain?p.extend({enableTerrain:this.terrain},be):be;ct.projection=this.projections[xe]||this.defaultProjection,this.getWorkerSource(xe,be.type,be.source).reloadTile(ct,tt)}abortTile(xe,be,tt){this.getWorkerSource(xe,be.type,be.source).abortTile(be,tt)}removeTile(xe,be,tt){this.getWorkerSource(xe,be.type,be.source).removeTile(be,tt)}removeSource(xe,be,tt){if(!this.workerSources[xe]||!this.workerSources[xe][be.type]||!this.workerSources[xe][be.type][be.source])return;const ct=this.workerSources[xe][be.type][be.source];delete this.workerSources[xe][be.type][be.source],void 0!==ct.removeSource?ct.removeSource(be,tt):tt()}loadWorkerSource(xe,be,tt){try{this.self.importScripts(be.url),tt()}catch(ct){tt(ct.toString())}}syncRTLPluginState(xe,be,tt){try{p.plugin.setState(be);const ct=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=ct){this.self.importScripts(ct);const Ze=p.plugin.isParsed();tt(Ze?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ct}`),Ze)}}catch(ct){tt(ct.toString())}}getAvailableImages(xe){let be=this.availableImages[xe];return be||(be=[]),be}getLayerIndex(xe){let be=this.layerIndexes[xe];return be||(be=this.layerIndexes[xe]=new Ce),be}getWorkerSource(xe,be,tt){return this.workerSources[xe]||(this.workerSources[xe]={}),this.workerSources[xe][be]||(this.workerSources[xe][be]={}),this.workerSources[xe][be][tt]||(this.workerSources[xe][be][tt]=new this.workerSourceTypes[be]({send:(Ze,Ft,Nt,lt,Zt,Cn)=>{this.actor.send(Ze,Ft,Nt,xe,Zt,Cn)},scheduler:this.actor.scheduler},this.getLayerIndex(xe),this.getAvailableImages(xe),this.isSpriteLoaded[xe])),this.workerSources[xe][be][tt]}getDEMWorkerSource(xe,be){return this.demWorkerSources[xe]||(this.demWorkerSources[xe]={}),this.demWorkerSources[xe][be]||(this.demWorkerSources[xe][be]=new Pe),this.demWorkerSources[xe][be]}enforceCacheSizeLimit(xe,be){p.enforceCacheSizeLimit(be)}getWorkerPerformanceMetrics(xe,be,tt){tt(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Hs(self)),Hs}),q(0,function(p){function J(w,l){if(Array.isArray(w)){if(!Array.isArray(l)||w.length!==l.length)return!1;for(let g=0;g<w.length;g++)if(!J(w[g],l[g]))return!1;return!0}if("object"==typeof w&&null!==w&&null!==l){if("object"!=typeof l||Object.keys(w).length!==Object.keys(l).length)return!1;for(const g in w)if(!J(w[g],l[g]))return!1;return!0}return w===l}var ye=Ce;function Ce(w){return l=w,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var C,M,P=new Blob([""],{type:"text/javascript"}),k=URL.createObjectURL(P);try{M=new Worker(k),C=!0}catch{C=!1}return M&&M.terminate(),URL.revokeObjectURL(k),C}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var C=document.createElement("canvas");C.width=C.height=1;var M=C.getContext("2d");if(!M)return!1;var P=M.getImageData(0,0,1,1);return P&&P.width===C.width}()||(void 0===Pe[g=l&&l.failIfMajorPerformanceCaveat]&&(Pe[g]=function(C){var M,k,z,G,P=(k=C,z=document.createElement("canvas"),(G=Object.create(Ce.webGLContextAttributes)).failIfMajorPerformanceCaveat=k,z.getContext("webgl",G)||z.getContext("experimental-webgl",G));if(!P)return!1;try{M=P.createShader(P.VERTEX_SHADER)}catch{return!1}return!(!M||P.isContextLost())&&(P.shaderSource(M,"void main() {}"),P.compileShader(M),!0===P.getShaderParameter(M,P.COMPILE_STATUS))}(g)),!Pe[g]||document.documentMode));var l,g}var Pe={};function qe(w,l,g){const C=p.window.document.createElement(w);return void 0!==l&&(C.className=l),g&&g.appendChild(C),C}function It(w,l,g){const C=p.window.document.createElementNS("http://www.w3.org/2000/svg",w);for(const M of Object.keys(l))C.setAttributeNS(null,M,l[M]);return g&&g.appendChild(C),C}Ce.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const gt=p.window.document&&p.window.document.documentElement.style,st=gt&&void 0!==gt.userSelect?"userSelect":"WebkitUserSelect";let mt;function Mt(){gt&&st&&(mt=gt[st],gt[st]="none")}function le(){gt&&st&&(gt[st]=mt)}function K(w){w.preventDefault(),w.stopPropagation(),p.window.removeEventListener("click",K,!0)}function ne(){p.window.addEventListener("click",K,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",K,!0)},0)}function ce(w,l){const g=w.getBoundingClientRect();return oe(w,g,l)}function ee(w,l){const g=w.getBoundingClientRect(),C=[];for(let M=0;M<l.length;M++)C.push(oe(w,g,l[M]));return C}function ae(w){return void 0!==p.window.InstallTrigger&&2===w.button&&w.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:w.button}function oe(w,l,g){const C=w.offsetWidth===l.width?1:w.offsetWidth/l.width;return new p.Point((g.clientX-l.left)*C,(g.clientY-l.top)*C)}function te(w,l){var g=l[0],C=l[1],M=l[2],P=l[3],k=g*P-M*C;return k?(w[0]=P*(k=1/k),w[1]=-C*k,w[2]=-M*k,w[3]=g*k,w):null}function _e(w){const{userImage:l}=w;return!!(l&&l.render&&l.render())&&(w.data.replace(new Uint8Array(l.data.buffer)),!0)}class re extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:g,callback:C}of this.requestors)this._notify(g,C);this.requestors=[]}}hasImage(l){return!!this.getImage(l)}getImage(l){return this.images[l]}addImage(l,g){this._validate(l,g)&&(this.images[l]=g)}_validate(l,g){let C=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${l}" has invalid "stretchX" value`))),C=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${l}" has invalid "stretchY" value`))),C=!1),this._validateContent(g.content,g)||(this.fire(new p.ErrorEvent(new Error(`Image "${l}" has invalid "content" value`))),C=!1),C}_validateStretch(l,g){if(!l)return!0;let C=0;for(const M of l){if(M[0]<C||M[1]<M[0]||g<M[1])return!1;C=M[1]}return!0}_validateContent(l,g){return!(l&&(4!==l.length||l[0]<0||g.data.width<l[0]||l[1]<0||g.data.height<l[1]||l[2]<0||g.data.width<l[2]||l[3]<0||g.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,g){g.version=this.images[l].version+1,this.images[l]=g,this.updatedImages[l]=!0}removeImage(l){const g=this.images[l];delete this.images[l],delete this.patterns[l],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l,g){let C=!0;if(!this.isLoaded())for(const M of l)this.images[M]||(C=!1);this.isLoaded()||C?this._notify(l,g):this.requestors.push({ids:l,callback:g})}_notify(l,g){const C={};for(const M of l){this.images[M]||this.fire(new p.Event("styleimagemissing",{id:M}));const P=this.images[M];P?C[M]={data:P.data.clone(),pixelRatio:P.pixelRatio,sdf:P.sdf,version:P.version,stretchX:P.stretchX,stretchY:P.stretchY,content:P.content,hasRenderCallback:!(!P.userImage||!P.userImage.render)}:p.warnOnce(`Image "${M}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,C)}getPixelSize(){const{width:l,height:g}=this.atlasImage;return{width:l,height:g}}getPattern(l){const g=this.patterns[l],C=this.getImage(l);if(!C)return null;if(g&&g.position.version===C.version)return g.position;if(g)g.position.version=C.version;else{const M={w:C.data.width+2,h:C.data.height+2,x:0,y:0},P=new p.ImagePosition(M,C);this.patterns[l]={bin:M,position:P}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const g=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(l,this.atlasImage,g.RGBA),this.atlasTexture&&this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const P in this.patterns)l.push(this.patterns[P].bin);const{w:g,h:C}=p.potpack(l),M=this.atlasImage;M.resize({width:g||1,height:C||1});for(const P in this.patterns){const{bin:k}=this.patterns[P],z=k.x+1,G=k.y+1,X=this.images[P].data,Z=X.width,se=X.height;p.RGBAImage.copy(X,M,{x:0,y:0},{x:z,y:G},{width:Z,height:se}),p.RGBAImage.copy(X,M,{x:0,y:se-1},{x:z,y:G-1},{width:Z,height:1}),p.RGBAImage.copy(X,M,{x:0,y:0},{x:z,y:G+se},{width:Z,height:1}),p.RGBAImage.copy(X,M,{x:Z-1,y:0},{x:z-1,y:G},{width:1,height:se}),p.RGBAImage.copy(X,M,{x:0,y:0},{x:z+Z,y:G},{width:1,height:se})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const g of l){if(this.callbackDispatchedThisFrame[g])continue;this.callbackDispatchedThisFrame[g]=!0;const C=this.images[g];_e(C)&&this.updateImage(g,C)}}}const Je=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(w,l){return function([g,C,M]){const P=p.degToRad(C+90),k=p.degToRad(M);return{x:g*Math.cos(P)*Math.sin(k),y:g*Math.sin(P)*Math.sin(k),z:g*Math.cos(k),azimuthal:C,polar:M}}(w.expression.evaluate(l))}interpolate(w,l,g){return{x:p.number(w.x,l.x,g),y:p.number(w.y,l.y,g),z:p.number(w.z,l.z,g),azimuthal:p.number(w.azimuthal,l.azimuthal,g),polar:p.number(w.polar,l.polar,g)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)});class He extends p.Evented{constructor(l){super(),this._transitionable=new p.Transitionable(Je),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,g={}){if(!this._validate(p.validateLight,l,g))for(const C in l){const M=l[C];p.endsWith(C,"-transition")?this._transitionable.setTransition(C.slice(0,-11),M):this._transitionable.setValue(C,M)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,g,C){return(!C||!1!==C.validate)&&p.emitValidationErrors(this,l.call(p.validateStyle,p.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const it=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)});let Ne=class extends p.Evented{constructor(w,l){super(),this._transitionable=new p.Transitionable(it),this.set(w),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(w){for(const l in w){const g=w[l];p.endsWith(l,"-transition")?this._transitionable.setTransition(l.slice(0,-11),g):this._transitionable.setValue(l,g)}}updateTransitions(w){this._transitioning=this._transitionable.transitioned(w,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(w){this.properties=this._transitioning.possiblyEvaluate(w)}};function sn(w,l,g,C){const M=p.smoothstep(45,65,g),[P,k]=Bt(w,C),z=p.length(l);let G=1-Math.min(1,Math.exp((z-P)/(k-P)*-6));return G*=G*G,G=Math.min(1,1.00747*G),G*M*w.alpha}function Bt(w,l){const g=.5/Math.tan(.5*l);return[w.range[0]+g,w.range[1]+g]}const Le=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"high-color":new p.DataConstantProperty(p.spec.fog["high-color"]),"space-color":new p.DataConstantProperty(p.spec.fog["space-color"]),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"]),"star-intensity":new p.DataConstantProperty(p.spec.fog["star-intensity"])});class bt extends p.Evented{constructor(l,g){super(),this._transitionable=new p.Transitionable(Le),this.set(l),this._transitioning=this._transitionable.untransitioned(),this._transform=g}get state(){const l=this._transform,g="globe"===l.projection.name,C=p.globeToMercatorTransition(l.zoom),M=this.properties.get("range"),P=[.5,3];return{range:g?[p.number(P[0],M[0],C),p.number(P[1],M[1],C)]:M,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,g={}){if(!this._validate(p.validateFog,l,g)){for(const C of Object.keys(p.spec.fog))l&&void 0===l[C]&&(l[C]=p.spec.fog[C].default);for(const C in l){const M=l[C];p.endsWith(C,"-transition")?this._transitionable.setTransition(C.slice(0,-11),M):this._transitionable.setValue(C,M)}}}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const g=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.smoothstep(45,65,l))*g.a}getOpacityAtLatLng(l,g){return this._transform.projection.supportsFog?function(C,M,P){const k=p.MercatorCoordinate.fromLngLat(M),z=P.elevation?P.elevation.getAtPointOrZero(k):0,G=[k.x,k.y,z];return p.transformMat4(G,G,P.mercatorFogMatrix),sn(C,G,P.pitch,P._fov)}(this.state,l,g):0}getFovAdjustedRange(l){return this._transform.projection.supportsFog?Bt(this.state,l):[0,1]}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,g,C){return(!C||!1!==C.validate)&&p.emitValidationErrors(this,l.call(p.validateStyle,p.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class Ue{constructor(l,g){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const C=this.workerPool.acquire(this.id);for(let M=0;M<C.length;M++){const P=new Ue.Actor(C[M],g,this.id);P.name=`Worker ${M}`,this.actors.push(P)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(l,g,C){p.asyncAll(this.actors,(M,P)=>{M.send(l,g,P)},C=C||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ft(w,l,g){return l*(p.EXTENT/(w.tileSize*Math.pow(2,g-w.tileID.overscaledZ)))}Ue.Actor=p.Actor;class Tt{constructor(l,g,C,M){this.screenBounds=l,this.cameraPoint=g,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=C,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,M)}static createFromScreenPoints(l,g){let C,M;if(l instanceof p.Point||"number"==typeof l[0]){const P=p.Point.convert(l);C=[P],M=g.isPointAboveHorizon(P)}else{const P=p.Point.convert(l[0]),k=p.Point.convert(l[1]);C=[P,k],M=p.polygonizeBounds(P,k).every(z=>g.isPointAboveHorizon(z))}return new Tt(C,g.getCameraPoint(),M,g)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(l){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const g=this.screenBounds[0],C=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],M=p.polygonizeBounds(g,C,0,!1);return this.cameraPoint.y>C.y&&(this.cameraPoint.x>g.x&&this.cameraPoint.x<C.x?M.splice(3,0,this.cameraPoint):this.cameraPoint.x>=C.x?M[2]=this.cameraPoint:this.cameraPoint.x<=g.x&&(M[3]=this.cameraPoint)),p.bufferConvexPolygon(M,l)}bufferedCameraGeometryGlobe(l){const g=this.screenBounds[0],C=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],M=p.polygonizeBounds(g,C,l),P=this.cameraPoint.clone();switch(3*((P.y>g.y)+(P.y>C.y))+((P.x>g.x)+(P.x>C.x))){case 0:M[0]=P,M[4]=P.clone();break;case 1:M.splice(1,0,P);break;case 2:M[1]=P;break;case 3:M.splice(4,0,P);break;case 5:M.splice(2,0,P);break;case 6:M[3]=P;break;case 7:M.splice(3,0,P);break;case 8:M[2]=P}return M}containsTile(l,g,C,M=0){const P=l.queryPadding/g._pixelsPerMercatorPixel+1,k=C?this._bufferedCameraMercator(P,g):this._bufferedScreenMercator(P,g);let z=l.tileID.wrap+(k.unwrapped?M:0);const G=k.polygon.map(We=>p.getTilePoint(l.tileTransform,We,z));if(!p.polygonIntersectsBox(G,0,0,p.EXTENT,p.EXTENT))return;z=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?M:0);const X=this.screenGeometryMercator.polygon.map(We=>p.getTileVec3(l.tileTransform,We,z)),Z=X.map(We=>new p.Point(We[0],We[1])),se=g.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),Ie=p.getTileVec3(l.tileTransform,se,z),ze=X.map(We=>{const ue=p.sub(We,We,Ie);return p.normalize(ue,ue),new p.Ray(Ie,ue)}),$e=ft(l,1,g.zoom)*g._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:Z,tilespaceRays:ze,bufferedTilespaceGeometry:G,bufferedTilespaceBounds:(je=p.getBounds(G),je.min.x=p.clamp(je.min.x,0,p.EXTENT),je.min.y=p.clamp(je.min.y,0,p.EXTENT),je.max.x=p.clamp(je.max.x,0,p.EXTENT),je.max.y=p.clamp(je.max.y,0,p.EXTENT),je),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:$e};var je}_bufferedScreenMercator(l,g){const C=Jt(l);if(this._screenRaycastCache[C])return this._screenRaycastCache[C];{let M;return M="globe"===g.projection.name?this._projectAndResample(this.bufferedScreenGeometry(l),g):{polygon:this.bufferedScreenGeometry(l).map(P=>g.pointCoordinate3D(P)),unwrapped:!0},this._screenRaycastCache[C]=M,M}}_bufferedCameraMercator(l,g){const C=Jt(l);if(this._cameraRaycastCache[C])return this._cameraRaycastCache[C];{let M;return M="globe"===g.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),g):{polygon:this.bufferedCameraGeometry(l).map(P=>g.pointCoordinate3D(P)),unwrapped:!0},this._cameraRaycastCache[C]=M,M}}_projectAndResample(l,g){const C=function(P,k){const z=p.multiply([],k.pixelMatrix,k.globeMatrix),G=[0,-p.GLOBE_RADIUS,0,1],X=[0,p.GLOBE_RADIUS,0,1],Z=[0,0,0,1];p.transformMat4$1(G,G,z),p.transformMat4$1(X,X,z),p.transformMat4$1(Z,Z,z);const se=new p.Point(G[0]/G[3],G[1]/G[3]),Ie=new p.Point(X[0]/X[3],X[1]/X[3]),ze=p.polygonContainsPoint(P,se)&&G[3]<Z[3],$e=p.polygonContainsPoint(P,Ie)&&X[3]<Z[3];if(!ze&&!$e)return null;const je=function(at,Ot,Rt){for(let kt=1;kt<at.length;kt++){const Dn=Xt(Ot.pointCoordinate3D(at[kt-1]).x),Ut=Xt(Ot.pointCoordinate3D(at[kt]).x);if(Rt<0){if(Dn<Ut)return{idx:kt,t:-Dn/(Ut-1-Dn)}}else if(Ut<Dn)return{idx:kt,t:(1-Dn)/(Ut+1-Dn)}}return null}(P,k,ze?-1:1);if(!je)return null;const{idx:We,t:ue}=je;let Fe=We>1?Be(P.slice(0,We),k):[],nt=We<P.length?Be(P.slice(We),k):[];Fe=Fe.map(at=>new p.Point(Xt(at.x),at.y)),nt=nt.map(at=>new p.Point(Xt(at.x),at.y));const Qe=[...Fe];0===Qe.length&&Qe.push(nt[nt.length-1]);const Et=p.number(Qe[Qe.length-1].y,(0===nt.length?Fe[0]:nt[0]).y,ue);let St;return St=ze?[new p.Point(0,Et),new p.Point(0,0),new p.Point(1,0),new p.Point(1,Et)]:[new p.Point(1,Et),new p.Point(1,1),new p.Point(0,1),new p.Point(0,Et)],Qe.push(...St),0===nt.length?Qe.push(Fe[0]):Qe.push(...nt),{polygon:Qe.map(at=>new p.MercatorCoordinate(at.x,at.y)),unwrapped:!1}}(l,g);if(C)return C;const M=function(P,k){let z=!1,G=-1/0,X=0;for(let se=0;se<P.length-1;se++)P[se].x>G&&(G=P[se].x,X=se);for(let se=0;se<P.length-1;se++){const Ie=(X+se)%(P.length-1),ze=P[Ie],$e=P[Ie+1];Math.abs(ze.x-$e.x)>.5&&(ze.x<$e.x?(ze.x+=1,0===Ie&&(P[P.length-1].x+=1)):($e.x+=1,Ie+1===P.length-1&&(P[0].x+=1)),z=!0)}const Z=p.mercatorXfromLng(k.center.lng);return z&&Z<Math.abs(Z-1)&&P.forEach(se=>{se.x-=1}),{polygon:P,unwrapped:z}}(Be(l,g).map(P=>new p.Point(Xt(P.x),P.y)),g);return{polygon:M.polygon.map(P=>new p.MercatorCoordinate(P.x,P.y)),unwrapped:M.unwrapped}}}function Be(w,l){return p.resample(w,g=>{const C=l.pointCoordinate3D(g);g.x=C.x,g.y=C.y},1/256)}function Xt(w){return w<0?1+w%1:w%1}function Jt(w){return 100*w|0}function Rn(w,l,g,C,M){const P=function(k,z){if(k)return M(k);if(z){w.url&&z.tiles&&w.tiles&&delete w.tiles;const G=p.pick(p.extend(z,w),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);z.vector_layers&&(G.vectorLayers=z.vector_layers,G.vectorLayerIds=G.vectorLayers.map(X=>X.id)),G.tiles=l.canonicalizeTileset(G,w.url),M(null,G)}};return w.url?p.getJSON(l.transformRequest(l.normalizeSourceURL(w.url,null,g,C),p.ResourceType.Source),P):p.exported.frame(()=>P(null,w))}class zt{constructor(l,g,C){this.bounds=p.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=g||0,this.maxzoom=C||24}validateBounds(l){return Array.isArray(l)&&4===l.length?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const g=Math.pow(2,l.z),C=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*g),M=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*g),P=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*g),k=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*g);return l.x>=C&&l.x<P&&l.y>=M&&l.y<k}}class Jn{constructor(l,g,C){this.context=l;const M=l.gl;this.buffer=M.createBuffer(),this.dynamicDraw=!!C,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),M.bufferData(M.ELEMENT_ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||g.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const g=this.context.gl;this.context.unbindVAO(),this.bind(),g.bufferSubData(g.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Mn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class jn{constructor(l,g,C,M){this.length=g.length,this.attributes=C,this.itemSize=g.bytesPerElement,this.dynamicDraw=M,this.context=l;const P=l.gl;this.buffer=P.createBuffer(),l.bindVertexBuffer.set(this.buffer),P.bufferData(P.ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||g.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const g=this.context.gl;this.bind(),g.bufferSubData(g.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,g){for(let C=0;C<this.attributes.length;C++){const M=g.attributes[this.attributes[C].name];void 0!==M&&l.enableVertexAttribArray(M)}}setVertexAttribPointers(l,g,C){for(let M=0;M<this.attributes.length;M++){const P=this.attributes[M],k=g.attributes[P.name];void 0!==k&&l.vertexAttribPointer(k,P.components,l[Mn[P.type]],!1,this.itemSize,P.offset+this.itemSize*(C||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class xn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Nn extends xn{getDefault(){return p.Color.transparent}set(l){const g=this.current;(l.r!==g.r||l.g!==g.g||l.b!==g.b||l.a!==g.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class wn extends xn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Wi extends xn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Sr extends xn{getDefault(){return[!0,!0,!0,!0]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Oi extends xn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class ar extends xn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class mr extends xn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const g=this.current;(l.func!==g.func||l.ref!==g.ref||l.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Pt extends xn{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Re extends xn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=l,this.dirty=!1}}class Te extends xn{getDefault(){return[0,1]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class Se extends xn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=l,this.dirty=!1}}class et extends xn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Ct extends xn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.BLEND):g.disable(g.BLEND),this.current=l,this.dirty=!1}}class Yt extends xn{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class yn extends xn{getDefault(){return p.Color.transparent}set(l){const g=this.current;(l.r!==g.r||l.g!==g.g||l.b!==g.b||l.a!==g.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class _n extends xn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class en extends xn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=l,this.dirty=!1}}class Dr extends xn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Pr extends xn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let zn,Gr=class extends xn{getDefault(){return null}set(w){(w!==this.current||this.dirty)&&(this.gl.useProgram(w),this.current=w,this.dirty=!1)}};class Pi extends xn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class ni extends xn{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Ci extends xn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Ki extends xn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class ts extends xn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindTexture(g.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Hs extends xn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class rt extends xn{getDefault(){return null}set(l){const g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class xe extends xn{constructor(l){super(l),this.vao=l.extVertexArrayObject}getDefault(){return null}set(l){this.vao&&(l!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(l),this.current=l,this.dirty=!1)}}class be extends xn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class tt extends xn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class ct extends xn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Ze extends xn{constructor(l,g){super(l),this.context=l,this.parent=g}getDefault(){return null}}class Ft extends Ze{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Nt extends Ze{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,this.attachment(),g.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class lt extends Nt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Zt{constructor(l,g,C,M){this.context=l,this.width=g,this.height=C;const P=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new Ft(l,P),M&&(this.depthAttachment=new Nt(l,P))}destroy(){const l=this.context.gl,g=this.colorAttachment.get();if(g&&l.deleteTexture(g),this.depthAttachment){const C=this.depthAttachment.get();C&&l.deleteRenderbuffer(C)}l.deleteFramebuffer(this.framebuffer)}}class Cn{constructor(l,g=!1){if(this.gl=l,this.isWebGL2=g,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),g){const C=l;this.extVertexArrayObject={createVertexArrayOES:C.createVertexArray.bind(l),deleteVertexArrayOES:C.deleteVertexArray.bind(l),bindVertexArrayOES:C.bindVertexArray.bind(l)}}this.clearColor=new Nn(this),this.clearDepth=new wn(this),this.clearStencil=new Wi(this),this.colorMask=new Sr(this),this.depthMask=new Oi(this),this.stencilMask=new ar(this),this.stencilFunc=new mr(this),this.stencilOp=new Pt(this),this.stencilTest=new Re(this),this.depthRange=new Te(this),this.depthTest=new Se(this),this.depthFunc=new et(this),this.blend=new Ct(this),this.blendFunc=new Yt(this),this.blendColor=new yn(this),this.blendEquation=new _n(this),this.cullFace=new en(this),this.cullFaceSide=new Dr(this),this.frontFace=new Pr(this),this.program=new Gr(this),this.activeTexture=new Pi(this),this.viewport=new ni(this),this.bindFramebuffer=new Ci(this),this.bindRenderbuffer=new Ki(this),this.bindTexture=new ts(this),this.bindVertexBuffer=new Hs(this),this.bindElementBuffer=new rt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new xe(this),this.pixelStoreUnpack=new be(this),this.pixelStoreUnpackPremultiplyAlpha=new tt(this),this.pixelStoreUnpackFlipY=new ct(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),g||(this.extTextureHalfFloat=l.getExtension("OES_texture_half_float")),(g||this.extTextureHalfFloat&&l.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=g||l.getExtension("OES_standard_derivatives"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,g){return new Jn(this,l,g)}createVertexBuffer(l,g,C){return new jn(this,l,g,C)}createRenderbuffer(l,g,C){const M=this.gl,P=M.createRenderbuffer();return this.bindRenderbuffer.set(P),M.renderbufferStorage(M.RENDERBUFFER,l,g,C),this.bindRenderbuffer.set(null),P}createFramebuffer(l,g,C){return new Zt(this,l,g,C)}clear({color:l,depth:g,stencil:C}){const M=this.gl;let P=0;l&&(P|=M.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),void 0!==g&&(P|=M.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(g),this.depthMask.set(!0)),void 0!==C&&(P|=M.STENCIL_BUFFER_BIT,this.clearStencil.set(C),this.stencilMask.set(255)),M.clear(P)}setCullFace(l){!1===l.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){J(l.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Bn extends p.Evented{constructor(l,g,C,M){if(super(),this.id=l,this.dispatcher=C,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(g,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(M),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(l){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"}));const g=Array.isArray(this.map._language)?this.map._language.join():this.map._language,C=this.map._worldview;this._tileJSONRequest=Rn(this._options,this.map._requestManager,g,C,(M,P)=>{this._tileJSONRequest=null,this._loaded=!0,M?(g&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${g}`),C&&2!==C.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${C}`),this.fire(new p.ErrorEvent(M))):P&&(p.extend(this,P),P.bounds&&(this.tileBounds=new zt(P.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(P.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(M)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}loadTile(l,g){const C=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),M={request:this.map._requestManager.transformRequest(C,p.ResourceType.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile};if(M.request.collectResourceTiming=this._collectResourceTiming,l.actor&&"expired"!==l.state)"loading"===l.state?l.reloadCallback=g:l.request=l.actor.send("reloadTile",M,P.bind(this));else if(l.actor=this._tileWorkers[C]=this._tileWorkers[C]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",M,P.bind(this),void 0,!0);else{const k=p.loadVectorTile.call({deduped:this._deduped},M,(z,G)=>{z||!G?P.call(this,z):(M.data={cacheControl:G.cacheControl,expires:G.expires,rawData:G.rawData.slice(0)},l.actor&&l.actor.send("loadTile",M,P.bind(this),void 0,!0))},!0);l.request={cancel:k}}function P(k,z){return delete l.request,l.aborted?g(null):k&&404!==k.status?g(k):(z&&z.resourceTiming&&(l.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&l.setExpiryData(z),l.loadVectorData(z,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id})}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Sn extends p.Evented{constructor(l,g,C,M){super(),this.id=l,this.dispatcher=C,this.setEventedParent(M),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},g),p.extend(this,p.pick(g,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Rn(this._options,this.map._requestManager,null,null,(g,C)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new p.ErrorEvent(g)):C&&(p.extend(this,C),C.bounds&&(this.tileBounds=new zt(C.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(C.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(g)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,g){const C=p.exported.devicePixelRatio>=2,M=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),C,this.tileSize);l.request=p.getImage(this.map._requestManager.transformRequest(M,p.ResourceType.Tile),(P,k,z,G)=>(delete l.request,l.aborted?(l.state="unloaded",g(null)):P?(l.state="errored",g(P)):k?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:z,expires:G}),l.setTexture(k,this.map.painter),l.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void g(null)):g(null)))}static loadTileData(l,g,C){l.setTexture(g,C)}static unloadTileData(l,g){l.texture&&g.saveTileTexture(l.texture)}abortTile(l,g){l.request&&(l.request.cancel(),delete l.request),g()}unloadTile(l,g){l.texture&&this.map.painter.saveTileTexture(l.texture),g()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function ri(w,l,g,C,M,P,k,z){const G=[w,g,M,l,C,P,1,1,1],X=[k,z,1],Z=p.adjoint([],G),[se,Ie,ze]=p.transformMat3(X,X,p.transpose(Z,Z));return p.multiply$1(G,[se,0,0,0,Ie,0,0,0,ze],G)}class li extends p.Evented{constructor(l,g,C,M){super(),this.id=l,this.dispatcher=C,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(M),this.options=g,this._dirty=!1}load(l,g){this._loaded=g||!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(C,M)=>{if(this._imageRequest=null,this._loaded=!0,C)this.fire(new p.ErrorEvent(C));else if(M){const{HTMLImageElement:P}=p.window;this.image=M instanceof P?p.exported.getImageData(M):M,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,l&&(this.coordinates=l),this._finishLoading()}})}loaded(){return this._loaded}updateImage(l){return this.image&&l.url?(this._imageRequest&&l.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=l.url,this.load(l.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(l){this.coordinates=l,this._boundsArray=void 0;const g=l.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(C){let M=1/0,P=1/0,k=-1/0,z=-1/0;for(const se of C)M=Math.min(M,se.x),P=Math.min(P,se.y),k=Math.max(k,se.x),z=Math.max(z,se.y);const G=Math.max(k-M,z-P),X=Math.max(0,Math.floor(-Math.log(G)/Math.LN2)),Z=Math.pow(2,X);return new p.CanonicalTileID(X,Math.floor((M+k)/2*Z),Math.floor((P+z)/2*Z))}(g),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(l){for(const G in this.tiles){const X=this.tiles[G];"loaded"!==X.state&&(X.state="loaded",X.texture=this.texture)}if(this._boundsArray)return;const g=p.tileTransform(this.tileID,this.map.transform.projection),[C,M,P,k]=this.coordinates.map(G=>{const X=g.projection.project(G[0],G[1]);return p.getTilePoint(g,X)._round()});this.perspectiveTransform=function(G,X,Z,se,Ie,ze,$e,je,We,ue){const Fe=ri(0,0,G,0,0,X,G,X),nt=ri(Z,se,Ie,ze,$e,je,We,ue);return p.multiply$1(nt,p.adjoint(Fe,Fe),nt),[nt[6]/nt[8]*G/p.EXTENT,nt[7]/nt[8]*X/p.EXTENT]}(this.width,this.height,C.x,C.y,M.x,M.y,k.x,k.y,P.x,P.y);const z=this._boundsArray=new p.StructArrayLayout4i8;z.emplaceBack(C.x,C.y,0,0),z.emplaceBack(M.x,M.y,p.EXTENT,0),z.emplaceBack(k.x,k.y,0,p.EXTENT),z.emplaceBack(P.x,P.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=l.createVertexBuffer(z,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const l=this.map.painter.context,g=l.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new p.Texture(l,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(l)}loadTile(l,g){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},g(null)):(l.state="errored",g(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Yr={vector:Bn,raster:Sn,"raster-dem":class extends Sn{constructor(w,l,g,C){super(w,l,g,C),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(w,l){const g=this.map._requestManager.normalizeTileURL(w.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function C(M,P){M&&(w.state="errored",l(M)),P&&(w.dem=P,w.dem.onDeserialize(),w.needsHillshadePrepare=!0,w.needsDEMTextureUpload=!0,w.state="loaded",l(null))}w.request=p.getImage(this.map._requestManager.transformRequest(g,p.ResourceType.Tile),function(M,P,k,z){if(delete w.request,w.aborted)w.state="unloaded",l(null);else if(M)w.state="errored",l(M);else if(P){this.map._refreshExpiredTiles&&w.setExpiryData({cacheControl:k,expires:z});const G=p.window.ImageBitmap&&P instanceof p.window.ImageBitmap&&(null==zn&&(zn=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),zn),X=1-(P.width-p.prevPowerOfTwo(P.width))/2;X<1||w.neighboringTiles||(w.neighboringTiles=this._getNeighboringTiles(w.tileID));const Z=G?P:p.exported.getImageData(P,X),se={uid:w.uid,coord:w.tileID,source:this.id,rawImageData:Z,encoding:this.encoding,padding:X};w.actor&&"expired"!==w.state||(w.actor=this.dispatcher.getActor(),w.actor.send("loadDEMTile",se,C.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(w){const l=w.canonical,g=Math.pow(2,l.z),C=(l.x-1+g)%g,M=0===l.x?w.wrap-1:w.wrap,P=(l.x+1+g)%g,k=l.x+1===g?w.wrap+1:w.wrap,z={};return z[new p.OverscaledTileID(w.overscaledZ,M,l.z,C,l.y).key]={backfilled:!1},z[new p.OverscaledTileID(w.overscaledZ,k,l.z,P,l.y).key]={backfilled:!1},l.y>0&&(z[new p.OverscaledTileID(w.overscaledZ,M,l.z,C,l.y-1).key]={backfilled:!1},z[new p.OverscaledTileID(w.overscaledZ,w.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},z[new p.OverscaledTileID(w.overscaledZ,k,l.z,P,l.y-1).key]={backfilled:!1}),l.y+1<g&&(z[new p.OverscaledTileID(w.overscaledZ,M,l.z,C,l.y+1).key]={backfilled:!1},z[new p.OverscaledTileID(w.overscaledZ,w.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},z[new p.OverscaledTileID(w.overscaledZ,k,l.z,P,l.y+1).key]={backfilled:!1}),z}unloadTile(w){w.demTexture&&this.map.painter.saveTileTexture(w.demTexture),w.fbo&&(w.fbo.destroy(),delete w.fbo),w.dem&&delete w.dem,delete w.neighboringTiles,w.state="unloaded"}},geojson:class extends p.Evented{constructor(w,l,g,C){super(),this.id=w,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=g.getActor(),this.setEventedParent(C),this._data=l.data,this._options=p.extend({},l),this._collectResourceTiming=l.collectResourceTiming,void 0!==l.maxzoom&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const M=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(void 0!==l.buffer?l.buffer:128)*M,tolerance:(void 0!==l.tolerance?l.tolerance:.375)*M,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:void 0!==l.clusterMaxZoom?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==l.clusterRadius?l.clusterRadius:50)*M,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}onAdd(w){this.map=w,this.setData(this._data)}setData(w){return this._data=w,this._updateWorkerData(),this}getClusterExpansionZoom(w,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:w,source:this.id},l),this}getClusterChildren(w,l){return this.actor.send("geojson.getClusterChildren",{clusterId:w,source:this.id},l),this}getClusterLeaves(w,l,g,C){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:w,limit:l,offset:g},C),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const w=p.extend({},this.workerOptions),l=this._data;"string"==typeof l?(w.request=this.map._requestManager.transformRequest(p.exported.resolveURL(l),p.ResourceType.Source),w.request.collectResourceTiming=this._collectResourceTiming):w.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,w,(g,C)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new p.ErrorEvent(g));else{const M={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&C&&C.resourceTiming&&C.resourceTiming[this.id]&&(M.resourceTiming=C.resourceTiming[this.id]),this.fire(new p.Event("data",M)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(w,l){const g=w.actor?"reloadTile":"loadTile";w.actor=this.actor,w.request=this.actor.send(g,{type:this.type,uid:w.uid,tileID:w.tileID,tileZoom:w.tileZoom,zoom:w.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(C,M)=>(delete w.request,w.unloadVectorData(),w.aborted?l(null):C?l(C):(w.loadVectorData(M,this.map.painter,"reloadTile"===g),l(null))),void 0,"loadTile"===g)}abortTile(w){w.request&&(w.request.cancel(),delete w.request),w.aborted=!0}unloadTile(w){w.unloadVectorData(),this.actor.send("removeTile",{uid:w.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends li{constructor(w,l,g,C){super(w,l,g,C),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const w=this.options;this.urls=[];for(const l of w.urls)this.urls.push(this.map._requestManager.transformRequest(l,p.ResourceType.Source).url);p.getVideo(this.urls,(l,g)=>{this._loaded=!0,l?this.fire(new p.ErrorEvent(l)):g&&(this.video=g,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(w){if(this.video){const l=this.video.seekable;w<l.start(0)||w>l.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=w}}getVideo(){return this.video}onAdd(w){this.map||(this.map=w,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const w=this.map.painter.context,l=w.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(w,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(w)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:li,canvas:class extends li{constructor(w,l,g,C){super(w,l,g,C),l.coordinates?Array.isArray(l.coordinates)&&4===l.coordinates.length&&!l.coordinates.some(M=>!Array.isArray(M)||2!==M.length||M.some(P=>"number"!=typeof P))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${w}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${w}`,null,'missing required property "coordinates"'))),l.animate&&"boolean"!=typeof l.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${w}`,null,'optional "animate" property must be a boolean value'))),l.canvas?"string"==typeof l.canvas||l.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${w}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${w}`,null,'missing required property "canvas"'))),this.options=l,this.animate=void 0===l.animate||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(w){this.map=w,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let w=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,w=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,w=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const l=this.map.painter.context;this.texture?(w||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const w of[this.canvas.width,this.canvas.height])if(isNaN(w)||w<=0)return!0;return!1}},custom:class extends p.Evented{constructor(w,l,g,C){super(),this.id=w,this.type="custom",this._dataType="raster",this._dispatcher=g,this._implementation=l,this.setEventedParent(C),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new zt(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(w){this._map=w,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(w),this.load()}onRemove(w){this._implementation.onRemove&&this._implementation.onRemove(w)}hasTile(w){if(this._implementation.hasTile){const{x:l,y:g,z:C}=w.canonical;return this._implementation.hasTile({x:l,y:g,z:C})}return!this.tileBounds||this.tileBounds.contains(w.canonical)}loadTile(w,l){const{x:g,y:C,z:M}=w.tileID.canonical,P=new p.window.AbortController;w.request=Promise.resolve(this._implementation.loadTile({x:g,y:C,z:M},{signal:P.signal})).then(function(k){return delete w.request,w.aborted?(w.state="unloaded",l(null)):void 0===k?(w.state="errored",l(null)):null===k?(this.loadTileData(w,{width:this.tileSize,height:this.tileSize,data:null}),w.state="loaded",l(null)):(z=k)instanceof p.window.ImageData||z instanceof p.window.HTMLCanvasElement||z instanceof p.window.ImageBitmap||z instanceof p.window.HTMLImageElement?(this.loadTileData(w,k),w.state="loaded",void l(null)):(w.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var z}.bind(this)).catch(k=>{20!==k.code&&(w.state="errored",l(k))}),w.request.cancel=()=>P.abort()}loadTileData(w,l){Sn.loadTileData(w,l,this._map.painter)}unloadTileData(w){Sn.unloadTileData(w,this._map.painter)}unloadTile(w,l){if(this.unloadTileData(w),this._implementation.unloadTile){const{x:g,y:C,z:M}=w.tileID.canonical;this._implementation.unloadTile({x:g,y:C,z:M})}l()}abortTile(w,l){w.request&&w.request.cancel&&(w.request.cancel(),delete w.request),l()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(w=>({x:w.canonical.x,y:w.canonical.y,z:w.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Cr=function(w,l,g,C){const M=new Yr[l.type](w,l,g,C);if(M.id!==w)throw new Error(`Expected Source id to be ${w} instead of ${M.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],M),M};function fi(w,l){const g=p.identity([]);return p.scale(g,g,[.5*w.width,.5*-w.height,1]),p.translate(g,g,[1,-1,0]),p.multiply(g,g,w.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(g)}function fs(w,l,g,C,M,P,k,z=!1){const G=w.tilesIn(C,k,z);G.sort(Xr);const X=[];for(const se of G)X.push({wrappedTileID:se.tile.tileID.wrapped().key,queryResults:se.tile.queryRenderedFeatures(l,g,w._state,se,M,P,fi(w.transform,se.tile.tileID),z)});const Z=function(se){const Ie={},ze={};for(const $e of se){const je=$e.queryResults,We=$e.wrappedTileID,ue=ze[We]=ze[We]||{};for(const Fe in je){const nt=je[Fe],Qe=ue[Fe]=ue[Fe]||{},Et=Ie[Fe]=Ie[Fe]||[];for(const St of nt)Qe[St.featureIndex]||(Qe[St.featureIndex]=!0,Et.push(St))}}return Ie}(X);for(const se in Z)Z[se].forEach(Ie=>{const ze=Ie.feature,$e=ze.layer;$e&&"background"!==$e.type&&"sky"!==$e.type&&(ze.source=$e.source,$e["source-layer"]&&(ze.sourceLayer=$e["source-layer"]),ze.state=void 0!==ze.id?w.getFeatureState($e["source-layer"],ze.id):{})});return Z}function ds(w,l){const g=w.getRenderableIds().map(P=>w.getTileByID(P)),C=[],M={};for(let P=0;P<g.length;P++){const k=g[P],z=k.tileID.canonical.key;M[z]||(M[z]=!0,k.querySourceFeatures(C,l))}return C}function Xr(w,l){const g=w.tileID,C=l.tileID;return g.overscaledZ-C.overscaledZ||g.canonical.y-C.canonical.y||g.wrap-C.wrap||g.canonical.x-C.canonical.x}function ao(){return null!=Bf.workerClass?new Bf.workerClass:new p.window.Worker(Bf.workerUrl)}const ya="mapboxgl_preloaded_worker_pool";class Xo{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<Xo.workerCount;)this.workers.push(new ao);return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],0===this.numActive()&&(this.workers.forEach(g=>{g.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ya]}numActive(){return Object.keys(this.active).length}}let zi;function pl(){return zi||(zi=new Xo),zi}function wo(w,l){const g={};for(const C in w)"ref"!==C&&(g[C]=w[C]);return p.refProperties.forEach(C=>{C in l&&(g[C]=l[C])}),g}function uc(w){w=w.slice();const l=Object.create(null);for(let g=0;g<w.length;g++)l[w[g].id]=w[g];for(let g=0;g<w.length;g++)"ref"in w[g]&&(w[g]=wo(w[g],l[w[g].ref]));return w}Xo.workerCount=2;const Br={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Lf(w,l,g){g.push({command:Br.addSource,args:[w,l[w]]})}function ns(w,l,g){l.push({command:Br.removeSource,args:[w]}),g[w]=!0}function ps(w,l,g,C){ns(w,g,C),Lf(w,l,g)}function lc(w,l,g){let C;for(C in w[g])if(w[g].hasOwnProperty(C)&&"data"!==C&&!J(w[g][C],l[g][C]))return!1;for(C in l[g])if(l[g].hasOwnProperty(C)&&"data"!==C&&!J(w[g][C],l[g][C]))return!1;return!0}function gs(w,l,g,C,M,P){let k;for(k in l=l||{},w=w||{})w.hasOwnProperty(k)&&(J(w[k],l[k])||g.push({command:P,args:[C,k,l[k],M]}));for(k in l)l.hasOwnProperty(k)&&!w.hasOwnProperty(k)&&(J(w[k],l[k])||g.push({command:P,args:[C,k,l[k],M]}))}function _a(w){return w.id}function ms(w,l){return w[l.id]=l,w}class Ac{constructor(l,g){this.reset(l,g)}reset(l,g){this.points=l||[],this._distances=[0];for(let C=1;C<this.points.length;C++)this._distances[C]=this._distances[C-1]+this.points[C].dist(this.points[C-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(g||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(1===this.points.length)return this.points[0];l=p.clamp(l,0,1);let g=1,C=this._distances[g];const M=l*this.paddedLength+this.padding;for(;C<M&&g<this._distances.length;)C=this._distances[++g];const P=g-1,k=this._distances[P],z=C-k,G=z>0?(M-k)/z:0;return this.points[P].mult(1-G).add(this.points[g].mult(G))}}class Za{constructor(l,g,C){const M=this.boxCells=[],P=this.circleCells=[];this.xCellCount=Math.ceil(l/C),this.yCellCount=Math.ceil(g/C);for(let k=0;k<this.xCellCount*this.yCellCount;k++)M.push([]),P.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=g,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/g,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,g,C,M,P){this._forEachCell(g,C,M,P,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(g),this.bboxes.push(C),this.bboxes.push(M),this.bboxes.push(P)}insertCircle(l,g,C,M){this._forEachCell(g-M,C-M,g+M,C+M,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(g),this.circles.push(C),this.circles.push(M)}_insertBoxCell(l,g,C,M,P,k){this.boxCells[P].push(k)}_insertCircleCell(l,g,C,M,P,k){this.circleCells[P].push(k)}_query(l,g,C,M,P,k){if(C<0||l>this.width||M<0||g>this.height)return!P&&[];const z=[];if(l<=0&&g<=0&&this.width<=C&&this.height<=M){if(P)return!0;for(let G=0;G<this.boxKeys.length;G++)z.push({key:this.boxKeys[G],x1:this.bboxes[4*G],y1:this.bboxes[4*G+1],x2:this.bboxes[4*G+2],y2:this.bboxes[4*G+3]});for(let G=0;G<this.circleKeys.length;G++){const X=this.circles[3*G],Z=this.circles[3*G+1],se=this.circles[3*G+2];z.push({key:this.circleKeys[G],x1:X-se,y1:Z-se,x2:X+se,y2:Z+se})}return k?z.filter(k):z}return this._forEachCell(l,g,C,M,this._queryCell,z,{hitTest:P,seenUids:{box:{},circle:{}}},k),P?z.length>0:z}_queryCircle(l,g,C,M,P){const k=l-C,z=l+C,G=g-C,X=g+C;if(z<0||k>this.width||X<0||G>this.height)return!M&&[];const Z=[];return this._forEachCell(k,G,z,X,this._queryCellCircle,Z,{hitTest:M,circle:{x:l,y:g,radius:C},seenUids:{box:{},circle:{}}},P),M?Z.length>0:Z}query(l,g,C,M,P){return this._query(l,g,C,M,!1,P)}hitTest(l,g,C,M,P){return this._query(l,g,C,M,!0,P)}hitTestCircle(l,g,C,M){return this._queryCircle(l,g,C,!0,M)}_queryCell(l,g,C,M,P,k,z,G){const X=z.seenUids,Z=this.boxCells[P];if(null!==Z){const Ie=this.bboxes;for(const ze of Z)if(!X.box[ze]){X.box[ze]=!0;const $e=4*ze;if(l<=Ie[$e+2]&&g<=Ie[$e+3]&&C>=Ie[$e+0]&&M>=Ie[$e+1]&&(!G||G(this.boxKeys[ze]))){if(z.hitTest)return k.push(!0),!0;k.push({key:this.boxKeys[ze],x1:Ie[$e],y1:Ie[$e+1],x2:Ie[$e+2],y2:Ie[$e+3]})}}}const se=this.circleCells[P];if(null!==se){const Ie=this.circles;for(const ze of se)if(!X.circle[ze]){X.circle[ze]=!0;const $e=3*ze;if(this._circleAndRectCollide(Ie[$e],Ie[$e+1],Ie[$e+2],l,g,C,M)&&(!G||G(this.circleKeys[ze]))){if(z.hitTest)return k.push(!0),!0;{const je=Ie[$e],We=Ie[$e+1],ue=Ie[$e+2];k.push({key:this.circleKeys[ze],x1:je-ue,y1:We-ue,x2:je+ue,y2:We+ue})}}}}}_queryCellCircle(l,g,C,M,P,k,z,G){const X=z.circle,Z=z.seenUids,se=this.boxCells[P];if(null!==se){const ze=this.bboxes;for(const $e of se)if(!Z.box[$e]){Z.box[$e]=!0;const je=4*$e;if(this._circleAndRectCollide(X.x,X.y,X.radius,ze[je+0],ze[je+1],ze[je+2],ze[je+3])&&(!G||G(this.boxKeys[$e])))return k.push(!0),!0}}const Ie=this.circleCells[P];if(null!==Ie){const ze=this.circles;for(const $e of Ie)if(!Z.circle[$e]){Z.circle[$e]=!0;const je=3*$e;if(this._circlesCollide(ze[je],ze[je+1],ze[je+2],X.x,X.y,X.radius)&&(!G||G(this.circleKeys[$e])))return k.push(!0),!0}}}_forEachCell(l,g,C,M,P,k,z,G){const X=this._convertToXCellCoord(l),Z=this._convertToYCellCoord(g),se=this._convertToXCellCoord(C),Ie=this._convertToYCellCoord(M);for(let ze=X;ze<=se;ze++)for(let $e=Z;$e<=Ie;$e++)if(P.call(this,l,g,C,M,this.xCellCount*$e+ze,k,z,G))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,g,C,M,P,k){const z=M-l,G=P-g,X=C+k;return X*X>z*z+G*G}_circleAndRectCollide(l,g,C,M,P,k,z){const G=(k-M)/2,X=Math.abs(l-(M+G));if(X>G+C)return!1;const Z=(z-P)/2,se=Math.abs(g-(P+Z));if(se>Z+C)return!1;if(X<=G||se<=Z)return!0;const Ie=X-G,ze=se-Z;return Ie*Ie+ze*ze<=C*C}}const Oa={unknown:0,flipRequired:1,flipNotRequired:2},Na=Math.tan(85*Math.PI/180);function on(w,l,g,C,M,P,k){const z=p.create();if(g)if("globe"===P.name){const G=p.calculateGlobeLabelMatrix(M,l);p.multiply(z,z,G)}else{const G=te([],k);z[0]=G[0],z[1]=G[1],z[4]=G[2],z[5]=G[3],C||p.rotateZ(z,z,M.angle)}else p.multiply(z,M.labelPlaneMatrix,w);return z}function Wu(w,l,g,C,M,P,k){const z=on(w,l,g,C,M,P,k);return"globe"===P.name&&g||(z[2]=z[6]=z[10]=z[14]=0),z}function Ms(w,l,g,C,M,P,k){if(g){if("globe"===P.name){const z=on(w,l,g,C,M,P,k);return p.invert(z,z),p.multiply(z,w,z),z}{const z=p.clone(w),G=p.identity([]);return G[0]=k[0],G[1]=k[1],G[4]=k[2],G[5]=k[3],p.multiply(z,z,G),C||p.rotateZ(z,z,-M.angle),z}}return M.glCoordMatrix}function aa(w,l,g,C){const M=[w,l,g,1];g?p.transformMat4$1(M,M,C):di(M,M,C);const P=M[3];return M[0]/=P,M[1]/=P,M[2]/=P,M}function Ds(w,l){return Math.min(.5+w/l*.5,1.5)}function bs(w,l){const g=w[0]/w[3],C=w[1]/w[3];return g>=-l[0]&&g<=l[0]&&C>=-l[1]&&C<=l[1]}function Xu(w,l,g,C,M,P,k,z,G,X){const Z=g.transform,se=C?w.textSizeData:w.iconSizeData,Ie=p.evaluateSizeForZoom(se,g.transform.zoom),ze="globe"===Z.projection.name,$e=[256/g.width*2+1,256/g.height*2+1],je=C?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;je.clear();let We=null;ze&&(We=C?w.text.globeExtVertexArray:w.icon.globeExtVertexArray);const ue=w.lineVertexArray,Fe=C?w.text.placedSymbolArray:w.icon.placedSymbolArray,nt=g.transform.width/g.transform.height;let Qe,Et=!1;for(let St=0;St<Fe.length;St++){const at=Fe.get(St),{numGlyphs:Ot,writingMode:Rt}=at;if(Rt!==p.WritingMode.vertical||Et||Qe===p.WritingMode.horizontal||(Et=!0),Qe=Rt,(at.hidden||Rt===p.WritingMode.vertical)&&!Et){er(Ot,je);continue}Et=!1;const kt=new p.Point(at.tileAnchorX,at.tileAnchorY);let{x:Dn,y:Ut,z:an}=Z.projection.projectTilePoint(kt.x,kt.y,X.canonical);if(G){const[Vr,or,Ar]=G(kt);Dn+=Vr,Ut+=or,an+=Ar}const Ht=[Dn,Ut,an,1];if(p.transformMat4$1(Ht,Ht,l),!bs(Ht,$e)){er(Ot,je);continue}const gn=Ds(g.transform.cameraToCenterDistance,Ht[3]),Gt=p.evaluateSizeForFeature(se,Ie,at),fn=k?Gt/gn:Gt*gn,En=aa(Dn,Ut,an,M);if(En[3]<=0){er(Ot,je);continue}let vn={};const Ln=k?null:G,wr=pn(at,fn,!1,z,l,M,P,w.glyphOffsetArray,ue,je,We,En,kt,vn,nt,Ln,Z.projection,X,k);Et=wr.useVertical,Ln&&wr.needsFlipping&&(vn={}),(wr.notEnoughRoom||Et||wr.needsFlipping&&pn(at,fn,!0,z,l,M,P,w.glyphOffsetArray,ue,je,We,En,kt,vn,nt,Ln,Z.projection,X,k).notEnoughRoom)&&er(Ot,je)}C?(w.text.dynamicLayoutVertexBuffer.updateData(je),We&&w.text.globeExtVertexBuffer.updateData(We)):(w.icon.dynamicLayoutVertexBuffer.updateData(je),We&&w.icon.globeExtVertexBuffer.updateData(We))}function Qr(w,l,g,C,M,P,k,z,G,X,Z,se,Ie,ze,$e,je){const{lineStartIndex:We,glyphStartIndex:ue,segment:Fe}=z,nt=ue+z.numGlyphs,Qe=We+z.lineLength,Et=l.getoffsetX(ue),St=l.getoffsetX(nt-1),at=Ya(w*Et,g,C,M,P,k,Fe,We,Qe,G,X,Z,se,Ie,!0,ze,$e,je);if(!at)return null;const Ot=Ya(w*St,g,C,M,P,k,Fe,We,Qe,G,X,Z,se,Ie,!0,ze,$e,je);return Ot?{first:at,last:Ot}:null}function Pc(w,l,g,C){return w===p.WritingMode.horizontal&&Math.abs(C)>Math.abs(g)?{useVertical:!0}:w===p.WritingMode.vertical?C>0?{needsFlipping:!0}:null:l!==Oa.unknown&&(0===(M=g)||Math.abs(C/M)>Na)?l===Oa.flipRequired?{needsFlipping:!0}:null:g<0?{needsFlipping:!0}:null;var M}function pn(w,l,g,C,M,P,k,z,G,X,Z,se,Ie,ze,$e,je,We,ue,Fe){const nt=l/24,Qe=w.lineOffsetX*nt,Et=w.lineOffsetY*nt,{lineStartIndex:St,glyphStartIndex:at,numGlyphs:Ot,segment:Rt,writingMode:kt,flipState:Dn}=w,Ut=St+w.lineLength,an=Ht=>{if(Z){const[En,vn,Ln]=Ht.up,wr=X.length;p.updateGlobeVertexNormal(Z,wr+0,En,vn,Ln),p.updateGlobeVertexNormal(Z,wr+1,En,vn,Ln),p.updateGlobeVertexNormal(Z,wr+2,En,vn,Ln),p.updateGlobeVertexNormal(Z,wr+3,En,vn,Ln)}const[gn,Gt,fn]=Ht.point;p.addDynamicAttributes(X,gn,Gt,fn,Ht.angle)};if(Ot>1){const Ht=Qr(nt,z,Qe,Et,g,se,Ie,w,G,P,ze,je,!1,We,ue,Fe);if(!Ht)return{notEnoughRoom:!0};if(C&&!g){let[gn,Gt,fn]=Ht.first.point,[En,vn,Ln]=Ht.last.point;[gn,Gt]=aa(gn,Gt,fn,k),[En,vn]=aa(En,vn,Ln,k);const wr=Pc(kt,Dn,(En-gn)*$e,vn-Gt);if(w.flipState=wr&&wr.needsFlipping?Oa.flipRequired:Oa.flipNotRequired,wr)return wr}an(Ht.first);for(let gn=at+1;gn<at+Ot-1;gn++){const Gt=Ya(nt*z.getoffsetX(gn),Qe,Et,g,se,Ie,Rt,St,Ut,G,P,ze,je,!1,!1,We,ue,Fe);if(!Gt)return X.length-=4*(gn-at),{notEnoughRoom:!0};an(Gt)}an(Ht.last)}else{if(C&&!g){const gn=aa(Ie.x,Ie.y,0,M),Gt=St+Rt+1,fn=new p.Point(G.getx(Gt),G.gety(Gt)),En=aa(fn.x,fn.y,0,M),vn=En[3]>0?En:zr(Ie,fn,gn,1,M,void 0,We,ue.canonical),Ln=Pc(kt,Dn,(vn[0]-gn[0])*$e,vn[1]-gn[1]);if(w.flipState=Ln&&Ln.needsFlipping?Oa.flipRequired:Oa.flipNotRequired,Ln)return Ln}const Ht=Ya(nt*z.getoffsetX(at),Qe,Et,g,se,Ie,Rt,St,Ut,G,P,ze,je,!1,!1,We,ue,Fe);if(!Ht)return{notEnoughRoom:!0};an(Ht)}return{}}function Zr(w,l,g,C,M){const{x:P,y:k,z}=C.projectTilePoint(w.x,w.y,l);if(!M)return aa(P,k,z,g);const[G,X,Z]=M(w);return aa(P+G,k+X,z+Z,g)}function zr(w,l,g,C,M,P,k,z){const G=Zr(w.sub(l)._unit()._add(w),z,M,k,P);return p.sub(G,g,G),p.normalize(G,G),p.scaleAndAdd(G,g,G,C)}function Ya(w,l,g,C,M,P,k,z,G,X,Z,se,Ie,ze,$e,je,We,ue){const Fe=C?w-l:w+l;let nt=Fe>0?1:-1,Qe=0;C&&(nt*=-1,Qe=Math.PI),nt<0&&(Qe+=Math.PI);let Et=z+k+(nt>0?0:1)|0,St=M,at=M,Ot=0,Rt=0;const kt=Math.abs(Fe),Dn=[],Ut=[];let an=P,Ht=an;const gn=()=>zr(Ht,an,at,kt-Ot+1,Z,Ie,je,We.canonical);for(;Ot+Rt<=kt;){if(Et+=nt,Et<z||Et>=G)return null;if(at=St,Ht=an,Dn.push(at),ze&&Ut.push(Ht),an=new p.Point(X.getx(Et),X.gety(Et)),St=se[Et],!St){const Ar=Zr(an,We.canonical,Z,je,Ie);St=Ar[3]>0?se[Et]=Ar:gn()}Ot+=Rt,Rt=p.distance(at,St)}$e&&Ie&&(se[Et]&&(St=gn(),Rt=p.distance(at,St)),se[Et]=St);const Gt=(kt-Ot)/Rt,fn=an.sub(Ht)._mult(Gt)._add(Ht),En=p.sub([],St,at),vn=p.scaleAndAdd([],at,En,Gt);let Ln=[0,0,1],wr=En[0],Vr=En[1];if(ue&&(Ln=je.upVector(We.canonical,fn.x,fn.y),0!==Ln[0]||0!==Ln[1]||1!==Ln[2])){const Ar=[Ln[2],0,-Ln[0]],Xn=p.cross([],Ln,Ar);p.normalize(Ar,Ar),p.normalize(Xn,Xn),wr=p.dot(En,Ar),Vr=p.dot(En,Xn)}if(g){const Ar=p.cross([],Ln,En);p.normalize(Ar,Ar),p.scaleAndAdd(vn,vn,Ar,g*nt)}const or=Qe+Math.atan2(Vr,wr);return Dn.push(vn),ze&&Ut.push(fn),{point:vn,angle:or,path:Dn,tilePath:Ut,up:Ln}}function er(w,l){const g=l.length,C=g+4*w;l.resize(C),l.float32.fill(-1/0,4*g,4*C)}function di(w,l,g){const C=l[0],M=l[1];return w[0]=g[0]*C+g[4]*M+g[12],w[1]=g[1]*C+g[5]*M+g[13],w[3]=g[3]*C+g[7]*M+g[15],w}const yo=100;class Gl{constructor(l,g,C=new Za(l.width+200,l.height+200,25),M=new Za(l.width+200,l.height+200,25)){this.transform=l,this.grid=C,this.ignoredGrid=M,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+yo,this.screenBottomBoundary=l.height+yo,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=g}placeCollisionBox(l,g,C,M,P,k,z,G){let X=C.projectedAnchorX,Z=C.projectedAnchorY,se=C.projectedAnchorZ;const Ie=C.elevation,ze=C.tileID,$e=l.getProjection();if(Ie&&ze){const[St,at,Ot]=$e.upVector(ze.canonical,C.tileAnchorX,C.tileAnchorY),Rt=$e.upVectorScale(ze.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;X+=St*Ie*Rt,Z+=at*Ie*Rt,se+=Ot*Ie*Rt}const je=this.projectAndGetPerspectiveRatio(z,X,Z,se,C.tileID,"globe"===$e.name||!!Ie||this.transform.pitch>0,$e),We=k*je.perspectiveRatio,ue=(C.x1*g+M.x-C.padding)*We+je.point.x,Fe=(C.y1*g+M.y-C.padding)*We+je.point.y,nt=(C.x2*g+M.x+C.padding)*We+je.point.x,Qe=(C.y2*g+M.y+C.padding)*We+je.point.y,Et=je.perspectiveRatio<=.55||je.occluded;return!this.isInsideGrid(ue,Fe,nt,Qe)||!P&&this.grid.hitTest(ue,Fe,nt,Qe,G)||Et?{box:[],offscreen:!1,occluded:je.occluded}:{box:[ue,Fe,nt,Qe],offscreen:this.isOffscreen(ue,Fe,nt,Qe),occluded:!1}}placeCollisionCircles(l,g,C,M,P,k,z,G,X,Z,se,Ie,ze,$e,je){const We=[],ue=this.transform.elevation,Fe=l.getProjection(),nt=ue?ue.getAtTileOffsetFunc(je,this.transform.center.lat,this.transform.worldSize,Fe):null,Qe=new p.Point(C.tileAnchorX,C.tileAnchorY);let{x:Et,y:St,z:at}=Fe.projectTilePoint(Qe.x,Qe.y,je.canonical);if(nt){const[fn,En,vn]=nt(Qe);Et+=fn,St+=En,at+=vn}const Ot="globe"===Fe.name,Rt=this.projectAndGetPerspectiveRatio(z,Et,St,at,je,Ot||!!ue||this.transform.pitch>0,Fe),{perspectiveRatio:kt}=Rt,Dn=(se?k/kt:k*kt)/p.ONE_EM,Ut=aa(Et,St,at,G),an=Rt.signedDistanceFromCamera>0?Qr(Dn,P,C.lineOffsetX*Dn,C.lineOffsetY*Dn,!1,Ut,Qe,C,M,G,{},ue&&!se?nt:null,se&&!!ue,Fe,je,se):null;let Ht=!1,gn=!1,Gt=!0;if(an&&!Rt.occluded){const fn=.5*ze*kt+$e,En=new p.Point(-100,-100),vn=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),Ln=new Ac,{first:wr,last:Vr}=an,or=wr.path.length;let Ar=[];for(let yr=or-1;yr>=1;yr--)Ar.push(wr.path[yr]);for(let yr=1;yr<Vr.path.length;yr++)Ar.push(Vr.path[yr]);const Xn=2.5*fn;X&&(Ar=Ar.map(([yr,bo,Ko],us)=>(nt&&!Ot&&(Ko=nt(us<or-1?wr.tilePath[or-1-us]:Vr.tilePath[us-or+2])[2]),aa(yr,bo,Ko,X))),Ar.some(yr=>yr[3]<=0)&&(Ar=[]));let ci=[];if(Ar.length>0){let yr=1/0,bo=-1/0,Ko=1/0,us=-1/0;for(const ls of Ar)yr=Math.min(yr,ls[0]),Ko=Math.min(Ko,ls[1]),bo=Math.max(bo,ls[0]),us=Math.max(us,ls[1]);bo>=En.x&&yr<=vn.x&&us>=En.y&&Ko<=vn.y&&(ci=[Ar.map(ls=>new p.Point(ls[0],ls[1]))],(yr<En.x||bo>vn.x||Ko<En.y||us>vn.y)&&(ci=p.clipLine(ci,En.x,En.y,vn.x,vn.y)))}for(const yr of ci){Ln.reset(yr,.25*fn);let bo=0;bo=Ln.length<=.5*fn?1:Math.ceil(Ln.paddedLength/Xn)+1;for(let Ko=0;Ko<bo;Ko++){const us=Ko/Math.max(bo-1,1),ls=Ln.lerp(us),Va=ls.x+yo,Iu=ls.y+yo;We.push(Va,Iu,fn,0);const Xl=Va-fn,pc=Iu-fn,Ks=Va+fn,Jo=Iu+fn;if(Gt=Gt&&this.isOffscreen(Xl,pc,Ks,Jo),gn=gn||this.isInsideGrid(Xl,pc,Ks,Jo),!g&&this.grid.hitTestCircle(Va,Iu,fn,Ie)&&(Ht=!0,!Z))return{circles:[],offscreen:!1,collisionDetected:Ht,occluded:!1}}}}return{circles:!Z&&Ht||!gn?[]:We,offscreen:Gt,collisionDetected:Ht,occluded:Rt.occluded}}queryRenderedSymbols(l){if(0===l.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const g=[];let C=1/0,M=1/0,P=-1/0,k=-1/0;for(const Z of l){const se=new p.Point(Z.x+yo,Z.y+yo);C=Math.min(C,se.x),M=Math.min(M,se.y),P=Math.max(P,se.x),k=Math.max(k,se.y),g.push(se)}const z=this.grid.query(C,M,P,k).concat(this.ignoredGrid.query(C,M,P,k)),G={},X={};for(const Z of z){const se=Z.key;if(void 0===G[se.bucketInstanceId]&&(G[se.bucketInstanceId]={}),G[se.bucketInstanceId][se.featureIndex])continue;const Ie=[new p.Point(Z.x1,Z.y1),new p.Point(Z.x2,Z.y1),new p.Point(Z.x2,Z.y2),new p.Point(Z.x1,Z.y2)];p.polygonIntersectsPolygon(g,Ie)&&(G[se.bucketInstanceId][se.featureIndex]=!0,void 0===X[se.bucketInstanceId]&&(X[se.bucketInstanceId]=[]),X[se.bucketInstanceId].push(se.featureIndex))}return X}insertCollisionBox(l,g,C,M,P){(g?this.ignoredGrid:this.grid).insert({bucketInstanceId:C,featureIndex:M,collisionGroupID:P},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,g,C,M,P){const k=g?this.ignoredGrid:this.grid,z={bucketInstanceId:C,featureIndex:M,collisionGroupID:P};for(let G=0;G<l.length;G+=4)k.insertCircle(z,l[G],l[G+1],l[G+2])}projectAndGetPerspectiveRatio(l,g,C,M,P,k,z){const G=[g,C,M,1];let X=!1;M||this.transform.pitch>0?(p.transformMat4$1(G,G,l),this.fogState&&P&&"globe"!==z.name&&(X=function(Ie,ze,$e,je,We,ue){const Fe=ue.calculateFogTileMatrix(We),nt=[ze,$e,je];return p.transformMat4(nt,nt,Fe),sn(Ie,nt,ue.pitch,ue._fov)}(this.fogState,g,C,M,P.toUnwrapped(),this.transform)>.9)):di(G,G,l);const Z=G[3];return{point:new p.Point((G[0]/Z+1)/2*this.transform.width+yo,(-G[1]/Z+1)/2*this.transform.height+yo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(z)/Z*.5,1.5),signedDistanceFromCamera:Z,occluded:k&&G[2]>Z||X}}isOffscreen(l,g,C,M){return C<yo||l>=this.screenRightBoundary||M<yo||g>this.screenBottomBoundary}isInsideGrid(l,g,C,M){return C>=0&&l<this.gridRightBoundary&&M>=0&&g<this.gridBottomBoundary}getViewportMatrix(){const l=p.identity([]);return p.translate(l,l,[-100,-100,0]),l}}function Ia(w,l,g){const C=l.createTileMatrix(w,w.worldSize,g.toUnwrapped());return p.multiply(new Float32Array(16),w.projMatrix,C)}function Qs(w,l,g){if(l.projection.name===g.projection.name)return w.projMatrix;const C=g.clone();return C.setProjection(l.projection),Ia(C,l.getProjection(),w)}function ur(w,l,g){return l.name===g.projection.name?w.projMatrix:Ia(g,l,w)}class hh{constructor(l,g,C,M){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?g:-g))):M&&C?1:0,this.placed=C}isHidden(){return 0===this.opacity&&!this.placed}}class Tn{constructor(l,g,C,M,P,k=!1){this.text=new hh(l?l.text:null,g,C,P),this.icon=new hh(l?l.icon:null,g,M,P),this.clipped=k}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Il{constructor(l,g,C,M=!1){this.text=l,this.icon=g,this.skipFade=C,this.clipped=M}}class Ka{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class Hn{constructor(l,g,C,M,P){this.bucketInstanceId=l,this.featureIndex=g,this.sourceLayerIndex=C,this.bucketIndex=M,this.tileID=P}}class Wc{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const g=++this.maxGroupID;this.collisionGroups[l]={ID:g,predicate:C=>C.collisionGroupID===g}}return this.collisionGroups[l]}}function dr(w,l,g,C,M){const{horizontalAlign:P,verticalAlign:k}=p.getAnchorAlignment(w),z=-(P-.5)*l,G=-(k-.5)*g,X=p.evaluateVariableOffset(w,C);return new p.Point(z+X[0]*M,G+X[1]*M)}function vr(w,l,g,C,M){const P=new p.Point(w,l);return g&&P._rotate(C?M:-M),P}class Ui{constructor(l,g,C,M,P){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new Gl(this.transform,P),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new Wc(C),this.collisionCircleArrays={},this.prevPlacement=M,M&&(M.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,g,C,M){const P=C.getBucket(g),k=C.latestFeatureIndex;if(!P||!k||g.id!==P.layerIds[0])return;const z=P.layers[0].layout,G=C.collisionBoxArray,X=Math.pow(2,this.transform.zoom-C.tileID.overscaledZ),Z=C.tileSize/p.EXTENT,se=C.tileID.toUnwrapped();this.transform.setProjection(P.projection);const Ie=(ze=C.tileID,$e=P.getProjection(),je=this.transform,$e.name===this.projection?je.calculateProjMatrix(ze.toUnwrapped()):Ia(je,$e,ze));var ze,$e,je;const We="map"===z.get("text-pitch-alignment"),ue="map"===z.get("text-rotation-alignment");g.compileFilter();const Fe=g.dynamicFilter(),nt=g.dynamicFilterNeedsFeature(),Qe=this.transform.calculatePixelsToTileUnitsMatrix(C),Et=Wu(Ie,C.tileID.canonical,We,ue,this.transform,P.getProjection(),Qe);let St=null;if(We){const Rt=Ms(Ie,C.tileID.canonical,We,ue,this.transform,P.getProjection(),Qe);St=p.multiply([],this.transform.labelPlaneMatrix,Rt)}let at=null;Fe&&C.latestFeatureIndex&&(at={unwrappedTileID:se,dynamicFilter:Fe,dynamicFilterNeedsFeature:nt,featureIndex:C.latestFeatureIndex}),this.retainedQueryData[P.bucketInstanceId]=new Hn(P.bucketInstanceId,k,P.sourceLayerIndex,P.index,C.tileID);const Ot={bucket:P,layout:z,posMatrix:Ie,textLabelPlaneMatrix:Et,labelToScreenMatrix:St,clippingData:at,scale:X,textPixelRatio:Z,holdingForFade:C.holdingForFade(),collisionBoxArray:G,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(P.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(P.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(P.sourceID)};if(M)for(const Rt of P.sortKeyRanges){const{sortKey:kt,symbolInstanceStart:Dn,symbolInstanceEnd:Ut}=Rt;l.push({sortKey:kt,symbolInstanceStart:Dn,symbolInstanceEnd:Ut,parameters:Ot})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:P.symbolInstances.length,parameters:Ot})}attemptAnchorPlacement(l,g,C,M,P,k,z,G,X,Z,se,Ie,ze,$e,je,We,ue,Fe){const{textOffset0:nt,textOffset1:Qe,crossTileID:Et}=Ie,St=[nt,Qe],at=dr(l,C,M,St,P),Ot=this.collisionIndex.placeCollisionBox($e,P,g,vr(at.x,at.y,k,z,this.transform.angle),se,G,X,Z.predicate);if(We){const Rt=$e.getSymbolInstanceIconSize(Fe,this.transform.zoom,Ie.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox($e,Rt,We,vr(at.x,at.y,k,z,this.transform.angle),se,G,X,Z.predicate).box.length)return}if(Ot.box.length>0){let Rt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Et]&&this.prevPlacement.placements[Et]&&this.prevPlacement.placements[Et].text&&(Rt=this.prevPlacement.variableOffsets[Et].anchor),this.variableOffsets[Et]={textOffset:St,width:C,height:M,anchor:l,textScale:P,prevAnchor:Rt},this.markUsedJustification($e,l,Ie,je),$e.allowVerticalPlacement&&(this.markUsedOrientation($e,je,Ie),this.placedOrientations[Et]=je),{shift:at,placedGlyphBoxes:Ot}}}placeLayerBucketPart(l,g,C,M){const{bucket:P,layout:k,posMatrix:z,textLabelPlaneMatrix:G,labelToScreenMatrix:X,clippingData:Z,textPixelRatio:se,holdingForFade:Ie,collisionBoxArray:ze,partiallyEvaluatedTextSize:$e,partiallyEvaluatedIconSize:je,collisionGroup:We}=l.parameters,ue=k.get("text-optional"),Fe=k.get("icon-optional"),nt=k.get("text-allow-overlap"),Qe=k.get("icon-allow-overlap"),Et="map"===k.get("text-rotation-alignment"),St="map"===k.get("text-pitch-alignment"),at="none"!==k.get("icon-text-fit"),Ot="viewport-y"===k.get("symbol-z-order");this.transform.setProjection(P.projection);let Rt=nt&&(Qe||!P.hasIconData()||Fe),kt=Qe&&(nt||!P.hasTextData()||ue);!P.collisionArrays&&ze&&P.deserializeCollisionBoxes(ze),C&&M&&P.updateCollisionDebugBuffers(this.transform.zoom,ze);const Dn=(Ut,an,Ht)=>{const{crossTileID:gn,numVerticalGlyphVertices:Gt}=Ut;if(Z){const Ks={zoom:this.transform.zoom,pitch:this.transform.pitch};let Jo=null;if(Z.dynamicFilterNeedsFeature){const ln=this.retainedQueryData[P.bucketInstanceId];Jo=Z.featureIndex.loadFeature({featureIndex:Ut.featureIndex,bucketIndex:ln.bucketIndex,sourceLayerIndex:ln.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,Z.dynamicFilter)(Ks,Jo,this.retainedQueryData[P.bucketInstanceId].tileID.canonical,new p.Point(Ut.tileAnchorX,Ut.tileAnchorY),this.transform.calculateDistanceTileData(Z.unwrappedTileID)))return this.placements[gn]=new Il(!1,!1,!1,!0),void g.add(gn)}if(g.has(gn))return;if(Ie)return void(this.placements[gn]=new Il(!1,!1,!1));let fn=!1,En=!1,vn=!0,Ln=!1,wr=!1,Vr=null,or={box:null,offscreen:null,occluded:null},Ar={box:null,offscreen:null,occluded:null},Xn=null,ci=null,yr=null,bo=0,Ko=0,us=0;Ht.textFeatureIndex?bo=Ht.textFeatureIndex:Ut.useRuntimeCollisionCircles&&(bo=Ut.featureIndex),Ht.verticalTextFeatureIndex&&(Ko=Ht.verticalTextFeatureIndex);const ls=Ks=>{Ks.tileID=this.retainedQueryData[P.bucketInstanceId].tileID;const Jo=this.transform.elevation;(Jo||Ks.elevation)&&(Ks.elevation=Jo?Jo.getAtTileOffset(Ks.tileID,Ks.tileAnchorX,Ks.tileAnchorY):0)},Va=Ht.textBox;if(Va){ls(Va);const Ks=ln=>{let Wr=p.WritingMode.horizontal;if(P.allowVerticalPlacement&&!ln&&this.prevPlacement){const ol=this.prevPlacement.placedOrientations[gn];ol&&(this.placedOrientations[gn]=ol,Wr=ol,this.markUsedOrientation(P,Wr,Ut))}return Wr},Jo=(ln,Wr)=>{if(P.allowVerticalPlacement&&Gt>0&&Ht.verticalTextBox){for(const ol of P.writingModes)if(ol===p.WritingMode.vertical?(or=Wr(),Ar=or):or=ln(),or&&or.box&&or.box.length)break}else or=ln()};if(k.get("text-variable-anchor")){let ln=k.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[gn]){const vs=this.prevPlacement.variableOffsets[gn];ln.indexOf(vs.anchor)>0&&(ln=ln.filter(xs=>xs!==vs.anchor),ln.unshift(vs.anchor))}const Wr=(vs,xs,zf)=>{const gc=P.getSymbolInstanceTextSize($e,Ut,this.transform.zoom,an),Pl=(vs.x2-vs.x1)*gc+2*vs.padding,mc=(vs.y2-vs.y1)*gc+2*vs.padding,Zc=at&&!Qe?xs:null;Zc&&ls(Zc);let ph={box:[],offscreen:!1,occluded:!1};const Wd=nt?2*ln.length:ln.length;for(let jh=0;jh<Wd;++jh){const Uu=this.attemptAnchorPlacement(ln[jh%ln.length],vs,Pl,mc,gc,Et,St,se,z,We,jh>=ln.length,Ut,an,P,zf,Zc,$e,je);if(Uu&&(ph=Uu.placedGlyphBoxes,ph&&ph.box&&ph.box.length)){fn=!0,Vr=Uu.shift;break}}return ph};Jo(()=>Wr(Va,Ht.iconBox,p.WritingMode.horizontal),()=>{const vs=Ht.verticalTextBox;return vs&&ls(vs),P.allowVerticalPlacement&&!(or&&or.box&&or.box.length)&&Gt>0&&vs?Wr(vs,Ht.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),or&&(fn=or.box,vn=or.offscreen,Ln=or.occluded);const ol=Ks(!(!or||!or.box));if(!fn&&this.prevPlacement){const vs=this.prevPlacement.variableOffsets[gn];vs&&(this.variableOffsets[gn]=vs,this.markUsedJustification(P,vs.anchor,Ut,ol))}}else{const ln=(Wr,ol)=>{const vs=P.getSymbolInstanceTextSize($e,Ut,this.transform.zoom,an),xs=this.collisionIndex.placeCollisionBox(P,vs,Wr,new p.Point(0,0),nt,se,z,We.predicate);return xs&&xs.box&&xs.box.length&&(this.markUsedOrientation(P,ol,Ut),this.placedOrientations[gn]=ol),xs};Jo(()=>ln(Va,p.WritingMode.horizontal),()=>{const Wr=Ht.verticalTextBox;return P.allowVerticalPlacement&&Gt>0&&Wr?(ls(Wr),ln(Wr,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Ks(!!(or&&or.box&&or.box.length))}}if(Xn=or,fn=Xn&&Xn.box&&Xn.box.length>0,vn=Xn&&Xn.offscreen,Ln=Xn&&Xn.occluded,Ut.useRuntimeCollisionCircles){const Ks=P.text.placedSymbolArray.get(Ut.centerJustifiedTextSymbolIndex>=0?Ut.centerJustifiedTextSymbolIndex:Ut.verticalPlacedTextSymbolIndex),Jo=p.evaluateSizeForFeature(P.textSizeData,$e,Ks),ln=k.get("text-padding");ci=this.collisionIndex.placeCollisionCircles(P,nt,Ks,P.lineVertexArray,P.glyphOffsetArray,Jo,z,G,X,C,St,We.predicate,Ut.collisionCircleDiameter*Jo/p.ONE_EM,ln,this.retainedQueryData[P.bucketInstanceId].tileID),fn=nt||ci.circles.length>0&&!ci.collisionDetected,vn=vn&&ci.offscreen,Ln=ci.occluded}if(Ht.iconFeatureIndex&&(us=Ht.iconFeatureIndex),Ht.iconBox){const Ks=Jo=>{ls(Jo);const ln=at&&Vr?vr(Vr.x,Vr.y,Et,St,this.transform.angle):new p.Point(0,0),Wr=P.getSymbolInstanceIconSize(je,this.transform.zoom,Ut.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(P,Wr,Jo,ln,Qe,se,z,We.predicate)};Ar&&Ar.box&&Ar.box.length&&Ht.verticalIconBox?(yr=Ks(Ht.verticalIconBox),En=yr.box.length>0):(yr=Ks(Ht.iconBox),En=yr.box.length>0),vn=vn&&yr.offscreen,wr=yr.occluded}const Iu=ue||0===Ut.numHorizontalGlyphVertices&&0===Gt,Xl=Fe||0===Ut.numIconVertices;if(Iu||Xl?Xl?Iu||(En=En&&fn):fn=En&&fn:En=fn=En&&fn,fn&&Xn&&Xn.box&&this.collisionIndex.insertCollisionBox(Xn.box,k.get("text-ignore-placement"),P.bucketInstanceId,Ar&&Ar.box&&Ko?Ko:bo,We.ID),En&&yr&&this.collisionIndex.insertCollisionBox(yr.box,k.get("icon-ignore-placement"),P.bucketInstanceId,us,We.ID),ci&&(fn&&this.collisionIndex.insertCollisionCircles(ci.circles,k.get("text-ignore-placement"),P.bucketInstanceId,bo,We.ID),C)){const Ks=P.bucketInstanceId;let Jo=this.collisionCircleArrays[Ks];void 0===Jo&&(Jo=this.collisionCircleArrays[Ks]=new Ka);for(let ln=0;ln<ci.circles.length;ln+=4)Jo.circles.push(ci.circles[ln+0]),Jo.circles.push(ci.circles[ln+1]),Jo.circles.push(ci.circles[ln+2]),Jo.circles.push(ci.collisionDetected?1:0)}const pc="globe"!==P.projection.name;Rt=Rt&&(pc||!Ln),kt=kt&&(pc||!wr),this.placements[gn]=new Il(fn||Rt,En||kt,vn||P.justReloaded),g.add(gn)};if(Ot){const Ut=P.getSortedSymbolIndexes(this.transform.angle);for(let an=Ut.length-1;an>=0;--an){const Ht=Ut[an];Dn(P.symbolInstances.get(Ht),Ht,P.collisionArrays[Ht])}}else for(let Ut=l.symbolInstanceStart;Ut<l.symbolInstanceEnd;Ut++)Dn(P.symbolInstances.get(Ut),Ut,P.collisionArrays[Ut]);if(C&&P.bucketInstanceId in this.collisionCircleArrays){const Ut=this.collisionCircleArrays[P.bucketInstanceId];p.invert(Ut.invProjMatrix,z),Ut.viewportMatrix=this.collisionIndex.getViewportMatrix()}P.justReloaded=!1}markUsedJustification(l,g,C,M){const{leftJustifiedTextSymbolIndex:P,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:z,verticalPlacedTextSymbolIndex:G,crossTileID:X}=C,Z=p.getAnchorJustification(g),se=M===p.WritingMode.vertical?G:"left"===Z?P:"center"===Z?k:"right"===Z?z:-1;P>=0&&(l.text.placedSymbolArray.get(P).crossTileID=se>=0&&P!==se?0:X),k>=0&&(l.text.placedSymbolArray.get(k).crossTileID=se>=0&&k!==se?0:X),z>=0&&(l.text.placedSymbolArray.get(z).crossTileID=se>=0&&z!==se?0:X),G>=0&&(l.text.placedSymbolArray.get(G).crossTileID=se>=0&&G!==se?0:X)}markUsedOrientation(l,g,C){const M=g===p.WritingMode.horizontal||g===p.WritingMode.horizontalOnly?g:0,P=g===p.WritingMode.vertical?g:0,{leftJustifiedTextSymbolIndex:k,centerJustifiedTextSymbolIndex:z,rightJustifiedTextSymbolIndex:G,verticalPlacedTextSymbolIndex:X}=C,Z=l.text.placedSymbolArray;k>=0&&(Z.get(k).placedOrientation=M),z>=0&&(Z.get(z).placedOrientation=M),G>=0&&(Z.get(G).placedOrientation=M),X>=0&&(Z.get(X).placedOrientation=P)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const g=this.prevPlacement;let C=!1;this.prevZoomAdjustment=g?g.zoomAdjustment(this.transform.zoom):0;const M=g?g.symbolFadeChange(l):1,P=g?g.opacities:{},k=g?g.variableOffsets:{},z=g?g.placedOrientations:{};for(const G in this.placements){const X=this.placements[G],Z=P[G];Z?(this.opacities[G]=new Tn(Z,M,X.text,X.icon,null,X.clipped),C=C||X.text!==Z.text.placed||X.icon!==Z.icon.placed):(this.opacities[G]=new Tn(null,M,X.text,X.icon,X.skipFade,X.clipped),C=C||X.text||X.icon)}for(const G in P){const X=P[G];if(!this.opacities[G]){const Z=new Tn(X,M,!1,!1);Z.isHidden()||(this.opacities[G]=Z,C=C||X.text.placed||X.icon.placed)}}for(const G in k)this.variableOffsets[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.variableOffsets[G]=k[G]);for(const G in z)this.placedOrientations[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.placedOrientations[G]=z[G]);C?this.lastPlacementChangeTime=l:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=g?g.lastPlacementChangeTime:l)}updateLayerOpacities(l,g){const C=new Set;for(const M of g){const P=M.getBucket(l);P&&M.latestFeatureIndex&&l.id===P.layerIds[0]&&this.updateBucketOpacities(P,C,M.collisionBoxArray)}}updateBucketOpacities(l,g,C){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const M=l.layers[0].layout,P=!!l.layers[0].dynamicFilter(),k=new Tn(null,0,!1,!1,!0),z=M.get("text-allow-overlap"),G=M.get("icon-allow-overlap"),X=M.get("text-variable-anchor"),Z="map"===M.get("text-rotation-alignment"),se="map"===M.get("text-pitch-alignment"),Ie="none"!==M.get("icon-text-fit"),ze=new Tn(null,0,z&&(G||!l.hasIconData()||M.get("icon-optional")),G&&(z||!l.hasTextData()||M.get("text-optional")),!0);!l.collisionArrays&&C&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(C);const $e=(We,ue,Fe)=>{for(let nt=0;nt<ue/4;nt++)We.opacityVertexArray.emplaceBack(Fe)};let je=0;for(let We=0;We<l.symbolInstances.length;We++){const ue=l.symbolInstances.get(We),{numHorizontalGlyphVertices:Fe,numVerticalGlyphVertices:nt,crossTileID:Qe,numIconVertices:Et}=ue,St=g.has(Qe);let at=this.opacities[Qe];St?at=k:at||(at=ze,this.opacities[Qe]=at),g.add(Qe);const Ot=Fe>0||nt>0,Rt=Et>0,kt=this.placedOrientations[Qe],Dn=kt===p.WritingMode.vertical,Ut=kt===p.WritingMode.horizontal||kt===p.WritingMode.horizontalOnly;if(!Ot&&!Rt||at.isHidden()||je++,Ot){const an=ua(at.text);$e(l.text,Fe,Dn?As:an),$e(l.text,nt,Ut?As:an);const Ht=at.text.isHidden(),{leftJustifiedTextSymbolIndex:gn,centerJustifiedTextSymbolIndex:Gt,rightJustifiedTextSymbolIndex:fn,verticalPlacedTextSymbolIndex:En}=ue,vn=l.text.placedSymbolArray,Ln=Ht||Dn?1:0;gn>=0&&(vn.get(gn).hidden=Ln),Gt>=0&&(vn.get(Gt).hidden=Ln),fn>=0&&(vn.get(fn).hidden=Ln),En>=0&&(vn.get(En).hidden=Ht||Ut?1:0);const wr=this.variableOffsets[Qe];wr&&this.markUsedJustification(l,wr.anchor,ue,kt);const Vr=this.placedOrientations[Qe];Vr&&(this.markUsedJustification(l,"left",ue,Vr),this.markUsedOrientation(l,Vr,ue))}if(Rt){const an=ua(at.icon),{placedIconSymbolIndex:Ht,verticalPlacedIconSymbolIndex:gn}=ue,Gt=l.icon.placedSymbolArray,fn=at.icon.isHidden()?1:0;Ht>=0&&($e(l.icon,Et,Dn?As:an),Gt.get(Ht).hidden=fn),gn>=0&&($e(l.icon,ue.numVerticalIconVertices,Ut?As:an),Gt.get(gn).hidden=fn)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const an=l.collisionArrays[We];if(an){let Ht=new p.Point(0,0),gn=!0;if(an.textBox||an.verticalTextBox){if(X){const fn=this.variableOffsets[Qe];fn?(Ht=dr(fn.anchor,fn.width,fn.height,fn.textOffset,fn.textScale),Z&&Ht._rotate(se?this.transform.angle:-this.transform.angle)):gn=!1}P&&(gn=!at.clipped),an.textBox&&rs(l.textCollisionBox.collisionVertexArray,at.text.placed,!gn||Dn,Ht.x,Ht.y),an.verticalTextBox&&rs(l.textCollisionBox.collisionVertexArray,at.text.placed,!gn||Ut,Ht.x,Ht.y)}const Gt=gn&&!(Ut||!an.verticalIconBox);an.iconBox&&rs(l.iconCollisionBox.collisionVertexArray,at.icon.placed,Gt,Ie?Ht.x:0,Ie?Ht.y:0),an.verticalIconBox&&rs(l.iconCollisionBox.collisionVertexArray,at.icon.placed,!Gt,Ie?Ht.x:0,Ie?Ht.y:0)}}}if(l.fullyClipped=0===je,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const We=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=We.invProjMatrix,l.placementViewportMatrix=We.viewportMatrix,l.collisionCircleArray=We.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return 0===this.fadeDuration?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,g){const C=this.zoomAtLastRecencyCheck===g?1-this.zoomAdjustment(g):1;return this.zoomAtLastRecencyCheck=g,this.commitTime+this.fadeDuration*C>l}setStale(){this.stale=!0}}function rs(w,l,g,C,M){w.emplaceBack(l?1:0,g?1:0,C||0,M||0),w.emplaceBack(l?1:0,g?1:0,C||0,M||0),w.emplaceBack(l?1:0,g?1:0,C||0,M||0),w.emplaceBack(l?1:0,g?1:0,C||0,M||0)}const Zu=Math.pow(2,25),zs=Math.pow(2,24),is=Math.pow(2,17),kh=Math.pow(2,16),Us=Math.pow(2,9),Ti=Math.pow(2,8),gl=Math.pow(2,1);function ua(w){if(0===w.opacity&&!w.placed)return 0;if(1===w.opacity&&w.placed)return 4294967295;const l=w.placed?1:0,g=Math.floor(127*w.opacity);return g*Zu+l*zs+g*is+l*kh+g*Us+l*Ti+g*gl+l}const As=0;class Rc{constructor(l){this._sortAcrossTiles="viewport-y"!==l.layout.get("symbol-z-order")&&void 0!==l.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,g,C,M,P){const k=this._bucketParts;for(;this._currentTileIndex<l.length;)if(g.getBucketParts(k,M,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,P())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,k.sort((z,G)=>z.sortKey-G.sortKey));this._currentPartIndex<k.length;){const z=k[this._currentPartIndex];if(g.placeLayerBucketPart(z,this._seenCrossTileIDs,C,0===z.symbolInstanceStart),this._currentPartIndex++,P())return!0}return!1}}class ys{constructor(l,g,C,M,P,k,z,G){this.placement=new Ui(l,P,k,z,G),this._currentPlacementIndex=g.length-1,this._forceFullPlacement=C,this._showCollisionBoxes=M,this._done=!1}isDone(){return this._done}continuePlacement(l,g,C){const M=p.exported.now(),P=()=>{const k=p.exported.now()-M;return!this._forceFullPlacement&&k>2};for(;this._currentPlacementIndex>=0;){const k=g[l[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if("symbol"===k.type&&(!k.minzoom||k.minzoom<=z)&&(!k.maxzoom||k.maxzoom>z)){if(this._inProgressLayer||(this._inProgressLayer=new Rc(k)),this._inProgressLayer.continuePlacement(C[k.source],this.placement,this._showCollisionBoxes,k,P))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const la=512/p.EXTENT/2;class va{constructor(l,g,C){this.tileID=l,this.bucketInstanceId=C,this.index=new p.KDBush(g.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const M=l.canonical.x*p.EXTENT,P=l.canonical.y*p.EXTENT;for(let k=0;k<g.length;k++){const{key:z,crossTileID:G,tileAnchorX:X,tileAnchorY:Z}=g.get(k),se=Math.floor((M+X)*la),Ie=Math.floor((P+Z)*la);this.index.add(se,Ie),this.keys.push(z),this.crossTileIDs.push(G)}this.index.finish()}findMatches(l,g,C){const M=this.tileID.canonical.z<g.canonical.z?1:Math.pow(2,this.tileID.canonical.z-g.canonical.z),P=la/Math.pow(2,g.canonical.z-this.tileID.canonical.z),k=g.canonical.x*p.EXTENT,z=g.canonical.y*p.EXTENT;for(let G=0;G<l.length;G++){const X=l.get(G);if(X.crossTileID)continue;const{key:Z,tileAnchorX:se,tileAnchorY:Ie}=X,ze=Math.floor((k+se)*P),$e=Math.floor((z+Ie)*P),je=this.index.range(ze-M,$e-M,ze+M,$e+M);for(const We of je){const ue=this.crossTileIDs[We];if(this.keys[We]===Z&&!C.has(ue)){C.add(ue),X.crossTileID=ue;break}}}}}class Pu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ji{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const g=Math.round((l-this.lng)/360);if(0!==g)for(const C in this.indexes){const M=this.indexes[C],P={};for(const k in M){const z=M[k];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+g),P[z.tileID.key]=z}this.indexes[C]=P}this.lng=l}addBucket(l,g,C){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===g.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let P=0;P<g.symbolInstances.length;P++)g.symbolInstances.get(P).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const M=this.usedCrossTileIDs[l.overscaledZ];for(const P in this.indexes){const k=this.indexes[P];if(Number(P)>l.overscaledZ)for(const z in k){const G=k[z];G.tileID.isChildOf(l)&&G.findMatches(g.symbolInstances,l,M)}else{const z=k[l.scaledTo(Number(P)).key];z&&z.findMatches(g.symbolInstances,l,M)}}for(let P=0;P<g.symbolInstances.length;P++){const k=g.symbolInstances.get(P);k.crossTileID||(k.crossTileID=C.generate(),M.add(k.crossTileID))}return void 0===this.indexes[l.overscaledZ]&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new va(l,g.symbolInstances,g.bucketInstanceId),!0}removeBucketCrossTileIDs(l,g){for(const C of g.crossTileIDs)this.usedCrossTileIDs[l].delete(C)}removeStaleBuckets(l){let g=!1;for(const C in this.indexes){const M=this.indexes[C];for(const P in M)l[M[P].bucketInstanceId]||(this.removeBucketCrossTileIDs(C,M[P]),delete M[P],g=!0)}return g}}class Hr{constructor(){this.layerIndexes={},this.crossTileIDs=new Pu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,g,C,M){let P=this.layerIndexes[l.id];void 0===P&&(P=this.layerIndexes[l.id]=new Ji);let k=!1;const z={};"globe"!==M.name&&P.handleWrapJump(C);for(const G of g){const X=G.getBucket(l);X&&l.id===X.layerIds[0]&&(X.bucketInstanceId||(X.bucketInstanceId=++this.maxBucketInstanceId),P.addBucket(G.tileID,X,this.crossTileIDs)&&(k=!0),z[X.bucketInstanceId]=!0)}return P.removeStaleBuckets(z)&&(k=!0),k}pruneUnusedLayers(l){const g={};l.forEach(C=>{g[C]=!0});for(const C in this.layerIndexes)g[C]||delete this.layerIndexes[C]}}const Mi=(w,l)=>p.emitValidationErrors(w,l&&l.filter(g=>"source.canvas"!==g.identifier)),Vs=p.pick(Br,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Gp=p.pick(Br,["setCenter","setZoom","setBearing","setPitch"]),Yu={version:8,layers:[],sources:{}},sr={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class os extends p.Evented{constructor(l,g={}){super(),this.map=l,this.dispatcher=new Ue(pl(),this),this.imageManager=new re,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(l._requestManager,g.localFontFamily?p.LocalGlyphMode.all:g.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,g.localFontFamily||g.localIdeographFontFamily),this.crossTileSymbolIndex=new Hr,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const C=this;this._rtlTextPluginCallback=os.registerForPluginStateChange(M=>{C.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:M.pluginStatus,pluginURL:M.pluginURL},(P,k)=>{if(p.triggerPluginCompletionEvent(P),k&&k.every(z=>z))for(const z in C._sourceCaches){const G=C._sourceCaches[z],X=G.getSource().type;"vector"!==X&&"geojson"!==X||G.reload()}})}),this.on("data",M=>{if("source"!==M.dataType||"metadata"!==M.sourceDataType)return;const P=this.getSource(M.sourceId);if(P&&P.vectorLayerIds)for(const k in this._layers){const z=this._layers[k];z.source===P.id&&this._validateLayer(z)}})}loadURL(l,g={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const C="boolean"==typeof g.validate?g.validate:!p.isMapboxURL(l);l=this.map._requestManager.normalizeStyleURL(l,g.accessToken);const M=this.map._requestManager.transformRequest(l,p.ResourceType.Style);this._request=p.getJSON(M,(P,k)=>{this._request=null,P?this.fire(new p.ErrorEvent(P)):k&&this._load(k,C)})}loadJSON(l,g={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(l,!1!==g.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Yu,!1)}_updateLayerCount(l,g){const C=g?1:-1;l.is3D()&&(this._num3DLayers+=C),"circle"===l.type&&(this._numCircleLayers+=C),"symbol"===l.type&&(this._numSymbolLayers+=C)}_load(l,g){if(g&&Mi(this,p.validateStyle(l)))return;this._loaded=!0,this.stylesheet=p.clone$1(l),this._updateMapProjection();for(const M in l.sources)this.addSource(M,l.sources[M],{validate:!1});this._changed=!1,l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(l.glyphs);const C=uc(this.stylesheet.layers);this._order=C.map(M=>M.id),this._layers={},this._serializedLayers={};for(const M of C){const P=p.createStyleLayer(M);P.setEventedParent(this,{layer:{id:P.id}}),this._layers[P.id]=P,this._serializedLayers[P.id]=P.serialize(),this._updateLayerCount(P,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new He(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(l){this._spriteRequest=function(g,C,M){let P,k,z;const G=p.exported.devicePixelRatio>1?"@2x":"";let X=p.getJSON(C.transformRequest(C.normalizeSpriteURL(g,G,".json"),p.ResourceType.SpriteJSON),(Ie,ze)=>{X=null,z||(z=Ie,P=ze,se())}),Z=p.getImage(C.transformRequest(C.normalizeSpriteURL(g,G,".png"),p.ResourceType.SpriteImage),(Ie,ze)=>{Z=null,z||(z=Ie,k=ze,se())});function se(){if(z)M(z);else if(P&&k){const Ie=p.exported.getImageData(k),ze={};for(const $e in P){const{width:je,height:We,x:ue,y:Fe,sdf:nt,pixelRatio:Qe,stretchX:Et,stretchY:St,content:at}=P[$e],Ot=new p.RGBAImage({width:je,height:We});p.RGBAImage.copy(Ie,Ot,{x:ue,y:Fe},{x:0,y:0},{width:je,height:We}),ze[$e]={data:Ot,pixelRatio:Qe,sdf:nt,stretchX:Et,stretchY:St,content:at}}M(null,ze)}}return{cancel(){X&&(X.cancel(),X=null),Z&&(Z.cancel(),Z=null)}}}(l,this.map._requestManager,(g,C)=>{if(this._spriteRequest=null,g)this.fire(new p.ErrorEvent(g));else if(C)for(const M in C)this.imageManager.addImage(M,C[M]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(l){const g=this.getSource(l.source);if(!g)return;const C=l.sourceLayer;C&&("geojson"===g.type||g.vectorLayerIds&&-1===g.vectorLayerIds.indexOf(C))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${C}" does not exist on source "${g.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(l){const g=[];for(const C of l){const M=this._layers[C];"custom"!==M.type&&g.push(M.serialize())}return g}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(l){return!!this.terrain&&("function"==typeof l.isLayerDraped?l.isLayerDraped():sr[l.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(l){if(!this._loaded)return;const g=this._changed;if(this._changed){const M=Object.keys(this._updatedLayers),P=Object.keys(this._removedLayers);(M.length||P.length)&&this._updateWorkerLayers(M,P);for(const k in this._updatedSources){const z=this._updatedSources[k];"reload"===z?this._reloadSource(k):"clear"===z&&this._clearSource(k)}this._updateTilesForChangedImages();for(const k in this._updatedPaintProps)this._layers[k].updateTransitions(l);this.light.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._resetUpdates()}const C={};for(const M in this._sourceCaches){const P=this._sourceCaches[M];C[M]=P.used,P.used=!1}for(const M of this._order){const P=this._layers[M];if(P.recalculate(l,this._availableImages),!P.isHidden(l.zoom)){const z=this._getLayerSourceCache(P);z&&(z.used=!0)}const k=this.map.painter;if(k){const z=P.getProgramIds();if(!z)continue;const G=P.getProgramConfiguration(l.zoom);for(const X of z)k.useProgram(X,G)}}for(const M in C){const P=this._sourceCaches[M];C[M]!==P.used&&P.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:P.getSource().id}))}this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const g in this._sourceCaches)this._sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateWorkerLayers(l,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(l),removedIds:g})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(l){if(this._checkLoaded(),Mi(this,p.validateStyle(l)))return!1;(l=p.clone$1(l)).layers=uc(l.layers);const g=function(M,P){if(!M)return[{command:Br.setStyle,args:[P]}];let k=[];try{if(!J(M.version,P.version))return[{command:Br.setStyle,args:[P]}];J(M.center,P.center)||k.push({command:Br.setCenter,args:[P.center]}),J(M.zoom,P.zoom)||k.push({command:Br.setZoom,args:[P.zoom]}),J(M.bearing,P.bearing)||k.push({command:Br.setBearing,args:[P.bearing]}),J(M.pitch,P.pitch)||k.push({command:Br.setPitch,args:[P.pitch]}),J(M.sprite,P.sprite)||k.push({command:Br.setSprite,args:[P.sprite]}),J(M.glyphs,P.glyphs)||k.push({command:Br.setGlyphs,args:[P.glyphs]}),J(M.transition,P.transition)||k.push({command:Br.setTransition,args:[P.transition]}),J(M.light,P.light)||k.push({command:Br.setLight,args:[P.light]}),J(M.fog,P.fog)||k.push({command:Br.setFog,args:[P.fog]}),J(M.projection,P.projection)||k.push({command:Br.setProjection,args:[P.projection]});const z={},G=[];!function(se,Ie,ze,$e){let je;for(je in Ie=Ie||{},se=se||{})se.hasOwnProperty(je)&&(Ie.hasOwnProperty(je)||ns(je,ze,$e));for(je in Ie){if(!Ie.hasOwnProperty(je))continue;const We=Ie[je];se.hasOwnProperty(je)?J(se[je],We)||("geojson"===se[je].type&&"geojson"===We.type&&lc(se,Ie,je)?ze.push({command:Br.setGeoJSONSourceData,args:[je,We.data]}):ps(je,Ie,ze,$e)):Lf(je,Ie,ze)}}(M.sources,P.sources,G,z);const X=[];M.layers&&M.layers.forEach(se=>{se.source&&z[se.source]?k.push({command:Br.removeLayer,args:[se.id]}):X.push(se)});let Z=M.terrain;Z&&z[Z.source]&&(k.push({command:Br.setTerrain,args:[void 0]}),Z=void 0),k=k.concat(G),J(Z,P.terrain)||k.push({command:Br.setTerrain,args:[P.terrain]}),function(se,Ie,ze){Ie=Ie||[];const $e=(se=se||[]).map(_a),je=Ie.map(_a),We=se.reduce(ms,{}),ue=Ie.reduce(ms,{}),Fe=$e.slice(),nt=Object.create(null);let Qe,Et,St,at,Ot,Rt,kt;for(Qe=0,Et=0;Qe<$e.length;Qe++)St=$e[Qe],ue.hasOwnProperty(St)?Et++:(ze.push({command:Br.removeLayer,args:[St]}),Fe.splice(Fe.indexOf(St,Et),1));for(Qe=0,Et=0;Qe<je.length;Qe++)St=je[je.length-1-Qe],Fe[Fe.length-1-Qe]!==St&&(We.hasOwnProperty(St)?(ze.push({command:Br.removeLayer,args:[St]}),Fe.splice(Fe.lastIndexOf(St,Fe.length-Et),1)):Et++,Rt=Fe[Fe.length-Qe],ze.push({command:Br.addLayer,args:[ue[St],Rt]}),Fe.splice(Fe.length-Qe,0,St),nt[St]=!0);for(Qe=0;Qe<je.length;Qe++)if(St=je[Qe],at=We[St],Ot=ue[St],!nt[St]&&!J(at,Ot))if(J(at.source,Ot.source)&&J(at["source-layer"],Ot["source-layer"])&&J(at.type,Ot.type)){for(kt in gs(at.layout,Ot.layout,ze,St,null,Br.setLayoutProperty),gs(at.paint,Ot.paint,ze,St,null,Br.setPaintProperty),J(at.filter,Ot.filter)||ze.push({command:Br.setFilter,args:[St,Ot.filter]}),J(at.minzoom,Ot.minzoom)&&J(at.maxzoom,Ot.maxzoom)||ze.push({command:Br.setLayerZoomRange,args:[St,Ot.minzoom,Ot.maxzoom]}),at)at.hasOwnProperty(kt)&&"layout"!==kt&&"paint"!==kt&&"filter"!==kt&&"metadata"!==kt&&"minzoom"!==kt&&"maxzoom"!==kt&&(0===kt.indexOf("paint.")?gs(at[kt],Ot[kt],ze,St,kt.slice(6),Br.setPaintProperty):J(at[kt],Ot[kt])||ze.push({command:Br.setLayerProperty,args:[St,kt,Ot[kt]]}));for(kt in Ot)Ot.hasOwnProperty(kt)&&!at.hasOwnProperty(kt)&&"layout"!==kt&&"paint"!==kt&&"filter"!==kt&&"metadata"!==kt&&"minzoom"!==kt&&"maxzoom"!==kt&&(0===kt.indexOf("paint.")?gs(at[kt],Ot[kt],ze,St,kt.slice(6),Br.setPaintProperty):J(at[kt],Ot[kt])||ze.push({command:Br.setLayerProperty,args:[St,kt,Ot[kt]]}))}else ze.push({command:Br.removeLayer,args:[St]}),Rt=Fe[Fe.lastIndexOf(St)+1],ze.push({command:Br.addLayer,args:[Ot,Rt]})}(X,P.layers,k)}catch(z){console.warn("Unable to compute style diff:",z),k=[{command:Br.setStyle,args:[P]}]}return k}(this.serialize(),l).filter(M=>!(M.command in Gp));if(0===g.length)return!1;const C=g.filter(M=>!(M.command in Vs));if(C.length>0)throw new Error(`Unimplemented: ${C.map(M=>M.command).join(", ")}.`);return g.forEach(M=>{"setTransition"!==M.command&&"setProjection"!==M.command&&this[M.command].apply(this,M.args)}),this.stylesheet=l,this._updateMapProjection(),!0}addImage(l,g){return this.getImage(l)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,g),this._afterImageUpdated(l),this)}updateImage(l,g){this.imageManager.updateImage(l,g)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l),this._afterImageUpdated(l),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(l,g,C={}){if(this._checkLoaded(),void 0!==this.getSource(l))throw new Error("There is already a source with this ID");if(!g.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(g).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(p.validateSource,`sources.${l}`,g,null,C))return;this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);const M=Cr(l,g,this.dispatcher,this);M.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(l),source:M.serialize(),sourceId:l}));const P=k=>{const z=(k?"symbol:":"other:")+l,G=this._sourceCaches[z]=new p.SourceCache(z,M,k);(k?this._symbolSourceCaches:this._otherSourceCaches)[l]=G,G.style=this,G.onAdd(this.map)};P(!1),"vector"!==g.type&&"geojson"!==g.type||P(!0),M.onAdd&&M.onAdd(this.map),this._changed=!0}removeSource(l){this._checkLoaded();const g=this.getSource(l);if(!g)throw new Error("There is no source with this ID");for(const M in this._layers)if(this._layers[M].source===l)return this.fire(new p.ErrorEvent(new Error(`Source "${l}" cannot be removed while layer "${M}" is using it.`)));if(this.terrain&&this.terrain.get().source===l)return this.fire(new p.ErrorEvent(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const C=this._getSourceCaches(l);for(const M of C)delete this._sourceCaches[M.id],delete this._updatedSources[M.id],M.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:M.getSource().id})),M.setEventedParent(null),M.clearTiles();return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],g.setEventedParent(null),g.onRemove&&g.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(l,g){this._checkLoaded(),this.getSource(l).setData(g),this._changed=!0}getSource(l){const g=this._getSourceCache(l);return g&&g.getSource()}_getSources(){const l=[];for(const g in this._otherSourceCaches){const C=this._getSourceCache(g);C&&l.push(C.getSource())}return l}addLayer(l,g,C={}){this._checkLoaded();const M=l.id;if(this.getLayer(M))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${M}" already exists on this map`)));let P;if("custom"===l.type){if(Mi(this,p.validateCustomStyleLayer(l)))return;P=p.createStyleLayer(l)}else{if("object"==typeof l.source&&(this.addSource(M,l.source),l=p.clone$1(l),l=p.extend(l,{source:M})),this._validate(p.validateLayer,`layers.${M}`,l,{arrayIndex:-1},C))return;P=p.createStyleLayer(l),this._validateLayer(P),P.setEventedParent(this,{layer:{id:M}}),this._serializedLayers[P.id]=P.serialize(),this._updateLayerCount(P,!0)}const k=g?this._order.indexOf(g):this._order.length;if(g&&-1===k)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${g}" does not exist on this map.`)));this._order.splice(k,0,M),this._layerOrderChanged=!0,this._layers[M]=P;const z=this._getLayerSourceCache(P);if(this._removedLayers[M]&&P.source&&z&&"custom"!==P.type){const G=this._removedLayers[M];delete this._removedLayers[M],G.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",z.pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(l,g){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===g)return;const C=this._order.indexOf(l);this._order.splice(C,1);const M=g?this._order.indexOf(g):this._order.length;g&&-1===M?this.fire(new p.ErrorEvent(new Error(`Layer with id "${g}" does not exist on this map.`))):(this._order.splice(M,0,l),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(l){this._checkLoaded();const g=this._layers[l];if(!g)return void this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be removed.`)));g.setEventedParent(null),this._updateLayerCount(g,!1);const C=this._order.indexOf(l);this._order.splice(C,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=g,delete this._layers[l],delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],g.onRemove&&g.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(l){return this._layers[l]}hasLayer(l){return l in this._layers}hasLayerType(l){for(const g in this._layers)if(this._layers[g].type===l)return!0;return!1}setLayerZoomRange(l,g,C){this._checkLoaded();const M=this.getLayer(l);M?M.minzoom===g&&M.maxzoom===C||(null!=g&&(M.minzoom=g),null!=C&&(M.maxzoom=C),this._updateLayer(M)):this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(l,g,C={}){this._checkLoaded();const M=this.getLayer(l);if(M){if(!J(M.filter,g))return null==g?(M.filter=void 0,void this._updateLayer(M)):void(this._validate(p.validateFilter,`layers.${M.id}.filter`,g,{layerType:M.type},C)||(M.filter=p.clone$1(g),this._updateLayer(M)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be filtered.`)))}getFilter(l){const g=this.getLayer(l);return g&&p.clone$1(g.filter)}setLayoutProperty(l,g,C,M={}){this._checkLoaded();const P=this.getLayer(l);P?J(P.getLayoutProperty(g),C)||(P.setLayoutProperty(g,C,M),this._updateLayer(P)):this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(l,g){const C=this.getLayer(l);if(C)return C.getLayoutProperty(g);this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style.`)))}setPaintProperty(l,g,C,M={}){this._checkLoaded();const P=this.getLayer(l);P?J(P.getPaintProperty(g),C)||(P.setPaintProperty(g,C,M)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(l,g){const C=this.getLayer(l);return C&&C.getPaintProperty(g)}setFeatureState(l,g){this._checkLoaded();const C=l.source,M=l.sourceLayer,P=this.getSource(C);if(!P)return void this.fire(new p.ErrorEvent(new Error(`The source '${C}' does not exist in the map's style.`)));const k=P.type;if("geojson"===k&&M)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===k&&!M)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===l.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const z=this._getSourceCaches(C);for(const G of z)G.setFeatureState(M,l.id,g)}removeFeatureState(l,g){this._checkLoaded();const C=l.source,M=this.getSource(C);if(!M)return void this.fire(new p.ErrorEvent(new Error(`The source '${C}' does not exist in the map's style.`)));const P=M.type,k="vector"===P?l.sourceLayer:void 0;if("vector"===P&&!k)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(g&&"string"!=typeof l.id&&"number"!=typeof l.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const z=this._getSourceCaches(C);for(const G of z)G.removeFeatureState(k,l.id,g)}getFeatureState(l){this._checkLoaded();const g=l.source,C=l.sourceLayer,M=this.getSource(g);if(M){if("vector"!==M.type||C)return void 0===l.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(g)[0].getFeatureState(C,l.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const l={};for(const g in this._sourceCaches){const C=this._sourceCaches[g].getSource();l[C.id]||(l[C.id]=C.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:l,layers:this._serializeLayers(this._order)},g=>void 0!==g)}_updateLayer(l){this._updatedLayers[l.id]=!0;const g=this._getLayerSourceCache(l);l.source&&!this._updatedSources[l.source]&&g&&"raster"!==g.getSource().type&&(this._updatedSources[l.source]="reload",g.pause()),this._changed=!0,l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const g=k=>"fill-extrusion"===this._layers[k].type,C={},M=[];for(let k=this._order.length-1;k>=0;k--){const z=this._order[k];if(g(z)){C[z]=k;for(const G of l){const X=G[z];if(X)for(const Z of X)M.push(Z)}}}M.sort((k,z)=>z.intersectionZ-k.intersectionZ);const P=[];for(let k=this._order.length-1;k>=0;k--){const z=this._order[k];if(g(z))for(let G=M.length-1;G>=0;G--){const X=M[G].feature;if(C[X.layer.id]<k)break;P.push(X),M.pop()}else for(const G of l){const X=G[z];if(X)for(const Z of X)P.push(Z.feature)}}return P}queryRenderedFeatures(l,g,C){g&&g.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",g.filter,null,g);const M={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const G of g.layers){const X=this._layers[G];if(!X)return this.fire(new p.ErrorEvent(new Error(`The layer '${G}' does not exist in the map's style and cannot be queried for features.`))),[];M[X.source]=!0}}const P=[];g.availableImages=this._availableImages;const k=g&&g.layers?g.layers.some(G=>{const X=this.getLayer(G);return X&&X.is3D()}):this.has3DLayers(),z=Tt.createFromScreenPoints(l,C);for(const G in this._sourceCaches){const X=this._sourceCaches[G].getSource().id;g.layers&&!M[X]||P.push(fs(this._sourceCaches[G],this._layers,this._serializedLayers,z,g,C,k,!!this.map._showQueryGeometry))}return this.placement&&P.push(function(G,X,Z,se,Ie,ze,$e){const je={},We=ze.queryRenderedSymbols(se),ue=[];for(const Fe of Object.keys(We).map(Number))ue.push($e[Fe]);ue.sort(Xr);for(const Fe of ue){const nt=Fe.featureIndex.lookupSymbolFeatures(We[Fe.bucketInstanceId],X,Fe.bucketIndex,Fe.sourceLayerIndex,Ie.filter,Ie.layers,Ie.availableImages,G);for(const Qe in nt){const Et=je[Qe]=je[Qe]||[],St=nt[Qe];St.sort((at,Ot)=>{const Rt=Fe.featureSortOrder;if(Rt){const kt=Rt.indexOf(at.featureIndex);return Rt.indexOf(Ot.featureIndex)-kt}return Ot.featureIndex-at.featureIndex});for(const at of St)Et.push(at)}}for(const Fe in je)je[Fe].forEach(nt=>{const Qe=nt.feature,Et=Z(G[Fe]);if(!Et)return;const St=Et.getFeatureState(Qe.layer["source-layer"],Qe.id);Qe.source=Qe.layer.source,Qe.layer["source-layer"]&&(Qe.sourceLayer=Qe.layer["source-layer"]),Qe.state=St});return je}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),z.screenGeometry,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(P)}querySourceFeatures(l,g){g&&g.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",g.filter,null,g);const C=this._getSourceCaches(l);let M=[];for(const P of C)M=M.concat(ds(P,g));return M}addSourceType(l,g,C){return os.getSourceType(l)?C(new Error(`A source type called "${l}" already exists.`)):(os.setSourceType(l,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:g.workerSourceURL},C):C(null,null))}getLight(){return this.light.getLight()}setLight(l,g={}){this._checkLoaded();const C=this.light.getLight();let M=!1;for(const k in l)if(!J(l[k],C[k])){M=!0;break}if(!M)return;const P=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(l,g),this.light.updateTransitions(P)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(l,g=1){if(this._checkLoaded(),!l)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let C=l;if(1===g){if("object"==typeof C.source){const M="terrain-dem-src";this.addSource(M,C.source),C=p.clone$1(C),C=p.extend(C,{source:M})}if(this._validate(p.validateTerrain,"terrain",C))return}if(!this.terrain||this.terrain&&g!==this.terrain.drapeRenderMode){if(!C)return;this._createTerrain(C,g)}else{const M=this.terrain,P=M.get();for(const k of Object.keys(p.spec.terrain))!C.hasOwnProperty(k)&&p.spec.terrain[k].default&&(C[k]=p.spec.terrain[k].default);for(const k in C)if(!J(C[k],P[k])){M.set(C),this.stylesheet.terrain=C;const z=this._setTransitionParameters({duration:0});M.updateTransitions(z);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const g=this.fog=new bt(l,this.map.transform);this.stylesheet.fog=l;const C=this._setTransitionParameters({duration:0});g.updateTransitions(C)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const g=this.fog,C=g.get();0===Object.keys(l).length&&g.set(l);for(const M in l)if(!J(l[M],C[M])){g.set(l),this.stylesheet.fog=l;const P=this._setTransitionParameters({duration:0});g.updateTransitions(P);break}}else this._createFog(l);this._markersNeedUpdate=!0}_setTransitionParameters(l){return{now:p.exported.now(),transition:p.extend(l,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const l=this._order.filter(C=>this.isLayerDraped(this._layers[C])),g=this._order.filter(C=>!this.isLayerDraped(this._layers[C]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...g)}_createTerrain(l,g){const C=this.terrain=new Ne(l,g);this.stylesheet.terrain=l,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const M=this._setTransitionParameters({duration:0});C.updateTransitions(M)}_force3DLayerUpdate(){for(const l in this._layers){const g=this._layers[l];"fill-extrusion"===g.type&&this._updateLayer(g)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const g=this._layers[l];"symbol"===g.type&&this._updateLayer(g)}}_validate(l,g,C,M,P={}){return(!P||!1!==P.validate)&&Mi(this,l.call(p.validateStyle,p.extend({key:g,style:this.serialize(),value:C,styleSpec:p.spec},M)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this._sourceCaches)this._sourceCaches[l].clearTiles(),this._sourceCaches[l].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(l){const g=this._getSourceCaches(l);for(const C of g)C.clearTiles()}_reloadSource(l){const g=this._getSourceCaches(l);for(const C of g)C.resume(),C.reload()}_reloadSources(){for(const l of this._getSources())l.reload&&l.reload()}_updateSources(l){for(const g in this._sourceCaches)this._sourceCaches[g].update(l)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const g=this._sourceCaches[l];g.resume(),g.reload()}}_updatePlacement(l,g,C,M,P=!1){let k=!1,z=!1;const G={};for(const X of this._order){const Z=this._layers[X];if("symbol"!==Z.type)continue;if(!G[Z.source]){const Ie=this._getLayerSourceCache(Z);if(!Ie)continue;G[Z.source]=Ie.getRenderableIds(!0).map(ze=>Ie.getTileByID(ze)).sort((ze,$e)=>$e.tileID.overscaledZ-ze.tileID.overscaledZ||(ze.tileID.isLessThan($e.tileID)?-1:1))}const se=this.crossTileSymbolIndex.addLayer(Z,G[Z.source],l.center.lng,l.projection);k=k||se}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),P=P||this._layerOrderChanged||0===C,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(P||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),l.zoom))&&(this.pauseablePlacement=new ys(l,this._order,P,g,C,M,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,G),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),z=!0),k&&this.pauseablePlacement.placement.setStale()),z||k)for(const X of this._order){const Z=this._layers[X];"symbol"===Z.type&&this.placement.updateLayerOpacities(Z,G[Z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,g,C){this.imageManager.getImages(g.icons,C),this._updateTilesForChangedImages();const M=P=>{P&&P.setDependencies(g.tileID.key,g.type,g.icons)};M(this._otherSourceCaches[g.source]),M(this._symbolSourceCaches[g.source])}getGlyphs(l,g,C){this.glyphManager.getGlyphs(g.stacks,C)}getResource(l,g,C){return p.makeRequest(g,C)}_getSourceCache(l){return this._otherSourceCaches[l]}_getLayerSourceCache(l){return"symbol"===l.type?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}_getSourceCaches(l){const g=[];return this._otherSourceCaches[l]&&g.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&g.push(this._symbolSourceCaches[l]),g}_isSourceCacheLoaded(l){const g=this._getSourceCaches(l);return 0===g.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${l}'`))),!1):g.every(C=>C.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}os.getSourceType=function(w){return Yr[w]},os.setSourceType=function(w,l){Yr[w]=l},os.registerForPluginStateChange=p.registerForPluginStateChange;var Ku="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",cc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Zo="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Xc="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Ju="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let ca={},ka={};const Qi=[];hr(Ku,Qi),hr(Zo,Qi),hr(Xc,Qi),hr(Ju,Qi),ca=ii("",Zo),ka=ii(Ju,Xc);const hc=ii("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Ru=Ku,Rr="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Yo={background:ii("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:ii("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:ii("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:ii("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ii("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:ii("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ii("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ii("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ii("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:ii("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:ii("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:ii("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:ii("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:ii("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:ii("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:ii("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ii("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:ii("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:ii("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:ii("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:ii("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:ii("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:ii("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:ii("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:ii("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ii("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",cc),skyboxGradient:ii("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",cc),skyboxCapture:ii("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ii("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:ii("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function hr(w,l){const g=w.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let C of g)if(C=C.trim(),"#"===C[0]&&C.includes("if")&&!C.includes("endif")){C=C.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const M=C.split(" ");for(const P of M)l.includes(P)||l.push(P)}}function ii(w,l){const g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,C=l.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),M={},P=[...Qi];return hr(w,P),hr(l,P),{fragmentSource:w=w.replace(g,(k,z,G,X,Z)=>(M[Z]=!0,"define"===z?`\n#ifndef HAS_UNIFORM_u_${Z}\nvarying ${G} ${X} ${Z};\n#else\nuniform ${G} ${X} u_${Z};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${Z}\n    ${G} ${X} ${Z} = u_${Z};\n#endif\n`)),vertexSource:l=l.replace(g,(k,z,G,X,Z)=>{const se="float"===X?"vec2":"vec4",Ie=Z.match(/color/)?"color":se;return M[Z]?"define"===z?`\n#ifndef HAS_UNIFORM_u_${Z}\nuniform lowp float u_${Z}_t;\nattribute ${G} ${se} a_${Z};\nvarying ${G} ${X} ${Z};\n#else\nuniform ${G} ${X} u_${Z};\n#endif\n`:"vec4"===Ie?`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${Z} = a_${Z};\n#else\n    ${G} ${X} ${Z} = u_${Z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${Z} = unpack_mix_${Ie}(a_${Z}, u_${Z}_t);\n#else\n    ${G} ${X} ${Z} = u_${Z};\n#endif\n`:"define"===z?`\n#ifndef HAS_UNIFORM_u_${Z}\nuniform lowp float u_${Z}_t;\nattribute ${G} ${se} a_${Z};\n#else\nuniform ${G} ${X} u_${Z};\n#endif\n`:"vec4"===Ie?`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${G} ${X} ${Z} = a_${Z};\n#else\n    ${G} ${X} ${Z} = u_${Z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Z}\n    ${G} ${X} ${Z} = unpack_mix_${Ie}(a_${Z}, u_${Z}_t);\n#else\n    ${G} ${X} ${Z} = u_${Z};\n#endif\n`}),staticAttributes:C,usedDefines:P}}class Ja{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,g,C,M,P,k,z){this.context=l;let G=this.boundPaintVertexBuffers.length!==M.length;for(let Z=0;!G&&Z<M.length;Z++)this.boundPaintVertexBuffers[Z]!==M[Z]&&(G=!0);let X=this.boundDynamicVertexBuffers.length!==z.length;for(let Z=0;!X&&Z<z.length;Z++)this.boundDynamicVertexBuffers[Z]!==z[Z]&&(X=!0);if(!l.extVertexArrayObject||!this.vao||this.boundProgram!==g||this.boundLayoutVertexBuffer!==C||G||X||this.boundIndexBuffer!==P||this.boundVertexOffset!==k)this.freshBind(g,C,M,P,k,z);else{l.bindVertexArrayOES.set(this.vao);for(const Z of z)Z&&Z.bind();P&&P.dynamicDraw&&P.bind()}}freshBind(l,g,C,M,P,k){let z;const G=l.numAttributes,X=this.context,Z=X.gl;if(X.extVertexArrayObject)this.vao&&this.destroy(),this.vao=X.extVertexArrayObject.createVertexArrayOES(),X.bindVertexArrayOES.set(this.vao),z=0,this.boundProgram=l,this.boundLayoutVertexBuffer=g,this.boundPaintVertexBuffers=C,this.boundIndexBuffer=M,this.boundVertexOffset=P,this.boundDynamicVertexBuffers=k;else{z=X.currentNumAttributes||0;for(let se=G;se<z;se++)Z.disableVertexAttribArray(se)}g.enableAttributes(Z,l),g.bind(),g.setVertexAttribPointers(Z,l,P);for(const se of C)se.enableAttributes(Z,l),se.bind(),se.setVertexAttribPointers(Z,l,P);for(const se of k)se&&(se.enableAttributes(Z,l),se.bind(),se.setVertexAttribPointers(Z,l,P));M&&M.bind(),X.currentNumAttributes=G}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function uu(w,l){const g=Math.pow(2,l.canonical.z),C=l.canonical.y;return[new p.MercatorCoordinate(0,C/g).toLngLat().lat,new p.MercatorCoordinate(0,(C+1)/g).toLngLat().lat]}function oi(w,l,g,C,M,P,k){const z=w.context,G=z.gl,X=g.fbo;if(!X)return;w.prepareDrawTile();const Z=w.useProgram("hillshade");z.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,X.colorAttachment.get());const se=((je,We,ue,Fe)=>{const nt=ue.paint.get("hillshade-shadow-color"),Qe=ue.paint.get("hillshade-highlight-color"),Et=ue.paint.get("hillshade-accent-color");let St=ue.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===ue.paint.get("hillshade-illumination-anchor")&&(St-=je.transform.angle);const at=!je.options.moving;return{u_matrix:Fe||je.transform.calculateProjMatrix(We.tileID.toUnwrapped(),at),u_image:0,u_latrange:uu(0,We.tileID),u_light:[ue.paint.get("hillshade-exaggeration"),St],u_shadow:nt,u_highlight:Qe,u_accent:Et}})(w,g,C,w.terrain?l.projMatrix:null);w.prepareDrawProgram(z,Z,l.toUnwrapped());const{tileBoundsBuffer:Ie,tileBoundsIndexBuffer:ze,tileBoundsSegments:$e}=w.getTileBoundsBuffers(g);Z.draw(z,G.TRIANGLES,M,P,k,p.CullFaceMode.disabled,se,C.id,Ie,ze,$e)}function Lc(w,l,g){if(!l.needsDEMTextureUpload)return;const C=w.context,M=C.gl;C.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||w.getTileTexture(g.stride);const P=g.getPixels();l.demTexture?l.demTexture.update(P,{premultiply:!1}):l.demTexture=new p.Texture(C,P,M.RGBA,{premultiply:!1}),l.needsDEMTextureUpload=!1}function Fh(w,l,g,C,M,P){const k=w.context,z=k.gl;if(!l.dem)return;const G=l.dem;if(k.activeTexture.set(z.TEXTURE1),Lc(w,l,G),!l.demTexture)return;l.demTexture.bind(z.NEAREST,z.CLAMP_TO_EDGE);const X=G.dim;k.activeTexture.set(z.TEXTURE0);let Z=l.fbo;if(!Z){const $e=new p.Texture(k,{width:X,height:X,data:null},z.RGBA);$e.bind(z.LINEAR,z.CLAMP_TO_EDGE),Z=l.fbo=k.createFramebuffer(X,X,!0),Z.colorAttachment.set($e.texture)}k.bindFramebuffer.set(Z.framebuffer),k.viewport.set([0,0,X,X]);const{tileBoundsBuffer:se,tileBoundsIndexBuffer:Ie,tileBoundsSegments:ze}=w.getMercatorTileBoundsBuffers();w.useProgram("hillshadePrepare").draw(k,z.TRIANGLES,C,M,P,p.CullFaceMode.disabled,(($e,je)=>{const We=je.stride,ue=p.create();return p.ortho(ue,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(ue,ue,[0,-p.EXTENT,0]),{u_matrix:ue,u_image:1,u_dimension:[We,We],u_zoom:$e.overscaledZ,u_unpack:je.unpackVector}})(l.tileID,G),g.id,se,Ie,ze),l.needsHillshadePrepare=!1}const $l=w=>({u_matrix:new p.UniformMatrix4f(w),u_image0:new p.Uniform1i(w),u_skirt_height:new p.Uniform1f(w)}),Qu=(w,l)=>({u_matrix:w,u_image0:0,u_skirt_height:l}),Si=(w,l,g,C,M,P,k,z,G,X,Z,se,Ie,ze,$e)=>({u_proj_matrix:Float32Array.from(w),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(C),u_merc_matrix:g,u_zoom_transition:M,u_merc_center:P,u_image0:0,u_frustum_tl:k,u_frustum_tr:z,u_frustum_br:G,u_frustum_bl:X,u_globe_pos:Z,u_globe_radius:se,u_viewport:Ie,u_grid_matrix:$e?Float32Array.from($e):new Float32Array(9),u_skirt_height:ze});function Ni(w,l){return null!=w&&null!=l&&!(!w.hasData()||!l.hasData())&&null!=w.demTexture&&null!=l.demTexture&&w.tileID.key!==l.tileID.key}const ki=new class{constructor(){this.operations={}}newMorphing(w,l,g,C,M){if(w in this.operations){const P=this.operations[w];P.to.tileID.key!==g.tileID.key&&(P.queued=g)}else this.operations[w]={startTime:C,phase:0,duration:M,from:l,to:g,queued:null}}getMorphValuesForProxy(w){if(!(w in this.operations))return null;const l=this.operations[w];return{from:l.from,to:l.to,phase:l.phase}}update(w){for(const l in this.operations){const g=this.operations[l];for(g.phase=(w-g.startTime)/g.duration;g.phase>=1||!this._validOp(g);)if(!this._nextOp(g,w)){delete this.operations[l];break}}}_nextOp(w,l){return!!w.queued&&(w.from=w.to,w.to=w.queued,w.queued=null,w.phase=0,w.startTime=l,!0)}_validOp(w){return w.from.hasData()&&w.to.hasData()}},ml={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Qa(w){return 6*Math.pow(1.5,22-w)}function Bh(w,l){const g=1<<w.z;return!l&&(0===w.x||w.x===g-1)||0===w.y||w.y===g-1}const ei=w=>({u_matrix:w});function Oc(w,l,g,C,M){if(M>0){const P=p.exported.now(),k=(P-w.timeAdded)/M,z=l?(P-l.timeAdded)/M:-1,G=g.getSource(),X=C.coveringZoomLevel({tileSize:G.tileSize,roundZoom:G.roundZoom}),Z=!l||Math.abs(l.tileID.overscaledZ-X)>Math.abs(w.tileID.overscaledZ-X),se=Z&&w.refreshedUponExpiration?1:p.clamp(Z?k:1-z,0,1);return w.refreshedUponExpiration&&k>=1&&(w.refreshedUponExpiration=!1),l?{opacity:1,mix:1-se}:{opacity:se,mix:0}}return{opacity:1,mix:0}}class $i extends p.SourceCache{constructor(l){const g={type:"raster-dem",maxzoom:l.transform.maxZoom},C=new Ue(pl(),null),M=Cr("mock-dem",g,C,l.style);super("mock-dem",M,!1),M.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,g){l.state="loaded",g(null)}}class Nc extends p.SourceCache{constructor(l){const g=Cr("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new Ue(pl(),null),l.style);super("proxy",g,!1),g.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,g,C){if(l.freezeTileCoverage)return;this.transform=l;const M=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((P,k)=>{if(P[k.key]="",!this._tiles[k.key]){const z=new p.Tile(k,this._source.tileSize*k.overscaleFactor(),l.tileZoom);z.state="loaded",this._tiles[k.key]=z}return P},{});for(const P in this._tiles)P in M||(this.freeFBO(P),this._tiles[P].unloadVectorData(),delete this._tiles[P])}freeFBO(l){const g=this.proxyCachedFBO[l];if(void 0!==g){const C=Object.values(g);this.renderCachePool.push(...C),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class fr extends p.OverscaledTileID{constructor(l,g,C){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=g,this.projMatrix=C}}class Lu extends p.Elevation{constructor(l,g){super(),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[C,M,P]=function(G){const X=new p.StructArrayLayout2i4,Z=new p.StructArrayLayout3ui6;X.reserve(17161),Z.reserve(33800);const Ie=p.EXTENT/128,ze=p.EXTENT+Ie/2,$e=ze+Ie;for(let We=-Ie;We<$e;We+=Ie)for(let ue=-Ie;ue<$e;ue+=Ie){const Fe=ue<0||ue>ze||We<0||We>ze?24575:0,nt=p.clamp(Math.round(ue),0,p.EXTENT),Qe=p.clamp(Math.round(We),0,p.EXTENT);X.emplaceBack(nt+Fe,Qe)}const je=(We,ue)=>{const Fe=131*ue+We;Z.emplaceBack(Fe+1,Fe,Fe+131),Z.emplaceBack(Fe+131,Fe+131+1,Fe+1)};for(let We=1;We<129;We++)for(let ue=1;ue<129;ue++)je(ue,We);return[0,129].forEach(We=>{for(let ue=0;ue<130;ue++)je(ue,We),je(We,ue)}),[X,Z,32768]}(),k=l.context;this.gridBuffer=k.createVertexBuffer(C,p.posAttributes.members),this.gridIndexBuffer=k.createIndexBuffer(M),this.gridSegments=p.SegmentVector.simpleSegment(0,0,C.length,M.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,C.length,P),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Nc(g.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.EXTENT,0,p.EXTENT,0,1);const z=k.gl;this._overlapStencilMode=new p.StencilMode({func:z.GEQUAL,mask:255},0,255,z.KEEP,z.KEEP,z.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=g,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new $i(g.map)}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),l.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=l,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,g,C){if(l&&l.terrain){this._style!==l&&(this.style=l),this.enabled=!0;const M=l.terrain.properties;this.sourceCache=0===l.terrain.drapeRenderMode?this._mockSourceCache:l._getSourceCache(M.get("source")),this._exaggeration=M.get("exaggeration");const P=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const k=this.getScaledDemTileSize();this.sourceCache.update(g,k,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,P(),this._initializing=!0),P(),g.updateElevation(!0,C),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(g),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const l=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==l.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${l.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${l.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(l){l.coord&&"source"===l.dataType?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):"style"===l.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._sourceCaches)this._style._sourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const g=this.proxySourceCache,C=this.painter.transform;this._initializing&&(this._initializing=0===C._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(C.center),-1),this._emptyDEMTextureDirty=!this._initializing);const M=this.proxyCoords=g.getIds().map(G=>{const X=g.getTileByID(G).tileID;return X.projMatrix=C.calculateProjMatrix(X.toUnwrapped()),X});(function(G,X){const Z=X.transform.pointCoordinate(X.transform.getCameraPoint()),se=new p.Point(Z.x,Z.y);G.sort((Ie,ze)=>{if(ze.overscaledZ-Ie.overscaledZ)return ze.overscaledZ-Ie.overscaledZ;const $e=new p.Point(Ie.canonical.x+(1<<Ie.canonical.z)*Ie.wrap,Ie.canonical.y),je=new p.Point(ze.canonical.x+(1<<ze.canonical.z)*ze.wrap,ze.canonical.y),We=se.mult(1<<Ie.canonical.z);return We.x-=.5,We.y-=.5,We.distSqr($e)-We.distSqr(je)})})(M,this.painter),this._previousZoom=C.zoom;const P=this.proxyToSource||{};this.proxyToSource={},M.forEach(G=>{this.proxyToSource[G.key]={}}),this.terrainTileForTile={};const k=this._style._sourceCaches;for(const G in k){const X=k[G];if(!X.used||(X!==this.sourceCache&&this.resetTileLookupCache(X.id),this._setupProxiedCoordsForOrtho(X,l[G],P),X.usedForTerrain))continue;const Z=l[G];X.getSource().reparseOverscaled&&this._assignTerrainTiles(Z)}this.proxiedCoords[g.id]=M.map(G=>new fr(G,G.key,this.orthoMatrix)),this._assignTerrainTiles(M),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(P),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const z={};this._visibleDemTiles=[];for(const G of this.proxyCoords){const X=this.terrainTileForTile[G.key];if(!X)continue;const Z=X.tileID.key;Z in z||(this._visibleDemTiles.push(X),z[Z]=Z)}}_assignTerrainTiles(l){this._initializing||l.forEach(g=>{if(this.terrainTileForTile[g.key])return;const C=this._findTileCoveringTileID(g,this.sourceCache);C&&(this.terrainTileForTile[g.key]=C)})}_prepareDEMTextures(){const l=this.painter.context,g=l.gl;for(const C in this.terrainTileForTile){const M=this.terrainTileForTile[C],P=M.dem;!P||M.demTexture&&!M.needsDEMTextureUpload||(l.activeTexture.set(g.TEXTURE1),Lc(this.painter,M,P))}}_prepareDemTileUniforms(l,g,C,M){if(!g||null==g.demTexture)return!1;const P=l.tileID.canonical,k=Math.pow(2,g.tileID.canonical.z-P.z),z=M||"";return C[`u_dem_tl${z}`]=[P.x*k%1,P.y*k%1],C[`u_dem_scale${z}`]=k,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const l=this.painter.context,g=l.gl;if(!this._emptyDepthBufferTexture){const C=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(l,C,g.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let l=0;const g=this._visibleDemTiles.reduce((C,M)=>{if(!M.dem)return C;const P=M.dem.tree.minimums[0];return P>0&&l++,C+P},0);return l?g/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,g=l.gl;l.activeTexture.set(g.TEXTURE2);const C=this._getLoadedAreaMinimum(),M=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(C,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let P=this._emptyDEMTexture;return P?P.update(M,{premultiply:!1}):P=this._emptyDEMTexture=new p.Texture(l,M,g.RGBA,{premultiply:!1}),P}setupElevationDraw(l,g,C){const M=this.painter.context,P=M.gl,k=(z=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(z),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var z;k.u_dem_size=this.sourceCache.getSource().tileSize,k.u_exaggeration=this.exaggeration();let G=null,X=null,Z=1;if(C&&C.morphing&&this._useVertexMorphing){const se=C.morphing.srcDemTile,Ie=C.morphing.dstDemTile;Z=C.morphing.phase,se&&Ie&&(this._prepareDemTileUniforms(l,se,k,"_prev")&&(X=se),this._prepareDemTileUniforms(l,Ie,k)&&(G=Ie))}if(X&&G?(M.activeTexture.set(P.TEXTURE2),G.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE,P.NEAREST),M.activeTexture.set(P.TEXTURE4),X.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE,P.NEAREST),k.u_dem_lerp=Z):(G=this.terrainTileForTile[l.tileID.key],M.activeTexture.set(P.TEXTURE2),(this._prepareDemTileUniforms(l,G,k)?G.demTexture:this.emptyDEMTexture).bind(P.NEAREST,P.CLAMP_TO_EDGE)),M.activeTexture.set(P.TEXTURE3),C&&C.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE),this._depthFBO&&(k.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE),k.u_depth_size_inv=[1,1]),C&&C.useMeterToDem&&G){const se=(1<<G.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;k.u_meter_to_dem=se}if(C&&C.labelPlaneMatrixInv&&(k.u_label_plane_matrix_inv=C.labelPlaneMatrixInv),g.setTerrainUniformValues(M,k),"globe"===this.painter.transform.projection.name){const se=this.globeUniformValues(this.painter.transform,l.tileID.canonical,C&&C.useDenormalizedUpVectorScale);g.setGlobeUniformValues(M,se)}}globeUniformValues(l,g,C){const M=l.projection;return{u_tile_tl_up:M.upVector(g,0,0),u_tile_tr_up:M.upVector(g,p.EXTENT,0),u_tile_br_up:M.upVector(g,p.EXTENT,p.EXTENT),u_tile_bl_up:M.upVector(g,0,p.EXTENT),u_tile_up_scale:C?p.globeMetersToEcef(1):M.upVectorScale(g,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const g=this.painter,C=this.painter.context;0!==l.length&&(C.bindFramebuffer.set(null),C.viewport.set([0,0,g.width,g.height]),g.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(M,P,k,z,G){if("globe"===M.transform.projection.name)!function(X,Z,se,Ie,ze){const $e=X.context,je=$e.gl;let We,ue;const Fe=X.options.showTerrainWireframe?2:0,nt=X.transform,Qe=p.globeUseCustomAntiAliasing(X,$e,nt),Et=(gn,Gt)=>{if(ue===gn)return;const fn=[ml[gn],"PROJECTION_GLOBE_VIEW"];Qe&&fn.push("CUSTOM_ANTIALIASING"),Gt&&fn.push(ml[Fe]),We=X.useProgram("globeRaster",null,fn),ue=gn},St=X.colorModeForRenderPass(),at=new p.DepthMode(je.LEQUAL,p.DepthMode.ReadWrite,X.depthRangeFor3D);ki.update(ze);const Ot=p.calculateGlobeMercatorMatrix(nt),Rt=[p.mercatorXfromLng(nt.center.lng),p.mercatorYfromLat(nt.center.lat)],kt=Fe?[!1,!0]:[!1],Dn=X.globeSharedBuffers,Ut=[nt.width*p.exported.devicePixelRatio,nt.height*p.exported.devicePixelRatio],an=Float32Array.from(nt.globeMatrix),Ht={useDenormalizedUpVectorScale:!0};if(kt.forEach(gn=>{const Gt=X.transform,fn=Qa(Gt.zoom)*Z.exaggeration();ue=-1;const En=gn?je.LINES:je.TRIANGLES;for(const vn of Ie){const Ln=se.getTile(vn),wr=p.StencilMode.disabled,Vr=Z.prevTerrainTileForTile[vn.key],or=Z.terrainTileForTile[vn.key];Ni(Vr,or)&&ki.newMorphing(vn.key,Vr,or,ze,250),$e.activeTexture.set(je.TEXTURE0),Ln.texture.bind(je.LINEAR,je.CLAMP_TO_EDGE);const Ar=ki.getMorphValuesForProxy(vn.key),Xn=Ar?1:0;Ar&&p.extend$1(Ht,{morphing:{srcDemTile:Ar.from,dstDemTile:Ar.to,phase:p.easeCubicInOut(Ar.phase)}});const ci=p.tileCornersToBounds(vn.canonical),yr=p.getLatitudinalLod(ci.getCenter().lat),bo=p.getGridMatrix(vn.canonical,ci,yr,Gt.worldSize/Gt._pixelsPerMercatorPixel),Ko=p.globeNormalizeECEF(p.globeTileBounds(vn.canonical)),us=Si(Gt.projMatrix,an,Ot,Ko,p.globeToMercatorTransition(Gt.zoom),Rt,Gt.frustumCorners.TL,Gt.frustumCorners.TR,Gt.frustumCorners.BR,Gt.frustumCorners.BL,Gt.globeCenterInViewSpace,Gt.globeRadius,Ut,fn,bo);if(Et(Xn,gn),Z.setupElevationDraw(Ln,We,Ht),X.prepareDrawProgram($e,We,vn.toUnwrapped()),Dn){const[ls,Va,Iu]=gn?Dn.getWirefameBuffers(X.context,yr):Dn.getGridBuffers(yr,0!==fn);We.draw($e,En,at,wr,St,p.CullFaceMode.backCCW,us,"globe_raster",ls,Va,Iu)}}}),Dn){const gn=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Qe&&gn.push("CUSTOM_ANTIALIASING"),We=X.useProgram("globeRaster",null,gn);for(const Gt of Ie){const{x:fn,y:En,z:vn}=Gt.canonical,Ln=0===En,wr=En===(1<<vn)-1,[Vr,or,Ar,Xn]=Dn.getPoleBuffers(vn);if(Xn&&(Ln||wr)){const ci=se.getTile(Gt);$e.activeTexture.set(je.TEXTURE0),ci.texture.bind(je.LINEAR,je.CLAMP_TO_EDGE);let yr=p.globePoleMatrixForTile(vn,fn,nt);const bo=p.globeNormalizeECEF(p.globeTileBounds(Gt.canonical)),Ko=(us,ls)=>us.draw($e,je.TRIANGLES,at,p.StencilMode.disabled,St,p.CullFaceMode.disabled,Si(nt.projMatrix,yr,yr,bo,0,Rt,nt.frustumCorners.TL,nt.frustumCorners.TR,nt.frustumCorners.BR,nt.frustumCorners.BL,nt.globeCenterInViewSpace,nt.globeRadius,Ut,0),"globe_pole_raster",ls,Ar,Xn);Z.setupElevationDraw(ci,We,Ht),X.prepareDrawProgram($e,We,Gt.toUnwrapped()),Ln&&Ko(We,Vr),wr&&(yr=p.scale(p.create(),yr,[1,-1,1]),Ko(We,or))}}}}(M,P,k,z,G);else{const X=M.context,Z=X.gl;let se,Ie;const ze=M.options.showTerrainWireframe?2:0,$e=(nt,Qe)=>{if(Ie===nt)return;const Et=[ml[nt]];Qe&&Et.push(ml[ze]),se=M.useProgram("terrainRaster",null,Et),Ie=nt},je=M.colorModeForRenderPass(),We=new p.DepthMode(Z.LEQUAL,p.DepthMode.ReadWrite,M.depthRangeFor3D);ki.update(G);const ue=M.transform,Fe=Qa(ue.zoom)*P.exaggeration();(ze?[!1,!0]:[!1]).forEach(nt=>{Ie=-1;const Qe=nt?Z.LINES:Z.TRIANGLES,[Et,St]=nt?P.getWirefameBuffer():[P.gridIndexBuffer,P.gridSegments];for(const at of z){const Ot=k.getTile(at),Rt=p.StencilMode.disabled,kt=P.prevTerrainTileForTile[at.key],Dn=P.terrainTileForTile[at.key];Ni(kt,Dn)&&ki.newMorphing(at.key,kt,Dn,G,250),X.activeTexture.set(Z.TEXTURE0),Ot.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE,Z.LINEAR_MIPMAP_NEAREST);const Ut=ki.getMorphValuesForProxy(at.key),an=Ut?1:0;let Ht;Ut&&(Ht={morphing:{srcDemTile:Ut.from,dstDemTile:Ut.to,phase:p.easeCubicInOut(Ut.phase)}});const gn=Qu(at.projMatrix,Bh(at.canonical,ue.renderWorldCopies)?Fe/10:Fe);$e(an,nt),P.setupElevationDraw(Ot,se,Ht),M.prepareDrawProgram(X,se,at.toUnwrapped()),se.draw(X,Qe,We,Rt,je,p.CullFaceMode.backCCW,gn,"terrain_raster",P.gridBuffer,Et,St)}})}}(g,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,g.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(0===this._drapedRenderBatches.length)return l+1;this.renderingToTexture=!0;const g=this.painter,C=this.painter.context,M=this.proxySourceCache,P=this.proxiedCoords[M.id],k=this._drapedRenderBatches.shift(),z=[],G=g.style.order;let X=0;for(const Z of P){const se=M.getTileByID(Z.proxyTileKey),Ie=M.proxyCachedFBO[Z.key]?M.proxyCachedFBO[Z.key][l]:void 0,ze=void 0!==Ie?M.renderCache[Ie]:this.pool[X++],$e=void 0!==Ie;if(se.texture=ze.tex,$e&&!ze.dirty){z.push(se.tileID);continue}let je;C.bindFramebuffer.set(ze.fb.framebuffer),this.renderedToTile=!1,ze.dirty&&(C.clear({color:p.Color.transparent,stencil:0}),ze.dirty=!1);for(let We=k.start;We<=k.end;++We){const ue=g.style._layers[G[We]];if(ue.isHidden(g.transform.zoom))continue;const Fe=g.style._getLayerSourceCache(ue),nt=Fe?this.proxyToSource[Z.key][Fe.id]:[Z];if(!nt)continue;const Qe=nt;C.viewport.set([0,0,ze.fb.width,ze.fb.height]),je!==(Fe?Fe.id:null)&&(this._setupStencil(ze,nt,ue,Fe),je=Fe?Fe.id:null),g.renderLayer(g,Fe,ue,Qe)}this.renderedToTile?(ze.dirty=!0,z.push(se.tileID)):$e||--X,5===X&&(X=0,this.renderToBackBuffer(z))}return this.renderToBackBuffer(z),this.renderingToTexture=!1,C.bindFramebuffer.set(null),C.viewport.set([0,0,g.width,g.height]),k.end+1}postRender(){}renderCacheEfficiency(l){const g=l.order.length;if(0===g)return{efficiency:100};let C,M=0,P=0,k=!1;for(let z=0;z<g;++z){const G=l._layers[l.order[z]];this._style.isLayerDraped(G)?(k&&++M,++P):k||(k=!0,C=G.id)}return 0===P?{efficiency:100}:{efficiency:100*(1-M/P),firstUndrapedLayer:C}}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(g=>g.dem).forEach(g=>{l=Math.min(l,g.dem.tree.minimums[0])}),0===l?l:(l-30)*this._exaggeration}raycast(l,g,C){if(!this._visibleDemTiles)return null;const M=this._visibleDemTiles.filter(P=>P.dem).map(P=>{const k=P.tileID,z=1<<k.overscaledZ,{x:G,y:X}=k.canonical,Z=G/z,se=(G+1)/z,Ie=X/z,ze=(X+1)/z;return{minx:Z,miny:Ie,maxx:se,maxy:ze,t:P.dem.tree.raycastRoot(Z,Ie,se,ze,l,g,C),tile:P}});M.sort((P,k)=>(null!==P.t?P.t:Number.MAX_VALUE)-(null!==k.t?k.t:Number.MAX_VALUE));for(const P of M){if(null==P.t)return null;const k=P.tile.dem.tree.raycast(P.minx,P.miny,P.maxx,P.maxy,l,g,C);if(null!=k)return k}return null}_createFBO(){const l=this.painter.context,g=l.gl,C=this.drapeBufferSize;l.activeTexture.set(g.TEXTURE0);const M=new p.Texture(l,{width:C[0],height:C[1],data:null},g.RGBA);M.bind(g.LINEAR,g.CLAMP_TO_EDGE);const P=l.createFramebuffer(C[0],C[1],!1);return P.colorAttachment.set(M.texture),P.depthAttachment=new lt(l,P.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,C[0],C[1]),this._stencilRef=0,P.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):P.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&!l.extTextureFilterAnisotropicForceOff&&g.texParameterf(g.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:P,tex:M,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const g=this._style._layers[l],C=g.isHidden(this.painter.transform.zoom);return"custom"===g.type?!C&&g.shouldRedrape():!C&&g.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const C of this._style._getSources())if(C instanceof Bn){l=!0;break}if(!l)return;const g={};for(let C=0;C<this._style.order.length;++C){const M=this._style._layers[this._style.order[C]],P=this._style._getLayerSourceCache(M);if(P&&!g[P.id]&&!M.isHidden(this.painter.transform.zoom)&&"line"===M.type&&M.widthExpression()instanceof p.ZoomDependentExpression){g[P.id]=!0;for(const k of this.proxyCoords){const z=this.proxyToSource[k.key][P.id];if(z)for(const G of z)this._clearRenderCacheForTile(P.id,G)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const C in this._style._sourceCaches)if(this._style._sourceCaches[C]._source instanceof Sn){l=!0;break}if(!l)return;const g={};for(let C=0;C<this._style.order.length;++C){const M=this._style._layers[this._style.order[C]],P=this._style._getLayerSourceCache(M);if(!P||g[P.id]||M.isHidden(this.painter.transform.zoom)||"raster"!==M.type)continue;const k=M.paint.get("raster-fade-duration");for(const z of this.proxyCoords){const G=this.proxyToSource[z.key][P.id];if(G)for(const X of G){const Z=Oc(P.getTile(X),P.findLoadedParent(X,0),P,this.painter.transform,k);(1!==Z.opacity||0!==Z.mix)&&this._clearRenderCacheForTile(P.id,X)}}}}_setupDrapedRenderBatches(){const l=this._style.order,g=l.length;if(0===g)return;const C=[];let M,P=0,k=this._style._layers[l[P]];for(;!this._style.isLayerDraped(k)&&k.isHidden(this.painter.transform.zoom)&&++P<g;)k=this._style._layers[l[P]];for(;P<g;++P){const z=this._style._layers[l[P]];z.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(z)?void 0===M&&(M=P):void 0!==M&&(C.push({start:M,end:P-1}),M=void 0))}void 0!==M&&C.push({start:M,end:P-1}),this._drapedRenderBatches=C}_setupRenderCache(l){const g=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,g.renderCache.length>g.renderCachePool.length){const k=Object.values(g.proxyCachedFBO);g.proxyCachedFBO={};for(let z=0;z<k.length;++z){const G=Object.values(k[z]);g.renderCachePool.push(...G)}}return}this._clearRasterLayersFromRenderCache();const C=this.proxyCoords,M=this._tilesDirty;for(let k=C.length-1;k>=0;k--){const z=C[k];if(g.getTileByID(z.key),void 0!==g.proxyCachedFBO[z.key]){const G=l[z.key],X=this.proxyToSource[z.key];let Z=0;for(const se in X){const Ie=X[se],ze=G[se];if(!ze||ze.length!==Ie.length||Ie.some(($e,je)=>$e!==ze[je]||M[se]&&M[se].hasOwnProperty($e.key))){Z=-1;break}++Z}for(const se in g.proxyCachedFBO[z.key])g.renderCache[g.proxyCachedFBO[z.key][se]].dirty=Z<0||Z!==Object.values(G).length}}const P=[...this._drapedRenderBatches];P.sort((k,z)=>z.end-z.start-(k.end-k.start));for(const k of P)for(const z of C){if(g.proxyCachedFBO[z.key])continue;let G=g.renderCachePool.pop();void 0===G&&g.renderCache.length<50&&(G=g.renderCache.length,g.renderCache.push(this._createFBO())),void 0!==G&&(g.proxyCachedFBO[z.key]={},g.proxyCachedFBO[z.key][k.start]=G,g.renderCache[G].dirty=!0)}this._tilesDirty={}}_setupStencil(l,g,C,M){if(!M||!this._sourceTilesOverlap[M.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const P=this.painter.context,k=P.gl;if(g.length<=1)return void(this._overlapStencilType=!1);let z;if(C.isTileClipped())z=g.length,this._overlapStencilMode.test={func:k.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(g[0].overscaledZ>g[g.length-1].overscaledZ))return void(this._overlapStencilType=!1);z=1,this._overlapStencilMode.test={func:k.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+z>255&&(P.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=z,this._overlapStencilMode.ref=this._stencilRef,C.isTileClipped()&&this._renderTileClippingMasks(g,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(l,g){const C=this.painter,M=this.painter.context,P=M.gl;C._tileClippingMaskIDs={},M.setColorMode(p.ColorMode.disabled),M.setDepthMode(p.DepthMode.disabled);const k=C.useProgram("clippingMask");for(const z of l){const G=C._tileClippingMaskIDs[z.key]=--g;k.draw(M,P.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:P.ALWAYS,mask:0},G,255,P.KEEP,P.KEEP,P.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,ei(z.projMatrix),"$clipping",C.tileExtentBuffer,C.quadTriangleIndexBuffer,C.tileExtentSegments)}}pointCoordinate(l){const g=this.painter.transform;if(l.x<0||l.x>g.width||l.y<0||l.y>g.height)return null;const C=[l.x,l.y,1,1];p.transformMat4$1(C,C,g.pixelMatrixInverse),p.scale$1(C,C,1/C[3]),C[0]/=g.worldSize,C[1]/=g.worldSize;const M=g._camera.position,P=p.mercatorZfromAltitude(1,g.center.lat),k=[M[0],M[1],M[2]/P,0],z=p.subtract([],C.slice(0,3),k);p.normalize(z,z);const G=this.raycast(k,z,this._exaggeration);return null!==G&&G?(p.scaleAndAdd(k,k,z,G),k[3]=k[2],k[2]*=P,k):null}drawDepth(){const l=this.painter,g=l.context,C=this.proxySourceCache,M=Math.ceil(l.width),P=Math.ceil(l.height);if(!this._depthFBO||this._depthFBO.width===M&&this._depthFBO.height===P||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const k=g.gl,z=g.createFramebuffer(M,P,!0);g.activeTexture.set(k.TEXTURE0);const G=new p.Texture(g,{width:M,height:P,data:null},k.RGBA);G.bind(k.NEAREST,k.CLAMP_TO_EDGE),z.colorAttachment.set(G.texture);const X=g.createRenderbuffer(g.gl.DEPTH_COMPONENT16,M,P);z.depthAttachment.set(X),this._depthFBO=z,this._depthTexture=G}g.bindFramebuffer.set(this._depthFBO.framebuffer),g.viewport.set([0,0,M,P]),function(k,z,G,X){if("globe"===k.transform.projection.name)return;const Z=k.context,se=Z.gl;Z.clear({depth:1});const Ie=k.useProgram("terrainDepth"),ze=new p.DepthMode(se.LESS,p.DepthMode.ReadWrite,k.depthRangeFor3D);for(const $e of X){const je=G.getTile($e),We=Qu($e.projMatrix,0);z.setupElevationDraw(je,Ie),Ie.draw(Z,se.TRIANGLES,ze,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,We,"terrain_depth",z.gridBuffer,z.gridIndexBuffer,z.gridNoSkirtSegments)}}(l,this,C,this.proxyCoords)}_setupProxiedCoordsForOrtho(l,g,C){if(l.getSource()instanceof li)return this._setupProxiedCoordsForImageSource(l,g,C);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const M=this.proxiedCoords[l.id]=[],P=this.proxyCoords;for(let z=0;z<P.length;z++){const G=P[z],X=this._findTileCoveringTileID(G,l);if(X){const Z=this._createProxiedId(G,X,C[G.key]&&C[G.key][l.id]);M.push(Z),this.proxyToSource[G.key][l.id]=[Z]}}let k=!1;for(let z=0;z<g.length;z++){const G=l.getTile(g[z]);if(!G||!G.hasData())continue;const X=this._findTileCoveringTileID(G.tileID,this.proxySourceCache);if(X&&X.tileID.canonical.z!==G.tileID.canonical.z){const Z=this.proxyToSource[X.tileID.key][l.id],se=this._createProxiedId(X.tileID,G,C[X.tileID.key]&&C[X.tileID.key][l.id]);Z?Z.splice(Z.length-1,0,se):this.proxyToSource[X.tileID.key][l.id]=[se],M.push(se),k=!0}}this._sourceTilesOverlap[l.id]=k}_setupProxiedCoordsForImageSource(l,g,C){if(!l.getSource().loaded())return;const M=this.proxiedCoords[l.id]=[],P=this.proxyCoords,k=l.getSource(),z=new p.Point(k.tileID.x,k.tileID.y)._div(1<<k.tileID.z),G=k.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((Z,se)=>(Z.min.x=Math.min(Z.min.x,se.x-z.x),Z.min.y=Math.min(Z.min.y,se.y-z.y),Z.max.x=Math.max(Z.max.x,se.x-z.x),Z.max.y=Math.max(Z.max.y,se.y-z.y),Z),{min:new p.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),X=(Z,se)=>{const Ie=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),ze=Z.canonical.y/(1<<Z.canonical.z),$e=p.EXTENT/(1<<Z.canonical.z),je=se.wrap+se.canonical.x/(1<<se.canonical.z),We=se.canonical.y/(1<<se.canonical.z);return Ie+$e<je+G.min.x||Ie>je+G.max.x||ze+$e<We+G.min.y||ze>We+G.max.y};for(let Z=0;Z<P.length;Z++){const se=P[Z];for(let Ie=0;Ie<g.length;Ie++){const ze=l.getTile(g[Ie]);if(!ze||!ze.hasData()||X(se,ze.tileID))continue;const $e=this._createProxiedId(se,ze,C[se.key]&&C[se.key][l.id]),je=this.proxyToSource[se.key][l.id];je?je.push($e):this.proxyToSource[se.key][l.id]=[$e],M.push($e)}}}_createProxiedId(l,g,C){let M=this.orthoMatrix;if(C){const P=C.find(k=>k.key===g.tileID.key);if(P)return P}if(g.tileID.key!==l.key){const P=l.canonical.z-g.tileID.canonical.z;let k,z,G;M=p.create();const X=g.tileID.wrap-l.wrap<<l.overscaledZ;P>0?(k=p.EXTENT>>P,z=k*((g.tileID.canonical.x<<P)-l.canonical.x+X),G=k*((g.tileID.canonical.y<<P)-l.canonical.y)):(k=p.EXTENT<<-P,z=p.EXTENT*(g.tileID.canonical.x-(l.canonical.x+X<<-P)),G=p.EXTENT*(g.tileID.canonical.y-(l.canonical.y<<-P))),p.ortho(M,0,k,0,k,0,1),p.translate(M,M,[z,G,0])}return new fr(g.tileID,l.key,M)}_findTileCoveringTileID(l,g){let C=g.getTile(l);if(C&&C.hasData())return C;const M=this._findCoveringTileCache[g.id],P=M[l.key];if(C=P?g.getTileByID(P):null,C&&C.hasData()||null===P)return C;let k=C?C.tileID:l,z=k.overscaledZ;const G=g.getSource().minzoom,X=[];if(!P){const se=g.getSource().maxzoom;if(l.canonical.z>=se){const Ie=l.canonical.z-se;g.getSource().reparseOverscaled?(z=Math.max(l.canonical.z+2,g.transform.tileZoom),k=new p.OverscaledTileID(z,l.wrap,se,l.canonical.x>>Ie,l.canonical.y>>Ie)):0!==Ie&&(z=se,k=new p.OverscaledTileID(z,l.wrap,se,l.canonical.x>>Ie,l.canonical.y>>Ie))}k.key!==l.key&&(X.push(k.key),C=g.getTile(k))}const Z=se=>{X.forEach(Ie=>{M[Ie]=se}),X.length=0};for(z-=1;z>=G&&(!C||!C.hasData());z--){C&&Z(C.tileID.key);const se=k.calculateScaledKey(z);if(C=g.getTileByID(se),C&&C.hasData())break;const Ie=M[se];if(null===Ie)break;void 0===Ie?X.push(se):C=g.getTileByID(Ie)}return Z(C?C.tileID.key:null),C&&C.hasData()?C:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,g){let C=this._tilesDirty[l];C||(C=this._tilesDirty[l]={}),C[g.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const l=function(g){let C=0;const M=new p.StructArrayLayout2ui4,P=131;for(let k=1;k<129;k++){for(let z=1;z<129;z++)C=k*P+z,M.emplaceBack(C,C+1),M.emplaceBack(C,C+P),M.emplaceBack(C+1,C+P),128===k&&M.emplaceBack(C+P,C+P+1);M.emplaceBack(C+1,C+1+P)}return M}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(l),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,l.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class qn{static cacheKey(l,g,C,M){let P=`${g}${M?M.cacheKey:""}`;for(const k of C)l.usedDefines.includes(k)&&(P+=`/${k}`);return P}constructor(l,g,C,M,P,k){const z=l.gl;this.program=z.createProgram();const G=function(ue){const Fe=[];for(let nt=0;nt<ue.length;nt++){if(null===ue[nt])continue;const Qe=ue[nt].split(" ");Fe.push(Qe.pop())}return Fe}(C.staticAttributes),X=M?M.getBinderAttributes():[],Z=G.concat(X);let se=M?M.defines():[];se=se.concat(k.map(ue=>`#define ${ue}`));const Ie=l.isWebGL2?"#version 300 es\n":"",ze=Ie+se.concat(l.extStandardDerivatives&&0===Ie.length?"#extension GL_OES_standard_derivatives : enable\n".concat(Rr):Rr,Rr,Ru,hc.fragmentSource,ka.fragmentSource,C.fragmentSource).join("\n"),$e=Ie+se.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ru,hc.vertexSource,ka.vertexSource,ca.vertexSource,C.vertexSource).join("\n"),je=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);z.shaderSource(je,ze),z.compileShader(je),z.attachShader(this.program,je);const We=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())this.failedToCreate=!0;else{z.shaderSource(We,$e),z.compileShader(We),z.attachShader(this.program,We),this.attributes={},this.numAttributes=Z.length;for(let ue=0;ue<this.numAttributes;ue++)Z[ue]&&(z.bindAttribLocation(this.program,ue,Z[ue]),this.attributes[Z[ue]]=ue);z.linkProgram(this.program),z.deleteShader(We),z.deleteShader(je),this.fixedUniforms=P(l),this.binderUniforms=M?M.getUniforms(l):[],k.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(ue=l),u_dem_prev:new p.Uniform1i(ue),u_dem_unpack:new p.Uniform4f(ue),u_dem_tl:new p.Uniform2f(ue),u_dem_scale:new p.Uniform1f(ue),u_dem_tl_prev:new p.Uniform2f(ue),u_dem_scale_prev:new p.Uniform1f(ue),u_dem_size:new p.Uniform1f(ue),u_dem_lerp:new p.Uniform1f(ue),u_exaggeration:new p.Uniform1f(ue),u_depth:new p.Uniform1i(ue),u_depth_size_inv:new p.Uniform2f(ue),u_meter_to_dem:new p.Uniform1f(ue),u_label_plane_matrix_inv:new p.UniformMatrix4f(ue)}),k.includes("GLOBE")&&(this.globeUniforms=(ue=>({u_tile_tl_up:new p.Uniform3f(ue),u_tile_tr_up:new p.Uniform3f(ue),u_tile_br_up:new p.Uniform3f(ue),u_tile_bl_up:new p.Uniform3f(ue),u_tile_up_scale:new p.Uniform1f(ue)}))(l)),k.includes("FOG")&&(this.fogUniforms=(ue=>({u_fog_matrix:new p.UniformMatrix4f(ue),u_fog_range:new p.Uniform2f(ue),u_fog_color:new p.Uniform4f(ue),u_fog_horizon_blend:new p.Uniform1f(ue),u_fog_temporal_offset:new p.Uniform1f(ue),u_frustum_tl:new p.Uniform3f(ue),u_frustum_tr:new p.Uniform3f(ue),u_frustum_br:new p.Uniform3f(ue),u_frustum_bl:new p.Uniform3f(ue),u_globe_pos:new p.Uniform3f(ue),u_globe_radius:new p.Uniform1f(ue),u_globe_transition:new p.Uniform1f(ue),u_is_globe:new p.Uniform1i(ue),u_viewport:new p.Uniform2f(ue)}))(l))}var ue}setTerrainUniformValues(l,g){if(!this.terrainUniforms)return;const C=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const M in g)C[M]&&C[M].set(this.program,M,g[M])}}setGlobeUniformValues(l,g){if(!this.globeUniforms)return;const C=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const M in g)C[M]&&C[M].set(this.program,M,g[M])}}setFogUniformValues(l,g){if(!this.fogUniforms)return;const C=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const M in g)C[M].set(this.program,M,g[M])}}draw(l,g,C,M,P,k,z,G,X,Z,se,Ie,ze,$e,je){const We=l.gl;if(this.failedToCreate)return;l.program.set(this.program),l.setDepthMode(C),l.setStencilMode(M),l.setColorMode(P),l.setCullFace(k);for(const Fe of Object.keys(this.fixedUniforms))this.fixedUniforms[Fe].set(this.program,Fe,z[Fe]);$e&&$e.setUniforms(this.program,l,this.binderUniforms,Ie,{zoom:ze});const ue={[We.LINES]:2,[We.TRIANGLES]:3,[We.LINE_STRIP]:1}[g];for(const Fe of se.get()){const nt=Fe.vaos||(Fe.vaos={});(nt[G]||(nt[G]=new Ja)).bind(l,this,X,$e?$e.getPaintVertexBuffers():[],Z,Fe.vertexOffset,je||[]),We.drawElements(g,Fe.primitiveLength*ue,We.UNSIGNED_SHORT,Fe.primitiveOffset*ue*2)}}}function xu(w,l){const g=Math.pow(2,l.tileID.overscaledZ),C=l.tileSize*Math.pow(2,w.transform.tileZoom)/g,M=C*(l.tileID.canonical.x+l.tileID.wrap*g),P=C*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_tile_units_to_pixels:1/ft(l,1,w.transform.tileZoom),u_pixel_coord_upper:[M>>16,P>>16],u_pixel_coord_lower:[65535&M,65535&P]}}const Fi=p.create(),ha=(w,l,g,C,M,P,k,z,G,X,Z)=>{const se=l.style.light,Ie=se.properties.get("position"),ze=[Ie.x,Ie.y,Ie.z],$e=p.create$1();"viewport"===se.properties.get("anchor")&&(p.fromRotation($e,-l.transform.angle),p.transformMat3(ze,ze,$e));const je=se.properties.get("color"),We=l.transform,ue={u_matrix:w,u_lightpos:ze,u_lightintensity:se.properties.get("intensity"),u_lightcolor:[je.r,je.g,je.b],u_vertical_gradient:+g,u_opacity:C,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Fi,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:M,u_edge_radius:P};return"globe"===We.projection.name&&(ue.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],ue.u_zoom_transition=G,ue.u_inv_rot_matrix=Z,ue.u_merc_center=X,ue.u_up_dir=We.projection.upVector(new p.CanonicalTileID(0,0,0),X[0]*p.EXTENT,X[1]*p.EXTENT),ue.u_height_lift=z),ue},kc=(w,l,g,C,M,P,k,z,G,X,Z,se)=>{const Ie=ha(w,l,g,C,M,P,k,G,X,Z,se),ze={u_height_factor:-Math.pow(2,k.overscaledZ)/z.tileSize/8};return p.extend(Ie,xu(l,z),ze)},eu=w=>({u_matrix:w}),lu=(w,l,g)=>p.extend(eu(w),xu(l,g)),ss=(w,l)=>({u_matrix:w,u_world:l}),Tl=(w,l,g,C)=>p.extend(lu(w,l,g),{u_world:C}),el=p.create(),Ta=(w,l,g,C,M,P)=>{const k=w.transform,z="globe"===k.projection.name;let G;if("map"===P.paint.get("circle-pitch-alignment"))if(z){const Z=p.globePixelsToTileUnits(k.zoom,l.canonical)*k._pixelsPerMercatorPixel;G=Float32Array.from([Z,0,0,Z])}else G=k.calculatePixelsToTileUnitsMatrix(g);else G=new Float32Array([k.pixelsToGLUnits[0],0,0,k.pixelsToGLUnits[1]]);const X={u_camera_to_center_distance:k.cameraToCenterDistance,u_matrix:w.translatePosMatrix(l.projMatrix,g,P.paint.get("circle-translate"),P.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:G,u_inv_rot_matrix:el,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(z){X.u_inv_rot_matrix=C,X.u_merc_center=M,X.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],X.u_zoom_transition=p.globeToMercatorTransition(k.zoom);const Z=M[0]*p.EXTENT,se=M[1]*p.EXTENT;X.u_up_dir=k.projection.upVector(new p.CanonicalTileID(0,0,0),Z,se)}return X},Lr=w=>{const l=[];return"map"===w.paint.get("circle-pitch-alignment")&&l.push("PITCH_WITH_MAP"),"map"===w.paint.get("circle-pitch-scale")&&l.push("SCALE_WITH_MAP"),l},Ou=(w,l,g,C)=>{const M=p.EXTENT/g.tileSize;return{u_matrix:w,u_camera_to_center_distance:l.getCameraToCenterDistance(C),u_extrude_scale:[l.pixelsToGLUnits[0]/M,l.pixelsToGLUnits[1]/M]}},Ws=(w,l,g=1)=>({u_matrix:w,u_color:l,u_overlay:0,u_overlay_scale:g}),wu=p.create(),tl=(w,l,g,C,M,P,k)=>{const z=w.transform,G="globe"===z.projection.name,X=G?p.globePixelsToTileUnits(z.zoom,l.canonical)*z._pixelsPerMercatorPixel:ft(g,1,P),Z={u_matrix:l.projMatrix,u_extrude_scale:X,u_intensity:k,u_inv_rot_matrix:wu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(G){Z.u_inv_rot_matrix=C,Z.u_merc_center=M,Z.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],Z.u_zoom_transition=p.globeToMercatorTransition(z.zoom);const se=M[0]*p.EXTENT,Ie=M[1]*p.EXTENT;Z.u_up_dir=z.projection.upVector(new p.CanonicalTileID(0,0,0),se,Ie)}return Z},bu=(w,l,g,C,M,P,k)=>{const z=w.transform,G=z.calculatePixelsToTileUnitsMatrix(l);return{u_matrix:lf(w,l,g,C),u_pixels_to_tile_units:G,u_device_pixel_ratio:P,u_units_to_pixels:[1/z.pixelsToGLUnits[0],1/z.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:M,u_texsize:fc(g)?l.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ps(l,w.transform),u_alpha_discard_threshold:0,u_trim_offset:k}},tu=(w,l,g,C,M)=>{const P=w.transform;return{u_matrix:lf(w,l,g,C),u_texsize:l.imageAtlasTexture.size,u_pixels_to_tile_units:P.calculatePixelsToTileUnitsMatrix(l),u_device_pixel_ratio:M,u_image:0,u_tile_units_to_pixels:Ps(l,P),u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Ps(w,l){return 1/ft(w,1,l.tileZoom)}function lf(w,l,g,C){return w.translatePosMatrix(C||l.tileID.projMatrix,l,g.paint.get("line-translate"),g.paint.get("line-translate-anchor"))}function fc(w){const l=w.paint.get("line-dasharray").value;return l.value||"constant"!==l.kind}const Rs=(w,l,g,C,M,P)=>{return{u_matrix:w,u_tl_parent:l,u_scale_parent:g,u_fade_t:C.mix,u_opacity:C.opacity*M.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:M.paint.get("raster-brightness-min"),u_brightness_high:M.paint.get("raster-brightness-max"),u_saturation_factor:(z=M.paint.get("raster-saturation"),z>0?1-1/(1.001-z):-z),u_contrast_factor:(k=M.paint.get("raster-contrast"),k>0?1/(1-k):1+k),u_spin_weights:Fa(M.paint.get("raster-hue-rotate")),u_perspective_transform:P};var k,z};function Fa(w){w*=Math.PI/180;const l=Math.sin(w),g=Math.cos(w);return[(2*g+1)/3,(-Math.sqrt(3)*l-g+1)/3,(Math.sqrt(3)*l-g+1)/3]}const Ba=p.create(),fh=(w,l,g,C,M,P,k,z,G,X,Z,se,Ie,ze,$e,je)=>{const We=M.transform,ue={u_is_size_zoom_constant:+("constant"===w||"source"===w),u_is_size_feature_constant:+("constant"===w||"camera"===w),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:We.cameraToCenterDistance,u_rotate_symbol:+g,u_aspect_ratio:We.width/We.height,u_fade_change:M.options.fadeDuration?M.symbolFadeChange:1,u_matrix:P,u_label_plane_matrix:k,u_coord_matrix:z,u_is_text:+G,u_pitch_with_map:+C,u_texsize:X,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ba,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ba,u_up_vector:[0,-1,0]};return"globe"===je.name&&(ue.u_tile_id=[Z.canonical.x,Z.canonical.y,1<<Z.canonical.z],ue.u_zoom_transition=se,ue.u_inv_rot_matrix=ze,ue.u_merc_center=Ie,ue.u_camera_forward=We._camera.forward(),ue.u_ecef_origin=p.globeECEFOrigin(We.globeMatrix,Z.toUnwrapped()),ue.u_tile_matrix=Float32Array.from(We.globeMatrix),ue.u_up_vector=$e),ue},fa=(w,l,g,C,M,P,k,z,G,X,Z,se,Ie,ze,$e,je,We)=>p.extend(fh(w,l,g,C,M,P,k,z,G,X,se,Ie,ze,$e,je,We),{u_gamma_scale:C?M.transform.cameraToCenterDistance*Math.cos(M.terrain?0:M.transform._pitch):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+Z}),dc=(w,l,g,C,M,P,k,z,G,X,Z,se,Ie,ze,$e,je)=>p.extend(fa(w,l,g,C,M,P,k,z,!0,G,!0,Z,se,Ie,ze,$e,je),{u_texsize_icon:X,u_texture_icon:1}),ql=(w,l,g)=>({u_matrix:w,u_opacity:l,u_color:g}),zh=(w,l,g,C,M)=>p.extend(function(P,k,z){const G=k.imageManager.getPattern(P.toString()),{width:X,height:Z}=k.imageManager.getPixelSize(),se=Math.pow(2,z.tileID.overscaledZ),Ie=z.tileSize*Math.pow(2,k.transform.tileZoom)/se,ze=Ie*(z.tileID.canonical.x+z.tileID.wrap*se),$e=Ie*z.tileID.canonical.y;return{u_image:0,u_pattern_tl:G.tl,u_pattern_br:G.br,u_texsize:[X,Z],u_pattern_size:G.displaySize,u_tile_units_to_pixels:1/ft(z,1,k.transform.tileZoom),u_pixel_coord_upper:[ze>>16,$e>>16],u_pixel_coord_lower:[65535&ze,65535&$e]}}(C,g,M),{u_matrix:w,u_opacity:l}),Of={fillExtrusion:w=>({u_matrix:new p.UniformMatrix4f(w),u_lightpos:new p.Uniform3f(w),u_lightintensity:new p.Uniform1f(w),u_lightcolor:new p.Uniform3f(w),u_vertical_gradient:new p.Uniform1f(w),u_opacity:new p.Uniform1f(w),u_edge_radius:new p.Uniform1f(w),u_ao:new p.Uniform2f(w),u_tile_id:new p.Uniform3f(w),u_zoom_transition:new p.Uniform1f(w),u_inv_rot_matrix:new p.UniformMatrix4f(w),u_merc_center:new p.Uniform2f(w),u_up_dir:new p.Uniform3f(w),u_height_lift:new p.Uniform1f(w)}),fillExtrusionPattern:w=>({u_matrix:new p.UniformMatrix4f(w),u_lightpos:new p.Uniform3f(w),u_lightintensity:new p.Uniform1f(w),u_lightcolor:new p.Uniform3f(w),u_vertical_gradient:new p.Uniform1f(w),u_height_factor:new p.Uniform1f(w),u_edge_radius:new p.Uniform1f(w),u_ao:new p.Uniform2f(w),u_tile_id:new p.Uniform3f(w),u_zoom_transition:new p.Uniform1f(w),u_inv_rot_matrix:new p.UniformMatrix4f(w),u_merc_center:new p.Uniform2f(w),u_up_dir:new p.Uniform3f(w),u_height_lift:new p.Uniform1f(w),u_image:new p.Uniform1i(w),u_texsize:new p.Uniform2f(w),u_pixel_coord_upper:new p.Uniform2f(w),u_pixel_coord_lower:new p.Uniform2f(w),u_tile_units_to_pixels:new p.Uniform1f(w),u_opacity:new p.Uniform1f(w)}),fill:w=>({u_matrix:new p.UniformMatrix4f(w)}),fillPattern:w=>({u_matrix:new p.UniformMatrix4f(w),u_image:new p.Uniform1i(w),u_texsize:new p.Uniform2f(w),u_pixel_coord_upper:new p.Uniform2f(w),u_pixel_coord_lower:new p.Uniform2f(w),u_tile_units_to_pixels:new p.Uniform1f(w)}),fillOutline:w=>({u_matrix:new p.UniformMatrix4f(w),u_world:new p.Uniform2f(w)}),fillOutlinePattern:w=>({u_matrix:new p.UniformMatrix4f(w),u_world:new p.Uniform2f(w),u_image:new p.Uniform1i(w),u_texsize:new p.Uniform2f(w),u_pixel_coord_upper:new p.Uniform2f(w),u_pixel_coord_lower:new p.Uniform2f(w),u_tile_units_to_pixels:new p.Uniform1f(w)}),circle:w=>({u_camera_to_center_distance:new p.Uniform1f(w),u_extrude_scale:new p.UniformMatrix2f(w),u_device_pixel_ratio:new p.Uniform1f(w),u_matrix:new p.UniformMatrix4f(w),u_inv_rot_matrix:new p.UniformMatrix4f(w),u_merc_center:new p.Uniform2f(w),u_tile_id:new p.Uniform3f(w),u_zoom_transition:new p.Uniform1f(w),u_up_dir:new p.Uniform3f(w)}),collisionBox:w=>({u_matrix:new p.UniformMatrix4f(w),u_camera_to_center_distance:new p.Uniform1f(w),u_extrude_scale:new p.Uniform2f(w)}),collisionCircle:w=>({u_matrix:new p.UniformMatrix4f(w),u_inv_matrix:new p.UniformMatrix4f(w),u_camera_to_center_distance:new p.Uniform1f(w),u_viewport_size:new p.Uniform2f(w)}),debug:w=>({u_color:new p.UniformColor(w),u_matrix:new p.UniformMatrix4f(w),u_overlay:new p.Uniform1i(w),u_overlay_scale:new p.Uniform1f(w)}),clippingMask:w=>({u_matrix:new p.UniformMatrix4f(w)}),heatmap:w=>({u_extrude_scale:new p.Uniform1f(w),u_intensity:new p.Uniform1f(w),u_matrix:new p.UniformMatrix4f(w),u_inv_rot_matrix:new p.UniformMatrix4f(w),u_merc_center:new p.Uniform2f(w),u_tile_id:new p.Uniform3f(w),u_zoom_transition:new p.Uniform1f(w),u_up_dir:new p.Uniform3f(w)}),heatmapTexture:w=>({u_image:new p.Uniform1i(w),u_color_ramp:new p.Uniform1i(w),u_opacity:new p.Uniform1f(w)}),hillshade:w=>({u_matrix:new p.UniformMatrix4f(w),u_image:new p.Uniform1i(w),u_latrange:new p.Uniform2f(w),u_light:new p.Uniform2f(w),u_shadow:new p.UniformColor(w),u_highlight:new p.UniformColor(w),u_accent:new p.UniformColor(w)}),hillshadePrepare:w=>({u_matrix:new p.UniformMatrix4f(w),u_image:new p.Uniform1i(w),u_dimension:new p.Uniform2f(w),u_zoom:new p.Uniform1f(w),u_unpack:new p.Uniform4f(w)}),line:w=>({u_matrix:new p.UniformMatrix4f(w),u_pixels_to_tile_units:new p.UniformMatrix2f(w),u_device_pixel_ratio:new p.Uniform1f(w),u_units_to_pixels:new p.Uniform2f(w),u_dash_image:new p.Uniform1i(w),u_gradient_image:new p.Uniform1i(w),u_image_height:new p.Uniform1f(w),u_texsize:new p.Uniform2f(w),u_tile_units_to_pixels:new p.Uniform1f(w),u_alpha_discard_threshold:new p.Uniform1f(w),u_trim_offset:new p.Uniform2f(w)}),linePattern:w=>({u_matrix:new p.UniformMatrix4f(w),u_texsize:new p.Uniform2f(w),u_pixels_to_tile_units:new p.UniformMatrix2f(w),u_device_pixel_ratio:new p.Uniform1f(w),u_image:new p.Uniform1i(w),u_units_to_pixels:new p.Uniform2f(w),u_tile_units_to_pixels:new p.Uniform1f(w),u_alpha_discard_threshold:new p.Uniform1f(w)}),raster:w=>({u_matrix:new p.UniformMatrix4f(w),u_tl_parent:new p.Uniform2f(w),u_scale_parent:new p.Uniform1f(w),u_fade_t:new p.Uniform1f(w),u_opacity:new p.Uniform1f(w),u_image0:new p.Uniform1i(w),u_image1:new p.Uniform1i(w),u_brightness_low:new p.Uniform1f(w),u_brightness_high:new p.Uniform1f(w),u_saturation_factor:new p.Uniform1f(w),u_contrast_factor:new p.Uniform1f(w),u_spin_weights:new p.Uniform3f(w),u_perspective_transform:new p.Uniform2f(w)}),symbolIcon:w=>({u_is_size_zoom_constant:new p.Uniform1i(w),u_is_size_feature_constant:new p.Uniform1i(w),u_size_t:new p.Uniform1f(w),u_size:new p.Uniform1f(w),u_camera_to_center_distance:new p.Uniform1f(w),u_rotate_symbol:new p.Uniform1i(w),u_aspect_ratio:new p.Uniform1f(w),u_fade_change:new p.Uniform1f(w),u_matrix:new p.UniformMatrix4f(w),u_label_plane_matrix:new p.UniformMatrix4f(w),u_coord_matrix:new p.UniformMatrix4f(w),u_is_text:new p.Uniform1i(w),u_pitch_with_map:new p.Uniform1i(w),u_texsize:new p.Uniform2f(w),u_tile_id:new p.Uniform3f(w),u_zoom_transition:new p.Uniform1f(w),u_inv_rot_matrix:new p.UniformMatrix4f(w),u_merc_center:new p.Uniform2f(w),u_camera_forward:new p.Uniform3f(w),u_tile_matrix:new p.UniformMatrix4f(w),u_up_vector:new p.Uniform3f(w),u_ecef_origin:new p.Uniform3f(w),u_texture:new p.Uniform1i(w)}),symbolSDF:w=>({u_is_size_zoom_constant:new p.Uniform1i(w),u_is_size_feature_constant:new p.Uniform1i(w),u_size_t:new p.Uniform1f(w),u_size:new p.Uniform1f(w),u_camera_to_center_distance:new p.Uniform1f(w),u_rotate_symbol:new p.Uniform1i(w),u_aspect_ratio:new p.Uniform1f(w),u_fade_change:new p.Uniform1f(w),u_matrix:new p.UniformMatrix4f(w),u_label_plane_matrix:new p.UniformMatrix4f(w),u_coord_matrix:new p.UniformMatrix4f(w),u_is_text:new p.Uniform1i(w),u_pitch_with_map:new p.Uniform1i(w),u_texsize:new p.Uniform2f(w),u_texture:new p.Uniform1i(w),u_gamma_scale:new p.Uniform1f(w),u_device_pixel_ratio:new p.Uniform1f(w),u_tile_id:new p.Uniform3f(w),u_zoom_transition:new p.Uniform1f(w),u_inv_rot_matrix:new p.UniformMatrix4f(w),u_merc_center:new p.Uniform2f(w),u_camera_forward:new p.Uniform3f(w),u_tile_matrix:new p.UniformMatrix4f(w),u_up_vector:new p.Uniform3f(w),u_ecef_origin:new p.Uniform3f(w),u_is_halo:new p.Uniform1i(w)}),symbolTextAndIcon:w=>({u_is_size_zoom_constant:new p.Uniform1i(w),u_is_size_feature_constant:new p.Uniform1i(w),u_size_t:new p.Uniform1f(w),u_size:new p.Uniform1f(w),u_camera_to_center_distance:new p.Uniform1f(w),u_rotate_symbol:new p.Uniform1i(w),u_aspect_ratio:new p.Uniform1f(w),u_fade_change:new p.Uniform1f(w),u_matrix:new p.UniformMatrix4f(w),u_label_plane_matrix:new p.UniformMatrix4f(w),u_coord_matrix:new p.UniformMatrix4f(w),u_is_text:new p.Uniform1i(w),u_pitch_with_map:new p.Uniform1i(w),u_texsize:new p.Uniform2f(w),u_texsize_icon:new p.Uniform2f(w),u_texture:new p.Uniform1i(w),u_texture_icon:new p.Uniform1i(w),u_gamma_scale:new p.Uniform1f(w),u_device_pixel_ratio:new p.Uniform1f(w),u_is_halo:new p.Uniform1i(w)}),background:w=>({u_matrix:new p.UniformMatrix4f(w),u_opacity:new p.Uniform1f(w),u_color:new p.UniformColor(w)}),backgroundPattern:w=>({u_matrix:new p.UniformMatrix4f(w),u_opacity:new p.Uniform1f(w),u_image:new p.Uniform1i(w),u_pattern_tl:new p.Uniform2f(w),u_pattern_br:new p.Uniform2f(w),u_texsize:new p.Uniform2f(w),u_pattern_size:new p.Uniform2f(w),u_pixel_coord_upper:new p.Uniform2f(w),u_pixel_coord_lower:new p.Uniform2f(w),u_tile_units_to_pixels:new p.Uniform1f(w)}),terrainRaster:$l,terrainDepth:$l,skybox:w=>({u_matrix:new p.UniformMatrix4f(w),u_sun_direction:new p.Uniform3f(w),u_cubemap:new p.Uniform1i(w),u_opacity:new p.Uniform1f(w),u_temporal_offset:new p.Uniform1f(w)}),skyboxGradient:w=>({u_matrix:new p.UniformMatrix4f(w),u_color_ramp:new p.Uniform1i(w),u_center_direction:new p.Uniform3f(w),u_radius:new p.Uniform1f(w),u_opacity:new p.Uniform1f(w),u_temporal_offset:new p.Uniform1f(w)}),skyboxCapture:w=>({u_matrix_3f:new p.UniformMatrix3f(w),u_sun_direction:new p.Uniform3f(w),u_sun_intensity:new p.Uniform1f(w),u_color_tint_r:new p.Uniform4f(w),u_color_tint_m:new p.Uniform4f(w),u_luminance:new p.Uniform1f(w)}),globeRaster:w=>({u_proj_matrix:new p.UniformMatrix4f(w),u_globe_matrix:new p.UniformMatrix4f(w),u_normalize_matrix:new p.UniformMatrix4f(w),u_merc_matrix:new p.UniformMatrix4f(w),u_zoom_transition:new p.Uniform1f(w),u_merc_center:new p.Uniform2f(w),u_image0:new p.Uniform1i(w),u_grid_matrix:new p.UniformMatrix3f(w),u_skirt_height:new p.Uniform1f(w),u_frustum_tl:new p.Uniform3f(w),u_frustum_tr:new p.Uniform3f(w),u_frustum_br:new p.Uniform3f(w),u_frustum_bl:new p.Uniform3f(w),u_globe_pos:new p.Uniform3f(w),u_globe_radius:new p.Uniform1f(w),u_viewport:new p.Uniform2f(w)}),globeAtmosphere:w=>({u_frustum_tl:new p.Uniform3f(w),u_frustum_tr:new p.Uniform3f(w),u_frustum_br:new p.Uniform3f(w),u_frustum_bl:new p.Uniform3f(w),u_horizon:new p.Uniform1f(w),u_transition:new p.Uniform1f(w),u_fadeout_range:new p.Uniform1f(w),u_color:new p.Uniform4f(w),u_high_color:new p.Uniform4f(w),u_space_color:new p.Uniform4f(w),u_star_intensity:new p.Uniform1f(w),u_star_density:new p.Uniform1f(w),u_star_size:new p.Uniform1f(w),u_temporal_offset:new p.Uniform1f(w),u_horizon_angle:new p.Uniform1f(w),u_rotation_matrix:new p.UniformMatrix4f(w)})};let Nu;function Eu(w,l,g,C,M,P,k){const z=w.context,G=z.gl,X=w.transform,Z=w.useProgram("collisionBox"),se=[];let Ie=0,ze=0;for(let Qe=0;Qe<C.length;Qe++){const Et=C[Qe],St=l.getTile(Et),at=St.getBucket(g);if(!at)continue;const Ot=Qs(Et,at,X);let Rt=Ot;0===M[0]&&0===M[1]||(Rt=w.translatePosMatrix(Ot,St,M,P));const kt=k?at.textCollisionBox:at.iconCollisionBox,Dn=at.collisionCircleArray;if(Dn.length>0){const Ut=p.create(),an=Rt;p.mul(Ut,at.placementInvProjMatrix,X.glCoordMatrix),p.mul(Ut,Ut,at.placementViewportMatrix),se.push({circleArray:Dn,circleOffset:ze,transform:an,invTransform:Ut,projection:at.getProjection()}),Ie+=Dn.length/4,ze=Ie}kt&&(w.terrain&&w.terrain.setupElevationDraw(St,Z),Z.draw(z,G.LINES,p.DepthMode.disabled,p.StencilMode.disabled,w.colorModeForRenderPass(),p.CullFaceMode.disabled,Ou(Rt,X,St,at.getProjection()),g.id,kt.layoutVertexBuffer,kt.indexBuffer,kt.segments,null,X.zoom,null,[kt.collisionVertexBuffer,kt.collisionVertexBufferExt]))}if(!k||!se.length)return;const $e=w.useProgram("collisionCircle"),je=new p.StructArrayLayout2f1f2i16;je.resize(4*Ie),je._trim();let We=0;for(const Qe of se)for(let Et=0;Et<Qe.circleArray.length/4;Et++){const St=4*Et,at=Qe.circleArray[St+0],Ot=Qe.circleArray[St+1],Rt=Qe.circleArray[St+2],kt=Qe.circleArray[St+3];je.emplace(We++,at,Ot,Rt,kt,0),je.emplace(We++,at,Ot,Rt,kt,1),je.emplace(We++,at,Ot,Rt,kt,2),je.emplace(We++,at,Ot,Rt,kt,3)}(!Nu||Nu.length<2*Ie)&&(Nu=function(Qe){const Et=2*Qe,St=new p.StructArrayLayout3ui6;St.resize(Et),St._trim();for(let at=0;at<Et;at++){const Ot=6*at;St.uint16[Ot+0]=4*at+0,St.uint16[Ot+1]=4*at+1,St.uint16[Ot+2]=4*at+2,St.uint16[Ot+3]=4*at+2,St.uint16[Ot+4]=4*at+3,St.uint16[Ot+5]=4*at+0}return St}(Ie));const ue=z.createIndexBuffer(Nu,!0),Fe=z.createVertexBuffer(je,p.collisionCircleLayout.members,!0);for(const Qe of se){const Et={u_matrix:Qe.transform,u_inv_matrix:Qe.invTransform,u_camera_to_center_distance:(nt=X).getCameraToCenterDistance(Qe.projection),u_viewport_size:[nt.width,nt.height]};$e.draw(z,G.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,w.colorModeForRenderPass(),p.CullFaceMode.disabled,Et,g.id,Fe,ue,p.SegmentVector.simpleSegment(0,2*Qe.circleOffset,Qe.circleArray.length,Qe.circleArray.length/2),null,X.zoom)}var nt;Fe.destroy(),ue.destroy()}const ea=p.create();function ta({width:w,height:l,anchor:g,textOffset:C,textScale:M},P){const{horizontalAlign:k,verticalAlign:z}=p.getAnchorAlignment(g),G=-(k-.5)*w,X=-(z-.5)*l,Z=p.evaluateVariableOffset(g,C);return new p.Point((G/M+Z[0])*P,(X/M+Z[1])*P)}function Uh(w,l,g,C,M,P,k,z,G,X,Z){const se=w.text.placedSymbolArray,Ie=w.text.dynamicLayoutVertexArray,ze=w.icon.dynamicLayoutVertexArray,$e={},je=w.getProjection(),We=ur(z,je,P),ue=P.elevation,Fe=je.upVectorScale(z.canonical,P.center.lat,P.worldSize).metersToTile;Ie.clear();for(let nt=0;nt<se.length;nt++){const Qe=se.get(nt),{tileAnchorX:Et,tileAnchorY:St,numGlyphs:at}=Qe,Ot=Qe.hidden||!Qe.crossTileID||w.allowVerticalPlacement&&!Qe.placedOrientation?null:C[Qe.crossTileID];if(Ot){let Rt=0,kt=0,Dn=0;if(ue){const Ln=ue?ue.getAtTileOffset(z,Et,St):0,[wr,Vr,or]=je.upVector(z.canonical,Et,St);Rt=Ln*wr*Fe,kt=Ln*Vr*Fe,Dn=Ln*or*Fe}let[Ut,an,Ht,gn]=aa(Qe.projectedAnchorX+Rt,Qe.projectedAnchorY+kt,Qe.projectedAnchorZ+Dn,g?We:k);const Gt=Ds(P.getCameraToCenterDistance(je),gn);let fn=M.evaluateSizeForFeature(w.textSizeData,X,Qe)*Gt/p.ONE_EM;g&&(fn*=w.tilePixelRatio/G);const En=ta(Ot,fn);g?(({x:Ut,y:an,z:Ht}=je.projectTilePoint(Et+En.x,St+En.y,z.canonical)),[Ut,an,Ht]=aa(Ut+Rt,an+kt,Ht+Dn,k)):(l&&En._rotate(-P.angle),Ut+=En.x,an+=En.y,Ht=0);const vn=w.allowVerticalPlacement&&Qe.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let Ln=0;Ln<at;Ln++)p.addDynamicAttributes(Ie,Ut,an,Ht,vn);Z&&Qe.associatedIconIndex>=0&&($e[Qe.associatedIconIndex]={x:Ut,y:an,z:Ht,angle:vn})}else er(at,Ie)}if(Z){ze.clear();const nt=w.icon.placedSymbolArray;for(let Qe=0;Qe<nt.length;Qe++){const Et=nt.get(Qe),{numGlyphs:St}=Et,at=$e[Qe];if(Et.hidden||!at)er(St,ze);else{const{x:Ot,y:Rt,z:kt,angle:Dn}=at;for(let Ut=0;Ut<St;Ut++)p.addDynamicAttributes(ze,Ot,Rt,kt,Dn)}}w.icon.dynamicLayoutVertexBuffer.updateData(ze)}w.text.dynamicLayoutVertexBuffer.updateData(Ie)}function Ma(w,l,g){return g.iconsInText&&l?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function Ml(w,l,g,C,M,P,k,z,G,X,Z,se){const Ie=w.context,ze=Ie.gl,$e=w.transform,je="map"===z,We="map"===G,ue=je&&"point"!==g.layout.get("symbol-placement"),Fe=je&&!We&&!ue,nt=void 0!==g.layout.get("symbol-sort-key").constantOr(1);let Qe=!1;const Et=w.depthModeForSublayer(0,p.DepthMode.ReadOnly),St=[p.mercatorXfromLng($e.center.lng),p.mercatorYfromLat($e.center.lat)],at=g.layout.get("text-variable-anchor"),Ot="globe"===$e.projection.name,Rt=[],kt=[0,-1,0];let Dn=kt;!Ot&&!$e.mercatorFromTransition||je||(Dn=function(Ut){const an=Ut._camera.getWorldToCamera(Ut.worldSize,1),Ht=p.multiply([],an,Ut.globeMatrix);p.invert(Ht,Ht);const gn=[0,0,0],Gt=[0,1,0,0];return p.transformMat4$1(Gt,Gt,Ht),gn[0]=Gt[0],gn[1]=Gt[1],gn[2]=Gt[2],p.normalize(gn,gn),gn}($e));for(const Ut of C){const an=l.getTile(Ut),Ht=an.getBucket(g);if(!Ht||"mercator"===Ht.projection.name&&Ot)continue;const gn=M?Ht.text:Ht.icon;if(!gn||Ht.fullyClipped||!gn.segments.get().length)continue;const Gt=gn.programConfigurations.get(g.id),fn=M||Ht.sdfIcons,En=M?Ht.textSizeData:Ht.iconSizeData,vn=We||0!==$e.pitch,Ln=p.evaluateSizeForZoom(En,$e.zoom);let wr,Vr,or,Ar,Xn=[0,0],ci=null;if(M)Vr=an.glyphAtlasTexture,or=ze.LINEAR,wr=an.glyphAtlasTexture.size,Ht.iconsInText&&(Xn=an.imageAtlasTexture.size,ci=an.imageAtlasTexture,Ar=vn||w.options.rotating||w.options.zooming||"composite"===En.kind||"camera"===En.kind?ze.LINEAR:ze.NEAREST);else{const mc=1!==g.layout.get("icon-size").constantOr(0)||Ht.iconsNeedLinear;Vr=an.imageAtlasTexture,or=fn||w.options.rotating||w.options.zooming||mc||vn?ze.LINEAR:ze.NEAREST,wr=an.imageAtlasTexture.size}const yr="globe"===Ht.projection.name,bo=yr?Dn:kt,Ko=yr?p.globeToMercatorTransition($e.zoom):0,us=ur(Ut,Ht.getProjection(),$e),ls=$e.calculatePixelsToTileUnitsMatrix(an),Va=on(us,an.tileID.canonical,We,je,$e,Ht.getProjection(),ls),Iu=w.terrain&&We&&ue?p.invert(p.create(),Va):ea,Xl=Ms(us,an.tileID.canonical,We,je,$e,Ht.getProjection(),ls),pc=at&&Ht.hasTextData(),Ks="none"!==g.layout.get("icon-text-fit")&&pc&&Ht.hasIconData();if(ue){const mc=$e.elevation,Zc=mc?mc.getAtTileOffsetFunc(Ut,$e.center.lat,$e.worldSize,Ht.getProjection()):null,ph=Wu(us,an.tileID.canonical,We,je,$e,Ht.getProjection(),ls);Xu(Ht,us,w,M,ph,Xl,We,X,Zc,Ut)}const Jo=ue||M&&at||Ks,ln=w.translatePosMatrix(us,an,P,k),Wr=Jo?ea:Va,ol=w.translatePosMatrix(Xl,an,P,k,!0),vs=Ht.getProjection().createInversionMatrix($e,Ut.canonical),xs=[];w.terrainRenderModeElevated()&&We&&xs.push("PITCH_WITH_MAP_TERRAIN"),yr&&xs.push("PROJECTION_GLOBE_VIEW"),Jo&&xs.push("PROJECTED_POS_ON_VIEWPORT");const zf=fn&&0!==g.paint.get(M?"text-halo-width":"icon-halo-width").constantOr(1);let gc;gc=fn?Ht.iconsInText?dc(En.kind,Ln,Fe,We,w,ln,Wr,ol,wr,Xn,Ut,Ko,St,vs,bo,Ht.getProjection()):fa(En.kind,Ln,Fe,We,w,ln,Wr,ol,M,wr,!0,Ut,Ko,St,vs,bo,Ht.getProjection()):fh(En.kind,Ln,Fe,We,w,ln,Wr,ol,M,wr,Ut,Ko,St,vs,bo,Ht.getProjection());const Pl={program:w.useProgram(Ma(fn,M,Ht),Gt,xs),buffers:gn,uniformValues:gc,atlasTexture:Vr,atlasTextureIcon:ci,atlasInterpolation:or,atlasInterpolationIcon:Ar,isSDF:fn,hasHalo:zf,tile:an,labelPlaneMatrixInv:Iu};if(nt&&Ht.canOverlap){Qe=!0;const mc=gn.segments.get();for(const Zc of mc)Rt.push({segments:new p.SegmentVector([Zc]),sortKey:Zc.sortKey,state:Pl})}else Rt.push({segments:gn.segments,sortKey:0,state:Pl})}Qe&&Rt.sort((Ut,an)=>Ut.sortKey-an.sortKey);for(const Ut of Rt){const an=Ut.state;if(w.terrain&&w.terrain.setupElevationDraw(an.tile,an.program,{useDepthForOcclusion:!Ot,labelPlaneMatrixInv:an.labelPlaneMatrixInv}),Ie.activeTexture.set(ze.TEXTURE0),an.atlasTexture.bind(an.atlasInterpolation,ze.CLAMP_TO_EDGE),an.atlasTextureIcon&&(Ie.activeTexture.set(ze.TEXTURE1),an.atlasTextureIcon&&an.atlasTextureIcon.bind(an.atlasInterpolationIcon,ze.CLAMP_TO_EDGE)),an.isSDF){const Ht=an.uniformValues;an.hasHalo&&(Ht.u_is_halo=1,yl(an.buffers,Ut.segments,g,w,an.program,Et,Z,se,Ht)),Ht.u_is_halo=0}yl(an.buffers,Ut.segments,g,w,an.program,Et,Z,se,an.uniformValues)}}function yl(w,l,g,C,M,P,k,z,G){const X=C.context,Z=[w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer,w.globeExtVertexBuffer];M.draw(X,X.gl.TRIANGLES,P,k,z,p.CullFaceMode.disabled,G,g.id,w.layoutVertexBuffer,w.indexBuffer,l,g.paint,C.transform.zoom,w.programConfigurations.get(g.id),Z)}function Nf(w,l,g,C,M,P,k){const z=w.context.gl,G=g.paint.get("fill-pattern"),X=G&&G.constantOr(1);let Z,se,Ie,ze,$e;k?(se=X&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Z=z.LINES):(se=X?"fillPattern":"fill",Z=z.TRIANGLES);for(const je of C){const We=l.getTile(je);if(X&&!We.patternsLoaded())continue;const ue=We.getBucket(g);if(!ue)continue;w.prepareDrawTile();const Fe=ue.programConfigurations.get(g.id),nt=w.useProgram(se,Fe);X&&(w.context.activeTexture.set(z.TEXTURE0),We.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Fe.updatePaintBuffers());const Qe=G.constantOr(null);if(Qe&&We.imageAtlas){const St=We.imageAtlas.patternPositions[Qe.toString()];St&&Fe.setConstantPatternPositions(St)}const Et=w.translatePosMatrix(je.projMatrix,We,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor"));if(k){ze=ue.indexBuffer2,$e=ue.segments2;const St=w.terrain&&w.terrain.renderingToTexture?w.terrain.drapeBufferSize:[z.drawingBufferWidth,z.drawingBufferHeight];Ie="fillOutlinePattern"===se&&X?Tl(Et,w,We,St):ss(Et,St)}else ze=ue.indexBuffer,$e=ue.segments,Ie=X?lu(Et,w,We):eu(Et);w.prepareDrawProgram(w.context,nt,je.toUnwrapped()),nt.draw(w.context,Z,M,w.stencilModeForClipping(je),P,p.CullFaceMode.disabled,Ie,g.id,ue.layoutVertexBuffer,ze,$e,g.paint,w.transform.zoom,Fe)}}function _l(w,l,g,C,M,P,k){const z=w.context,G=z.gl,X=w.transform,Z=g.paint.get("fill-extrusion-pattern"),se=Z.constantOr(1),Ie=g.paint.get("fill-extrusion-opacity"),ze=[g.paint.get("fill-extrusion-ambient-occlusion-intensity"),g.paint.get("fill-extrusion-ambient-occlusion-radius")],$e=g.layout.get("fill-extrusion-edge-radius"),je=$e>0&&!g.paint.get("fill-extrusion-rounded-roof"),We=je?0:$e,ue="globe"===X.projection.name?p.fillExtrusionHeightLift():0,Fe="globe"===X.projection.name,nt=Fe?p.globeToMercatorTransition(X.zoom):0,Qe=[p.mercatorXfromLng(X.center.lng),p.mercatorYfromLat(X.center.lat)],Et=[];Fe&&Et.push("PROJECTION_GLOBE_VIEW"),ze[0]>0&&Et.push("FAUX_AO"),je&&Et.push("ZERO_ROOF_RADIUS");for(const St of C){const at=l.getTile(St),Ot=at.getBucket(g);if(!Ot||Ot.projection.name!==X.projection.name)continue;const Rt=Ot.programConfigurations.get(g.id),kt=w.useProgram(se?"fillExtrusionPattern":"fillExtrusion",Rt,Et);if(w.terrain){const fn=w.terrain;if(w.style.terrainSetForDrapingOnly())fn.setupElevationDraw(at,kt,{useMeterToDem:!0});else{if(!Ot.enableTerrain)continue;if(fn.setupElevationDraw(at,kt,{useMeterToDem:!0}),Lt(z,l,St,Ot,g,fn),!Ot.centroidVertexBuffer){const En=kt.attributes.a_centroid_pos;void 0!==En&&G.vertexAttrib2f(En,0,0)}}}se&&(w.context.activeTexture.set(G.TEXTURE0),at.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Rt.updatePaintBuffers());const Dn=Z.constantOr(null);if(Dn&&at.imageAtlas){const fn=at.imageAtlas.patternPositions[Dn.toString()];fn&&Rt.setConstantPatternPositions(fn)}const Ut=w.translatePosMatrix(St.projMatrix,at,g.paint.get("fill-extrusion-translate"),g.paint.get("fill-extrusion-translate-anchor")),an=X.projection.createInversionMatrix(X,St.canonical),Ht=g.paint.get("fill-extrusion-vertical-gradient"),gn=se?kc(Ut,w,Ht,Ie,ze,We,St,at,ue,nt,Qe,an):ha(Ut,w,Ht,Ie,ze,We,St,ue,nt,Qe,an);w.prepareDrawProgram(z,kt,St.toUnwrapped());const Gt=[];w.terrain&&Gt.push(Ot.centroidVertexBuffer),Fe&&Gt.push(Ot.layoutVertexExtBuffer),kt.draw(z,z.gl.TRIANGLES,M,P,k,p.CullFaceMode.backCCW,gn,g.id,Ot.layoutVertexBuffer,Ot.indexBuffer,Ot.segments,g.paint,w.transform.zoom,Rt,Gt)}}function Lt(w,l,g,C,M,P){const k=[ue=>{let Fe=ue.canonical.x-1,nt=ue.wrap;return Fe<0&&(Fe=(1<<ue.canonical.z)-1,nt--),new p.OverscaledTileID(ue.overscaledZ,nt,ue.canonical.z,Fe,ue.canonical.y)},ue=>{let Fe=ue.canonical.x+1,nt=ue.wrap;return Fe===1<<ue.canonical.z&&(Fe=0,nt++),new p.OverscaledTileID(ue.overscaledZ,nt,ue.canonical.z,Fe,ue.canonical.y)},ue=>new p.OverscaledTileID(ue.overscaledZ,ue.wrap,ue.canonical.z,ue.canonical.x,(0===ue.canonical.y?1<<ue.canonical.z:ue.canonical.y)-1),ue=>new p.OverscaledTileID(ue.overscaledZ,ue.wrap,ue.canonical.z,ue.canonical.x,ue.canonical.y===(1<<ue.canonical.z)-1?0:ue.canonical.y+1)],z=ue=>{const Fe=l.getSource().minzoom,nt=Et=>{const St=l.getTileByID(Et);if(St&&St.hasData())return St.getBucket(M)},Qe=[0,-1,1];for(const Et of Qe){if(ue.overscaledZ+Et<Fe)continue;const St=nt(ue.calculateScaledKey(ue.overscaledZ+Et));if(St)return St}},G=[0,0,0],X=(ue,Fe)=>(G[0]=Math.min(ue.min.y,Fe.min.y),G[1]=Math.max(ue.max.y,Fe.max.y),G[2]=p.EXTENT-Fe.min.x>ue.max.x?Fe.min.x-p.EXTENT:ue.max.x,G),Z=(ue,Fe)=>(G[0]=Math.min(ue.min.x,Fe.min.x),G[1]=Math.max(ue.max.x,Fe.max.x),G[2]=p.EXTENT-Fe.min.y>ue.max.y?Fe.min.y-p.EXTENT:ue.max.y,G),se=[(ue,Fe)=>X(ue,Fe),(ue,Fe)=>X(Fe,ue),(ue,Fe)=>Z(ue,Fe),(ue,Fe)=>Z(Fe,ue)],Ie=new p.Point(0,0);let ze,$e,je;const We=(ue,Fe,nt,Qe,Et)=>{const St=[[Qe?nt:ue,Qe?ue:nt,0],[Qe?nt:Fe,Qe?Fe:nt,0]],at=Et<0?p.EXTENT+Et:Et,Ot=[Qe?at:(ue+Fe)/2,Qe?(ue+Fe)/2:at,0];return 0===nt&&Et<0||0!==nt&&Et>0?P.getForTilePoints(je,[Ot],!0,$e):St.push(Ot),P.getForTilePoints(g,St,!0,ze),Math.max(St[0][2],St[1][2],Ot[2])/P.exaggeration()};for(let ue=0;ue<4;ue++){const Fe=(ue<2?1:5)-ue,nt=C.borders[ue];if(0===nt.length)continue;const Qe=je=k[ue](g),Et=z(Qe);if(!(Et&&Et instanceof p.FillExtrusionBucket&&Et.enableTerrain)||C.borderDoneWithNeighborZ[ue]===Et.canonical.z&&Et.borderDoneWithNeighborZ[Fe]===C.canonical.z||($e=P.findDEMTileFor(Qe),!$e||!$e.dem))continue;if(!ze){const Rt=P.findDEMTileFor(g);if(!Rt||!Rt.dem)return;ze=Rt}const St=Et.borders[Fe];let at=0;const Ot=Et.borderDoneWithNeighborZ[Fe]!==C.canonical.z;if(C.canonical.z===Et.canonical.z){for(let Rt=0;Rt<nt.length;Rt++){const kt=C.featuresOnBorder[nt[Rt]],Dn=kt.borders[ue];let Ut;for(;at<St.length&&(Ut=Et.featuresOnBorder[St[at]],!(Ut.borders[Fe][1]>Dn[0]+3));)Ot&&Et.encodeCentroid(void 0,Ut,!1),at++;if(Ut&&at<St.length){const an=at;let Ht=0;for(;!(Ut.borders[Fe][0]>Dn[1]-3)&&(Ht++,++at!==St.length);)Ut=Et.featuresOnBorder[St[at]];if(Ut=Et.featuresOnBorder[St[an]],kt.intersectsCount()>1||Ut.intersectsCount()>1||1!==Ht){1!==Ht&&(at=an),C.encodeCentroid(void 0,kt,!1),Ot&&Et.encodeCentroid(void 0,Ut,!1);continue}const gn=se[ue](kt,Ut),Gt=ue%2?p.EXTENT-1:0;Ie.x=We(gn[0],Math.min(p.EXTENT-1,gn[1]),Gt,ue<2,gn[2]),Ie.y=0,C.encodeCentroid(Ie,kt,!1),Ot&&Et.encodeCentroid(Ie,Ut,!1)}else C.encodeCentroid(void 0,kt,!1)}C.borderDoneWithNeighborZ[ue]=Et.canonical.z,C.needsCentroidUpdate=!0,Ot&&(Et.borderDoneWithNeighborZ[Fe]=C.canonical.z,Et.needsCentroidUpdate=!0)}else{for(const Rt of nt)C.encodeCentroid(void 0,C.featuresOnBorder[Rt],!1);if(Ot){for(const Rt of St)Et.encodeCentroid(void 0,Et.featuresOnBorder[Rt],!1);Et.borderDoneWithNeighborZ[Fe]=C.canonical.z,Et.needsCentroidUpdate=!0}C.borderDoneWithNeighborZ[ue]=Et.canonical.z,C.needsCentroidUpdate=!0}}(C.needsCentroidUpdate||!C.centroidVertexBuffer&&0!==C.centroidVertexArray.length)&&C.uploadCentroid(w)}const un=new p.Color(1,0,0,1),Qt=new p.Color(0,1,0,1),ir=new p.Color(0,0,1,1),Tr=new p.Color(1,0,1,1),qi=new p.Color(0,1,1,1);function Es(w,l,g){const C=w.context,M=w.transform,P=C.gl,k="globe"===M.projection.name,z=k?["PROJECTION_GLOBE_VIEW"]:null;let G=g.projMatrix;if(k&&p.globeToMercatorTransition(M.zoom)>0){const kt=p.transitionTileAABBinECEF(g.canonical,M),Dn=p.globeDenormalizeECEF(kt);G=p.multiply(new Float32Array(16),M.globeMatrix,Dn),p.multiply(G,M.projMatrix,G)}const X=w.useProgram("debug",null,z),Z=l.getTileByID(g.key);w.terrain&&w.terrain.setupElevationDraw(Z,X);const se=p.DepthMode.disabled,Ie=p.StencilMode.disabled,ze=w.colorModeForRenderPass();C.activeTexture.set(P.TEXTURE0),w.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),k?Z._makeGlobeTileDebugBuffers(w.context,M):Z._makeDebugTileBoundsBuffers(w.context,M.projection);const je=Z._tileDebugBuffer||w.debugBuffer,We=Z._tileDebugIndexBuffer||w.debugIndexBuffer,ue=Z._tileDebugSegments||w.debugSegments;X.draw(C,P.LINE_STRIP,se,Ie,ze,p.CullFaceMode.disabled,Ws(G,p.Color.red),"$debug",je,We,ue,null,null,null,[Z._globeTileDebugBorderBuffer]);const Fe=Z.latestRawTileData,nt=Math.floor((Fe&&Fe.byteLength||0)/1024),Qe=l.getTile(g).tileSize,Et=512/Math.min(Qe,512)*(g.overscaledZ/M.zoom)*.5;let St=g.canonical.toString();g.overscaledZ!==g.canonical.z&&(St+=` => ${g.overscaledZ}`),St+=` ${nt}kb`,function(kt,Dn){kt.initDebugOverlayCanvas();const Ut=kt.debugOverlayCanvas,an=kt.context.gl,Ht=kt.debugOverlayCanvas.getContext("2d");Ht.clearRect(0,0,Ut.width,Ut.height),Ht.shadowColor="white",Ht.shadowBlur=2,Ht.lineWidth=1.5,Ht.strokeStyle="white",Ht.textBaseline="top",Ht.font="bold 36px Open Sans, sans-serif",Ht.fillText(Dn,5,5),Ht.strokeText(Dn,5,5),kt.debugOverlayTexture.update(Ut),kt.debugOverlayTexture.bind(an.LINEAR,an.CLAMP_TO_EDGE)}(w,St);const at=Z._tileDebugTextBuffer||w.debugBuffer,Ot=Z._tileDebugTextIndexBuffer||w.quadTriangleIndexBuffer,Rt=Z._tileDebugTextSegments||w.debugSegments;X.draw(C,P.TRIANGLES,se,Ie,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,Ws(G,p.Color.transparent,Et),"$debug",at,Ot,Rt,null,null,null,[Z._globeTileDebugTextBuffer])}function eo(w,l,g,C){Xi(w,0,l+g/2,w.transform.width,g,C)}function Vi(w,l,g,C){Xi(w,l-g/2,0,g,w.transform.height,C)}function Xi(w,l,g,C,M,P){const k=w.context,z=k.gl;z.enable(z.SCISSOR_TEST),z.scissor(l*p.exported.devicePixelRatio,g*p.exported.devicePixelRatio,C*p.exported.devicePixelRatio,M*p.exported.devicePixelRatio),k.clear({color:P}),z.disable(z.SCISSOR_TEST)}const $r=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:uo}=$r;function Xs(w,l,g,C){w.emplaceBack(l,g,C)}class Da{constructor(l){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,Xs(this.vertexArray,-1,-1,1),Xs(this.vertexArray,1,-1,1),Xs(this.vertexArray,-1,1,1),Xs(this.vertexArray,1,1,1),Xs(this.vertexArray,-1,-1,-1),Xs(this.vertexArray,1,-1,-1),Xs(this.vertexArray,-1,1,-1),Xs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,uo),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function to(w,l,g,C,M,P){const k=w.gl,z=l.paint.get("sky-atmosphere-color"),G=l.paint.get("sky-atmosphere-halo-color"),X=l.paint.get("sky-atmosphere-sun-intensity"),Z={u_matrix_3f:p.fromMat4(p.create$1(),C),u_sun_direction:M,u_sun_intensity:X,u_color_tint_r:[($e=z).r,$e.g,$e.b,$e.a],u_color_tint_m:[(je=G).r,je.g,je.b,je.a],u_luminance:5e-5};var $e,je;k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,k.TEXTURE_CUBE_MAP_POSITIVE_X+P,l.skyboxTexture,0),g.draw(w,k.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,Z,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const Zs=p.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class lo{constructor(l){const g=new p.StructArrayLayout5f20;g.emplaceBack(-1,1,1,0,0),g.emplaceBack(1,1,1,1,0),g.emplaceBack(1,-1,1,1,1),g.emplaceBack(-1,-1,1,0,1);const C=new p.StructArrayLayout3ui6;C.emplaceBack(0,1,2),C.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(g,Zs.members),this.indexBuffer=l.createIndexBuffer(C),this.segments=p.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const as={symbol:function(w,l,g,C,M){if("translucent"!==w.renderPass)return;const P=p.StencilMode.disabled,k=w.colorModeForRenderPass();g.layout.get("text-variable-anchor")&&function(z,G,X,Z,se,Ie,ze){const $e=G.transform,je="map"===se,We="map"===Ie;for(const ue of z){const Fe=Z.getTile(ue),nt=Fe.getBucket(X);if(!nt||!nt.text||!nt.text.segments.get().length)continue;const Qe=p.evaluateSizeForZoom(nt.textSizeData,$e.zoom),Et=ur(ue,nt.getProjection(),$e),St=$e.calculatePixelsToTileUnitsMatrix(Fe),at=on(Et,Fe.tileID.canonical,We,je,$e,nt.getProjection(),St),Ot="none"!==X.layout.get("icon-text-fit")&&nt.hasIconData();if(Qe){const Rt=Math.pow(2,$e.zoom-Fe.tileID.overscaledZ);Uh(nt,je,We,ze,p.symbolSize,$e,at,ue,Rt,Qe,Ot)}}}(C,w,g,l,g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),M),0!==g.paint.get("icon-opacity").constantOr(1)&&Ml(w,l,g,C,!1,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),g.layout.get("icon-rotation-alignment"),g.layout.get("icon-pitch-alignment"),g.layout.get("icon-keep-upright"),P,k),0!==g.paint.get("text-opacity").constantOr(1)&&Ml(w,l,g,C,!0,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),g.layout.get("text-keep-upright"),P,k),l.map.showCollisionBoxes&&(Eu(w,l,g,C,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),!0),Eu(w,l,g,C,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),!1))},circle:function(w,l,g,C){if("translucent"!==w.renderPass)return;const M=g.paint.get("circle-opacity"),P=g.paint.get("circle-stroke-width"),k=g.paint.get("circle-stroke-opacity"),z=void 0!==g.layout.get("circle-sort-key").constantOr(1);if(0===M.constantOr(1)&&(0===P.constantOr(1)||0===k.constantOr(1)))return;const G=w.context,X=G.gl,Z=w.transform,se=w.depthModeForSublayer(0,p.DepthMode.ReadOnly),Ie=p.StencilMode.disabled,ze=w.colorModeForRenderPass(),$e="globe"===Z.projection.name,je=[p.mercatorXfromLng(Z.center.lng),p.mercatorYfromLat(Z.center.lat)],We=[];for(let Fe=0;Fe<C.length;Fe++){const nt=C[Fe],Qe=l.getTile(nt),Et=Qe.getBucket(g);if(!Et||Et.projection.name!==Z.projection.name)continue;const St=Et.programConfigurations.get(g.id),at=Lr(g);$e&&at.push("PROJECTION_GLOBE_VIEW");const Ot=w.useProgram("circle",St,at),Rt=Et.layoutVertexBuffer,kt=Et.globeExtVertexBuffer,Dn=Et.indexBuffer,Ut=Z.projection.createInversionMatrix(Z,nt.canonical),an={programConfiguration:St,program:Ot,layoutVertexBuffer:Rt,globeExtVertexBuffer:kt,indexBuffer:Dn,uniformValues:Ta(w,nt,Qe,Ut,je,g),tile:Qe};if(z){const Ht=Et.segments.get();for(const gn of Ht)We.push({segments:new p.SegmentVector([gn]),sortKey:gn.sortKey,state:an})}else We.push({segments:Et.segments,sortKey:0,state:an})}z&&We.sort((Fe,nt)=>Fe.sortKey-nt.sortKey);const ue={useDepthForOcclusion:!$e};for(const Fe of We){const{programConfiguration:nt,program:Qe,layoutVertexBuffer:Et,globeExtVertexBuffer:St,indexBuffer:at,uniformValues:Ot,tile:Rt}=Fe.state,kt=Fe.segments;w.terrain&&w.terrain.setupElevationDraw(Rt,Qe,ue),w.prepareDrawProgram(G,Qe,Rt.tileID.toUnwrapped()),Qe.draw(G,X.TRIANGLES,se,Ie,ze,p.CullFaceMode.disabled,Ot,g.id,Et,at,kt,g.paint,Z.zoom,nt,[St])}},heatmap:function(w,l,g,C){if(0!==g.paint.get("heatmap-opacity"))if("offscreen"===w.renderPass){const M=w.context,P=M.gl,k=p.StencilMode.disabled,z=new p.ColorMode([P.ONE,P.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(ze,$e,je,We){const ue=ze.gl,Fe=$e.width*We,nt=$e.height*We;ze.activeTexture.set(ue.TEXTURE1),ze.viewport.set([0,0,Fe,nt]);let Qe=je.heatmapFbo;if(!Qe||Qe&&(Qe.width!==Fe||Qe.height!==nt)){Qe&&Qe.destroy();const Et=ue.createTexture();ue.bindTexture(ue.TEXTURE_2D,Et),ue.texParameteri(ue.TEXTURE_2D,ue.TEXTURE_WRAP_S,ue.CLAMP_TO_EDGE),ue.texParameteri(ue.TEXTURE_2D,ue.TEXTURE_WRAP_T,ue.CLAMP_TO_EDGE),ue.texParameteri(ue.TEXTURE_2D,ue.TEXTURE_MIN_FILTER,ue.LINEAR),ue.texParameteri(ue.TEXTURE_2D,ue.TEXTURE_MAG_FILTER,ue.LINEAR),Qe=je.heatmapFbo=ze.createFramebuffer(Fe,nt,!1),function(St,at,Ot,Rt,kt,Dn){const Ut=St.gl;Ut.texImage2D(Ut.TEXTURE_2D,0,St.isWebGL2&&St.extRenderToTextureHalfFloat?Ut.RGBA16F:Ut.RGBA,kt,Dn,0,Ut.RGBA,St.extRenderToTextureHalfFloat?St.isWebGL2?Ut.HALF_FLOAT:St.extTextureHalfFloat.HALF_FLOAT_OES:Ut.UNSIGNED_BYTE,null),Rt.colorAttachment.set(Ot)}(ze,0,Et,Qe,Fe,nt)}else ue.bindTexture(ue.TEXTURE_2D,Qe.colorAttachment.get()),ze.bindFramebuffer.set(Qe.framebuffer)})(M,w,g,"globe"===w.transform.projection.name?.5:.25),M.clear({color:p.Color.transparent});const G=w.transform,X="globe"===G.projection.name,Z=X?["PROJECTION_GLOBE_VIEW"]:null,se=X?p.CullFaceMode.frontCCW:p.CullFaceMode.disabled,Ie=[p.mercatorXfromLng(G.center.lng),p.mercatorYfromLat(G.center.lat)];for(let ze=0;ze<C.length;ze++){const $e=C[ze];if(l.hasRenderableParent($e))continue;const je=l.getTile($e),We=je.getBucket(g);if(!We||We.projection.name!==G.projection.name)continue;const ue=We.programConfigurations.get(g.id),Fe=w.useProgram("heatmap",ue,Z),{zoom:nt}=w.transform;w.terrain&&w.terrain.setupElevationDraw(je,Fe),w.prepareDrawProgram(M,Fe,$e.toUnwrapped());const Qe=G.projection.createInversionMatrix(G,$e.canonical);Fe.draw(M,P.TRIANGLES,p.DepthMode.disabled,k,z,se,tl(w,$e,je,Qe,Ie,nt,g.paint.get("heatmap-intensity")),g.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,g.paint,w.transform.zoom,ue,X?[We.globeExtVertexBuffer]:null)}M.viewport.set([0,0,w.width,w.height])}else"translucent"===w.renderPass&&(w.context.setColorMode(w.colorModeForRenderPass()),function(M,P){const k=M.context,z=k.gl,G=P.heatmapFbo;if(!G)return;k.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,G.colorAttachment.get()),k.activeTexture.set(z.TEXTURE1);let X=P.colorRampTexture;X||(X=P.colorRampTexture=new p.Texture(k,P.colorRamp,z.RGBA)),X.bind(z.LINEAR,z.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(k,z.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,M.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:P.paint.get("heatmap-opacity")},P.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,P.paint,M.transform.zoom)}(w,g))},line:function(w,l,g,C){if("translucent"!==w.renderPass)return;const M=g.paint.get("line-opacity"),P=g.paint.get("line-width");if(0===M.constantOr(1)||0===P.constantOr(1))return;const k=w.depthModeForSublayer(0,p.DepthMode.ReadOnly),z=w.colorModeForRenderPass(),G=w.terrain&&w.terrain.renderingToTexture?1:p.exported.devicePixelRatio,X=g.paint.get("line-dasharray"),Z=X.constantOr(1),se=g.layout.get("line-cap"),Ie=g.paint.get("line-pattern"),ze=Ie.constantOr(1),$e=g.paint.get("line-gradient"),je=ze?"linePattern":"line",We=w.context,ue=We.gl,Fe=(Qe=>{const Et=[];fc(Qe)&&Et.push("RENDER_LINE_DASH"),Qe.paint.get("line-gradient")&&Et.push("RENDER_LINE_GRADIENT");const St=Qe.paint.get("line-trim-offset");0===St[0]&&0===St[1]||Et.push("RENDER_LINE_TRIM_OFFSET");const at=Qe.paint.get("line-pattern").constantOr(1),Ot=1!==Qe.paint.get("line-opacity").constantOr(1);return!at&&Ot&&Et.push("RENDER_LINE_ALPHA_DISCARD"),Et})(g);let nt=Fe.includes("RENDER_LINE_ALPHA_DISCARD");w.terrain&&w.terrain.clipOrMaskOverlapStencilType()&&(nt=!1);for(const Qe of C){const Et=l.getTile(Qe);if(ze&&!Et.patternsLoaded())continue;const St=Et.getBucket(g);if(!St)continue;w.prepareDrawTile();const at=St.programConfigurations.get(g.id),Ot=w.useProgram(je,at,Fe),Rt=Ie.constantOr(null);if(Rt&&Et.imageAtlas){const fn=Et.imageAtlas.patternPositions[Rt.toString()];fn&&at.setConstantPatternPositions(fn)}const kt=X.constantOr(null),Dn=se.constantOr(null);if(!ze&&kt&&Dn&&Et.lineAtlas){const fn=Et.lineAtlas.getDash(kt,Dn);fn&&at.setConstantPatternPositions(fn)}let[Ut,an]=g.paint.get("line-trim-offset");("round"===Dn||"square"===Dn)&&Ut!==an&&(0===Ut&&(Ut-=1),1===an&&(an+=1));const Ht=w.terrain?Qe.projMatrix:null,gn=ze?tu(w,Et,g,Ht,G):bu(w,Et,g,Ht,St.lineClipsArray.length,G,[Ut,an]);if($e){const fn=St.gradients[g.id];let En=fn.texture;if(g.gradientVersion!==fn.version){let vn=256;if(g.stepInterpolant){const Ln=l.getSource().maxzoom,wr=Qe.canonical.z===Ln?Math.ceil(1<<w.transform.maxZoom-Qe.canonical.z):1;vn=p.clamp(p.nextPowerOfTwo(St.maxLineLength/p.EXTENT*1024*wr),256,We.maxTextureSize)}fn.gradient=p.renderColorRamp({expression:g.gradientExpression(),evaluationKey:"lineProgress",resolution:vn,image:fn.gradient||void 0,clips:St.lineClipsArray}),fn.texture?fn.texture.update(fn.gradient):fn.texture=new p.Texture(We,fn.gradient,ue.RGBA),fn.version=g.gradientVersion,En=fn.texture}We.activeTexture.set(ue.TEXTURE1),En.bind(g.stepInterpolant?ue.NEAREST:ue.LINEAR,ue.CLAMP_TO_EDGE)}Z&&(We.activeTexture.set(ue.TEXTURE0),Et.lineAtlasTexture.bind(ue.LINEAR,ue.REPEAT),at.updatePaintBuffers()),ze&&(We.activeTexture.set(ue.TEXTURE0),Et.imageAtlasTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),at.updatePaintBuffers()),w.prepareDrawProgram(We,Ot,Qe.toUnwrapped());const Gt=fn=>{Ot.draw(We,ue.TRIANGLES,k,fn,z,p.CullFaceMode.disabled,gn,g.id,St.layoutVertexBuffer,St.indexBuffer,St.segments,g.paint,w.transform.zoom,at,[St.layoutVertexBuffer2])};if(nt){const fn=w.stencilModeForClipping(Qe).ref;0===fn&&w.terrain&&We.clear({stencil:0});const En={func:ue.EQUAL,mask:255};gn.u_alpha_discard_threshold=.8,Gt(new p.StencilMode(En,fn,255,ue.KEEP,ue.KEEP,ue.INVERT)),gn.u_alpha_discard_threshold=0,Gt(new p.StencilMode(En,fn,255,ue.KEEP,ue.KEEP,ue.KEEP))}else Gt(w.stencilModeForClipping(Qe))}nt&&(w.resetStencilClippingMasks(),w.terrain&&We.clear({stencil:0}))},fill:function(w,l,g,C){const M=g.paint.get("fill-color"),P=g.paint.get("fill-opacity");if(0===P.constantOr(1))return;const k=w.colorModeForRenderPass(),z=g.paint.get("fill-pattern"),G=w.opaquePassEnabledForLayer()&&!z.constantOr(1)&&1===M.constantOr(p.Color.transparent).a&&1===P.constantOr(0)?"opaque":"translucent";if(w.renderPass===G){const X=w.depthModeForSublayer(1,"opaque"===w.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);Nf(w,l,g,C,X,k,!1)}if("translucent"===w.renderPass&&g.paint.get("fill-antialias")){const X=w.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);Nf(w,l,g,C,X,k,!0)}},"fill-extrusion":function(w,l,g,C){const M=g.paint.get("fill-extrusion-opacity");if(0!==M&&"translucent"===w.renderPass){const P=new p.DepthMode(w.context.gl.LEQUAL,p.DepthMode.ReadWrite,w.depthRangeFor3D);if(1!==M||g.paint.get("fill-extrusion-pattern").constantOr(1))_l(w,l,g,C,P,p.StencilMode.disabled,p.ColorMode.disabled),_l(w,l,g,C,P,w.stencilModeFor3D(),w.colorModeForRenderPass()),w.resetStencilClippingMasks();else{const k=w.colorModeForRenderPass();_l(w,l,g,C,P,p.StencilMode.disabled,k)}}},hillshade:function(w,l,g,C){if("offscreen"!==w.renderPass&&"translucent"!==w.renderPass)return;const M=w.context,P=w.depthModeForSublayer(0,p.DepthMode.ReadOnly),k=w.colorModeForRenderPass(),z=w.terrain&&w.terrain.renderingToTexture,[G,X]="translucent"!==w.renderPass||z?[{},C]:w.stencilConfigForOverlap(C);for(const Z of X){const se=l.getTile(Z);if(se.needsHillshadePrepare&&"offscreen"===w.renderPass)Fh(w,se,g,P,p.StencilMode.disabled,k);else if("translucent"===w.renderPass){const Ie=z&&w.terrain?w.terrain.stencilModeForRTTOverlap(Z):G[Z.overscaledZ];oi(w,Z,se,g,P,Ie,k)}}M.viewport.set([0,0,w.width,w.height]),w.resetStencilClippingMasks()},raster:function(w,l,g,C,M,P){if("translucent"!==w.renderPass||0===g.paint.get("raster-opacity")||!C.length)return;const k=w.context,z=k.gl,G=l.getSource(),X=w.useProgram("raster"),Z=w.colorModeForRenderPass(),se=w.terrain&&w.terrain.renderingToTexture,[Ie,ze]=G instanceof li||se?[{},C]:w.stencilConfigForOverlap(C),$e=ze[ze.length-1].overscaledZ,je=!w.options.moving;for(const We of ze){const ue=se?p.DepthMode.disabled:w.depthModeForSublayer(We.overscaledZ-$e,1===g.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,z.LESS),Fe=We.toUnwrapped(),nt=l.getTile(We);if(se&&(!nt||!nt.hasData()))continue;const Qe=se?We.projMatrix:w.transform.calculateProjMatrix(Fe,je),Et=w.terrain&&se?w.terrain.stencilModeForRTTOverlap(We):Ie[We.overscaledZ],St=P?0:g.paint.get("raster-fade-duration");nt.registerFadeDuration(St);const at=l.findLoadedParent(We,0),Ot=Oc(nt,at,l,w.transform,St);let Rt,kt;w.terrain&&w.terrain.prepareDrawTile();const Dn="nearest"===g.paint.get("raster-resampling")?z.NEAREST:z.LINEAR;k.activeTexture.set(z.TEXTURE0),nt.texture.bind(Dn,z.CLAMP_TO_EDGE),k.activeTexture.set(z.TEXTURE1),at?(at.texture.bind(Dn,z.CLAMP_TO_EDGE),Rt=Math.pow(2,at.tileID.overscaledZ-nt.tileID.overscaledZ),kt=[nt.tileID.canonical.x*Rt%1,nt.tileID.canonical.y*Rt%1]):nt.texture.bind(Dn,z.CLAMP_TO_EDGE),nt.texture.useMipmap&&k.extTextureFilterAnisotropic&&w.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);const Ut=Rs(Qe,kt||[0,0],Rt||1,Ot,g,G instanceof li?G.perspectiveTransform:[0,0]);if(w.prepareDrawProgram(k,X,Fe),G instanceof li)G.boundsBuffer&&G.boundsSegments&&X.draw(k,z.TRIANGLES,ue,p.StencilMode.disabled,Z,p.CullFaceMode.disabled,Ut,g.id,G.boundsBuffer,w.quadTriangleIndexBuffer,G.boundsSegments);else{const{tileBoundsBuffer:an,tileBoundsIndexBuffer:Ht,tileBoundsSegments:gn}=w.getTileBoundsBuffers(nt);X.draw(k,z.TRIANGLES,ue,Et,Z,p.CullFaceMode.disabled,Ut,g.id,an,Ht,gn)}}w.resetStencilClippingMasks()},background:function(w,l,g,C){const M=g.paint.get("background-color"),P=g.paint.get("background-opacity");if(0===P)return;const k=w.context,z=k.gl,G=w.transform,X=G.tileSize,Z=g.paint.get("background-pattern");if(w.isPatternMissing(Z))return;const se=!Z&&1===M.a&&1===P&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==se)return;const Ie=p.StencilMode.disabled,ze=w.depthModeForSublayer(0,"opaque"===se?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),$e=w.colorModeForRenderPass(),je=w.useProgram(Z?"backgroundPattern":"background");let We,ue=C;ue||(We=w.getBackgroundTiles(),ue=Object.values(We).map(Fe=>Fe.tileID)),Z&&(k.activeTexture.set(z.TEXTURE0),w.imageManager.bind(w.context));for(const Fe of ue){const nt=Fe.toUnwrapped(),Qe=C?Fe.projMatrix:w.transform.calculateProjMatrix(nt);w.prepareDrawTile();const Et=l?l.getTile(Fe):We?We[Fe.key]:new p.Tile(Fe,X,G.zoom,w),St=Z?zh(Qe,P,w,Z,{tileID:Fe,tileSize:X}):ql(Qe,P,M);w.prepareDrawProgram(k,je,nt);const{tileBoundsBuffer:at,tileBoundsIndexBuffer:Ot,tileBoundsSegments:Rt}=w.getTileBoundsBuffers(Et);je.draw(k,z.TRIANGLES,ze,Ie,$e,p.CullFaceMode.disabled,St,g.id,at,Ot,Rt)}},sky:function(w,l,g){const C=w.transform,M="mercator"===C.projection.name||"globe"===C.projection.name?1:p.smoothstep(7,8,C.zoom),P=g.paint.get("sky-opacity")*M;if(0===P)return;const k=w.context,z=g.paint.get("sky-type"),G=new p.DepthMode(k.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),X=w.frameCounter/1e3%1;"atmosphere"===z?"offscreen"===w.renderPass?g.needsSkyboxCapture(w)&&(function(Z,se,Ie,ze){const $e=Z.context,je=$e.gl;let We=se.skyboxFbo;if(!We){We=se.skyboxFbo=$e.createFramebuffer(32,32,!1),se.skyboxGeometry=new Da($e),se.skyboxTexture=$e.gl.createTexture(),je.bindTexture(je.TEXTURE_CUBE_MAP,se.skyboxTexture),je.texParameteri(je.TEXTURE_CUBE_MAP,je.TEXTURE_WRAP_S,je.CLAMP_TO_EDGE),je.texParameteri(je.TEXTURE_CUBE_MAP,je.TEXTURE_WRAP_T,je.CLAMP_TO_EDGE),je.texParameteri(je.TEXTURE_CUBE_MAP,je.TEXTURE_MIN_FILTER,je.LINEAR),je.texParameteri(je.TEXTURE_CUBE_MAP,je.TEXTURE_MAG_FILTER,je.LINEAR);for(let Qe=0;Qe<6;++Qe)je.texImage2D(je.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,0,je.RGBA,32,32,0,je.RGBA,je.UNSIGNED_BYTE,null)}$e.bindFramebuffer.set(We.framebuffer),$e.viewport.set([0,0,32,32]);const ue=se.getCenter(Z,!0),Fe=Z.useProgram("skyboxCapture"),nt=new Float64Array(16);p.identity(nt),p.rotateY(nt,nt,.5*-Math.PI),to($e,se,Fe,nt,ue,0),p.identity(nt),p.rotateY(nt,nt,.5*Math.PI),to($e,se,Fe,nt,ue,1),p.identity(nt),p.rotateX(nt,nt,.5*-Math.PI),to($e,se,Fe,nt,ue,2),p.identity(nt),p.rotateX(nt,nt,.5*Math.PI),to($e,se,Fe,nt,ue,3),p.identity(nt),to($e,se,Fe,nt,ue,4),p.identity(nt),p.rotateY(nt,nt,Math.PI),to($e,se,Fe,nt,ue,5),$e.viewport.set([0,0,Z.width,Z.height])}(w,g),g.markSkyboxValid(w)):"sky"===w.renderPass&&function(Z,se,Ie,ze,$e){const je=Z.context,We=je.gl,ue=Z.transform,Fe=Z.useProgram("skybox");je.activeTexture.set(We.TEXTURE0),We.bindTexture(We.TEXTURE_CUBE_MAP,se.skyboxTexture);const nt={u_matrix:ue.skyboxMatrix,u_sun_direction:se.getCenter(Z,!1),u_cubemap:0,u_opacity:ze,u_temporal_offset:$e};Z.prepareDrawProgram(je,Fe),Fe.draw(je,We.TRIANGLES,Ie,p.StencilMode.disabled,Z.colorModeForRenderPass(),p.CullFaceMode.backCW,nt,"skybox",se.skyboxGeometry.vertexBuffer,se.skyboxGeometry.indexBuffer,se.skyboxGeometry.segment)}(w,g,G,P,X):"gradient"===z&&"sky"===w.renderPass&&function(Z,se,Ie,ze,$e){const je=Z.context,We=je.gl,ue=Z.transform,Fe=Z.useProgram("skyboxGradient");se.skyboxGeometry||(se.skyboxGeometry=new Da(je)),je.activeTexture.set(We.TEXTURE0);let nt=se.colorRampTexture;nt||(nt=se.colorRampTexture=new p.Texture(je,se.colorRamp,We.RGBA)),nt.bind(We.LINEAR,We.CLAMP_TO_EDGE);const Qe=(Et=ue.skyboxMatrix,St=se.getCenter(Z,!1),at=se.paint.get("sky-gradient-radius"),Ot=ze,Rt=$e,{u_matrix:Et,u_color_ramp:0,u_center_direction:St,u_radius:p.degToRad(at),u_opacity:Ot,u_temporal_offset:Rt});var Et,St,at,Ot,Rt;Z.prepareDrawProgram(je,Fe),Fe.draw(je,We.TRIANGLES,Ie,p.StencilMode.disabled,Z.colorModeForRenderPass(),p.CullFaceMode.backCW,Qe,"skyboxGradient",se.skyboxGeometry.vertexBuffer,se.skyboxGeometry.indexBuffer,se.skyboxGeometry.segment)}(w,g,G,P,X)},debug:function(w,l,g){for(let C=0;C<g.length;C++)Es(w,l,g[C])},custom:function(w,l,g,C){const M=w.context,P=g.implementation;if(!w.transform.projection.unsupportedLayers||!w.transform.projection.unsupportedLayers.includes("custom")||w.terrain&&(w.terrain.renderingToTexture||"offscreen"===w.renderPass)&&g.isLayerDraped()){if("offscreen"===w.renderPass){const k=P.prerender;if(k){if(w.setCustomLayerDefaults(),M.setColorMode(w.colorModeForRenderPass()),"globe"===w.transform.projection.name){const z=w.transform.pointMerc;k.call(P,M.gl,w.transform.customLayerMatrix(),w.transform.getProjection(),w.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(w.transform.zoom),[z.x,z.y],w.transform.pixelsPerMeterRatio)}else k.call(P,M.gl,w.transform.customLayerMatrix());M.setDirty(),w.setBaseState()}}else if("translucent"===w.renderPass){if(w.terrain&&w.terrain.renderingToTexture){const z=P.renderToTile;if(z){const G=C[0].canonical,X=new p.MercatorCoordinate(G.x+C[0].wrap*(1<<G.z),G.y,G.z);M.setDepthMode(p.DepthMode.disabled),M.setStencilMode(p.StencilMode.disabled),M.setColorMode(w.colorModeForRenderPass()),w.setCustomLayerDefaults(),z.call(P,M.gl,X),M.setDirty(),w.setBaseState()}return}w.setCustomLayerDefaults(),M.setColorMode(w.colorModeForRenderPass()),M.setStencilMode(p.StencilMode.disabled);const k="3d"===P.renderingMode?new p.DepthMode(w.context.gl.LEQUAL,p.DepthMode.ReadWrite,w.depthRangeFor3D):w.depthModeForSublayer(0,p.DepthMode.ReadOnly);if(M.setDepthMode(k),"globe"===w.transform.projection.name){const z=w.transform.pointMerc;P.render(M.gl,w.transform.customLayerMatrix(),w.transform.getProjection(),w.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(w.transform.zoom),[z.x,z.y],w.transform.pixelsPerMeterRatio)}else P.render(M.gl,w.transform.customLayerMatrix());M.setDirty(),w.setBaseState(),M.bindFramebuffer.set(null)}}else p.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Fc{constructor(l,g,C=!1){this.context=new Cn(l,C),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(l,g){const C=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(C||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Lu(this,l));const M=this._terrain;this.transform.elevation=C?M:null,M.update(l,this.transform,g)}_updateFog(l){const g=l.fog;if(!g||"globe"===this.transform.projection.name||g.getOpacity(this.transform.pitch)<1||g.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[C,M]=g.getFovAdjustedRange(this.transform._fov);if(C>M)return void(this.transform.fogCullDistSq=null);const P=C+.78*(M-C);this.transform.fogCullDistSq=P*P}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(l,g){if(this.width=l*p.exported.devicePixelRatio,this.height=g*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const C of this.style.order)this.style._layers[C].resize()}setup(){const l=this.context,g=new p.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(p.EXTENT,0),g.emplaceBack(0,p.EXTENT),g.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(g,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const C=new p.StructArrayLayout2i4;C.emplaceBack(0,0),C.emplaceBack(p.EXTENT,0),C.emplaceBack(0,p.EXTENT),C.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=l.createVertexBuffer(C,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const M=new p.StructArrayLayout2i4;M.emplaceBack(-1,-1),M.emplaceBack(1,-1),M.emplaceBack(-1,1),M.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(M,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const P=new p.StructArrayLayout4i8;P.emplaceBack(0,0,0,0),P.emplaceBack(p.EXTENT,0,p.EXTENT,0),P.emplaceBack(0,p.EXTENT,0,p.EXTENT),P.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=l.createVertexBuffer(P,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const k=new p.StructArrayLayout3ui6;k.emplaceBack(0,1,2),k.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(k);const z=new p.StructArrayLayout1ui2;for(const X of[0,1,3,2,0])z.emplaceBack(X);this.debugIndexBuffer=l.createIndexBuffer(z),this.emptyTexture=new p.Texture(l,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=p.create();const G=this.context.gl;this.stencilClearMode=new p.StencilMode({func:G.ALWAYS,mask:0},0,255,G.ZERO,G.ZERO,G.ZERO),this.loadTimeStamps.push(p.window.performance.now()),this.atmosphereBuffer=new lo(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context,g=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(l,g.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,ei(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,g,C){if(!g||this.currentStencilSource===g.id||!l.isTileClipped()||!C||0===C.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let z=!1;for(const G of C)if(void 0===this._tileClippingMaskIDs[G.key]){z=!0;break}if(!z)return}this.currentStencilSource=g.id;const M=this.context,P=M.gl;this.nextStencilID+C.length>256&&this.clearStencil(),M.setColorMode(p.ColorMode.disabled),M.setDepthMode(p.DepthMode.disabled);const k=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const z of C){const G=g.getTile(z),X=this._tileClippingMaskIDs[z.key]=this.nextStencilID++,{tileBoundsBuffer:Z,tileBoundsIndexBuffer:se,tileBoundsSegments:Ie}=this.getTileBoundsBuffers(G);k.draw(M,P.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:P.ALWAYS,mask:0},X,255,P.KEEP,P.KEEP,P.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,ei(z.projMatrix),"$clipping",Z,se,Ie)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,g=this.context.gl;return new p.StencilMode({func:g.NOTEQUAL,mask:255},l,255,g.KEEP,g.KEEP,g.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const g=this.context.gl;return new p.StencilMode({func:g.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,g.KEEP,g.KEEP,g.REPLACE)}stencilConfigForOverlap(l){const g=this.context.gl,C=l.sort((k,z)=>z.overscaledZ-k.overscaledZ),M=C[C.length-1].overscaledZ,P=C[0].overscaledZ-M+1;if(P>1){this.currentStencilSource=void 0,this.nextStencilID+P>256&&this.clearStencil();const k={};for(let z=0;z<P;z++)k[z+M]=new p.StencilMode({func:g.GEQUAL,mask:255},z+this.nextStencilID,255,g.KEEP,g.KEEP,g.REPLACE);return this.nextStencilID+=P,[k,C]}return[{[M]:p.StencilMode.disabled},C]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([l.CONSTANT_COLOR,l.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(l,g,C){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const M=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new p.DepthMode(C||this.context.gl.LEQUAL,g,[M,M])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,g){this.style=l,this.options=g,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const C=this.style.order,M=this.style._sourceCaches;for(const X in M){const Z=M[X];Z.used&&Z.prepare(this.context)}const P={},k={},z={};for(const X in M){const Z=M[X];P[X]=Z.getVisibleCoordinates(),k[X]=P[X].slice().reverse(),z[X]=Z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let X=0;X<C.length;X++)if(this.style._layers[C[X]].is3D()){this.opaquePassCutoff=X;break}if(this.terrain&&(this.terrain.updateTileBinding(z),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const X of C){const Z=this.style._layers[X],se=l._getLayerSourceCache(Z);if(!Z.hasOffscreenPass()||Z.isHidden(this.transform.zoom))continue;const Ie=se?k[se.id]:void 0;("custom"===Z.type||Z.isSky()||Ie&&Ie.length)&&this.renderLayer(this,se,Z,Ie)}this.depthRangeFor3D=[0,1-(l.order.length+2)*this.numSublayers*this.depthEpsilon];const G=this.terrain;if(G&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&G.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:g.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=g.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){const X=this.style._layers[C[this.currentLayer]],Z=l._getLayerSourceCache(X);if(X.isSky())continue;const se=Z?k[Z.id]:void 0;this._renderTileClippingMasks(X,Z,se),this.renderLayer(this,Z,X,se)}if(this.style.fog&&this.transform.projection.supportsFog&&function(X,Z){const se=X.context,Ie=se.gl,ze=X.transform,$e=new p.DepthMode(Ie.LEQUAL,p.DepthMode.ReadOnly,[0,1]),je=X.useProgram("globeAtmosphere",null,"globe"===ze.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),We=p.globeToMercatorTransition(ze.zoom),ue=Z.properties.get("color").toArray01(),Fe=Z.properties.get("high-color").toArray01(),nt=Z.properties.get("space-color").toArray01PremultipliedAlpha(),Qe=p.identity$1([]);p.rotateY$1(Qe,Qe,-p.degToRad(ze._center.lng)),p.rotateX$1(Qe,Qe,p.degToRad(ze._center.lat)),p.rotateZ$1(Qe,Qe,ze.angle),p.rotateX$1(Qe,Qe,-ze._pitch);const Et=p.fromQuat(new Float32Array(16),Qe),St=p.mapValue(Z.properties.get("star-intensity"),0,1,0,.25),Ot=p.mapValue(Z.properties.get("horizon-blend"),0,1,5e-4,.25),Rt=p.globeUseCustomAntiAliasing(X,se,ze)&&5e-4===Ot?ze.worldSize/(2*Math.PI*1.025)-1:ze.globeRadius,kt=X.frameCounter/1e3%1,Dn=p.length(ze.globeCenterInViewSpace),Ut=Math.sqrt(Math.pow(Dn,2)-Math.pow(Rt,2)),an=Math.acos(Ut/Dn),Ht={u_frustum_tl:ze.frustumCorners.TL,u_frustum_tr:ze.frustumCorners.TR,u_frustum_br:ze.frustumCorners.BR,u_frustum_bl:ze.frustumCorners.BL,u_horizon:ze.frustumCorners.horizon,u_transition:We,u_fadeout_range:Ot,u_color:ue,u_high_color:Fe,u_space_color:nt,u_star_intensity:St,u_star_size:5*p.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:kt,u_horizon_angle:an,u_rotation_matrix:Et};X.prepareDrawProgram(se,je);const gn=X.atmosphereBuffer;gn&&je.draw(se,Ie.TRIANGLES,$e,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,Ht,"skybox",gn.vertexBuffer,gn.indexBuffer,gn.segments)}(this,this.style.fog),this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const X=this.style._layers[C[this.currentLayer]],Z=l._getLayerSourceCache(X);X.isSky()&&this.renderLayer(this,Z,X,Z?k[Z.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<C.length;){const X=this.style._layers[C[this.currentLayer]],Z=l._getLayerSourceCache(X);if(X.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(X)){if(X.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const se=Z?("symbol"===X.type?z:k)[Z.id]:void 0;this._renderTileClippingMasks(X,Z,Z?P[Z.id]:void 0),this.renderLayer(this,Z,X,se),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let X=null;p.values(this.style._layers).forEach(Z=>{const se=l._getLayerSourceCache(Z);se&&!Z.isHidden(this.transform.zoom)&&(!X||X.getSource().maxzoom<se.getSource().maxzoom)&&(X=se)}),X&&this.options.showTileBoundaries&&as.debug(this,X,X.getVisibleCoordinates())}this.options.showPadding&&function(X){const Z=X.transform.padding;eo(X,X.transform.height-(Z.top||0),3,un),eo(X,Z.bottom||0,3,Qt),Vi(X,Z.left||0,3,ir),Vi(X,X.transform.width-(Z.right||0),3,Tr);const se=X.transform.centerPoint;var Ie,ze,$e,je;Xi(Ie=X,(ze=se.x)-1,($e=X.transform.height-se.y)-10,2,20,je=qi),Xi(Ie,ze-10,$e-1,20,2,je)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(l,g,C,M){C.isHidden(this.transform.zoom)||("background"===C.type||"sky"===C.type||"custom"===C.type||M&&M.length)&&(this.id=C.id,this.gpuTimingStart(C),(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes(C.type)||l.terrain&&"custom"===C.type)&&as[C.type](l,g,C,M,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const g=this.context.extTimerQuery;let C=this.gpuTimers[l.id];C||(C=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:g.createQueryEXT()}),C.calls++,g.beginQueryEXT(g.TIME_ELAPSED_EXT,C.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,g=l.createQueryEXT();this.deferredRenderGpuTimeQueries.push(g),l.beginQueryEXT(l.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const g={};for(const C in l){const M=l[C],P=this.context.extTimerQuery,k=P.getQueryObjectEXT(M.query,P.QUERY_RESULT_EXT)/1e6;P.deleteQueryEXT(M.query),g[C]=k}return g}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const g=this.context.extTimerQuery;let C=0;for(const M of l)C+=g.getQueryObjectEXT(M,g.QUERY_RESULT_EXT)/1e6,g.deleteQueryEXT(M);return C}translatePosMatrix(l,g,C,M,P){if(!C[0]&&!C[1])return l;const k=P?"map"===M?this.transform.angle:0:"viewport"===M?-this.transform.angle:0;if(k){const X=Math.sin(k),Z=Math.cos(k);C=[C[0]*Z-C[1]*X,C[0]*X+C[1]*Z]}const z=[P?C[0]:ft(g,C[0],this.transform.zoom),P?C[1]:ft(g,C[1],this.transform.zoom),0],G=new Float32Array(16);return p.translate(G,l,z),G}saveTileTexture(l){const g=this._tileTextures[l.size[0]];g?g.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const g=this._tileTextures[l];return g&&g.length>0?g.pop():null}isPatternMissing(l){return null===l||void 0!==l&&!this.imageManager.getPattern(l.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const l=this.terrain&&this.terrain.renderingToTexture,g=this.terrain&&0===this.terrain.exaggeration(),C=this.style&&this.style.fog,M=[];return this.terrainRenderModeElevated()&&M.push("TERRAIN"),"globe"===this.transform.projection.name&&M.push("GLOBE"),g&&M.push("ZERO_EXAGGERATION"),C&&!l&&0!==C.getOpacity(this.transform.pitch)&&M.push("FOG"),l&&M.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&M.push("OVERDRAW_INSPECTOR"),M}useProgram(l,g,C){this.cache=this.cache||{};const M=C||[],P=this.currentGlobalDefines().concat(M),k=qn.cacheKey(Yo[l],l,P,g);return this.cache[k]||(this.cache[k]=new qn(this.context,l,Yo[l],g,Of[l],P)),this.cache[k]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(l,g,C){if(this.terrain&&this.terrain.renderingToTexture)return;const M=this.style.fog;if(M){const P=M.getOpacity(this.transform.pitch),k=((z,G,X,Z,se,Ie,ze,$e,je,We,ue)=>{const Fe=z.transform,nt=G.properties.get("color").toArray01();nt[3]=Z;const Qe=z.frameCounter/1e3%1;return{u_fog_matrix:X?Fe.calculateFogTileMatrix(X):z.identityMat,u_fog_range:G.getFovAdjustedRange(Fe._fov),u_fog_color:nt,u_fog_horizon_blend:G.properties.get("horizon-blend"),u_fog_temporal_offset:Qe,u_frustum_tl:se,u_frustum_tr:Ie,u_frustum_br:ze,u_frustum_bl:$e,u_globe_pos:je,u_globe_radius:We,u_viewport:ue,u_globe_transition:p.globeToMercatorTransition(Fe.zoom),u_is_globe:+("globe"===Fe.projection.name)}})(this,M,C,P,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.exported.devicePixelRatio,this.transform.height*p.exported.devicePixelRatio]);g.setFogUniformValues(l,k)}}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,g=l.createTexture();return l.bindTexture(l.TEXTURE_2D,g),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),g}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&0!==l.getOpacity(this.transform.pitch)}getBackgroundTiles(){const l=this._backgroundTiles,g=this._backgroundTiles={},C=this.transform.coveringTiles({tileSize:512});for(const M of C)g[M.key]=l[M.key]||new p.Tile(M,512,this.transform.tileZoom,this);return g}clearBackgroundTiles(){this._backgroundTiles={}}}class nu{constructor(l=0,g=0,C=0,M=0){if(isNaN(l)||l<0||isNaN(g)||g<0||isNaN(C)||C<0||isNaN(M)||M<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=g,this.left=C,this.right=M}interpolate(l,g,C){return null!=g.top&&null!=l.top&&(this.top=p.number(l.top,g.top,C)),null!=g.bottom&&null!=l.bottom&&(this.bottom=p.number(l.bottom,g.bottom,C)),null!=g.left&&null!=l.left&&(this.left=p.number(l.left,g.left,C)),null!=g.right&&null!=l.right&&(this.right=p.number(l.right,g.right,C)),this}getCenter(l,g){const C=p.clamp((this.left+l-this.right)/2,0,l),M=p.clamp((this.top+g-this.bottom)/2,0,g);return new p.Point(C,M)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new nu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ri(w,l){const g=p.getColumn(w,3);p.fromQuat(w,l),p.setColumn(w,3,g)}function bn(w,l){const g=p.identity$1([]);return p.rotateZ$1(g,g,-l),p.rotateX$1(g,g,-w),g}function qr(w,l){const g=[w[0],w[1],0],C=[l[0],l[1],0];if(p.length(g)>=1e-15){const k=p.normalize([],g);p.scale$2(C,k,p.dot(C,k)),l[0]=C[0],l[1]=C[1]}const M=p.cross([],l,w);if(p.len(M)<1e-15)return null;const P=Math.atan2(-M[1],M[0]);return bn(Math.atan2(Math.sqrt(w[0]*w[0]+w[1]*w[1]),-w[2]),P)}class co{constructor(l,g){this.position=l,this.orientation=g}get position(){return this._position}set position(l){if(l){const g=l instanceof p.MercatorCoordinate?l:new p.MercatorCoordinate(l[0],l[1],l[2]);this._renderWorldCopies&&(g.x=p.wrap(g.x,0,1)),this._position=g}else this._position=null}lookAtPoint(l,g){if(this.orientation=null,!this.position)return;const C=this.position,M=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(l)):0,P=p.MercatorCoordinate.fromLngLat(l,M),k=[P.x-C.x,P.y-C.y,P.z-C.z];g||(g=[0,0,1]),g[2]=Math.abs(g[2]),this.orientation=qr(k,g)}setPitchBearing(l,g){this.orientation=bn(p.degToRad(l),p.degToRad(-g))}}class _o{constructor(l,g){this._transform=p.identity([]),this.orientation=g,this.position=l}get mercatorPosition(){const l=this.position;return new p.MercatorCoordinate(l[0],l[1],l[2])}get position(){const l=p.getColumn(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var g;l&&p.setColumn(this._transform,3,[(g=l)[0],g[1],g[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||p.identity$1([]),l&&Ri(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),g=this.right();return{bearing:Math.atan2(-g[1],g[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,g){this._orientation=bn(l,g),Ri(this._transform,this._orientation)}forward(){const l=p.getColumn(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=p.getColumn(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=p.getColumn(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,g){const C=new Float64Array(16);return p.invert(C,this.getWorldToCamera(l,g)),C}getWorldToCameraPosition(l,g,C){const M=this.position;p.scale$2(M,M,-l);const P=new Float64Array(16);return p.fromScaling(P,[C,C,C]),p.translate(P,P,M),P[10]*=g,P}getWorldToCamera(l,g){const C=new Float64Array(16),M=new Float64Array(4),P=this.position;return p.conjugate(M,this._orientation),p.scale$2(P,P,-l),p.fromQuat(C,M),p.translate(C,C,P),C[1]*=-1,C[5]*=-1,C[9]*=-1,C[13]*=-1,C[8]*=g,C[9]*=g,C[10]*=g,C[11]*=g,C}getCameraToClipPerspective(l,g,C,M){const P=new Float64Array(16);return p.perspective(P,l,g,C,M),P}getDistanceToElevation(l,g=!1){const C=0===l?0:p.mercatorZfromAltitude(l,g?p.latFromMercatorY(this.position[1]):this.position[1]),M=this.forward();return(C-this.position[2])/M[2]}clone(){return new _o([...this.position],[...this.orientation])}}function xa(w,l){const g=da(w.projection,w.zoom,w.width,w.height),C=function(P,k,z,G,X){const Z=new p.LngLat(z.lng-180*Ur,z.lat),se=new p.LngLat(z.lng+180*Ur,z.lat),Ie=P.project(Z.lng,Z.lat),ze=P.project(se.lng,se.lat),$e=-Math.atan2(ze.y-Ie.y,ze.x-Ie.x),je=p.MercatorCoordinate.fromLngLat(z);je.y=p.clamp(je.y,-1+Ur,1-Ur);const We=je.toLngLat(),ue=P.project(We.lng,We.lat),Fe=p.MercatorCoordinate.fromLngLat(We);Fe.x+=Ur;const nt=Fe.toLngLat(),Qe=P.project(nt.lng,nt.lat),Et=nl(Qe.x-ue.x,Qe.y-ue.y,$e),St=p.MercatorCoordinate.fromLngLat(We);St.y+=Ur;const at=St.toLngLat(),Ot=P.project(at.lng,at.lat),Rt=nl(Ot.x-ue.x,Ot.y-ue.y,$e),kt=Math.abs(Et.x)/Math.abs(Rt.y),Dn=p.identity([]);p.rotateZ(Dn,Dn,-$e*(1-(X?0:G)));const Ut=p.identity([]);return p.scale(Ut,Ut,[1,1-(1-kt)*G,1]),Ut[4]=-Rt.x/Rt.y*G,p.rotateZ(Ut,Ut,$e),p.multiply(Ut,Dn,Ut),Ut}(w.projection,0,w.center,g,l),M=io(w);return p.scale(C,C,[M,M,1]),C}function io(w){const l=w.projection,g=da(w.projection,w.zoom,w.width,w.height),C=Bc(l,w.center),M=Bc(l,p.LngLat.convert(l.center));return Math.pow(2,C*g+(1-g)*M)}function da(w,l,g,C,M=1/0){const P=w.range;if(!P)return 0;const k=Math.min(M,Math.max(g,C)),z=Math.log(k/1024)/Math.LN2;return p.smoothstep(P[0]+z,P[1]+z,l)}const Ur=1/4e4;function Bc(w,l){const g=p.clamp(l.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),C=new p.LngLat(l.lng-180*Ur,g),M=new p.LngLat(l.lng+180*Ur,g),P=w.project(C.lng,g),k=w.project(M.lng,g),z=p.MercatorCoordinate.fromLngLat(C),G=p.MercatorCoordinate.fromLngLat(M),X=k.x-P.x,Z=k.y-P.y,se=G.x-z.x,Ie=G.y-z.y,ze=Math.sqrt((se*se+Ie*Ie)/(X*X+Z*Z));return Math.log(ze)/Math.LN2}function nl(w,l,g){const C=Math.cos(g),M=Math.sin(g);return{x:w*C-l*M,y:w*M+l*C}}class pr{constructor(l,g,C,M,P,k,z){this.tileSize=512,this._renderWorldCopies=void 0===P||P,this._minZoom=l||0,this._maxZoom=g||22,this._minPitch=C??0,this._maxPitch=M??60,this.setProjection(k),this.setMaxBounds(z),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new nu,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new _o,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const l=new pr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(l,g=!1){const C=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||C)&&this._updateCameraOnTerrain(),(l||C)&&this._constrainCamera(g),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const g=this.projection?this.getProjection():void 0;this.projection=p.getProjection(this.projectionOptions);const C=!J(g,this.getProjection());return C&&this._calcMatrices(),this.mercatorFromTransition=!1,C}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.getProjection({name:"mercator"});const g=l!==this.projection.name;return g&&this._calcMatrices(),g}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(l){void 0===l?l=!0:null===l&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.Point(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const g=-l*Math.PI/180;var C,M,P,k,z,G,X,Z,se,Ie;this.angle!==g&&(this._unmodified=!1,this.angle=g,this._calcMatrices(),this.rotationMatrix=(C=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(C[1]=0,C[2]=0),C[0]=1,C[3]=1,C),M=this.rotationMatrix,k=this.angle,z=(P=this.rotationMatrix)[0],G=P[1],X=P[2],Z=P[3],se=Math.sin(k),Ie=Math.cos(k),M[0]=z*Ie+X*se,M[1]=G*Ie+Z*se,M[2]=z*-se+X*Ie,M[3]=G*-se+Z*Ie)}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const g=p.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==g&&(this._unmodified=!1,this._pitch=g,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=p.degToRad(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const g=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==g&&(this._unmodified=!1,this._setZoom(g),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const l=this._elevation;this._centerAltitude=l.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=l.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,g=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],C=this.horizonLineFromTop();let M=0,P=0;for(let k=0;k<g.length;k++){const z=new p.Point(g[k][0]*this.width,C+g[k][1]*(this.height-C)),G=l.pointCoordinate(z);if(!G)continue;const X=1/Math.hypot(G[0]-this._camera.position[0],G[1]-this._camera.position[1]);M+=G[3]*X,P+=X}return 0===P?NaN:M/P}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const l=this._seaLevelZoom,g=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),C=this.pixelsPerMeter/this.worldSize*g,M=this._mercatorZfromZoom(l),P=this._mercatorZfromZoom(this._maxZoom),k=Math.max(M-C,P);this._setZoom(this._zoomFromMercatorZ(k))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const g=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let C;C=l.z<this._camera.position[2]?[g.x,g.y,g.z]:[l.x,l.y,l.z];const M=p.length(p.sub([],this._camera.position,C));return p.clamp(this._zoomFromMercatorZ(M),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let g=!1;if(l.orientation&&!p.exactEquals(l.orientation,this._camera.orientation)&&(g=this._setCameraOrientation(l.orientation)),l.position){const C=[l.position.x,l.position.y,l.position.z];p.exactEquals$1(C,this._camera.position)||(this._setCameraPosition(C),g=!0)}g&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,g=new co;return g.position=new p.MercatorCoordinate(l[0],l[1],l[2]),g.orientation=this._camera.orientation,g._elevation=this.elevation,g._renderWorldCopies=this.renderWorldCopies,g}_setCameraOrientation(l){if(!p.length$1(l))return!1;p.normalize$1(l,l);const g=p.transformQuat([],[0,0,-1],l),C=p.transformQuat([],[0,-1,0],l);if(C[2]<0)return!1;const M=qr(g,C);return!!M&&(this._camera.orientation=M,!0)}_setCameraPosition(l){const g=this.zoomScale(this.minZoom)*this.tileSize,C=this.zoomScale(this.maxZoom)*this.tileSize,M=this.cameraToCenterDistance;l[2]=p.clamp(l[2],M/C,M/g),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,g,C){this._unmodified=!1,this._edgeInsets.interpolate(l,g,C),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const g=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,g)}getVisibleUnwrappedCoordinates(l){const g=[new p.UnwrappedTileID(0,l)];if(this.renderWorldCopies){const C=this.pointCoordinate(new p.Point(0,0)),M=this.pointCoordinate(new p.Point(this.width,0)),P=this.pointCoordinate(new p.Point(this.width,this.height)),k=this.pointCoordinate(new p.Point(0,this.height)),z=Math.floor(Math.min(C.x,M.x,P.x,k.x)),G=Math.floor(Math.max(C.x,M.x,P.x,k.x)),X=1;for(let Z=z-X;Z<=G+X;Z++)0!==Z&&g.push(new p.UnwrappedTileID(Z,l))}return g}coveringTiles(l){let g=this.coveringZoomLevel(l);const C=g,M=this.elevation&&!l.isTerrainDEM,P="mercator"===this.projection.name;if(void 0!==l.minzoom&&g<l.minzoom)return[];void 0!==l.maxzoom&&g>l.maxzoom&&(g=l.maxzoom);const k=this.locationCoordinate(this.center),z=this.center.lat,G=1<<g,X=[G*k.x,G*k.y,0],Z="globe"===this.projection.name,se=!Z,Ie=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g,se),ze=Z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),$e=G*p.mercatorZfromAltitude(1,this.center.lat),je=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),We=[G*ze.x,G*ze.y,je*(se?1:$e)],ue=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),Fe=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?g:0,nt=l.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Qe=l.isTerrainDEM?-nt:this._elevation?this._elevation.getMinElevationBelowMSL():0,Et=this.projection.isReprojectedInTileSpace?io(this):1,St=Gt=>{const En=new p.MercatorCoordinate(Gt.x+25e-6,Gt.y,Gt.z),vn=new p.MercatorCoordinate(Gt.x,Gt.y+25e-6,Gt.z),Ln=Gt.toLngLat(),wr=En.toLngLat(),Vr=vn.toLngLat(),or=this.locationCoordinate(Ln),Ar=this.locationCoordinate(wr),Xn=this.locationCoordinate(Vr),ci=Math.hypot(Ar.x-or.x,Ar.y-or.y),yr=Math.hypot(Xn.x-or.x,Xn.y-or.y);return Math.sqrt(ci*yr)*Et/25e-6},at=Gt=>{const fn=nt,En=Qe;return{aabb:p.tileAABB(this,G,0,0,0,Gt,En,fn,this.projection),zoom:0,x:0,y:0,minZ:En,maxZ:fn,wrap:Gt,fullyVisible:!1}},Ot=[];let Rt=[];const kt=g,Dn=l.reparseOverscaled?C:g,Ut=Gt=>Gt*Gt,an=Ut((je-this._centerAltitude)*$e),Ht=Gt=>{if(!this._elevation||!Gt.tileID||!P)return;const fn=this._elevation.getMinMaxForTile(Gt.tileID),En=Gt.aabb;fn?(En.min[2]=fn.min,En.max[2]=fn.max,En.center[2]=(En.min[2]+En.max[2])/2):(Gt.shouldSplit=gn(Gt),Gt.shouldSplit||(En.min[2]=En.max[2]=En.center[2]=this._centerAltitude))},gn=Gt=>{if(Gt.zoom<Fe)return!0;if(Gt.zoom===kt)return!1;if(null!=Gt.shouldSplit)return Gt.shouldSplit;const fn=Gt.aabb.distanceX(We),En=Gt.aabb.distanceY(We);let vn=an,Ln=1;if(Z){vn=Ut(Gt.aabb.distanceZ(We));const or=Math.pow(2,Gt.zoom),Ar=p.latFromMercatorY((Gt.y+1)/or),Xn=p.latFromMercatorY(Gt.y/or),ci=Math.min(Math.max(z,Ar),Xn),yr=p.circumferenceAtLatitude(ci)/p.circumferenceAtLatitude(z);if(Ln=ci===z?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,yr/this._mercatorScaleRatio),this.zoom<=p.GLOBE_ZOOM_THRESHOLD_MIN&&Gt.zoom===kt-1&&yr>=.9)return!0}else if(M&&(vn=Ut(Gt.aabb.distanceZ(We)*$e)),this.projection.isReprojectedInTileSpace&&C<=5){const or=Math.pow(2,Gt.zoom),Ar=St(new p.MercatorCoordinate((Gt.x+.5)/or,(Gt.y+.5)/or));Ln=Ar>.85?1:Ar}const wr=fn*fn+En*En+vn;return wr<Ut((1<<kt-Gt.zoom)*ue*Ln*((or,Ar)=>{if(Ar*Ut(.707)<or)return 1;const Xn=Math.sqrt(Ar/or);return Xn/(1.4144271570014144+(Math.pow(1.1,Xn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(vn,an),wr))};if(this.renderWorldCopies)for(let Gt=1;Gt<=3;Gt++)Ot.push(at(-Gt)),Ot.push(at(Gt));for(Ot.push(at(0));Ot.length>0;){const Gt=Ot.pop(),fn=Gt.x,En=Gt.y;let vn=Gt.fullyVisible;if(!vn){const Ln=Gt.aabb.intersects(Ie);if(0===Ln)continue;vn=2===Ln}if(Gt.zoom!==kt&&gn(Gt))for(let Ln=0;Ln<4;Ln++){const wr=(fn<<1)+Ln%2,Vr=(En<<1)+(Ln>>1),or={aabb:P?Gt.aabb.quadrant(Ln):p.tileAABB(this,G,Gt.zoom+1,wr,Vr,Gt.wrap,Gt.minZ,Gt.maxZ,this.projection),zoom:Gt.zoom+1,x:wr,y:Vr,wrap:Gt.wrap,fullyVisible:vn,tileID:void 0,shouldSplit:void 0,minZ:Gt.minZ,maxZ:Gt.maxZ};M&&!Z&&(or.tileID=new p.OverscaledTileID(Gt.zoom+1===kt?Dn:Gt.zoom+1,Gt.wrap,Gt.zoom+1,wr,Vr),Ht(or)),Ot.push(or)}else{const Ln=Gt.zoom===kt?Dn:Gt.zoom;if(l.minzoom&&l.minzoom>Ln)continue;const wr=X[0]-(.5+fn+(Gt.wrap<<Gt.zoom))*(1<<g-Gt.zoom),Vr=X[1]-.5-En,or=Gt.tileID?Gt.tileID:new p.OverscaledTileID(Ln,Gt.wrap,Gt.zoom,fn,En);Rt.push({tileID:or,distanceSq:wr*wr+Vr*Vr})}}if(this.fogCullDistSq){const Gt=this.fogCullDistSq,fn=this.horizonLineFromTop();Rt=Rt.filter(En=>{const vn=[0,0,0,1],Ln=[p.EXTENT,p.EXTENT,0,1],wr=this.calculateFogTileMatrix(En.tileID.toUnwrapped());p.transformMat4$1(vn,vn,wr),p.transformMat4$1(Ln,Ln,wr);const Vr=p.getAABBPointSquareDist(vn,Ln);if(0===Vr)return!0;let or=!1;const Ar=this._elevation;if(Ar&&Vr>Gt&&0!==fn){const Xn=this.calculateProjMatrix(En.tileID.toUnwrapped());let ci;l.isTerrainDEM||(ci=Ar.getMinMaxForTile(En.tileID)),ci||(ci={min:Qe,max:nt});const yr=p.furthestTileCorner(this.rotation),bo=[yr[0]*p.EXTENT,yr[1]*p.EXTENT,ci.max];p.transformMat4(bo,bo,Xn),or=(1-bo[1])*this.height*.5<fn}return Vr<Gt||or})}return Rt.sort((Gt,fn)=>Gt.distanceSq-fn.distanceSq).map(Gt=>Gt.tileID)}resize(l,g){this.width=l,this.height=g,this.pixelsToGLUnits=[2/l,-2/g],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const g=p.clamp(l.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),C=this.projection.project(l.lng,g);return new p.Point(C.x*this.worldSize,C.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/p.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,g){let C,M;const P=this.centerPoint;if("globe"===this.projection.name){const z=this.worldSize;C=(g.x-P.x)/z,M=(g.y-P.y)/z}else{const z=this.pointCoordinate(g),G=this.pointCoordinate(P);C=z.x-G.x,M=z.y-G.y}const k=this.locationCoordinate(l);this.setLocation(new p.MercatorCoordinate(k.x-C,k.y-M))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,g){const C=g?p.mercatorZfromAltitude(g,l.lat):void 0,M=this.projection.project(l.lng,l.lat);return new p.MercatorCoordinate(M.x,M.y,C)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,g){const C=g??this._centerAltitude,M=[l.x,l.y,0,1],P=[l.x,l.y,1,1];p.transformMat4$1(M,M,this.pixelMatrixInverse),p.transformMat4$1(P,P,this.pixelMatrixInverse);const k=P[3];p.scale$1(M,M,1/M[3]),p.scale$1(P,P,1/k);const z=M[2],G=P[2];return{p0:M,p1:P,t:z===G?0:(C-z)/(G-z)}}screenPointToMercatorRay(l){const g=[l.x,l.y,0,1],C=[l.x,l.y,1,1];return p.transformMat4$1(g,g,this.pixelMatrixInverse),p.transformMat4$1(C,C,this.pixelMatrixInverse),p.scale$1(g,g,1/g[3]),p.scale$1(C,C,1/C[3]),g[2]=p.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,C[2]=p.mercatorZfromAltitude(C[2],this._center.lat)*this.worldSize,p.scale$1(g,g,1/this.worldSize),p.scale$1(C,C,1/this.worldSize),new p.Ray([g[0],g[1],g[2]],p.normalize([],p.sub([],C,g)))}rayIntersectionCoordinate(l){const{p0:g,p1:C,t:M}=l,P=p.mercatorZfromAltitude(g[2],this._center.lat),k=p.mercatorZfromAltitude(C[2],this._center.lat);return new p.MercatorCoordinate(p.number(g[0],C[0],M)/this.worldSize,p.number(g[1],C[1],M)/this.worldSize,p.number(P,k,M))}pointCoordinate(l,g=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,g)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let g=this.projection.pointCoordinate3D(this,l.x,l.y);if(g)return new p.MercatorCoordinate(g[0],g[1],g[2]);let C=0,M=this.horizonLineFromTop();if(l.y>M)return this.pointCoordinate(l);const P=.02*M,k=l.clone();for(let z=0;z<10&&M-C>P;z++){k.y=p.number(C,M,.66);const G=this.projection.pointCoordinate3D(this,k.x,k.y);G?(M=k.y,g=G):C=k.y}return g?new p.MercatorCoordinate(g[0],g[1],g[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(l);const g=this.pointCoordinate(l);return g.y>=0&&g.y<=1}_coordinatePoint(l,g){const C=g&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,M=[l.x*this.worldSize,l.y*this.worldSize,C+l.toAltitude(),1];return p.transformMat4$1(M,M,this.pixelMatrix),M[3]>0?new p.Point(M[0]/M[3],M[1]/M[3]):new p.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:g}=this._edgeInsets,C=this.height-this._edgeInsets.bottom,M=this.width-this._edgeInsets.right,P=this.pointLocation3D(new p.Point(g,l)),k=this.pointLocation3D(new p.Point(M,l)),z=this.pointLocation3D(new p.Point(M,C)),G=this.pointLocation3D(new p.Point(g,C));let X=Math.min(P.lng,k.lng,z.lng,G.lng),Z=Math.max(P.lng,k.lng,z.lng,G.lng),se=Math.min(P.lat,k.lat,z.lat,G.lat),Ie=Math.max(P.lat,k.lat,z.lat,G.lat);const ze=Math.pow(2,-this.zoom)/16*270,$e="globe"===this.projection.name?1:4,je=(We,ue,Fe,nt,Qe)=>{const Et=(We+Fe)/2,St=(ue+nt)/2,at=new p.Point(Et,St),{lng:Ot,lat:Rt}=this.pointLocation3D(at),kt=Math.max(0,X-Ot,se-Rt,Ot-Z,Rt-Ie);X=Math.min(X,Ot),Z=Math.max(Z,Ot),se=Math.min(se,Rt),Ie=Math.max(Ie,Rt),(Qe<$e||kt>ze)&&(je(We,ue,Et,St,Qe+1),je(Et,St,Fe,nt,Qe+1))};if(je(g,l,M,l,1),je(M,l,M,C,1),je(M,C,g,C,1),je(g,C,g,l,1),"globe"===this.projection.name){const[We,ue]=p.polesInViewport(this);We?(Ie=90,Z=180,X=-180):ue&&(se=-90,Z=180,X=-180)}return new p.LngLatBounds(new p.LngLat(X,se),new p.LngLat(Z,Ie))}_getBoundsRectangular(l,g){const{top:C,left:M}=this._edgeInsets,P=this.height-this._edgeInsets.bottom,k=this.width-this._edgeInsets.right,z=new p.Point(M,C),G=new p.Point(k,C),X=new p.Point(k,P),Z=new p.Point(M,P);let se=this.pointCoordinate(z,l),Ie=this.pointCoordinate(G,l);const ze=this.pointCoordinate(X,g),$e=this.pointCoordinate(Z,g),je=(We,ue)=>(ue.y-We.y)/(ue.x-We.x);return se.y>1&&Ie.y>=0?se=new p.MercatorCoordinate((1-$e.y)/je($e,se)+$e.x,1):se.y<0&&Ie.y<=1&&(se=new p.MercatorCoordinate(-$e.y/je($e,se)+$e.x,0)),Ie.y>1&&se.y>=0?Ie=new p.MercatorCoordinate((1-ze.y)/je(ze,Ie)+ze.x,1):Ie.y<0&&se.y<=1&&(Ie=new p.MercatorCoordinate(-ze.y/je(ze,Ie)+ze.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(se)).extend(this.coordinateLocation(Ie)).extend(this.coordinateLocation($e)).extend(this.coordinateLocation(ze))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const g=l.visibleDemTiles.reduce((C,M)=>{if(M.dem){const P=M.dem.tree;C.min=Math.min(C.min,P.minimums[0]),C.max=Math.max(C.max,P.maximums[0])}return C},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(g.min*l.exaggeration(),g.max*l.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const g=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,C=this.height/2-g*(1-this._horizonShift);return l?Math.max(0,C):C}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,g){return this.projection.createTileMatrix(this,g,l)}calculateDistanceTileData(l){const g=l.key,C=this._distanceTileDataCache;if(C[g])return C[g];const M=l.canonical,P=1/this.height,k=this.cameraWorldSize,z=k/this.zoomScale(M.z),G=(M.x+Math.pow(2,M.z)*l.wrap)*z,X=M.y*z,Z=this.point;Z.x*=k/this.worldSize,Z.y*=k/this.worldSize;const se=this.angle,Ie=Math.sin(-se),ze=-Math.cos(-se);return C[g]={bearing:[Ie,ze],center:[(Z.x-G)*P,(Z.y-X)*P],scale:z/p.EXTENT*P},C[g]}calculateFogTileMatrix(l){const g=l.key,C=this._fogTileMatrixCache;if(C[g])return C[g];const M=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return p.multiply(M,this.worldToFogMatrix,M),C[g]=new Float32Array(M),C[g]}calculateProjMatrix(l,g=!1){const C=l.key,M=g?this._alignedProjMatrixCache:this._projMatrixCache;if(M[C])return M[C];const P=this.calculatePosMatrix(l,this.worldSize);return p.multiply(P,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.alignedProjMatrix:this.projMatrix,P),M[C]=new Float32Array(P),M[C]}calculatePixelsToTileUnitsMatrix(l){const g=l.tileID.key,C=this._pixelsToTileUnitsCache;if(C[g])return C[g];const M=function(P,k){const{scale:z}=P.tileTransform,G=z*p.EXTENT/(P.tileSize*Math.pow(2,k.zoom-P.tileID.overscaledZ+P.tileID.canonical.z));return X=new Float32Array(4),Ie=(Z=k.inverseAdjustmentMatrix)[1],ze=Z[2],$e=Z[3],We=(se=[G,G])[1],X[0]=Z[0]*(je=se[0]),X[1]=Ie*je,X[2]=ze*We,X[3]=$e*We,X;var X,Z,se,Ie,ze,$e,je,We}(l,this);return C[g]=M,C[g]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const l=1/this.worldSize,g=p.fromScaling([],[l,l,l]);return p.multiply(g,g,this.globeMatrix),g}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const l=this._elevation;this._updateCameraState();const g=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,C=this._computeCameraPosition(g),M=this._camera.forward(),P=p.mercatorZfromAltitude(1,this._center.lat);C[2]/=P,M[2]/=P,p.normalize(M,M);const k=l.raycast(C,M,l.exaggeration());if(k){const z=p.scaleAndAdd([],C,M,k),G=new p.MercatorCoordinate(z[0],z[1],p.mercatorZfromAltitude(z[2],p.latFromMercatorY(z[1]))),X=(G.z+p.length([G.x-C[0],G.y-C[1],G.z-C[2]*P]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(X),this._centerAltitude=G.toAltitude(),this._center=this.coordinateLocation(G),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const g=this._elevation,C=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,M=this._computeCameraPosition(C),P=g.getAtPointOrZero(new p.MercatorCoordinate(...M)),k=this.pixelsPerMeter/this.worldSize*P,z=this._minimumHeightOverTerrain(),G=M[2]-k;if(G<=z)if(G<0||l){const X=this.locationCoordinate(this._center,this._centerAltitude),Z=[M[0],M[1],X.z-M[2]],se=p.length(Z);Z[2]-=(z-G)/this._pixelsPerMercatorPixel;const Ie=p.length(Z);if(0===Ie)return;p.scale$2(Z,Z,se/Ie*this._pixelsPerMercatorPixel),this._camera.position=[M[0],M[1],X.z*this._pixelsPerMercatorPixel-Z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const Ie=this.center;return Ie.lat=p.clamp(Ie.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(Ie.lng=p.clamp(Ie.lng,this.minLng,this.maxLng)),this.center=Ie,void(this._constraining=!1)}const g=this._unmodified,{x:C,y:M}=this.point;let P=0,k=C,z=M;const G=this.width/2,X=this.height/2,Z=this.worldMinY*this.scale,se=this.worldMaxY*this.scale;if(M-X<Z&&(z=Z+X),M+X>se&&(z=se-X),se-Z<this.height&&(P=Math.max(P,this.height/(se-Z)),z=(se+Z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Ie=this.worldMinX*this.scale,ze=this.worldMaxX*this.scale,$e=this.worldSize/2-(Ie+ze)/2;k=(C+$e+this.worldSize)%this.worldSize-$e,k-G<Ie&&(k=Ie+G),k+G>ze&&(k=ze-G),ze-Ie<this.width&&(P=Math.max(P,this.width/(ze-Ie)),k=(ze+Ie)/2)}k===C&&z===M||(this.center=this.unproject(new p.Point(k,z))),P&&(this.zoom+=this.scaleZoom(P)),this._constrainCamera(),this._unmodified=g,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,g=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.mercatorZfromAltitude(1,this.center.lat)/p.mercatorZfromAltitude(1,p.GLOBE_SCALE_MATCH_LATITUDE));const C=da(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,C),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const M="meters"===this.projection.zAxisUnit?g:1,P=this._camera.getWorldToCamera(this.worldSize,M),k=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);k[8]=2*-l.x/this.width,k[9]=2*l.y/this.height;let z=p.mul([],k,P);if(this.projection.isReprojectedInTileSpace){const St=this.locationCoordinate(this.center),at=p.identity([]);p.translate(at,at,[St.x*this.worldSize,St.y*this.worldSize,0]),p.multiply(at,at,xa(this)),p.translate(at,at,[-St.x*this.worldSize,-St.y*this.worldSize,0]),p.multiply(z,z,at),this.inverseAdjustmentMatrix=function(Ot){const Rt=xa(Ot,!0);return te([],[Rt[0],Rt[1],Rt[4],Rt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],z,[this.worldSize,this.worldSize,this.worldSize/M,1]),this.projMatrix=z,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const G=p.invert([],k);this.frustumCorners=p.FrustumCorners.fromInvProjectionMatrix(G,this.horizonLineFromTop(),this.height);const X=new Float32Array(16);p.identity(X),p.scale(X,X,[1,-1,1]),p.rotateX(X,X,this._pitch),p.rotateZ(X,X,this.angle);const Z=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),se=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Z[8]=2*-l.x/this.width,Z[9]=2*(l.y+se)/this.height,this.skyboxMatrix=p.multiply(X,Z,X);const Ie=this.point,ze=Ie.x,$e=Ie.y,je=this.width%2/2,We=this.height%2/2,ue=Math.cos(this.angle),Fe=Math.sin(this.angle),nt=ze-Math.round(ze)+ue*je+Fe*We,Qe=$e-Math.round($e)+ue*We+Fe*je,Et=new Float64Array(z);if(p.translate(Et,Et,[nt>.5?nt-1:nt,Qe>.5?Qe-1:Qe,0]),this.alignedProjMatrix=Et,z=p.create(),p.scale(z,z,[this.width/2,-this.height/2,1]),p.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=p.create(),p.scale(z,z,[1,-1,1]),p.translate(z,z,[-1,-1,0]),p.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},z=p.invert(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.calculateGlobeMatrix(this);const St=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.transformMat4(St,St,P),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,g=this.cameraPixelsPerMeter,C=this._camera.position,M=1/this.height/this._pixelsPerMercatorPixel,P=[l,l,g];p.scale$2(P,P,M),p.scale$2(C,C,-1),p.multiply$2(C,C,P);const k=p.create();p.translate(k,k,C),p.scale(k,k,P),this.mercatorFogMatrix=k,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,g,M)}_computeCameraPosition(l){const g=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,C=this._camera.forward(),M=this.point,P=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*g-l/this.worldSize*this._centerAltitude;return[M.x/this.worldSize-C[0]*P,M.y/this.worldSize-C[1]*P,l/this.worldSize*this._centerAltitude-C[2]*P]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const g=this._maxCameraBoundsDistance()*Math.cos(this._pitch),C=this._camera.position[2],M=l[2];let P=1;this.projection.wrap&&(this.center=this.center.wrap()),M>0&&(P=Math.min((g-C)/M,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,l,P),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,g=this._camera.forward(),{pitch:C,bearing:M}=this._camera.getPitchBearing(),P=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,k=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),z=Math.max((l[2]-P)/Math.cos(C),k),G=this._zoomFromMercatorZ(z);p.scaleAndAdd(l,l,g,z),this._pitch=p.clamp(C,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(M,-Math.PI,Math.PI),this._setZoom(p.clamp(G,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let g=0,C=p.GLOBE_ZOOM_THRESHOLD_MAX,M=0,P=1/0;for(;C-g>1e-6&&C>g;){const k=g+.5*(C-g),z=this.tileSize*Math.pow(2,k),G=this.getCameraToCenterDistance(this.projection,k,z),X=this.scaleZoom(G/(l*this.tileSize)),Z=Math.abs(k-X);Z<P&&(P=Z,M=k),k<X?g=k:C=k}return M}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,g){const C=Math.min(l.x,g.x),M=Math.max(l.x,g.x),P=Math.min(l.y,g.y),k=Math.max(l.y,g.y);if(P<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const z=[new p.Point(C,P),new p.Point(M,k),new p.Point(C,k),new p.Point(M,P)],G=this.renderWorldCopies?-3:0,X=this.renderWorldCopies?4:1;for(const Z of z){const se=this.pointRayIntersection(Z);if(se.t<0)return!0;const Ie=this.rayIntersectionCoordinate(se);if(Ie.x<G||Ie.y<0||Ie.x>X||Ie.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.Point(0,0),new p.Point(this.width,this.height))}zoomDeltaToMovement(l,g){const C=p.length(p.sub([],this._camera.position,l)),M=this._zoomFromMercatorZ(C)+g;return C-this._mercatorZfromZoom(M)}getCameraPoint(){if("globe"===this.projection.name){const l=function([g,C,M],P){const k=[g,C,M,1];p.transformMat4$1(k,k,P);const z=k[3]=Math.max(k[3],1e-6);return k[0]/=z,k[1]/=z,k[2]/=z,k}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.Point(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,l))}}getCameraToCenterDistance(l,g=this.zoom,C=this.worldSize){const M=da(l,g,this.width,this.height,1024),P=l.pixelSpaceConversion(this.center.lat,C,M);return.5/Math.tan(.5*this._fov)*this.height*P}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.multiply(l,l,this.globeMatrix),l}}function pa(w,l){let g=!1,C=null;const M=()=>{C=null,g&&(w(),C=setTimeout(M,l),g=!1)};return()=>(g=!0,C||M(),C)}class Dl{constructor(l){this._hashName=l&&encodeURIComponent(l),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=pa(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,p.window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const g=za(l);if(this._hashName){const C=this._hashName;let M=!1;const P=p.window.location.hash.slice(1).split("&").map(k=>{const z=k.split("=")[0];return z===C?(M=!0,`${z}=${g}`):k}).filter(k=>k);return M||P.push(`${C}=${g}`),`#${P.join("&")}`}return`#${g}`}_getCurrentHash(){const l=p.window.location.hash.replace("#","");if(this._hashName){let g;return l.split("&").map(C=>C.split("=")).forEach(C=>{C[0]===this._hashName&&(g=C)}),(g&&g[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const g=this._getCurrentHash();if(g.length>=3&&!g.some(C=>isNaN(C))){const C=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(g[3]||0):l.getBearing();return l.jumpTo({center:[+g[2],+g[1]],zoom:+g[0],bearing:C,pitch:+(g[4]||0)}),!0}return!1}_updateHashUnthrottled(){const l=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,l)}}function za(w,l){const g=w.getCenter(),C=Math.round(100*w.getZoom())/100,M=Math.ceil((C*Math.LN2+Math.log(512/360/.5))/Math.LN10),P=Math.pow(10,M),k=Math.round(g.lng*P)/P,z=Math.round(g.lat*P)/P,G=w.getBearing(),X=w.getPitch();let Z=l?`/${k}/${z}/${C}`:`${C}/${z}/${k}`;return(G||X)&&(Z+="/"+Math.round(10*G)/10),X&&(Z+=`/${Math.round(X)}`),Z}const vo={linearity:.3,easing:p.bezier(0,0,.3,1)},_s=p.extend({deceleration:2500,maxSpeed:1400},vo),Ls=p.extend({deceleration:20,maxSpeed:1400},vo),$n=p.extend({deceleration:1e3,maxSpeed:360},vo),ho=p.extend({deceleration:1e3,maxSpeed:90},vo);class dh{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,g=p.exported.now();for(;l.length>0&&g-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const g={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:P}of this._inertiaBuffer)g.zoom+=P.zoomDelta||0,g.bearing+=P.bearingDelta||0,g.pitch+=P.pitchDelta||0,P.panDelta&&g.pan._add(P.panDelta),P.around&&(g.around=P.around),P.pinchAround&&(g.pinchAround=P.pinchAround);const C=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,M={};if(g.pan.mag()){const P=fo(g.pan.mag(),C,p.extend({},_s,l||{}));M.offset=g.pan.mult(P.amount/g.pan.mag()),M.center=this._map.transform.center,ku(M,P)}if(g.zoom){const P=fo(g.zoom,C,Ls);M.zoom=this._map.transform.zoom+P.amount,ku(M,P)}if(g.bearing){const P=fo(g.bearing,C,$n);M.bearing=this._map.transform.bearing+p.clamp(P.amount,-179,179),ku(M,P)}if(g.pitch){const P=fo(g.pitch,C,ho);M.pitch=this._map.transform.pitch+P.amount,ku(M,P)}if(M.zoom||M.bearing){const P=void 0===g.pinchAround?g.around:g.pinchAround;M.around=P?this._map.unproject(P):this._map.getCenter()}return this.clear(),M.noMoveStart=!0,M}}function ku(w,l){(!w.duration||w.duration<l.duration)&&(w.duration=l.duration,w.easing=l.easing)}function fo(w,l,g){const{maxSpeed:C,linearity:M,deceleration:P}=g,k=p.clamp(w*M/(l/1e3),-C,C),z=Math.abs(k)/(P*M);return{easing:g.easing,duration:1e3*z,amount:k*(z/2)}}class wa extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,g,C,M={}){const P=ce(g.getCanvasContainer(),C),k=g.unproject(P);super(l,p.extend({point:P,lngLat:k,originalEvent:C},M)),this._defaultPrevented=!1,this.target=g}}class ru extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,g,C){const M="touchend"===l?C.changedTouches:C.touches,P=ee(g.getCanvasContainer(),M),k=P.map(G=>g.unproject(G)),z=P.reduce((G,X,Z,se)=>G.add(X.div(se.length)),new p.Point(0,0));super(l,{points:P,point:z,lngLats:k,lngLat:g.unproject(z),originalEvent:C}),this._defaultPrevented=!1}}class Or extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,g,C){super(l,{originalEvent:C}),this._defaultPrevented=!1}}class ba{constructor(l,g){this._map=l,this._clickTolerance=g.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new Or(l.type,this._map,l))}mousedown(l,g){return this._mousedownPos=g,this._firePreventable(new wa(l.type,this._map,l))}mouseup(l){this._map.fire(new wa(l.type,this._map,l))}preclick(l){const g=p.extend({},l);g.type="preclick",this._map.fire(new wa(g.type,this._map,g))}click(l,g){this._mousedownPos&&this._mousedownPos.dist(g)>=this._clickTolerance||(this.preclick(l),this._map.fire(new wa(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new wa(l.type,this._map,l))}mouseover(l){this._map.fire(new wa(l.type,this._map,l))}mouseout(l){this._map.fire(new wa(l.type,this._map,l))}touchstart(l){return this._firePreventable(new ru(l.type,this._map,l))}touchmove(l){this._map.fire(new ru(l.type,this._map,l))}touchend(l){this._map.fire(new ru(l.type,this._map,l))}touchcancel(l){this._map.fire(new ru(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vh{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new wa(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new wa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new wa(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fd{constructor(l,g){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=g.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,g){this.isEnabled()&&l.shiftKey&&0===l.button&&(Mt(),this._startPos=this._lastPos=g,this._active=!0)}mousemoveWindow(l,g){if(!this._active)return;const C=g,M=this._startPos,P=this._lastPos;if(!M||!P||P.equals(C)||!this._box&&C.dist(M)<this._clickTolerance)return;this._lastPos=C,this._box||(this._box=qe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const k=Math.min(M.x,C.x),z=Math.max(M.x,C.x),G=Math.min(M.y,C.y),X=Math.max(M.y,C.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${k}px,${G}px)`,this._box.style.width=z-k+"px",this._box.style.height=X-G+"px")})}mouseupWindow(l,g){if(!this._active)return;const C=this._startPos,M=g;if(C&&0===l.button){if(this.reset(),ne(),C.x!==M.x||C.y!==M.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:P=>P.fitScreenCoordinates(C,M,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&27===l.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),le(),delete this._startPos,delete this._lastPos}_fireEvent(l,g){return this._map.fire(new p.Event(l,{originalEvent:g}))}}function Ys(w,l){const g={};for(let C=0;C<w.length;C++)g[w[C].identifier]=l[C];return g}class rl{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,g,C){(this.centroid||C.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=l.timeStamp),C.length===this.numTouches&&(this.centroid=function(M){const P=new p.Point(0,0);for(const k of M)P._add(k);return P.div(M.length)}(g),this.touches=Ys(C,g)))}touchmove(l,g,C){if(this.aborted||!this.centroid)return;const M=Ys(C,g);for(const P in this.touches){const k=M[P];(!k||k.dist(this.touches[P])>30)&&(this.aborted=!0)}}touchend(l,g,C){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),0===C.length){const M=!this.aborted&&this.centroid;if(this.reset(),M)return M}}}class Fu{constructor(l){this.singleTap=new rl(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,g,C){this.singleTap.touchstart(l,g,C)}touchmove(l,g,C){this.singleTap.touchmove(l,g,C)}touchend(l,g,C){const M=this.singleTap.touchend(l,g,C);if(M){const P=l.timeStamp-this.lastTime<500,k=!this.lastTap||this.lastTap.dist(M)<30;if(P&&k||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=M,this.count===this.numTaps)return this.reset(),M}}}class Hl{constructor(){this._zoomIn=new Fu({numTouches:1,numTaps:2}),this._zoomOut=new Fu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,g,C){this._zoomIn.touchstart(l,g,C),this._zoomOut.touchstart(l,g,C)}touchmove(l,g,C){this._zoomIn.touchmove(l,g,C),this._zoomOut.touchmove(l,g,C)}touchend(l,g,C){const M=this._zoomIn.touchend(l,g,C),P=this._zoomOut.touchend(l,g,C);return M?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:k.getZoom()+1,around:k.unproject(M)},{originalEvent:l})}):P?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:k.getZoom()-1,around:k.unproject(P)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const js={0:1,2:2};class cu{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,g){return!1}_move(l,g){return{}}mousedown(l,g){if(this._lastPoint)return;const C=ae(l);this._correctButton(l,C)&&(this._lastPoint=g,this._eventButton=C)}mousemoveWindow(l,g){const C=this._lastPoint;if(C)if(l.preventDefault(),null!=this._eventButton&&function(M,P){const k=js[P];return void 0===M.buttons||(M.buttons&k)!==k}(l,this._eventButton))this.reset();else if(this._moved||!(g.dist(C)<this._clickTolerance))return this._moved=!0,this._lastPoint=g,this._move(C,g)}mouseupWindow(l){this._lastPoint&&ae(l)===this._eventButton&&(this._moved&&ne(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class na extends cu{mousedown(l,g){super.mousedown(l,g),this._lastPoint&&(this._active=!0)}_correctButton(l,g){return 0===g&&!l.ctrlKey}_move(l,g){return{around:g,panDelta:g.sub(l)}}}class Gs extends cu{_correctButton(l,g){return 0===g&&l.ctrlKey||2===g}_move(l,g){const C=.8*(g.x-l.x);if(C)return this._active=!0,{bearingDelta:C}}contextmenu(l){l.preventDefault()}}class Bu extends cu{_correctButton(l,g){return 0===g&&l.ctrlKey||2===g}_move(l,g){const C=-.5*(g.y-l.y);if(C)return this._active=!0,{pitchDelta:C}}contextmenu(l){l.preventDefault()}}class xr{constructor(l,g){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=g.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)}touchstart(l,g,C){return this._calculateTransform(l,g,C)}touchmove(l,g,C){if(this._active&&!(C.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===C.length&&!p.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,g,C)}}touchend(l,g,C){this._calculateTransform(l,g,C),this._active&&C.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,g,C){C.length>0&&(this._active=!0);const M=Ys(C,g),P=new p.Point(0,0),k=new p.Point(0,0);let z=0;for(const X in M){const Z=M[X],se=this._touches[X];se&&(P._add(Z),k._add(Z.sub(se)),z++,M[X]=Z)}if(this._touches=M,z<this._minTouches||!k.mag())return;const G=k.div(z);return this._sum._add(G),this._sum.mag()<this._clickTolerance?void 0:{around:P.div(z),panDelta:G}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=qe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Cu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,g,C){return{}}touchstart(l,g,C){this._firstTwoTouches||C.length<2||(this._firstTwoTouches=[C[0].identifier,C[1].identifier],this._start([g[0],g[1]]))}touchmove(l,g,C){const M=this._firstTwoTouches;if(!M)return;l.preventDefault();const[P,k]=M,z=Aa(C,g,P),G=Aa(C,g,k);if(!z||!G)return;const X=this._aroundCenter?null:z.add(G).div(2);return this._move([z,G],X,l)}touchend(l,g,C){if(!this._firstTwoTouches)return;const[M,P]=this._firstTwoTouches,k=Aa(C,g,M),z=Aa(C,g,P);k&&z||(this._active&&ne(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&"center"===l.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Aa(w,l,g){for(let C=0;C<w.length;C++)if(w[C].identifier===g)return l[C]}function Al(w,l){return Math.log(w/l)/Math.LN2}class Su extends Cu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,g){const C=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Al(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Al(this._distance,C),pinchAround:g}}}function dd(w,l){return 180*w.angleWith(l)/Math.PI}class Ua extends Cu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,g){const C=this._vector;if(this._vector=l[0].sub(l[1]),C&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:dd(this._vector,C),pinchAround:g}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const g=25/(Math.PI*this._minDiameter)*360,C=this._startVector;if(!C)return!1;const M=dd(l,C);return Math.abs(M)<g}}function no(w){return Math.abs(w.y)>Math.abs(w.x)}class pd extends Cu{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,no(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,g,C){const M=this._lastPoints;if(!M)return;const P=l[0].sub(M[0]),k=l[1].sub(M[1]);return this._map._cooperativeGestures&&!p.isFullscreen()&&C.touches.length<3||(this._valid=this.gestureBeginsVertically(P,k,C.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(P.y+k.y)/2*-.5})}gestureBeginsVertically(l,g,C){if(void 0!==this._valid)return this._valid;const M=l.mag()>=2,P=g.mag()>=2;if(!M&&!P)return;if(!M||!P)return null==this._firstMove&&(this._firstMove=C),C-this._firstMove<100&&void 0;const k=l.y>0==g.y>0;return no(l)&&no(g)&&k}}const ke={panStep:100,bearingStep:15,pitchStep:10};class a{constructor(){const l=ke;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let g=0,C=0,M=0,P=0,k=0;switch(l.keyCode){case 61:case 107:case 171:case 187:g=1;break;case 189:case 109:case 173:g=-1;break;case 37:l.shiftKey?C=-1:(l.preventDefault(),P=-1);break;case 39:l.shiftKey?C=1:(l.preventDefault(),P=1);break;case 38:l.shiftKey?M=1:(l.preventDefault(),k=-1);break;case 40:l.shiftKey?M=-1:(l.preventDefault(),k=1);break;default:return}return this._rotationDisabled&&(C=0,M=0),{cameraAnimation:z=>{const G=z.getZoom();z.easeTo({duration:300,easeId:"keyboardHandler",easing:h,zoom:g?Math.round(G)+g*(l.shiftKey?2:1):G,bearing:z.getBearing()+C*this._bearingStep,pitch:z.getPitch()+M*this._pitchStep,offset:[-P*this._panStep,-k*this._panStep],center:z.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function h(w){return w*(2-w)}const y=4.000244140625;class x{constructor(l,g){this._map=l,this._el=l.getCanvasContainer(),this._handler=g,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&"center"===l.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||p.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let g=l.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const C=p.exported.now(),M=C-(this._lastWheelEventTime||0);this._lastWheelEventTime=C,0!==g&&g%y==0?this._type="wheel":0!==g&&Math.abs(g)<4?this._type="trackpad":M>400?(this._type=null,this._lastValue=g,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(M*g)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,g+=this._lastValue)),l.shiftKey&&g&&(g/=4),this._type&&(this._lastWheelEvent=l,this._delta-=g,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const g=ce(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:g,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;"wheel"===this._type&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const g=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(0!==this._delta){const G="wheel"===this._type&&Math.abs(this._delta)>y?this._wheelZoomRate:this._defaultZoomRate;let X=2/(1+Math.exp(-Math.abs(this._delta*G)));this._delta<0&&0!==X&&(X=1/X);const Z=g(),se=Math.pow(2,Z),Ie="number"==typeof this._targetZoom?l.zoomScale(this._targetZoom):se;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(Ie*X))),"wheel"===this._type&&(this._startZoom=Z,this._easing=this._smoothOutEasing(200)),this._delta=0}const C="number"==typeof this._targetZoom?this._targetZoom:g(),M=this._startZoom,P=this._easing;let k,z=!1;if("wheel"===this._type&&M&&P){const G=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),X=P(G);k=p.number(M,C,X),G<1?this._frameId||(this._frameId=!0):z=!0}else k=C,z=!0;return this._active=!0,z&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!z,zoomDelta:k-g(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let g=p.ease;if(this._prevEase){const C=this._prevEase,M=(p.exported.now()-C.start)/C.duration,P=C.easing(M+.01)-C.easing(M),k=.27/Math.sqrt(P*P+1e-4)*.01,z=Math.sqrt(.0729-k*k);g=p.bezier(k,z,.25,1)}return this._prevEase={start:p.exported.now(),duration:l,easing:g},g}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=qe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class D{constructor(l,g){this._clickZoom=l,this._tapZoom=g}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class U{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,g){return l.preventDefault(),{cameraAnimation:C=>{C.easeTo({duration:300,zoom:C.getZoom()+(l.shiftKey?-1:1),around:C.unproject(g)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class H{constructor(){this._tap=new Fu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,g,C){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?C.length>0&&(this._swipePoint=g[0],this._swipeTouch=C[0].identifier):this._tap.touchstart(l,g,C))}touchmove(l,g,C){if(this._tapTime){if(this._swipePoint){if(C[0].identifier!==this._swipeTouch)return;const M=g[0],P=M.y-this._swipePoint.y;return this._swipePoint=M,l.preventDefault(),this._active=!0,{zoomDelta:P/128}}}else this._tap.touchmove(l,g,C)}touchend(l,g,C){this._tapTime?this._swipePoint&&0===C.length&&this.reset():this._tap.touchend(l,g,C)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pe{constructor(l,g,C){this._el=l,this._mousePan=g,this._touchPan=C}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ge{constructor(l,g,C){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=g,this._mousePitch=C}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class wt{constructor(l,g,C,M){this._el=l,this._touchZoom=g,this._touchRotate=C,this._tapDragZoom=M,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const qt=w=>w.zoom||w.drag||w.pitch||w.rotate;class nn extends p.Event{}class Wn{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,g){const C=p.sub([],g,l);this.radius=p.length(C[2]<0?p.div([],C,this.constants):[C[0],C[1],0])}projectRay(l){p.div(l,l,this.constants),p.normalize(l,l),p.mul$1(l,l,this.constants);const g=p.scale$2([],l,this.radius);if(g[2]>0){const C=p.scale$2([],[0,0,1],p.dot(g,[0,0,1])),M=p.scale$2([],p.normalize([],[g[0],g[1],0]),this.radius),P=p.add([],g,p.scale$2([],p.sub([],p.add([],M,C),g),2));g[0]=P[0],g[1]=P[1]}return g}}function kn(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta}class tr{constructor(l,g){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new dh(l),this._bearingSnap=g.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Wn,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(g),p.bindAll(["handleEvent","handleWindowEvent"],this);const C=this._el;this._listeners=[[C,"touchstart",{passive:!0}],[C,"touchmove",{passive:!1}],[C,"touchend",void 0],[C,"touchcancel",void 0],[C,"mousedown",void 0],[C,"mousemove",void 0],[C,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[C,"mouseover",void 0],[C,"mouseout",void 0],[C,"dblclick",void 0],[C,"click",void 0],[C,"keydown",{capture:!1}],[C,"keyup",void 0],[C,"wheel",{passive:!1}],[C,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[M,P,k]of this._listeners)M.addEventListener(P,M===p.window.document?this.handleWindowEvent:this.handleEvent,k)}destroy(){for(const[l,g,C]of this._listeners)l.removeEventListener(g,l===p.window.document?this.handleWindowEvent:this.handleEvent,C)}_addDefaultHandlers(l){const g=this._map,C=g.getCanvasContainer();this._add("mapEvent",new ba(g,l));const M=g.boxZoom=new fd(g,l);this._add("boxZoom",M);const P=new Hl,k=new U;g.doubleClickZoom=new D(k,P),this._add("tapZoom",P),this._add("clickZoom",k);const z=new H;this._add("tapDragZoom",z);const G=g.touchPitch=new pd(g);this._add("touchPitch",G);const X=new Gs(l),Z=new Bu(l);g.dragRotate=new Ge(l,X,Z),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",Z,["mouseRotate"]);const se=new na(l),Ie=new xr(g,l);g.dragPan=new pe(C,se,Ie),this._add("mousePan",se),this._add("touchPan",Ie,["touchZoom","touchRotate"]);const ze=new Ua,$e=new Su;g.touchZoomRotate=new wt(C,$e,ze,z),this._add("touchRotate",ze,["touchPan","touchZoom"]),this._add("touchZoom",$e,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Vh(g));const je=g.scrollZoom=new x(g,this);this._add("scrollZoom",je,["mousePan"]);const We=g.keyboard=new a;this._add("keyboard",We);for(const ue of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[ue]&&g[ue].enable(l[ue])}_add(l,g,C){this._handlers.push({handlerName:l,handler:g,allowed:C}),this._handlersById[l]=g}stop(l){if(!this._updatingCamera){for(const{handler:g}of this._handlers)g.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!qt(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,g,C){for(const M in l)if(M!==C&&(!g||g.indexOf(M)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const g=[];for(const C of l)this._el.contains(C.target)&&g.push(C);return g}handleEvent(l,g){this._updatingCamera=!0;const C="renderFrame"===l.type,M=C?void 0:l,P={needsRenderFrame:!1},k={},z={},G=l.touches?this._getMapTouches(l.touches):void 0,X=G?ee(this._el,G):C?void 0:ce(this._el,l);for(const{handlerName:Ie,handler:ze,allowed:$e}of this._handlers){if(!ze.isEnabled())continue;let je;this._blockedByActive(z,$e,Ie)?ze.reset():ze[g||l.type]&&(je=ze[g||l.type](l,X,G),this.mergeHandlerResult(P,k,je,Ie,M),je&&je.needsRenderFrame&&this._triggerRenderFrame()),(je||ze.isActive())&&(z[Ie]=ze)}const Z={};for(const Ie in this._previousActiveHandlers)z[Ie]||(Z[Ie]=M);this._previousActiveHandlers=z,(Object.keys(Z).length||kn(P))&&(this._changes.push([P,k,Z]),this._triggerRenderFrame()),(Object.keys(z).length||kn(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:se}=P;se&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],se(this._map))}mergeHandlerResult(l,g,C,M,P){if(!C)return;p.extend(l,C);const k={handlerName:M,originalEvent:C.originalEvent||P};void 0!==C.zoomDelta&&(g.zoom=k),void 0!==C.panDelta&&(g.drag=k),void 0!==C.pitchDelta&&(g.pitch=k),void 0!==C.bearingDelta&&(g.rotate=k)}_applyChanges(){const l={},g={},C={};for(const[M,P,k]of this._changes)M.panDelta&&(l.panDelta=(l.panDelta||new p.Point(0,0))._add(M.panDelta)),M.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+M.zoomDelta),M.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+M.bearingDelta),M.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+M.pitchDelta),void 0!==M.around&&(l.around=M.around),void 0!==M.aroundCoord&&(l.aroundCoord=M.aroundCoord),void 0!==M.pinchAround&&(l.pinchAround=M.pinchAround),M.noInertia&&(l.noInertia=M.noInertia),p.extend(g,P),p.extend(C,k);this._updateMapTransform(l,g,C),this._changes=[]}_updateMapTransform(l,g,C){const M=this._map,P=M.transform,k=Fe=>[Fe.x,Fe.y,Fe.z];if((Fe=>{const nt=this._eventsInProgress.drag;return nt&&!this._handlersById[nt.handlerName].isActive()})()&&!kn(l)){const Fe=P.zoom;P.cameraElevationReference="sea",P.recenterOnTerrain(),P.cameraElevationReference="ground",Fe!==P.zoom&&this._map._update(!0)}if(P._isCameraConstrained&&M._stop(!0),!kn(l))return void this._fireEvents(g,C,!0);let{panDelta:z,zoomDelta:G,bearingDelta:X,pitchDelta:Z,around:se,aroundCoord:Ie,pinchAround:ze}=l;P._isCameraConstrained&&(G>0&&(G=0),P._isCameraConstrained=!1),void 0!==ze&&(se=ze),(G||(Fe=>g.drag&&!this._eventsInProgress.drag)())&&se&&(this._dragOrigin=k(P.pointCoordinate3D(se)),this._trackingEllipsoid.setup(P._camera.position,this._dragOrigin)),P.cameraElevationReference="sea",M._stop(!0),se=se||M.transform.centerPoint,X&&(P.bearing+=X),Z&&(P.pitch+=Z),P._updateCameraState();const $e=[0,0,0];if(z)if("mercator"===P.projection.name){const Fe=this._trackingEllipsoid.projectRay(P.screenPointToMercatorRay(se).dir),nt=this._trackingEllipsoid.projectRay(P.screenPointToMercatorRay(se.sub(z)).dir);$e[0]=nt[0]-Fe[0],$e[1]=nt[1]-Fe[1]}else{const Fe=P.pointCoordinate(se);if("globe"===P.projection.name){z=z.rotate(-P.angle);const nt=P._pixelsPerMercatorPixel/P.worldSize;$e[0]=-z.x*p.mercatorScale(p.latFromMercatorY(Fe.y))*nt,$e[1]=-z.y*p.mercatorScale(P.center.lat)*nt}else{const nt=P.pointCoordinate(se.sub(z));Fe&&nt&&($e[0]=nt.x-Fe.x,$e[1]=nt.y-Fe.y)}}const je=P.zoom,We=[0,0,0];if(G){const Fe=k(Ie||P.pointCoordinate3D(se)),nt={dir:p.normalize([],p.sub([],Fe,P._camera.position))};if(nt.dir[2]<0){const Qe=P.zoomDeltaToMovement(Fe,G);p.scale$2(We,nt.dir,Qe)}}const ue=p.add($e,$e,We);P._translateCameraConstrained(ue),G&&Math.abs(P.zoom-je)>1e-4&&P.recenterOnTerrain(),P.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(g,C,!0)}_fireEvents(l,g,C){const M=qt(this._eventsInProgress),P=qt(l),k={};for(const Z in l){const{originalEvent:se}=l[Z];this._eventsInProgress[Z]||(k[`${Z}start`]=se),this._eventsInProgress[Z]=l[Z]}!M&&P&&this._fireEvent("movestart",P.originalEvent);for(const Z in k)this._fireEvent(Z,k[Z]);P&&this._fireEvent("move",P.originalEvent);for(const Z in l){const{originalEvent:se}=l[Z];this._fireEvent(Z,se)}const z={};let G;for(const Z in this._eventsInProgress){const{handlerName:se,originalEvent:Ie}=this._eventsInProgress[Z];this._handlersById[se].isActive()||(delete this._eventsInProgress[Z],G=g[se]||Ie,z[`${Z}end`]=G)}for(const Z in z)this._fireEvent(Z,z[Z]);const X=qt(this._eventsInProgress);if(C&&(M||P)&&!X){this._updatingCamera=!0;const Z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),se=Ie=>0!==Ie&&-this._bearingSnap<Ie&&Ie<this._bearingSnap;Z?(se(Z.bearing||this._map.getBearing())&&(Z.bearing=0),this._map.easeTo(Z,{originalEvent:G})):(this._map.fire(new p.Event("moveend",{originalEvent:G})),se(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,g){this._map.fire(new p.Event(l,g?{originalEvent:g}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new nn("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const lr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ji extends p.Evented{constructor(l,g){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=g.bearingSnap,this._respectPrefersReducedMotion=!1!==g.respectPrefersReducedMotion,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(l,g){return this.jumpTo({center:l},g)}panBy(l,g,C){return l=p.Point.convert(l).mult(-1),this.panTo(this.transform.center,p.extend({offset:l},g),C)}panTo(l,g,C){return this.easeTo(p.extend({center:l},g),C)}getZoom(){return this.transform.zoom}setZoom(l,g){return this.jumpTo({zoom:l},g),this}zoomTo(l,g,C){return this.easeTo(p.extend({zoom:l},g),C)}zoomIn(l,g){return this.zoomTo(this.getZoom()+1,l,g),this}zoomOut(l,g){return this.zoomTo(this.getZoom()-1,l,g),this}getBearing(){return this.transform.bearing}setBearing(l,g){return this.jumpTo({bearing:l},g),this}getPadding(){return this.transform.padding}setPadding(l,g){return this.jumpTo({padding:l},g),this}rotateTo(l,g,C){return this.easeTo(p.extend({bearing:l},g),C)}resetNorth(l,g){return this.rotateTo(0,p.extend({duration:1e3},l),g),this}resetNorthPitch(l,g){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},l),g),this}snapToNorth(l,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,g):this}getPitch(){return this.transform.pitch}setPitch(l,g){return this.jumpTo({pitch:l},g),this}cameraForBounds(l,g){l=p.LngLatBounds.convert(l);const C=g&&g.bearing||0,M=g&&g.pitch||0,P=l.getNorthWest(),k=l.getSouthEast();return this._cameraForBounds(this.transform,P,k,C,M,g)}_extendCameraOptions(l){const g={top:0,bottom:0,right:0,left:0};if("number"==typeof(l=p.extend({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding){const C=l.padding;l.padding={top:C,bottom:C,right:C,left:C}}return l.padding=p.extend(g,l.padding),l}_minimumAABBFrustumDistance(l,g){const C=g.max[0]-g.min[0],M=g.max[1]-g.min[1];return C/M>l.aspect?C/(2*Math.tan(.5*l.fovX)*l.aspect):M/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,g,C,M,P,k){const z=l.clone(),G=this._extendCameraOptions(k);z.bearing=M,z.pitch=P;const X=p.LngLat.convert(g),Z=p.LngLat.convert(C),se=.5*(X.lat+Z.lat),Ie=.5*(X.lng+Z.lng),ze=p.latLngToECEF(se,Ie),$e=p.normalize([],ze),je=p.normalize([],p.cross([],$e,[0,1,0])),We=p.cross([],je,$e),ue=[je[0],je[1],je[2],0,We[0],We[1],We[2],0,$e[0],$e[1],$e[2],0,0,0,0,1],Fe=[ze,p.latLngToECEF(X.lat,X.lng),p.latLngToECEF(Z.lat,X.lng),p.latLngToECEF(Z.lat,Z.lng),p.latLngToECEF(X.lat,Z.lng),p.latLngToECEF(se,X.lng),p.latLngToECEF(se,Z.lng),p.latLngToECEF(X.lat,Ie),p.latLngToECEF(Z.lat,Ie)];let nt=p.Aabb.fromPoints(Fe.map(vn=>[p.dot(je,vn),p.dot(We,vn),p.dot($e,vn)]));const Qe=p.transformMat4([],nt.center,ue);0===p.squaredLength(Qe)&&p.set(Qe,0,0,1),p.normalize(Qe,Qe),p.scale$2(Qe,Qe,p.GLOBE_RADIUS),z.center=p.ecefToLatLng(Qe);const Et=z.getWorldToCameraMatrix(),St=p.invert(new Float64Array(16),Et);nt=p.Aabb.applyTransform(nt,p.multiply([],Et,ue)),p.transformMat4(Qe,Qe,Et);const at=.5*(nt.max[2]-nt.min[2]),Ot=this._minimumAABBFrustumDistance(z,nt),Rt=p.scale$2([],[0,0,1],at),kt=p.add(Rt,Qe,Rt),Dn=Ot+(0===z.pitch?0:p.distance(Qe,kt)),Ut=z.globeCenterInViewSpace,an=p.sub([],Qe,[Ut[0],Ut[1],Ut[2]]);p.normalize(an,an),p.scale$2(an,an,Dn);const Ht=p.add([],Qe,an);p.transformMat4(Ht,Ht,St);const gn=p.earthRadius/p.GLOBE_RADIUS,Gt=p.length(Ht),fn=p.mercatorZfromAltitude(Math.max(Gt*gn-p.earthRadius,Number.EPSILON),0),En=Math.min(z.zoomFromMercatorZAdjusted(fn),G.maxZoom);return En>.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(z.setProjection({name:"mercator"}),z.zoom=En,this._cameraForBounds(z,g,C,M,P,k)):{center:z.center,zoom:En,bearing:M,pitch:P}}queryTerrainElevation(l,g){const C=this.transform.elevation;return C?(g=p.extend({},{exaggerated:!0},g),C.getAtPoint(p.MercatorCoordinate.fromLngLat(l),null,g.exaggerated)):null}_cameraForBounds(l,g,C,M,P,k){if("globe"===l.projection.name)return this._cameraForBoundsOnGlobe(l,g,C,M,P,k);const z=l.clone(),G=this._extendCameraOptions(k),X=z.padding;z.bearing=M,z.pitch=P;const Z=p.LngLat.convert(g),se=p.LngLat.convert(C),Ie=new p.LngLat(Z.lng,se.lat),ze=new p.LngLat(se.lng,Z.lat),$e=z.project(Z),je=z.project(se),We=this.queryTerrainElevation(Z),ue=this.queryTerrainElevation(se),Fe=this.queryTerrainElevation(Ie),nt=this.queryTerrainElevation(ze),Qe=[[$e.x,$e.y,Math.min(We||0,ue||0,Fe||0,nt||0)],[je.x,je.y,Math.max(We||0,ue||0,Fe||0,nt||0)]];let Et=p.Aabb.fromPoints(Qe);const St=z.getWorldToCameraMatrix(),at=p.invert(new Float64Array(16),St);Et=p.Aabb.applyTransform(Et,St);const Ot=p.sub([],Et.max,Et.min),Rt=X.left||0,kt=X.right||0,Dn=X.bottom||0,Ut=X.top||0,{left:an,right:Ht,top:gn,bottom:Gt}=G.padding,fn=.5*(Rt+kt),En=.5*(Ut+Dn),vn=Math.min(z.scaleZoom(z.scale*Math.min((z.width-(Rt+kt+an+Ht))/Ot[0],(z.height-(Dn+Ut+Gt+gn))/Ot[1])),G.maxZoom),Ln=z.scale/z.zoomScale(vn);Et=new p.Aabb([Et.min[0]-(an+fn)*Ln,Et.min[1]-(Gt+En)*Ln,Et.min[2]],[Et.max[0]+(Ht+fn)*Ln,Et.max[1]+(gn+En)*Ln,Et.max[2]]);const wr=.5*Ot[2],Vr=this._minimumAABBFrustumDistance(z,Et),or=[0,0,1,0];p.transformMat4$1(or,or,St),p.normalize$2(or,or);const Ar=p.scale$2([],or,Vr+wr),Xn=p.add([],Et.center,Ar),ci=("number"==typeof G.offset.x&&"number"==typeof G.offset.y?new p.Point(G.offset.x,G.offset.y):p.Point.convert(G.offset)).rotate(-p.degToRad(M));Et.center[0]-=ci.x*Ln,Et.center[1]+=ci.y*Ln,p.transformMat4(Et.center,Et.center,at),p.transformMat4(Xn,Xn,at);const yr=[Et.center[0],Et.center[1],Xn[2]*z.pixelsPerMeter];p.scale$2(yr,yr,1/z.worldSize);const bo=p.lngFromMercatorX(yr[0]),Ko=p.latFromMercatorY(yr[1]),us=Math.min(z._zoomFromMercatorZ(yr[2]),G.maxZoom),ls=new p.LngLat(bo,Ko);return z.mercatorFromTransition&&us<.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(z.setProjection({name:"globe"}),z.zoom=us,this._cameraForBounds(z,g,C,M,P,k)):{center:ls,zoom:us,bearing:M,pitch:P}}fitBounds(l,g,C){const M=this.cameraForBounds(l,g);return this._fitInternal(M,g,C)}fitScreenCoordinates(l,g,C,M,P){const k=p.Point.convert(l),z=p.Point.convert(g),G=new p.Point(Math.min(k.x,z.x),Math.min(k.y,z.y)),X=new p.Point(Math.max(k.x,z.x),Math.max(k.y,z.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(k,z))return this;const Z=this.transform.pointLocation3D(G),se=this.transform.pointLocation3D(X),Ie=this.transform.pointLocation3D(new p.Point(G.x,X.y)),ze=this.transform.pointLocation3D(new p.Point(X.x,G.y)),$e=[Math.min(Z.lng,se.lng,Ie.lng,ze.lng),Math.min(Z.lat,se.lat,Ie.lat,ze.lat)],je=[Math.max(Z.lng,se.lng,Ie.lng,ze.lng),Math.max(Z.lat,se.lat,Ie.lat,ze.lat)],We=M&&M.pitch?M.pitch:this.getPitch(),ue=this._cameraForBounds(this.transform,$e,je,C,We,M);return this._fitInternal(ue,M,P)}_fitInternal(l,g,C){return l?(delete(g=p.extend(l,g)).padding,g.linear?this.easeTo(g,C):this.flyTo(g,C)):this}jumpTo(l,g){this.stop();const C=l.preloadOnly?this.transform.clone():this.transform;let M=!1,P=!1,k=!1;return"zoom"in l&&C.zoom!==+l.zoom&&(M=!0,C.zoom=+l.zoom),void 0!==l.center&&(C.center=p.LngLat.convert(l.center)),"bearing"in l&&C.bearing!==+l.bearing&&(P=!0,C.bearing=+l.bearing),"pitch"in l&&C.pitch!==+l.pitch&&(k=!0,C.pitch=+l.pitch),null==l.padding||C.isPaddingEqual(l.padding)||(C.padding=l.padding),l.preloadOnly?(this._preloadTiles(C),this):(this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),M&&this.fire(new p.Event("zoomstart",g)).fire(new p.Event("zoom",g)).fire(new p.Event("zoomend",g)),P&&this.fire(new p.Event("rotatestart",g)).fire(new p.Event("rotate",g)).fire(new p.Event("rotateend",g)),k&&this.fire(new p.Event("pitchstart",g)).fire(new p.Event("pitch",g)).fire(new p.Event("pitchend",g)),this.fire(new p.Event("moveend",g)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(lr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,g){const C=this.transform;if(!C.projection.supportsFreeCamera)return p.warnOnce(lr),this;this.stop();const M=C.zoom,P=C.pitch,k=C.bearing;C.setFreeCameraOptions(l);const z=M!==C.zoom,G=P!==C.pitch,X=k!==C.bearing;return this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),z&&this.fire(new p.Event("zoomstart",g)).fire(new p.Event("zoom",g)).fire(new p.Event("zoomend",g)),X&&this.fire(new p.Event("rotatestart",g)).fire(new p.Event("rotate",g)).fire(new p.Event("rotateend",g)),G&&this.fire(new p.Event("pitchstart",g)).fire(new p.Event("pitch",g)).fire(new p.Event("pitchend",g)),this.fire(new p.Event("moveend",g)),this}easeTo(l,g){this._stop(!1,l.easeId),(!1===(l=p.extend({offset:[0,0],duration:500,easing:p.ease},l)).animate||this._prefersReducedMotion(l))&&(l.duration=0);const C=this.transform,M=this.getZoom(),P=this.getBearing(),k=this.getPitch(),z=this.getPadding(),G="zoom"in l?+l.zoom:M,X="bearing"in l?this._normalizeBearing(l.bearing,P):P,Z="pitch"in l?+l.pitch:k,se="padding"in l?l.padding:C.padding,Ie=p.Point.convert(l.offset);let ze,$e,je;if("globe"===C.projection.name){const Rt=p.MercatorCoordinate.fromLngLat(C.center),kt=Ie.rotate(-C.angle);Rt.x+=kt.x/C.worldSize,Rt.y+=kt.y/C.worldSize;const Dn=Rt.toLngLat(),Ut=p.LngLat.convert(l.center||Dn);this._normalizeCenter(Ut),ze=C.centerPoint.add(kt),$e=new p.Point(Rt.x,Rt.y).mult(C.worldSize),je=new p.Point(p.mercatorXfromLng(Ut.lng),p.mercatorYfromLat(Ut.lat)).mult(C.worldSize).sub($e)}else{ze=C.centerPoint.add(Ie);const Rt=C.pointLocation(ze),kt=p.LngLat.convert(l.center||Rt);this._normalizeCenter(kt),$e=C.project(Rt),je=C.project(kt).sub($e)}const We=C.zoomScale(G-M);let ue,Fe;l.around&&(ue=p.LngLat.convert(l.around),Fe=C.locationPoint(ue));const nt=this._zooming||G!==M,Qe=this._rotating||P!==X,Et=this._pitching||Z!==k,St=!C.isPaddingEqual(se),at=Rt=>kt=>{if(nt&&(Rt.zoom=p.number(M,G,kt)),Qe&&(Rt.bearing=p.number(P,X,kt)),Et&&(Rt.pitch=p.number(k,Z,kt)),St&&(Rt.interpolatePadding(z,se,kt),ze=Rt.centerPoint.add(Ie)),ue)Rt.setLocationAtPoint(ue,Fe);else{const Dn=Rt.zoomScale(Rt.zoom-M),Ut=G>M?Math.min(2,We):Math.max(.5,We),an=Math.pow(Ut,1-kt),Ht=Rt.unproject($e.add(je.mult(kt*an)).mult(Dn));Rt.setLocationAtPoint(Rt.renderWorldCopies?Ht.wrap():Ht,ze)}return l.preloadOnly||this._fireMoveEvents(g),Rt};if(l.preloadOnly){const Rt=this._emulate(at,l.duration,C);return this._preloadTiles(Rt),this}const Ot={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=nt,this._rotating=Qe,this._pitching=Et,this._padding=St,this._easeId=l.easeId,this._prepareEase(g,l.noMoveStart,Ot),this._ease(at(C),Rt=>{C.recenterOnTerrain(),this._afterEase(g,Rt)},l),this}_prepareEase(l,g,C={}){this._moving=!0,this.transform.cameraElevationReference="sea",g||C.moving||this.fire(new p.Event("movestart",l)),this._zooming&&!C.zooming&&this.fire(new p.Event("zoomstart",l)),this._rotating&&!C.rotating&&this.fire(new p.Event("rotatestart",l)),this._pitching&&!C.pitching&&this.fire(new p.Event("pitchstart",l))}_fireMoveEvents(l){this.fire(new p.Event("move",l)),this._zooming&&this.fire(new p.Event("zoom",l)),this._rotating&&this.fire(new p.Event("rotate",l)),this._pitching&&this.fire(new p.Event("pitch",l))}_afterEase(l,g){if(this._easeId&&g&&this._easeId===g)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const C=this._zooming,M=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,C&&this.fire(new p.Event("zoomend",l)),M&&this.fire(new p.Event("rotateend",l)),P&&this.fire(new p.Event("pitchend",l)),this.fire(new p.Event("moveend",l))}flyTo(l,g){if(this._prefersReducedMotion(l)){const vn=p.pick(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(vn,g)}this.stop(),l=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},l);const C=this.transform,M=this.getZoom(),P=this.getBearing(),k=this.getPitch(),z=this.getPadding(),G="zoom"in l?p.clamp(+l.zoom,C.minZoom,C.maxZoom):M,X="bearing"in l?this._normalizeBearing(l.bearing,P):P,Z="pitch"in l?+l.pitch:k,se="padding"in l?l.padding:C.padding,Ie=C.zoomScale(G-M),ze=p.Point.convert(l.offset);let $e=C.centerPoint.add(ze);const je=C.pointLocation($e),We=p.LngLat.convert(l.center||je);this._normalizeCenter(We);const ue=C.project(je),Fe=C.project(We).sub(ue);let nt=l.curve;const Qe=Math.max(C.width,C.height),Et=Qe/Ie,St=Fe.mag();if("minZoom"in l){const vn=p.clamp(Math.min(l.minZoom,M,G),C.minZoom,C.maxZoom),Ln=Qe/C.zoomScale(vn-M);nt=Math.sqrt(Ln/St*2)}const at=nt*nt;function Ot(vn){const Ln=(Et*Et-Qe*Qe+(vn?-1:1)*at*at*St*St)/(2*(vn?Et:Qe)*at*St);return Math.log(Math.sqrt(Ln*Ln+1)-Ln)}function Rt(vn){return(Math.exp(vn)-Math.exp(-vn))/2}function kt(vn){return(Math.exp(vn)+Math.exp(-vn))/2}const Dn=Ot(0);let Ut=function(vn){return kt(Dn)/kt(Dn+nt*vn)},an=function(vn){return Qe*((kt(Dn)*(Rt(Ln=Dn+nt*vn)/kt(Ln))-Rt(Dn))/at)/St;var Ln},Ht=(Ot(1)-Dn)/nt;if(Math.abs(St)<1e-6||!isFinite(Ht)){if(Math.abs(Qe-Et)<1e-6)return this.easeTo(l,g);const vn=Et<Qe?-1:1;Ht=Math.abs(Math.log(Et/Qe))/nt,an=function(){return 0},Ut=function(Ln){return Math.exp(vn*nt*Ln)}}l.duration="duration"in l?+l.duration:1e3*Ht/("screenSpeed"in l?+l.screenSpeed/nt:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const gn=P!==X,Gt=Z!==k,fn=!C.isPaddingEqual(se),En=vn=>Ln=>{const wr=Ln*Ht,Vr=1/Ut(wr);vn.zoom=1===Ln?G:M+vn.scaleZoom(Vr),gn&&(vn.bearing=p.number(P,X,Ln)),Gt&&(vn.pitch=p.number(k,Z,Ln)),fn&&(vn.interpolatePadding(z,se,Ln),$e=vn.centerPoint.add(ze));const or=1===Ln?We:vn.unproject(ue.add(Fe.mult(an(wr))).mult(Vr));return vn.setLocationAtPoint(vn.renderWorldCopies?or.wrap():or,$e),vn._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(g),vn};if(l.preloadOnly){const vn=this._emulate(En,l.duration,C);return this._preloadTiles(vn),this}return this._zooming=!0,this._rotating=gn,this._pitching=Gt,this._padding=fn,this._prepareEase(g,!1),this._ease(En(C),()=>this._afterEase(g),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const C=this._onEaseEnd;this._onEaseEnd=void 0,C.call(this,g)}if(!l){const C=this.handlers;C&&C.stop(!1)}return this}_ease(l,g,C){!1===C.animate||0===C.duration?(l(1),g()):(this._easeStart=p.exported.now(),this._easeOptions=C,this._onEaseFrame=l,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),g=this._onEaseFrame;g&&g(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,g){l=p.wrap(l,-180,180);const C=Math.abs(l-g);return Math.abs(l-360-g)<C&&(l-=360),Math.abs(l+360-g)<C&&(l+=360),l}_normalizeCenter(l){const g=this.transform;if(!g.renderWorldCopies||g.maxBounds)return;const C=l.lng-g.center.lng;l.lng+=C>180?-360:C<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&p.exported.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,g,C){const M=Math.ceil(15*g/1e3),P=[],k=l(C.clone());for(let z=0;z<=M;z++){const G=k(z/M);P.push(G.clone())}return P}}class Gn{constructor(l={}){this.options=l,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const g=this.options&&this.options.compact;return this._map=l,this._container=qe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=qe("button","mapboxgl-ctrl-attrib-button",this._container),qe("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=qe("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),g&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===g&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(l,g){const C=this._map._getUIString(`AttributionControl.${g}`);l.setAttribute("aria-label",C),l.removeAttribute("title"),l.firstElementChild&&l.firstElementChild.setAttribute("title",C)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const g=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(l){const C=g.reduce((M,P,k)=>(P.value&&(M+=`${P.key}=${P.value}${k<g.length-1?"&":""}`),M),"?");l.href=`${p.config.FEEDBACK_URL}/${C}#${za(this._map,!0)}`,l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}}_updateData(l){!l||"metadata"!==l.sourceDataType&&"visibility"!==l.sourceDataType&&"style"!==l.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const M=this._map.style.stylesheet;this.styleOwner=M.owner,this.styleId=M.id}const g=this._map.style._sourceCaches;for(const M in g){const P=g[M];if(P.used){const k=P.getSource();k.attribution&&l.indexOf(k.attribution)<0&&l.push(k.attribution)}}l.sort((M,P)=>M.length-P.length),l=l.filter((M,P)=>{for(let k=P+1;k<l.length;k++)if(l[k].indexOf(M)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const C=l.join(" | ");C!==this._attribHTML&&(this._attribHTML=C,l.length?(this._innerContainer.innerHTML=C,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ga{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=qe("div","mapboxgl-ctrl");const g=qe("a","mapboxgl-ctrl-logo");return g.target="_blank",g.rel="noopener nofollow",g.href="https://www.mapbox.com/",g.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),g.setAttribute("rel","noopener nofollow"),this._container.appendChild(g),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&"metadata"!==l.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(0===Object.entries(l).length)return!0;for(const g in l){const C=l[g].getSource();if(C.hasOwnProperty("mapbox_logo")&&!C.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const g=l[0];this._map.getCanvasContainer().offsetWidth<250?g.classList.add("mapboxgl-compact"):g.classList.remove("mapboxgl-compact")}}}class ma{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const g=++this._id;return this._queue.push({callback:l,id:g,cancelled:!1}),g}remove(l){const g=this._currentlyRunning,C=g?this._queue.concat(g):this._queue;for(const M of C)if(M.id===l)return void(M.cancelled=!0)}run(l=0){const g=this._currentlyRunning=this._queue;this._queue=[];for(const C of g)if(!C.cancelled&&(C.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function il(w,l,g){if(w=new p.LngLat(w.lng,w.lat),l){const C=new p.LngLat(w.lng-360,w.lat),M=new p.LngLat(w.lng+360,w.lat),P=360*Math.ceil(Math.abs(w.lng-g.center.lng)/360),k=g.locationPoint(w).distSqr(l),z=l.x<0||l.y<0||l.x>g.width||l.y>g.height;g.locationPoint(C).distSqr(l)<k&&(z||Math.abs(C.lng-g.center.lng)<P)?w=C:g.locationPoint(M).distSqr(l)<k&&(z||Math.abs(M.lng-g.center.lng)<P)&&(w=M)}for(;Math.abs(w.lng-g.center.lng)>180;){const C=g.locationPoint(w);if(C.x>=0&&C.y>=0&&C.x<=g.width&&C.y<=g.height)break;w.lng>g.center.lng?w.lng-=360:w.lng+=360}return w}const zc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Kn extends p.Evented{constructor(l,g){if(super(),(l instanceof p.window.HTMLElement||g)&&(l=p.extend({element:l},g)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=p.Point.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=qe("div");const M=41,P=27,k=It("svg",{display:"block",height:M*this._scale+"px",width:P*this._scale+"px",viewBox:`0 0 ${P} ${M}`},this._element),z=It("radialGradient",{id:"shadowGradient"},It("defs",{},k));It("stop",{offset:"10%","stop-opacity":.4},z),It("stop",{offset:"100%","stop-opacity":.05},z),It("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},k),It("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},k),It("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},k),It("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},k),this._offset=p.Point.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",M=>{M.preventDefault()}),this._element.addEventListener("mousedown",M=>{M.preventDefault()});const C=this._element.classList;for(const M in zc)C.remove(`mapboxgl-marker-anchor-${M}`);C.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=p.LngLat.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const M=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[M,-1*(24.6+M)],"bottom-right":[-M,-1*(24.6+M)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const g=l.code,C=l.charCode||l.keyCode;"Space"!==g&&"Enter"!==g&&32!==C&&13!==C||this.togglePopup()}_onMapClick(l){const g=l.originalEvent.target,C=this._element;this._popup&&(g===C||C.contains(g))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,g=this._pos;if(!l||!g)return!1;const C=l.unproject(g),M=l.getFreeCameraOptions();if(!M.position)return!1;const P=M.position.toLngLat();return P.distanceTo(C)<.9*P.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const g=this._pos;if(!g||g.x<0||g.x>l.transform.width||g.y<0||g.y>l.transform.height)return void this._clearFadeTimer();const C=l.unproject(g);let M;l._showingGlobe()&&p.isLngLatBehindGlobe(l.transform,this._lngLat)?M=0:(M=1-l._queryFogOpacity(C),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(M*=this._occludedOpacity)),this._element.style.opacity=`${M}`,this._element.style.pointerEvents=M>0?"auto":"none",this._popup&&this._popup._setOpacity(M),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const g=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${l.x}px,${l.y}px)\n            ${zc[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${g.x}px,${g.y}px)\n        `}_calculateXYTransform(){const l=this._pos,g=this._map,C=this.getPitchAlignment();if(!g||!l||"map"!==C)return"";if(!g._showingGlobe()){const G=g.getPitch();return G?`rotateX(${G}deg)`:""}const M=p.radToDeg(p.globeTiltAtLngLat(g.transform,this._lngLat)),P=l.sub(p.globeCenterToScreenPoint(g.transform)),k=Math.abs(P.x)+Math.abs(P.y);if(0===k)return"";const z=M/k;return`rotateX(${-P.y*z}deg) rotateY(${P.x*z}deg)`}_calculateZTransform(){const l=this._pos,g=this._map;if(!g||!l)return"";let C=0;const M=this.getRotationAlignment();if("map"===M)if(g._showingGlobe()){const P=g.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),k=g.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(P);C=p.radToDeg(Math.atan2(k.y,k.x))-90}else C=-g.getBearing();else if("horizon"===M){const P=p.smoothstep(4,6,g.getZoom()),k=p.globeCenterToScreenPoint(g.transform);k.y+=P*g.transform.height;const z=l.sub(k),G=p.radToDeg(Math.atan2(z.y,z.x));C=(G>90?G-270:G+90)*(1-P)}return C+=this._rotation,C?`rotateZ(${C}deg)`:""}_update(l){p.window.cancelAnimationFrame(this._updateFrameId);const g=this._map;g&&(g.transform.renderWorldCopies&&(this._lngLat=il(this._lngLat,this._pos,g.transform)),this._pos=g.project(this._lngLat),!0===l?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),g._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(g._showingGlobe()||g.getTerrain()||g.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=p.Point.convert(l),this._update(),this}_onMove(l){const g=this._map;if(!g)return;const C=this._pointerdownPos,M=this._positionDelta;if(C&&M){if(!this._isDragging){const P=this._clickTolerance||g._clickTolerance;if(l.point.dist(C)<P)return;this._isDragging=!0}this._pos=l.point.sub(M),this._lngLat=g.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(l){const g=this._map,C=this._pos;g&&C&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(C),this._pointerdownPos=l.point,this._state="pending",g.on("mousemove",this._onMove),g.on("touchmove",this._onMove),g.once("mouseup",this._onUp),g.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const g=this._map;return g&&(l?(g.on("mousedown",this._addDragHandler),g.on("touchstart",this._addDragHandler)):(g.off("mousedown",this._addDragHandler),g.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Bg={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Jm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function zu(w=new p.Point(0,0),l="bottom"){if("number"==typeof w){const g=Math.round(Math.sqrt(.5*Math.pow(w,2)));switch(l){case"top":return new p.Point(0,w);case"top-left":return new p.Point(g,g);case"top-right":return new p.Point(-g,g);case"bottom":return new p.Point(0,-w);case"bottom-left":return new p.Point(g,-g);case"bottom-right":return new p.Point(-g,-g);case"left":return new p.Point(w,0);case"right":return new p.Point(-w,0)}return new p.Point(0,0)}return w instanceof p.Point||Array.isArray(w)?p.Point.convert(w):p.Point.convert(w[l]||[0,0])}class kf{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const g=p.easeCubicInOut((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-g)+this._end*g}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,g,C){this._start=this.getValue(g),this._end=l,this._startTime=g,this._endTime=g+C}}const hu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Wl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},__={showCompass:!0,showZoom:!0,visualizePitch:!1};class $p{constructor(l,g,C=!1){this._clickTolerance=10,this.element=g,this.mouseRotate=new Gs({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,C&&(this.mousePitch=new Bu({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),g.addEventListener("mousedown",this.mousedown),g.addEventListener("touchstart",this.touchstart,{passive:!1}),g.addEventListener("touchmove",this.touchmove),g.addEventListener("touchend",this.touchend),g.addEventListener("touchcancel",this.reset)}down(l,g){this.mouseRotate.mousedown(l,g),this.mousePitch&&this.mousePitch.mousedown(l,g),Mt()}move(l,g){const C=this.map,M=this.mouseRotate.mousemoveWindow(l,g),P=M&&M.bearingDelta;if(P&&C.setBearing(C.getBearing()+P),this.mousePitch){const k=this.mousePitch.mousemoveWindow(l,g),z=k&&k.pitchDelta;z&&C.setPitch(C.getPitch()+z)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){le(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(p.extend({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),ce(this.element,l)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,ce(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){1!==l.targetTouches.length?this.reset():(this._startPos=this._lastPos=ee(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){1!==l.targetTouches.length?this.reset():(this._lastPos=ee(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){0===l.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const gd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ff={maxWidth:100,unit:"metric"},qp={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Bf={version:p.version,supported:ye,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends ji{constructor(w){if(p.LivePerformanceUtils.mark(p.PerformanceMarkers.create),null!=(w=p.extend({},Wl,w)).minZoom&&null!=w.maxZoom&&w.minZoom>w.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=w.minPitch&&null!=w.maxPitch&&w.minPitch>w.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=w.minPitch&&w.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=w.maxPitch&&w.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(w.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(w.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new pr(w.minZoom,w.maxZoom,w.minPitch,w.maxPitch,w.renderWorldCopies),w),this._interactive=w.interactive,this._minTileCacheSize=w.minTileCacheSize,this._maxTileCacheSize=w.maxTileCacheSize,this._failIfMajorPerformanceCaveat=w.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=w.preserveDrawingBuffer,this._antialias=w.antialias,this._useWebGL2=w.useWebGL2,this._trackResize=w.trackResize,this._bearingSnap=w.bearingSnap,this._refreshExpiredTiles=w.refreshExpiredTiles,this._fadeDuration=w.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=w.crossSourceCollisions,this._collectResourceTiming=w.collectResourceTiming,this._optimizeForTerrain=w.optimizeForTerrain,this._language=this._parseLanguage(w.language),this._worldview=w.worldview,this._renderTaskQueue=new ma,this._domRenderTaskQueue=new ma,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.uniqueId(),this._locale=p.extend({},hu,w.locale),this._clickTolerance=w.clickTolerance,this._cooperativeGestures=w.cooperativeGestures,this._performanceMetricsCollection=w.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new kf(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new p.RequestManager(w.transformRequest,w.accessToken,w.testMode),this._silenceAuthErrors=!!w.testMode,"string"==typeof w.container){if(this._container=p.window.document.getElementById(w.container),!this._container)throw new Error(`Container '${w.container}' not found.`)}else{if(!(w.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=w.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),w.maxBounds&&this.setMaxBounds(w.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new tr(this,w),this._localFontFamily=w.localFontFamily,this._localIdeographFontFamily=w.localIdeographFontFamily,w.style&&this.setStyle(w.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),w.projection&&this.setProjection(w.projection),this._hash=w.hash&&new Dl("string"==typeof w.hash&&w.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}),w.bounds&&(this.resize(),this.fitBounds(w.bounds,p.extend({},w.fitBoundsOptions,{duration:0})))),this.resize(),w.attributionControl&&this.addControl(new Gn({customAttribution:w.customAttribution})),this._logoControl=new ga,this.addControl(this._logoControl,w.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update("style"===l.dataType),this.fire(new p.Event(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new p.Event(`${l.dataType}dataloading`,l))})}_getMapId(){return this._mapId}addControl(w,l){if(void 0===l&&(l=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const g=w.onAdd(this);this._controls.push(w);const C=this._controlPositions[l];return-1!==l.indexOf("bottom")?C.insertBefore(g,C.firstChild):C.appendChild(g),this}removeControl(w){if(!w||!w.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(w);return l>-1&&this._controls.splice(l,1),w.onRemove(this),this}hasControl(w){return this._controls.indexOf(w)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(w){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new p.Event("movestart",w)).fire(new p.Event("move",w)),this.fire(new p.Event("resize",w)),l&&this.fire(new p.Event("moveend",w)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(w){return this.transform.setMaxBounds(p.LngLatBounds.convert(w)),this._update()}setMinZoom(w){if((w=w??-2)>=-2&&w<=this.transform.maxZoom)return this.transform.minZoom=w,this._update(),this.getZoom()<w?this.setZoom(w):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom)return this.transform.maxZoom=w,this._update(),this.getZoom()>w?this.setZoom(w):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch)return this.transform.minPitch=w,this._update(),this.getPitch()<w?this.setPitch(w):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if((w=w??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(w>=this.transform.minPitch)return this.transform.maxPitch=w,this._update(),this.getPitch()>w?this.setPitch(w):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.renderWorldCopies=w,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(w){return"auto"===w?p.window.navigator.language:Array.isArray(w)?0===w.length?void 0:w.map(l=>"auto"===l?p.window.navigator.language:l):w}setLanguage(w){const l=this._parseLanguage(w);if(!this.style||l===this._language)return this;this._language=l,this.style._reloadSources();for(const g of this._controls)g._setLanguage&&g._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(w){return this.style&&w!==this._worldview?(this._worldview=w,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(w){return this._lazyInitEmptyStyle(),w?"string"==typeof w&&(w={name:w}):w=null,this._useExplicitProjection=!!w,this._prioritizeAndUpdateProjection(w,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const w=this.transform,l=w.projection.name;let g;"globe"===l&&w.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?(w.setMercatorFromTransition(),g=!0):"mercator"===l&&w.zoom<p.GLOBE_ZOOM_THRESHOLD_MAX&&(w.setProjection({name:"globe"}),g=!0),g&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(w,l){return this._updateProjection(w||l||{name:"mercator"})}_updateProjection(w){let l;if(l="globe"===w.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(w),this.style.applyProjectionUpdate(),l){this.painter.clearBackgroundTiles();for(const g in this.style._sourceCaches)this.style._sourceCaches[g].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(w){return this.transform.locationPoint3D(p.LngLat.convert(w))}unproject(w){return this.transform.pointLocation3D(p.Point.convert(w))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(w,l,g){if("mouseenter"===w||"mouseover"===w){let C=!1;const M=k=>{const z=l.filter(X=>this.getLayer(X)),G=z.length?this.queryRenderedFeatures(k.point,{layers:z}):[];G.length?C||(C=!0,g.call(this,new wa(w,this,k.originalEvent,{features:G}))):C=!1},P=()=>{C=!1};return{layers:new Set(l),listener:g,delegates:{mousemove:M,mouseout:P}}}if("mouseleave"===w||"mouseout"===w){let C=!1;const M=k=>{const z=l.filter(G=>this.getLayer(G));(z.length?this.queryRenderedFeatures(k.point,{layers:z}):[]).length?C=!0:C&&(C=!1,g.call(this,new wa(w,this,k.originalEvent)))},P=k=>{C&&(C=!1,g.call(this,new wa(w,this,k.originalEvent)))};return{layers:new Set(l),listener:g,delegates:{mousemove:M,mouseout:P}}}{const C=M=>{const P=l.filter(z=>this.getLayer(z)),k=P.length?this.queryRenderedFeatures(M.point,{layers:P}):[];k.length&&(M.features=k,g.call(this,M),delete M.features)};return{layers:new Set(l),listener:g,delegates:{[w]:C}}}}on(w,l,g){if(void 0===g)return super.on(w,l);Array.isArray(l)||(l=[l]);const C=this._createDelegatedListener(w,l,g);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(C);for(const M in C.delegates)this.on(M,C.delegates[M]);return this}once(w,l,g){if(void 0===g)return super.once(w,l);Array.isArray(l)||(l=[l]);const C=this._createDelegatedListener(w,l,g);for(const M in C.delegates)this.once(M,C.delegates[M]);return this}off(w,l,g){if(void 0===g)return super.off(w,l);l=new Set(Array.isArray(l)?l:[l]);const C=(P,k)=>{if(P.size!==k.size)return!1;for(const z of P)if(!k.has(z))return!1;return!0},M=this._delegatedListeners?this._delegatedListeners[w]:void 0;return M&&(P=>{for(let k=0;k<P.length;k++){const z=P[k];if(z.listener===g&&C(z.layers,l)){for(const G in z.delegates)this.off(G,z.delegates[G]);return P.splice(k,1),this}}})(M),this}queryRenderedFeatures(w,l){return this.style?(void 0!==l||void 0===w||w instanceof p.Point||Array.isArray(w)||(l=w,w=void 0),this.style.queryRenderedFeatures(w=w||[[0,0],[this.transform.width,this.transform.height]],l=l||{},this.transform)):[]}querySourceFeatures(w,l){return this.style.querySourceFeatures(w,l)}isPointOnSurface(w){const{name:l}=this.transform.projection;return"globe"!==l&&"mercator"!==l&&p.warnOnce(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(p.Point.convert(w))}setStyle(w,l){return!1!==(l=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l)).diff&&l.localIdeographFontFamily===this._localIdeographFontFamily&&l.localFontFamily===this._localFontFamily&&this.style&&w?(this._diffStyle(w,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(w,l))}_getUIString(w){const l=this._locale[w];if(null==l)throw new Error(`Missing UI string '${w}'`);return l}_updateStyle(w,l){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),w&&(this.style=new os(this,l||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof w?this.style.loadURL(w):this.style.loadJSON(w)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new os(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,l){if("string"==typeof w){const g=this._requestManager.normalizeStyleURL(w),C=this._requestManager.transformRequest(g,p.ResourceType.Style);p.getJSON(C,(M,P)=>{M?this.fire(new p.ErrorEvent(M)):P&&this._updateDiff(P,l)})}else"object"==typeof w&&this._updateDiff(w,l)}_updateDiff(w,l){try{this.style.setState(w)&&this._update(!0)}catch(g){p.warnOnce(`Unable to perform style diff: ${g.message||g.error||g}.  Rebuilding the style from scratch.`),this._updateStyle(w,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(w,l){return this._lazyInitEmptyStyle(),this.style.addSource(w,l),this._update(!0)}isSourceLoaded(w){return!!this.style&&this.style._isSourceCacheLoaded(w)}areTilesLoaded(){const w=this.style&&this.style._sourceCaches;for(const l in w){const g=w[l]._tiles;for(const C in g){const M=g[C];if("loaded"!==M.state&&"errored"!==M.state)return!1}}return!0}addSourceType(w,l,g){this._lazyInitEmptyStyle(),this.style.addSourceType(w,l,g)}removeSource(w){return this.style.removeSource(w),this._updateTerrain(),this._update(!0)}getSource(w){return this.style.getSource(w)}addImage(w,l,{pixelRatio:g=1,sdf:C=!1,stretchX:M,stretchY:P,content:k}={}){if(this._lazyInitEmptyStyle(),l instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&l instanceof p.window.ImageBitmap){const{width:z,height:G,data:X}=p.exported.getImageData(l);this.style.addImage(w,{data:new p.RGBAImage({width:z,height:G},X),pixelRatio:g,stretchX:M,stretchY:P,content:k,sdf:C,version:0})}else if(void 0===l.width||void 0===l.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:z,height:G}=l,X=l;this.style.addImage(w,{data:new p.RGBAImage({width:z,height:G},new Uint8Array(X.data)),pixelRatio:g,stretchX:M,stretchY:P,content:k,sdf:C,version:0,userImage:X}),X.onAdd&&X.onAdd(this,w)}}updateImage(w,l){const g=this.style.getImage(w);if(!g)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const C=l instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&l instanceof p.window.ImageBitmap?p.exported.getImageData(l):l,{width:M,height:P}=C;void 0!==M&&void 0!==P?M===g.data.width&&P===g.data.height?(g.data.replace(C.data,!(l instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&l instanceof p.window.ImageBitmap)),this.style.updateImage(w,g)):this.fire(new p.ErrorEvent(new Error(`The width and height of the updated image (${M}, ${P})\n                must be that same as the previous version of the image\n                (${g.data.width}, ${g.data.height})`))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w,l){p.getImage(this._requestManager.transformRequest(w,p.ResourceType.Image),(g,C)=>{l(g,C instanceof p.window.HTMLImageElement?p.exported.getImageData(C):C)})}listImages(){return this.style.listImages()}addLayer(w,l){return this._lazyInitEmptyStyle(),this.style.addLayer(w,l),this._update(!0)}moveLayer(w,l){return this.style.moveLayer(w,l),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}setLayerZoomRange(w,l,g){return this.style.setLayerZoomRange(w,l,g),this._update(!0)}setFilter(w,l,g={}){return this.style.setFilter(w,l,g),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,l,g,C={}){return this.style.setPaintProperty(w,l,g,C),this._update(!0)}getPaintProperty(w,l){return this.style.getPaintProperty(w,l)}setLayoutProperty(w,l,g,C={}){return this.style.setLayoutProperty(w,l,g,C),this._update(!0)}getLayoutProperty(w,l){return this.style.getLayoutProperty(w,l)}setLight(w,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(w,l),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(w){return this._lazyInitEmptyStyle(),!w&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(w),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(w){return this._lazyInitEmptyStyle(),this.style.setFog(w),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(w){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(w),this.transform):0}setFeatureState(w,l){return this.style.setFeatureState(w,l),this._update()}removeFeatureState(w,l){return this.style.removeFeatureState(w,l),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}_updateContainerDimensions(){if(!this._container)return;const w=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let g,C,M,P=this._container;for(;P&&(!C||!M);){const k=p.window.getComputedStyle(P).transform;k&&"none"!==k&&(g=k.match(/matrix.*\((.+)\)/)[1].split(", "),g[0]&&"0"!==g[0]&&"1"!==g[0]&&(C=g[0]),g[3]&&"0"!==g[3]&&"1"!==g[3]&&(M=g[3])),P=P.parentElement}this._containerWidth=C?Math.abs(w/C):w,this._containerHeight=M?Math.abs(l/M):l}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const w=this._container;w.classList.add("mapboxgl-map"),(this._missingCSSCanary=qe("div","mapboxgl-canary",w)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=qe("div","mapboxgl-canvas-container",w);this._interactive&&l.classList.add("mapboxgl-interactive"),this._canvas=qe("canvas","mapboxgl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const g=this._controlContainer=qe("div","mapboxgl-control-container",w),C=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(M=>{C[M]=qe("div",`mapboxgl-ctrl-${M}`,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,l){const g=p.exported.devicePixelRatio||1;this._canvas.width=g*Math.ceil(w),this._canvas.height=g*Math.ceil(l),this._canvas.style.width=`${w}px`,this._canvas.style.height=`${l}px`}_addMarker(w){this._markers.push(w)}_removeMarker(w){const l=this._markers.indexOf(w);-1!==l&&this._markers.splice(l,1)}_addPopup(w){this._popups.push(w)}_removePopup(w){const l=this._popups.indexOf(w);-1!==l&&this._popups.splice(l,1)}_setupPainter(){const w=p.extend({},ye.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._useWebGL2&&this._canvas.getContext("webgl2",w),g=l||this._canvas.getContext("webgl",w)||this._canvas.getContext("experimental-webgl",w);g?(this._useWebGL2&&!l&&p.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),p.storeAuthState(g,!0),this.painter=new Fc(g,this.transform,!!l),this.on("data",C=>{"source"===C.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(g)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(w){w.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:w}))}_contextRestored(w){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:w}))}_onMapScroll(w){if(w.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_requestDomTask(w){!this.loaded()||this.loaded()&&!this.isMoving()?w():this._domRenderTaskQueue.add(w)}_render(w){let l;const g=this.painter.context.extTimerQuery,C=p.exported.now();if(this.listens("gpu-timing-frame")&&(l=g.createQueryEXT(),g.beginQueryEXT(g.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],p.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],p.window.performance.now())),this._renderTaskQueue.run(w),this._domRenderTaskQueue.run(w),this._removed)return;this._updateProjectionTransition();const M=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,G=this.transform.pitch,X=p.exported.now(),Z=new p.EvaluationParameters(z,{now:X,fadeDuration:M,pitch:G,transition:this.style.getTransition()});this.style.update(Z)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let P=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),P=this._updateAverageElevation(C),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):P=this._updateAverageElevation(C),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,M,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:M,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const z=p.exported.now()-C;g.endQueryEXT(g.TIME_ELAPSED_EXT,l),setTimeout(()=>{const G=g.getQueryObjectEXT(l,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(l),this.fire(new p.Event("gpu-timing-frame",{cpuTime:z,gpuTime:G})),p.window.performance.mark("frame-gpu",{startTime:C,detail:{gpuTime:G}})},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const G=this.painter.queryGpuTimers(z);this.fire(new p.Event("gpu-timing-layer",{layerTimes:G}))},50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const G=this.painter.queryGpuTimeDeferredRender(z);this.fire(new p.Event("gpu-timing-deferred-render",{gpuTime:G}))},50)}const k=this._sourcesDirty||this._styleDirty||this._placementDirty||P;if(k||this._repaint)this.triggerRepaint();else{const z=!this.isMoving()&&this.loaded();if(z&&(P=this._updateAverageElevation(C,!0)),P)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const G=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:G})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,p.LivePerformanceUtils.mark(p.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&p.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(w){for(const l of this._markers)w&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!w||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(w,l=!1){const g=C=>(this.transform.averageElevation=C,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&g(0);if((l||w-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(w)){const C=this.transform.averageElevation;let M=this.transform.sampleAverageElevation(),P=!1;this.transform.elevation&&(P=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(M)?M=0:this._averageElevationLastSampledAt=w;const k=Math.abs(C-M);if(k>1){if(this._isInitialLoad||P)return this._averageElevation.jumpTo(M),g(M);this._averageElevation.easeTo(M,w,300)}else if(k>1e-4)return this._averageElevation.jumpTo(M),g(M)}return!!this._averageElevation.isEasing(w)&&g(this._averageElevation.getValue(w))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,w=>{if(w&&(w.message===p.AUTH_ERR_MSG||401===w.status)){const l=this.painter.context.gl;p.storeAuthState(l,!1),this._logoControl instanceof ga&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const w=this._isDragging();this.painter.updateTerrain(this.style,w)}_calculateSpeedIndex(){const w=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const g=this.painter.context.gl,C=g.createFramebuffer();function M(P){g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,P,0);const k=new Uint8Array(g.drawingBufferWidth*g.drawingBufferHeight*4);return g.readPixels(0,0,g.drawingBufferWidth,g.drawingBufferHeight,g.RGBA,g.UNSIGNED_BYTE,k),k}return g.bindFramebuffer(g.FRAMEBUFFER,C),this._canvasPixelComparison(M(w),l.canvasCopies.map(M),l.timeStamps)}_canvasPixelComparison(w,l,g){let C=g[1]-g[0];const M=w.length/4;for(let P=0;P<l.length;P++){const k=l[P];let z=0;for(let G=0;G<k.length;G+=4)k[G]===w[G]&&k[G+1]===w[G+1]&&k[G+2]===w[G+2]&&k[G+3]===w[G+3]&&(z+=1);C+=(g[P+2]-g[P+1])*(1-z/M)}return C}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1),p.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(w){this._renderNextFrame=this._renderNextFrame||w,this.style&&!this._frame&&(this._frame=p.exported.frame(l=>{const g=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,g&&this._render(l)}))}_preloadTiles(w){const l=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(l,(g,C)=>g._preloadTiles(w,C),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(w){this._trackResize&&this.resize({originalEvent:w})._update()}_onVisibilityChange(){"hidden"===p.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(w){this._showTerrainWireframe!==w&&(this._showTerrainWireframe=w,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(w){this._speedIndexTiming!==w&&(this._speedIndexTiming=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(w){this._showTileAABBs!==w&&(this._showTileAABBs=w,w&&this._update())}_setCacheLimits(w,l){p.setCacheLimits(w,l)}get version(){return p.version}},NavigationControl:class{constructor(w){this.options=p.extend({},__,w),this._container=qe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),qe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),qe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const g=this._map;g&&(this.options.visualizePitch?g.resetNorthPitch({},{originalEvent:l}):g.resetNorth({},{originalEvent:l}))}),this._compassIcon=qe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const w=this._map;if(!w)return;const l=w.getZoom(),g=l===w.getMaxZoom(),C=l===w.getMinZoom();this._zoomInButton.disabled=g,this._zoomOutButton.disabled=C,this._zoomInButton.setAttribute("aria-disabled",g.toString()),this._zoomOutButton.setAttribute("aria-disabled",C.toString())}_rotateCompassArrow(){const w=this._map;if(!w)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(w.transform.pitch*(Math.PI/180)),.5)}) rotateX(${w.transform.pitch}deg) rotateZ(${w.transform.angle*(180/Math.PI)}deg)`:`rotate(${w.transform.angle*(180/Math.PI)}deg)`;w._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),w.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&w.on("pitch",this._rotateCompassArrow),w.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new $p(w,this._compass,this.options.visualizePitch)),this._container}onRemove(){const w=this._map;w&&(this._container.remove(),this.options.showZoom&&w.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&w.off("pitch",this._rotateCompassArrow),w.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(w,l){const g=qe("button",w,this._container);return g.type="button",g.addEventListener("click",l),g}_setButtonTitle(w,l){if(!this._map)return;const g=this._map._getUIString(`NavigationControl.${l}`);w.setAttribute("aria-label",g),w.firstElementChild&&w.firstElementChild.setAttribute("title",g)}},GeolocateControl:class extends p.Evented{constructor(w){super(),this.options=p.extend({geolocation:p.window.navigator.geolocation},gd,w),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=pa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(w){return this._map=w,this._container=qe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(w){const l=(g=!!this.options.geolocation)=>{this._supportsGeolocation=g,w(g)};void 0!==this._supportsGeolocation?w(this._supportsGeolocation):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(g=>l("denied"!==g.state)).catch(()=>l()):l()}_isOutOfMapMaxBounds(w){const l=this._map.getMaxBounds(),g=w.coords;return!!l&&(g.longitude<l.getWest()||g.longitude>l.getEast()||g.latitude<l.getSouth()||g.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(w){if(this._map){if(this._isOutOfMapMaxBounds(w))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",w)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=w,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(w),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(w),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",w)),this._finish()}}_updateCamera(w){const l=new p.LngLat(w.coords.longitude,w.coords.latitude),g=w.coords.accuracy,C=this._map.getBearing(),M=p.extend({bearing:C},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(g),M,{geolocateSource:!0})}_updateMarker(w){if(w){const l=new p.LngLat(w.coords.longitude,w.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=w.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const w=this._map.transform,l=p.mercatorZfromAltitude(1,w._center.lat)*w.worldSize,g=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(w){if(this._map){if(this.options.trackUserLocation)if(1===w.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===w.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",w)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(w){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=qe("button","mapboxgl-ctrl-geolocate",this._container),qe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===w){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=qe("div","mapboxgl-user-location"),this._dotElement.appendChild(qe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(qe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Kn({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=qe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Kn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||"ACTIVE_LOCK"!==this._watchState||l.originalEvent&&"resize"===l.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}}_onDeviceOrientation(w){this._userLocationDotMarker&&(w.webkitCompassHeading?this._heading=w.webkitCompassHeading:!0===w.absolute&&(this._heading=-1*w.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let w;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(w={maximumAge:6e5,timeout:0},this._noTimeout=!0):(w=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,w),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const w=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(l=>{"granted"===l&&w()}).catch(console.error):w()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Gn,ScaleControl:class{constructor(w){this.options=p.extend({},Ff,w),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),p.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const w=this.options.maxWidth||100,l=this._map,g=l._containerHeight/2,C=l._containerWidth/2-w/2,M=l.unproject([C,g]),P=l.unproject([C+w,g]),k=M.distanceTo(P);if("imperial"===this.options.unit){const z=3.2808*k;z>5280?this._setScale(w,z/5280,"mile"):this._setScale(w,z,"foot")}else"nautical"===this.options.unit?this._setScale(w,k/1852,"nautical-mile"):k>=1e3?this._setScale(w,k/1e3,"kilometer"):this._setScale(w,k,"meter")}_setScale(w,l,g){this._map._requestDomTask(()=>{const C=function(P){const k=Math.pow(10,`${Math.floor(P)}`.length-1);let z=P/k;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:function(G){const X=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*X)/X}(z),k*z}(l),M=C/l;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==g?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:g}).format(C):`${C}&nbsp;${qp[g]}`,this._container.style.width=w*M+"px"})}onAdd(w){return this._map=w,this._language=w.getLanguage(),this._container=qe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",w.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(w){this._language=w,this._update()}setUnit(w){this.options.unit=w,this._update()}},FullscreenControl:class{constructor(w){this._fullscreen=!1,w&&w.container&&(w.container instanceof p.window.HTMLElement?this._container=w.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(w){return this._map=w,this._container||(this._container=this._map.getContainer()),this._controlContainer=qe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const w=this._fullscreenButton=qe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);qe("span","mapboxgl-ctrl-icon",w).setAttribute("aria-hidden","true"),w.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const w=this._getTitle();this._fullscreenButton.setAttribute("aria-label",w),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",w)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(w){super(),this.options=p.extend(Object.create(Bg),w),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(w&&w.className?w.className.trim().split(/\s+/):[])}addTo(w){return this._map&&this.remove(),this._map=w,this.options.closeOnClick&&w.on("preclick",this._onClose),this.options.closeOnMove&&w.on("move",this._onClose),w.on("remove",this.remove),this._update(),w._addPopup(this),this._focusFirstElement(),this._trackPointer?(w.on("mousemove",this._onMouseEvent),w.on("mouseup",this._onMouseEvent),w._canvasContainer.classList.add("mapboxgl-track-pointer")):w.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const w=this._map;return w&&(w.off("move",this._update),w.off("move",this._onClose),w.off("preclick",this._onClose),w.off("click",this._onClose),w.off("remove",this.remove),w.off("mousemove",this._onMouseEvent),w.off("mouseup",this._onMouseEvent),w.off("drag",this._onMouseEvent),w._canvasContainer&&w._canvasContainer.classList.remove("mapboxgl-track-pointer"),w._removePopup(this),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(w){this._lngLat=p.LngLat.convert(w),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const w=this._map;return w&&(w.off("move",this._update),w.on("mousemove",this._onMouseEvent),w.on("drag",this._onMouseEvent),w._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(w){return this.setDOMContent(p.window.document.createTextNode(w))}setHTML(w){const l=p.window.document.createDocumentFragment(),g=p.window.document.createElement("body");let C;for(g.innerHTML=w;C=g.firstChild,C;)l.appendChild(C);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(w){return this.options.maxWidth=w,this._update(),this}setDOMContent(w){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=qe("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(w),this.options.closeButton){const g=this._closeButton=qe("button","mapboxgl-popup-close-button",l);g.type="button",g.setAttribute("aria-label","Close popup"),g.setAttribute("aria-hidden","true"),g.innerHTML="&#215;",g.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(w){return this._classList.add(w),this._updateClassList(),this}removeClassName(w){return this._classList.delete(w),this._updateClassList(),this}setOffset(w){return this.options.offset=w,this._update(),this}toggleClassName(w){let l;return this._classList.delete(w)?l=!1:(this._classList.add(w),l=!0),this._updateClassList(),l}_onMouseEvent(w){this._update(w.point)}_getAnchor(w){if(this.options.anchor)return this.options.anchor;const l=this._map,g=this._container,C=this._pos;if(!l||!g||!C)return"bottom";const M=g.offsetWidth,P=g.offsetHeight,k=C.x<M/2,z=C.x>l.transform.width-M/2;if(C.y+w<P)return k?"top-left":z?"top-right":"top";if(C.y>l.transform.height-P){if(k)return"bottom-left";if(z)return"bottom-right"}return k?"left":z?"right":"bottom"}_updateClassList(){const w=this._container;if(!w)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),w.className=l.join(" ")}_update(w){const l=this._map,g=this._content;if(!l||!this._lngLat&&!this._trackPointer||!g)return;let C=this._container;if(C||(C=this._container=qe("div","mapboxgl-popup",l.getContainer()),this._tip=qe("div","mapboxgl-popup-tip",C),C.appendChild(g)),this.options.maxWidth&&C.style.maxWidth!==this.options.maxWidth&&(C.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=il(this._lngLat,this._pos,l.transform)),!this._trackPointer||w){const M=this._pos=this._trackPointer&&w?w:l.project(this._lngLat),P=zu(this.options.offset),k=this._anchor=this._getAnchor(P.y),z=zu(this.options.offset,k),G=M.add(z).round();l._requestDomTask(()=>{this._container&&k&&(this._container.style.transform=`${zc[k]} translate(${G.x}px,${G.y}px)`)})}if(!this._marker&&l._showingGlobe()){const M=p.isLngLatBehindGlobe(l.transform,this._lngLat)?0:1;this._setOpacity(M)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const w=this._container.querySelector(Jm);w&&w.focus()}_onClose(){this.remove()}_setOpacity(w){this._container&&(this._container.style.opacity=`${w}`),this._content&&(this._content.style.pointerEvents=w?"auto":"none")}},Marker:Kn,Style:os,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:co,Evented:p.Evented,config:p.config,prewarm:function(){pl().acquire(ya)},clearPrewarmedResources:function(){const w=zi;w&&(w.isPreloaded()&&1===w.numActive()?(w.release(ya),zi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(w){p.config.ACCESS_TOKEN=w},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(w){p.config.API_URL=w},get workerCount(){return Xo.workerCount},set workerCount(w){Xo.workerCount=w},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(w){p.config.MAX_PARALLEL_IMAGE_REQUESTS=w},clearStorage(w){p.clearTileCache(w)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return Bf}),me}()},5943:Dt=>{"use strict";var ot=Object.getOwnPropertySymbols,ve=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;Dt.exports=function Ee(){try{if(!Object.assign)return!1;var p=new String("abc");if(p[5]="de","5"===Object.getOwnPropertyNames(p)[0])return!1;for(var J={},ye=0;ye<10;ye++)J["_"+String.fromCharCode(ye)]=ye;if("0123456789"!==Object.getOwnPropertyNames(J).map(function(qe){return J[qe]}).join(""))return!1;var Pe={};return"abcdefghijklmnopqrst".split("").forEach(function(qe){Pe[qe]=qe}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},Pe)).join("")}catch{return!1}}()?Object.assign:function(p,J){for(var ye,Pe,Ce=function q(p){if(null==p)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(p)}(p),qe=1;qe<arguments.length;qe++){for(var It in ye=Object(arguments[qe]))ve.call(ye,It)&&(Ce[It]=ye[It]);if(ot){Pe=ot(ye);for(var gt=0;gt<Pe.length;gt++)me.call(ye,Pe[gt])&&(Ce[Pe[gt]]=ye[Pe[gt]])}}return Ce}},1175:Dt=>{"use strict";var ot=function(ve){return ve!=ve};Dt.exports=function(me,q){return 0===me&&0===q?1/me==1/q:!!(me===q||ot(me)&&ot(q))}},2e3:(Dt,ot,ve)=>{"use strict";var me=ve(2358),q=ve(5685),Ee=ve(1175),p=ve(6305),J=ve(3859),ye=q(p(),Object);me(ye,{getPolyfill:p,implementation:Ee,shim:J}),Dt.exports=ye},6305:(Dt,ot,ve)=>{"use strict";var me=ve(1175);Dt.exports=function(){return"function"==typeof Object.is?Object.is:me}},3859:(Dt,ot,ve)=>{"use strict";var me=ve(6305),q=ve(2358);Dt.exports=function(){var p=me();return q(Object,{is:p},{is:function(){return Object.is!==p}}),p}},2450:(Dt,ot,ve)=>{"use strict";var me;if(!Object.keys){var q=Object.prototype.hasOwnProperty,Ee=Object.prototype.toString,p=ve(9978),J=Object.prototype.propertyIsEnumerable,ye=!J.call({toString:null},"toString"),Ce=J.call(function(){},"prototype"),Pe=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],qe=function(mt){var Mt=mt.constructor;return Mt&&Mt.prototype===mt},It={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},gt=function(){if(typeof window>"u")return!1;for(var mt in window)try{if(!It["$"+mt]&&q.call(window,mt)&&null!==window[mt]&&"object"==typeof window[mt])try{qe(window[mt])}catch{return!0}}catch{return!0}return!1}();me=function(Mt){var le=null!==Mt&&"object"==typeof Mt,K="[object Function]"===Ee.call(Mt),ne=p(Mt),ce=le&&"[object String]"===Ee.call(Mt),ee=[];if(!le&&!K&&!ne)throw new TypeError("Object.keys called on a non-object");var ae=Ce&&K;if(ce&&Mt.length>0&&!q.call(Mt,0))for(var oe=0;oe<Mt.length;++oe)ee.push(String(oe));if(ne&&Mt.length>0)for(var te=0;te<Mt.length;++te)ee.push(String(te));else for(var _e in Mt)(!ae||"prototype"!==_e)&&q.call(Mt,_e)&&ee.push(String(_e));if(ye)for(var re=function(mt){if(typeof window>"u"||!gt)return qe(mt);try{return qe(mt)}catch{return!1}}(Mt),Je=0;Je<Pe.length;++Je)(!re||"constructor"!==Pe[Je])&&q.call(Mt,Pe[Je])&&ee.push(Pe[Je]);return ee}}Dt.exports=me},1356:(Dt,ot,ve)=>{"use strict";var me=Array.prototype.slice,q=ve(9978),Ee=Object.keys,p=Ee?function(Ce){return Ee(Ce)}:ve(2450),J=Object.keys;p.shim=function(){if(Object.keys){var Ce=function(){var Pe=Object.keys(arguments);return Pe&&Pe.length===arguments.length}(1,2);Ce||(Object.keys=function(qe){return q(qe)?J(me.call(qe)):J(qe)})}else Object.keys=p;return Object.keys||p},Dt.exports=p},9978:Dt=>{"use strict";var ot=Object.prototype.toString;Dt.exports=function(me){var q=ot.call(me),Ee="[object Arguments]"===q;return Ee||(Ee="[object Array]"!==q&&null!==me&&"object"==typeof me&&"number"==typeof me.length&&me.length>=0&&"[object Function]"===ot.call(me.callee)),Ee}},1766:Dt=>{Dt.exports=function(ve,me,q,Ee){var p=ve[0],J=ve[1],ye=!1;void 0===q&&(q=0),void 0===Ee&&(Ee=me.length);for(var Ce=(Ee-q)/2,Pe=0,qe=Ce-1;Pe<Ce;qe=Pe++){var It=me[q+2*Pe+0],gt=me[q+2*Pe+1],mt=me[q+2*qe+1];gt>J!=mt>J&&p<(me[q+2*qe+0]-It)*(J-gt)/(mt-gt)+It&&(ye=!ye)}return ye}},3870:(Dt,ot,ve)=>{var me=ve(1766),q=ve(2260);Dt.exports=function(p,J,ye,Ce){return J.length>0&&Array.isArray(J[0])?q(p,J,ye,Ce):me(p,J,ye,Ce)},Dt.exports.nested=q,Dt.exports.flat=me},2260:Dt=>{Dt.exports=function(ve,me,q,Ee){var p=ve[0],J=ve[1],ye=!1;void 0===q&&(q=0),void 0===Ee&&(Ee=me.length);for(var Ce=Ee-q,Pe=0,qe=Ce-1;Pe<Ce;qe=Pe++){var It=me[Pe+q][0],gt=me[Pe+q][1],mt=me[qe+q][1];gt>J!=mt>J&&p<(me[qe+q][0]-It)*(J-gt)/(mt-gt)+It&&(ye=!ye)}return ye}},9855:function(Dt){Dt.exports=function(){"use strict";function ot(Pt,Re){if(!(Pt instanceof Re))throw new TypeError("Cannot call a class as a function")}function ve(Pt,Re){for(var Te=0;Te<Re.length;Te++){var Se=Re[Te];Se.enumerable=Se.enumerable||!1,Se.configurable=!0,"value"in Se&&(Se.writable=!0),Object.defineProperty(Pt,Se.key,Se)}}function me(Pt,Re,Te){return Re&&ve(Pt.prototype,Re),Te&&ve(Pt,Te),Pt}var q=function Pt(Re,Te){this.next=null,this.key=Re,this.data=Te,this.left=null,this.right=null};function Ee(Pt,Re){return Pt>Re?1:Pt<Re?-1:0}function p(Pt,Re,Te){for(var Se=new q(null,null),et=Se,Ct=Se;;){var Yt=Te(Pt,Re.key);if(Yt<0){if(null===Re.left)break;if(Te(Pt,Re.left.key)<0&&(Re.left=(yn=Re.left).right,yn.right=Re,null===(Re=yn).left))break;Ct.left=Re,Ct=Re,Re=Re.left}else{if(!(Yt>0))break;if(null===Re.right)break;var yn;if(Te(Pt,Re.right.key)>0&&(Re.right=(yn=Re.right).left,yn.left=Re,null===(Re=yn).right))break;et.right=Re,et=Re,Re=Re.right}}return et.right=Re.left,Ct.left=Re.right,Re.left=Se.right,Re.right=Se.left,Re}function J(Pt,Re,Te,Se){var et=new q(Pt,Re);if(null===Te)return et.left=et.right=null,et;var Ct=Se(Pt,(Te=p(Pt,Te,Se)).key);return Ct<0?(et.left=Te.left,et.right=Te,Te.left=null):Ct>=0&&(et.right=Te.right,et.left=Te,Te.right=null),et}function ye(Pt,Re,Te){var Se=null,et=null;if(Re){var Ct=Te((Re=p(Pt,Re,Te)).key,Pt);0===Ct?(Se=Re.left,et=Re.right):Ct<0?(et=Re.right,Re.right=null,Se=Re):(Se=Re.left,Re.left=null,et=Re)}return{left:Se,right:et}}function Pe(Pt,Re,Te,Se,et){if(Pt){Se(Re+(Te?"\u2514\u2500\u2500 ":"\u251c\u2500\u2500 ")+et(Pt)+"\n");var Ct=Re+(Te?"    ":"\u2502   ");Pt.left&&Pe(Pt.left,Ct,!1,Se,et),Pt.right&&Pe(Pt.right,Ct,!0,Se,et)}}var qe=function(){function Pt(Re){void 0===Re&&(Re=Ee),this._root=null,this._size=0,this._comparator=Re}return Pt.prototype.insert=function(Re,Te){return this._size++,this._root=J(Re,Te,this._root,this._comparator)},Pt.prototype.add=function(Re,Te){var Se=new q(Re,Te);null===this._root&&(Se.left=Se.right=null,this._size++,this._root=Se);var et=this._comparator,Ct=p(Re,this._root,et),Yt=et(Re,Ct.key);return 0===Yt?this._root=Ct:(Yt<0?(Se.left=Ct.left,Se.right=Ct,Ct.left=null):Yt>0&&(Se.right=Ct.right,Se.left=Ct,Ct.right=null),this._size++,this._root=Se),this._root},Pt.prototype.remove=function(Re){this._root=this._remove(Re,this._root,this._comparator)},Pt.prototype._remove=function(Re,Te,Se){var et;return null===Te?null:0===Se(Re,(Te=p(Re,Te,Se)).key)?(null===Te.left?et=Te.right:(et=p(Re,Te.left,Se)).right=Te.right,this._size--,et):Te},Pt.prototype.pop=function(){var Re=this._root;if(Re){for(;Re.left;)Re=Re.left;return this._root=p(Re.key,this._root,this._comparator),this._root=this._remove(Re.key,this._root,this._comparator),{key:Re.key,data:Re.data}}return null},Pt.prototype.findStatic=function(Re){for(var Te=this._root,Se=this._comparator;Te;){var et=Se(Re,Te.key);if(0===et)return Te;Te=et<0?Te.left:Te.right}return null},Pt.prototype.find=function(Re){return this._root&&(this._root=p(Re,this._root,this._comparator),0!==this._comparator(Re,this._root.key))?null:this._root},Pt.prototype.contains=function(Re){for(var Te=this._root,Se=this._comparator;Te;){var et=Se(Re,Te.key);if(0===et)return!0;Te=et<0?Te.left:Te.right}return!1},Pt.prototype.forEach=function(Re,Te){for(var Se=this._root,et=[],Ct=!1;!Ct;)null!==Se?(et.push(Se),Se=Se.left):0!==et.length?(Se=et.pop(),Re.call(Te,Se),Se=Se.right):Ct=!0;return this},Pt.prototype.range=function(Re,Te,Se,et){for(var Ct=[],Yt=this._comparator,yn=this._root;0!==Ct.length||yn;)if(yn)Ct.push(yn),yn=yn.left;else{if(Yt((yn=Ct.pop()).key,Te)>0)break;if(Yt(yn.key,Re)>=0&&Se.call(et,yn))return this;yn=yn.right}return this},Pt.prototype.keys=function(){var Re=[];return this.forEach(function(Te){return Re.push(Te.key)}),Re},Pt.prototype.values=function(){var Re=[];return this.forEach(function(Te){return Re.push(Te.data)}),Re},Pt.prototype.min=function(){return this._root?this.minNode(this._root).key:null},Pt.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},Pt.prototype.minNode=function(Re){if(void 0===Re&&(Re=this._root),Re)for(;Re.left;)Re=Re.left;return Re},Pt.prototype.maxNode=function(Re){if(void 0===Re&&(Re=this._root),Re)for(;Re.right;)Re=Re.right;return Re},Pt.prototype.at=function(Re){for(var Te=this._root,Se=!1,et=0,Ct=[];!Se;)if(Te)Ct.push(Te),Te=Te.left;else if(Ct.length>0){if(Te=Ct.pop(),et===Re)return Te;et++,Te=Te.right}else Se=!0;return null},Pt.prototype.next=function(Re){var Te=this._root,Se=null;if(Re.right){for(Se=Re.right;Se.left;)Se=Se.left;return Se}for(var et=this._comparator;Te;){var Ct=et(Re.key,Te.key);if(0===Ct)break;Ct<0?(Se=Te,Te=Te.left):Te=Te.right}return Se},Pt.prototype.prev=function(Re){var Te=this._root,Se=null;if(null!==Re.left){for(Se=Re.left;Se.right;)Se=Se.right;return Se}for(var et=this._comparator;Te;){var Ct=et(Re.key,Te.key);if(0===Ct)break;Ct<0?Te=Te.left:(Se=Te,Te=Te.right)}return Se},Pt.prototype.clear=function(){return this._root=null,this._size=0,this},Pt.prototype.toList=function(){return function st(Pt){for(var Re=Pt,Te=[],Se=!1,et=new q(null,null),Ct=et;!Se;)Re?(Te.push(Re),Re=Re.left):Te.length>0?Re=(Re=Ct=Ct.next=Te.pop()).right:Se=!0;return Ct.next=null,et.next}(this._root)},Pt.prototype.load=function(Re,Te,Se){void 0===Te&&(Te=[]),void 0===Se&&(Se=!1);var et=Re.length,Ct=this._comparator;if(Se&&le(Re,Te,0,et-1,Ct),null===this._root)this._root=It(Re,Te,0,et),this._size=et;else{var Yt=function Mt(Pt,Re,Te){for(var Se=new q(null,null),et=Se,Ct=Pt,Yt=Re;null!==Ct&&null!==Yt;)Te(Ct.key,Yt.key)<0?(et.next=Ct,Ct=Ct.next):(et.next=Yt,Yt=Yt.next),et=et.next;return null!==Ct?et.next=Ct:null!==Yt&&(et.next=Yt),Se.next}(this.toList(),function gt(Pt,Re){for(var Te=new q(null,null),Se=Te,et=0;et<Pt.length;et++)Se=Se.next=new q(Pt[et],Re[et]);return Se.next=null,Te.next}(Re,Te),Ct);this._root=mt({head:Yt},0,et=this._size+et)}return this},Pt.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(Pt.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(Pt.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Pt.prototype.toString=function(Re){void 0===Re&&(Re=function(et){return String(et.key)});var Te=[];return Pe(this._root,"",!0,function(Se){return Te.push(Se)},Re),Te.join("")},Pt.prototype.update=function(Re,Te,Se){var et=this._comparator,Ct=ye(Re,this._root,et),Yt=Ct.left,yn=Ct.right;et(Re,Te)<0?yn=J(Te,Se,yn,et):Yt=J(Te,Se,Yt,et),this._root=function Ce(Pt,Re,Te){return null===Re?Pt:(null===Pt||((Re=p(Pt.key,Re,Te)).left=Pt),Re)}(Yt,yn,et)},Pt.prototype.split=function(Re){return ye(Re,this._root,this._comparator)},Pt}();function It(Pt,Re,Te,Se){var et=Se-Te;if(et>0){var Ct=Te+Math.floor(et/2),_n=new q(Pt[Ct],Re[Ct]);return _n.left=It(Pt,Re,Te,Ct),_n.right=It(Pt,Re,Ct+1,Se),_n}return null}function mt(Pt,Re,Te){var Se=Te-Re;if(Se>0){var et=Re+Math.floor(Se/2),Ct=mt(Pt,Re,et),Yt=Pt.head;return Yt.left=Ct,Pt.head=Pt.head.next,Yt.right=mt(Pt,et+1,Te),Yt}return null}function le(Pt,Re,Te,Se,et){if(!(Te>=Se)){for(var Ct=Pt[Te+Se>>1],Yt=Te-1,yn=Se+1;;){do{Yt++}while(et(Pt[Yt],Ct)<0);do{yn--}while(et(Pt[yn],Ct)>0);if(Yt>=yn)break;var _n=Pt[Yt];Pt[Yt]=Pt[yn],Pt[yn]=_n,_n=Re[Yt],Re[Yt]=Re[yn],Re[yn]=_n}le(Pt,Re,Te,yn,et),le(Pt,Re,yn+1,Se,et)}}var K=function(Re,Te){return Re.ll.x<=Te.x&&Te.x<=Re.ur.x&&Re.ll.y<=Te.y&&Te.y<=Re.ur.y},ne=function(Re,Te){return Te.ur.x<Re.ll.x||Re.ur.x<Te.ll.x||Te.ur.y<Re.ll.y||Re.ur.y<Te.ll.y?null:{ll:{x:Re.ll.x<Te.ll.x?Te.ll.x:Re.ll.x,y:Re.ll.y<Te.ll.y?Te.ll.y:Re.ll.y},ur:{x:Re.ur.x<Te.ur.x?Re.ur.x:Te.ur.x,y:Re.ur.y<Te.ur.y?Re.ur.y:Te.ur.y}}},ce=Number.EPSILON;void 0===ce&&(ce=Math.pow(2,-52));var ee=ce*ce,ae=function(Re,Te){if(-ce<Re&&Re<ce&&-ce<Te&&Te<ce)return 0;var Se=Re-Te;return Se*Se<ee*Re*Te?0:Re<Te?-1:1},oe=function(){function Pt(){ot(this,Pt),this.reset()}return me(Pt,[{key:"reset",value:function(){this.xRounder=new te,this.yRounder=new te}},{key:"round",value:function(Te,Se){return{x:this.xRounder.round(Te),y:this.yRounder.round(Se)}}}]),Pt}(),te=function(){function Pt(){ot(this,Pt),this.tree=new qe,this.round(0)}return me(Pt,[{key:"round",value:function(Te){var Se=this.tree.add(Te),et=this.tree.prev(Se);if(null!==et&&0===ae(Se.key,et.key))return this.tree.remove(Te),et.key;var Ct=this.tree.next(Se);return null!==Ct&&0===ae(Se.key,Ct.key)?(this.tree.remove(Te),Ct.key):Te}}]),Pt}(),_e=new oe,re=function(Re,Te){return Re.x*Te.y-Re.y*Te.x},Je=function(Re,Te){return Re.x*Te.x+Re.y*Te.y},He=function(Re,Te,Se){var Yt=re({x:Te.x-Re.x,y:Te.y-Re.y},{x:Se.x-Re.x,y:Se.y-Re.y});return ae(Yt,0)},it=function(Re){return Math.sqrt(Je(Re,Re))},Ne=function(Re,Te,Se){var et={x:Te.x-Re.x,y:Te.y-Re.y},Ct={x:Se.x-Re.x,y:Se.y-Re.y};return re(Ct,et)/it(Ct)/it(et)},sn=function(Re,Te,Se){var et={x:Te.x-Re.x,y:Te.y-Re.y},Ct={x:Se.x-Re.x,y:Se.y-Re.y};return Je(Ct,et)/it(Ct)/it(et)},Bt=function(Re,Te,Se){return 0===Te.y?null:{x:Re.x+Te.x/Te.y*(Se-Re.y),y:Se}},Le=function(Re,Te,Se){return 0===Te.x?null:{x:Se,y:Re.y+Te.y/Te.x*(Se-Re.x)}},Ue=function(){function Pt(Re,Te){ot(this,Pt),void 0===Re.events?Re.events=[this]:Re.events.push(this),this.point=Re,this.isLeft=Te}return me(Pt,null,[{key:"compare",value:function(Te,Se){var et=Pt.comparePoints(Te.point,Se.point);return 0!==et?et:(Te.point!==Se.point&&Te.link(Se),Te.isLeft!==Se.isLeft?Te.isLeft?1:-1:Tt.compare(Te.segment,Se.segment))}},{key:"comparePoints",value:function(Te,Se){return Te.x<Se.x?-1:Te.x>Se.x?1:Te.y<Se.y?-1:Te.y>Se.y?1:0}}]),me(Pt,[{key:"link",value:function(Te){if(Te.point===this.point)throw new Error("Tried to link already linked events");for(var Se=Te.point.events,et=0,Ct=Se.length;et<Ct;et++){var Yt=Se[et];this.point.events.push(Yt),Yt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var Te=this.point.events.length,Se=0;Se<Te;Se++){var et=this.point.events[Se];if(void 0===et.segment.consumedBy)for(var Ct=Se+1;Ct<Te;Ct++){var Yt=this.point.events[Ct];void 0===Yt.consumedBy&&et.otherSE.point.events===Yt.otherSE.point.events&&et.segment.consume(Yt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var Te=[],Se=0,et=this.point.events.length;Se<et;Se++){var Ct=this.point.events[Se];Ct!==this&&!Ct.segment.ringOut&&Ct.segment.isInResult()&&Te.push(Ct)}return Te}},{key:"getLeftmostComparator",value:function(Te){var Se=this,et=new Map,Ct=function(yn){var _n=yn.otherSE;et.set(yn,{sine:Ne(Se.point,Te.point,_n.point),cosine:sn(Se.point,Te.point,_n.point)})};return function(Yt,yn){et.has(Yt)||Ct(Yt),et.has(yn)||Ct(yn);var _n=et.get(Yt),en=_n.sine,Dr=_n.cosine,Pr=et.get(yn),zn=Pr.sine,Gr=Pr.cosine;return en>=0&&zn>=0?Dr<Gr?1:Dr>Gr?-1:0:en<0&&zn<0?Dr<Gr?-1:Dr>Gr?1:0:zn<en?-1:zn>en?1:0}}}]),Pt}(),ft=0,Tt=function(){function Pt(Re,Te,Se,et){ot(this,Pt),this.id=++ft,this.leftSE=Re,Re.segment=this,Re.otherSE=Te,this.rightSE=Te,Te.segment=this,Te.otherSE=Re,this.rings=Se,this.windings=et}return me(Pt,null,[{key:"compare",value:function(Te,Se){var et=Te.leftSE.point.x,Ct=Se.leftSE.point.x,Yt=Te.rightSE.point.x,yn=Se.rightSE.point.x;if(yn<et)return 1;if(Yt<Ct)return-1;var _n=Te.leftSE.point.y,en=Se.leftSE.point.y,Dr=Te.rightSE.point.y,Pr=Se.rightSE.point.y;if(et<Ct){if(en<_n&&en<Dr)return 1;if(en>_n&&en>Dr)return-1;var zn=Te.comparePoint(Se.leftSE.point);if(zn<0)return 1;if(zn>0)return-1;var Gr=Se.comparePoint(Te.rightSE.point);return 0!==Gr?Gr:-1}if(et>Ct){if(_n<en&&_n<Pr)return-1;if(_n>en&&_n>Pr)return 1;var Pi=Se.comparePoint(Te.leftSE.point);if(0!==Pi)return Pi;var ni=Te.comparePoint(Se.rightSE.point);return ni<0?1:ni>0?-1:1}if(_n<en)return-1;if(_n>en)return 1;if(Yt<yn){var Ci=Se.comparePoint(Te.rightSE.point);if(0!==Ci)return Ci}if(Yt>yn){var Ki=Te.comparePoint(Se.rightSE.point);if(Ki<0)return 1;if(Ki>0)return-1}if(Yt!==yn){var ts=Dr-_n,Hs=Yt-et,rt=Pr-en,xe=yn-Ct;if(ts>Hs&&rt<xe)return 1;if(ts<Hs&&rt>xe)return-1}return Yt>yn?1:Yt<yn||Dr<Pr?-1:Dr>Pr?1:Te.id<Se.id?-1:Te.id>Se.id?1:0}}]),me(Pt,[{key:"replaceRightSE",value:function(Te){this.rightSE=Te,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var Te=this.leftSE.point.y,Se=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:Te<Se?Te:Se},ur:{x:this.rightSE.point.x,y:Te>Se?Te:Se}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(Te){return Te.x===this.leftSE.point.x&&Te.y===this.leftSE.point.y||Te.x===this.rightSE.point.x&&Te.y===this.rightSE.point.y}},{key:"comparePoint",value:function(Te){if(this.isAnEndpoint(Te))return 0;var Se=this.leftSE.point,et=this.rightSE.point,Ct=this.vector();if(Se.x===et.x)return Te.x===Se.x?0:Te.x<Se.x?1:-1;if(Te.x===Se.x+(Te.y-Se.y)/Ct.y*Ct.x)return 0;var en=Se.y+(Te.x-Se.x)/Ct.x*Ct.y;return Te.y===en?0:Te.y<en?-1:1}},{key:"getIntersection",value:function(Te){var Se=this.bbox(),et=Te.bbox(),Ct=ne(Se,et);if(null===Ct)return null;var Yt=this.leftSE.point,yn=this.rightSE.point,_n=Te.leftSE.point,en=Te.rightSE.point,Dr=K(Se,_n)&&0===this.comparePoint(_n),Pr=K(et,Yt)&&0===Te.comparePoint(Yt),zn=K(Se,en)&&0===this.comparePoint(en),Gr=K(et,yn)&&0===Te.comparePoint(yn);if(Pr&&Dr)return Gr&&!zn?yn:!Gr&&zn?en:null;if(Pr)return zn&&Yt.x===en.x&&Yt.y===en.y?null:Yt;if(Dr)return Gr&&yn.x===_n.x&&yn.y===_n.y?null:_n;if(Gr&&zn)return null;if(Gr)return yn;if(zn)return en;var Pi=function(Re,Te,Se,et){if(0===Te.x)return Le(Se,et,Re.x);if(0===et.x)return Le(Re,Te,Se.x);if(0===Te.y)return Bt(Se,et,Re.y);if(0===et.y)return Bt(Re,Te,Se.y);var Ct=re(Te,et);if(0==Ct)return null;var Yt={x:Se.x-Re.x,y:Se.y-Re.y},yn=re(Yt,Te)/Ct,_n=re(Yt,et)/Ct;return{x:(Re.x+_n*Te.x+(Se.x+yn*et.x))/2,y:(Re.y+_n*Te.y+(Se.y+yn*et.y))/2}}(Yt,this.vector(),_n,Te.vector());return null!==Pi&&K(Ct,Pi)?_e.round(Pi.x,Pi.y):null}},{key:"split",value:function(Te){var Se=[],et=void 0!==Te.events,Ct=new Ue(Te,!0),Yt=new Ue(Te,!1),yn=this.rightSE;this.replaceRightSE(Yt),Se.push(Yt),Se.push(Ct);var _n=new Pt(Ct,yn,this.rings.slice(),this.windings.slice());return Ue.comparePoints(_n.leftSE.point,_n.rightSE.point)>0&&_n.swapEvents(),Ue.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),et&&(Ct.checkForConsuming(),Yt.checkForConsuming()),Se}},{key:"swapEvents",value:function(){var Te=this.rightSE;this.rightSE=this.leftSE,this.leftSE=Te,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var Se=0,et=this.windings.length;Se<et;Se++)this.windings[Se]*=-1}},{key:"consume",value:function(Te){for(var Se=this,et=Te;Se.consumedBy;)Se=Se.consumedBy;for(;et.consumedBy;)et=et.consumedBy;var Ct=Pt.compare(Se,et);if(0!==Ct){if(Ct>0){var Yt=Se;Se=et,et=Yt}if(Se.prev===et){var yn=Se;Se=et,et=yn}for(var _n=0,en=et.rings.length;_n<en;_n++){var Dr=et.rings[_n],Pr=et.windings[_n],zn=Se.rings.indexOf(Dr);-1===zn?(Se.rings.push(Dr),Se.windings.push(Pr)):Se.windings[zn]+=Pr}et.rings=null,et.windings=null,et.consumedBy=Se,et.leftSE.consumedBy=Se.leftSE,et.rightSE.consumedBy=Se.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this._prevInResult=this.prev?this.prev.isInResult()?this.prev:this.prev.prevInResult():null),this._prevInResult}},{key:"beforeState",value:function(){return void 0!==this._beforeState||(this._beforeState=this.prev?(this.prev.consumedBy||this.prev).afterState():{rings:[],windings:[],multiPolys:[]}),this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var Te=this.beforeState();this._afterState={rings:Te.rings.slice(0),windings:Te.windings.slice(0),multiPolys:[]};for(var Se=this._afterState.rings,et=this._afterState.windings,Ct=this._afterState.multiPolys,Yt=0,yn=this.rings.length;Yt<yn;Yt++){var _n=this.rings[Yt],en=this.windings[Yt],Dr=Se.indexOf(_n);-1===Dr?(Se.push(_n),et.push(en)):et[Dr]+=en}for(var Pr=[],zn=[],Gr=0,Pi=Se.length;Gr<Pi;Gr++)if(0!==et[Gr]){var ni=Se[Gr],Ci=ni.poly;if(-1===zn.indexOf(Ci))if(ni.isExterior)Pr.push(Ci);else{-1===zn.indexOf(Ci)&&zn.push(Ci);var Ki=Pr.indexOf(ni.poly);-1!==Ki&&Pr.splice(Ki,1)}}for(var ts=0,Hs=Pr.length;ts<Hs;ts++){var rt=Pr[ts].multiPoly;-1===Ct.indexOf(rt)&&Ct.push(rt)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var Te=this.beforeState().multiPolys,Se=this.afterState().multiPolys;switch(wn.type){case"union":this._isInResult=0===Te.length!=(0===Se.length);break;case"intersection":var Yt,yn;Te.length<Se.length?(Yt=Te.length,yn=Se.length):(Yt=Se.length,yn=Te.length),this._isInResult=yn===wn.numMultiPolys&&Yt<yn;break;case"xor":var _n=Math.abs(Te.length-Se.length);this._isInResult=_n%2==1;break;case"difference":var en=function(Pr){return 1===Pr.length&&Pr[0].isSubject};this._isInResult=en(Te)!==en(Se);break;default:throw new Error("Unrecognized operation type found ".concat(wn.type))}return this._isInResult}}],[{key:"fromRing",value:function(Te,Se,et){var Ct,Yt,yn,_n=Ue.comparePoints(Te,Se);if(_n<0)Ct=Te,Yt=Se,yn=1;else{if(!(_n>0))throw new Error("Tried to create degenerate segment at [".concat(Te.x,", ").concat(Te.y,"]"));Ct=Se,Yt=Te,yn=-1}return new Pt(new Ue(Ct,!0),new Ue(Yt,!1),[et],[yn])}}]),Pt}(),Be=function(){function Pt(Re,Te,Se){if(ot(this,Pt),!Array.isArray(Re)||0===Re.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=Te,this.isExterior=Se,this.segments=[],"number"!=typeof Re[0][0]||"number"!=typeof Re[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var et=_e.round(Re[0][0],Re[0][1]);this.bbox={ll:{x:et.x,y:et.y},ur:{x:et.x,y:et.y}};for(var Ct=et,Yt=1,yn=Re.length;Yt<yn;Yt++){if("number"!=typeof Re[Yt][0]||"number"!=typeof Re[Yt][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var _n=_e.round(Re[Yt][0],Re[Yt][1]);_n.x===Ct.x&&_n.y===Ct.y||(this.segments.push(Tt.fromRing(Ct,_n,this)),_n.x<this.bbox.ll.x&&(this.bbox.ll.x=_n.x),_n.y<this.bbox.ll.y&&(this.bbox.ll.y=_n.y),_n.x>this.bbox.ur.x&&(this.bbox.ur.x=_n.x),_n.y>this.bbox.ur.y&&(this.bbox.ur.y=_n.y),Ct=_n)}(et.x!==Ct.x||et.y!==Ct.y)&&this.segments.push(Tt.fromRing(Ct,et,this))}return me(Pt,[{key:"getSweepEvents",value:function(){for(var Te=[],Se=0,et=this.segments.length;Se<et;Se++){var Ct=this.segments[Se];Te.push(Ct.leftSE),Te.push(Ct.rightSE)}return Te}}]),Pt}(),Xt=function(){function Pt(Re,Te){if(ot(this,Pt),!Array.isArray(Re))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Be(Re[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var Se=1,et=Re.length;Se<et;Se++){var Ct=new Be(Re[Se],this,!1);Ct.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Ct.bbox.ll.x),Ct.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Ct.bbox.ll.y),Ct.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Ct.bbox.ur.x),Ct.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Ct.bbox.ur.y),this.interiorRings.push(Ct)}this.multiPoly=Te}return me(Pt,[{key:"getSweepEvents",value:function(){for(var Te=this.exteriorRing.getSweepEvents(),Se=0,et=this.interiorRings.length;Se<et;Se++)for(var Ct=this.interiorRings[Se].getSweepEvents(),Yt=0,yn=Ct.length;Yt<yn;Yt++)Te.push(Ct[Yt]);return Te}}]),Pt}(),Jt=function(){function Pt(Re,Te){if(ot(this,Pt),!Array.isArray(Re))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof Re[0][0][0]&&(Re=[Re])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var Se=0,et=Re.length;Se<et;Se++){var Ct=new Xt(Re[Se],this);Ct.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Ct.bbox.ll.x),Ct.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Ct.bbox.ll.y),Ct.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Ct.bbox.ur.x),Ct.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Ct.bbox.ur.y),this.polys.push(Ct)}this.isSubject=Te}return me(Pt,[{key:"getSweepEvents",value:function(){for(var Te=[],Se=0,et=this.polys.length;Se<et;Se++)for(var Ct=this.polys[Se].getSweepEvents(),Yt=0,yn=Ct.length;Yt<yn;Yt++)Te.push(Ct[Yt]);return Te}}]),Pt}(),Rn=function(){function Pt(Re){ot(this,Pt),this.events=Re;for(var Te=0,Se=Re.length;Te<Se;Te++)Re[Te].segment.ringOut=this;this.poly=null}return me(Pt,null,[{key:"factory",value:function(Te){for(var Se=[],et=0,Ct=Te.length;et<Ct;et++){var Yt=Te[et];if(Yt.isInResult()&&!Yt.ringOut){for(var yn=null,_n=Yt.leftSE,en=Yt.rightSE,Dr=[_n],Pr=_n.point,zn=[];yn=_n,Dr.push(_n=en),_n.point!==Pr;)for(;;){var Gr=_n.getAvailableLinkedEvents();if(0===Gr.length){var Pi=Dr[0].point,ni=Dr[Dr.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(Pi.x,",")+" ".concat(Pi.y,"]. Last matching segment found ends at")+" [".concat(ni.x,", ").concat(ni.y,"]."))}if(1===Gr.length){en=Gr[0].otherSE;break}for(var Ci=null,Ki=0,ts=zn.length;Ki<ts;Ki++)if(zn[Ki].point===_n.point){Ci=Ki;break}if(null===Ci){zn.push({index:Dr.length,point:_n.point});var xe=_n.getLeftmostComparator(yn);en=Gr.sort(xe)[0].otherSE;break}var Hs=zn.splice(Ci)[0],rt=Dr.splice(Hs.index);rt.unshift(rt[0].otherSE),Se.push(new Pt(rt.reverse()))}Se.push(new Pt(Dr))}}return Se}}]),me(Pt,[{key:"getGeom",value:function(){for(var Te=this.events[0].point,Se=[Te],et=1,Ct=this.events.length-1;et<Ct;et++){var Yt=this.events[et].point;0!==He(Yt,Te,this.events[et+1].point)&&(Se.push(Yt),Te=Yt)}if(1===Se.length)return null;0===He(Se[0],Te,Se[1])&&Se.shift(),Se.push(Se[0]);for(var Dr=this.isExteriorRing()?1:-1,Pr=this.isExteriorRing()?0:Se.length-1,zn=this.isExteriorRing()?Se.length:-1,Gr=[],Pi=Pr;Pi!=zn;Pi+=Dr)Gr.push([Se[Pi].x,Se[Pi].y]);return Gr}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var Te=this.enclosingRing();this._isExteriorRing=!Te||!Te.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var Te=this.events[0],Se=1,et=this.events.length;Se<et;Se++){var Ct=this.events[Se];Ue.compare(Te,Ct)>0&&(Te=Ct)}for(var Yt=Te.segment.prevInResult(),yn=Yt?Yt.prevInResult():null;;){if(!Yt)return null;if(!yn)return Yt.ringOut;if(yn.ringOut!==Yt.ringOut)return yn.ringOut.enclosingRing()!==Yt.ringOut?Yt.ringOut:Yt.ringOut.enclosingRing();Yt=yn.prevInResult(),yn=Yt?Yt.prevInResult():null}}}]),Pt}(),zt=function(){function Pt(Re){ot(this,Pt),this.exteriorRing=Re,Re.poly=this,this.interiorRings=[]}return me(Pt,[{key:"addInterior",value:function(Te){this.interiorRings.push(Te),Te.poly=this}},{key:"getGeom",value:function(){var Te=[this.exteriorRing.getGeom()];if(null===Te[0])return null;for(var Se=0,et=this.interiorRings.length;Se<et;Se++){var Ct=this.interiorRings[Se].getGeom();null!==Ct&&Te.push(Ct)}return Te}}]),Pt}(),Jn=function(){function Pt(Re){ot(this,Pt),this.rings=Re,this.polys=this._composePolys(Re)}return me(Pt,[{key:"getGeom",value:function(){for(var Te=[],Se=0,et=this.polys.length;Se<et;Se++){var Ct=this.polys[Se].getGeom();null!==Ct&&Te.push(Ct)}return Te}},{key:"_composePolys",value:function(Te){for(var Se=[],et=0,Ct=Te.length;et<Ct;et++){var Yt=Te[et];if(!Yt.poly)if(Yt.isExteriorRing())Se.push(new zt(Yt));else{var yn=Yt.enclosingRing();yn.poly||Se.push(new zt(yn)),yn.poly.addInterior(Yt)}}return Se}}]),Pt}(),Mn=function(){function Pt(Re){var Te=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Tt.compare;ot(this,Pt),this.queue=Re,this.tree=new qe(Te),this.segments=[]}return me(Pt,[{key:"process",value:function(Te){var Se=Te.segment,et=[];if(Te.consumedBy)return Te.isLeft?this.queue.remove(Te.otherSE):this.tree.remove(Se),et;var Ct=Te.isLeft?this.tree.insert(Se):this.tree.find(Se);if(!Ct)throw new Error("Unable to find segment #".concat(Se.id," ")+"[".concat(Se.leftSE.point.x,", ").concat(Se.leftSE.point.y,"] -> ")+"[".concat(Se.rightSE.point.x,", ").concat(Se.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var Yt=Ct,yn=Ct,_n=void 0,en=void 0;void 0===_n;)null===(Yt=this.tree.prev(Yt))?_n=null:void 0===Yt.key.consumedBy&&(_n=Yt.key);for(;void 0===en;)null===(yn=this.tree.next(yn))?en=null:void 0===yn.key.consumedBy&&(en=yn.key);if(Te.isLeft){var Dr=null;if(_n){var Pr=_n.getIntersection(Se);if(null!==Pr&&(Se.isAnEndpoint(Pr)||(Dr=Pr),!_n.isAnEndpoint(Pr)))for(var zn=this._splitSafely(_n,Pr),Gr=0,Pi=zn.length;Gr<Pi;Gr++)et.push(zn[Gr])}var ni=null;if(en){var Ci=en.getIntersection(Se);if(null!==Ci&&(Se.isAnEndpoint(Ci)||(ni=Ci),!en.isAnEndpoint(Ci)))for(var Ki=this._splitSafely(en,Ci),ts=0,Hs=Ki.length;ts<Hs;ts++)et.push(Ki[ts])}if(null!==Dr||null!==ni){var rt;rt=null===Dr?ni:null===ni||Ue.comparePoints(Dr,ni)<=0?Dr:ni,this.queue.remove(Se.rightSE),et.push(Se.rightSE);for(var be=Se.split(rt),tt=0,ct=be.length;tt<ct;tt++)et.push(be[tt])}et.length>0?(this.tree.remove(Se),et.push(Te)):(this.segments.push(Se),Se.prev=_n)}else{if(_n&&en){var Ze=_n.getIntersection(en);if(null!==Ze){if(!_n.isAnEndpoint(Ze))for(var Ft=this._splitSafely(_n,Ze),Nt=0,lt=Ft.length;Nt<lt;Nt++)et.push(Ft[Nt]);if(!en.isAnEndpoint(Ze))for(var Zt=this._splitSafely(en,Ze),Cn=0,Bn=Zt.length;Cn<Bn;Cn++)et.push(Zt[Cn])}}this.tree.remove(Se)}return et}},{key:"_splitSafely",value:function(Te,Se){this.tree.remove(Te);var et=Te.rightSE;this.queue.remove(et);var Ct=Te.split(Se);return Ct.push(et),void 0===Te.consumedBy&&this.tree.insert(Te),Ct}}]),Pt}(),jn=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,xn=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,wn=new(function(){function Pt(){ot(this,Pt)}return me(Pt,[{key:"run",value:function(Te,Se,et){wn.type=Te,_e.reset();for(var Ct=[new Jt(Se,!0)],Yt=0,yn=et.length;Yt<yn;Yt++)Ct.push(new Jt(et[Yt],!1));if(wn.numMultiPolys=Ct.length,"difference"===wn.type)for(var _n=Ct[0],en=1;en<Ct.length;)null!==ne(Ct[en].bbox,_n.bbox)?en++:Ct.splice(en,1);if("intersection"===wn.type)for(var Dr=0,Pr=Ct.length;Dr<Pr;Dr++)for(var zn=Ct[Dr],Gr=Dr+1,Pi=Ct.length;Gr<Pi;Gr++)if(null===ne(zn.bbox,Ct[Gr].bbox))return[];for(var ni=new qe(Ue.compare),Ci=0,Ki=Ct.length;Ci<Ki;Ci++)for(var ts=Ct[Ci].getSweepEvents(),Hs=0,rt=ts.length;Hs<rt;Hs++)if(ni.insert(ts[Hs]),ni.size>jn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var xe=new Mn(ni),be=ni.size,tt=ni.pop();tt;){var ct=tt.key;if(ni.size===be){var Ze=ct.segment;throw new Error("Unable to pop() ".concat(ct.isLeft?"left":"right"," SweepEvent ")+"[".concat(ct.point.x,", ").concat(ct.point.y,"] from segment #").concat(Ze.id," ")+"[".concat(Ze.leftSE.point.x,", ").concat(Ze.leftSE.point.y,"] -> ")+"[".concat(Ze.rightSE.point.x,", ").concat(Ze.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(ni.size>jn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(xe.segments.length>xn)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var Ft=xe.process(ct),Nt=0,lt=Ft.length;Nt<lt;Nt++){var Zt=Ft[Nt];void 0===Zt.consumedBy&&ni.insert(Zt)}be=ni.size,tt=ni.pop()}_e.reset();var Cn=Rn.factory(xe.segments);return new Jn(Cn).getGeom()}}]),Pt}());return{union:function(Re){for(var Te=arguments.length,Se=new Array(Te>1?Te-1:0),et=1;et<Te;et++)Se[et-1]=arguments[et];return wn.run("union",Re,Se)},intersection:function(Re){for(var Te=arguments.length,Se=new Array(Te>1?Te-1:0),et=1;et<Te;et++)Se[et-1]=arguments[et];return wn.run("intersection",Re,Se)},xor:function(Re){for(var Te=arguments.length,Se=new Array(Te>1?Te-1:0),et=1;et<Te;et++)Se[et-1]=arguments[et];return wn.run("xor",Re,Se)},difference:function(Re){for(var Te=arguments.length,Se=new Array(Te>1?Te-1:0),et=1;et<Te;et++)Se[et-1]=arguments[et];return wn.run("difference",Re,Se)}}}()},3544:(Dt,ot,ve)=>{"use strict";Dt.exports=q,Dt.exports.default=q;var me=ve(6709);function q(ne,ce){if(!(this instanceof q))return new q(ne,ce);this._maxEntries=Math.max(4,ne||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),ce&&this._initFormat(ce),this.clear()}function Ee(ne,ce,ee){if(!ee)return ce.indexOf(ne);for(var ae=0;ae<ce.length;ae++)if(ee(ne,ce[ae]))return ae;return-1}function p(ne,ce){J(ne,0,ne.children.length,ce,ne)}function J(ne,ce,ee,ae,oe){oe||(oe=le(null)),oe.minX=1/0,oe.minY=1/0,oe.maxX=-1/0,oe.maxY=-1/0;for(var _e,te=ce;te<ee;te++)_e=ne.children[te],ye(oe,ne.leaf?ae(_e):_e);return oe}function ye(ne,ce){return ne.minX=Math.min(ne.minX,ce.minX),ne.minY=Math.min(ne.minY,ce.minY),ne.maxX=Math.max(ne.maxX,ce.maxX),ne.maxY=Math.max(ne.maxY,ce.maxY),ne}function Ce(ne,ce){return ne.minX-ce.minX}function Pe(ne,ce){return ne.minY-ce.minY}function qe(ne){return(ne.maxX-ne.minX)*(ne.maxY-ne.minY)}function It(ne){return ne.maxX-ne.minX+(ne.maxY-ne.minY)}function gt(ne,ce){return(Math.max(ce.maxX,ne.maxX)-Math.min(ce.minX,ne.minX))*(Math.max(ce.maxY,ne.maxY)-Math.min(ce.minY,ne.minY))}function st(ne,ce){var ee=Math.max(ne.minX,ce.minX),ae=Math.max(ne.minY,ce.minY),oe=Math.min(ne.maxX,ce.maxX),te=Math.min(ne.maxY,ce.maxY);return Math.max(0,oe-ee)*Math.max(0,te-ae)}function mt(ne,ce){return ne.minX<=ce.minX&&ne.minY<=ce.minY&&ce.maxX<=ne.maxX&&ce.maxY<=ne.maxY}function Mt(ne,ce){return ce.minX<=ne.maxX&&ce.minY<=ne.maxY&&ce.maxX>=ne.minX&&ce.maxY>=ne.minY}function le(ne){return{children:ne,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function K(ne,ce,ee,ae,oe){for(var _e,te=[ce,ee];te.length;)!((ee=te.pop())-(ce=te.pop())<=ae)&&(_e=ce+Math.ceil((ee-ce)/ae/2)*ae,me(ne,_e,ce,ee,oe),te.push(ce,_e,_e,ee))}q.prototype={all:function(){return this._all(this.data,[])},search:function(ne){var ce=this.data,ee=[],ae=this.toBBox;if(!Mt(ne,ce))return ee;for(var te,_e,re,Je,oe=[];ce;){for(te=0,_e=ce.children.length;te<_e;te++)re=ce.children[te],Mt(ne,Je=ce.leaf?ae(re):re)&&(ce.leaf?ee.push(re):mt(ne,Je)?this._all(re,ee):oe.push(re));ce=oe.pop()}return ee},collides:function(ne){var ce=this.data,ee=this.toBBox;if(!Mt(ne,ce))return!1;for(var oe,te,_e,re,ae=[];ce;){for(oe=0,te=ce.children.length;oe<te;oe++)if(_e=ce.children[oe],Mt(ne,re=ce.leaf?ee(_e):_e)){if(ce.leaf||mt(ne,re))return!0;ae.push(_e)}ce=ae.pop()}return!1},load:function(ne){if(!ne||!ne.length)return this;if(ne.length<this._minEntries){for(var ce=0,ee=ne.length;ce<ee;ce++)this.insert(ne[ce]);return this}var ae=this._build(ne.slice(),0,ne.length-1,0);if(this.data.children.length)if(this.data.height===ae.height)this._splitRoot(this.data,ae);else{if(this.data.height<ae.height){var oe=this.data;this.data=ae,ae=oe}this._insert(ae,this.data.height-ae.height-1,!0)}else this.data=ae;return this},insert:function(ne){return ne&&this._insert(ne,this.data.height-1),this},clear:function(){return this.data=le([]),this},remove:function(ne,ce){if(!ne)return this;for(var _e,re,Je,He,ee=this.data,ae=this.toBBox(ne),oe=[],te=[];ee||oe.length;){if(ee||(ee=oe.pop(),re=oe[oe.length-1],_e=te.pop(),He=!0),ee.leaf&&-1!==(Je=Ee(ne,ee.children,ce)))return ee.children.splice(Je,1),oe.push(ee),this._condense(oe),this;He||ee.leaf||!mt(ee,ae)?re?(_e++,ee=re.children[_e],He=!1):ee=null:(oe.push(ee),te.push(_e),_e=0,re=ee,ee=ee.children[0])}return this},toBBox:function(ne){return ne},compareMinX:Ce,compareMinY:Pe,toJSON:function(){return this.data},fromJSON:function(ne){return this.data=ne,this},_all:function(ne,ce){for(var ee=[];ne;)ne.leaf?ce.push.apply(ce,ne.children):ee.push.apply(ee,ne.children),ne=ee.pop();return ce},_build:function(ne,ce,ee,ae){var _e,oe=ee-ce+1,te=this._maxEntries;if(oe<=te)return p(_e=le(ne.slice(ce,ee+1)),this.toBBox),_e;ae||(ae=Math.ceil(Math.log(oe)/Math.log(te)),te=Math.ceil(oe/Math.pow(te,ae-1))),(_e=le([])).leaf=!1,_e.height=ae;var He,it,Ne,sn,re=Math.ceil(oe/te),Je=re*Math.ceil(Math.sqrt(te));for(K(ne,ce,ee,Je,this.compareMinX),He=ce;He<=ee;He+=Je)for(K(ne,He,Ne=Math.min(He+Je-1,ee),re,this.compareMinY),it=He;it<=Ne;it+=re)sn=Math.min(it+re-1,Ne),_e.children.push(this._build(ne,it,sn,ae-1));return p(_e,this.toBBox),_e},_chooseSubtree:function(ne,ce,ee,ae){for(var oe,te,_e,re,Je,He,it,Ne;ae.push(ce),!ce.leaf&&ae.length-1!==ee;){for(it=Ne=1/0,oe=0,te=ce.children.length;oe<te;oe++)Je=qe(_e=ce.children[oe]),(He=gt(ne,_e)-Je)<Ne?(Ne=He,it=Je<it?Je:it,re=_e):He===Ne&&Je<it&&(it=Je,re=_e);ce=re||ce.children[0]}return ce},_insert:function(ne,ce,ee){var oe=ee?ne:(0,this.toBBox)(ne),te=[],_e=this._chooseSubtree(oe,this.data,ce,te);for(_e.children.push(ne),ye(_e,oe);ce>=0&&te[ce].children.length>this._maxEntries;)this._split(te,ce),ce--;this._adjustParentBBoxes(oe,te,ce)},_split:function(ne,ce){var ee=ne[ce],ae=ee.children.length,oe=this._minEntries;this._chooseSplitAxis(ee,oe,ae);var te=this._chooseSplitIndex(ee,oe,ae),_e=le(ee.children.splice(te,ee.children.length-te));_e.height=ee.height,_e.leaf=ee.leaf,p(ee,this.toBBox),p(_e,this.toBBox),ce?ne[ce-1].children.push(_e):this._splitRoot(ee,_e)},_splitRoot:function(ne,ce){this.data=le([ne,ce]),this.data.height=ne.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},_chooseSplitIndex:function(ne,ce,ee){var ae,oe,te,_e,re,Je,He,it;for(Je=He=1/0,ae=ce;ae<=ee-ce;ae++)_e=st(oe=J(ne,0,ae,this.toBBox),te=J(ne,ae,ee,this.toBBox)),re=qe(oe)+qe(te),_e<Je?(Je=_e,it=ae,He=re<He?re:He):_e===Je&&re<He&&(He=re,it=ae);return it},_chooseSplitAxis:function(ne,ce,ee){var ae=ne.leaf?this.compareMinX:Ce,oe=ne.leaf?this.compareMinY:Pe;this._allDistMargin(ne,ce,ee,ae)<this._allDistMargin(ne,ce,ee,oe)&&ne.children.sort(ae)},_allDistMargin:function(ne,ce,ee,ae){ne.children.sort(ae);var Je,He,oe=this.toBBox,te=J(ne,0,ce,oe),_e=J(ne,ee-ce,ee,oe),re=It(te)+It(_e);for(Je=ce;Je<ee-ce;Je++)He=ne.children[Je],ye(te,ne.leaf?oe(He):He),re+=It(te);for(Je=ee-ce-1;Je>=ce;Je--)He=ne.children[Je],ye(_e,ne.leaf?oe(He):He),re+=It(_e);return re},_adjustParentBBoxes:function(ne,ce,ee){for(var ae=ee;ae>=0;ae--)ye(ce[ae],ne)},_condense:function(ne){for(var ee,ce=ne.length-1;ce>=0;ce--)0===ne[ce].children.length?ce>0?(ee=ne[ce-1].children).splice(ee.indexOf(ne[ce]),1):this.clear():p(ne[ce],this.toBBox)},_initFormat:function(ne){var ce=["return a"," - b",";"];this.compareMinX=new Function("a","b",ce.join(ne[0])),this.compareMinY=new Function("a","b",ce.join(ne[1])),this.toBBox=new Function("a","return {minX: a"+ne[0]+", minY: a"+ne[1]+", maxX: a"+ne[2]+", maxY: a"+ne[3]+"};")}}},6709:function(Dt){Dt.exports=function(){"use strict";function ve(Ee,p,J,ye,Ce){for(;ye>J;){if(ye-J>600){var Pe=ye-J+1,qe=p-J+1,It=Math.log(Pe),gt=.5*Math.exp(2*It/3),st=.5*Math.sqrt(It*gt*(Pe-gt)/Pe)*(qe-Pe/2<0?-1:1);ve(Ee,p,Math.max(J,Math.floor(p-qe*gt/Pe+st)),Math.min(ye,Math.floor(p+(Pe-qe)*gt/Pe+st)),Ce)}var le=Ee[p],K=J,ne=ye;for(me(Ee,J,p),Ce(Ee[ye],le)>0&&me(Ee,J,ye);K<ne;){for(me(Ee,K,ne),K++,ne--;Ce(Ee[K],le)<0;)K++;for(;Ce(Ee[ne],le)>0;)ne--}0===Ce(Ee[J],le)?me(Ee,J,ne):me(Ee,++ne,ye),ne<=p&&(J=ne+1),p<=ne&&(ye=ne-1)}}function me(Ee,p,J){var ye=Ee[p];Ee[p]=Ee[J],Ee[J]=ye}function q(Ee,p){return Ee<p?-1:Ee>p?1:0}return function ot(Ee,p,J,ye,Ce){ve(Ee,p,J||0,ye||Ee.length-1,Ce||q)}}()},4468:(Dt,ot,ve)=>{"use strict";var me=ve(9582).functionsHaveConfigurableNames(),q=Object,Ee=TypeError;Dt.exports=function(){if(null!=this&&this!==q(this))throw new Ee("RegExp.prototype.flags getter called on non-object");var J="";return this.hasIndices&&(J+="d"),this.global&&(J+="g"),this.ignoreCase&&(J+="i"),this.multiline&&(J+="m"),this.dotAll&&(J+="s"),this.unicode&&(J+="u"),this.unicodeSets&&(J+="v"),this.sticky&&(J+="y"),J},me&&Object.defineProperty&&Object.defineProperty(Dt.exports,"name",{value:"get flags"})},9235:(Dt,ot,ve)=>{"use strict";var me=ve(2358),q=ve(5685),Ee=ve(4468),p=ve(6343),J=ve(1956),ye=q(p());me(ye,{getPolyfill:p,implementation:Ee,shim:J}),Dt.exports=ye},6343:(Dt,ot,ve)=>{"use strict";var me=ve(4468),q=ve(2358).supportsDescriptors,Ee=Object.getOwnPropertyDescriptor;Dt.exports=function(){if(q&&"gim"===/a/gim.flags){var J=Ee(RegExp.prototype,"flags");if(J&&"function"==typeof J.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var ye="",Ce={};if(Object.defineProperty(Ce,"hasIndices",{get:function(){ye+="d"}}),Object.defineProperty(Ce,"sticky",{get:function(){ye+="y"}}),"dy"===ye)return J.get}}return me}},1956:(Dt,ot,ve)=>{"use strict";var me=ve(2358).supportsDescriptors,q=ve(6343),Ee=Object.getOwnPropertyDescriptor,p=Object.defineProperty,J=TypeError,ye=Object.getPrototypeOf,Ce=/a/;Dt.exports=function(){if(!me||!ye)throw new J("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var qe=q(),It=ye(Ce),gt=Ee(It,"flags");return(!gt||gt.get!==qe)&&p(It,"flags",{configurable:!0,enumerable:!1,get:qe}),qe}},7563:function(Dt,ot){!function(ve){"use strict";function Ee(mt,Mt,le,K,ne){let ce,ee,ae,oe,te=Mt[0],_e=K[0],re=0,Je=0;_e>te==_e>-te?(ce=te,te=Mt[++re]):(ce=_e,_e=K[++Je]);let He=0;if(re<mt&&Je<le)for(_e>te==_e>-te?(ae=ce-((ee=te+ce)-te),te=Mt[++re]):(ae=ce-((ee=_e+ce)-_e),_e=K[++Je]),ce=ee,0!==ae&&(ne[He++]=ae);re<mt&&Je<le;)_e>te==_e>-te?(ae=ce-((ee=ce+te)-(oe=ee-ce))+(te-oe),te=Mt[++re]):(ae=ce-((ee=ce+_e)-(oe=ee-ce))+(_e-oe),_e=K[++Je]),ce=ee,0!==ae&&(ne[He++]=ae);for(;re<mt;)ae=ce-((ee=ce+te)-(oe=ee-ce))+(te-oe),te=Mt[++re],ce=ee,0!==ae&&(ne[He++]=ae);for(;Je<le;)ae=ce-((ee=ce+_e)-(oe=ee-ce))+(_e-oe),_e=K[++Je],ce=ee,0!==ae&&(ne[He++]=ae);return 0===ce&&0!==He||(ne[He++]=ce),He}function p(mt){return new Float64Array(mt)}const Pe=p(4),qe=p(8),It=p(12),gt=p(16),st=p(4);ve.orient2d=function(mt,Mt,le,K,ne,ce){const ee=(Mt-ce)*(le-ne),ae=(mt-ne)*(K-ce),oe=ee-ae;if(0===ee||0===ae||ee>0!=ae>0)return oe;const te=Math.abs(ee+ae);return Math.abs(oe)>=33306690738754716e-32*te?oe:-function(_e,re,Je,He,it,Ne,sn){let Bt,Le,bt,Ue,ft,Tt,Be,Xt,Jt,Rn,zt,Jn,Mn,jn,xn,Nn,wn,Wi;const Sr=_e-it,Oi=Je-it,ar=re-Ne,mr=He-Ne;ft=(xn=(Xt=Sr-(Be=(Tt=134217729*Sr)-(Tt-Sr)))*(Rn=mr-(Jt=(Tt=134217729*mr)-(Tt-mr)))-((jn=Sr*mr)-Be*Jt-Xt*Jt-Be*Rn))-(zt=xn-(wn=(Xt=ar-(Be=(Tt=134217729*ar)-(Tt-ar)))*(Rn=Oi-(Jt=(Tt=134217729*Oi)-(Tt-Oi)))-((Nn=ar*Oi)-Be*Jt-Xt*Jt-Be*Rn))),Pe[0]=xn-(zt+ft)+(ft-wn),ft=(Mn=jn-((Jn=jn+zt)-(ft=Jn-jn))+(zt-ft))-(zt=Mn-Nn),Pe[1]=Mn-(zt+ft)+(ft-Nn),ft=(Wi=Jn+zt)-Jn,Pe[2]=Jn-(Wi-ft)+(zt-ft),Pe[3]=Wi;let Pt=function(Ct,Yt){let yn=Yt[0];for(let _n=1;_n<4;_n++)yn+=Yt[_n];return yn}(0,Pe),Re=22204460492503146e-32*sn;if(Pt>=Re||-Pt>=Re||(Bt=_e-(Sr+(ft=_e-Sr))+(ft-it),bt=Je-(Oi+(ft=Je-Oi))+(ft-it),Le=re-(ar+(ft=re-ar))+(ft-Ne),Ue=He-(mr+(ft=He-mr))+(ft-Ne),0===Bt&&0===Le&&0===bt&&0===Ue)||(Re=11093356479670487e-47*sn+33306690738754706e-32*Math.abs(Pt),(Pt+=Sr*Ue+mr*Bt-(ar*bt+Oi*Le))>=Re||-Pt>=Re))return Pt;ft=(xn=(Xt=Bt-(Be=(Tt=134217729*Bt)-(Tt-Bt)))*(Rn=mr-(Jt=(Tt=134217729*mr)-(Tt-mr)))-((jn=Bt*mr)-Be*Jt-Xt*Jt-Be*Rn))-(zt=xn-(wn=(Xt=Le-(Be=(Tt=134217729*Le)-(Tt-Le)))*(Rn=Oi-(Jt=(Tt=134217729*Oi)-(Tt-Oi)))-((Nn=Le*Oi)-Be*Jt-Xt*Jt-Be*Rn))),st[0]=xn-(zt+ft)+(ft-wn),ft=(Mn=jn-((Jn=jn+zt)-(ft=Jn-jn))+(zt-ft))-(zt=Mn-Nn),st[1]=Mn-(zt+ft)+(ft-Nn),ft=(Wi=Jn+zt)-Jn,st[2]=Jn-(Wi-ft)+(zt-ft),st[3]=Wi;const Te=Ee(4,Pe,4,st,qe);ft=(xn=(Xt=Sr-(Be=(Tt=134217729*Sr)-(Tt-Sr)))*(Rn=Ue-(Jt=(Tt=134217729*Ue)-(Tt-Ue)))-((jn=Sr*Ue)-Be*Jt-Xt*Jt-Be*Rn))-(zt=xn-(wn=(Xt=ar-(Be=(Tt=134217729*ar)-(Tt-ar)))*(Rn=bt-(Jt=(Tt=134217729*bt)-(Tt-bt)))-((Nn=ar*bt)-Be*Jt-Xt*Jt-Be*Rn))),st[0]=xn-(zt+ft)+(ft-wn),ft=(Mn=jn-((Jn=jn+zt)-(ft=Jn-jn))+(zt-ft))-(zt=Mn-Nn),st[1]=Mn-(zt+ft)+(ft-Nn),ft=(Wi=Jn+zt)-Jn,st[2]=Jn-(Wi-ft)+(zt-ft),st[3]=Wi;const Se=Ee(Te,qe,4,st,It);ft=(xn=(Xt=Bt-(Be=(Tt=134217729*Bt)-(Tt-Bt)))*(Rn=Ue-(Jt=(Tt=134217729*Ue)-(Tt-Ue)))-((jn=Bt*Ue)-Be*Jt-Xt*Jt-Be*Rn))-(zt=xn-(wn=(Xt=Le-(Be=(Tt=134217729*Le)-(Tt-Le)))*(Rn=bt-(Jt=(Tt=134217729*bt)-(Tt-bt)))-((Nn=Le*bt)-Be*Jt-Xt*Jt-Be*Rn))),st[0]=xn-(zt+ft)+(ft-wn),ft=(Mn=jn-((Jn=jn+zt)-(ft=Jn-jn))+(zt-ft))-(zt=Mn-Nn),st[1]=Mn-(zt+ft)+(ft-Nn),ft=(Wi=Jn+zt)-Jn,st[2]=Jn-(Wi-ft)+(zt-ft),st[3]=Wi;const et=Ee(Se,It,4,st,gt);return gt[et-1]}(mt,Mt,le,K,ne,ce,te)},ve.orient2dfast=function(mt,Mt,le,K,ne,ce){return(Mt-ce)*(le-ne)-(mt-ne)*(K-ce)},Object.defineProperty(ve,"__esModule",{value:!0})}(ot)},9231:Dt=>{"use strict";Dt.exports={eudist:function(ve,me,q){for(var Ee=ve.length,p=0,J=0;J<Ee;J++){var ye=(ve[J]||0)-(me[J]||0);p+=ye*ye}return q?Math.sqrt(p):p},mandist:function(ve,me,q){for(var Ee=ve.length,p=0,J=0;J<Ee;J++)p+=Math.abs((ve[J]||0)-(me[J]||0));return q?Math.sqrt(p):p},dist:function(ve,me,q){var Ee=Math.abs(ve-me);return q?Ee:Ee*Ee}}},5561:(Dt,ot,ve)=>{"use strict";var me=ve(9231),q=me.eudist,Ee=me.dist;Dt.exports={kmrand:function(J,ye){for(var Ce={},Pe=[],qe=ye<<2,It=J.length,gt=J[0].length>0;Pe.length<ye&&qe-- >0;){var st=J[Math.floor(Math.random()*It)],mt=gt?st.join("_"):""+st;Ce[mt]||(Ce[mt]=!0,Pe.push(st))}if(Pe.length<ye)throw new Error("Error initializating clusters");return Pe},kmpp:function(J,ye){var Ce=J[0].length?q:Ee,Pe=[],qe=J.length,It=J[0].length>0,st=J[Math.floor(Math.random()*qe)];for(It&&st.join("_"),Pe.push(st);Pe.length<ye;){for(var Mt=[],le=Pe.length,K=0,ne=[],ce=0;ce<qe;ce++){for(var ee=1/0,ae=0;ae<le;ae++){var oe=Ce(J[ce],Pe[ae]);oe<=ee&&(ee=oe)}Mt[ce]=ee}for(var te=0;te<qe;te++)K+=Mt[te];for(var _e=0;_e<qe;_e++)ne[_e]={i:_e,v:J[_e],pr:Mt[_e]/K,cs:0};ne.sort(function(it,Ne){return it.pr-Ne.pr}),ne[0].cs=ne[0].pr;for(var re=1;re<qe;re++)ne[re].cs=ne[re-1].cs+ne[re].pr;for(var Je=Math.random(),He=0;He<qe-1&&ne[He++].cs<Je;);Pe.push(ne[He-1].v)}return Pe}}},9475:(Dt,ot,ve)=>{"use strict";var me=ve(9231),q=ve(5561),Ee=me.eudist,ye=q.kmrand,Ce=q.kmpp;function qe(gt,st,mt){mt=mt||[];for(var Mt=0;Mt<gt;Mt++)mt[Mt]=st;return mt}Dt.exports=function It(gt,st,mt,Mt){var le=[],K=[],ne=[],ce=[],ee=!1,ae=Mt||1e4,oe=gt.length,te=gt[0].length,_e=te>0,re=[];if(mt)le="kmrand"==mt?ye(gt,st):"kmpp"==mt?Ce(gt,st):mt;else for(var Je={};le.length<st;){var He=Math.floor(Math.random()*oe);Je[He]||(Je[He]=!0,le.push(gt[He]))}do{qe(st,0,re);for(var it=0;it<oe;it++){for(var Ne=1/0,sn=0,Bt=0;Bt<st;Bt++)(ce=_e?Ee(gt[it],le[Bt]):Math.abs(gt[it]-le[Bt]))<=Ne&&(Ne=ce,sn=Bt);ne[it]=sn,re[sn]++}for(var Le=[],Ue=(K=[],0);Ue<st;Ue++)Le[Ue]=_e?qe(te,0,Le[Ue]):0,K[Ue]=le[Ue];if(_e){for(var ft=0;ft<st;ft++)le[ft]=[];for(var Tt=0;Tt<oe;Tt++)for(var Xt=Le[ne[Tt]],Jt=gt[Tt],Rn=0;Rn<te;Rn++)Xt[Rn]+=Jt[Rn];ee=!0;for(var zt=0;zt<st;zt++){for(var Jn=le[zt],Mn=Le[zt],jn=K[zt],xn=re[zt],Nn=0;Nn<te;Nn++)Jn[Nn]=Mn[Nn]/xn||0;if(ee)for(var wn=0;wn<te;wn++)if(jn[wn]!=Jn[wn]){ee=!1;break}}}else{for(var Wi=0;Wi<oe;Wi++)Le[ne[Wi]]+=gt[Wi];for(var Oi=0;Oi<st;Oi++)le[Oi]=Le[Oi]/re[Oi]||0;ee=!0;for(var ar=0;ar<st;ar++)if(K[ar]!=le[ar]){ee=!1;break}}ee=ee||--ae<=0}while(!ee);return{it:1e4-ae,k:st,idxs:ne,centroids:le}}},6775:function(Dt){var me;me=function(){var ot="",ve=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function me(ye){return ye.match(ve)||[]}function Ee(ye){return{language:(ye=me(ye))[1]||ot,extlang:ye[2]||ot,script:ye[3]||ot,region:ye[4]||ot}}function p(ye,Ce,Pe){Object.defineProperty(ye,Ce,{value:Pe,enumerable:!0})}function J(ye,Ce,Pe){function qe(It){return me(It)[ye]||ot}p(qe,"pattern",Ce),p(Ee,Pe,qe)}return J(1,/^[a-zA-Z]{2,3}$/,"language"),J(2,/^[a-zA-Z]{3}$/,"extlang"),J(3,/^[a-zA-Z]{4}$/,"script"),J(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),p(Ee,"split",function q(ye){return me(ye).filter(function(Ce,Pe){return Ce&&Pe})}),Ee},Dt.exports?Dt.exports=me():this.subtag=me()},5562:(Dt,ot,ve)=>{"use strict";var me=ve(8576);Dt.exports=me,typeof window<"u"&&(window.Suggestions=me)},7554:Dt=>{"use strict";var ot=function(ve){return this.component=ve,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,ve.el.parentNode.insertBefore(this.wrapper,ve.el.nextSibling),this};ot.prototype.show=function(){this.element.style.display="block"},ot.prototype.hide=function(){this.element.style.display="none"},ot.prototype.add=function(ve){this.items.push(ve)},ot.prototype.clear=function(){this.items=[],this.active=0},ot.prototype.isEmpty=function(){return!this.items.length},ot.prototype.isVisible=function(){return"block"===this.element.style.display},ot.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var ve=0;ve<this.items.length;ve++)this.drawItem(this.items[ve],this.active===ve);this.show()}else this.hide()},ot.prototype.drawItem=function(ve,me){var q=document.createElement("li"),Ee=document.createElement("a");me&&(q.className+=" active"),Ee.innerHTML=ve.string,q.appendChild(Ee),this.element.appendChild(q),q.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),q.addEventListener("mouseup",function(){this.handleMouseUp.call(this,ve)}.bind(this))},ot.prototype.handleMouseUp=function(ve){this.selectingListItem=!1,this.component.value(ve.original),this.clear(),this.draw()},ot.prototype.move=function(ve){this.active=ve,this.draw()},ot.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},ot.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},ot.prototype.drawError=function(ve){var me=document.createElement("li");me.innerHTML=ve,this.element.appendChild(me),this.show()},Dt.exports=ot},8576:(Dt,ot,ve)=>{"use strict";var me=ve(4703),q=ve(5780),Ee=ve(7554),p=function(J,ye,Ce){return this.options=me({minLength:2,limit:5,filter:!0,hideOnBlur:!0},Ce=Ce||{}),this.el=J,this.data=ye||[],this.list=new Ee(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(Pe){this.handleKeyUp(Pe.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(Pe){this.handleKeyDown(Pe)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(Pe){this.handlePaste(Pe)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};p.prototype.handleKeyUp=function(J){40===J||38===J||27===J||13===J||9===J||this.handleInputChange(this.el.value)},p.prototype.handleKeyDown=function(J){switch(J.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&J.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},p.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},p.prototype.handlePaste=function(J){if(J.clipboardData)this.handleInputChange(J.clipboardData.getData("Text"));else{var ye=this;setTimeout(function(){ye.handleInputChange(J.target.value)},100)}},p.prototype.handleInputChange=function(J){this.query=this.normalize(J),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(ye){for(var Ce=0;Ce<ye.length&&(this.list.add(ye[Ce]),Ce!==this.options.limit-1);Ce++);this.list.draw()}.bind(this))},p.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},p.prototype.update=function(J){this.data=J,this.handleKeyUp()},p.prototype.clear=function(){this.data=[],this.list.clear()},p.prototype.normalize=function(J){return J.toLowerCase()},p.prototype.match=function(J,ye){return J.indexOf(ye)>-1},p.prototype.value=function(J){if(this.selected=J,this.el.value=this.getItemValue(J),document.createEvent){var ye=document.createEvent("HTMLEvents");ye.initEvent("change",!0,!1),this.el.dispatchEvent(ye)}else this.el.fireEvent("onchange")},p.prototype.getCandidates=function(J){var ye={pre:"<strong>",post:"</strong>",extract:function(Pe){return this.getItemValue(Pe)}.bind(this)};J(this.options.filter?q.filter(this.query,this.data,ye).map(function(Pe){return{original:Pe.original,string:this.render(Pe.original,Pe.string)}}.bind(this)):this.data.map(function(Pe){return{original:Pe,string:this.render(Pe)}}.bind(this)))},p.prototype.getItemValue=function(J){return J},p.prototype.render=function(J,ye){if(ye)return ye;for(var Ce=this.getItemValue(J.original?J.original:J),Pe=this.normalize(Ce),qe=Pe.lastIndexOf(this.query);qe>-1;){var It=qe+this.query.length;Ce=Ce.slice(0,qe)+"<strong>"+Ce.slice(qe,It)+"</strong>"+Ce.slice(It),qe=Pe.slice(0,qe).lastIndexOf(this.query)}return Ce},p.prototype.renderError=function(J){this.list.drawError(J)},Dt.exports=p},7253:(Dt,ot,ve)=>{"use strict";ve.r(ot),ve.d(ot,{default:()=>me});class me{constructor(p=[],J=q){if(this.data=p,this.length=this.data.length,this.compare=J,this.length>0)for(let ye=(this.length>>1)-1;ye>=0;ye--)this._down(ye)}push(p){this.data.push(p),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const p=this.data[0],J=this.data.pop();return this.length--,this.length>0&&(this.data[0]=J,this._down(0)),p}peek(){return this.data[0]}_up(p){const{data:J,compare:ye}=this,Ce=J[p];for(;p>0;){const Pe=p-1>>1,qe=J[Pe];if(ye(Ce,qe)>=0)break;J[p]=qe,p=Pe}J[p]=Ce}_down(p){const{data:J,compare:ye}=this,Ce=this.length>>1,Pe=J[p];for(;p<Ce;){let qe=1+(p<<1),It=J[qe];const gt=qe+1;if(gt<this.length&&ye(J[gt],It)<0&&(qe=gt,It=J[gt]),ye(It,Pe)>=0)break;J[p]=It,p=qe}J[p]=Pe}}function q(Ee,p){return Ee<p?-1:Ee>p?1:0}},770:function(Dt,ot){!function(ve){"use strict";function me(){}function q(a){this.message=a||""}function Ee(a){this.message=a||""}function p(a){this.message=a||""}function J(){}function ye(a){return null===a?Cr:a.color}function Ce(a){return null===a?null:a.parent}function Pe(a,h){null!==a&&(a.color=h)}function qe(a){return null===a?null:a.left}function It(a){return null===a?null:a.right}function gt(){this.root_=null,this.size_=0}function st(){}function mt(){this.array_=[],arguments[0]instanceof be&&this.addAll(arguments[0])}function Mt(){}function le(a){this.message=a||""}function K(){this.array_=[]}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(a){if(null==this)throw new TypeError(this+" is not an object");var h=Object(this),y=Math.max(Math.min(h.length,9007199254740991),0)||0,x=1 in arguments&&parseInt(Number(arguments[1]),10)||0;x=x<0?Math.max(y+x,0):Math.min(x,y);var D=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:y;for(D=D<0?Math.max(y+arguments[2],0):Math.min(D,y);x<D;)h[x]=a,++x;return h},writable:!0}),Number.isFinite=Number.isFinite||function(a){return"number"==typeof a&&isFinite(a)},Number.isInteger=Number.isInteger||function(a){return"number"==typeof a&&isFinite(a)&&Math.floor(a)===a},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(a){return a!=a},Math.trunc=Math.trunc||function(a){return a<0?Math.ceil(a):Math.floor(a)};var ne=function(){};ne.prototype.interfaces_=function(){return[]},ne.prototype.getClass=function(){return ne},ne.prototype.equalsWithTolerance=function(a,h,y){return Math.abs(a-h)<=y};var ce=function(a){function h(y){a.call(this,y),this.name="IllegalArgumentException",this.message=y,this.stack=(new a).stack}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h}(Error),ee=function(){},ae={MAX_VALUE:{configurable:!0}};ee.isNaN=function(a){return Number.isNaN(a)},ee.doubleToLongBits=function(a){return a},ee.longBitsToDouble=function(a){return a},ee.isInfinite=function(a){return!Number.isFinite(a)},ae.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(ee,ae);var oe=function(){},te=function(){},_e=function(){},re=function a(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=a.NULL_ORDINATE;else if(1===arguments.length){var h=arguments[0];this.x=h.x,this.y=h.y,this.z=h.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=a.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},Je={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};re.prototype.setOrdinate=function(a,h){switch(a){case re.X:this.x=h;break;case re.Y:this.y=h;break;case re.Z:this.z=h;break;default:throw new ce("Invalid ordinate index: "+a)}},re.prototype.equals2D=function(){if(1===arguments.length){var a=arguments[0];return this.x===a.x&&this.y===a.y}if(2===arguments.length){var h=arguments[0],y=arguments[1];return!!ne.equalsWithTolerance(this.x,h.x,y)&&!!ne.equalsWithTolerance(this.y,h.y,y)}},re.prototype.getOrdinate=function(a){switch(a){case re.X:return this.x;case re.Y:return this.y;case re.Z:return this.z}throw new ce("Invalid ordinate index: "+a)},re.prototype.equals3D=function(a){return this.x===a.x&&this.y===a.y&&(this.z===a.z||ee.isNaN(this.z))&&ee.isNaN(a.z)},re.prototype.equals=function(a){return a instanceof re&&this.equals2D(a)},re.prototype.equalInZ=function(a,h){return ne.equalsWithTolerance(this.z,a.z,h)},re.prototype.compareTo=function(a){return this.x<a.x?-1:this.x>a.x?1:this.y<a.y?-1:this.y>a.y?1:0},re.prototype.clone=function(){},re.prototype.copy=function(){return new re(this)},re.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},re.prototype.distance3D=function(a){var h=this.x-a.x,y=this.y-a.y,x=this.z-a.z;return Math.sqrt(h*h+y*y+x*x)},re.prototype.distance=function(a){var h=this.x-a.x,y=this.y-a.y;return Math.sqrt(h*h+y*y)},re.prototype.hashCode=function(){var a=17;return 37*(a=37*a+re.hashCode(this.x))+re.hashCode(this.y)},re.prototype.setCoordinate=function(a){this.x=a.x,this.y=a.y,this.z=a.z},re.prototype.interfaces_=function(){return[oe,te,me]},re.prototype.getClass=function(){return re},re.hashCode=function(){if(1===arguments.length){var h=ee.doubleToLongBits(arguments[0]);return Math.trunc((h^h)>>>32)}},Je.DimensionalComparator.get=function(){return He},Je.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},Je.NULL_ORDINATE.get=function(){return ee.NaN},Je.X.get=function(){return 0},Je.Y.get=function(){return 1},Je.Z.get=function(){return 2},Object.defineProperties(re,Je);var He=function(a){if(this._dimensionsToTest=2,0!==arguments.length&&1===arguments.length){var h=arguments[0];if(2!==h&&3!==h)throw new ce("only 2 or 3 dimensions may be specified");this._dimensionsToTest=h}};He.prototype.compare=function(a,h){var y=a,x=h,D=He.compare(y.x,x.x);if(0!==D)return D;var U=He.compare(y.y,x.y);return 0!==U?U:this._dimensionsToTest<=2?0:He.compare(y.z,x.z)},He.prototype.interfaces_=function(){return[_e]},He.prototype.getClass=function(){return He},He.compare=function(a,h){return a<h?-1:a>h?1:ee.isNaN(a)?ee.isNaN(h)?0:-1:ee.isNaN(h)?1:0};var it=function(){};it.prototype.create=function(){},it.prototype.interfaces_=function(){return[]},it.prototype.getClass=function(){return it};var Ne=function(){},sn={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Ne.prototype.interfaces_=function(){return[]},Ne.prototype.getClass=function(){return Ne},Ne.toLocationSymbol=function(a){switch(a){case Ne.EXTERIOR:return"e";case Ne.BOUNDARY:return"b";case Ne.INTERIOR:return"i";case Ne.NONE:return"-"}throw new ce("Unknown location value: "+a)},sn.INTERIOR.get=function(){return 0},sn.BOUNDARY.get=function(){return 1},sn.EXTERIOR.get=function(){return 2},sn.NONE.get=function(){return-1},Object.defineProperties(Ne,sn);var Bt=function(a,h){return a.interfaces_&&a.interfaces_().indexOf(h)>-1},Le=function(){},bt={LOG_10:{configurable:!0}};Le.prototype.interfaces_=function(){return[]},Le.prototype.getClass=function(){return Le},Le.log10=function(a){var h=Math.log(a);return ee.isInfinite(h)||ee.isNaN(h)?h:h/Le.LOG_10},Le.min=function(a,h,y,x){var D=a;return h<D&&(D=h),y<D&&(D=y),x<D&&(D=x),D},Le.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var a=arguments[0],h=arguments[1],y=arguments[2];return a<h?h:a>y?y:a}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var x=arguments[0],D=arguments[1],U=arguments[2];return x<D?D:x>U?U:x}},Le.wrap=function(a,h){return a<0?h- -a%h:a%h},Le.max=function(){if(3===arguments.length){var h=arguments[1],y=arguments[2],x=arguments[0];return h>x&&(x=h),y>x&&(x=y),x}if(4===arguments.length){var U=arguments[1],H=arguments[2],pe=arguments[3],Ge=arguments[0];return U>Ge&&(Ge=U),H>Ge&&(Ge=H),pe>Ge&&(Ge=pe),Ge}},Le.average=function(a,h){return(a+h)/2},bt.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(Le,bt);var Ue=function(a){this.str=a};Ue.prototype.append=function(a){this.str+=a},Ue.prototype.setCharAt=function(a,h){this.str=this.str.substr(0,a)+h+this.str.substr(a+1)},Ue.prototype.toString=function(a){return this.str};var ft=function(a){this.value=a};ft.prototype.intValue=function(){return this.value},ft.prototype.compareTo=function(a){return this.value<a?-1:this.value>a?1:0},ft.isNaN=function(a){return Number.isNaN(a)};var Tt=function(){};Tt.isWhitespace=function(a){return a<=32&&a>=0||127===a},Tt.toUpperCase=function(a){return a.toUpperCase()};var Be=function a(){this._hi=0,this._lo=0,0===arguments.length?this.init(0):1===arguments.length?"number"==typeof arguments[0]||arguments[0]instanceof a?this.init(arguments[0]):"string"==typeof arguments[0]&&a.call(this,a.parse(arguments[0])):2===arguments.length&&this.init(arguments[0],arguments[1])},Xt={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Be.prototype.le=function(a){return(this._hi<a._hi||this._hi===a._hi)&&this._lo<=a._lo},Be.prototype.extractSignificantDigits=function(a,h){var y=this.abs(),x=Be.magnitude(y._hi),D=Be.TEN.pow(x);(y=y.divide(D)).gt(Be.TEN)?(y=y.divide(Be.TEN),x+=1):y.lt(Be.ONE)&&(y=y.multiply(Be.TEN),x-=1);for(var U=x+1,H=new Ue,pe=Be.MAX_PRINT_DIGITS-1,Ge=0;Ge<=pe;Ge++){a&&Ge===U&&H.append(".");var wt=Math.trunc(y._hi);if(wt<0)break;var qt=!1,nn=0;wt>9?(qt=!0,nn="9"):nn="0"+wt,H.append(nn),y=y.subtract(Be.valueOf(wt)).multiply(Be.TEN),qt&&y.selfAdd(Be.TEN);var Wn=!0,kn=Be.magnitude(y._hi);if(kn<0&&Math.abs(kn)>=pe-Ge&&(Wn=!1),!Wn)break}return h[0]=x,H.toString()},Be.prototype.sqr=function(){return this.multiply(this)},Be.prototype.doubleValue=function(){return this._hi+this._lo},Be.prototype.subtract=function(){return arguments[0]instanceof Be?this.add(arguments[0].negate()):"number"==typeof arguments[0]?this.add(-arguments[0]):void 0},Be.prototype.equals=function(){if(1===arguments.length){var a=arguments[0];return this._hi===a._hi&&this._lo===a._lo}},Be.prototype.isZero=function(){return 0===this._hi&&0===this._lo},Be.prototype.selfSubtract=function(){if(arguments[0]instanceof Be){var a=arguments[0];return this.isNaN()?this:this.selfAdd(-a._hi,-a._lo)}if("number"==typeof arguments[0]){var h=arguments[0];return this.isNaN()?this:this.selfAdd(-h,0)}},Be.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},Be.prototype.min=function(a){return this.le(a)?this:a},Be.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof Be){var a=arguments[0];return this.selfDivide(a._hi,a._lo)}if("number"==typeof arguments[0])return this.selfDivide(arguments[0],0)}else if(2===arguments.length){var U,pe,Ge,qt,y=arguments[0],D=null,H=null,wt=null,nn=null;return this._hi=nn=(Ge=this._hi/y)+(wt=(this._hi-(qt=Ge*y)-(nn=(D=(wt=Be.SPLIT*Ge)-(D=wt-Ge))*(H=(nn=Be.SPLIT*y)-(H=nn-y))-qt+D*(pe=y-H)+(U=Ge-D)*H+U*pe)+this._lo-Ge*arguments[1])/y),this._lo=Ge-nn+wt,this}},Be.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},Be.prototype.divide=function(){if(arguments[0]instanceof Be){var y,D,U,pe,a=arguments[0],h=null,x=null,H=null,Ge=null;return y=(U=this._hi/a._hi)-(h=(H=Be.SPLIT*U)-(h=H-U)),Ge=h*(x=(Ge=Be.SPLIT*a._hi)-(x=Ge-a._hi))-(pe=U*a._hi)+h*(D=a._hi-x)+y*x+y*D,new Be(Ge=U+(H=(this._hi-pe-Ge+this._lo-U*a._lo)/a._hi),U-Ge+H)}if("number"==typeof arguments[0]){var wt=arguments[0];return ee.isNaN(wt)?Be.createNaN():Be.copy(this).selfDivide(wt,0)}},Be.prototype.ge=function(a){return(this._hi>a._hi||this._hi===a._hi)&&this._lo>=a._lo},Be.prototype.pow=function(a){if(0===a)return Be.valueOf(1);var h=new Be(this),y=Be.valueOf(1),x=Math.abs(a);if(x>1)for(;x>0;)x%2==1&&y.selfMultiply(h),(x/=2)>0&&(h=h.sqr());else y=h;return a<0?y.reciprocal():y},Be.prototype.ceil=function(){if(this.isNaN())return Be.NaN;var a=Math.ceil(this._hi),h=0;return a===this._hi&&(h=Math.ceil(this._lo)),new Be(a,h)},Be.prototype.compareTo=function(a){return this._hi<a._hi?-1:this._hi>a._hi?1:this._lo<a._lo?-1:this._lo>a._lo?1:0},Be.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},Be.prototype.setValue=function(){return arguments[0]instanceof Be||"number"==typeof arguments[0]?(this.init(arguments[0]),this):void 0},Be.prototype.max=function(a){return this.ge(a)?this:a},Be.prototype.sqrt=function(){if(this.isZero())return Be.valueOf(0);if(this.isNegative())return Be.NaN;var a=1/Math.sqrt(this._hi),y=Be.valueOf(this._hi*a),x=this.subtract(y.sqr())._hi*(.5*a);return y.add(x)},Be.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof Be){var a=arguments[0];return this.selfAdd(a._hi,a._lo)}if("number"==typeof arguments[0]){var y,x,D,H,pe,h=arguments[0];return this._hi=(y=(D=this._hi+h)+(pe=h-(H=D-this._hi)+(this._hi-(D-H))+this._lo))+(x=pe+(D-y)),this._lo=x+(y-this._hi),this}}else if(2===arguments.length){var qt,nn,kn,ji,Ge=arguments[0],wt=arguments[1],Wn=null,tr=null,lr=null;tr=(kn=this._hi+Ge)-(lr=kn-this._hi),Wn=(nn=this._lo+wt)-(ji=nn-this._lo);var Gn=(qt=kn+(lr=(tr=Ge-lr+(this._hi-tr))+nn))+(lr=(Wn=wt-ji+(this._lo-Wn))+(lr+(kn-qt))),ga=lr+(qt-Gn);return this._hi=Gn,this._lo=ga,this}},Be.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof Be){var a=arguments[0];return this.selfMultiply(a._hi,a._lo)}if("number"==typeof arguments[0])return this.selfMultiply(arguments[0],0)}else if(2===arguments.length){var U,pe,y=arguments[0],D=null,H=null,Ge=null,wt=null;D=(Ge=Be.SPLIT*this._hi)-this._hi,D=Ge-D;var qt=(Ge=this._hi*y)+(wt=D*(H=(wt=Be.SPLIT*y)-(H=wt-y))-Ge+D*(pe=y-H)+(U=this._hi-D)*H+U*pe+(this._hi*arguments[1]+this._lo*y)),nn=wt+(D=Ge-qt);return this._hi=qt,this._lo=nn,this}},Be.prototype.selfSqr=function(){return this.selfMultiply(this)},Be.prototype.floor=function(){if(this.isNaN())return Be.NaN;var a=Math.floor(this._hi),h=0;return a===this._hi&&(h=Math.floor(this._lo)),new Be(a,h)},Be.prototype.negate=function(){return this.isNaN()?this:new Be(-this._hi,-this._lo)},Be.prototype.clone=function(){},Be.prototype.multiply=function(){if(arguments[0]instanceof Be){var a=arguments[0];return a.isNaN()?Be.createNaN():Be.copy(this).selfMultiply(a)}if("number"==typeof arguments[0]){var h=arguments[0];return ee.isNaN(h)?Be.createNaN():Be.copy(this).selfMultiply(h,0)}},Be.prototype.isNaN=function(){return ee.isNaN(this._hi)},Be.prototype.intValue=function(){return Math.trunc(this._hi)},Be.prototype.toString=function(){var a=Be.magnitude(this._hi);return a>=-3&&a<=20?this.toStandardNotation():this.toSciNotation()},Be.prototype.toStandardNotation=function(){var a=this.getSpecialNumberString();if(null!==a)return a;var h=new Array(1).fill(null),y=this.extractSignificantDigits(!0,h),x=h[0]+1,D=y;return"."===y.charAt(0)?D="0"+y:x<0?D="0."+Be.stringOfChar("0",-x)+y:-1===y.indexOf(".")&&(D=y+Be.stringOfChar("0",x-y.length)+".0"),this.isNegative()?"-"+D:D},Be.prototype.reciprocal=function(){var h,x,D,H,a=null,y=null,U=null,pe=null;h=(D=1/this._hi)-(a=(U=Be.SPLIT*D)-(a=U-D)),y=(pe=Be.SPLIT*this._hi)-this._hi;var Ge=D+(U=(1-(H=D*this._hi)-(pe=a*(y=pe-y)-H+a*(x=this._hi-y)+h*y+h*x)-D*this._lo)/this._hi);return new Be(Ge,D-Ge+U)},Be.prototype.toSciNotation=function(){if(this.isZero())return Be.SCI_NOT_ZERO;var a=this.getSpecialNumberString();if(null!==a)return a;var h=new Array(1).fill(null),y=this.extractSignificantDigits(!1,h),x=Be.SCI_NOT_EXPONENT_CHAR+h[0];if("0"===y.charAt(0))throw new Error("Found leading zero: "+y);var D="";y.length>1&&(D=y.substring(1));var U=y.charAt(0)+"."+D;return this.isNegative()?"-"+U+x:U+x},Be.prototype.abs=function(){return this.isNaN()?Be.NaN:this.isNegative()?this.negate():new Be(this)},Be.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},Be.prototype.lt=function(a){return(this._hi<a._hi||this._hi===a._hi)&&this._lo<a._lo},Be.prototype.add=function(){if(arguments[0]instanceof Be){var a=arguments[0];return Be.copy(this).selfAdd(a)}if("number"==typeof arguments[0]){var h=arguments[0];return Be.copy(this).selfAdd(h)}},Be.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0])this._hi=arguments[0],this._lo=0;else if(arguments[0]instanceof Be){var h=arguments[0];this._hi=h._hi,this._lo=h._lo}}else if(2===arguments.length){var x=arguments[1];this._hi=arguments[0],this._lo=x}},Be.prototype.gt=function(a){return(this._hi>a._hi||this._hi===a._hi)&&this._lo>a._lo},Be.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},Be.prototype.trunc=function(){return this.isNaN()?Be.NaN:this.isPositive()?this.floor():this.ceil()},Be.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},Be.prototype.interfaces_=function(){return[me,oe,te]},Be.prototype.getClass=function(){return Be},Be.sqr=function(a){return Be.valueOf(a).selfMultiply(a)},Be.valueOf=function(){return"string"==typeof arguments[0]?Be.parse(arguments[0]):"number"==typeof arguments[0]?new Be(arguments[0]):void 0},Be.sqrt=function(a){return Be.valueOf(a).sqrt()},Be.parse=function(a){for(var h=0,y=a.length;Tt.isWhitespace(a.charAt(h));)h++;var x=!1;if(h<y){var D=a.charAt(h);"-"!==D&&"+"!==D||(h++,"-"===D&&(x=!0))}for(var U=new Be,H=0,pe=0,Ge=0;!(h>=y);){var wt=a.charAt(h);if(h++,Tt.isDigit(wt)){var qt=wt-"0";U.selfMultiply(Be.TEN),U.selfAdd(qt),H++}else{if("."!==wt){if("e"===wt||"E"===wt){var nn=a.substring(h);try{Ge=ft.parseInt(nn)}catch(ji){throw ji instanceof Error?new Error("Invalid exponent "+nn+" in string "+a):ji}break}throw new Error("Unexpected character '"+wt+"' at position "+h+" in string "+a)}pe=H}}var Wn=U,kn=H-pe-Ge;if(0===kn)Wn=U;else if(kn>0){var tr=Be.TEN.pow(kn);Wn=U.divide(tr)}else if(kn<0){var lr=Be.TEN.pow(-kn);Wn=U.multiply(lr)}return x?Wn.negate():Wn},Be.createNaN=function(){return new Be(ee.NaN,ee.NaN)},Be.copy=function(a){return new Be(a)},Be.magnitude=function(a){var h=Math.abs(a),y=Math.log(h)/Math.log(10),x=Math.trunc(Math.floor(y));return 10*Math.pow(10,x)<=h&&(x+=1),x},Be.stringOfChar=function(a,h){for(var y=new Ue,x=0;x<h;x++)y.append(a);return y.toString()},Xt.PI.get=function(){return new Be(3.141592653589793,12246467991473532e-32)},Xt.TWO_PI.get=function(){return new Be(6.283185307179586,24492935982947064e-32)},Xt.PI_2.get=function(){return new Be(1.5707963267948966,6123233995736766e-32)},Xt.E.get=function(){return new Be(2.718281828459045,14456468917292502e-32)},Xt.NaN.get=function(){return new Be(ee.NaN,ee.NaN)},Xt.EPS.get=function(){return 123259516440783e-46},Xt.SPLIT.get=function(){return 134217729},Xt.MAX_PRINT_DIGITS.get=function(){return 32},Xt.TEN.get=function(){return Be.valueOf(10)},Xt.ONE.get=function(){return Be.valueOf(1)},Xt.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},Xt.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(Be,Xt);var Jt=function(){},Rn={DP_SAFE_EPSILON:{configurable:!0}};Jt.prototype.interfaces_=function(){return[]},Jt.prototype.getClass=function(){return Jt},Jt.orientationIndex=function(a,h,y){var x=Jt.orientationIndexFilter(a,h,y);if(x<=1)return x;var D=Be.valueOf(h.x).selfAdd(-a.x),U=Be.valueOf(h.y).selfAdd(-a.y),H=Be.valueOf(y.x).selfAdd(-h.x),pe=Be.valueOf(y.y).selfAdd(-h.y);return D.selfMultiply(pe).selfSubtract(U.selfMultiply(H)).signum()},Jt.signOfDet2x2=function(a,h,y,x){return a.multiply(x).selfSubtract(h.multiply(y)).signum()},Jt.intersection=function(a,h,y,x){var D=Be.valueOf(x.y).selfSubtract(y.y).selfMultiply(Be.valueOf(h.x).selfSubtract(a.x)),U=Be.valueOf(x.x).selfSubtract(y.x).selfMultiply(Be.valueOf(h.y).selfSubtract(a.y)),H=D.subtract(U),pe=Be.valueOf(x.x).selfSubtract(y.x).selfMultiply(Be.valueOf(a.y).selfSubtract(y.y)),Ge=Be.valueOf(x.y).selfSubtract(y.y).selfMultiply(Be.valueOf(a.x).selfSubtract(y.x)),wt=pe.subtract(Ge).selfDivide(H).doubleValue(),qt=Be.valueOf(a.x).selfAdd(Be.valueOf(h.x).selfSubtract(a.x).selfMultiply(wt)).doubleValue(),nn=Be.valueOf(h.x).selfSubtract(a.x).selfMultiply(Be.valueOf(a.y).selfSubtract(y.y)),Wn=Be.valueOf(h.y).selfSubtract(a.y).selfMultiply(Be.valueOf(a.x).selfSubtract(y.x)),kn=nn.subtract(Wn).selfDivide(H).doubleValue(),tr=Be.valueOf(y.y).selfAdd(Be.valueOf(x.y).selfSubtract(y.y).selfMultiply(kn)).doubleValue();return new re(qt,tr)},Jt.orientationIndexFilter=function(a,h,y){var x=null,D=(a.x-y.x)*(h.y-y.y),U=(a.y-y.y)*(h.x-y.x),H=D-U;if(D>0){if(U<=0)return Jt.signum(H);x=D+U}else{if(!(D<0)||U>=0)return Jt.signum(H);x=-D-U}var pe=Jt.DP_SAFE_EPSILON*x;return H>=pe||-H>=pe?Jt.signum(H):2},Jt.signum=function(a){return a>0?1:a<0?-1:0},Rn.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(Jt,Rn);var zt=function(){},Jn={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Jn.X.get=function(){return 0},Jn.Y.get=function(){return 1},Jn.Z.get=function(){return 2},Jn.M.get=function(){return 3},zt.prototype.setOrdinate=function(a,h,y){},zt.prototype.size=function(){},zt.prototype.getOrdinate=function(a,h){},zt.prototype.getCoordinate=function(){},zt.prototype.getCoordinateCopy=function(a){},zt.prototype.getDimension=function(){},zt.prototype.getX=function(a){},zt.prototype.clone=function(){},zt.prototype.expandEnvelope=function(a){},zt.prototype.copy=function(){},zt.prototype.getY=function(a){},zt.prototype.toCoordinateArray=function(){},zt.prototype.interfaces_=function(){return[te]},zt.prototype.getClass=function(){return zt},Object.defineProperties(zt,Jn);var Mn=function(){},jn=function(a){function h(){a.call(this,"Projective point not representable on the Cartesian plane.")}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Mn),xn=function(){};xn.arraycopy=function(a,h,y,x,D){for(var U=0,H=h;H<h+D;H++)y[x+U]=a[H],U++},xn.getProperty=function(a){return{"line.separator":"\n"}[a]};var Nn=function a(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var h=arguments[0];this.x=h.x,this.y=h.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var x=arguments[1];this.x=arguments[0],this.y=x,this.w=1}else if(arguments[0]instanceof a&&arguments[1]instanceof a){var D=arguments[0],U=arguments[1];this.x=D.y*U.w-U.y*D.w,this.y=U.x*D.w-D.x*U.w,this.w=D.x*U.y-U.x*D.y}else if(arguments[0]instanceof re&&arguments[1]instanceof re){var H=arguments[0],pe=arguments[1];this.x=H.y-pe.y,this.y=pe.x-H.x,this.w=H.x*pe.y-pe.x*H.y}}else if(3===arguments.length){var wt=arguments[1],qt=arguments[2];this.x=arguments[0],this.y=wt,this.w=qt}else if(4===arguments.length){var nn=arguments[0],Wn=arguments[1],kn=arguments[2],tr=arguments[3],lr=nn.y-Wn.y,ji=Wn.x-nn.x,Gn=nn.x*Wn.y-Wn.x*nn.y,ga=kn.y-tr.y,ma=tr.x-kn.x,il=kn.x*tr.y-tr.x*kn.y;this.x=ji*il-ma*Gn,this.y=ga*Gn-lr*il,this.w=lr*ma-ga*ji}};Nn.prototype.getY=function(){var a=this.y/this.w;if(ee.isNaN(a)||ee.isInfinite(a))throw new jn;return a},Nn.prototype.getX=function(){var a=this.x/this.w;if(ee.isNaN(a)||ee.isInfinite(a))throw new jn;return a},Nn.prototype.getCoordinate=function(){var a=new re;return a.x=this.getX(),a.y=this.getY(),a},Nn.prototype.interfaces_=function(){return[]},Nn.prototype.getClass=function(){return Nn},Nn.intersection=function(a,h,y,x){var D=a.y-h.y,U=h.x-a.x,H=a.x*h.y-h.x*a.y,pe=y.y-x.y,Ge=x.x-y.x,wt=y.x*x.y-x.x*y.y,qt=D*Ge-pe*U,nn=(U*wt-Ge*H)/qt,Wn=(pe*H-D*wt)/qt;if(ee.isNaN(nn)||ee.isInfinite(nn)||ee.isNaN(Wn)||ee.isInfinite(Wn))throw new jn;return new re(nn,Wn)};var wn=function a(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length)if(arguments[0]instanceof re){var h=arguments[0];this.init(h.x,h.x,h.y,h.y)}else arguments[0]instanceof a&&this.init(arguments[0]);else if(2===arguments.length){var x=arguments[0],D=arguments[1];this.init(x.x,D.x,x.y,D.y)}else 4===arguments.length&&this.init(arguments[0],arguments[1],arguments[2],arguments[3])},Wi={serialVersionUID:{configurable:!0}};wn.prototype.getArea=function(){return this.getWidth()*this.getHeight()},wn.prototype.equals=function(a){if(!(a instanceof wn))return!1;var h=a;return this.isNull()?h.isNull():this._maxx===h.getMaxX()&&this._maxy===h.getMaxY()&&this._minx===h.getMinX()&&this._miny===h.getMinY()},wn.prototype.intersection=function(a){return this.isNull()||a.isNull()||!this.intersects(a)?new wn:new wn(this._minx>a._minx?this._minx:a._minx,this._maxx<a._maxx?this._maxx:a._maxx,this._miny>a._miny?this._miny:a._miny,this._maxy<a._maxy?this._maxy:a._maxy)},wn.prototype.isNull=function(){return this._maxx<this._minx},wn.prototype.getMaxX=function(){return this._maxx},wn.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof re){var a=arguments[0];return this.covers(a.x,a.y)}if(arguments[0]instanceof wn){var h=arguments[0];return!this.isNull()&&!h.isNull()&&h.getMinX()>=this._minx&&h.getMaxX()<=this._maxx&&h.getMinY()>=this._miny&&h.getMaxY()<=this._maxy}}else if(2===arguments.length){var y=arguments[0],x=arguments[1];return!this.isNull()&&y>=this._minx&&y<=this._maxx&&x>=this._miny&&x<=this._maxy}},wn.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof wn){var a=arguments[0];return!this.isNull()&&!a.isNull()&&!(a._minx>this._maxx||a._maxx<this._minx||a._miny>this._maxy||a._maxy<this._miny)}if(arguments[0]instanceof re){var h=arguments[0];return this.intersects(h.x,h.y)}}else if(2===arguments.length){var y=arguments[0],x=arguments[1];return!this.isNull()&&!(y>this._maxx||y<this._minx||x>this._maxy||x<this._miny)}},wn.prototype.getMinY=function(){return this._miny},wn.prototype.getMinX=function(){return this._minx},wn.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof re){var a=arguments[0];this.expandToInclude(a.x,a.y)}else if(arguments[0]instanceof wn){var h=arguments[0];if(h.isNull())return null;this.isNull()?(this._minx=h.getMinX(),this._maxx=h.getMaxX(),this._miny=h.getMinY(),this._maxy=h.getMaxY()):(h._minx<this._minx&&(this._minx=h._minx),h._maxx>this._maxx&&(this._maxx=h._maxx),h._miny<this._miny&&(this._miny=h._miny),h._maxy>this._maxy&&(this._maxy=h._maxy))}}else if(2===arguments.length){var y=arguments[0],x=arguments[1];this.isNull()?(this._minx=y,this._maxx=y,this._miny=x,this._maxy=x):(y<this._minx&&(this._minx=y),y>this._maxx&&(this._maxx=y),x<this._miny&&(this._miny=x),x>this._maxy&&(this._maxy=x))}},wn.prototype.minExtent=function(){if(this.isNull())return 0;var a=this.getWidth(),h=this.getHeight();return a<h?a:h},wn.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},wn.prototype.compareTo=function(a){var h=a;return this.isNull()?h.isNull()?0:-1:h.isNull()?1:this._minx<h._minx?-1:this._minx>h._minx?1:this._miny<h._miny?-1:this._miny>h._miny?1:this._maxx<h._maxx?-1:this._maxx>h._maxx?1:this._maxy<h._maxy?-1:this._maxy>h._maxy?1:0},wn.prototype.translate=function(a,h){if(this.isNull())return null;this.init(this.getMinX()+a,this.getMaxX()+a,this.getMinY()+h,this.getMaxY()+h)},wn.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},wn.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},wn.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},wn.prototype.maxExtent=function(){if(this.isNull())return 0;var a=this.getWidth(),h=this.getHeight();return a>h?a:h},wn.prototype.expandBy=function(){if(1===arguments.length){var a=arguments[0];this.expandBy(a,a)}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this.isNull())return null;this._minx-=h,this._maxx+=h,this._miny-=y,this._maxy+=y,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},wn.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof wn)return this.covers(arguments[0]);if(arguments[0]instanceof re)return this.covers(arguments[0])}else if(2===arguments.length)return this.covers(arguments[0],arguments[1])},wn.prototype.centre=function(){return this.isNull()?null:new re((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},wn.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof re){var a=arguments[0];this.init(a.x,a.x,a.y,a.y)}else if(arguments[0]instanceof wn){var h=arguments[0];this._minx=h._minx,this._maxx=h._maxx,this._miny=h._miny,this._maxy=h._maxy}}else if(2===arguments.length){var y=arguments[0],x=arguments[1];this.init(y.x,x.x,y.y,x.y)}else if(4===arguments.length){var D=arguments[0],U=arguments[1],H=arguments[2],pe=arguments[3];D<U?(this._minx=D,this._maxx=U):(this._minx=U,this._maxx=D),H<pe?(this._miny=H,this._maxy=pe):(this._miny=pe,this._maxy=H)}},wn.prototype.getMaxY=function(){return this._maxy},wn.prototype.distance=function(a){if(this.intersects(a))return 0;var h=0;this._maxx<a._minx?h=a._minx-this._maxx:this._minx>a._maxx&&(h=this._minx-a._maxx);var y=0;return this._maxy<a._miny?y=a._miny-this._maxy:this._miny>a._maxy&&(y=this._miny-a._maxy),0===h?y:0===y?h:Math.sqrt(h*h+y*y)},wn.prototype.hashCode=function(){var a=17;return 37*(a=37*(a=37*(a=37*a+re.hashCode(this._minx))+re.hashCode(this._maxx))+re.hashCode(this._miny))+re.hashCode(this._maxy)},wn.prototype.interfaces_=function(){return[oe,me]},wn.prototype.getClass=function(){return wn},wn.intersects=function(){if(3===arguments.length){var a=arguments[0],h=arguments[1],y=arguments[2];return y.x>=(a.x<h.x?a.x:h.x)&&y.x<=(a.x>h.x?a.x:h.x)&&y.y>=(a.y<h.y?a.y:h.y)&&y.y<=(a.y>h.y?a.y:h.y)}if(4===arguments.length){var x=arguments[0],D=arguments[1],U=arguments[2],H=arguments[3],pe=Math.min(U.x,H.x),Ge=Math.max(U.x,H.x),wt=Math.min(x.x,D.x),qt=Math.max(x.x,D.x);return!(wt>Ge||qt<pe||(pe=Math.min(U.y,H.y),Ge=Math.max(U.y,H.y),wt=Math.min(x.y,D.y),qt=Math.max(x.y,D.y),wt>Ge||qt<pe))}},Wi.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(wn,Wi);var Sr={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Oi=function(a){this.geometryFactory=a||new er};Oi.prototype.read=function(a){var h,y;a=a.replace(/[\n\r]/g," ");var D=Sr.typeStr.exec(a);if(-1!==a.search("EMPTY")&&((D=Sr.emptyTypeStr.exec(a))[2]=void 0),D&&(y=D[1].toLowerCase(),mr[y]&&(h=mr[y].apply(this,[D[2]]))),void 0===h)throw new Error("Could not parse WKT "+a);return h},Oi.prototype.write=function(a){return this.extractGeometry(a)},Oi.prototype.extractGeometry=function(a){var h=a.getGeometryType().toLowerCase();if(!ar[h])return null;var y=h.toUpperCase();return a.isEmpty()?y+" EMPTY":y+"("+ar[h].apply(this,[a])+")"};var ar={coordinate:function(a){return a.x+" "+a.y},point:function(a){return ar.coordinate.call(this,a._coordinates._coordinates[0])},multipoint:function(a){for(var h=[],y=0,x=a._geometries.length;y<x;++y)h.push("("+ar.point.apply(this,[a._geometries[y]])+")");return h.join(",")},linestring:function(a){for(var h=[],y=0,x=a._points._coordinates.length;y<x;++y)h.push(ar.coordinate.apply(this,[a._points._coordinates[y]]));return h.join(",")},linearring:function(a){for(var h=[],y=0,x=a._points._coordinates.length;y<x;++y)h.push(ar.coordinate.apply(this,[a._points._coordinates[y]]));return h.join(",")},multilinestring:function(a){for(var h=[],y=0,x=a._geometries.length;y<x;++y)h.push("("+ar.linestring.apply(this,[a._geometries[y]])+")");return h.join(",")},polygon:function(a){var h=[];h.push("("+ar.linestring.apply(this,[a._shell])+")");for(var y=0,x=a._holes.length;y<x;++y)h.push("("+ar.linestring.apply(this,[a._holes[y]])+")");return h.join(",")},multipolygon:function(a){for(var h=[],y=0,x=a._geometries.length;y<x;++y)h.push("("+ar.polygon.apply(this,[a._geometries[y]])+")");return h.join(",")},geometrycollection:function(a){for(var h=[],y=0,x=a._geometries.length;y<x;++y)h.push(this.extractGeometry(a._geometries[y]));return h.join(",")}},mr={point:function(a){if(void 0===a)return this.geometryFactory.createPoint();var h=a.trim().split(Sr.spaces);return this.geometryFactory.createPoint(new re(Number.parseFloat(h[0]),Number.parseFloat(h[1])))},multipoint:function(a){if(void 0===a)return this.geometryFactory.createMultiPoint();for(var h,y=a.trim().split(","),x=[],D=0,U=y.length;D<U;++D)h=y[D].replace(Sr.trimParens,"$1"),x.push(mr.point.apply(this,[h]));return this.geometryFactory.createMultiPoint(x)},linestring:function(a){if(void 0===a)return this.geometryFactory.createLineString();for(var h,y=a.trim().split(","),x=[],D=0,U=y.length;D<U;++D)h=y[D].trim().split(Sr.spaces),x.push(new re(Number.parseFloat(h[0]),Number.parseFloat(h[1])));return this.geometryFactory.createLineString(x)},linearring:function(a){if(void 0===a)return this.geometryFactory.createLinearRing();for(var h,y=a.trim().split(","),x=[],D=0,U=y.length;D<U;++D)h=y[D].trim().split(Sr.spaces),x.push(new re(Number.parseFloat(h[0]),Number.parseFloat(h[1])));return this.geometryFactory.createLinearRing(x)},multilinestring:function(a){if(void 0===a)return this.geometryFactory.createMultiLineString();for(var h,y=a.trim().split(Sr.parenComma),x=[],D=0,U=y.length;D<U;++D)h=y[D].replace(Sr.trimParens,"$1"),x.push(mr.linestring.apply(this,[h]));return this.geometryFactory.createMultiLineString(x)},polygon:function(a){if(void 0===a)return this.geometryFactory.createPolygon();for(var h,y,x,D,U=a.trim().split(Sr.parenComma),H=[],pe=0,Ge=U.length;pe<Ge;++pe)h=U[pe].replace(Sr.trimParens,"$1"),y=mr.linestring.apply(this,[h]),x=this.geometryFactory.createLinearRing(y._points),0===pe?D=x:H.push(x);return this.geometryFactory.createPolygon(D,H)},multipolygon:function(a){if(void 0===a)return this.geometryFactory.createMultiPolygon();for(var h,y=a.trim().split(Sr.doubleParenComma),x=[],D=0,U=y.length;D<U;++D)h=y[D].replace(Sr.trimParens,"$1"),x.push(mr.polygon.apply(this,[h]));return this.geometryFactory.createMultiPolygon(x)},geometrycollection:function(a){if(void 0===a)return this.geometryFactory.createGeometryCollection();for(var h=(a=a.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),y=[],x=0,D=h.length;x<D;++x)y.push(this.read(h[x]));return this.geometryFactory.createGeometryCollection(y)}},Pt=function(a){this.parser=new Oi(a)};Pt.prototype.write=function(a){return this.parser.write(a)},Pt.toLineString=function(a,h){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+a.x+" "+a.y+", "+h.x+" "+h.y+" )"};var Re=function(a){function h(y){a.call(this,y),this.name="RuntimeException",this.message=y,this.stack=(new a).stack}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h}(Error),Te=function(a){function h(){a.call(this),0===arguments.length?a.call(this):1===arguments.length&&a.call(this,arguments[0])}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Re),Se=function(){};Se.prototype.interfaces_=function(){return[]},Se.prototype.getClass=function(){return Se},Se.shouldNeverReachHere=function(){if(0===arguments.length)Se.shouldNeverReachHere(null);else if(1===arguments.length){var a=arguments[0];throw new Te("Should never reach here"+(null!==a?": "+a:""))}},Se.isTrue=function(){var h;if(1===arguments.length)Se.isTrue(arguments[0],null);else if(2===arguments.length&&(h=arguments[1],!arguments[0]))throw null===h?new Te:new Te(h)},Se.equals=function(){var a,h,y;if(2===arguments.length)Se.equals(a=arguments[0],h=arguments[1],null);else if(3===arguments.length&&(y=arguments[2],!(h=arguments[1]).equals(a=arguments[0])))throw new Te("Expected "+a+" but encountered "+h+(null!==y?": "+y:""))};var et=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new re,this._intPt[1]=new re,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},Ct={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};et.prototype.getIndexAlongSegment=function(a,h){return this.computeIntLineIndex(),this._intLineIndex[a][h]},et.prototype.getTopologySummary=function(){var a=new Ue;return this.isEndPoint()&&a.append(" endpoint"),this._isProper&&a.append(" proper"),this.isCollinear()&&a.append(" collinear"),a.toString()},et.prototype.computeIntersection=function(a,h,y,x){this._inputLines[0][0]=a,this._inputLines[0][1]=h,this._inputLines[1][0]=y,this._inputLines[1][1]=x,this._result=this.computeIntersect(a,h,y,x)},et.prototype.getIntersectionNum=function(){return this._result},et.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var a=arguments[0];this.getEdgeDistance(a,0)>this.getEdgeDistance(a,1)?(this._intLineIndex[a][0]=0,this._intLineIndex[a][1]=1):(this._intLineIndex[a][0]=1,this._intLineIndex[a][1]=0)}},et.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},et.prototype.setPrecisionModel=function(a){this._precisionModel=a},et.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var a=arguments[0],h=0;h<this._result;h++)if(!this._intPt[h].equals2D(this._inputLines[a][0])&&!this._intPt[h].equals2D(this._inputLines[a][1]))return!0;return!1}},et.prototype.getIntersection=function(a){return this._intPt[a]},et.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},et.prototype.hasIntersection=function(){return this._result!==et.NO_INTERSECTION},et.prototype.getEdgeDistance=function(a,h){return et.computeEdgeDistance(this._intPt[h],this._inputLines[a][0],this._inputLines[a][1])},et.prototype.isCollinear=function(){return this._result===et.COLLINEAR_INTERSECTION},et.prototype.toString=function(){return Pt.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Pt.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},et.prototype.getEndpoint=function(a,h){return this._inputLines[a][h]},et.prototype.isIntersection=function(a){for(var h=0;h<this._result;h++)if(this._intPt[h].equals2D(a))return!0;return!1},et.prototype.getIntersectionAlongSegment=function(a,h){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[a][h]]},et.prototype.interfaces_=function(){return[]},et.prototype.getClass=function(){return et},et.computeEdgeDistance=function(a,h,y){var x=Math.abs(y.x-h.x),D=Math.abs(y.y-h.y),U=-1;if(a.equals(h))U=0;else if(a.equals(y))U=x>D?x:D;else{var H=Math.abs(a.x-h.x),pe=Math.abs(a.y-h.y);0!==(U=x>D?H:pe)||a.equals(h)||(U=Math.max(H,pe))}return Se.isTrue(!(0===U&&!a.equals(h)),"Bad distance calculation"),U},et.nonRobustComputeEdgeDistance=function(a,h,y){var x=a.x-h.x,D=a.y-h.y,U=Math.sqrt(x*x+D*D);return Se.isTrue(!(0===U&&!a.equals(h)),"Invalid distance calculation"),U},Ct.DONT_INTERSECT.get=function(){return 0},Ct.DO_INTERSECT.get=function(){return 1},Ct.COLLINEAR.get=function(){return 2},Ct.NO_INTERSECTION.get=function(){return 0},Ct.POINT_INTERSECTION.get=function(){return 1},Ct.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(et,Ct);var Yt=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.isInSegmentEnvelopes=function(y){var x=new wn(this._inputLines[0][0],this._inputLines[0][1]),D=new wn(this._inputLines[1][0],this._inputLines[1][1]);return x.contains(y)&&D.contains(y)},h.prototype.computeIntersection=function(){if(3!==arguments.length)return a.prototype.computeIntersection.apply(this,arguments);var y=arguments[0],x=arguments[1],D=arguments[2];if(this._isProper=!1,wn.intersects(x,D,y)&&0===en.orientationIndex(x,D,y)&&0===en.orientationIndex(D,x,y))return this._isProper=!0,(y.equals(x)||y.equals(D))&&(this._isProper=!1),this._result=a.POINT_INTERSECTION,null;this._result=a.NO_INTERSECTION},h.prototype.normalizeToMinimum=function(y,x,D,U,H){H.x=this.smallestInAbsValue(y.x,x.x,D.x,U.x),H.y=this.smallestInAbsValue(y.y,x.y,D.y,U.y),y.x-=H.x,y.y-=H.y,x.x-=H.x,x.y-=H.y,D.x-=H.x,D.y-=H.y,U.x-=H.x,U.y-=H.y},h.prototype.safeHCoordinateIntersection=function(y,x,D,U){var H=null;try{H=Nn.intersection(y,x,D,U)}catch(pe){if(!(pe instanceof jn))throw pe;H=h.nearestEndpoint(y,x,D,U)}return H},h.prototype.intersection=function(y,x,D,U){var H=this.intersectionWithNormalization(y,x,D,U);return this.isInSegmentEnvelopes(H)||(H=new re(h.nearestEndpoint(y,x,D,U))),null!==this._precisionModel&&this._precisionModel.makePrecise(H),H},h.prototype.smallestInAbsValue=function(y,x,D,U){var H=y,pe=Math.abs(H);return Math.abs(x)<pe&&(H=x,pe=Math.abs(x)),Math.abs(D)<pe&&(H=D,pe=Math.abs(D)),Math.abs(U)<pe&&(H=U),H},h.prototype.checkDD=function(y,x,D,U,H){var pe=Jt.intersection(y,x,D,U),Ge=this.isInSegmentEnvelopes(pe);xn.out.println("DD in env = "+Ge+"  --------------------- "+pe),H.distance(pe)>1e-4&&xn.out.println("Distance = "+H.distance(pe))},h.prototype.intersectionWithNormalization=function(y,x,D,U){var H=new re(y),pe=new re(x),Ge=new re(D),wt=new re(U),qt=new re;this.normalizeToEnvCentre(H,pe,Ge,wt,qt);var nn=this.safeHCoordinateIntersection(H,pe,Ge,wt);return nn.x+=qt.x,nn.y+=qt.y,nn},h.prototype.computeCollinearIntersection=function(y,x,D,U){var H=wn.intersects(y,x,D),pe=wn.intersects(y,x,U),Ge=wn.intersects(D,U,y),wt=wn.intersects(D,U,x);return H&&pe?(this._intPt[0]=D,this._intPt[1]=U,a.COLLINEAR_INTERSECTION):Ge&&wt?(this._intPt[0]=y,this._intPt[1]=x,a.COLLINEAR_INTERSECTION):H&&Ge?(this._intPt[0]=D,this._intPt[1]=y,!D.equals(y)||pe||wt?a.COLLINEAR_INTERSECTION:a.POINT_INTERSECTION):H&&wt?(this._intPt[0]=D,this._intPt[1]=x,!D.equals(x)||pe||Ge?a.COLLINEAR_INTERSECTION:a.POINT_INTERSECTION):pe&&Ge?(this._intPt[0]=U,this._intPt[1]=y,!U.equals(y)||H||wt?a.COLLINEAR_INTERSECTION:a.POINT_INTERSECTION):pe&&wt?(this._intPt[0]=U,this._intPt[1]=x,!U.equals(x)||H||Ge?a.COLLINEAR_INTERSECTION:a.POINT_INTERSECTION):a.NO_INTERSECTION},h.prototype.normalizeToEnvCentre=function(y,x,D,U,H){var pe=y.x<x.x?y.x:x.x,Ge=y.y<x.y?y.y:x.y,wt=y.x>x.x?y.x:x.x,qt=y.y>x.y?y.y:x.y,nn=D.x<U.x?D.x:U.x,Wn=D.y<U.y?D.y:U.y,kn=D.x>U.x?D.x:U.x,tr=D.y>U.y?D.y:U.y,ji=((Ge>Wn?Ge:Wn)+(qt<tr?qt:tr))/2;H.x=((pe>nn?pe:nn)+(wt<kn?wt:kn))/2,H.y=ji,y.x-=H.x,y.y-=H.y,x.x-=H.x,x.y-=H.y,D.x-=H.x,D.y-=H.y,U.x-=H.x,U.y-=H.y},h.prototype.computeIntersect=function(y,x,D,U){if(this._isProper=!1,!wn.intersects(y,x,D,U))return a.NO_INTERSECTION;var H=en.orientationIndex(y,x,D),pe=en.orientationIndex(y,x,U);if(H>0&&pe>0||H<0&&pe<0)return a.NO_INTERSECTION;var Ge=en.orientationIndex(D,U,y),wt=en.orientationIndex(D,U,x);return Ge>0&&wt>0||Ge<0&&wt<0?a.NO_INTERSECTION:0===H&&0===pe&&0===Ge&&0===wt?this.computeCollinearIntersection(y,x,D,U):(0===H||0===pe||0===Ge||0===wt?(this._isProper=!1,y.equals2D(D)||y.equals2D(U)?this._intPt[0]=y:x.equals2D(D)||x.equals2D(U)?this._intPt[0]=x:0===H?this._intPt[0]=new re(D):0===pe?this._intPt[0]=new re(U):0===Ge?this._intPt[0]=new re(y):0===wt&&(this._intPt[0]=new re(x))):(this._isProper=!0,this._intPt[0]=this.intersection(y,x,D,U)),a.POINT_INTERSECTION)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.nearestEndpoint=function(y,x,D,U){var H=y,pe=en.distancePointLine(y,D,U),Ge=en.distancePointLine(x,D,U);return Ge<pe&&(pe=Ge,H=x),(Ge=en.distancePointLine(D,y,x))<pe&&(pe=Ge,H=D),(Ge=en.distancePointLine(U,y,x))<pe&&(pe=Ge,H=U),H},h}(et),yn=function(){};yn.prototype.interfaces_=function(){return[]},yn.prototype.getClass=function(){return yn},yn.orientationIndex=function(a,h,y){return yn.signOfDet2x2(h.x-a.x,h.y-a.y,y.x-h.x,y.y-h.y)},yn.signOfDet2x2=function(a,h,y,x){var D=null,U=null,H=null;if(D=1,0===a||0===x)return 0===h||0===y?0:h>0?y>0?-D:D:y>0?D:-D;if(0===h||0===y)return x>0?a>0?D:-D:a>0?-D:D;if(h>0?x>0?h<=x||(D=-D,U=a,a=y,y=U,U=h,h=x,x=U):h<=-x?(D=-D,y=-y,x=-x):(U=a,a=-y,y=U,U=h,h=-x,x=U):x>0?-h<=x?(D=-D,a=-a,h=-h):(U=-a,a=y,y=U,U=-h,h=x,x=U):h>=x?(a=-a,h=-h,y=-y,x=-x):(D=-D,U=-a,a=-y,y=U,U=-h,h=-x,x=U),a>0){if(!(y>0&&a<=y))return D}else{if(y>0||!(a>=y))return-D;D=-D,a=-a,y=-y}for(;;){if((x-=(H=Math.floor(y/a))*h)<0)return-D;if(x>h)return D;if(a>(y-=H*a)+y){if(h<x+x)return D}else{if(h>x+x)return-D;y=a-y,x=h-x,D=-D}if(0===x)return 0===y?0:-D;if(0===y||(a-=(H=Math.floor(a/y))*y,(h-=H*x)<0))return D;if(h>x)return-D;if(y>a+a){if(x<h+h)return-D}else{if(x>h+h)return D;a=y-a,h=x-h,D=-D}if(0===h)return 0===a?0:D;if(0===a)return-D}};var _n=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1,this._p=arguments[0]};_n.prototype.countSegment=function(a,h){if(a.x<this._p.x&&h.x<this._p.x)return null;if(this._p.x===h.x&&this._p.y===h.y)return this._isPointOnSegment=!0,null;if(a.y===this._p.y&&h.y===this._p.y){var y=a.x,x=h.x;return y>x&&(y=h.x,x=a.x),this._p.x>=y&&this._p.x<=x&&(this._isPointOnSegment=!0),null}if(a.y>this._p.y&&h.y<=this._p.y||h.y>this._p.y&&a.y<=this._p.y){var U=a.y-this._p.y,pe=h.y-this._p.y,Ge=yn.signOfDet2x2(a.x-this._p.x,U,h.x-this._p.x,pe);if(0===Ge)return this._isPointOnSegment=!0,null;pe<U&&(Ge=-Ge),Ge>0&&this._crossingCount++}},_n.prototype.isPointInPolygon=function(){return this.getLocation()!==Ne.EXTERIOR},_n.prototype.getLocation=function(){return this._isPointOnSegment?Ne.BOUNDARY:this._crossingCount%2==1?Ne.INTERIOR:Ne.EXTERIOR},_n.prototype.isOnSegment=function(){return this._isPointOnSegment},_n.prototype.interfaces_=function(){return[]},_n.prototype.getClass=function(){return _n},_n.locatePointInRing=function(){if(arguments[0]instanceof re&&Bt(arguments[1],zt)){for(var h=arguments[1],y=new _n(arguments[0]),x=new re,D=new re,U=1;U<h.size();U++)if(h.getCoordinate(U,x),h.getCoordinate(U-1,D),y.countSegment(x,D),y.isOnSegment())return y.getLocation();return y.getLocation()}if(arguments[0]instanceof re&&arguments[1]instanceof Array){for(var pe=arguments[1],Ge=new _n(arguments[0]),wt=1;wt<pe.length;wt++)if(Ge.countSegment(pe[wt],pe[wt-1]),Ge.isOnSegment())return Ge.getLocation();return Ge.getLocation()}};var en=function(){},Dr={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};en.prototype.interfaces_=function(){return[]},en.prototype.getClass=function(){return en},en.orientationIndex=function(a,h,y){return Jt.orientationIndex(a,h,y)},en.signedArea=function(){if(arguments[0]instanceof Array){var a=arguments[0];if(a.length<3)return 0;for(var h=0,y=a[0].x,x=1;x<a.length-1;x++)h+=(a[x].x-y)*(a[x-1].y-a[x+1].y);return h/2}if(Bt(arguments[0],zt)){var H=arguments[0],pe=H.size();if(pe<3)return 0;var Ge=new re,wt=new re,qt=new re;H.getCoordinate(0,wt),H.getCoordinate(1,qt);var nn=wt.x;qt.x-=nn;for(var Wn=0,kn=1;kn<pe-1;kn++)Ge.y=wt.y,wt.x=qt.x,wt.y=qt.y,H.getCoordinate(kn+1,qt),qt.x-=nn,Wn+=wt.x*(Ge.y-qt.y);return Wn/2}},en.distanceLineLine=function(a,h,y,x){if(a.equals(h))return en.distancePointLine(a,y,x);if(y.equals(x))return en.distancePointLine(x,a,h);var D=!1;if(wn.intersects(a,h,y,x)){var U=(h.x-a.x)*(x.y-y.y)-(h.y-a.y)*(x.x-y.x);if(0===U)D=!0;else{var pe=((a.y-y.y)*(h.x-a.x)-(a.x-y.x)*(h.y-a.y))/U,Ge=((a.y-y.y)*(x.x-y.x)-(a.x-y.x)*(x.y-y.y))/U;(Ge<0||Ge>1||pe<0||pe>1)&&(D=!0)}}else D=!0;return D?Le.min(en.distancePointLine(a,y,x),en.distancePointLine(h,y,x),en.distancePointLine(y,a,h),en.distancePointLine(x,a,h)):0},en.isPointInRing=function(a,h){return en.locatePointInRing(a,h)!==Ne.EXTERIOR},en.computeLength=function(a){var h=a.size();if(h<=1)return 0;var y=0,x=new re;a.getCoordinate(0,x);for(var D=x.x,U=x.y,H=1;H<h;H++){a.getCoordinate(H,x);var pe=x.x,Ge=x.y,wt=pe-D,qt=Ge-U;y+=Math.sqrt(wt*wt+qt*qt),D=pe,U=Ge}return y},en.isCCW=function(a){var h=a.length-1;if(h<3)throw new ce("Ring has fewer than 4 points, so orientation cannot be determined");for(var y=a[0],x=0,D=1;D<=h;D++){var U=a[D];U.y>y.y&&(y=U,x=D)}var H=x;do{(H-=1)<0&&(H=h)}while(a[H].equals2D(y)&&H!==x);var pe=x;do{pe=(pe+1)%h}while(a[pe].equals2D(y)&&pe!==x);var Ge=a[H],wt=a[pe];if(Ge.equals2D(y)||wt.equals2D(y)||Ge.equals2D(wt))return!1;var qt=en.computeOrientation(Ge,y,wt);return 0===qt?Ge.x>wt.x:qt>0},en.locatePointInRing=function(a,h){return _n.locatePointInRing(a,h)},en.distancePointLinePerpendicular=function(a,h,y){var x=(y.x-h.x)*(y.x-h.x)+(y.y-h.y)*(y.y-h.y);return Math.abs(((h.y-a.y)*(y.x-h.x)-(h.x-a.x)*(y.y-h.y))/x)*Math.sqrt(x)},en.computeOrientation=function(a,h,y){return en.orientationIndex(a,h,y)},en.distancePointLine=function(){if(2===arguments.length){var a=arguments[0],h=arguments[1];if(0===h.length)throw new ce("Line array must contain at least one vertex");for(var y=a.distance(h[0]),x=0;x<h.length-1;x++){var D=en.distancePointLine(a,h[x],h[x+1]);D<y&&(y=D)}return y}if(3===arguments.length){var U=arguments[0],H=arguments[1],pe=arguments[2];if(H.x===pe.x&&H.y===pe.y)return U.distance(H);var Ge=(pe.x-H.x)*(pe.x-H.x)+(pe.y-H.y)*(pe.y-H.y),wt=((U.x-H.x)*(pe.x-H.x)+(U.y-H.y)*(pe.y-H.y))/Ge;return wt<=0?U.distance(H):wt>=1?U.distance(pe):Math.abs(((H.y-U.y)*(pe.x-H.x)-(H.x-U.x)*(pe.y-H.y))/Ge)*Math.sqrt(Ge)}},en.isOnLine=function(a,h){for(var y=new Yt,x=1;x<h.length;x++)if(y.computeIntersection(a,h[x-1],h[x]),y.hasIntersection())return!0;return!1},Dr.CLOCKWISE.get=function(){return-1},Dr.RIGHT.get=function(){return en.CLOCKWISE},Dr.COUNTERCLOCKWISE.get=function(){return 1},Dr.LEFT.get=function(){return en.COUNTERCLOCKWISE},Dr.COLLINEAR.get=function(){return 0},Dr.STRAIGHT.get=function(){return en.COLLINEAR},Object.defineProperties(en,Dr);var Pr=function(){};Pr.prototype.filter=function(a){},Pr.prototype.interfaces_=function(){return[]},Pr.prototype.getClass=function(){return Pr};var zn=function(){var a=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=a,this._SRID=a.getSRID()},Gr={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};zn.prototype.isGeometryCollection=function(){return this.getSortIndex()===zn.SORTINDEX_GEOMETRYCOLLECTION},zn.prototype.getFactory=function(){return this._factory},zn.prototype.getGeometryN=function(a){return this},zn.prototype.getArea=function(){return 0},zn.prototype.isRectangle=function(){return!1},zn.prototype.equals=function(){if(arguments[0]instanceof zn){var a=arguments[0];return null!==a&&this.equalsTopo(a)}if(arguments[0]instanceof Object){var h=arguments[0];return h instanceof zn&&this.equalsExact(h)}},zn.prototype.equalsExact=function(a){return this===a||this.equalsExact(a,0)},zn.prototype.geometryChanged=function(){this.apply(zn.geometryChangedFilter)},zn.prototype.geometryChangedAction=function(){this._envelope=null},zn.prototype.equalsNorm=function(a){return null!==a&&this.norm().equalsExact(a.norm())},zn.prototype.getLength=function(){return 0},zn.prototype.getNumGeometries=function(){return 1},zn.prototype.compareTo=function(){if(1===arguments.length){var a=arguments[0],h=a;return this.getSortIndex()!==h.getSortIndex()?this.getSortIndex()-h.getSortIndex():this.isEmpty()&&h.isEmpty()?0:this.isEmpty()?-1:h.isEmpty()?1:this.compareToSameClass(a)}if(2===arguments.length){var y=arguments[0],x=arguments[1];return this.getSortIndex()!==y.getSortIndex()?this.getSortIndex()-y.getSortIndex():this.isEmpty()&&y.isEmpty()?0:this.isEmpty()?-1:y.isEmpty()?1:this.compareToSameClass(y,x)}},zn.prototype.getUserData=function(){return this._userData},zn.prototype.getSRID=function(){return this._SRID},zn.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},zn.prototype.checkNotGeometryCollection=function(a){if(a.getSortIndex()===zn.SORTINDEX_GEOMETRYCOLLECTION)throw new ce("This method does not support GeometryCollection arguments")},zn.prototype.equal=function(a,h,y){return 0===y?a.equals(h):a.distance(h)<=y},zn.prototype.norm=function(){var a=this.copy();return a.normalize(),a},zn.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},zn.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new wn(this._envelope)},zn.prototype.setSRID=function(a){this._SRID=a},zn.prototype.setUserData=function(a){this._userData=a},zn.prototype.compare=function(a,h){for(var y=a.iterator(),x=h.iterator();y.hasNext()&&x.hasNext();){var D=y.next(),U=x.next(),H=D.compareTo(U);if(0!==H)return H}return y.hasNext()?1:x.hasNext()?-1:0},zn.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},zn.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===zn.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===zn.SORTINDEX_MULTIPOINT||this.getSortIndex()===zn.SORTINDEX_MULTILINESTRING||this.getSortIndex()===zn.SORTINDEX_MULTIPOLYGON},zn.prototype.interfaces_=function(){return[te,oe,me]},zn.prototype.getClass=function(){return zn},zn.hasNonEmptyElements=function(a){for(var h=0;h<a.length;h++)if(!a[h].isEmpty())return!0;return!1},zn.hasNullElements=function(a){for(var h=0;h<a.length;h++)if(null===a[h])return!0;return!1},Gr.serialVersionUID.get=function(){return 0x799ea46522854c00},Gr.SORTINDEX_POINT.get=function(){return 0},Gr.SORTINDEX_MULTIPOINT.get=function(){return 1},Gr.SORTINDEX_LINESTRING.get=function(){return 2},Gr.SORTINDEX_LINEARRING.get=function(){return 3},Gr.SORTINDEX_MULTILINESTRING.get=function(){return 4},Gr.SORTINDEX_POLYGON.get=function(){return 5},Gr.SORTINDEX_MULTIPOLYGON.get=function(){return 6},Gr.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},Gr.geometryChangedFilter.get=function(){return Pi},Object.defineProperties(zn,Gr);var Pi=function(){};Pi.interfaces_=function(){return[Pr]},Pi.filter=function(a){a.geometryChangedAction()};var ni=function(){};ni.prototype.filter=function(a){},ni.prototype.interfaces_=function(){return[]},ni.prototype.getClass=function(){return ni};var Ci=function(){},Ki={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Ci.prototype.isInBoundary=function(a){},Ci.prototype.interfaces_=function(){return[]},Ci.prototype.getClass=function(){return Ci},Ki.Mod2BoundaryNodeRule.get=function(){return ts},Ki.EndPointBoundaryNodeRule.get=function(){return Hs},Ki.MultiValentEndPointBoundaryNodeRule.get=function(){return rt},Ki.MonoValentEndPointBoundaryNodeRule.get=function(){return xe},Ki.MOD2_BOUNDARY_RULE.get=function(){return new ts},Ki.ENDPOINT_BOUNDARY_RULE.get=function(){return new Hs},Ki.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new rt},Ki.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new xe},Ki.OGC_SFS_BOUNDARY_RULE.get=function(){return Ci.MOD2_BOUNDARY_RULE},Object.defineProperties(Ci,Ki);var ts=function(){};ts.prototype.isInBoundary=function(a){return a%2==1},ts.prototype.interfaces_=function(){return[Ci]},ts.prototype.getClass=function(){return ts};var Hs=function(){};Hs.prototype.isInBoundary=function(a){return a>0},Hs.prototype.interfaces_=function(){return[Ci]},Hs.prototype.getClass=function(){return Hs};var rt=function(){};rt.prototype.isInBoundary=function(a){return a>1},rt.prototype.interfaces_=function(){return[Ci]},rt.prototype.getClass=function(){return rt};var xe=function(){};xe.prototype.isInBoundary=function(a){return 1===a},xe.prototype.interfaces_=function(){return[Ci]},xe.prototype.getClass=function(){return xe};var be=function(){};be.prototype.add=function(){},be.prototype.addAll=function(){},be.prototype.isEmpty=function(){},be.prototype.iterator=function(){},be.prototype.size=function(){},be.prototype.toArray=function(){},be.prototype.remove=function(){},(q.prototype=new Error).name="IndexOutOfBoundsException";var tt=function(){};tt.prototype.hasNext=function(){},tt.prototype.next=function(){},tt.prototype.remove=function(){};var ct=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.get=function(){},h.prototype.set=function(){},h.prototype.isEmpty=function(){},h}(be);(Ee.prototype=new Error).name="NoSuchElementException";var Ze=function(a){function h(){a.call(this),this.array_=[],arguments[0]instanceof be&&this.addAll(arguments[0])}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.ensureCapacity=function(){},h.prototype.interfaces_=function(){return[a,be]},h.prototype.add=function(y){return 1===arguments.length?this.array_.push(y):this.array_.splice(arguments[0],arguments[1]),!0},h.prototype.clear=function(){this.array_=[]},h.prototype.addAll=function(y){for(var x=y.iterator();x.hasNext();)this.add(x.next());return!0},h.prototype.set=function(y,x){var D=this.array_[y];return this.array_[y]=x,D},h.prototype.iterator=function(){return new Ft(this)},h.prototype.get=function(y){if(y<0||y>=this.size())throw new q;return this.array_[y]},h.prototype.isEmpty=function(){return 0===this.array_.length},h.prototype.size=function(){return this.array_.length},h.prototype.toArray=function(){for(var y=[],x=0,D=this.array_.length;x<D;x++)y.push(this.array_[x]);return y},h.prototype.remove=function(y){for(var x=!1,D=0,U=this.array_.length;D<U;D++)if(this.array_[D]===y){this.array_.splice(D,1),x=!0;break}return x},h}(ct),Ft=function(a){function h(y){a.call(this),this.arrayList_=y,this.position_=0}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new Ee;return this.arrayList_.get(this.position_++)},h.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},h.prototype.set=function(y){return this.arrayList_.set(this.position_-1,y)},h.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},h}(tt),Nt=function(a){function h(){if(a.call(this),0!==arguments.length)if(1===arguments.length){var x=arguments[0];this.ensureCapacity(x.length),this.add(x,!0)}else if(2===arguments.length){var D=arguments[0],U=arguments[1];this.ensureCapacity(D.length),this.add(D,U)}}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={coordArrayType:{configurable:!0}};return y.coordArrayType.get=function(){return new Array(0).fill(null)},h.prototype.getCoordinate=function(x){return this.get(x)},h.prototype.addAll=function(){if(2===arguments.length){for(var D=arguments[1],U=!1,H=arguments[0].iterator();H.hasNext();)this.add(H.next(),D),U=!0;return U}return a.prototype.addAll.apply(this,arguments)},h.prototype.clone=function(){for(var x=a.prototype.clone.call(this),D=0;D<this.size();D++)x.add(D,this.get(D).copy());return x},h.prototype.toCoordinateArray=function(){return this.toArray(h.coordArrayType)},h.prototype.add=function(){if(1===arguments.length)a.prototype.add.call(this,arguments[0]);else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1],!0),!0;if(arguments[0]instanceof re&&"boolean"==typeof arguments[1]){var H=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(H))return null;a.prototype.add.call(this,H)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1]),!0}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var wt=arguments[0],qt=arguments[1];if(arguments[2])for(var nn=0;nn<wt.length;nn++)this.add(wt[nn],qt);else for(var Wn=wt.length-1;Wn>=0;Wn--)this.add(wt[Wn],qt);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof re){var kn=arguments[0],tr=arguments[1];if(!arguments[2]){var lr=this.size();if(lr>0&&(kn>0&&this.get(kn-1).equals2D(tr)||kn<lr&&this.get(kn).equals2D(tr)))return null}a.prototype.add.call(this,kn,tr)}}else if(4===arguments.length){var ji=arguments[0],Gn=arguments[1],ga=arguments[2],ma=arguments[3],il=1;ga>ma&&(il=-1);for(var zc=ga;zc!==ma;zc+=il)this.add(ji[zc],Gn);return!0}},h.prototype.closeRing=function(){this.size()>0&&this.add(new re(this.get(0)),!1)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},Object.defineProperties(h,y),h}(Ze),lt=function(){},Zt={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Zt.ForwardComparator.get=function(){return Cn},Zt.BidirectionalComparator.get=function(){return Bn},Zt.coordArrayType.get=function(){return new Array(0).fill(null)},lt.prototype.interfaces_=function(){return[]},lt.prototype.getClass=function(){return lt},lt.isRing=function(a){return!(a.length<4||!a[0].equals2D(a[a.length-1]))},lt.ptNotInList=function(a,h){for(var y=0;y<a.length;y++){var x=a[y];if(lt.indexOf(x,h)<0)return x}return null},lt.scroll=function(a,h){var y=lt.indexOf(h,a);if(y<0)return null;var x=new Array(a.length).fill(null);xn.arraycopy(a,y,x,0,a.length-y),xn.arraycopy(a,0,x,a.length-y,y),xn.arraycopy(x,0,a,0,a.length)},lt.equals=function(){if(2===arguments.length){var a=arguments[0],h=arguments[1];if(a===h)return!0;if(null===a||null===h||a.length!==h.length)return!1;for(var y=0;y<a.length;y++)if(!a[y].equals(h[y]))return!1;return!0}if(3===arguments.length){var x=arguments[0],D=arguments[1],U=arguments[2];if(x===D)return!0;if(null===x||null===D||x.length!==D.length)return!1;for(var H=0;H<x.length;H++)if(0!==U.compare(x[H],D[H]))return!1;return!0}},lt.intersection=function(a,h){for(var y=new Nt,x=0;x<a.length;x++)h.intersects(a[x])&&y.add(a[x],!0);return y.toCoordinateArray()},lt.hasRepeatedPoints=function(a){for(var h=1;h<a.length;h++)if(a[h-1].equals(a[h]))return!0;return!1},lt.removeRepeatedPoints=function(a){return lt.hasRepeatedPoints(a)?new Nt(a,!1).toCoordinateArray():a},lt.reverse=function(a){for(var h=a.length-1,y=Math.trunc(h/2),x=0;x<=y;x++){var D=a[x];a[x]=a[h-x],a[h-x]=D}},lt.removeNull=function(a){for(var h=0,y=0;y<a.length;y++)null!==a[y]&&h++;var x=new Array(h).fill(null);if(0===h)return x;for(var D=0,U=0;U<a.length;U++)null!==a[U]&&(x[D++]=a[U]);return x},lt.copyDeep=function(){if(1===arguments.length){for(var a=arguments[0],h=new Array(a.length).fill(null),y=0;y<a.length;y++)h[y]=new re(a[y]);return h}if(5===arguments.length)for(var x=arguments[0],D=arguments[1],U=arguments[2],H=arguments[3],pe=arguments[4],Ge=0;Ge<pe;Ge++)U[H+Ge]=new re(x[D+Ge])},lt.isEqualReversed=function(a,h){for(var y=0;y<a.length;y++)if(0!==a[y].compareTo(h[a.length-y-1]))return!1;return!0},lt.envelope=function(a){for(var h=new wn,y=0;y<a.length;y++)h.expandToInclude(a[y]);return h},lt.toCoordinateArray=function(a){return a.toArray(lt.coordArrayType)},lt.atLeastNCoordinatesOrNothing=function(a,h){return h.length>=a?h:[]},lt.indexOf=function(a,h){for(var y=0;y<h.length;y++)if(a.equals(h[y]))return y;return-1},lt.increasingDirection=function(a){for(var h=0;h<Math.trunc(a.length/2);h++){var x=a[h].compareTo(a[a.length-1-h]);if(0!==x)return x}return 1},lt.compare=function(a,h){for(var y=0;y<a.length&&y<h.length;){var x=a[y].compareTo(h[y]);if(0!==x)return x;y++}return y<h.length?-1:y<a.length?1:0},lt.minCoordinate=function(a){for(var h=null,y=0;y<a.length;y++)(null===h||h.compareTo(a[y])>0)&&(h=a[y]);return h},lt.extract=function(a,h,y){h=Le.clamp(h,0,a.length);var x=(y=Le.clamp(y,-1,a.length))-h+1;y<0&&(x=0),h>=a.length&&(x=0),y<h&&(x=0);var D=new Array(x).fill(null);if(0===x)return D;for(var U=0,H=h;H<=y;H++)D[U++]=a[H];return D},Object.defineProperties(lt,Zt);var Cn=function(){};Cn.prototype.compare=function(a,h){return lt.compare(a,h)},Cn.prototype.interfaces_=function(){return[_e]},Cn.prototype.getClass=function(){return Cn};var Bn=function(){};Bn.prototype.compare=function(a,h){var y=a,x=h;if(y.length<x.length)return-1;if(y.length>x.length)return 1;if(0===y.length)return 0;var D=lt.compare(y,x);return lt.isEqualReversed(y,x)?0:D},Bn.prototype.OLDcompare=function(a,h){var y=a,x=h;if(y.length<x.length)return-1;if(y.length>x.length)return 1;if(0===y.length)return 0;for(var D=lt.increasingDirection(y),U=lt.increasingDirection(x),H=D>0?0:y.length-1,pe=U>0?0:y.length-1,Ge=0;Ge<y.length;Ge++){var wt=y[H].compareTo(x[pe]);if(0!==wt)return wt;H+=D,pe+=U}return 0},Bn.prototype.interfaces_=function(){return[_e]},Bn.prototype.getClass=function(){return Bn};var Sn=function(){};Sn.prototype.get=function(){},Sn.prototype.put=function(){},Sn.prototype.size=function(){},Sn.prototype.values=function(){},Sn.prototype.entrySet=function(){};var ri=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h}(Sn);(p.prototype=new Error).name="OperationNotSupported",(J.prototype=new be).contains=function(){};var li=function(a){function h(){a.call(this),this.array_=[],arguments[0]instanceof be&&this.addAll(arguments[0])}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.contains=function(y){for(var x=0,D=this.array_.length;x<D;x++)if(this.array_[x]===y)return!0;return!1},h.prototype.add=function(y){return!this.contains(y)&&(this.array_.push(y),!0)},h.prototype.addAll=function(y){for(var x=y.iterator();x.hasNext();)this.add(x.next());return!0},h.prototype.remove=function(y){throw new Error},h.prototype.size=function(){return this.array_.length},h.prototype.isEmpty=function(){return 0===this.array_.length},h.prototype.toArray=function(){for(var y=[],x=0,D=this.array_.length;x<D;x++)y.push(this.array_[x]);return y},h.prototype.iterator=function(){return new Yr(this)},h}(J),Yr=function(a){function h(y){a.call(this),this.hashSet_=y,this.position_=0}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new Ee;return this.hashSet_.array_[this.position_++]},h.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},h.prototype.remove=function(){throw new p},h}(tt),Cr=0;(gt.prototype=new ri).get=function(a){for(var h=this.root_;null!==h;){var y=a.compareTo(h.key);if(y<0)h=h.left;else{if(!(y>0))return h.value;h=h.right}}return null},gt.prototype.put=function(a,h){if(null===this.root_)return this.root_={key:a,value:h,left:null,right:null,parent:null,color:Cr,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var y,x,D=this.root_;do{if(y=D,(x=a.compareTo(D.key))<0)D=D.left;else{if(!(x>0)){var U=D.value;return D.value=h,U}D=D.right}}while(null!==D);var H={key:a,left:null,right:null,value:h,parent:y,color:Cr,getValue:function(){return this.value},getKey:function(){return this.key}};return x<0?y.left=H:y.right=H,this.fixAfterInsertion(H),this.size_++,null},gt.prototype.fixAfterInsertion=function(a){for(a.color=1;null!=a&&a!==this.root_&&1===a.parent.color;)if(Ce(a)===qe(Ce(Ce(a)))){var h=It(Ce(Ce(a)));1===ye(h)?(Pe(Ce(a),Cr),Pe(h,Cr),Pe(Ce(Ce(a)),1),a=Ce(Ce(a))):(a===It(Ce(a))&&(a=Ce(a),this.rotateLeft(a)),Pe(Ce(a),Cr),Pe(Ce(Ce(a)),1),this.rotateRight(Ce(Ce(a))))}else{var y=qe(Ce(Ce(a)));1===ye(y)?(Pe(Ce(a),Cr),Pe(y,Cr),Pe(Ce(Ce(a)),1),a=Ce(Ce(a))):(a===qe(Ce(a))&&(a=Ce(a),this.rotateRight(a)),Pe(Ce(a),Cr),Pe(Ce(Ce(a)),1),this.rotateLeft(Ce(Ce(a))))}this.root_.color=Cr},gt.prototype.values=function(){var a=new Ze,h=this.getFirstEntry();if(null!==h)for(a.add(h.value);null!==(h=gt.successor(h));)a.add(h.value);return a},gt.prototype.entrySet=function(){var a=new li,h=this.getFirstEntry();if(null!==h)for(a.add(h);null!==(h=gt.successor(h));)a.add(h);return a},gt.prototype.rotateLeft=function(a){if(null!=a){var h=a.right;a.right=h.left,null!=h.left&&(h.left.parent=a),h.parent=a.parent,null===a.parent?this.root_=h:a.parent.left===a?a.parent.left=h:a.parent.right=h,h.left=a,a.parent=h}},gt.prototype.rotateRight=function(a){if(null!=a){var h=a.left;a.left=h.right,null!=h.right&&(h.right.parent=a),h.parent=a.parent,null===a.parent?this.root_=h:a.parent.right===a?a.parent.right=h:a.parent.left=h,h.right=a,a.parent=h}},gt.prototype.getFirstEntry=function(){var a=this.root_;if(null!=a)for(;null!=a.left;)a=a.left;return a},gt.successor=function(a){if(null===a)return null;if(null!==a.right){for(var h=a.right;null!==h.left;)h=h.left;return h}for(var y=a.parent,x=a;null!==y&&x===y.right;)x=y,y=y.parent;return y},gt.prototype.size=function(){return this.size_};var fi=function(){};fi.prototype.interfaces_=function(){return[]},fi.prototype.getClass=function(){return fi},st.prototype=new J,(mt.prototype=new st).contains=function(a){for(var h=0,y=this.array_.length;h<y;h++)if(0===this.array_[h].compareTo(a))return!0;return!1},mt.prototype.add=function(a){if(this.contains(a))return!1;for(var h=0,y=this.array_.length;h<y;h++)if(1===this.array_[h].compareTo(a))return this.array_.splice(h,0,a),!0;return this.array_.push(a),!0},mt.prototype.addAll=function(a){for(var h=a.iterator();h.hasNext();)this.add(h.next());return!0},mt.prototype.remove=function(a){throw new p},mt.prototype.size=function(){return this.array_.length},mt.prototype.isEmpty=function(){return 0===this.array_.length},mt.prototype.toArray=function(){for(var a=[],h=0,y=this.array_.length;h<y;h++)a.push(this.array_[h]);return a},mt.prototype.iterator=function(){return new fs(this)};var fs=function(a){this.treeSet_=a,this.position_=0};fs.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new Ee;return this.treeSet_.array_[this.position_++]},fs.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},fs.prototype.remove=function(){throw new p};var ds=function(){};ds.sort=function(){var a,h,y,D=arguments[0];if(1===arguments.length)D.sort(function(H,pe){return H.compareTo(pe)});else if(2===arguments.length)y=arguments[1],D.sort(function(H,pe){return y.compare(H,pe)});else if(3===arguments.length){(h=D.slice(arguments[1],arguments[2])).sort();var U=D.slice(0,arguments[1]).concat(h,D.slice(arguments[2],D.length));for(D.splice(0,D.length),a=0;a<U.length;a++)D.push(U[a])}else if(4===arguments.length)for(h=D.slice(arguments[1],arguments[2]),y=arguments[3],h.sort(function(H,pe){return y.compare(H,pe)}),U=D.slice(0,arguments[1]).concat(h,D.slice(arguments[2],D.length)),D.splice(0,D.length),a=0;a<U.length;a++)D.push(U[a])},ds.asList=function(a){for(var h=new Ze,y=0,x=a.length;y<x;y++)h.add(a[y]);return h};var Xr=function(){},ao={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};ao.P.get=function(){return 0},ao.L.get=function(){return 1},ao.A.get=function(){return 2},ao.FALSE.get=function(){return-1},ao.TRUE.get=function(){return-2},ao.DONTCARE.get=function(){return-3},ao.SYM_FALSE.get=function(){return"F"},ao.SYM_TRUE.get=function(){return"T"},ao.SYM_DONTCARE.get=function(){return"*"},ao.SYM_P.get=function(){return"0"},ao.SYM_L.get=function(){return"1"},ao.SYM_A.get=function(){return"2"},Xr.prototype.interfaces_=function(){return[]},Xr.prototype.getClass=function(){return Xr},Xr.toDimensionSymbol=function(a){switch(a){case Xr.FALSE:return Xr.SYM_FALSE;case Xr.TRUE:return Xr.SYM_TRUE;case Xr.DONTCARE:return Xr.SYM_DONTCARE;case Xr.P:return Xr.SYM_P;case Xr.L:return Xr.SYM_L;case Xr.A:return Xr.SYM_A}throw new ce("Unknown dimension value: "+a)},Xr.toDimensionValue=function(a){switch(Tt.toUpperCase(a)){case Xr.SYM_FALSE:return Xr.FALSE;case Xr.SYM_TRUE:return Xr.TRUE;case Xr.SYM_DONTCARE:return Xr.DONTCARE;case Xr.SYM_P:return Xr.P;case Xr.SYM_L:return Xr.L;case Xr.SYM_A:return Xr.A}throw new ce("Unknown dimension symbol: "+a)},Object.defineProperties(Xr,ao);var ya=function(){};ya.prototype.filter=function(a){},ya.prototype.interfaces_=function(){return[]},ya.prototype.getClass=function(){return ya};var Xo=function(){};Xo.prototype.filter=function(a,h){},Xo.prototype.isDone=function(){},Xo.prototype.isGeometryChanged=function(){},Xo.prototype.interfaces_=function(){return[]},Xo.prototype.getClass=function(){return Xo};var zi=function(a){function h(x,D){if(a.call(this,D),this._geometries=x||[],a.hasNullElements(this._geometries))throw new ce("geometries must not contain null elements")}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){for(var x=new wn,D=0;D<this._geometries.length;D++)x.expandToInclude(this._geometries[D].getEnvelopeInternal());return x},h.prototype.getGeometryN=function(x){return this._geometries[x]},h.prototype.getSortIndex=function(){return a.SORTINDEX_GEOMETRYCOLLECTION},h.prototype.getCoordinates=function(){for(var x=new Array(this.getNumPoints()).fill(null),D=-1,U=0;U<this._geometries.length;U++)for(var H=this._geometries[U].getCoordinates(),pe=0;pe<H.length;pe++)x[++D]=H[pe];return x},h.prototype.getArea=function(){for(var x=0,D=0;D<this._geometries.length;D++)x+=this._geometries[D].getArea();return x},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],D=arguments[1];if(!this.isEquivalentClass(x))return!1;var U=x;if(this._geometries.length!==U._geometries.length)return!1;for(var H=0;H<this._geometries.length;H++)if(!this._geometries[H].equalsExact(U._geometries[H],D))return!1;return!0}return a.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){for(var x=0;x<this._geometries.length;x++)this._geometries[x].normalize();ds.sort(this._geometries)},h.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},h.prototype.getBoundaryDimension=function(){for(var x=Xr.FALSE,D=0;D<this._geometries.length;D++)x=Math.max(x,this._geometries[D].getBoundaryDimension());return x},h.prototype.getDimension=function(){for(var x=Xr.FALSE,D=0;D<this._geometries.length;D++)x=Math.max(x,this._geometries[D].getDimension());return x},h.prototype.getLength=function(){for(var x=0,D=0;D<this._geometries.length;D++)x+=this._geometries[D].getLength();return x},h.prototype.getNumPoints=function(){for(var x=0,D=0;D<this._geometries.length;D++)x+=this._geometries[D].getNumPoints();return x},h.prototype.getNumGeometries=function(){return this._geometries.length},h.prototype.reverse=function(){for(var D=new Array(this._geometries.length).fill(null),U=0;U<this._geometries.length;U++)D[U]=this._geometries[U].reverse();return this.getFactory().createGeometryCollection(D)},h.prototype.compareToSameClass=function(){if(1===arguments.length){var x=arguments[0],D=new mt(ds.asList(this._geometries)),U=new mt(ds.asList(x._geometries));return this.compare(D,U)}if(2===arguments.length){for(var pe=arguments[1],Ge=arguments[0],wt=this.getNumGeometries(),qt=Ge.getNumGeometries(),nn=0;nn<wt&&nn<qt;){var Wn=this.getGeometryN(nn),kn=Ge.getGeometryN(nn),tr=Wn.compareToSameClass(kn,pe);if(0!==tr)return tr;nn++}return nn<wt?1:nn<qt?-1:0}},h.prototype.apply=function(){if(Bt(arguments[0],ni))for(var x=arguments[0],D=0;D<this._geometries.length;D++)this._geometries[D].apply(x);else if(Bt(arguments[0],Xo)){var U=arguments[0];if(0===this._geometries.length)return null;for(var H=0;H<this._geometries.length&&(this._geometries[H].apply(U),!U.isDone());H++);U.isGeometryChanged()&&this.geometryChanged()}else if(Bt(arguments[0],ya)){var pe=arguments[0];pe.filter(this);for(var Ge=0;Ge<this._geometries.length;Ge++)this._geometries[Ge].apply(pe)}else if(Bt(arguments[0],Pr)){var wt=arguments[0];wt.filter(this);for(var qt=0;qt<this._geometries.length;qt++)this._geometries[qt].apply(wt)}},h.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),Se.shouldNeverReachHere(),null},h.prototype.clone=function(){var x=a.prototype.clone.call(this);x._geometries=new Array(this._geometries.length).fill(null);for(var D=0;D<this._geometries.length;D++)x._geometries[D]=this._geometries[D].clone();return x},h.prototype.getGeometryType=function(){return"GeometryCollection"},h.prototype.copy=function(){for(var x=new Array(this._geometries.length).fill(null),D=0;D<x.length;D++)x[D]=this._geometries[D].copy();return new h(x,this._factory)},h.prototype.isEmpty=function(){for(var x=0;x<this._geometries.length;x++)if(!this._geometries[x].isEmpty())return!1;return!0},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(h,y),h}(zn),pl=function(a){function h(){a.apply(this,arguments)}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return zn.SORTINDEX_MULTILINESTRING},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],D=arguments[1];return!!this.isEquivalentClass(x)&&a.prototype.equalsExact.call(this,x,D)}return a.prototype.equalsExact.apply(this,arguments)},h.prototype.getBoundaryDimension=function(){return this.isClosed()?Xr.FALSE:0},h.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var x=0;x<this._geometries.length;x++)if(!this._geometries[x].isClosed())return!1;return!0},h.prototype.getDimension=function(){return 1},h.prototype.reverse=function(){for(var x=this._geometries.length,D=new Array(x).fill(null),U=0;U<this._geometries.length;U++)D[x-1-U]=this._geometries[U].reverse();return this.getFactory().createMultiLineString(D)},h.prototype.getBoundary=function(){return new wo(this).getBoundary()},h.prototype.getGeometryType=function(){return"MultiLineString"},h.prototype.copy=function(){for(var x=new Array(this._geometries.length).fill(null),D=0;D<x.length;D++)x[D]=this._geometries[D].copy();return new h(x,this._factory)},h.prototype.interfaces_=function(){return[fi]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(h,y),h}(zi),wo=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var a=arguments[0],h=Ci.MOD2_BOUNDARY_RULE;this._geom=a,this._geomFact=a.getFactory(),this._bnRule=h}else if(2===arguments.length){var y=arguments[0],x=arguments[1];this._geom=y,this._geomFact=y.getFactory(),this._bnRule=x}};wo.prototype.boundaryMultiLineString=function(a){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var h=this.computeBoundaryCoordinates(a);return 1===h.length?this._geomFact.createPoint(h[0]):this._geomFact.createMultiPointFromCoords(h)},wo.prototype.getBoundary=function(){return this._geom instanceof ps?this.boundaryLineString(this._geom):this._geom instanceof pl?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},wo.prototype.boundaryLineString=function(a){return this._geom.isEmpty()?this.getEmptyMultiPoint():a.isClosed()?this._bnRule.isInBoundary(2)?a.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([a.getStartPoint(),a.getEndPoint()])},wo.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},wo.prototype.computeBoundaryCoordinates=function(a){var h=new Ze;this._endpointMap=new gt;for(var y=0;y<a.getNumGeometries();y++){var x=a.getGeometryN(y);0!==x.getNumPoints()&&(this.addEndpoint(x.getCoordinateN(0)),this.addEndpoint(x.getCoordinateN(x.getNumPoints()-1)))}for(var D=this._endpointMap.entrySet().iterator();D.hasNext();){var U=D.next(),H=U.getValue().count;this._bnRule.isInBoundary(H)&&h.add(U.getKey())}return lt.toCoordinateArray(h)},wo.prototype.addEndpoint=function(a){var h=this._endpointMap.get(a);null===h&&(h=new uc,this._endpointMap.put(a,h)),h.count++},wo.prototype.interfaces_=function(){return[]},wo.prototype.getClass=function(){return wo},wo.getBoundary=function(){return 1===arguments.length?new wo(arguments[0]).getBoundary():2===arguments.length?new wo(arguments[0],arguments[1]).getBoundary():void 0};var uc=function(){this.count=null};uc.prototype.interfaces_=function(){return[]},uc.prototype.getClass=function(){return uc};var Br=function(){},Lf={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Br.prototype.interfaces_=function(){return[]},Br.prototype.getClass=function(){return Br},Br.chars=function(a,h){for(var y=new Array(h).fill(null),x=0;x<h;x++)y[x]=a;return String(y)},Br.getStackTrace=function(){if(1===arguments.length){var a=arguments[0],h=new function(){},y=new function(){}(h);return a.printStackTrace(y),h.toString()}if(2===arguments.length){for(var D=arguments[1],U="",H=new function(){}(new function(){}(Br.getStackTrace(arguments[0]))),pe=0;pe<D;pe++)try{U+=H.readLine()+Br.NEWLINE}catch(Ge){if(!(Ge instanceof Mt))throw Ge;Se.shouldNeverReachHere()}return U}},Br.split=function(a,h){for(var y=h.length,x=new Ze,D=""+a,U=D.indexOf(h);U>=0;){var H=D.substring(0,U);x.add(H),U=(D=D.substring(U+y)).indexOf(h)}D.length>0&&x.add(D);for(var pe=new Array(x.size()).fill(null),Ge=0;Ge<pe.length;Ge++)pe[Ge]=x.get(Ge);return pe},Br.toString=function(){if(1===arguments.length)return Br.SIMPLE_ORDINATE_FORMAT.format(arguments[0])},Br.spaces=function(a){return Br.chars(" ",a)},Lf.NEWLINE.get=function(){return xn.getProperty("line.separator")},Lf.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}("0.#")},Object.defineProperties(Br,Lf);var ns=function(){};ns.prototype.interfaces_=function(){return[]},ns.prototype.getClass=function(){return ns},ns.copyCoord=function(a,h,y,x){for(var D=Math.min(a.getDimension(),y.getDimension()),U=0;U<D;U++)y.setOrdinate(x,U,a.getOrdinate(h,U))},ns.isRing=function(a){var h=a.size();return 0===h||!(h<=3)&&a.getOrdinate(0,zt.X)===a.getOrdinate(h-1,zt.X)&&a.getOrdinate(0,zt.Y)===a.getOrdinate(h-1,zt.Y)},ns.isEqual=function(a,h){var y=a.size();if(y!==h.size())return!1;for(var x=Math.min(a.getDimension(),h.getDimension()),D=0;D<y;D++)for(var U=0;U<x;U++){var H=a.getOrdinate(D,U),pe=h.getOrdinate(D,U);if(!(a.getOrdinate(D,U)===h.getOrdinate(D,U)||ee.isNaN(H)&&ee.isNaN(pe)))return!1}return!0},ns.extend=function(a,h,y){var x=a.create(y,h.getDimension()),D=h.size();if(ns.copy(h,0,x,0,D),D>0)for(var U=D;U<y;U++)ns.copy(h,D-1,x,U,1);return x},ns.reverse=function(a){for(var h=a.size()-1,y=Math.trunc(h/2),x=0;x<=y;x++)ns.swap(a,x,h-x)},ns.swap=function(a,h,y){if(h===y)return null;for(var x=0;x<a.getDimension();x++){var D=a.getOrdinate(h,x);a.setOrdinate(h,x,a.getOrdinate(y,x)),a.setOrdinate(y,x,D)}},ns.copy=function(a,h,y,x,D){for(var U=0;U<D;U++)ns.copyCoord(a,h+U,y,x+U)},ns.toString=function(){if(1===arguments.length){var a=arguments[0],h=a.size();if(0===h)return"()";var y=a.getDimension(),x=new Ue;x.append("(");for(var D=0;D<h;D++){D>0&&x.append(" ");for(var U=0;U<y;U++)U>0&&x.append(","),x.append(Br.toString(a.getOrdinate(D,U)))}return x.append(")"),x.toString()}},ns.ensureValidRing=function(a,h){var y=h.size();return 0===y?h:y<=3?ns.createClosedRing(a,h,4):h.getOrdinate(0,zt.X)===h.getOrdinate(y-1,zt.X)&&h.getOrdinate(0,zt.Y)===h.getOrdinate(y-1,zt.Y)?h:ns.createClosedRing(a,h,y+1)},ns.createClosedRing=function(a,h,y){var x=a.create(y,h.getDimension()),D=h.size();ns.copy(h,0,x,0,D);for(var U=D;U<y;U++)ns.copy(h,0,x,U,1);return x};var ps=function(a){function h(x,D){a.call(this,D),this._points=null,this.init(x)}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new wn:this._points.expandEnvelope(new wn)},h.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},h.prototype.getSortIndex=function(){return a.SORTINDEX_LINESTRING},h.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],D=arguments[1];if(!this.isEquivalentClass(x))return!1;var U=x;if(this._points.size()!==U._points.size())return!1;for(var H=0;H<this._points.size();H++)if(!this.equal(this._points.getCoordinate(H),U._points.getCoordinate(H),D))return!1;return!0}return a.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){for(var x=0;x<Math.trunc(this._points.size()/2);x++){var D=this._points.size()-1-x;if(!this._points.getCoordinate(x).equals(this._points.getCoordinate(D)))return this._points.getCoordinate(x).compareTo(this._points.getCoordinate(D))>0&&ns.reverse(this._points),null}},h.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},h.prototype.getBoundaryDimension=function(){return this.isClosed()?Xr.FALSE:0},h.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},h.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},h.prototype.getDimension=function(){return 1},h.prototype.getLength=function(){return en.computeLength(this._points)},h.prototype.getNumPoints=function(){return this._points.size()},h.prototype.reverse=function(){var x=this._points.copy();return ns.reverse(x),this.getFactory().createLineString(x)},h.prototype.compareToSameClass=function(){if(1===arguments.length){for(var x=arguments[0],D=0,U=0;D<this._points.size()&&U<x._points.size();){var H=this._points.getCoordinate(D).compareTo(x._points.getCoordinate(U));if(0!==H)return H;D++,U++}return D<this._points.size()?1:U<x._points.size()?-1:0}if(2===arguments.length)return arguments[1].compare(this._points,arguments[0]._points)},h.prototype.apply=function(){if(Bt(arguments[0],ni))for(var x=arguments[0],D=0;D<this._points.size();D++)x.filter(this._points.getCoordinate(D));else if(Bt(arguments[0],Xo)){var U=arguments[0];if(0===this._points.size())return null;for(var H=0;H<this._points.size()&&(U.filter(this._points,H),!U.isDone());H++);U.isGeometryChanged()&&this.geometryChanged()}else(Bt(arguments[0],ya)||Bt(arguments[0],Pr))&&arguments[0].filter(this)},h.prototype.getBoundary=function(){return new wo(this).getBoundary()},h.prototype.isEquivalentClass=function(x){return x instanceof h},h.prototype.clone=function(){var x=a.prototype.clone.call(this);return x._points=this._points.clone(),x},h.prototype.getCoordinateN=function(x){return this._points.getCoordinate(x)},h.prototype.getGeometryType=function(){return"LineString"},h.prototype.copy=function(){return new h(this._points.copy(),this._factory)},h.prototype.getCoordinateSequence=function(){return this._points},h.prototype.isEmpty=function(){return 0===this._points.size()},h.prototype.init=function(x){if(null===x&&(x=this.getFactory().getCoordinateSequenceFactory().create([])),1===x.size())throw new ce("Invalid number of points in LineString (found "+x.size()+" - must be 0 or >= 2)");this._points=x},h.prototype.isCoordinate=function(x){for(var D=0;D<this._points.size();D++)if(this._points.getCoordinate(D).equals(x))return!0;return!1},h.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},h.prototype.getPointN=function(x){return this.getFactory().createPoint(this._points.getCoordinate(x))},h.prototype.interfaces_=function(){return[fi]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(h,y),h}(zn),lc=function(){};lc.prototype.interfaces_=function(){return[]},lc.prototype.getClass=function(){return lc};var gs=function(a){function h(x,D){a.call(this,D),this._coordinates=x||null,this.init(this._coordinates)}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new wn;var x=new wn;return x.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),x},h.prototype.getSortIndex=function(){return a.SORTINDEX_POINT},h.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],D=arguments[1];return!!this.isEquivalentClass(x)&&(!(!this.isEmpty()||!x.isEmpty())||this.isEmpty()===x.isEmpty()&&this.equal(x.getCoordinate(),this.getCoordinate(),D))}return a.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){},h.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},h.prototype.getBoundaryDimension=function(){return Xr.FALSE},h.prototype.getDimension=function(){return 0},h.prototype.getNumPoints=function(){return this.isEmpty()?0:1},h.prototype.reverse=function(){return this.copy()},h.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},h.prototype.compareToSameClass=function(){if(1===arguments.length){var x=arguments[0];return this.getCoordinate().compareTo(x.getCoordinate())}if(2===arguments.length)return arguments[1].compare(this._coordinates,arguments[0]._coordinates)},h.prototype.apply=function(){if(Bt(arguments[0],ni)){var x=arguments[0];if(this.isEmpty())return null;x.filter(this.getCoordinate())}else if(Bt(arguments[0],Xo)){var D=arguments[0];if(this.isEmpty())return null;D.filter(this._coordinates,0),D.isGeometryChanged()&&this.geometryChanged()}else(Bt(arguments[0],ya)||Bt(arguments[0],Pr))&&arguments[0].filter(this)},h.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},h.prototype.clone=function(){var x=a.prototype.clone.call(this);return x._coordinates=this._coordinates.clone(),x},h.prototype.getGeometryType=function(){return"Point"},h.prototype.copy=function(){return new h(this._coordinates.copy(),this._factory)},h.prototype.getCoordinateSequence=function(){return this._coordinates},h.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},h.prototype.isEmpty=function(){return 0===this._coordinates.size()},h.prototype.init=function(x){null===x&&(x=this.getFactory().getCoordinateSequenceFactory().create([])),Se.isTrue(x.size()<=1),this._coordinates=x},h.prototype.isSimple=function(){return!0},h.prototype.interfaces_=function(){return[lc]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(h,y),h}(zn),_a=function(){};_a.prototype.interfaces_=function(){return[]},_a.prototype.getClass=function(){return _a};var ms=function(a){function h(x,D,U){if(a.call(this,U),this._shell=null,this._holes=null,null===x&&(x=this.getFactory().createLinearRing()),null===D&&(D=[]),a.hasNullElements(D))throw new ce("holes must not contain null elements");if(x.isEmpty()&&a.hasNonEmptyElements(D))throw new ce("shell is empty but holes are not");this._shell=x,this._holes=D}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},h.prototype.getSortIndex=function(){return a.SORTINDEX_POLYGON},h.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var x=new Array(this.getNumPoints()).fill(null),D=-1,U=this._shell.getCoordinates(),H=0;H<U.length;H++)x[++D]=U[H];for(var pe=0;pe<this._holes.length;pe++)for(var Ge=this._holes[pe].getCoordinates(),wt=0;wt<Ge.length;wt++)x[++D]=Ge[wt];return x},h.prototype.getArea=function(){var x=0;x+=Math.abs(en.signedArea(this._shell.getCoordinateSequence()));for(var D=0;D<this._holes.length;D++)x-=Math.abs(en.signedArea(this._holes[D].getCoordinateSequence()));return x},h.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing()||null===this._shell||5!==this._shell.getNumPoints())return!1;for(var x=this._shell.getCoordinateSequence(),D=this.getEnvelopeInternal(),U=0;U<5;U++){var H=x.getX(U);if(H!==D.getMinX()&&H!==D.getMaxX())return!1;var pe=x.getY(U);if(pe!==D.getMinY()&&pe!==D.getMaxY())return!1}for(var Ge=x.getX(0),wt=x.getY(0),qt=1;qt<=4;qt++){var nn=x.getX(qt),Wn=x.getY(qt);if(nn!==Ge==(Wn!==wt))return!1;Ge=nn,wt=Wn}return!0},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],D=arguments[1];if(!this.isEquivalentClass(x))return!1;var U=x;if(!this._shell.equalsExact(U._shell,D)||this._holes.length!==U._holes.length)return!1;for(var Ge=0;Ge<this._holes.length;Ge++)if(!this._holes[Ge].equalsExact(U._holes[Ge],D))return!1;return!0}return a.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var x=0;x<this._holes.length;x++)this.normalize(this._holes[x],!1);ds.sort(this._holes)}else if(2===arguments.length){var D=arguments[0],U=arguments[1];if(D.isEmpty())return null;var H=new Array(D.getCoordinates().length-1).fill(null);xn.arraycopy(D.getCoordinates(),0,H,0,H.length);var pe=lt.minCoordinate(D.getCoordinates());lt.scroll(H,pe),xn.arraycopy(H,0,D.getCoordinates(),0,H.length),D.getCoordinates()[H.length]=H[0],en.isCCW(D.getCoordinates())===U&&lt.reverse(D.getCoordinates())}},h.prototype.getCoordinate=function(){return this._shell.getCoordinate()},h.prototype.getNumInteriorRing=function(){return this._holes.length},h.prototype.getBoundaryDimension=function(){return 1},h.prototype.getDimension=function(){return 2},h.prototype.getLength=function(){var x=0;x+=this._shell.getLength();for(var D=0;D<this._holes.length;D++)x+=this._holes[D].getLength();return x},h.prototype.getNumPoints=function(){for(var x=this._shell.getNumPoints(),D=0;D<this._holes.length;D++)x+=this._holes[D].getNumPoints();return x},h.prototype.reverse=function(){var x=this.copy();x._shell=this._shell.copy().reverse(),x._holes=new Array(this._holes.length).fill(null);for(var D=0;D<this._holes.length;D++)x._holes[D]=this._holes[D].copy().reverse();return x},h.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},h.prototype.compareToSameClass=function(){if(1===arguments.length)return this._shell.compareToSameClass(arguments[0]._shell);if(2===arguments.length){var pe=arguments[1],Ge=arguments[0],nn=this._shell.compareToSameClass(Ge._shell,pe);if(0!==nn)return nn;for(var Wn=this.getNumInteriorRing(),kn=Ge.getNumInteriorRing(),tr=0;tr<Wn&&tr<kn;){var lr=this.getInteriorRingN(tr),ji=Ge.getInteriorRingN(tr),Gn=lr.compareToSameClass(ji,pe);if(0!==Gn)return Gn;tr++}return tr<Wn?1:tr<kn?-1:0}},h.prototype.apply=function(x){if(Bt(x,ni)){this._shell.apply(x);for(var D=0;D<this._holes.length;D++)this._holes[D].apply(x)}else if(Bt(x,Xo)){if(this._shell.apply(x),!x.isDone())for(var U=0;U<this._holes.length&&(this._holes[U].apply(x),!x.isDone());U++);x.isGeometryChanged()&&this.geometryChanged()}else if(Bt(x,ya))x.filter(this);else if(Bt(x,Pr)){x.filter(this),this._shell.apply(x);for(var H=0;H<this._holes.length;H++)this._holes[H].apply(x)}},h.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var x=new Array(this._holes.length+1).fill(null);x[0]=this._shell;for(var D=0;D<this._holes.length;D++)x[D+1]=this._holes[D];return x.length<=1?this.getFactory().createLinearRing(x[0].getCoordinateSequence()):this.getFactory().createMultiLineString(x)},h.prototype.clone=function(){var x=a.prototype.clone.call(this);x._shell=this._shell.clone(),x._holes=new Array(this._holes.length).fill(null);for(var D=0;D<this._holes.length;D++)x._holes[D]=this._holes[D].clone();return x},h.prototype.getGeometryType=function(){return"Polygon"},h.prototype.copy=function(){for(var x=this._shell.copy(),D=new Array(this._holes.length).fill(null),U=0;U<D.length;U++)D[U]=this._holes[U].copy();return new h(x,D,this._factory)},h.prototype.getExteriorRing=function(){return this._shell},h.prototype.isEmpty=function(){return this._shell.isEmpty()},h.prototype.getInteriorRingN=function(x){return this._holes[x]},h.prototype.interfaces_=function(){return[_a]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(h,y),h}(zn),Ac=function(a){function h(){a.apply(this,arguments)}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return zn.SORTINDEX_MULTIPOINT},h.prototype.isValid=function(){return!0},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],D=arguments[1];return!!this.isEquivalentClass(x)&&a.prototype.equalsExact.call(this,x,D)}return a.prototype.equalsExact.apply(this,arguments)},h.prototype.getCoordinate=function(){return 1===arguments.length?this._geometries[arguments[0]].getCoordinate():a.prototype.getCoordinate.apply(this,arguments)},h.prototype.getBoundaryDimension=function(){return Xr.FALSE},h.prototype.getDimension=function(){return 0},h.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},h.prototype.getGeometryType=function(){return"MultiPoint"},h.prototype.copy=function(){for(var x=new Array(this._geometries.length).fill(null),D=0;D<x.length;D++)x[D]=this._geometries[D].copy();return new h(x,this._factory)},h.prototype.interfaces_=function(){return[lc]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(h,y),h}(zi),Za=function(a){function h(x,D){x instanceof re&&D instanceof er&&(x=D.getCoordinateSequenceFactory().create(x)),a.call(this,x,D),this.validateConstruction()}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return zn.SORTINDEX_LINEARRING},h.prototype.getBoundaryDimension=function(){return Xr.FALSE},h.prototype.isClosed=function(){return!!this.isEmpty()||a.prototype.isClosed.call(this)},h.prototype.reverse=function(){var x=this._points.copy();return ns.reverse(x),this.getFactory().createLinearRing(x)},h.prototype.validateConstruction=function(){if(!this.isEmpty()&&!a.prototype.isClosed.call(this))throw new ce("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<h.MINIMUM_VALID_SIZE)throw new ce("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},h.prototype.getGeometryType=function(){return"LinearRing"},h.prototype.copy=function(){return new h(this._points.copy(),this._factory)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},y.MINIMUM_VALID_SIZE.get=function(){return 4},y.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(h,y),h}(ps),Oa=function(a){function h(){a.apply(this,arguments)}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return zn.SORTINDEX_MULTIPOLYGON},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],D=arguments[1];return!!this.isEquivalentClass(x)&&a.prototype.equalsExact.call(this,x,D)}return a.prototype.equalsExact.apply(this,arguments)},h.prototype.getBoundaryDimension=function(){return 1},h.prototype.getDimension=function(){return 2},h.prototype.reverse=function(){for(var D=new Array(this._geometries.length).fill(null),U=0;U<this._geometries.length;U++)D[U]=this._geometries[U].reverse();return this.getFactory().createMultiPolygon(D)},h.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var x=new Ze,D=0;D<this._geometries.length;D++)for(var U=this._geometries[D].getBoundary(),H=0;H<U.getNumGeometries();H++)x.add(U.getGeometryN(H));var pe=new Array(x.size()).fill(null);return this.getFactory().createMultiLineString(x.toArray(pe))},h.prototype.getGeometryType=function(){return"MultiPolygon"},h.prototype.copy=function(){for(var x=new Array(this._geometries.length).fill(null),D=0;D<x.length;D++)x[D]=this._geometries[D].copy();return new h(x,this._factory)},h.prototype.interfaces_=function(){return[_a]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(h,y),h}(zi),Na=function(a){this._factory=a||null,this._isUserDataCopied=!1},on={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Na.prototype.setCopyUserData=function(a){this._isUserDataCopied=a},Na.prototype.edit=function(a,h){if(null===a)return null;var y=this.editInternal(a,h);return this._isUserDataCopied&&y.setUserData(a.getUserData()),y},Na.prototype.editInternal=function(a,h){return null===this._factory&&(this._factory=a.getFactory()),a instanceof zi?this.editGeometryCollection(a,h):a instanceof ms?this.editPolygon(a,h):a instanceof gs||a instanceof ps?h.edit(a,this._factory):(Se.shouldNeverReachHere("Unsupported Geometry class: "+a.getClass().getName()),null)},Na.prototype.editGeometryCollection=function(a,h){for(var y=h.edit(a,this._factory),x=new Ze,D=0;D<y.getNumGeometries();D++){var U=this.edit(y.getGeometryN(D),h);null===U||U.isEmpty()||x.add(U)}return y.getClass()===Ac?this._factory.createMultiPoint(x.toArray([])):y.getClass()===pl?this._factory.createMultiLineString(x.toArray([])):y.getClass()===Oa?this._factory.createMultiPolygon(x.toArray([])):this._factory.createGeometryCollection(x.toArray([]))},Na.prototype.editPolygon=function(a,h){var y=h.edit(a,this._factory);if(null===y&&(y=this._factory.createPolygon(null)),y.isEmpty())return y;var x=this.edit(y.getExteriorRing(),h);if(null===x||x.isEmpty())return this._factory.createPolygon();for(var D=new Ze,U=0;U<y.getNumInteriorRing();U++){var H=this.edit(y.getInteriorRingN(U),h);null===H||H.isEmpty()||D.add(H)}return this._factory.createPolygon(x,D.toArray([]))},Na.prototype.interfaces_=function(){return[]},Na.prototype.getClass=function(){return Na},Na.GeometryEditorOperation=function(){},on.NoOpGeometryOperation.get=function(){return Wu},on.CoordinateOperation.get=function(){return Ms},on.CoordinateSequenceOperation.get=function(){return aa},Object.defineProperties(Na,on);var Wu=function(){};Wu.prototype.edit=function(a,h){return a},Wu.prototype.interfaces_=function(){return[Na.GeometryEditorOperation]},Wu.prototype.getClass=function(){return Wu};var Ms=function(){};Ms.prototype.edit=function(a,h){var y=this.editCoordinates(a.getCoordinates(),a);return null===y?a:a instanceof Za?h.createLinearRing(y):a instanceof ps?h.createLineString(y):a instanceof gs?y.length>0?h.createPoint(y[0]):h.createPoint():a},Ms.prototype.interfaces_=function(){return[Na.GeometryEditorOperation]},Ms.prototype.getClass=function(){return Ms};var aa=function(){};aa.prototype.edit=function(a,h){return a instanceof Za?h.createLinearRing(this.edit(a.getCoordinateSequence(),a)):a instanceof ps?h.createLineString(this.edit(a.getCoordinateSequence(),a)):a instanceof gs?h.createPoint(this.edit(a.getCoordinateSequence(),a)):a},aa.prototype.interfaces_=function(){return[Na.GeometryEditorOperation]},aa.prototype.getClass=function(){return aa};var Ds=function(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var a=arguments[0];this._coordinates=new Array(a).fill(null);for(var h=0;h<a;h++)this._coordinates[h]=new re}else if(Bt(arguments[0],zt)){var y=arguments[0];if(null===y)return this._coordinates=new Array(0).fill(null),null;this._dimension=y.getDimension(),this._coordinates=new Array(y.size()).fill(null);for(var x=0;x<this._coordinates.length;x++)this._coordinates[x]=y.getCoordinateCopy(x)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var D=arguments[0],U=arguments[1];this._coordinates=D,this._dimension=U,null===D&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var H=arguments[0],pe=arguments[1];this._coordinates=new Array(H).fill(null),this._dimension=pe;for(var Ge=0;Ge<H;Ge++)this._coordinates[Ge]=new re}},bs={serialVersionUID:{configurable:!0}};Ds.prototype.setOrdinate=function(a,h,y){switch(h){case zt.X:this._coordinates[a].x=y;break;case zt.Y:this._coordinates[a].y=y;break;case zt.Z:this._coordinates[a].z=y;break;default:throw new ce("invalid ordinateIndex")}},Ds.prototype.size=function(){return this._coordinates.length},Ds.prototype.getOrdinate=function(a,h){switch(h){case zt.X:return this._coordinates[a].x;case zt.Y:return this._coordinates[a].y;case zt.Z:return this._coordinates[a].z}return ee.NaN},Ds.prototype.getCoordinate=function(){if(1===arguments.length)return this._coordinates[arguments[0]];if(2===arguments.length){var h=arguments[0],y=arguments[1];y.x=this._coordinates[h].x,y.y=this._coordinates[h].y,y.z=this._coordinates[h].z}},Ds.prototype.getCoordinateCopy=function(a){return new re(this._coordinates[a])},Ds.prototype.getDimension=function(){return this._dimension},Ds.prototype.getX=function(a){return this._coordinates[a].x},Ds.prototype.clone=function(){for(var a=new Array(this.size()).fill(null),h=0;h<this._coordinates.length;h++)a[h]=this._coordinates[h].clone();return new Ds(a,this._dimension)},Ds.prototype.expandEnvelope=function(a){for(var h=0;h<this._coordinates.length;h++)a.expandToInclude(this._coordinates[h]);return a},Ds.prototype.copy=function(){for(var a=new Array(this.size()).fill(null),h=0;h<this._coordinates.length;h++)a[h]=this._coordinates[h].copy();return new Ds(a,this._dimension)},Ds.prototype.toString=function(){if(this._coordinates.length>0){var a=new Ue(17*this._coordinates.length);a.append("("),a.append(this._coordinates[0]);for(var h=1;h<this._coordinates.length;h++)a.append(", "),a.append(this._coordinates[h]);return a.append(")"),a.toString()}return"()"},Ds.prototype.getY=function(a){return this._coordinates[a].y},Ds.prototype.toCoordinateArray=function(){return this._coordinates},Ds.prototype.interfaces_=function(){return[zt,me]},Ds.prototype.getClass=function(){return Ds},bs.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(Ds,bs);var Xu=function(){},Qr={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Xu.prototype.readResolve=function(){return Xu.instance()},Xu.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new Ds(arguments[0]);if(Bt(arguments[0],zt))return new Ds(arguments[0])}else if(2===arguments.length){var y=arguments[0],x=arguments[1];return x>3&&(x=3),x<2?new Ds(y):new Ds(y,x)}},Xu.prototype.interfaces_=function(){return[it,me]},Xu.prototype.getClass=function(){return Xu},Xu.instance=function(){return Xu.instanceObject},Qr.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},Qr.instanceObject.get=function(){return new Xu},Object.defineProperties(Xu,Qr);var Pc=function(a){function h(){a.call(this),this.map_=new Map}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.get=function(y){return this.map_.get(y)||null},h.prototype.put=function(y,x){return this.map_.set(y,x),x},h.prototype.values=function(){for(var y=new Ze,x=this.map_.values(),D=x.next();!D.done;)y.add(D.value),D=x.next();return y},h.prototype.entrySet=function(){var y=new li;return this.map_.entries().forEach(function(x){return y.add(x)}),y},h.prototype.size=function(){return this.map_.size()},h}(Sn),pn=function a(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=a.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof zr){var h=arguments[0];this._modelType=h,h===a.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var y=arguments[0];this._modelType=a.FIXED,this.setScale(y)}else if(arguments[0]instanceof a){var x=arguments[0];this._modelType=x._modelType,this._scale=x._scale}},Zr={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};pn.prototype.equals=function(a){return a instanceof pn&&this._modelType===a._modelType&&this._scale===a._scale},pn.prototype.compareTo=function(a){var h=a,y=this.getMaximumSignificantDigits(),x=h.getMaximumSignificantDigits();return new ft(y).compareTo(new ft(x))},pn.prototype.getScale=function(){return this._scale},pn.prototype.isFloating=function(){return this._modelType===pn.FLOATING||this._modelType===pn.FLOATING_SINGLE},pn.prototype.getType=function(){return this._modelType},pn.prototype.toString=function(){var a="UNKNOWN";return this._modelType===pn.FLOATING?a="Floating":this._modelType===pn.FLOATING_SINGLE?a="Floating-Single":this._modelType===pn.FIXED&&(a="Fixed (Scale="+this.getScale()+")"),a},pn.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var a=arguments[0];return ee.isNaN(a)||this._modelType===pn.FLOATING_SINGLE?a:this._modelType===pn.FIXED?Math.round(a*this._scale)/this._scale:a}if(arguments[0]instanceof re){var h=arguments[0];if(this._modelType===pn.FLOATING)return null;h.x=this.makePrecise(h.x),h.y=this.makePrecise(h.y)}},pn.prototype.getMaximumSignificantDigits=function(){var a=16;return this._modelType===pn.FLOATING?a=16:this._modelType===pn.FLOATING_SINGLE?a=6:this._modelType===pn.FIXED&&(a=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),a},pn.prototype.setScale=function(a){this._scale=Math.abs(a)},pn.prototype.interfaces_=function(){return[me,oe]},pn.prototype.getClass=function(){return pn},pn.mostPrecise=function(a,h){return a.compareTo(h)>=0?a:h},Zr.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},Zr.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(pn,Zr);var zr=function a(h){this._name=h||null,a.nameToTypeMap.put(h,this)},Ya={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};zr.prototype.readResolve=function(){return zr.nameToTypeMap.get(this._name)},zr.prototype.toString=function(){return this._name},zr.prototype.interfaces_=function(){return[me]},zr.prototype.getClass=function(){return zr},Ya.serialVersionUID.get=function(){return-552860263173159e4},Ya.nameToTypeMap.get=function(){return new Pc},Object.defineProperties(zr,Ya),pn.Type=zr,pn.FIXED=new zr("FIXED"),pn.FLOATING=new zr("FLOATING"),pn.FLOATING_SINGLE=new zr("FLOATING SINGLE");var er=function a(){this._precisionModel=new pn,this._SRID=0,this._coordinateSequenceFactory=a.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?Bt(arguments[0],it)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof pn&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},di={serialVersionUID:{configurable:!0}};er.prototype.toGeometry=function(a){return a.isNull()?this.createPoint(null):a.getMinX()===a.getMaxX()&&a.getMinY()===a.getMaxY()?this.createPoint(new re(a.getMinX(),a.getMinY())):a.getMinX()===a.getMaxX()||a.getMinY()===a.getMaxY()?this.createLineString([new re(a.getMinX(),a.getMinY()),new re(a.getMaxX(),a.getMaxY())]):this.createPolygon(this.createLinearRing([new re(a.getMinX(),a.getMinY()),new re(a.getMinX(),a.getMaxY()),new re(a.getMaxX(),a.getMaxY()),new re(a.getMaxX(),a.getMinY()),new re(a.getMinX(),a.getMinY())]),null)},er.prototype.createLineString=function(a){return a?a instanceof Array?new ps(this.getCoordinateSequenceFactory().create(a),this):Bt(a,zt)?new ps(a,this):void 0:new ps(this.getCoordinateSequenceFactory().create([]),this)},er.prototype.createMultiLineString=function(){return 0===arguments.length?new pl(null,this):1===arguments.length?new pl(arguments[0],this):void 0},er.prototype.buildGeometry=function(a){for(var h=null,y=!1,x=!1,D=a.iterator();D.hasNext();){var U=D.next(),H=U.getClass();null===h&&(h=H),H!==h&&(y=!0),U.isGeometryCollectionOrDerived()&&(x=!0)}if(null===h)return this.createGeometryCollection();if(y||x)return this.createGeometryCollection(er.toGeometryArray(a));var pe=a.iterator().next();if(a.size()>1){if(pe instanceof ms)return this.createMultiPolygon(er.toPolygonArray(a));if(pe instanceof ps)return this.createMultiLineString(er.toLineStringArray(a));if(pe instanceof gs)return this.createMultiPoint(er.toPointArray(a));Se.shouldNeverReachHere("Unhandled class: "+pe.getClass().getName())}return pe},er.prototype.createMultiPointFromCoords=function(a){return this.createMultiPoint(null!==a?this.getCoordinateSequenceFactory().create(a):null)},er.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof re){var a=arguments[0];return this.createPoint(null!==a?this.getCoordinateSequenceFactory().create([a]):null)}if(Bt(arguments[0],zt))return new gs(arguments[0],this)}},er.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},er.prototype.createPolygon=function(){if(0===arguments.length)return new ms(null,null,this);if(1===arguments.length){if(Bt(arguments[0],zt))return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof Array)return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof Za)return this.createPolygon(arguments[0],null)}else if(2===arguments.length)return new ms(arguments[0],arguments[1],this)},er.prototype.getSRID=function(){return this._SRID},er.prototype.createGeometryCollection=function(){return 0===arguments.length?new zi(null,this):1===arguments.length?new zi(arguments[0],this):void 0},er.prototype.createGeometry=function(a){return new Na(this).edit(a,{edit:function(){if(2===arguments.length)return this._coordinateSequenceFactory.create(arguments[0])}})},er.prototype.getPrecisionModel=function(){return this._precisionModel},er.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var a=arguments[0];return this.createLinearRing(null!==a?this.getCoordinateSequenceFactory().create(a):null)}if(Bt(arguments[0],zt))return new Za(arguments[0],this)}},er.prototype.createMultiPolygon=function(){return 0===arguments.length?new Oa(null,this):1===arguments.length?new Oa(arguments[0],this):void 0},er.prototype.createMultiPoint=function(){if(0===arguments.length)return new Ac(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new Ac(arguments[0],this);if(arguments[0]instanceof Array){var h=arguments[0];return this.createMultiPoint(null!==h?this.getCoordinateSequenceFactory().create(h):null)}if(Bt(arguments[0],zt)){var y=arguments[0];if(null===y)return this.createMultiPoint(new Array(0).fill(null));for(var x=new Array(y.size()).fill(null),D=0;D<y.size();D++){var U=this.getCoordinateSequenceFactory().create(1,y.getDimension());ns.copy(y,D,U,0,1),x[D]=this.createPoint(U)}return this.createMultiPoint(x)}}},er.prototype.interfaces_=function(){return[me]},er.prototype.getClass=function(){return er},er.toMultiPolygonArray=function(a){var h=new Array(a.size()).fill(null);return a.toArray(h)},er.toGeometryArray=function(a){if(null===a)return null;var h=new Array(a.size()).fill(null);return a.toArray(h)},er.getDefaultCoordinateSequenceFactory=function(){return Xu.instance()},er.toMultiLineStringArray=function(a){var h=new Array(a.size()).fill(null);return a.toArray(h)},er.toLineStringArray=function(a){var h=new Array(a.size()).fill(null);return a.toArray(h)},er.toMultiPointArray=function(a){var h=new Array(a.size()).fill(null);return a.toArray(h)},er.toLinearRingArray=function(a){var h=new Array(a.size()).fill(null);return a.toArray(h)},er.toPointArray=function(a){var h=new Array(a.size()).fill(null);return a.toArray(h)},er.toPolygonArray=function(a){var h=new Array(a.size()).fill(null);return a.toArray(h)},er.createPointFromInternalCoord=function(a,h){return h.getPrecisionModel().makePrecise(a),h.getFactory().createPoint(a)},di.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(er,di);var yo=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Gl=function(a){this.geometryFactory=a||new er};Gl.prototype.read=function(a){var h,y=(h="string"==typeof a?JSON.parse(a):a).type;if(!Ia[y])throw new Error("Unknown GeoJSON type: "+h.type);return-1!==yo.indexOf(y)?Ia[y].apply(this,[h.coordinates]):Ia[y].apply(this,"GeometryCollection"===y?[h.geometries]:[h])},Gl.prototype.write=function(a){var h=a.getGeometryType();if(!Qs[h])throw new Error("Geometry is not supported");return Qs[h].apply(this,[a])};var Ia={Feature:function(a){var h={};for(var y in a)h[y]=a[y];if(a.geometry){if(!Ia[a.geometry.type])throw new Error("Unknown GeoJSON type: "+a.type);h.geometry=this.read(a.geometry)}return a.bbox&&(h.bbox=Ia.bbox.apply(this,[a.bbox])),h},FeatureCollection:function(a){var h={};if(a.features){h.features=[];for(var y=0;y<a.features.length;++y)h.features.push(this.read(a.features[y]))}return a.bbox&&(h.bbox=this.parse.bbox.apply(this,[a.bbox])),h},coordinates:function(a){for(var h=[],y=0;y<a.length;++y){var x=a[y];h.push(new re(x[0],x[1]))}return h},bbox:function(a){return this.geometryFactory.createLinearRing([new re(a[0],a[1]),new re(a[2],a[1]),new re(a[2],a[3]),new re(a[0],a[3]),new re(a[0],a[1])])},Point:function(a){var h=new re(a[0],a[1]);return this.geometryFactory.createPoint(h)},MultiPoint:function(a){for(var h=[],y=0;y<a.length;++y)h.push(Ia.Point.apply(this,[a[y]]));return this.geometryFactory.createMultiPoint(h)},LineString:function(a){var h=Ia.coordinates.apply(this,[a]);return this.geometryFactory.createLineString(h)},MultiLineString:function(a){for(var h=[],y=0;y<a.length;++y)h.push(Ia.LineString.apply(this,[a[y]]));return this.geometryFactory.createMultiLineString(h)},Polygon:function(a){for(var h=Ia.coordinates.apply(this,[a[0]]),y=this.geometryFactory.createLinearRing(h),x=[],D=1;D<a.length;++D){var H=Ia.coordinates.apply(this,[a[D]]),pe=this.geometryFactory.createLinearRing(H);x.push(pe)}return this.geometryFactory.createPolygon(y,x)},MultiPolygon:function(a){for(var h=[],y=0;y<a.length;++y)h.push(Ia.Polygon.apply(this,[a[y]]));return this.geometryFactory.createMultiPolygon(h)},GeometryCollection:function(a){for(var h=[],y=0;y<a.length;++y)h.push(this.read(a[y]));return this.geometryFactory.createGeometryCollection(h)}},Qs={coordinate:function(a){return[a.x,a.y]},Point:function(a){return{type:"Point",coordinates:Qs.coordinate.apply(this,[a.getCoordinate()])}},MultiPoint:function(a){for(var h=[],y=0;y<a._geometries.length;++y){var D=Qs.Point.apply(this,[a._geometries[y]]);h.push(D.coordinates)}return{type:"MultiPoint",coordinates:h}},LineString:function(a){for(var h=[],y=a.getCoordinates(),x=0;x<y.length;++x)h.push(Qs.coordinate.apply(this,[y[x]]));return{type:"LineString",coordinates:h}},MultiLineString:function(a){for(var h=[],y=0;y<a._geometries.length;++y){var D=Qs.LineString.apply(this,[a._geometries[y]]);h.push(D.coordinates)}return{type:"MultiLineString",coordinates:h}},Polygon:function(a){var h=[],y=Qs.LineString.apply(this,[a._shell]);h.push(y.coordinates);for(var x=0;x<a._holes.length;++x){var U=Qs.LineString.apply(this,[a._holes[x]]);h.push(U.coordinates)}return{type:"Polygon",coordinates:h}},MultiPolygon:function(a){for(var h=[],y=0;y<a._geometries.length;++y){var D=Qs.Polygon.apply(this,[a._geometries[y]]);h.push(D.coordinates)}return{type:"MultiPolygon",coordinates:h}},GeometryCollection:function(a){for(var h=[],y=0;y<a._geometries.length;++y){var x=a._geometries[y],D=x.getGeometryType();h.push(Qs[D].apply(this,[x]))}return{type:"GeometryCollection",geometries:h}}},ur=function(a){this.geometryFactory=a||new er,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new Gl(this.geometryFactory)};ur.prototype.read=function(a){var h=this.parser.read(a);return this.precisionModel.getType()===pn.FIXED&&this.reducePrecision(h),h},ur.prototype.reducePrecision=function(a){var h,y;if(a.coordinate)this.precisionModel.makePrecise(a.coordinate);else if(a.points)for(h=0,y=a.points.length;h<y;h++)this.precisionModel.makePrecise(a.points[h]);else if(a.geometries)for(h=0,y=a.geometries.length;h<y;h++)this.reducePrecision(a.geometries[h])};var hh=function(){this.parser=new Gl(this.geometryFactory)};hh.prototype.write=function(a){return this.parser.write(a)};var Tn=function(){},Il={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};Tn.prototype.interfaces_=function(){return[]},Tn.prototype.getClass=function(){return Tn},Tn.opposite=function(a){return a===Tn.LEFT?Tn.RIGHT:a===Tn.RIGHT?Tn.LEFT:a},Il.ON.get=function(){return 0},Il.LEFT.get=function(){return 1},Il.RIGHT.get=function(){return 2},Object.defineProperties(Tn,Il),(le.prototype=new Error).name="EmptyStackException",(K.prototype=new ct).add=function(a){return this.array_.push(a),!0},K.prototype.get=function(a){if(a<0||a>=this.size())throw new Error;return this.array_[a]},K.prototype.push=function(a){return this.array_.push(a),a},K.prototype.pop=function(a){if(0===this.array_.length)throw new le;return this.array_.pop()},K.prototype.peek=function(){if(0===this.array_.length)throw new le;return this.array_[this.array_.length-1]},K.prototype.empty=function(){return 0===this.array_.length},K.prototype.isEmpty=function(){return this.empty()},K.prototype.search=function(a){return this.array_.indexOf(a)},K.prototype.size=function(){return this.array_.length},K.prototype.toArray=function(){for(var a=[],h=0,y=this.array_.length;h<y;h++)a.push(this.array_[h]);return a};var Ka=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Ka.prototype.getCoordinate=function(){return this._minCoord},Ka.prototype.getRightmostSide=function(a,h){var y=this.getRightmostSideOfSegment(a,h);return y<0&&(y=this.getRightmostSideOfSegment(a,h-1)),y<0&&(this._minCoord=null,this.checkForRightmostCoordinate(a)),y},Ka.prototype.findRightmostEdgeAtVertex=function(){var a=this._minDe.getEdge().getCoordinates();Se.isTrue(this._minIndex>0&&this._minIndex<a.length,"rightmost point expected to be interior vertex of edge");var h=a[this._minIndex-1],y=a[this._minIndex+1],x=en.computeOrientation(this._minCoord,y,h),D=!1;(h.y<this._minCoord.y&&y.y<this._minCoord.y&&x===en.COUNTERCLOCKWISE||h.y>this._minCoord.y&&y.y>this._minCoord.y&&x===en.CLOCKWISE)&&(D=!0),D&&(this._minIndex=this._minIndex-1)},Ka.prototype.getRightmostSideOfSegment=function(a,h){var y=a.getEdge().getCoordinates();if(h<0||h+1>=y.length||y[h].y===y[h+1].y)return-1;var x=Tn.LEFT;return y[h].y<y[h+1].y&&(x=Tn.RIGHT),x},Ka.prototype.getEdge=function(){return this._orientedDe},Ka.prototype.checkForRightmostCoordinate=function(a){for(var h=a.getEdge().getCoordinates(),y=0;y<h.length-1;y++)(null===this._minCoord||h[y].x>this._minCoord.x)&&(this._minDe=a,this._minIndex=y,this._minCoord=h[y])},Ka.prototype.findRightmostEdgeAtNode=function(){var a=this._minDe.getNode().getEdges();this._minDe=a.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},Ka.prototype.findEdge=function(a){for(var h=a.iterator();h.hasNext();){var y=h.next();y.isForward()&&this.checkForRightmostCoordinate(y)}Se.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Tn.LEFT&&(this._orientedDe=this._minDe.getSym())},Ka.prototype.interfaces_=function(){return[]},Ka.prototype.getClass=function(){return Ka};var Hn=function(a){function h(y,x){a.call(this,h.msgWithCoord(y,x)),this.pt=x?new re(x):null,this.name="TopologyException"}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.getCoordinate=function(){return this.pt},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.msgWithCoord=function(y,x){return x?y:y+" [ "+x+" ]"},h}(Re),Wc=function(){this.array_=[]};Wc.prototype.addLast=function(a){this.array_.push(a)},Wc.prototype.removeFirst=function(){return this.array_.shift()},Wc.prototype.isEmpty=function(){return 0===this.array_.length};var dr=function(){this._finder=null,this._dirEdgeList=new Ze,this._nodes=new Ze,this._rightMostCoord=null,this._env=null,this._finder=new Ka};dr.prototype.clearVisitedEdges=function(){for(var a=this._dirEdgeList.iterator();a.hasNext();)a.next().setVisited(!1)},dr.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},dr.prototype.computeNodeDepth=function(a){for(var h=null,y=a.getEdges().iterator();y.hasNext();){var x=y.next();if(x.isVisited()||x.getSym().isVisited()){h=x;break}}if(null===h)throw new Hn("unable to find edge to compute depths at "+a.getCoordinate());a.getEdges().computeDepths(h);for(var D=a.getEdges().iterator();D.hasNext();){var U=D.next();U.setVisited(!0),this.copySymDepths(U)}},dr.prototype.computeDepth=function(a){this.clearVisitedEdges();var h=this._finder.getEdge();h.setEdgeDepths(Tn.RIGHT,a),this.copySymDepths(h),this.computeDepths(h)},dr.prototype.create=function(a){this.addReachable(a),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},dr.prototype.findResultEdges=function(){for(var a=this._dirEdgeList.iterator();a.hasNext();){var h=a.next();h.getDepth(Tn.RIGHT)>=1&&h.getDepth(Tn.LEFT)<=0&&!h.isInteriorAreaEdge()&&h.setInResult(!0)}},dr.prototype.computeDepths=function(a){var h=new li,y=new Wc,x=a.getNode();for(y.addLast(x),h.add(x),a.setVisited(!0);!y.isEmpty();){var D=y.removeFirst();h.add(D),this.computeNodeDepth(D);for(var U=D.getEdges().iterator();U.hasNext();){var H=U.next().getSym();if(!H.isVisited()){var pe=H.getNode();h.contains(pe)||(y.addLast(pe),h.add(pe))}}}},dr.prototype.compareTo=function(a){return this._rightMostCoord.x<a._rightMostCoord.x?-1:this._rightMostCoord.x>a._rightMostCoord.x?1:0},dr.prototype.getEnvelope=function(){if(null===this._env){for(var a=new wn,h=this._dirEdgeList.iterator();h.hasNext();)for(var y=h.next().getEdge().getCoordinates(),x=0;x<y.length-1;x++)a.expandToInclude(y[x]);this._env=a}return this._env},dr.prototype.addReachable=function(a){var h=new K;for(h.add(a);!h.empty();){var y=h.pop();this.add(y,h)}},dr.prototype.copySymDepths=function(a){var h=a.getSym();h.setDepth(Tn.LEFT,a.getDepth(Tn.RIGHT)),h.setDepth(Tn.RIGHT,a.getDepth(Tn.LEFT))},dr.prototype.add=function(a,h){a.setVisited(!0),this._nodes.add(a);for(var y=a.getEdges().iterator();y.hasNext();){var x=y.next();this._dirEdgeList.add(x);var D=x.getSym().getNode();D.isVisited()||h.push(D)}},dr.prototype.getNodes=function(){return this._nodes},dr.prototype.getDirectedEdges=function(){return this._dirEdgeList},dr.prototype.interfaces_=function(){return[oe]},dr.prototype.getClass=function(){return dr};var vr=function a(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array)this.init(arguments[0].length);else if(Number.isInteger(arguments[0])){var y=arguments[0];this.init(1),this.location[Tn.ON]=y}else if(arguments[0]instanceof a){var x=arguments[0];if(this.init(x.location.length),null!==x)for(var D=0;D<this.location.length;D++)this.location[D]=x.location[D]}}else if(3===arguments.length){var U=arguments[0],H=arguments[1],pe=arguments[2];this.init(3),this.location[Tn.ON]=U,this.location[Tn.LEFT]=H,this.location[Tn.RIGHT]=pe}};vr.prototype.setAllLocations=function(a){for(var h=0;h<this.location.length;h++)this.location[h]=a},vr.prototype.isNull=function(){for(var a=0;a<this.location.length;a++)if(this.location[a]!==Ne.NONE)return!1;return!0},vr.prototype.setAllLocationsIfNull=function(a){for(var h=0;h<this.location.length;h++)this.location[h]===Ne.NONE&&(this.location[h]=a)},vr.prototype.isLine=function(){return 1===this.location.length},vr.prototype.merge=function(a){if(a.location.length>this.location.length){var h=new Array(3).fill(null);h[Tn.ON]=this.location[Tn.ON],h[Tn.LEFT]=Ne.NONE,h[Tn.RIGHT]=Ne.NONE,this.location=h}for(var y=0;y<this.location.length;y++)this.location[y]===Ne.NONE&&y<a.location.length&&(this.location[y]=a.location[y])},vr.prototype.getLocations=function(){return this.location},vr.prototype.flip=function(){if(this.location.length<=1)return null;var a=this.location[Tn.LEFT];this.location[Tn.LEFT]=this.location[Tn.RIGHT],this.location[Tn.RIGHT]=a},vr.prototype.toString=function(){var a=new Ue;return this.location.length>1&&a.append(Ne.toLocationSymbol(this.location[Tn.LEFT])),a.append(Ne.toLocationSymbol(this.location[Tn.ON])),this.location.length>1&&a.append(Ne.toLocationSymbol(this.location[Tn.RIGHT])),a.toString()},vr.prototype.setLocations=function(a,h,y){this.location[Tn.ON]=a,this.location[Tn.LEFT]=h,this.location[Tn.RIGHT]=y},vr.prototype.get=function(a){return a<this.location.length?this.location[a]:Ne.NONE},vr.prototype.isArea=function(){return this.location.length>1},vr.prototype.isAnyNull=function(){for(var a=0;a<this.location.length;a++)if(this.location[a]===Ne.NONE)return!0;return!1},vr.prototype.setLocation=function(){1===arguments.length?this.setLocation(Tn.ON,arguments[0]):2===arguments.length&&(this.location[arguments[0]]=arguments[1])},vr.prototype.init=function(a){this.location=new Array(a).fill(null),this.setAllLocations(Ne.NONE)},vr.prototype.isEqualOnSide=function(a,h){return this.location[h]===a.location[h]},vr.prototype.allPositionsEqual=function(a){for(var h=0;h<this.location.length;h++)if(this.location[h]!==a)return!1;return!0},vr.prototype.interfaces_=function(){return[]},vr.prototype.getClass=function(){return vr};var Ui=function a(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var h=arguments[0];this.elt[0]=new vr(h),this.elt[1]=new vr(h)}else if(arguments[0]instanceof a){var y=arguments[0];this.elt[0]=new vr(y.elt[0]),this.elt[1]=new vr(y.elt[1])}}else if(2===arguments.length){var x=arguments[0],D=arguments[1];this.elt[0]=new vr(Ne.NONE),this.elt[1]=new vr(Ne.NONE),this.elt[x].setLocation(D)}else if(3===arguments.length){var U=arguments[0],H=arguments[1],pe=arguments[2];this.elt[0]=new vr(U,H,pe),this.elt[1]=new vr(U,H,pe)}else if(4===arguments.length){var Ge=arguments[0],wt=arguments[1],qt=arguments[2],nn=arguments[3];this.elt[0]=new vr(Ne.NONE,Ne.NONE,Ne.NONE),this.elt[1]=new vr(Ne.NONE,Ne.NONE,Ne.NONE),this.elt[Ge].setLocations(wt,qt,nn)}};Ui.prototype.getGeometryCount=function(){var a=0;return this.elt[0].isNull()||a++,this.elt[1].isNull()||a++,a},Ui.prototype.setAllLocations=function(a,h){this.elt[a].setAllLocations(h)},Ui.prototype.isNull=function(a){return this.elt[a].isNull()},Ui.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var a=arguments[0];this.setAllLocationsIfNull(0,a),this.setAllLocationsIfNull(1,a)}else 2===arguments.length&&this.elt[arguments[0]].setAllLocationsIfNull(arguments[1])},Ui.prototype.isLine=function(a){return this.elt[a].isLine()},Ui.prototype.merge=function(a){for(var h=0;h<2;h++)null===this.elt[h]&&null!==a.elt[h]?this.elt[h]=new vr(a.elt[h]):this.elt[h].merge(a.elt[h])},Ui.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},Ui.prototype.getLocation=function(){return 1===arguments.length?this.elt[arguments[0]].get(Tn.ON):2===arguments.length?this.elt[arguments[0]].get(arguments[1]):void 0},Ui.prototype.toString=function(){var a=new Ue;return null!==this.elt[0]&&(a.append("A:"),a.append(this.elt[0].toString())),null!==this.elt[1]&&(a.append(" B:"),a.append(this.elt[1].toString())),a.toString()},Ui.prototype.isArea=function(){return 0===arguments.length?this.elt[0].isArea()||this.elt[1].isArea():1===arguments.length?this.elt[arguments[0]].isArea():void 0},Ui.prototype.isAnyNull=function(a){return this.elt[a].isAnyNull()},Ui.prototype.setLocation=function(){2===arguments.length?this.elt[arguments[0]].setLocation(Tn.ON,arguments[1]):3===arguments.length&&this.elt[arguments[0]].setLocation(arguments[1],arguments[2])},Ui.prototype.isEqualOnSide=function(a,h){return this.elt[0].isEqualOnSide(a.elt[0],h)&&this.elt[1].isEqualOnSide(a.elt[1],h)},Ui.prototype.allPositionsEqual=function(a,h){return this.elt[a].allPositionsEqual(h)},Ui.prototype.toLine=function(a){this.elt[a].isArea()&&(this.elt[a]=new vr(this.elt[a].location[0]))},Ui.prototype.interfaces_=function(){return[]},Ui.prototype.getClass=function(){return Ui},Ui.toLineLabel=function(a){for(var h=new Ui(Ne.NONE),y=0;y<2;y++)h.setLocation(y,a.getLocation(y));return h};var rs=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new Ze,this._pts=new Ze,this._label=new Ui(Ne.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Ze,this._geometryFactory=null;var a=arguments[0];this._geometryFactory=arguments[1],this.computePoints(a),this.computeRing()};rs.prototype.computeRing=function(){if(null!==this._ring)return null;for(var a=new Array(this._pts.size()).fill(null),h=0;h<this._pts.size();h++)a[h]=this._pts.get(h);this._ring=this._geometryFactory.createLinearRing(a),this._isHole=en.isCCW(this._ring.getCoordinates())},rs.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},rs.prototype.computePoints=function(a){this._startDe=a;var h=a,y=!0;do{if(null===h)throw new Hn("Found null DirectedEdge");if(h.getEdgeRing()===this)throw new Hn("Directed Edge visited twice during ring-building at "+h.getCoordinate());this._edges.add(h);var x=h.getLabel();Se.isTrue(x.isArea()),this.mergeLabel(x),this.addPoints(h.getEdge(),h.isForward(),y),y=!1,this.setEdgeRing(h,this),h=this.getNext(h)}while(h!==this._startDe)},rs.prototype.getLinearRing=function(){return this._ring},rs.prototype.getCoordinate=function(a){return this._pts.get(a)},rs.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var a=this._startDe;do{var h=a.getNode().getEdges().getOutgoingDegree(this);h>this._maxNodeDegree&&(this._maxNodeDegree=h),a=this.getNext(a)}while(a!==this._startDe);this._maxNodeDegree*=2},rs.prototype.addPoints=function(a,h,y){var x=a.getCoordinates();if(h){var D=1;y&&(D=0);for(var U=D;U<x.length;U++)this._pts.add(x[U])}else{var H=x.length-2;y&&(H=x.length-1);for(var pe=H;pe>=0;pe--)this._pts.add(x[pe])}},rs.prototype.isHole=function(){return this._isHole},rs.prototype.setInResult=function(){var a=this._startDe;do{a.getEdge().setInResult(!0),a=a.getNext()}while(a!==this._startDe)},rs.prototype.containsPoint=function(a){var h=this.getLinearRing();if(!h.getEnvelopeInternal().contains(a)||!en.isPointInRing(a,h.getCoordinates()))return!1;for(var y=this._holes.iterator();y.hasNext();)if(y.next().containsPoint(a))return!1;return!0},rs.prototype.addHole=function(a){this._holes.add(a)},rs.prototype.isShell=function(){return null===this._shell},rs.prototype.getLabel=function(){return this._label},rs.prototype.getEdges=function(){return this._edges},rs.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},rs.prototype.getShell=function(){return this._shell},rs.prototype.mergeLabel=function(){if(1===arguments.length){var a=arguments[0];this.mergeLabel(a,0),this.mergeLabel(a,1)}else if(2===arguments.length){var y=arguments[1],x=arguments[0].getLocation(y,Tn.RIGHT);if(x===Ne.NONE)return null;if(this._label.getLocation(y)===Ne.NONE)return this._label.setLocation(y,x),null}},rs.prototype.setShell=function(a){this._shell=a,null!==a&&a.addHole(this)},rs.prototype.toPolygon=function(a){for(var h=new Array(this._holes.size()).fill(null),y=0;y<this._holes.size();y++)h[y]=this._holes.get(y).getLinearRing();return a.createPolygon(this.getLinearRing(),h)},rs.prototype.interfaces_=function(){return[]},rs.prototype.getClass=function(){return rs};var Zu=function(a){function h(){a.call(this,arguments[0],arguments[1])}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.setEdgeRing=function(y,x){y.setMinEdgeRing(x)},h.prototype.getNext=function(y){return y.getNextMin()},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(rs),zs=function(a){function h(){a.call(this,arguments[0],arguments[1])}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.buildMinimalRings=function(){var y=new Ze,x=this._startDe;do{if(null===x.getMinEdgeRing()){var D=new Zu(x,this._geometryFactory);y.add(D)}x=x.getNext()}while(x!==this._startDe);return y},h.prototype.setEdgeRing=function(y,x){y.setEdgeRing(x)},h.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var y=this._startDe;do{y.getNode().getEdges().linkMinimalDirectedEdges(this),y=y.getNext()}while(y!==this._startDe)},h.prototype.getNext=function(y){return y.getNext()},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(rs),is=function(){this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0!==arguments.length&&1===arguments.length&&(this._label=arguments[0])};is.prototype.setVisited=function(a){this._isVisited=a},is.prototype.setInResult=function(a){this._isInResult=a},is.prototype.isCovered=function(){return this._isCovered},is.prototype.isCoveredSet=function(){return this._isCoveredSet},is.prototype.setLabel=function(a){this._label=a},is.prototype.getLabel=function(){return this._label},is.prototype.setCovered=function(a){this._isCovered=a,this._isCoveredSet=!0},is.prototype.updateIM=function(a){Se.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(a)},is.prototype.isInResult=function(){return this._isInResult},is.prototype.isVisited=function(){return this._isVisited},is.prototype.interfaces_=function(){return[]},is.prototype.getClass=function(){return is};var kh=function(a){function h(){a.call(this),this._coord=null,this._edges=null;var x=arguments[1];this._coord=arguments[0],this._edges=x,this._label=new Ui(0,Ne.NONE)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.isIncidentEdgeInResult=function(){for(var y=this.getEdges().getEdges().iterator();y.hasNext();)if(y.next().getEdge().isInResult())return!0;return!1},h.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},h.prototype.getCoordinate=function(){return this._coord},h.prototype.print=function(y){y.println("node "+this._coord+" lbl: "+this._label)},h.prototype.computeIM=function(y){},h.prototype.computeMergedLocation=function(y,x){var D=Ne.NONE;if(D=this._label.getLocation(x),!y.isNull(x)){var U=y.getLocation(x);D!==Ne.BOUNDARY&&(D=U)}return D},h.prototype.setLabel=function(){if(2!==arguments.length)return a.prototype.setLabel.apply(this,arguments);var y=arguments[0],x=arguments[1];null===this._label?this._label=new Ui(y,x):this._label.setLocation(y,x)},h.prototype.getEdges=function(){return this._edges},h.prototype.mergeLabel=function(){if(arguments[0]instanceof h)this.mergeLabel(arguments[0]._label);else if(arguments[0]instanceof Ui)for(var x=arguments[0],D=0;D<2;D++){var U=this.computeMergedLocation(x,D);this._label.getLocation(D)===Ne.NONE&&this._label.setLocation(D,U)}},h.prototype.add=function(y){this._edges.insert(y),y.setNode(this)},h.prototype.setLabelBoundary=function(y){if(null===this._label)return null;var x=Ne.NONE;null!==this._label&&(x=this._label.getLocation(y)),this._label.setLocation(y,x===Ne.BOUNDARY?Ne.INTERIOR:Ne.BOUNDARY)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(is),Us=function(){this.nodeMap=new gt,this.nodeFact=null,this.nodeFact=arguments[0]};Us.prototype.find=function(a){return this.nodeMap.get(a)},Us.prototype.addNode=function(){if(arguments[0]instanceof re){var a=arguments[0],h=this.nodeMap.get(a);return null===h&&(h=this.nodeFact.createNode(a),this.nodeMap.put(a,h)),h}if(arguments[0]instanceof kh){var y=arguments[0],x=this.nodeMap.get(y.getCoordinate());return null===x?(this.nodeMap.put(y.getCoordinate(),y),y):(x.mergeLabel(y),x)}},Us.prototype.print=function(a){for(var h=this.iterator();h.hasNext();)h.next().print(a)},Us.prototype.iterator=function(){return this.nodeMap.values().iterator()},Us.prototype.values=function(){return this.nodeMap.values()},Us.prototype.getBoundaryNodes=function(a){for(var h=new Ze,y=this.iterator();y.hasNext();){var x=y.next();x.getLabel().getLocation(a)===Ne.BOUNDARY&&h.add(x)}return h},Us.prototype.add=function(a){var h=a.getCoordinate();this.addNode(h).add(a)},Us.prototype.interfaces_=function(){return[]},Us.prototype.getClass=function(){return Us};var Ti=function(){},gl={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Ti.prototype.interfaces_=function(){return[]},Ti.prototype.getClass=function(){return Ti},Ti.isNorthern=function(a){return a===Ti.NE||a===Ti.NW},Ti.isOpposite=function(a,h){return a!==h&&(a-h+4)%4==2},Ti.commonHalfPlane=function(a,h){if(a===h)return a;if((a-h+4)%4==2)return-1;var y=a<h?a:h;return 0===y&&3===(a>h?a:h)?3:y},Ti.isInHalfPlane=function(a,h){return h===Ti.SE?a===Ti.SE||a===Ti.SW:a===h||a===h+1},Ti.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var a=arguments[0],h=arguments[1];if(0===a&&0===h)throw new ce("Cannot compute the quadrant for point ( "+a+", "+h+" )");return a>=0?h>=0?Ti.NE:Ti.SE:h>=0?Ti.NW:Ti.SW}if(arguments[0]instanceof re&&arguments[1]instanceof re){var y=arguments[0],x=arguments[1];if(x.x===y.x&&x.y===y.y)throw new ce("Cannot compute the quadrant for two identical points "+y);return x.x>=y.x?x.y>=y.y?Ti.NE:Ti.SE:x.y>=y.y?Ti.NW:Ti.SW}},gl.NE.get=function(){return 0},gl.NW.get=function(){return 1},gl.SW.get=function(){return 2},gl.SE.get=function(){return 3},Object.defineProperties(Ti,gl);var ua=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length)this._edge=arguments[0];else if(3===arguments.length){var y=arguments[1],x=arguments[2];this._edge=arguments[0],this.init(y,x),this._label=null}else if(4===arguments.length){var U=arguments[1],H=arguments[2],pe=arguments[3];this._edge=arguments[0],this.init(U,H),this._label=pe}};ua.prototype.compareDirection=function(a){return this._dx===a._dx&&this._dy===a._dy?0:this._quadrant>a._quadrant?1:this._quadrant<a._quadrant?-1:en.computeOrientation(a._p0,a._p1,this._p1)},ua.prototype.getDy=function(){return this._dy},ua.prototype.getCoordinate=function(){return this._p0},ua.prototype.setNode=function(a){this._node=a},ua.prototype.print=function(a){var h=Math.atan2(this._dy,this._dx),y=this.getClass().getName(),x=y.lastIndexOf("."),D=y.substring(x+1);a.print("  "+D+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+h+"   "+this._label)},ua.prototype.compareTo=function(a){return this.compareDirection(a)},ua.prototype.getDirectedCoordinate=function(){return this._p1},ua.prototype.getDx=function(){return this._dx},ua.prototype.getLabel=function(){return this._label},ua.prototype.getEdge=function(){return this._edge},ua.prototype.getQuadrant=function(){return this._quadrant},ua.prototype.getNode=function(){return this._node},ua.prototype.toString=function(){var a=Math.atan2(this._dy,this._dx),h=this.getClass().getName(),y=h.lastIndexOf(".");return"  "+h.substring(y+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+a+"   "+this._label},ua.prototype.computeLabel=function(a){},ua.prototype.init=function(a,h){this._p0=a,this._p1=h,this._dx=h.x-a.x,this._dy=h.y-a.y,this._quadrant=Ti.quadrant(this._dx,this._dy),Se.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},ua.prototype.interfaces_=function(){return[oe]},ua.prototype.getClass=function(){return ua};var As=function(a){function h(){var y=arguments[0],x=arguments[1];if(a.call(this,y),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=x,x)this.init(y.getCoordinate(0),y.getCoordinate(1));else{var D=y.getNumPoints()-1;this.init(y.getCoordinate(D),y.getCoordinate(D-1))}this.computeDirectedLabel()}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.getNextMin=function(){return this._nextMin},h.prototype.getDepth=function(y){return this._depth[y]},h.prototype.setVisited=function(y){this._isVisited=y},h.prototype.computeDirectedLabel=function(){this._label=new Ui(this._edge.getLabel()),this._isForward||this._label.flip()},h.prototype.getNext=function(){return this._next},h.prototype.setDepth=function(y,x){if(-999!==this._depth[y]&&this._depth[y]!==x)throw new Hn("assigned depths do not match",this.getCoordinate());this._depth[y]=x},h.prototype.isInteriorAreaEdge=function(){for(var y=!0,x=0;x<2;x++)this._label.isArea(x)&&this._label.getLocation(x,Tn.LEFT)===Ne.INTERIOR&&this._label.getLocation(x,Tn.RIGHT)===Ne.INTERIOR||(y=!1);return y},h.prototype.setNextMin=function(y){this._nextMin=y},h.prototype.print=function(y){a.prototype.print.call(this,y),y.print(" "+this._depth[Tn.LEFT]+"/"+this._depth[Tn.RIGHT]),y.print(" ("+this.getDepthDelta()+")"),this._isInResult&&y.print(" inResult")},h.prototype.setMinEdgeRing=function(y){this._minEdgeRing=y},h.prototype.isLineEdge=function(){var y=this._label.isLine(0)||this._label.isLine(1),x=!this._label.isArea(0)||this._label.allPositionsEqual(0,Ne.EXTERIOR),D=!this._label.isArea(1)||this._label.allPositionsEqual(1,Ne.EXTERIOR);return y&&x&&D},h.prototype.setEdgeRing=function(y){this._edgeRing=y},h.prototype.getMinEdgeRing=function(){return this._minEdgeRing},h.prototype.getDepthDelta=function(){var y=this._edge.getDepthDelta();return this._isForward||(y=-y),y},h.prototype.setInResult=function(y){this._isInResult=y},h.prototype.getSym=function(){return this._sym},h.prototype.isForward=function(){return this._isForward},h.prototype.getEdge=function(){return this._edge},h.prototype.printEdge=function(y){this.print(y),y.print(" "),this._isForward?this._edge.print(y):this._edge.printReverse(y)},h.prototype.setSym=function(y){this._sym=y},h.prototype.setVisitedEdge=function(y){this.setVisited(y),this._sym.setVisited(y)},h.prototype.setEdgeDepths=function(y,x){var D=this.getEdge().getDepthDelta();this._isForward||(D=-D);var U=1;y===Tn.LEFT&&(U=-1);var H=Tn.opposite(y),pe=x+D*U;this.setDepth(y,x),this.setDepth(H,pe)},h.prototype.getEdgeRing=function(){return this._edgeRing},h.prototype.isInResult=function(){return this._isInResult},h.prototype.setNext=function(y){this._next=y},h.prototype.isVisited=function(){return this._isVisited},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.depthFactor=function(y,x){return y===Ne.EXTERIOR&&x===Ne.INTERIOR?1:y===Ne.INTERIOR&&x===Ne.EXTERIOR?-1:0},h}(ua),Rc=function(){};Rc.prototype.createNode=function(a){return new kh(a,null)},Rc.prototype.interfaces_=function(){return[]},Rc.prototype.getClass=function(){return Rc};var ys=function(){this._edges=new Ze,this._nodes=null,this._edgeEndList=new Ze,0===arguments.length?this._nodes=new Us(new Rc):1===arguments.length&&(this._nodes=new Us(arguments[0]))};ys.prototype.printEdges=function(a){a.println("Edges:");for(var h=0;h<this._edges.size();h++){a.println("edge "+h+":");var y=this._edges.get(h);y.print(a),y.eiList.print(a)}},ys.prototype.find=function(a){return this._nodes.find(a)},ys.prototype.addNode=function(){return arguments[0]instanceof kh||arguments[0]instanceof re?this._nodes.addNode(arguments[0]):void 0},ys.prototype.getNodeIterator=function(){return this._nodes.iterator()},ys.prototype.linkResultDirectedEdges=function(){for(var a=this._nodes.iterator();a.hasNext();)a.next().getEdges().linkResultDirectedEdges()},ys.prototype.debugPrintln=function(a){xn.out.println(a)},ys.prototype.isBoundaryNode=function(a,h){var y=this._nodes.find(h);if(null===y)return!1;var x=y.getLabel();return null!==x&&x.getLocation(a)===Ne.BOUNDARY},ys.prototype.linkAllDirectedEdges=function(){for(var a=this._nodes.iterator();a.hasNext();)a.next().getEdges().linkAllDirectedEdges()},ys.prototype.matchInSameDirection=function(a,h,y,x){return!!a.equals(y)&&en.computeOrientation(a,h,x)===en.COLLINEAR&&Ti.quadrant(a,h)===Ti.quadrant(y,x)},ys.prototype.getEdgeEnds=function(){return this._edgeEndList},ys.prototype.debugPrint=function(a){xn.out.print(a)},ys.prototype.getEdgeIterator=function(){return this._edges.iterator()},ys.prototype.findEdgeInSameDirection=function(a,h){for(var y=0;y<this._edges.size();y++){var x=this._edges.get(y),D=x.getCoordinates();if(this.matchInSameDirection(a,h,D[0],D[1])||this.matchInSameDirection(a,h,D[D.length-1],D[D.length-2]))return x}return null},ys.prototype.insertEdge=function(a){this._edges.add(a)},ys.prototype.findEdgeEnd=function(a){for(var h=this.getEdgeEnds().iterator();h.hasNext();){var y=h.next();if(y.getEdge()===a)return y}return null},ys.prototype.addEdges=function(a){for(var h=a.iterator();h.hasNext();){var y=h.next();this._edges.add(y);var x=new As(y,!0),D=new As(y,!1);x.setSym(D),D.setSym(x),this.add(x),this.add(D)}},ys.prototype.add=function(a){this._nodes.add(a),this._edgeEndList.add(a)},ys.prototype.getNodes=function(){return this._nodes.values()},ys.prototype.findEdge=function(a,h){for(var y=0;y<this._edges.size();y++){var x=this._edges.get(y),D=x.getCoordinates();if(a.equals(D[0])&&h.equals(D[1]))return x}return null},ys.prototype.interfaces_=function(){return[]},ys.prototype.getClass=function(){return ys},ys.linkResultDirectedEdges=function(a){for(var h=a.iterator();h.hasNext();)h.next().getEdges().linkResultDirectedEdges()};var la=function(){this._geometryFactory=null,this._shellList=new Ze,this._geometryFactory=arguments[0]};la.prototype.sortShellsAndHoles=function(a,h,y){for(var x=a.iterator();x.hasNext();){var D=x.next();D.isHole()?y.add(D):h.add(D)}},la.prototype.computePolygons=function(a){for(var h=new Ze,y=a.iterator();y.hasNext();){var x=y.next().toPolygon(this._geometryFactory);h.add(x)}return h},la.prototype.placeFreeHoles=function(a,h){for(var y=h.iterator();y.hasNext();){var x=y.next();if(null===x.getShell()){var D=this.findEdgeRingContaining(x,a);if(null===D)throw new Hn("unable to assign hole to a shell",x.getCoordinate(0));x.setShell(D)}}},la.prototype.buildMinimalEdgeRings=function(a,h,y){for(var x=new Ze,D=a.iterator();D.hasNext();){var U=D.next();if(U.getMaxNodeDegree()>2){U.linkDirectedEdgesForMinimalEdgeRings();var H=U.buildMinimalRings(),pe=this.findShell(H);null!==pe?(this.placePolygonHoles(pe,H),h.add(pe)):y.addAll(H)}else x.add(U)}return x},la.prototype.containsPoint=function(a){for(var h=this._shellList.iterator();h.hasNext();)if(h.next().containsPoint(a))return!0;return!1},la.prototype.buildMaximalEdgeRings=function(a){for(var h=new Ze,y=a.iterator();y.hasNext();){var x=y.next();if(x.isInResult()&&x.getLabel().isArea()&&null===x.getEdgeRing()){var D=new zs(x,this._geometryFactory);h.add(D),D.setInResult()}}return h},la.prototype.placePolygonHoles=function(a,h){for(var y=h.iterator();y.hasNext();){var x=y.next();x.isHole()&&x.setShell(a)}},la.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},la.prototype.findEdgeRingContaining=function(a,h){for(var y=a.getLinearRing(),x=y.getEnvelopeInternal(),D=y.getCoordinateN(0),U=null,H=null,pe=h.iterator();pe.hasNext();){var Ge=pe.next(),wt=Ge.getLinearRing(),qt=wt.getEnvelopeInternal();null!==U&&(H=U.getLinearRing().getEnvelopeInternal());var nn=!1;qt.contains(x)&&en.isPointInRing(D,wt.getCoordinates())&&(nn=!0),nn&&(null===U||H.contains(qt))&&(U=Ge)}return U},la.prototype.findShell=function(a){for(var h=0,y=null,x=a.iterator();x.hasNext();){var D=x.next();D.isHole()||(y=D,h++)}return Se.isTrue(h<=1,"found two shells in MinimalEdgeRing list"),y},la.prototype.add=function(){if(1===arguments.length){var a=arguments[0];this.add(a.getEdgeEnds(),a.getNodes())}else if(2===arguments.length){var h=arguments[0];ys.linkResultDirectedEdges(arguments[1]);var x=this.buildMaximalEdgeRings(h),D=new Ze,U=this.buildMinimalEdgeRings(x,this._shellList,D);this.sortShellsAndHoles(U,this._shellList,D),this.placeFreeHoles(this._shellList,D)}},la.prototype.interfaces_=function(){return[]},la.prototype.getClass=function(){return la};var va=function(){};va.prototype.getBounds=function(){},va.prototype.interfaces_=function(){return[]},va.prototype.getClass=function(){return va};var Pu=function(){this._bounds=null,this._item=null;var h=arguments[1];this._bounds=arguments[0],this._item=h};Pu.prototype.getItem=function(){return this._item},Pu.prototype.getBounds=function(){return this._bounds},Pu.prototype.interfaces_=function(){return[va,me]},Pu.prototype.getClass=function(){return Pu};var Ji=function(){this._size=null,this._items=null,this._size=0,this._items=new Ze,this._items.add(null)};Ji.prototype.poll=function(){if(this.isEmpty())return null;var a=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),a},Ji.prototype.size=function(){return this._size},Ji.prototype.reorder=function(a){for(var h=null,y=this._items.get(a);2*a<=this._size&&((h=2*a)!==this._size&&this._items.get(h+1).compareTo(this._items.get(h))<0&&h++,this._items.get(h).compareTo(y)<0);a=h)this._items.set(a,this._items.get(h));this._items.set(a,y)},Ji.prototype.clear=function(){this._size=0,this._items.clear()},Ji.prototype.isEmpty=function(){return 0===this._size},Ji.prototype.add=function(a){this._items.add(null),this._size+=1;var h=this._size;for(this._items.set(0,a);a.compareTo(this._items.get(Math.trunc(h/2)))<0;h/=2)this._items.set(h,this._items.get(Math.trunc(h/2)));this._items.set(h,a)},Ji.prototype.interfaces_=function(){return[]},Ji.prototype.getClass=function(){return Ji};var Hr=function(){};Hr.prototype.visitItem=function(a){},Hr.prototype.interfaces_=function(){return[]},Hr.prototype.getClass=function(){return Hr};var Mi=function(){};Mi.prototype.insert=function(a,h){},Mi.prototype.remove=function(a,h){},Mi.prototype.query=function(){},Mi.prototype.interfaces_=function(){return[]},Mi.prototype.getClass=function(){return Mi};var Vs=function(){this._childBoundables=new Ze,this._bounds=null,this._level=null,0!==arguments.length&&1===arguments.length&&(this._level=arguments[0])},Gp={serialVersionUID:{configurable:!0}};Vs.prototype.getLevel=function(){return this._level},Vs.prototype.size=function(){return this._childBoundables.size()},Vs.prototype.getChildBoundables=function(){return this._childBoundables},Vs.prototype.addChildBoundable=function(a){Se.isTrue(null===this._bounds),this._childBoundables.add(a)},Vs.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},Vs.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},Vs.prototype.interfaces_=function(){return[va,me]},Vs.prototype.getClass=function(){return Vs},Gp.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(Vs,Gp);var Yu=function(){};Yu.reverseOrder=function(){return{compare:function(a,h){return h.compareTo(a)}}},Yu.min=function(a){return Yu.sort(a),a.get(0)},Yu.sort=function(a,h){var y=a.toArray();h?ds.sort(y,h):ds.sort(y);for(var x=a.iterator(),D=0,U=y.length;D<U;D++)x.next(),x.set(y[D])},Yu.singletonList=function(a){var h=new Ze;return h.add(a),h};var sr=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var h=arguments[1],y=arguments[2];this._boundable1=arguments[0],this._boundable2=h,this._itemDistance=y,this._distance=this.distance()};sr.prototype.expandToQueue=function(a,h){var y=sr.isComposite(this._boundable1),x=sr.isComposite(this._boundable2);if(y&&x)return sr.area(this._boundable1)>sr.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,a,h),null):(this.expand(this._boundable2,this._boundable1,a,h),null);if(y)return this.expand(this._boundable1,this._boundable2,a,h),null;if(x)return this.expand(this._boundable2,this._boundable1,a,h),null;throw new ce("neither boundable is composite")},sr.prototype.isLeaves=function(){return!(sr.isComposite(this._boundable1)||sr.isComposite(this._boundable2))},sr.prototype.compareTo=function(a){return this._distance<a._distance?-1:this._distance>a._distance?1:0},sr.prototype.expand=function(a,h,y,x){for(var D=a.getChildBoundables().iterator();D.hasNext();){var U=D.next(),H=new sr(U,h,this._itemDistance);H.getDistance()<x&&y.add(H)}},sr.prototype.getBoundable=function(a){return 0===a?this._boundable1:this._boundable2},sr.prototype.getDistance=function(){return this._distance},sr.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},sr.prototype.interfaces_=function(){return[oe]},sr.prototype.getClass=function(){return sr},sr.area=function(a){return a.getBounds().getArea()},sr.isComposite=function(a){return a instanceof Vs};var os=function a(){if(this._root=null,this._built=!1,this._itemBoundables=new Ze,this._nodeCapacity=null,0===arguments.length)this._nodeCapacity=a.DEFAULT_NODE_CAPACITY;else if(1===arguments.length){var y=arguments[0];Se.isTrue(y>1,"Node capacity must be greater than 1"),this._nodeCapacity=y}},Ku={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};os.prototype.getNodeCapacity=function(){return this._nodeCapacity},os.prototype.lastNode=function(a){return a.get(a.size()-1)},os.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var a=0,h=arguments[0].getChildBoundables().iterator();h.hasNext();){var y=h.next();y instanceof Vs?a+=this.size(y):y instanceof Pu&&(a+=1)}return a}},os.prototype.removeItem=function(a,h){for(var y=null,x=a.getChildBoundables().iterator();x.hasNext();){var D=x.next();D instanceof Pu&&D.getItem()===h&&(y=D)}return null!==y&&(a.getChildBoundables().remove(y),!0)},os.prototype.itemsTree=function(){if(0===arguments.length){this.build();var a=this.itemsTree(this._root);return null===a?new Ze:a}if(1===arguments.length){for(var h=arguments[0],y=new Ze,x=h.getChildBoundables().iterator();x.hasNext();){var D=x.next();if(D instanceof Vs){var U=this.itemsTree(D);null!==U&&y.add(U)}else D instanceof Pu?y.add(D.getItem()):Se.shouldNeverReachHere()}return y.size()<=0?null:y}},os.prototype.insert=function(a,h){Se.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Pu(a,h))},os.prototype.boundablesAtLevel=function(){if(1===arguments.length){var a=arguments[0],h=new Ze;return this.boundablesAtLevel(a,this._root,h),h}if(3===arguments.length){var y=arguments[0],x=arguments[1],D=arguments[2];if(Se.isTrue(y>-2),x.getLevel()===y)return D.add(x),null;for(var U=x.getChildBoundables().iterator();U.hasNext();){var H=U.next();H instanceof Vs?this.boundablesAtLevel(y,H,D):(Se.isTrue(H instanceof Pu),-1===y&&D.add(H))}return null}},os.prototype.query=function(){if(1===arguments.length){var a=arguments[0];this.build();var h=new Ze;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),a)&&this.query(a,this._root,h),h}if(2===arguments.length){var y=arguments[0],x=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),y)&&this.query(y,this._root,x)}else if(3===arguments.length)if(Bt(arguments[2],Hr)&&arguments[0]instanceof Object&&arguments[1]instanceof Vs)for(var D=arguments[0],H=arguments[2],pe=arguments[1].getChildBoundables(),Ge=0;Ge<pe.size();Ge++){var wt=pe.get(Ge);this.getIntersectsOp().intersects(wt.getBounds(),D)&&(wt instanceof Vs?this.query(D,wt,H):wt instanceof Pu?H.visitItem(wt.getItem()):Se.shouldNeverReachHere())}else if(Bt(arguments[2],ct)&&arguments[0]instanceof Object&&arguments[1]instanceof Vs)for(var qt=arguments[0],Wn=arguments[2],kn=arguments[1].getChildBoundables(),tr=0;tr<kn.size();tr++){var lr=kn.get(tr);this.getIntersectsOp().intersects(lr.getBounds(),qt)&&(lr instanceof Vs?this.query(qt,lr,Wn):lr instanceof Pu?Wn.add(lr.getItem()):Se.shouldNeverReachHere())}},os.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},os.prototype.getRoot=function(){return this.build(),this._root},os.prototype.remove=function(){if(2===arguments.length){var a=arguments[0],h=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),a)&&this.remove(a,this._root,h)}if(3===arguments.length){var y=arguments[0],x=arguments[1],D=arguments[2],U=this.removeItem(x,D);if(U)return!0;for(var H=null,pe=x.getChildBoundables().iterator();pe.hasNext();){var Ge=pe.next();if(this.getIntersectsOp().intersects(Ge.getBounds(),y)&&Ge instanceof Vs&&(U=this.remove(y,Ge,D))){H=Ge;break}}return null!==H&&H.getChildBoundables().isEmpty()&&x.getChildBoundables().remove(H),U}},os.prototype.createHigherLevels=function(a,h){Se.isTrue(!a.isEmpty());var y=this.createParentBoundables(a,h+1);return 1===y.size()?y.get(0):this.createHigherLevels(y,h+1)},os.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var a=0,h=arguments[0].getChildBoundables().iterator();h.hasNext();){var y=h.next();if(y instanceof Vs){var x=this.depth(y);x>a&&(a=x)}}return a+1}},os.prototype.createParentBoundables=function(a,h){Se.isTrue(!a.isEmpty());var y=new Ze;y.add(this.createNode(h));var x=new Ze(a);Yu.sort(x,this.getComparator());for(var D=x.iterator();D.hasNext();){var U=D.next();this.lastNode(y).getChildBoundables().size()===this.getNodeCapacity()&&y.add(this.createNode(h)),this.lastNode(y).addChildBoundable(U)}return y},os.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},os.prototype.interfaces_=function(){return[me]},os.prototype.getClass=function(){return os},os.compareDoubles=function(a,h){return a>h?1:a<h?-1:0},Ku.IntersectsOp.get=function(){return cc},Ku.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},Ku.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(os,Ku);var cc=function(){},Zo=function(){};Zo.prototype.distance=function(a,h){},Zo.prototype.interfaces_=function(){return[]},Zo.prototype.getClass=function(){return Zo};var Xc=function(a){function h(x){a.call(this,x=x||h.DEFAULT_NODE_CAPACITY)}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return h.prototype.createParentBoundablesFromVerticalSlices=function(x,D){Se.isTrue(x.length>0);for(var U=new Ze,H=0;H<x.length;H++)U.addAll(this.createParentBoundablesFromVerticalSlice(x[H],D));return U},h.prototype.createNode=function(x){return new Ju(x)},h.prototype.size=function(){return 0===arguments.length?a.prototype.size.call(this):a.prototype.size.apply(this,arguments)},h.prototype.insert=function(){if(2!==arguments.length)return a.prototype.insert.apply(this,arguments);var x=arguments[0],D=arguments[1];if(x.isNull())return null;a.prototype.insert.call(this,x,D)},h.prototype.getIntersectsOp=function(){return h.intersectsOp},h.prototype.verticalSlices=function(x,D){for(var U=Math.trunc(Math.ceil(x.size()/D)),H=new Array(D).fill(null),pe=x.iterator(),Ge=0;Ge<D;Ge++){H[Ge]=new Ze;for(var wt=0;pe.hasNext()&&wt<U;){var qt=pe.next();H[Ge].add(qt),wt++}}return H},h.prototype.query=function(){if(1===arguments.length)return a.prototype.query.call(this,arguments[0]);2===arguments.length?a.prototype.query.call(this,arguments[0],arguments[1]):3===arguments.length&&(Bt(arguments[2],Hr)&&arguments[0]instanceof Object&&arguments[1]instanceof Vs||Bt(arguments[2],ct)&&arguments[0]instanceof Object&&arguments[1]instanceof Vs)&&a.prototype.query.call(this,arguments[0],arguments[1],arguments[2])},h.prototype.getComparator=function(){return h.yComparator},h.prototype.createParentBoundablesFromVerticalSlice=function(x,D){return a.prototype.createParentBoundables.call(this,x,D)},h.prototype.remove=function(){return 2===arguments.length?a.prototype.remove.call(this,arguments[0],arguments[1]):a.prototype.remove.apply(this,arguments)},h.prototype.depth=function(){return 0===arguments.length?a.prototype.depth.call(this):a.prototype.depth.apply(this,arguments)},h.prototype.createParentBoundables=function(x,D){Se.isTrue(!x.isEmpty());var U=Math.trunc(Math.ceil(x.size()/this.getNodeCapacity())),H=new Ze(x);Yu.sort(H,h.xComparator);var pe=this.verticalSlices(H,Math.trunc(Math.ceil(Math.sqrt(U))));return this.createParentBoundablesFromVerticalSlices(pe,D)},h.prototype.nearestNeighbour=function(){if(1===arguments.length){if(Bt(arguments[0],Zo)){var x=arguments[0],D=new sr(this.getRoot(),this.getRoot(),x);return this.nearestNeighbour(D)}if(arguments[0]instanceof sr)return this.nearestNeighbour(arguments[0],ee.POSITIVE_INFINITY)}else if(2===arguments.length){if(arguments[0]instanceof h&&Bt(arguments[1],Zo)){var H=arguments[0],pe=arguments[1],Ge=new sr(this.getRoot(),H.getRoot(),pe);return this.nearestNeighbour(Ge)}if(arguments[0]instanceof sr&&"number"==typeof arguments[1]){var wt=arguments[0],qt=arguments[1],nn=null,Wn=new Ji;for(Wn.add(wt);!Wn.isEmpty()&&qt>0;){var kn=Wn.poll(),tr=kn.getDistance();if(tr>=qt)break;kn.isLeaves()?(qt=tr,nn=kn):kn.expandToQueue(Wn,qt)}return[nn.getBoundable(0).getItem(),nn.getBoundable(1).getItem()]}}else if(3===arguments.length){var Gn=arguments[2],ga=new Pu(arguments[0],arguments[1]),ma=new sr(this.getRoot(),ga,Gn);return this.nearestNeighbour(ma)[0]}},h.prototype.interfaces_=function(){return[Mi,me]},h.prototype.getClass=function(){return h},h.centreX=function(x){return h.avg(x.getMinX(),x.getMaxX())},h.avg=function(x,D){return(x+D)/2},h.centreY=function(x){return h.avg(x.getMinY(),x.getMaxY())},y.STRtreeNode.get=function(){return Ju},y.serialVersionUID.get=function(){return 0x39920f7d5f261e0},y.xComparator.get=function(){return{interfaces_:function(){return[_e]},compare:function(x,D){return a.compareDoubles(h.centreX(x.getBounds()),h.centreX(D.getBounds()))}}},y.yComparator.get=function(){return{interfaces_:function(){return[_e]},compare:function(x,D){return a.compareDoubles(h.centreY(x.getBounds()),h.centreY(D.getBounds()))}}},y.intersectsOp.get=function(){return{interfaces_:function(){return[a.IntersectsOp]},intersects:function(x,D){return x.intersects(D)}}},y.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(h,y),h}(os),Ju=function(a){function h(){a.call(this,arguments[0])}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.computeBounds=function(){for(var y=null,x=this.getChildBoundables().iterator();x.hasNext();){var D=x.next();null===y?y=new wn(D.getBounds()):y.expandToInclude(D.getBounds())}return y},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Vs),ca=function(){};ca.prototype.interfaces_=function(){return[]},ca.prototype.getClass=function(){return ca},ca.relativeSign=function(a,h){return a<h?-1:a>h?1:0},ca.compare=function(a,h,y){if(h.equals2D(y))return 0;var x=ca.relativeSign(h.x,y.x),D=ca.relativeSign(h.y,y.y);switch(a){case 0:return ca.compareValue(x,D);case 1:return ca.compareValue(D,x);case 2:return ca.compareValue(D,-x);case 3:return ca.compareValue(-x,D);case 4:return ca.compareValue(-x,-D);case 5:return ca.compareValue(-D,-x);case 6:return ca.compareValue(-D,x);case 7:return ca.compareValue(x,-D)}return Se.shouldNeverReachHere("invalid octant value"),0},ca.compareValue=function(a,h){return a<0?-1:a>0?1:h<0?-1:h>0?1:0};var ka=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var a=arguments[0],h=arguments[1],y=arguments[2],x=arguments[3];this._segString=a,this.coord=new re(h),this.segmentIndex=y,this._segmentOctant=x,this._isInterior=!h.equals2D(a.getCoordinate(y))};ka.prototype.getCoordinate=function(){return this.coord},ka.prototype.print=function(a){a.print(this.coord),a.print(" seg # = "+this.segmentIndex)},ka.prototype.compareTo=function(a){var h=a;return this.segmentIndex<h.segmentIndex?-1:this.segmentIndex>h.segmentIndex?1:this.coord.equals2D(h.coord)?0:ca.compare(this._segmentOctant,this.coord,h.coord)},ka.prototype.isEndPoint=function(a){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===a},ka.prototype.isInterior=function(){return this._isInterior},ka.prototype.interfaces_=function(){return[oe]},ka.prototype.getClass=function(){return ka};var Qi=function(){this._nodeMap=new gt,this._edge=null,this._edge=arguments[0]};Qi.prototype.getSplitCoordinates=function(){var a=new Nt;this.addEndpoints();for(var h=this.iterator(),y=h.next();h.hasNext();){var x=h.next();this.addEdgeCoordinates(y,x,a),y=x}return a.toCoordinateArray()},Qi.prototype.addCollapsedNodes=function(){var a=new Ze;this.findCollapsesFromInsertedNodes(a),this.findCollapsesFromExistingVertices(a);for(var h=a.iterator();h.hasNext();){var y=h.next().intValue();this.add(this._edge.getCoordinate(y),y)}},Qi.prototype.print=function(a){a.println("Intersections:");for(var h=this.iterator();h.hasNext();)h.next().print(a)},Qi.prototype.findCollapsesFromExistingVertices=function(a){for(var h=0;h<this._edge.size()-2;h++){var y=this._edge.getCoordinate(h),x=this._edge.getCoordinate(h+2);y.equals2D(x)&&a.add(new ft(h+1))}},Qi.prototype.addEdgeCoordinates=function(a,h,y){var x=this._edge.getCoordinate(h.segmentIndex),D=h.isInterior()||!h.coord.equals2D(x);y.add(new re(a.coord),!1);for(var U=a.segmentIndex+1;U<=h.segmentIndex;U++)y.add(this._edge.getCoordinate(U));D&&y.add(new re(h.coord))},Qi.prototype.iterator=function(){return this._nodeMap.values().iterator()},Qi.prototype.addSplitEdges=function(a){this.addEndpoints(),this.addCollapsedNodes();for(var h=this.iterator(),y=h.next();h.hasNext();){var x=h.next(),D=this.createSplitEdge(y,x);a.add(D),y=x}},Qi.prototype.findCollapseIndex=function(a,h,y){if(!a.coord.equals2D(h.coord))return!1;var x=h.segmentIndex-a.segmentIndex;return h.isInterior()||x--,1===x&&(y[0]=a.segmentIndex+1,!0)},Qi.prototype.findCollapsesFromInsertedNodes=function(a){for(var h=new Array(1).fill(null),y=this.iterator(),x=y.next();y.hasNext();){var D=y.next();this.findCollapseIndex(x,D,h)&&a.add(new ft(h[0])),x=D}},Qi.prototype.getEdge=function(){return this._edge},Qi.prototype.addEndpoints=function(){var a=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(a),a)},Qi.prototype.createSplitEdge=function(a,h){var y=h.segmentIndex-a.segmentIndex+2,x=this._edge.getCoordinate(h.segmentIndex),D=h.isInterior()||!h.coord.equals2D(x);D||y--;var U=new Array(y).fill(null),H=0;U[H++]=new re(a.coord);for(var pe=a.segmentIndex+1;pe<=h.segmentIndex;pe++)U[H++]=this._edge.getCoordinate(pe);return D&&(U[H]=new re(h.coord)),new Yo(U,this._edge.getData())},Qi.prototype.add=function(a,h){var y=new ka(this._edge,a,h,this._edge.getSegmentOctant(h)),x=this._nodeMap.get(y);return null!==x?(Se.isTrue(x.coord.equals2D(a),"Found equal nodes with different coordinates"),x):(this._nodeMap.put(y,y),y)},Qi.prototype.checkSplitEdgesCorrectness=function(a){var h=this._edge.getCoordinates(),y=a.get(0).getCoordinate(0);if(!y.equals2D(h[0]))throw new Re("bad split edge start point at "+y);var x=a.get(a.size()-1).getCoordinates(),D=x[x.length-1];if(!D.equals2D(h[h.length-1]))throw new Re("bad split edge end point at "+D)},Qi.prototype.interfaces_=function(){return[]},Qi.prototype.getClass=function(){return Qi};var hc=function(){};hc.prototype.interfaces_=function(){return[]},hc.prototype.getClass=function(){return hc},hc.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var a=arguments[0],h=arguments[1];if(0===a&&0===h)throw new ce("Cannot compute the octant for point ( "+a+", "+h+" )");var y=Math.abs(a),x=Math.abs(h);return a>=0?h>=0?y>=x?0:1:y>=x?7:6:h>=0?y>=x?3:2:y>=x?4:5}if(arguments[0]instanceof re&&arguments[1]instanceof re){var D=arguments[0],U=arguments[1],H=U.x-D.x,pe=U.y-D.y;if(0===H&&0===pe)throw new ce("Cannot compute the octant for two identical points "+D);return hc.octant(H,pe)}};var Ru=function(){};Ru.prototype.getCoordinates=function(){},Ru.prototype.size=function(){},Ru.prototype.getCoordinate=function(a){},Ru.prototype.isClosed=function(){},Ru.prototype.setData=function(a){},Ru.prototype.getData=function(){},Ru.prototype.interfaces_=function(){return[]},Ru.prototype.getClass=function(){return Ru};var Rr=function(){};Rr.prototype.addIntersection=function(a,h){},Rr.prototype.interfaces_=function(){return[Ru]},Rr.prototype.getClass=function(){return Rr};var Yo=function(){this._nodeList=new Qi(this),this._pts=null,this._data=null;var h=arguments[1];this._pts=arguments[0],this._data=h};Yo.prototype.getCoordinates=function(){return this._pts},Yo.prototype.size=function(){return this._pts.length},Yo.prototype.getCoordinate=function(a){return this._pts[a]},Yo.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},Yo.prototype.getSegmentOctant=function(a){return a===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(a),this.getCoordinate(a+1))},Yo.prototype.setData=function(a){this._data=a},Yo.prototype.safeOctant=function(a,h){return a.equals2D(h)?0:hc.octant(a,h)},Yo.prototype.getData=function(){return this._data},Yo.prototype.addIntersection=function(){if(2===arguments.length)this.addIntersectionNode(arguments[0],arguments[1]);else if(4===arguments.length){var x=arguments[1],U=new re(arguments[0].getIntersection(arguments[3]));this.addIntersection(U,x)}},Yo.prototype.toString=function(){return Pt.toLineString(new Ds(this._pts))},Yo.prototype.getNodeList=function(){return this._nodeList},Yo.prototype.addIntersectionNode=function(a,h){var y=h,x=y+1;return x<this._pts.length&&a.equals2D(this._pts[x])&&(y=x),this._nodeList.add(a,y)},Yo.prototype.addIntersections=function(a,h,y){for(var x=0;x<a.getIntersectionNum();x++)this.addIntersection(a,h,y,x)},Yo.prototype.interfaces_=function(){return[Rr]},Yo.prototype.getClass=function(){return Yo},Yo.getNodedSubstrings=function(){if(1===arguments.length){var a=arguments[0],h=new Ze;return Yo.getNodedSubstrings(a,h),h}if(2===arguments.length)for(var x=arguments[1],D=arguments[0].iterator();D.hasNext();)D.next().getNodeList().addSplitEdges(x)};var hr=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new re,this.p1=new re;else if(1===arguments.length){var a=arguments[0];this.p0=new re(a.p0),this.p1=new re(a.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var x=arguments[2],D=arguments[3];this.p0=new re(arguments[0],arguments[1]),this.p1=new re(x,D)}},ii={serialVersionUID:{configurable:!0}};hr.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},hr.prototype.orientationIndex=function(){if(arguments[0]instanceof hr){var a=arguments[0],h=en.orientationIndex(this.p0,this.p1,a.p0),y=en.orientationIndex(this.p0,this.p1,a.p1);return h>=0&&y>=0||h<=0&&y<=0?Math.max(h,y):0}if(arguments[0]instanceof re)return en.orientationIndex(this.p0,this.p1,arguments[0])},hr.prototype.toGeometry=function(a){return a.createLineString([this.p0,this.p1])},hr.prototype.isVertical=function(){return this.p0.x===this.p1.x},hr.prototype.equals=function(a){if(!(a instanceof hr))return!1;var h=a;return this.p0.equals(h.p0)&&this.p1.equals(h.p1)},hr.prototype.intersection=function(a){var h=new Yt;return h.computeIntersection(this.p0,this.p1,a.p0,a.p1),h.hasIntersection()?h.getIntersection(0):null},hr.prototype.project=function(){if(arguments[0]instanceof re){var a=arguments[0];if(a.equals(this.p0)||a.equals(this.p1))return new re(a);var h=this.projectionFactor(a),y=new re;return y.x=this.p0.x+h*(this.p1.x-this.p0.x),y.y=this.p0.y+h*(this.p1.y-this.p0.y),y}if(arguments[0]instanceof hr){var x=arguments[0],D=this.projectionFactor(x.p0),U=this.projectionFactor(x.p1);if(D>=1&&U>=1||D<=0&&U<=0)return null;var H=this.project(x.p0);D<0&&(H=this.p0),D>1&&(H=this.p1);var pe=this.project(x.p1);return U<0&&(pe=this.p0),U>1&&(pe=this.p1),new hr(H,pe)}},hr.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},hr.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},hr.prototype.getCoordinate=function(a){return 0===a?this.p0:this.p1},hr.prototype.distancePerpendicular=function(a){return en.distancePointLinePerpendicular(a,this.p0,this.p1)},hr.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},hr.prototype.midPoint=function(){return hr.midPoint(this.p0,this.p1)},hr.prototype.projectionFactor=function(a){if(a.equals(this.p0))return 0;if(a.equals(this.p1))return 1;var h=this.p1.x-this.p0.x,y=this.p1.y-this.p0.y,x=h*h+y*y;return x<=0?ee.NaN:((a.x-this.p0.x)*h+(a.y-this.p0.y)*y)/x},hr.prototype.closestPoints=function(a){var h=this.intersection(a);if(null!==h)return[h,h];var y=new Array(2).fill(null),x=ee.MAX_VALUE,D=null,U=this.closestPoint(a.p0);x=U.distance(a.p0),y[0]=U,y[1]=a.p0;var H=this.closestPoint(a.p1);(D=H.distance(a.p1))<x&&(x=D,y[0]=H,y[1]=a.p1);var pe=a.closestPoint(this.p0);(D=pe.distance(this.p0))<x&&(x=D,y[0]=this.p0,y[1]=pe);var Ge=a.closestPoint(this.p1);return(D=Ge.distance(this.p1))<x&&(x=D,y[0]=this.p1,y[1]=Ge),y},hr.prototype.closestPoint=function(a){var h=this.projectionFactor(a);return h>0&&h<1?this.project(a):this.p0.distance(a)<this.p1.distance(a)?this.p0:this.p1},hr.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},hr.prototype.getLength=function(){return this.p0.distance(this.p1)},hr.prototype.compareTo=function(a){var h=a,y=this.p0.compareTo(h.p0);return 0!==y?y:this.p1.compareTo(h.p1)},hr.prototype.reverse=function(){var a=this.p0;this.p0=this.p1,this.p1=a},hr.prototype.equalsTopo=function(a){return this.p0.equals(a.p0)&&(this.p1.equals(a.p1)||this.p0.equals(a.p1))&&this.p1.equals(a.p0)},hr.prototype.lineIntersection=function(a){try{return Nn.intersection(this.p0,this.p1,a.p0,a.p1)}catch(h){if(!(h instanceof jn))throw h}return null},hr.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},hr.prototype.pointAlongOffset=function(a,h){var y=this.p0.x+a*(this.p1.x-this.p0.x),x=this.p0.y+a*(this.p1.y-this.p0.y),D=this.p1.x-this.p0.x,U=this.p1.y-this.p0.y,H=Math.sqrt(D*D+U*U),pe=0,Ge=0;if(0!==h){if(H<=0)throw new Error("Cannot compute offset from zero-length line segment");pe=h*D/H,Ge=h*U/H}return new re(y-Ge,x+pe)},hr.prototype.setCoordinates=function(){if(1===arguments.length){var a=arguments[0];this.setCoordinates(a.p0,a.p1)}else if(2===arguments.length){var h=arguments[0],y=arguments[1];this.p0.x=h.x,this.p0.y=h.y,this.p1.x=y.x,this.p1.y=y.y}},hr.prototype.segmentFraction=function(a){var h=this.projectionFactor(a);return h<0?h=0:(h>1||ee.isNaN(h))&&(h=1),h},hr.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},hr.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},hr.prototype.distance=function(){if(arguments[0]instanceof hr){var a=arguments[0];return en.distanceLineLine(this.p0,this.p1,a.p0,a.p1)}if(arguments[0]instanceof re)return en.distancePointLine(arguments[0],this.p0,this.p1)},hr.prototype.pointAlong=function(a){var h=new re;return h.x=this.p0.x+a*(this.p1.x-this.p0.x),h.y=this.p0.y+a*(this.p1.y-this.p0.y),h},hr.prototype.hashCode=function(){var a=ee.doubleToLongBits(this.p0.x);a^=31*ee.doubleToLongBits(this.p0.y);var h=Math.trunc(a)^Math.trunc(a>>32),y=ee.doubleToLongBits(this.p1.x);return y^=31*ee.doubleToLongBits(this.p1.y),h^Math.trunc(y)^Math.trunc(y>>32)},hr.prototype.interfaces_=function(){return[oe,me]},hr.prototype.getClass=function(){return hr},hr.midPoint=function(a,h){return new re((a.x+h.x)/2,(a.y+h.y)/2)},ii.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(hr,ii);var Ja=function(){this.tempEnv1=new wn,this.tempEnv2=new wn,this._overlapSeg1=new hr,this._overlapSeg2=new hr};Ja.prototype.overlap=function(){if(2!==arguments.length&&4===arguments.length){var y=arguments[2],x=arguments[3];arguments[0].getLineSegment(arguments[1],this._overlapSeg1),y.getLineSegment(x,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},Ja.prototype.interfaces_=function(){return[]},Ja.prototype.getClass=function(){return Ja};var uu=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var h=arguments[1],y=arguments[2],x=arguments[3];this._pts=arguments[0],this._start=h,this._end=y,this._context=x};uu.prototype.getLineSegment=function(a,h){h.p0=this._pts[a],h.p1=this._pts[a+1]},uu.prototype.computeSelect=function(a,h,y,x){if(x.tempEnv1.init(this._pts[h],this._pts[y]),y-h==1)return x.select(this,h),null;if(!a.intersects(x.tempEnv1))return null;var H=Math.trunc((h+y)/2);h<H&&this.computeSelect(a,h,H,x),H<y&&this.computeSelect(a,H,y,x)},uu.prototype.getCoordinates=function(){for(var a=new Array(this._end-this._start+1).fill(null),h=0,y=this._start;y<=this._end;y++)a[h++]=this._pts[y];return a},uu.prototype.computeOverlaps=function(a,h){this.computeOverlapsInternal(this._start,this._end,a,a._start,a._end,h)},uu.prototype.setId=function(a){this._id=a},uu.prototype.select=function(a,h){this.computeSelect(a,this._start,this._end,h)},uu.prototype.getEnvelope=function(){return null===this._env&&(this._env=new wn(this._pts[this._start],this._pts[this._end])),this._env},uu.prototype.getEndIndex=function(){return this._end},uu.prototype.getStartIndex=function(){return this._start},uu.prototype.getContext=function(){return this._context},uu.prototype.getId=function(){return this._id},uu.prototype.computeOverlapsInternal=function(a,h,y,x,D,U){var H=this._pts[a],pe=this._pts[h],Ge=y._pts[x],wt=y._pts[D];if(h-a==1&&D-x==1)return U.overlap(this,a,y,x),null;if(U.tempEnv1.init(H,pe),U.tempEnv2.init(Ge,wt),!U.tempEnv1.intersects(U.tempEnv2))return null;var qt=Math.trunc((a+h)/2),nn=Math.trunc((x+D)/2);a<qt&&(x<nn&&this.computeOverlapsInternal(a,qt,y,x,nn,U),nn<D&&this.computeOverlapsInternal(a,qt,y,nn,D,U)),qt<h&&(x<nn&&this.computeOverlapsInternal(qt,h,y,x,nn,U),nn<D&&this.computeOverlapsInternal(qt,h,y,nn,D,U))},uu.prototype.interfaces_=function(){return[]},uu.prototype.getClass=function(){return uu};var oi=function(){};oi.prototype.interfaces_=function(){return[]},oi.prototype.getClass=function(){return oi},oi.getChainStartIndices=function(a){var h=0,y=new Ze;y.add(new ft(h));do{var x=oi.findChainEnd(a,h);y.add(new ft(x)),h=x}while(h<a.length-1);return oi.toIntArray(y)},oi.findChainEnd=function(a,h){for(var y=h;y<a.length-1&&a[y].equals2D(a[y+1]);)y++;if(y>=a.length-1)return a.length-1;for(var x=Ti.quadrant(a[y],a[y+1]),D=h+1;D<a.length&&(a[D-1].equals2D(a[D])||Ti.quadrant(a[D-1],a[D])===x);)D++;return D-1},oi.getChains=function(){if(1===arguments.length)return oi.getChains(arguments[0],null);if(2===arguments.length){for(var h=arguments[0],y=arguments[1],x=new Ze,D=oi.getChainStartIndices(h),U=0;U<D.length-1;U++){var H=new uu(h,D[U],D[U+1],y);x.add(H)}return x}},oi.toIntArray=function(a){for(var h=new Array(a.size()).fill(null),y=0;y<h.length;y++)h[y]=a.get(y).intValue();return h};var Lc=function(){};Lc.prototype.computeNodes=function(a){},Lc.prototype.getNodedSubstrings=function(){},Lc.prototype.interfaces_=function(){return[]},Lc.prototype.getClass=function(){return Lc};var Fh=function(){this._segInt=null,0!==arguments.length&&1===arguments.length&&this.setSegmentIntersector(arguments[0])};Fh.prototype.setSegmentIntersector=function(a){this._segInt=a},Fh.prototype.interfaces_=function(){return[Lc]},Fh.prototype.getClass=function(){return Fh};var $l=function(a){function h(x){x?a.call(this,x):a.call(this),this._monoChains=new Ze,this._index=new Xc,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h;var y={SegmentOverlapAction:{configurable:!0}};return h.prototype.getMonotoneChains=function(){return this._monoChains},h.prototype.getNodedSubstrings=function(){return Yo.getNodedSubstrings(this._nodedSegStrings)},h.prototype.getIndex=function(){return this._index},h.prototype.add=function(x){for(var D=oi.getChains(x.getCoordinates(),x).iterator();D.hasNext();){var U=D.next();U.setId(this._idCounter++),this._index.insert(U.getEnvelope(),U),this._monoChains.add(U)}},h.prototype.computeNodes=function(x){this._nodedSegStrings=x;for(var D=x.iterator();D.hasNext();)this.add(D.next());this.intersectChains()},h.prototype.intersectChains=function(){for(var x=new Qu(this._segInt),D=this._monoChains.iterator();D.hasNext();)for(var U=D.next(),H=this._index.query(U.getEnvelope()).iterator();H.hasNext();){var pe=H.next();if(pe.getId()>U.getId()&&(U.computeOverlaps(pe,x),this._nOverlaps++),this._segInt.isDone())return null}},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},y.SegmentOverlapAction.get=function(){return Qu},Object.defineProperties(h,y),h}(Fh),Qu=function(a){function h(){a.call(this),this._si=null,this._si=arguments[0]}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.overlap=function(){if(4!==arguments.length)return a.prototype.overlap.apply(this,arguments);var x=arguments[1],D=arguments[2],U=arguments[3],H=arguments[0].getContext(),pe=D.getContext();this._si.processIntersections(H,x,pe,U)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Ja),Si=function a(){if(this._quadrantSegments=a.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=a.CAP_ROUND,this._joinStyle=a.JOIN_ROUND,this._mitreLimit=a.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=a.DEFAULT_SIMPLIFY_FACTOR,0!==arguments.length)if(1===arguments.length)this.setQuadrantSegments(arguments[0]);else if(2===arguments.length){var x=arguments[1];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(x)}else if(4===arguments.length){var U=arguments[1],H=arguments[2],pe=arguments[3];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(U),this.setJoinStyle(H),this.setMitreLimit(pe)}},Ni={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Si.prototype.getEndCapStyle=function(){return this._endCapStyle},Si.prototype.isSingleSided=function(){return this._isSingleSided},Si.prototype.setQuadrantSegments=function(a){this._quadrantSegments=a,0===this._quadrantSegments&&(this._joinStyle=Si.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Si.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),a<=0&&(this._quadrantSegments=1),this._joinStyle!==Si.JOIN_ROUND&&(this._quadrantSegments=Si.DEFAULT_QUADRANT_SEGMENTS)},Si.prototype.getJoinStyle=function(){return this._joinStyle},Si.prototype.setJoinStyle=function(a){this._joinStyle=a},Si.prototype.setSimplifyFactor=function(a){this._simplifyFactor=a<0?0:a},Si.prototype.getSimplifyFactor=function(){return this._simplifyFactor},Si.prototype.getQuadrantSegments=function(){return this._quadrantSegments},Si.prototype.setEndCapStyle=function(a){this._endCapStyle=a},Si.prototype.getMitreLimit=function(){return this._mitreLimit},Si.prototype.setMitreLimit=function(a){this._mitreLimit=a},Si.prototype.setSingleSided=function(a){this._isSingleSided=a},Si.prototype.interfaces_=function(){return[]},Si.prototype.getClass=function(){return Si},Si.bufferDistanceError=function(a){var h=Math.PI/2/a;return 1-Math.cos(h/2)},Ni.CAP_ROUND.get=function(){return 1},Ni.CAP_FLAT.get=function(){return 2},Ni.CAP_SQUARE.get=function(){return 3},Ni.JOIN_ROUND.get=function(){return 1},Ni.JOIN_MITRE.get=function(){return 2},Ni.JOIN_BEVEL.get=function(){return 3},Ni.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Ni.DEFAULT_MITRE_LIMIT.get=function(){return 5},Ni.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(Si,Ni);var ki=function(a){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=en.COUNTERCLOCKWISE,this._inputLine=a||null},ml={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};ki.prototype.isDeletable=function(a,h,y,x){var D=this._inputLine[a],U=this._inputLine[h],H=this._inputLine[y];return!!this.isConcave(D,U,H)&&!!this.isShallow(D,U,H,x)&&this.isShallowSampled(D,U,a,y,x)},ki.prototype.deleteShallowConcavities=function(){for(var a=1,h=this.findNextNonDeletedIndex(a),y=this.findNextNonDeletedIndex(h),x=!1;y<this._inputLine.length;){var D=!1;this.isDeletable(a,h,y,this._distanceTol)&&(this._isDeleted[h]=ki.DELETE,D=!0,x=!0),h=this.findNextNonDeletedIndex(a=D?y:h),y=this.findNextNonDeletedIndex(h)}return x},ki.prototype.isShallowConcavity=function(a,h,y,x){return en.computeOrientation(a,h,y)===this._angleOrientation&&en.distancePointLine(h,a,y)<x},ki.prototype.isShallowSampled=function(a,h,y,x,D){var U=Math.trunc((x-y)/ki.NUM_PTS_TO_CHECK);U<=0&&(U=1);for(var H=y;H<x;H+=U)if(!this.isShallow(a,h,this._inputLine[H],D))return!1;return!0},ki.prototype.isConcave=function(a,h,y){return en.computeOrientation(a,h,y)===this._angleOrientation},ki.prototype.simplify=function(a){this._distanceTol=Math.abs(a),a<0&&(this._angleOrientation=en.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var h=!1;do{h=this.deleteShallowConcavities()}while(h);return this.collapseLine()},ki.prototype.findNextNonDeletedIndex=function(a){for(var h=a+1;h<this._inputLine.length&&this._isDeleted[h]===ki.DELETE;)h++;return h},ki.prototype.isShallow=function(a,h,y,x){return en.distancePointLine(h,a,y)<x},ki.prototype.collapseLine=function(){for(var a=new Nt,h=0;h<this._inputLine.length;h++)this._isDeleted[h]!==ki.DELETE&&a.add(this._inputLine[h]);return a.toCoordinateArray()},ki.prototype.interfaces_=function(){return[]},ki.prototype.getClass=function(){return ki},ki.simplify=function(a,h){return new ki(a).simplify(h)},ml.INIT.get=function(){return 0},ml.DELETE.get=function(){return 1},ml.KEEP.get=function(){return 1},ml.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(ki,ml);var Qa=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Ze},Bh={COORDINATE_ARRAY_TYPE:{configurable:!0}};Qa.prototype.getCoordinates=function(){return this._ptList.toArray(Qa.COORDINATE_ARRAY_TYPE)},Qa.prototype.setPrecisionModel=function(a){this._precisionModel=a},Qa.prototype.addPt=function(a){var h=new re(a);if(this._precisionModel.makePrecise(h),this.isRedundant(h))return null;this._ptList.add(h)},Qa.prototype.revere=function(){},Qa.prototype.addPts=function(a,h){if(h)for(var y=0;y<a.length;y++)this.addPt(a[y]);else for(var x=a.length-1;x>=0;x--)this.addPt(a[x])},Qa.prototype.isRedundant=function(a){if(this._ptList.size()<1)return!1;var h=this._ptList.get(this._ptList.size()-1);return a.distance(h)<this._minimimVertexDistance},Qa.prototype.toString=function(){return(new er).createLineString(this.getCoordinates()).toString()},Qa.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var a=new re(this._ptList.get(0)),h=this._ptList.get(this._ptList.size()-1);if(a.equals(h))return null;this._ptList.add(a)},Qa.prototype.setMinimumVertexDistance=function(a){this._minimimVertexDistance=a},Qa.prototype.interfaces_=function(){return[]},Qa.prototype.getClass=function(){return Qa},Bh.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Qa,Bh);var ei=function(){},Oc={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};ei.prototype.interfaces_=function(){return[]},ei.prototype.getClass=function(){return ei},ei.toDegrees=function(a){return 180*a/Math.PI},ei.normalize=function(a){for(;a>Math.PI;)a-=ei.PI_TIMES_2;for(;a<=-Math.PI;)a+=ei.PI_TIMES_2;return a},ei.angle=function(){if(1===arguments.length){var a=arguments[0];return Math.atan2(a.y,a.x)}if(2===arguments.length){var h=arguments[0],y=arguments[1];return Math.atan2(y.y-h.y,y.x-h.x)}},ei.isAcute=function(a,h,y){return(a.x-h.x)*(y.x-h.x)+(a.y-h.y)*(y.y-h.y)>0},ei.isObtuse=function(a,h,y){return(a.x-h.x)*(y.x-h.x)+(a.y-h.y)*(y.y-h.y)<0},ei.interiorAngle=function(a,h,y){var x=ei.angle(h,a),D=ei.angle(h,y);return Math.abs(D-x)},ei.normalizePositive=function(a){if(a<0){for(;a<0;)a+=ei.PI_TIMES_2;a>=ei.PI_TIMES_2&&(a=0)}else{for(;a>=ei.PI_TIMES_2;)a-=ei.PI_TIMES_2;a<0&&(a=0)}return a},ei.angleBetween=function(a,h,y){var x=ei.angle(h,a),D=ei.angle(h,y);return ei.diff(x,D)},ei.diff=function(a,h){var y=null;return(y=a<h?h-a:a-h)>Math.PI&&(y=2*Math.PI-y),y},ei.toRadians=function(a){return a*Math.PI/180},ei.getTurn=function(a,h){var y=Math.sin(h-a);return y>0?ei.COUNTERCLOCKWISE:y<0?ei.CLOCKWISE:ei.NONE},ei.angleBetweenOriented=function(a,h,y){var x=ei.angle(h,a),D=ei.angle(h,y)-x;return D<=-Math.PI?D+ei.PI_TIMES_2:D>Math.PI?D-ei.PI_TIMES_2:D},Oc.PI_TIMES_2.get=function(){return 2*Math.PI},Oc.PI_OVER_2.get=function(){return Math.PI/2},Oc.PI_OVER_4.get=function(){return Math.PI/4},Oc.COUNTERCLOCKWISE.get=function(){return en.COUNTERCLOCKWISE},Oc.CLOCKWISE.get=function(){return en.CLOCKWISE},Oc.NONE.get=function(){return en.COLLINEAR},Object.defineProperties(ei,Oc);var $i=function a(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new hr,this._seg1=new hr,this._offset0=new hr,this._offset1=new hr,this._side=0,this._hasNarrowConcaveAngle=!1;var y=arguments[1],x=arguments[2];this._precisionModel=arguments[0],this._bufParams=y,this._li=new Yt,this._filletAngleQuantum=Math.PI/2/y.getQuadrantSegments(),y.getQuadrantSegments()>=8&&y.getJoinStyle()===Si.JOIN_ROUND&&(this._closingSegLengthFactor=a.MAX_CLOSING_SEG_LEN_FACTOR),this.init(x)},Nc={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};$i.prototype.addNextSegment=function(a,h){if(this._s0=this._s1,this._s1=this._s2,this._s2=a,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var y=en.computeOrientation(this._s0,this._s1,this._s2),x=y===en.CLOCKWISE&&this._side===Tn.LEFT||y===en.COUNTERCLOCKWISE&&this._side===Tn.RIGHT;0===y?this.addCollinear(h):x?this.addOutsideTurn(y,h):this.addInsideTurn(y,h)},$i.prototype.addLineEndCap=function(a,h){var y=new hr(a,h),x=new hr;this.computeOffsetSegment(y,Tn.LEFT,this._distance,x);var D=new hr;this.computeOffsetSegment(y,Tn.RIGHT,this._distance,D);var pe=Math.atan2(h.y-a.y,h.x-a.x);switch(this._bufParams.getEndCapStyle()){case Si.CAP_ROUND:this._segList.addPt(x.p1),this.addFilletArc(h,pe+Math.PI/2,pe-Math.PI/2,en.CLOCKWISE,this._distance),this._segList.addPt(D.p1);break;case Si.CAP_FLAT:this._segList.addPt(x.p1),this._segList.addPt(D.p1);break;case Si.CAP_SQUARE:var Ge=new re;Ge.x=Math.abs(this._distance)*Math.cos(pe),Ge.y=Math.abs(this._distance)*Math.sin(pe);var wt=new re(x.p1.x+Ge.x,x.p1.y+Ge.y),qt=new re(D.p1.x+Ge.x,D.p1.y+Ge.y);this._segList.addPt(wt),this._segList.addPt(qt)}},$i.prototype.getCoordinates=function(){return this._segList.getCoordinates()},$i.prototype.addMitreJoin=function(a,h,y,x){var D=!0,U=null;try{U=Nn.intersection(h.p0,h.p1,y.p0,y.p1),(x<=0?1:U.distance(a)/Math.abs(x))>this._bufParams.getMitreLimit()&&(D=!1)}catch(H){if(!(H instanceof jn))throw H;U=new re(0,0),D=!1}D?this._segList.addPt(U):this.addLimitedMitreJoin(h,y,x,this._bufParams.getMitreLimit())},$i.prototype.addFilletCorner=function(a,h,y,x,D){var pe=Math.atan2(h.y-a.y,h.x-a.x),qt=Math.atan2(y.y-a.y,y.x-a.x);x===en.CLOCKWISE?pe<=qt&&(pe+=2*Math.PI):pe>=qt&&(pe-=2*Math.PI),this._segList.addPt(h),this.addFilletArc(a,pe,qt,x,D),this._segList.addPt(y)},$i.prototype.addOutsideTurn=function(a,h){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*$i.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Si.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Si.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(h&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,a,this._distance),this._segList.addPt(this._offset1.p0))},$i.prototype.createSquare=function(a){this._segList.addPt(new re(a.x+this._distance,a.y+this._distance)),this._segList.addPt(new re(a.x+this._distance,a.y-this._distance)),this._segList.addPt(new re(a.x-this._distance,a.y-this._distance)),this._segList.addPt(new re(a.x-this._distance,a.y+this._distance)),this._segList.closeRing()},$i.prototype.addSegments=function(a,h){this._segList.addPts(a,h)},$i.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},$i.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},$i.prototype.initSideSegments=function(a,h,y){this._s1=a,this._s2=h,this._side=y,this._seg1.setCoordinates(a,h),this.computeOffsetSegment(this._seg1,y,this._distance,this._offset1)},$i.prototype.addLimitedMitreJoin=function(a,h,y,x){var D=this._seg0.p1,U=ei.angle(D,this._seg0.p0),H=ei.angleBetweenOriented(this._seg0.p0,D,this._seg1.p1)/2,pe=ei.normalize(U+H),Ge=ei.normalize(pe+Math.PI),wt=x*y,qt=y-wt*Math.abs(Math.sin(H)),nn=D.x+wt*Math.cos(Ge),Wn=D.y+wt*Math.sin(Ge),kn=new re(nn,Wn),tr=new hr(D,kn),lr=tr.pointAlongOffset(1,qt),ji=tr.pointAlongOffset(1,-qt);this._side===Tn.LEFT?(this._segList.addPt(lr),this._segList.addPt(ji)):(this._segList.addPt(ji),this._segList.addPt(lr))},$i.prototype.computeOffsetSegment=function(a,h,y,x){var D=h===Tn.LEFT?1:-1,U=a.p1.x-a.p0.x,H=a.p1.y-a.p0.y,pe=Math.sqrt(U*U+H*H),Ge=D*y*U/pe,wt=D*y*H/pe;x.p0.x=a.p0.x-wt,x.p0.y=a.p0.y+Ge,x.p1.x=a.p1.x-wt,x.p1.y=a.p1.y+Ge},$i.prototype.addFilletArc=function(a,h,y,x,D){var U=x===en.CLOCKWISE?-1:1,H=Math.abs(h-y),pe=Math.trunc(H/this._filletAngleQuantum+.5);if(pe<1)return null;for(var Ge=H/pe,wt=0,qt=new re;wt<H;){var nn=h+U*wt;qt.x=a.x+D*Math.cos(nn),qt.y=a.y+D*Math.sin(nn),this._segList.addPt(qt),wt+=Ge}},$i.prototype.addInsideTurn=function(a,h){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*$i.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var y=new re((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(y);var x=new re((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(x)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},$i.prototype.createCircle=function(a){var h=new re(a.x+this._distance,a.y);this._segList.addPt(h),this.addFilletArc(a,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},$i.prototype.addBevelJoin=function(a,h){this._segList.addPt(a.p1),this._segList.addPt(h.p0)},$i.prototype.init=function(a){this._distance=a,this._maxCurveSegmentError=a*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Qa,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(a*$i.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},$i.prototype.addCollinear=function(a){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===Si.JOIN_BEVEL||this._bufParams.getJoinStyle()===Si.JOIN_MITRE?(a&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,en.CLOCKWISE,this._distance))},$i.prototype.closeRing=function(){this._segList.closeRing()},$i.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},$i.prototype.interfaces_=function(){return[]},$i.prototype.getClass=function(){return $i},Nc.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Nc.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Nc.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Nc.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties($i,Nc);var fr=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var h=arguments[1];this._precisionModel=arguments[0],this._bufParams=h};fr.prototype.getOffsetCurve=function(a,h){if(this._distance=h,0===h)return null;var y=h<0,x=Math.abs(h),D=this.getSegGen(x);a.length<=1?this.computePointCurve(a[0],D):this.computeOffsetCurve(a,y,D);var U=D.getCoordinates();return y&&lt.reverse(U),U},fr.prototype.computeSingleSidedBufferCurve=function(a,h,y){var x=this.simplifyTolerance(this._distance);if(h){y.addSegments(a,!0);var D=ki.simplify(a,-x),U=D.length-1;y.initSideSegments(D[U],D[U-1],Tn.LEFT),y.addFirstSegment();for(var H=U-2;H>=0;H--)y.addNextSegment(D[H],!0)}else{y.addSegments(a,!1);var pe=ki.simplify(a,x),Ge=pe.length-1;y.initSideSegments(pe[0],pe[1],Tn.LEFT),y.addFirstSegment();for(var wt=2;wt<=Ge;wt++)y.addNextSegment(pe[wt],!0)}y.addLastSegment(),y.closeRing()},fr.prototype.computeRingBufferCurve=function(a,h,y){var x=this.simplifyTolerance(this._distance);h===Tn.RIGHT&&(x=-x);var D=ki.simplify(a,x),U=D.length-1;y.initSideSegments(D[U-1],D[0],h);for(var H=1;H<=U;H++)y.addNextSegment(D[H],1!==H);y.closeRing()},fr.prototype.computeLineBufferCurve=function(a,h){var y=this.simplifyTolerance(this._distance),x=ki.simplify(a,y),D=x.length-1;h.initSideSegments(x[0],x[1],Tn.LEFT);for(var U=2;U<=D;U++)h.addNextSegment(x[U],!0);h.addLastSegment(),h.addLineEndCap(x[D-1],x[D]);var H=ki.simplify(a,-y),pe=H.length-1;h.initSideSegments(H[pe],H[pe-1],Tn.LEFT);for(var Ge=pe-2;Ge>=0;Ge--)h.addNextSegment(H[Ge],!0);h.addLastSegment(),h.addLineEndCap(H[1],H[0]),h.closeRing()},fr.prototype.computePointCurve=function(a,h){switch(this._bufParams.getEndCapStyle()){case Si.CAP_ROUND:h.createCircle(a);break;case Si.CAP_SQUARE:h.createSquare(a)}},fr.prototype.getLineCurve=function(a,h){if(this._distance=h,h<0&&!this._bufParams.isSingleSided()||0===h)return null;var y=Math.abs(h),x=this.getSegGen(y);return a.length<=1?this.computePointCurve(a[0],x):this._bufParams.isSingleSided()?this.computeSingleSidedBufferCurve(a,h<0,x):this.computeLineBufferCurve(a,x),x.getCoordinates()},fr.prototype.getBufferParameters=function(){return this._bufParams},fr.prototype.simplifyTolerance=function(a){return a*this._bufParams.getSimplifyFactor()},fr.prototype.getRingCurve=function(a,h,y){if(this._distance=y,a.length<=2)return this.getLineCurve(a,y);if(0===y)return fr.copyCoordinates(a);var x=this.getSegGen(y);return this.computeRingBufferCurve(a,h,x),x.getCoordinates()},fr.prototype.computeOffsetCurve=function(a,h,y){var x=this.simplifyTolerance(this._distance);if(h){var D=ki.simplify(a,-x),U=D.length-1;y.initSideSegments(D[U],D[U-1],Tn.LEFT),y.addFirstSegment();for(var H=U-2;H>=0;H--)y.addNextSegment(D[H],!0)}else{var pe=ki.simplify(a,x),Ge=pe.length-1;y.initSideSegments(pe[0],pe[1],Tn.LEFT),y.addFirstSegment();for(var wt=2;wt<=Ge;wt++)y.addNextSegment(pe[wt],!0)}y.addLastSegment()},fr.prototype.getSegGen=function(a){return new $i(this._precisionModel,this._bufParams,a)},fr.prototype.interfaces_=function(){return[]},fr.prototype.getClass=function(){return fr},fr.copyCoordinates=function(a){for(var h=new Array(a.length).fill(null),y=0;y<h.length;y++)h[y]=new re(a[y]);return h};var Lu=function(){this._subgraphs=null,this._seg=new hr,this._cga=new en,this._subgraphs=arguments[0]},qn={DepthSegment:{configurable:!0}};Lu.prototype.findStabbedSegments=function(){if(1===arguments.length){for(var a=arguments[0],h=new Ze,y=this._subgraphs.iterator();y.hasNext();){var x=y.next(),D=x.getEnvelope();a.y<D.getMinY()||a.y>D.getMaxY()||this.findStabbedSegments(a,x.getDirectedEdges(),h)}return h}if(3===arguments.length)if(Bt(arguments[2],ct)&&arguments[0]instanceof re&&arguments[1]instanceof As){for(var U=arguments[0],H=arguments[1],pe=arguments[2],Ge=H.getEdge().getCoordinates(),wt=0;wt<Ge.length-1;wt++)if(this._seg.p0=Ge[wt],this._seg.p1=Ge[wt+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<U.x||this._seg.isHorizontal()||U.y<this._seg.p0.y||U.y>this._seg.p1.y||en.computeOrientation(this._seg.p0,this._seg.p1,U)===en.RIGHT)){var qt=H.getDepth(Tn.LEFT);this._seg.p0.equals(Ge[wt])||(qt=H.getDepth(Tn.RIGHT));var nn=new xu(this._seg,qt);pe.add(nn)}}else if(Bt(arguments[2],ct)&&arguments[0]instanceof re&&Bt(arguments[1],ct))for(var Wn=arguments[0],tr=arguments[2],lr=arguments[1].iterator();lr.hasNext();){var ji=lr.next();ji.isForward()&&this.findStabbedSegments(Wn,ji,tr)}},Lu.prototype.getDepth=function(a){var h=this.findStabbedSegments(a);return 0===h.size()?0:Yu.min(h)._leftDepth},Lu.prototype.interfaces_=function(){return[]},Lu.prototype.getClass=function(){return Lu},qn.DepthSegment.get=function(){return xu},Object.defineProperties(Lu,qn);var xu=function(){this._upwardSeg=null,this._leftDepth=null;var h=arguments[1];this._upwardSeg=new hr(arguments[0]),this._leftDepth=h};xu.prototype.compareTo=function(a){var h=a;if(this._upwardSeg.minX()>=h._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=h._upwardSeg.minX())return-1;var y=this._upwardSeg.orientationIndex(h._upwardSeg);return 0!==y||0!=(y=-1*h._upwardSeg.orientationIndex(this._upwardSeg))?y:this._upwardSeg.compareTo(h._upwardSeg)},xu.prototype.compareX=function(a,h){var y=a.p0.compareTo(h.p0);return 0!==y?y:a.p1.compareTo(h.p1)},xu.prototype.toString=function(){return this._upwardSeg.toString()},xu.prototype.interfaces_=function(){return[oe]},xu.prototype.getClass=function(){return xu};var Fi=function(a,h,y){this.p0=a||null,this.p1=h||null,this.p2=y||null};Fi.prototype.area=function(){return Fi.area(this.p0,this.p1,this.p2)},Fi.prototype.signedArea=function(){return Fi.signedArea(this.p0,this.p1,this.p2)},Fi.prototype.interpolateZ=function(a){if(null===a)throw new ce("Supplied point is null.");return Fi.interpolateZ(a,this.p0,this.p1,this.p2)},Fi.prototype.longestSideLength=function(){return Fi.longestSideLength(this.p0,this.p1,this.p2)},Fi.prototype.isAcute=function(){return Fi.isAcute(this.p0,this.p1,this.p2)},Fi.prototype.circumcentre=function(){return Fi.circumcentre(this.p0,this.p1,this.p2)},Fi.prototype.area3D=function(){return Fi.area3D(this.p0,this.p1,this.p2)},Fi.prototype.centroid=function(){return Fi.centroid(this.p0,this.p1,this.p2)},Fi.prototype.inCentre=function(){return Fi.inCentre(this.p0,this.p1,this.p2)},Fi.prototype.interfaces_=function(){return[]},Fi.prototype.getClass=function(){return Fi},Fi.area=function(a,h,y){return Math.abs(((y.x-a.x)*(h.y-a.y)-(h.x-a.x)*(y.y-a.y))/2)},Fi.signedArea=function(a,h,y){return((y.x-a.x)*(h.y-a.y)-(h.x-a.x)*(y.y-a.y))/2},Fi.det=function(a,h,y,x){return a*x-h*y},Fi.interpolateZ=function(a,h,y,x){var D=h.x,U=h.y,H=y.x-D,pe=x.x-D,Ge=y.y-U,wt=x.y-U,qt=H*wt-pe*Ge,nn=a.x-D,Wn=a.y-U;return h.z+(wt*nn-pe*Wn)/qt*(y.z-h.z)+(-Ge*nn+H*Wn)/qt*(x.z-h.z)},Fi.longestSideLength=function(a,h,y){var x=a.distance(h),D=h.distance(y),U=y.distance(a),H=x;return D>H&&(H=D),U>H&&(H=U),H},Fi.isAcute=function(a,h,y){return!!ei.isAcute(a,h,y)&&!!ei.isAcute(h,y,a)&&!!ei.isAcute(y,a,h)},Fi.circumcentre=function(a,h,y){var x=y.x,D=y.y,U=a.x-x,H=a.y-D,pe=h.x-x,Ge=h.y-D,wt=2*Fi.det(U,H,pe,Ge),qt=Fi.det(H,U*U+H*H,Ge,pe*pe+Ge*Ge),nn=Fi.det(U,U*U+H*H,pe,pe*pe+Ge*Ge);return new re(x-qt/wt,D+nn/wt)},Fi.perpendicularBisector=function(a,h){var y=h.x-a.x,x=h.y-a.y,D=new Nn(a.x+y/2,a.y+x/2,1),U=new Nn(a.x-x+y/2,a.y+y+x/2,1);return new Nn(D,U)},Fi.angleBisector=function(a,h,y){var x=h.distance(a),D=x/(x+h.distance(y));return new re(a.x+D*(y.x-a.x),a.y+D*(y.y-a.y))},Fi.area3D=function(a,h,y){var x=h.x-a.x,D=h.y-a.y,U=h.z-a.z,H=y.x-a.x,pe=y.y-a.y,Ge=y.z-a.z,wt=D*Ge-U*pe,qt=U*H-x*Ge,nn=x*pe-D*H;return Math.sqrt(wt*wt+qt*qt+nn*nn)/2},Fi.centroid=function(a,h,y){return new re((a.x+h.x+y.x)/3,(a.y+h.y+y.y)/3)},Fi.inCentre=function(a,h,y){var x=h.distance(y),D=a.distance(y),U=a.distance(h),H=x+D+U;return new re((x*a.x+D*h.x+U*y.x)/H,(x*a.y+D*h.y+U*y.y)/H)};var ha=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Ze;var h=arguments[1],y=arguments[2];this._inputGeom=arguments[0],this._distance=h,this._curveBuilder=y};ha.prototype.addPoint=function(a){if(this._distance<=0)return null;var h=a.getCoordinates(),y=this._curveBuilder.getLineCurve(h,this._distance);this.addCurve(y,Ne.EXTERIOR,Ne.INTERIOR)},ha.prototype.addPolygon=function(a){var h=this._distance,y=Tn.LEFT;this._distance<0&&(h=-this._distance,y=Tn.RIGHT);var x=a.getExteriorRing(),D=lt.removeRepeatedPoints(x.getCoordinates());if(this._distance<0&&this.isErodedCompletely(x,this._distance)||this._distance<=0&&D.length<3)return null;this.addPolygonRing(D,h,y,Ne.EXTERIOR,Ne.INTERIOR);for(var U=0;U<a.getNumInteriorRing();U++){var H=a.getInteriorRingN(U),pe=lt.removeRepeatedPoints(H.getCoordinates());this._distance>0&&this.isErodedCompletely(H,-this._distance)||this.addPolygonRing(pe,h,Tn.opposite(y),Ne.INTERIOR,Ne.EXTERIOR)}},ha.prototype.isTriangleErodedCompletely=function(a,h){var y=new Fi(a[0],a[1],a[2]),x=y.inCentre();return en.distancePointLine(x,y.p0,y.p1)<Math.abs(h)},ha.prototype.addLineString=function(a){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var h=lt.removeRepeatedPoints(a.getCoordinates()),y=this._curveBuilder.getLineCurve(h,this._distance);this.addCurve(y,Ne.EXTERIOR,Ne.INTERIOR)},ha.prototype.addCurve=function(a,h,y){if(null===a||a.length<2)return null;var x=new Yo(a,new Ui(0,Ne.BOUNDARY,h,y));this._curveList.add(x)},ha.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},ha.prototype.addPolygonRing=function(a,h,y,x,D){if(0===h&&a.length<Za.MINIMUM_VALID_SIZE)return null;var U=x,H=D;a.length>=Za.MINIMUM_VALID_SIZE&&en.isCCW(a)&&(U=D,H=x,y=Tn.opposite(y));var pe=this._curveBuilder.getRingCurve(a,y,h);this.addCurve(pe,U,H)},ha.prototype.add=function(a){if(a.isEmpty())return null;a instanceof ms?this.addPolygon(a):a instanceof ps?this.addLineString(a):a instanceof gs?this.addPoint(a):(a instanceof Ac||a instanceof pl||a instanceof Oa||a instanceof zi)&&this.addCollection(a)},ha.prototype.isErodedCompletely=function(a,h){var y=a.getCoordinates();if(y.length<4)return h<0;if(4===y.length)return this.isTriangleErodedCompletely(y,h);var x=a.getEnvelopeInternal(),D=Math.min(x.getHeight(),x.getWidth());return h<0&&2*Math.abs(h)>D},ha.prototype.addCollection=function(a){for(var h=0;h<a.getNumGeometries();h++){var y=a.getGeometryN(h);this.add(y)}},ha.prototype.interfaces_=function(){return[]},ha.prototype.getClass=function(){return ha};var kc=function(){};kc.prototype.locate=function(a){},kc.prototype.interfaces_=function(){return[]},kc.prototype.getClass=function(){return kc};var eu=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var a=arguments[0];this._parent=a,this._atStart=!0,this._index=0,this._max=a.getNumGeometries()};eu.prototype.next=function(){if(this._atStart)return this._atStart=!1,eu.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Ee;var a=this._parent.getGeometryN(this._index++);return a instanceof zi?(this._subcollectionIterator=new eu(a),this._subcollectionIterator.next()):a},eu.prototype.remove=function(){throw new Error(this.getClass().getName())},eu.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},eu.prototype.interfaces_=function(){return[tt]},eu.prototype.getClass=function(){return eu},eu.isAtomic=function(a){return!(a instanceof zi)};var lu=function(){this._geom=null,this._geom=arguments[0]};lu.prototype.locate=function(a){return lu.locate(a,this._geom)},lu.prototype.interfaces_=function(){return[kc]},lu.prototype.getClass=function(){return lu},lu.isPointInRing=function(a,h){return!!h.getEnvelopeInternal().intersects(a)&&en.isPointInRing(a,h.getCoordinates())},lu.containsPointInPolygon=function(a,h){if(h.isEmpty())return!1;var y=h.getExteriorRing();if(!lu.isPointInRing(a,y))return!1;for(var x=0;x<h.getNumInteriorRing();x++){var D=h.getInteriorRingN(x);if(lu.isPointInRing(a,D))return!1}return!0},lu.containsPoint=function(a,h){if(h instanceof ms)return lu.containsPointInPolygon(a,h);if(h instanceof zi)for(var y=new eu(h);y.hasNext();){var x=y.next();if(x!==h&&lu.containsPoint(a,x))return!0}return!1},lu.locate=function(a,h){return h.isEmpty()?Ne.EXTERIOR:lu.containsPoint(a,h)?Ne.INTERIOR:Ne.EXTERIOR};var ss=function(){this._edgeMap=new gt,this._edgeList=null,this._ptInAreaLocation=[Ne.NONE,Ne.NONE]};ss.prototype.getNextCW=function(a){this.getEdges();var h=this._edgeList.indexOf(a),y=h-1;return 0===h&&(y=this._edgeList.size()-1),this._edgeList.get(y)},ss.prototype.propagateSideLabels=function(a){for(var h=Ne.NONE,y=this.iterator();y.hasNext();){var x=y.next().getLabel();x.isArea(a)&&x.getLocation(a,Tn.LEFT)!==Ne.NONE&&(h=x.getLocation(a,Tn.LEFT))}if(h===Ne.NONE)return null;for(var D=h,U=this.iterator();U.hasNext();){var H=U.next(),pe=H.getLabel();if(pe.getLocation(a,Tn.ON)===Ne.NONE&&pe.setLocation(a,Tn.ON,D),pe.isArea(a)){var Ge=pe.getLocation(a,Tn.LEFT),wt=pe.getLocation(a,Tn.RIGHT);if(wt!==Ne.NONE){if(wt!==D)throw new Hn("side location conflict",H.getCoordinate());Ge===Ne.NONE&&Se.shouldNeverReachHere("found single null side (at "+H.getCoordinate()+")"),D=Ge}else Se.isTrue(pe.getLocation(a,Tn.LEFT)===Ne.NONE,"found single null side"),pe.setLocation(a,Tn.RIGHT,D),pe.setLocation(a,Tn.LEFT,D)}}},ss.prototype.getCoordinate=function(){var a=this.iterator();return a.hasNext()?a.next().getCoordinate():null},ss.prototype.print=function(a){xn.out.println("EdgeEndStar:   "+this.getCoordinate());for(var h=this.iterator();h.hasNext();)h.next().print(a)},ss.prototype.isAreaLabelsConsistent=function(a){return this.computeEdgeEndLabels(a.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},ss.prototype.checkAreaLabelsConsistent=function(a){var h=this.getEdges();if(h.size()<=0)return!0;var y=h.size()-1,x=h.get(y).getLabel().getLocation(a,Tn.LEFT);Se.isTrue(x!==Ne.NONE,"Found unlabelled area edge");for(var D=x,U=this.iterator();U.hasNext();){var H=U.next().getLabel();Se.isTrue(H.isArea(a),"Found non-area edge");var pe=H.getLocation(a,Tn.LEFT),Ge=H.getLocation(a,Tn.RIGHT);if(pe===Ge||Ge!==D)return!1;D=pe}return!0},ss.prototype.findIndex=function(a){this.iterator();for(var h=0;h<this._edgeList.size();h++)if(this._edgeList.get(h)===a)return h;return-1},ss.prototype.iterator=function(){return this.getEdges().iterator()},ss.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new Ze(this._edgeMap.values())),this._edgeList},ss.prototype.getLocation=function(a,h,y){return this._ptInAreaLocation[a]===Ne.NONE&&(this._ptInAreaLocation[a]=lu.locate(h,y[a].getGeometry())),this._ptInAreaLocation[a]},ss.prototype.toString=function(){var a=new Ue;a.append("EdgeEndStar:   "+this.getCoordinate()),a.append("\n");for(var h=this.iterator();h.hasNext();){var y=h.next();a.append(y),a.append("\n")}return a.toString()},ss.prototype.computeEdgeEndLabels=function(a){for(var h=this.iterator();h.hasNext();)h.next().computeLabel(a)},ss.prototype.computeLabelling=function(a){this.computeEdgeEndLabels(a[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var h=[!1,!1],y=this.iterator();y.hasNext();)for(var x=y.next().getLabel(),D=0;D<2;D++)x.isLine(D)&&x.getLocation(D)===Ne.BOUNDARY&&(h[D]=!0);for(var U=this.iterator();U.hasNext();)for(var H=U.next(),pe=H.getLabel(),Ge=0;Ge<2;Ge++)if(pe.isAnyNull(Ge)){var wt=Ne.NONE;if(h[Ge])wt=Ne.EXTERIOR;else{var qt=H.getCoordinate();wt=this.getLocation(Ge,qt,a)}pe.setAllLocationsIfNull(Ge,wt)}},ss.prototype.getDegree=function(){return this._edgeMap.size()},ss.prototype.insertEdgeEnd=function(a,h){this._edgeMap.put(a,h),this._edgeList=null},ss.prototype.interfaces_=function(){return[]},ss.prototype.getClass=function(){return ss};var Tl=function(a){function h(){a.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var y=null,x=null,D=this._SCANNING_FOR_INCOMING,U=0;U<this._resultAreaEdgeList.size();U++){var H=this._resultAreaEdgeList.get(U),pe=H.getSym();if(H.getLabel().isArea())switch(null===y&&H.isInResult()&&(y=H),D){case this._SCANNING_FOR_INCOMING:if(!pe.isInResult())continue;x=pe,D=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!H.isInResult())continue;x.setNext(H),D=this._SCANNING_FOR_INCOMING}}if(D===this._LINKING_TO_OUTGOING){if(null===y)throw new Hn("no outgoing dirEdge found",this.getCoordinate());Se.isTrue(y.isInResult(),"unable to link last incoming dirEdge"),x.setNext(y)}},h.prototype.insert=function(y){this.insertEdgeEnd(y,y)},h.prototype.getRightmostEdge=function(){var y=this.getEdges(),x=y.size();if(x<1)return null;var D=y.get(0);if(1===x)return D;var U=y.get(x-1),H=D.getQuadrant(),pe=U.getQuadrant();return Ti.isNorthern(H)&&Ti.isNorthern(pe)?D:Ti.isNorthern(H)||Ti.isNorthern(pe)?0!==D.getDy()?D:0!==U.getDy()?U:(Se.shouldNeverReachHere("found two horizontal edges incident on node"),null):U},h.prototype.print=function(y){xn.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var x=this.iterator();x.hasNext();){var D=x.next();y.print("out "),D.print(y),y.println(),y.print("in "),D.getSym().print(y),y.println()}},h.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Ze;for(var y=this.iterator();y.hasNext();){var x=y.next();(x.isInResult()||x.getSym().isInResult())&&this._resultAreaEdgeList.add(x)}return this._resultAreaEdgeList},h.prototype.updateLabelling=function(y){for(var x=this.iterator();x.hasNext();){var D=x.next().getLabel();D.setAllLocationsIfNull(0,y.getLocation(0)),D.setAllLocationsIfNull(1,y.getLocation(1))}},h.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var y=null,x=null,D=this._edgeList.size()-1;D>=0;D--){var U=this._edgeList.get(D),H=U.getSym();null===x&&(x=H),null!==y&&H.setNext(y),y=U}x.setNext(y)},h.prototype.computeDepths=function(){if(1===arguments.length){var y=arguments[0],x=this.findIndex(y),D=y.getDepth(Tn.LEFT),U=y.getDepth(Tn.RIGHT),H=this.computeDepths(x+1,this._edgeList.size(),D);if(this.computeDepths(0,x,H)!==U)throw new Hn("depth mismatch at "+y.getCoordinate())}else if(3===arguments.length){for(var Ge=arguments[1],wt=arguments[2],qt=arguments[0];qt<Ge;qt++){var nn=this._edgeList.get(qt);nn.setEdgeDepths(Tn.RIGHT,wt),wt=nn.getDepth(Tn.LEFT)}return wt}},h.prototype.mergeSymLabels=function(){for(var y=this.iterator();y.hasNext();){var x=y.next();x.getLabel().merge(x.getSym().getLabel())}},h.prototype.linkMinimalDirectedEdges=function(y){for(var x=null,D=null,U=this._SCANNING_FOR_INCOMING,H=this._resultAreaEdgeList.size()-1;H>=0;H--){var pe=this._resultAreaEdgeList.get(H),Ge=pe.getSym();switch(null===x&&pe.getEdgeRing()===y&&(x=pe),U){case this._SCANNING_FOR_INCOMING:if(Ge.getEdgeRing()!==y)continue;D=Ge,U=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(pe.getEdgeRing()!==y)continue;D.setNextMin(pe),U=this._SCANNING_FOR_INCOMING}}U===this._LINKING_TO_OUTGOING&&(Se.isTrue(null!==x,"found null for first outgoing dirEdge"),Se.isTrue(x.getEdgeRing()===y,"unable to link last incoming dirEdge"),D.setNextMin(x))},h.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var y=0,x=this.iterator();x.hasNext();)x.next().isInResult()&&y++;return y}if(1===arguments.length){for(var D=arguments[0],U=0,H=this.iterator();H.hasNext();)H.next().getEdgeRing()===D&&U++;return U}},h.prototype.getLabel=function(){return this._label},h.prototype.findCoveredLineEdges=function(){for(var y=Ne.NONE,x=this.iterator();x.hasNext();){var D=x.next(),U=D.getSym();if(!D.isLineEdge()){if(D.isInResult()){y=Ne.INTERIOR;break}if(U.isInResult()){y=Ne.EXTERIOR;break}}}if(y===Ne.NONE)return null;for(var H=y,pe=this.iterator();pe.hasNext();){var Ge=pe.next(),wt=Ge.getSym();Ge.isLineEdge()?Ge.getEdge().setCovered(H===Ne.INTERIOR):(Ge.isInResult()&&(H=Ne.EXTERIOR),wt.isInResult()&&(H=Ne.INTERIOR))}},h.prototype.computeLabelling=function(y){a.prototype.computeLabelling.call(this,y),this._label=new Ui(Ne.NONE);for(var x=this.iterator();x.hasNext();)for(var D=x.next().getEdge().getLabel(),U=0;U<2;U++){var H=D.getLocation(U);H!==Ne.INTERIOR&&H!==Ne.BOUNDARY||this._label.setLocation(U,Ne.INTERIOR)}},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(ss),el=function(a){function h(){a.apply(this,arguments)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.createNode=function(y){return new kh(y,new Tl)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Rc),Ta=function a(){this._pts=null,this._orientation=null;var h=arguments[0];this._pts=h,this._orientation=a.orientation(h)};Ta.prototype.compareTo=function(a){return Ta.compareOriented(this._pts,this._orientation,a._pts,a._orientation)},Ta.prototype.interfaces_=function(){return[oe]},Ta.prototype.getClass=function(){return Ta},Ta.orientation=function(a){return 1===lt.increasingDirection(a)},Ta.compareOriented=function(a,h,y,x){for(var D=h?1:-1,U=x?1:-1,H=h?a.length:-1,pe=x?y.length:-1,Ge=h?0:a.length-1,wt=x?0:y.length-1;;){var qt=a[Ge].compareTo(y[wt]);if(0!==qt)return qt;var nn=(Ge+=D)===H,Wn=(wt+=U)===pe;if(nn&&!Wn)return-1;if(!nn&&Wn)return 1;if(nn&&Wn)return 0}};var Lr=function(){this._edges=new Ze,this._ocaMap=new gt};Lr.prototype.print=function(a){a.print("MULTILINESTRING ( ");for(var h=0;h<this._edges.size();h++){var y=this._edges.get(h);h>0&&a.print(","),a.print("(");for(var x=y.getCoordinates(),D=0;D<x.length;D++)D>0&&a.print(","),a.print(x[D].x+" "+x[D].y);a.println(")")}a.print(")  ")},Lr.prototype.addAll=function(a){for(var h=a.iterator();h.hasNext();)this.add(h.next())},Lr.prototype.findEdgeIndex=function(a){for(var h=0;h<this._edges.size();h++)if(this._edges.get(h).equals(a))return h;return-1},Lr.prototype.iterator=function(){return this._edges.iterator()},Lr.prototype.getEdges=function(){return this._edges},Lr.prototype.get=function(a){return this._edges.get(a)},Lr.prototype.findEqualEdge=function(a){var h=new Ta(a.getCoordinates());return this._ocaMap.get(h)},Lr.prototype.add=function(a){this._edges.add(a);var h=new Ta(a.getCoordinates());this._ocaMap.put(h,a)},Lr.prototype.interfaces_=function(){return[]},Lr.prototype.getClass=function(){return Lr};var Ou=function(){};Ou.prototype.processIntersections=function(a,h,y,x){},Ou.prototype.isDone=function(){},Ou.prototype.interfaces_=function(){return[]},Ou.prototype.getClass=function(){return Ou};var Ws=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0,this._li=arguments[0]};Ws.prototype.isTrivialIntersection=function(a,h,y,x){if(a===y&&1===this._li.getIntersectionNum()){if(Ws.isAdjacentSegments(h,x))return!0;if(a.isClosed()){var D=a.size()-1;if(0===h&&x===D||0===x&&h===D)return!0}}return!1},Ws.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Ws.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Ws.prototype.getLineIntersector=function(){return this._li},Ws.prototype.hasProperIntersection=function(){return this._hasProper},Ws.prototype.processIntersections=function(a,h,y,x){if(a===y&&h===x)return null;this.numTests++;var D=a.getCoordinates()[h],U=a.getCoordinates()[h+1],H=y.getCoordinates()[x],pe=y.getCoordinates()[x+1];this._li.computeIntersection(D,U,H,pe),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(a,h,y,x)||(this._hasIntersection=!0,a.addIntersections(this._li,h,0),y.addIntersections(this._li,x,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Ws.prototype.hasIntersection=function(){return this._hasIntersection},Ws.prototype.isDone=function(){return!1},Ws.prototype.hasInteriorIntersection=function(){return this._hasInterior},Ws.prototype.interfaces_=function(){return[Ou]},Ws.prototype.getClass=function(){return Ws},Ws.isAdjacentSegments=function(a,h){return 1===Math.abs(a-h)};var wu=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var h=arguments[1],y=arguments[2];this.coord=new re(arguments[0]),this.segmentIndex=h,this.dist=y};wu.prototype.getSegmentIndex=function(){return this.segmentIndex},wu.prototype.getCoordinate=function(){return this.coord},wu.prototype.print=function(a){a.print(this.coord),a.print(" seg # = "+this.segmentIndex),a.println(" dist = "+this.dist)},wu.prototype.compareTo=function(a){return this.compare(a.segmentIndex,a.dist)},wu.prototype.isEndPoint=function(a){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===a},wu.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},wu.prototype.getDistance=function(){return this.dist},wu.prototype.compare=function(a,h){return this.segmentIndex<a?-1:this.segmentIndex>a?1:this.dist<h?-1:this.dist>h?1:0},wu.prototype.interfaces_=function(){return[oe]},wu.prototype.getClass=function(){return wu};var tl=function(){this._nodeMap=new gt,this.edge=null,this.edge=arguments[0]};tl.prototype.print=function(a){a.println("Intersections:");for(var h=this.iterator();h.hasNext();)h.next().print(a)},tl.prototype.iterator=function(){return this._nodeMap.values().iterator()},tl.prototype.addSplitEdges=function(a){this.addEndpoints();for(var h=this.iterator(),y=h.next();h.hasNext();){var x=h.next(),D=this.createSplitEdge(y,x);a.add(D),y=x}},tl.prototype.addEndpoints=function(){var a=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[a],a,0)},tl.prototype.createSplitEdge=function(a,h){var y=h.segmentIndex-a.segmentIndex+2,D=h.dist>0||!h.coord.equals2D(this.edge.pts[h.segmentIndex]);D||y--;var U=new Array(y).fill(null),H=0;U[H++]=new re(a.coord);for(var pe=a.segmentIndex+1;pe<=h.segmentIndex;pe++)U[H++]=this.edge.pts[pe];return D&&(U[H]=h.coord),new fc(U,new Ui(this.edge._label))},tl.prototype.add=function(a,h,y){var x=new wu(a,h,y),D=this._nodeMap.get(x);return null!==D?D:(this._nodeMap.put(x,x),x)},tl.prototype.isIntersection=function(a){for(var h=this.iterator();h.hasNext();)if(h.next().coord.equals(a))return!0;return!1},tl.prototype.interfaces_=function(){return[]},tl.prototype.getClass=function(){return tl};var bu=function(){};bu.prototype.getChainStartIndices=function(a){var h=0,y=new Ze;y.add(new ft(h));do{var x=this.findChainEnd(a,h);y.add(new ft(x)),h=x}while(h<a.length-1);return bu.toIntArray(y)},bu.prototype.findChainEnd=function(a,h){for(var y=Ti.quadrant(a[h],a[h+1]),x=h+1;x<a.length&&Ti.quadrant(a[x-1],a[x])===y;)x++;return x-1},bu.prototype.interfaces_=function(){return[]},bu.prototype.getClass=function(){return bu},bu.toIntArray=function(a){for(var h=new Array(a.size()).fill(null),y=0;y<h.length;y++)h[y]=a.get(y).intValue();return h};var tu=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new wn,this.env2=new wn;var a=arguments[0];this.e=a,this.pts=a.getCoordinates();var h=new bu;this.startIndex=h.getChainStartIndices(this.pts)};tu.prototype.getCoordinates=function(){return this.pts},tu.prototype.getMaxX=function(a){var h=this.pts[this.startIndex[a]].x,y=this.pts[this.startIndex[a+1]].x;return h>y?h:y},tu.prototype.getMinX=function(a){var h=this.pts[this.startIndex[a]].x,y=this.pts[this.startIndex[a+1]].x;return h<y?h:y},tu.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var a=arguments[0],h=arguments[1],y=arguments[2];this.computeIntersectsForChain(this.startIndex[a],this.startIndex[a+1],h,h.startIndex[y],h.startIndex[y+1],arguments[3])}else if(6===arguments.length){var D=arguments[0],U=arguments[1],H=arguments[2],pe=arguments[3],Ge=arguments[4],wt=arguments[5],qt=this.pts[D],nn=this.pts[U],Wn=H.pts[pe],kn=H.pts[Ge];if(U-D==1&&Ge-pe==1)return wt.addIntersections(this.e,D,H.e,pe),null;if(this.env1.init(qt,nn),this.env2.init(Wn,kn),!this.env1.intersects(this.env2))return null;var tr=Math.trunc((D+U)/2),lr=Math.trunc((pe+Ge)/2);D<tr&&(pe<lr&&this.computeIntersectsForChain(D,tr,H,pe,lr,wt),lr<Ge&&this.computeIntersectsForChain(D,tr,H,lr,Ge,wt)),tr<U&&(pe<lr&&this.computeIntersectsForChain(tr,U,H,pe,lr,wt),lr<Ge&&this.computeIntersectsForChain(tr,U,H,lr,Ge,wt))}},tu.prototype.getStartIndexes=function(){return this.startIndex},tu.prototype.computeIntersects=function(a,h){for(var y=0;y<this.startIndex.length-1;y++)for(var x=0;x<a.startIndex.length-1;x++)this.computeIntersectsForChain(y,a,x,h)},tu.prototype.interfaces_=function(){return[]},tu.prototype.getClass=function(){return tu};var Ps=function a(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var h=0;h<2;h++)for(var y=0;y<3;y++)this._depth[h][y]=a.NULL_VALUE},lf={NULL_VALUE:{configurable:!0}};Ps.prototype.getDepth=function(a,h){return this._depth[a][h]},Ps.prototype.setDepth=function(a,h,y){this._depth[a][h]=y},Ps.prototype.isNull=function(){if(0===arguments.length){for(var a=0;a<2;a++)for(var h=0;h<3;h++)if(this._depth[a][h]!==Ps.NULL_VALUE)return!1;return!0}return 1===arguments.length?this._depth[arguments[0]][1]===Ps.NULL_VALUE:2===arguments.length?this._depth[arguments[0]][arguments[1]]===Ps.NULL_VALUE:void 0},Ps.prototype.normalize=function(){for(var a=0;a<2;a++)if(!this.isNull(a)){var h=this._depth[a][1];this._depth[a][2]<h&&(h=this._depth[a][2]),h<0&&(h=0);for(var y=1;y<3;y++){var x=0;this._depth[a][y]>h&&(x=1),this._depth[a][y]=x}}},Ps.prototype.getDelta=function(a){return this._depth[a][Tn.RIGHT]-this._depth[a][Tn.LEFT]},Ps.prototype.getLocation=function(a,h){return this._depth[a][h]<=0?Ne.EXTERIOR:Ne.INTERIOR},Ps.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},Ps.prototype.add=function(){if(1===arguments.length)for(var a=arguments[0],h=0;h<2;h++)for(var y=1;y<3;y++){var x=a.getLocation(h,y);x!==Ne.EXTERIOR&&x!==Ne.INTERIOR||(this.isNull(h,y)?this._depth[h][y]=Ps.depthAtLocation(x):this._depth[h][y]+=Ps.depthAtLocation(x))}else 3===arguments.length&&arguments[2]===Ne.INTERIOR&&this._depth[arguments[0]][arguments[1]]++},Ps.prototype.interfaces_=function(){return[]},Ps.prototype.getClass=function(){return Ps},Ps.depthAtLocation=function(a){return a===Ne.EXTERIOR?0:a===Ne.INTERIOR?1:Ps.NULL_VALUE},lf.NULL_VALUE.get=function(){return-1},Object.defineProperties(Ps,lf);var fc=function(a){function h(){if(a.call(this),this.pts=null,this._env=null,this.eiList=new tl(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Ps,this._depthDelta=0,1===arguments.length)h.call(this,arguments[0],null);else if(2===arguments.length){var D=arguments[1];this.pts=arguments[0],this._label=D}}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.getDepth=function(){return this._depth},h.prototype.getCollapsedEdge=function(){var y=new Array(2).fill(null);return y[0]=this.pts[0],y[1]=this.pts[1],new h(y,Ui.toLineLabel(this._label))},h.prototype.isIsolated=function(){return this._isIsolated},h.prototype.getCoordinates=function(){return this.pts},h.prototype.setIsolated=function(y){this._isIsolated=y},h.prototype.setName=function(y){this._name=y},h.prototype.equals=function(y){if(!(y instanceof h))return!1;var x=y;if(this.pts.length!==x.pts.length)return!1;for(var D=!0,U=!0,H=this.pts.length,pe=0;pe<this.pts.length;pe++)if(this.pts[pe].equals2D(x.pts[pe])||(D=!1),this.pts[pe].equals2D(x.pts[--H])||(U=!1),!D&&!U)return!1;return!0},h.prototype.getCoordinate=function(){return 0===arguments.length?this.pts.length>0?this.pts[0]:null:1===arguments.length?this.pts[arguments[0]]:void 0},h.prototype.print=function(y){y.print("edge "+this._name+": "),y.print("LINESTRING (");for(var x=0;x<this.pts.length;x++)x>0&&y.print(","),y.print(this.pts[x].x+" "+this.pts[x].y);y.print(")  "+this._label+" "+this._depthDelta)},h.prototype.computeIM=function(y){h.updateIM(this._label,y)},h.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},h.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},h.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},h.prototype.getDepthDelta=function(){return this._depthDelta},h.prototype.getNumPoints=function(){return this.pts.length},h.prototype.printReverse=function(y){y.print("edge "+this._name+": ");for(var x=this.pts.length-1;x>=0;x--)y.print(this.pts[x]+" ");y.println("")},h.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new tu(this)),this._mce},h.prototype.getEnvelope=function(){if(null===this._env){this._env=new wn;for(var y=0;y<this.pts.length;y++)this._env.expandToInclude(this.pts[y])}return this._env},h.prototype.addIntersection=function(y,x,D,U){var H=new re(y.getIntersection(U)),pe=x,Ge=y.getEdgeDistance(D,U),wt=pe+1;wt<this.pts.length&&H.equals2D(this.pts[wt])&&(pe=wt,Ge=0),this.eiList.add(H,pe,Ge)},h.prototype.toString=function(){var y=new Ue;y.append("edge "+this._name+": "),y.append("LINESTRING (");for(var x=0;x<this.pts.length;x++)x>0&&y.append(","),y.append(this.pts[x].x+" "+this.pts[x].y);return y.append(")  "+this._label+" "+this._depthDelta),y.toString()},h.prototype.isPointwiseEqual=function(y){if(this.pts.length!==y.pts.length)return!1;for(var x=0;x<this.pts.length;x++)if(!this.pts[x].equals2D(y.pts[x]))return!1;return!0},h.prototype.setDepthDelta=function(y){this._depthDelta=y},h.prototype.getEdgeIntersectionList=function(){return this.eiList},h.prototype.addIntersections=function(y,x,D){for(var U=0;U<y.getIntersectionNum();U++)this.addIntersection(y,x,D,U)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.updateIM=function(){if(2!==arguments.length)return a.prototype.updateIM.apply(this,arguments);var y=arguments[0],x=arguments[1];x.setAtLeastIfValid(y.getLocation(0,Tn.ON),y.getLocation(1,Tn.ON),1),y.isArea()&&(x.setAtLeastIfValid(y.getLocation(0,Tn.LEFT),y.getLocation(1,Tn.LEFT),2),x.setAtLeastIfValid(y.getLocation(0,Tn.RIGHT),y.getLocation(1,Tn.RIGHT),2))},h}(is),Rs=function(a){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Lr,this._bufParams=a||null};Rs.prototype.setWorkingPrecisionModel=function(a){this._workingPrecisionModel=a},Rs.prototype.insertUniqueEdge=function(a){var h=this._edgeList.findEqualEdge(a);if(null!==h){var y=h.getLabel(),x=a.getLabel();h.isPointwiseEqual(a)||(x=new Ui(a.getLabel())).flip(),y.merge(x);var D=Rs.depthDelta(x),U=h.getDepthDelta()+D;h.setDepthDelta(U)}else this._edgeList.add(a),a.setDepthDelta(Rs.depthDelta(a.getLabel()))},Rs.prototype.buildSubgraphs=function(a,h){for(var y=new Ze,x=a.iterator();x.hasNext();){var D=x.next(),U=D.getRightmostCoordinate(),H=new Lu(y).getDepth(U);D.computeDepth(H),D.findResultEdges(),y.add(D),h.add(D.getDirectedEdges(),D.getNodes())}},Rs.prototype.createSubgraphs=function(a){for(var h=new Ze,y=a.getNodes().iterator();y.hasNext();){var x=y.next();if(!x.isVisited()){var D=new dr;D.create(x),h.add(D)}}return Yu.sort(h,Yu.reverseOrder()),h},Rs.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},Rs.prototype.getNoder=function(a){if(null!==this._workingNoder)return this._workingNoder;var h=new $l,y=new Yt;return y.setPrecisionModel(a),h.setSegmentIntersector(new Ws(y)),h},Rs.prototype.buffer=function(a,h){var y=this._workingPrecisionModel;null===y&&(y=a.getPrecisionModel()),this._geomFact=a.getFactory();var x=new fr(y,this._bufParams),D=new ha(a,h,x).getCurves();if(D.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(D,y),this._graph=new ys(new el),this._graph.addEdges(this._edgeList.getEdges());var U=this.createSubgraphs(this._graph),H=new la(this._geomFact);this.buildSubgraphs(U,H);var pe=H.getPolygons();return pe.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(pe)},Rs.prototype.computeNodedEdges=function(a,h){var y=this.getNoder(h);y.computeNodes(a);for(var x=y.getNodedSubstrings().iterator();x.hasNext();){var D=x.next(),U=D.getCoordinates();if(2!==U.length||!U[0].equals2D(U[1])){var H=D.getData(),pe=new fc(D.getCoordinates(),new Ui(H));this.insertUniqueEdge(pe)}}},Rs.prototype.setNoder=function(a){this._workingNoder=a},Rs.prototype.interfaces_=function(){return[]},Rs.prototype.getClass=function(){return Rs},Rs.depthDelta=function(a){var h=a.getLocation(0,Tn.LEFT),y=a.getLocation(0,Tn.RIGHT);return h===Ne.INTERIOR&&y===Ne.EXTERIOR?1:h===Ne.EXTERIOR&&y===Ne.INTERIOR?-1:0},Rs.convertSegStrings=function(a){for(var h=new er,y=new Ze;a.hasNext();){var x=a.next(),D=h.createLineString(x.getCoordinates());y.add(D)}return h.buildGeometry(y)};var Fa=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var h=arguments[1];this._noder=arguments[0],this._scaleFactor=h,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var x=arguments[1],D=arguments[2],U=arguments[3];this._noder=arguments[0],this._scaleFactor=x,this._offsetX=D,this._offsetY=U,this._isScaled=!this.isIntegerPrecision()}};Fa.prototype.rescale=function(){if(Bt(arguments[0],be))for(var a=arguments[0].iterator();a.hasNext();){var h=a.next();this.rescale(h.getCoordinates())}else if(arguments[0]instanceof Array){for(var y=arguments[0],x=0;x<y.length;x++)y[x].x=y[x].x/this._scaleFactor+this._offsetX,y[x].y=y[x].y/this._scaleFactor+this._offsetY;2===y.length&&y[0].equals2D(y[1])&&xn.out.println(y)}},Fa.prototype.scale=function(){if(Bt(arguments[0],be)){for(var a=arguments[0],h=new Ze,y=a.iterator();y.hasNext();){var x=y.next();h.add(new Yo(this.scale(x.getCoordinates()),x.getData()))}return h}if(arguments[0]instanceof Array){for(var D=arguments[0],U=new Array(D.length).fill(null),H=0;H<D.length;H++)U[H]=new re(Math.round((D[H].x-this._offsetX)*this._scaleFactor),Math.round((D[H].y-this._offsetY)*this._scaleFactor),D[H].z);return lt.removeRepeatedPoints(U)}},Fa.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},Fa.prototype.getNodedSubstrings=function(){var a=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(a),a},Fa.prototype.computeNodes=function(a){var h=a;this._isScaled&&(h=this.scale(a)),this._noder.computeNodes(h)},Fa.prototype.interfaces_=function(){return[Lc]},Fa.prototype.getClass=function(){return Fa};var Ba=function(){this._li=new Yt,this._segStrings=null,this._segStrings=arguments[0]},fh={fact:{configurable:!0}};Ba.prototype.checkEndPtVertexIntersections=function(){if(0===arguments.length)for(var a=this._segStrings.iterator();a.hasNext();){var h=a.next().getCoordinates();this.checkEndPtVertexIntersections(h[0],this._segStrings),this.checkEndPtVertexIntersections(h[h.length-1],this._segStrings)}else if(2===arguments.length)for(var y=arguments[0],x=arguments[1].iterator();x.hasNext();)for(var D=x.next().getCoordinates(),U=1;U<D.length-1;U++)if(D[U].equals(y))throw new Re("found endpt/interior pt intersection at index "+U+" :pt "+y)},Ba.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var a=this._segStrings.iterator();a.hasNext();)for(var h=a.next(),y=this._segStrings.iterator();y.hasNext();){var x=y.next();this.checkInteriorIntersections(h,x)}else if(2===arguments.length)for(var D=arguments[0],U=arguments[1],H=D.getCoordinates(),pe=U.getCoordinates(),Ge=0;Ge<H.length-1;Ge++)for(var wt=0;wt<pe.length-1;wt++)this.checkInteriorIntersections(D,Ge,U,wt);else if(4===arguments.length){var qt=arguments[0],nn=arguments[1],Wn=arguments[2],kn=arguments[3];if(qt===Wn&&nn===kn)return null;var tr=qt.getCoordinates()[nn],lr=qt.getCoordinates()[nn+1],ji=Wn.getCoordinates()[kn],Gn=Wn.getCoordinates()[kn+1];if(this._li.computeIntersection(tr,lr,ji,Gn),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,tr,lr)||this.hasInteriorIntersection(this._li,ji,Gn)))throw new Re("found non-noded intersection at "+tr+"-"+lr+" and "+ji+"-"+Gn)}},Ba.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},Ba.prototype.checkCollapses=function(){if(0===arguments.length)for(var a=this._segStrings.iterator();a.hasNext();){var h=a.next();this.checkCollapses(h)}else if(1===arguments.length)for(var y=arguments[0].getCoordinates(),x=0;x<y.length-2;x++)this.checkCollapse(y[x],y[x+1],y[x+2])},Ba.prototype.hasInteriorIntersection=function(a,h,y){for(var x=0;x<a.getIntersectionNum();x++){var D=a.getIntersection(x);if(!D.equals(h)&&!D.equals(y))return!0}return!1},Ba.prototype.checkCollapse=function(a,h,y){if(a.equals(y))throw new Re("found non-noded collapse at "+Ba.fact.createLineString([a,h,y]))},Ba.prototype.interfaces_=function(){return[]},Ba.prototype.getClass=function(){return Ba},fh.fact.get=function(){return new er},Object.defineProperties(Ba,fh);var fa=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var a=arguments[0],h=arguments[1],y=arguments[2];if(this._originalPt=a,this._pt=a,this._scaleFactor=h,this._li=y,h<=0)throw new ce("Scale factor must be non-zero");1!==h&&(this._pt=new re(this.scale(a.x),this.scale(a.y)),this._p0Scaled=new re,this._p1Scaled=new re),this.initCorners(this._pt)},dc={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};fa.prototype.intersectsScaled=function(a,h){var y=Math.min(a.x,h.x),x=Math.max(a.x,h.x),D=Math.min(a.y,h.y),U=Math.max(a.y,h.y),H=this._maxx<y||this._minx>x||this._maxy<D||this._miny>U;if(H)return!1;var pe=this.intersectsToleranceSquare(a,h);return Se.isTrue(!(H&&pe),"Found bad envelope test"),pe},fa.prototype.initCorners=function(a){this._minx=a.x-.5,this._maxx=a.x+.5,this._miny=a.y-.5,this._maxy=a.y+.5,this._corner[0]=new re(this._maxx,this._maxy),this._corner[1]=new re(this._minx,this._maxy),this._corner[2]=new re(this._minx,this._miny),this._corner[3]=new re(this._maxx,this._miny)},fa.prototype.intersects=function(a,h){return 1===this._scaleFactor?this.intersectsScaled(a,h):(this.copyScaled(a,this._p0Scaled),this.copyScaled(h,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},fa.prototype.scale=function(a){return Math.round(a*this._scaleFactor)},fa.prototype.getCoordinate=function(){return this._originalPt},fa.prototype.copyScaled=function(a,h){h.x=this.scale(a.x),h.y=this.scale(a.y)},fa.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var a=fa.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new wn(this._originalPt.x-a,this._originalPt.x+a,this._originalPt.y-a,this._originalPt.y+a)}return this._safeEnv},fa.prototype.intersectsPixelClosure=function(a,h){return this._li.computeIntersection(a,h,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(a,h,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(a,h,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(a,h,this._corner[3],this._corner[0]),this._li.hasIntersection()))))},fa.prototype.intersectsToleranceSquare=function(a,h){var y=!1,x=!1;return this._li.computeIntersection(a,h,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(a,h,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(y=!0),this._li.computeIntersection(a,h,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(x=!0),this._li.computeIntersection(a,h,this._corner[3],this._corner[0]),this._li.isProper()||y&&x||a.equals(this._pt)||h.equals(this._pt)))))},fa.prototype.addSnappedNode=function(a,h){var y=a.getCoordinate(h),x=a.getCoordinate(h+1);return!!this.intersects(y,x)&&(a.addIntersection(this.getCoordinate(),h),!0)},fa.prototype.interfaces_=function(){return[]},fa.prototype.getClass=function(){return fa},dc.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(fa,dc);var ql=function(){this.tempEnv1=new wn,this.selectedSegment=new hr};ql.prototype.select=function(){1!==arguments.length&&2===arguments.length&&(arguments[0].getLineSegment(arguments[1],this.selectedSegment),this.select(this.selectedSegment))},ql.prototype.interfaces_=function(){return[]},ql.prototype.getClass=function(){return ql};var zh=function(){this._index=null,this._index=arguments[0]},Of={HotPixelSnapAction:{configurable:!0}};zh.prototype.snap=function(){if(1===arguments.length)return this.snap(arguments[0],null,-1);if(3===arguments.length){var h=arguments[0],y=arguments[1],x=arguments[2],D=h.getSafeEnvelope(),U=new Nu(h,y,x);return this._index.query(D,{interfaces_:function(){return[Hr]},visitItem:function(H){H.select(D,U)}}),U.isNodeAdded()}},zh.prototype.interfaces_=function(){return[]},zh.prototype.getClass=function(){return zh},Of.HotPixelSnapAction.get=function(){return Nu},Object.defineProperties(zh,Of);var Nu=function(a){function h(){a.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var x=arguments[1],D=arguments[2];this._hotPixel=arguments[0],this._parentEdge=x,this._hotPixelVertexIndex=D}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.isNodeAdded=function(){return this._isNodeAdded},h.prototype.select=function(){if(2!==arguments.length)return a.prototype.select.apply(this,arguments);var x=arguments[1],D=arguments[0].getContext();if(null!==this._parentEdge&&D===this._parentEdge&&x===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(D,x)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(ql),Eu=function(){this._li=null,this._interiorIntersections=null,this._li=arguments[0],this._interiorIntersections=new Ze};Eu.prototype.processIntersections=function(a,h,y,x){if(a===y&&h===x)return null;var D=a.getCoordinates()[h],U=a.getCoordinates()[h+1],H=y.getCoordinates()[x],pe=y.getCoordinates()[x+1];if(this._li.computeIntersection(D,U,H,pe),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var Ge=0;Ge<this._li.getIntersectionNum();Ge++)this._interiorIntersections.add(this._li.getIntersection(Ge));a.addIntersections(this._li,h,0),y.addIntersections(this._li,x,1)}},Eu.prototype.isDone=function(){return!1},Eu.prototype.getInteriorIntersections=function(){return this._interiorIntersections},Eu.prototype.interfaces_=function(){return[Ou]},Eu.prototype.getClass=function(){return Eu};var ea=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var a=arguments[0];this._pm=a,this._li=new Yt,this._li.setPrecisionModel(a),this._scaleFactor=a.getScale()};ea.prototype.checkCorrectness=function(a){var h=Yo.getNodedSubstrings(a),y=new Ba(h);try{y.checkValid()}catch(x){if(!(x instanceof Mn))throw x;x.printStackTrace()}},ea.prototype.getNodedSubstrings=function(){return Yo.getNodedSubstrings(this._nodedSegStrings)},ea.prototype.snapRound=function(a,h){var y=this.findInteriorIntersections(a,h);this.computeIntersectionSnaps(y),this.computeVertexSnaps(a)},ea.prototype.findInteriorIntersections=function(a,h){var y=new Eu(h);return this._noder.setSegmentIntersector(y),this._noder.computeNodes(a),y.getInteriorIntersections()},ea.prototype.computeVertexSnaps=function(){if(Bt(arguments[0],be))for(var a=arguments[0].iterator();a.hasNext();){var h=a.next();this.computeVertexSnaps(h)}else if(arguments[0]instanceof Yo)for(var y=arguments[0],x=y.getCoordinates(),D=0;D<x.length;D++){var U=new fa(x[D],this._scaleFactor,this._li);this._pointSnapper.snap(U,y,D)&&y.addIntersection(x[D],D)}},ea.prototype.computeNodes=function(a){this._nodedSegStrings=a,this._noder=new $l,this._pointSnapper=new zh(this._noder.getIndex()),this.snapRound(a,this._li)},ea.prototype.computeIntersectionSnaps=function(a){for(var h=a.iterator();h.hasNext();){var y=h.next(),x=new fa(y,this._scaleFactor,this._li);this._pointSnapper.snap(x)}},ea.prototype.interfaces_=function(){return[Lc]},ea.prototype.getClass=function(){return ea};var ta=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Si,this._resultGeometry=null,this._saveException=null,1===arguments.length)this._argGeom=arguments[0];else if(2===arguments.length){var y=arguments[1];this._argGeom=arguments[0],this._bufParams=y}},Uh={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};ta.prototype.bufferFixedPrecision=function(a){var h=new Fa(new ea(new pn(1)),a.getScale()),y=new Rs(this._bufParams);y.setWorkingPrecisionModel(a),y.setNoder(h),this._resultGeometry=y.buffer(this._argGeom,this._distance)},ta.prototype.bufferReducedPrecision=function(){var a=this;if(0===arguments.length){for(var h=ta.MAX_PRECISION_DIGITS;h>=0;h--){try{a.bufferReducedPrecision(h)}catch(U){if(!(U instanceof Hn))throw U;a._saveException=U}if(null!==a._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var x=ta.precisionScaleFactor(this._argGeom,this._distance,arguments[0]),D=new pn(x);this.bufferFixedPrecision(D)}},ta.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var a=this._argGeom.getFactory().getPrecisionModel();a.getType()===pn.FIXED?this.bufferFixedPrecision(a):this.bufferReducedPrecision()},ta.prototype.setQuadrantSegments=function(a){this._bufParams.setQuadrantSegments(a)},ta.prototype.bufferOriginalPrecision=function(){try{var a=new Rs(this._bufParams);this._resultGeometry=a.buffer(this._argGeom,this._distance)}catch(h){if(!(h instanceof Re))throw h;this._saveException=h}},ta.prototype.getResultGeometry=function(a){return this._distance=a,this.computeGeometry(),this._resultGeometry},ta.prototype.setEndCapStyle=function(a){this._bufParams.setEndCapStyle(a)},ta.prototype.interfaces_=function(){return[]},ta.prototype.getClass=function(){return ta},ta.bufferOp=function(){if(2===arguments.length){var h=arguments[1];return new ta(arguments[0]).getResultGeometry(h)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof zn&&"number"==typeof arguments[1]){var x=arguments[1],D=arguments[2],U=new ta(arguments[0]);return U.setQuadrantSegments(D),U.getResultGeometry(x)}if(arguments[2]instanceof Si&&arguments[0]instanceof zn&&"number"==typeof arguments[1]){var pe=arguments[1];return new ta(arguments[0],arguments[2]).getResultGeometry(pe)}}else if(4===arguments.length){var qt=arguments[1],nn=arguments[2],Wn=arguments[3],kn=new ta(arguments[0]);return kn.setQuadrantSegments(nn),kn.setEndCapStyle(Wn),kn.getResultGeometry(qt)}},ta.precisionScaleFactor=function(a,h,y){var x=a.getEnvelopeInternal(),D=Le.max(Math.abs(x.getMaxX()),Math.abs(x.getMaxY()),Math.abs(x.getMinX()),Math.abs(x.getMinY()))+2*(h>0?h:0),U=y-Math.trunc(Math.log(D)/Math.log(10)+1);return Math.pow(10,U)},Uh.CAP_ROUND.get=function(){return Si.CAP_ROUND},Uh.CAP_BUTT.get=function(){return Si.CAP_FLAT},Uh.CAP_FLAT.get=function(){return Si.CAP_FLAT},Uh.CAP_SQUARE.get=function(){return Si.CAP_SQUARE},Uh.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(ta,Uh);var Ma=function(){this._pt=[new re,new re],this._distance=ee.NaN,this._isNull=!0};Ma.prototype.getCoordinates=function(){return this._pt},Ma.prototype.getCoordinate=function(a){return this._pt[a]},Ma.prototype.setMinimum=function(){if(1===arguments.length){var a=arguments[0];this.setMinimum(a._pt[0],a._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var x=h.distance(y);x<this._distance&&this.initialize(h,y,x)}},Ma.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var a=arguments[0],h=arguments[1];this._pt[0].setCoordinate(a),this._pt[1].setCoordinate(h),this._distance=a.distance(h),this._isNull=!1}else if(3===arguments.length){var x=arguments[1],D=arguments[2];this._pt[0].setCoordinate(arguments[0]),this._pt[1].setCoordinate(x),this._distance=D,this._isNull=!1}},Ma.prototype.getDistance=function(){return this._distance},Ma.prototype.setMaximum=function(){if(1===arguments.length){var a=arguments[0];this.setMaximum(a._pt[0],a._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var x=h.distance(y);x>this._distance&&this.initialize(h,y,x)}},Ma.prototype.interfaces_=function(){return[]},Ma.prototype.getClass=function(){return Ma};var Ml=function(){};Ml.prototype.interfaces_=function(){return[]},Ml.prototype.getClass=function(){return Ml},Ml.computeDistance=function(){if(arguments[2]instanceof Ma&&arguments[0]instanceof ps&&arguments[1]instanceof re)for(var h=arguments[1],y=arguments[2],x=arguments[0].getCoordinates(),D=new hr,U=0;U<x.length-1;U++){D.setCoordinates(x[U],x[U+1]);var H=D.closestPoint(h);y.setMinimum(H,h)}else if(arguments[2]instanceof Ma&&arguments[0]instanceof ms&&arguments[1]instanceof re){var pe=arguments[0],Ge=arguments[1],wt=arguments[2];Ml.computeDistance(pe.getExteriorRing(),Ge,wt);for(var qt=0;qt<pe.getNumInteriorRing();qt++)Ml.computeDistance(pe.getInteriorRingN(qt),Ge,wt)}else if(arguments[2]instanceof Ma&&arguments[0]instanceof zn&&arguments[1]instanceof re){var nn=arguments[0],Wn=arguments[1],kn=arguments[2];if(nn instanceof ps)Ml.computeDistance(nn,Wn,kn);else if(nn instanceof ms)Ml.computeDistance(nn,Wn,kn);else if(nn instanceof zi)for(var tr=nn,lr=0;lr<tr.getNumGeometries();lr++){var ji=tr.getGeometryN(lr);Ml.computeDistance(ji,Wn,kn)}else kn.setMinimum(nn.getCoordinate(),Wn)}else if(arguments[2]instanceof Ma&&arguments[0]instanceof hr&&arguments[1]instanceof re){var ga=arguments[1],ma=arguments[2],il=arguments[0].closestPoint(ga);ma.setMinimum(il,ga)}};var yl=function(a){this._maxPtDist=new Ma,this._inputGeom=a||null},Nf={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};yl.prototype.computeMaxMidpointDistance=function(a){var h=new Lt(this._inputGeom);a.apply(h),this._maxPtDist.setMaximum(h.getMaxPointDistance())},yl.prototype.computeMaxVertexDistance=function(a){var h=new _l(this._inputGeom);a.apply(h),this._maxPtDist.setMaximum(h.getMaxPointDistance())},yl.prototype.findDistance=function(a){return this.computeMaxVertexDistance(a),this.computeMaxMidpointDistance(a),this._maxPtDist.getDistance()},yl.prototype.getDistancePoints=function(){return this._maxPtDist},yl.prototype.interfaces_=function(){return[]},yl.prototype.getClass=function(){return yl},Nf.MaxPointDistanceFilter.get=function(){return _l},Nf.MaxMidpointDistanceFilter.get=function(){return Lt},Object.defineProperties(yl,Nf);var _l=function(a){this._maxPtDist=new Ma,this._minPtDist=new Ma,this._geom=a||null};_l.prototype.filter=function(a){this._minPtDist.initialize(),Ml.computeDistance(this._geom,a,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},_l.prototype.getMaxPointDistance=function(){return this._maxPtDist},_l.prototype.interfaces_=function(){return[ni]},_l.prototype.getClass=function(){return _l};var Lt=function(a){this._maxPtDist=new Ma,this._minPtDist=new Ma,this._geom=a||null};Lt.prototype.filter=function(a,h){if(0===h)return null;var y=a.getCoordinate(h-1),x=a.getCoordinate(h),D=new re((y.x+x.x)/2,(y.y+x.y)/2);this._minPtDist.initialize(),Ml.computeDistance(this._geom,D,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Lt.prototype.isDone=function(){return!1},Lt.prototype.isGeometryChanged=function(){return!1},Lt.prototype.getMaxPointDistance=function(){return this._maxPtDist},Lt.prototype.interfaces_=function(){return[Xo]},Lt.prototype.getClass=function(){return Lt};var un=function(a){this._comps=a||null};un.prototype.filter=function(a){a instanceof ms&&this._comps.add(a)},un.prototype.interfaces_=function(){return[ya]},un.prototype.getClass=function(){return un},un.getPolygons=function(){if(1===arguments.length)return un.getPolygons(arguments[0],new Ze);if(2===arguments.length){var h=arguments[0],y=arguments[1];return h instanceof ms?y.add(h):h instanceof zi&&h.apply(new un(y)),y}};var Qt=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length)this._lines=arguments[0];else if(2===arguments.length){var y=arguments[1];this._lines=arguments[0],this._isForcedToLineString=y}};Qt.prototype.filter=function(a){if(this._isForcedToLineString&&a instanceof Za){var h=a.getFactory().createLineString(a.getCoordinateSequence());return this._lines.add(h),null}a instanceof ps&&this._lines.add(a)},Qt.prototype.setForceToLineString=function(a){this._isForcedToLineString=a},Qt.prototype.interfaces_=function(){return[Pr]},Qt.prototype.getClass=function(){return Qt},Qt.getGeometry=function(){if(1===arguments.length){var a=arguments[0];return a.getFactory().buildGeometry(Qt.getLines(a))}if(2===arguments.length){var h=arguments[0],y=arguments[1];return h.getFactory().buildGeometry(Qt.getLines(h,y))}},Qt.getLines=function(){if(1===arguments.length)return Qt.getLines(arguments[0],!1);if(2===arguments.length){if(Bt(arguments[0],be)&&Bt(arguments[1],be)){for(var y=arguments[1],x=arguments[0].iterator();x.hasNext();){var D=x.next();Qt.getLines(D,y)}return y}if(arguments[0]instanceof zn&&"boolean"==typeof arguments[1]){var U=arguments[0],H=arguments[1],pe=new Ze;return U.apply(new Qt(pe,H)),pe}if(arguments[0]instanceof zn&&Bt(arguments[1],be)){var Ge=arguments[0],wt=arguments[1];return Ge instanceof ps?wt.add(Ge):Ge.apply(new Qt(wt)),wt}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&Bt(arguments[0],be)&&Bt(arguments[1],be)){for(var nn=arguments[1],Wn=arguments[2],kn=arguments[0].iterator();kn.hasNext();){var tr=kn.next();Qt.getLines(tr,nn,Wn)}return nn}if("boolean"==typeof arguments[2]&&arguments[0]instanceof zn&&Bt(arguments[1],be)){var ji=arguments[1];return arguments[0].apply(new Qt(ji,arguments[2])),ji}}};var ir=function(){if(this._boundaryRule=Ci.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0!==arguments.length&&1===arguments.length){var a=arguments[0];if(null===a)throw new ce("Rule must be non-null");this._boundaryRule=a}};ir.prototype.locateInternal=function(){if(arguments[0]instanceof re&&arguments[1]instanceof ms){var a=arguments[0],h=arguments[1];if(h.isEmpty())return Ne.EXTERIOR;var y=h.getExteriorRing(),x=this.locateInPolygonRing(a,y);if(x===Ne.EXTERIOR)return Ne.EXTERIOR;if(x===Ne.BOUNDARY)return Ne.BOUNDARY;for(var D=0;D<h.getNumInteriorRing();D++){var U=h.getInteriorRingN(D),H=this.locateInPolygonRing(a,U);if(H===Ne.INTERIOR)return Ne.EXTERIOR;if(H===Ne.BOUNDARY)return Ne.BOUNDARY}return Ne.INTERIOR}if(arguments[0]instanceof re&&arguments[1]instanceof ps){var pe=arguments[0],Ge=arguments[1];if(!Ge.getEnvelopeInternal().intersects(pe))return Ne.EXTERIOR;var wt=Ge.getCoordinates();return Ge.isClosed()||!pe.equals(wt[0])&&!pe.equals(wt[wt.length-1])?en.isOnLine(pe,wt)?Ne.INTERIOR:Ne.EXTERIOR:Ne.BOUNDARY}if(arguments[0]instanceof re&&arguments[1]instanceof gs){var qt=arguments[0];return arguments[1].getCoordinate().equals2D(qt)?Ne.INTERIOR:Ne.EXTERIOR}},ir.prototype.locateInPolygonRing=function(a,h){return h.getEnvelopeInternal().intersects(a)?en.locatePointInRing(a,h.getCoordinates()):Ne.EXTERIOR},ir.prototype.intersects=function(a,h){return this.locate(a,h)!==Ne.EXTERIOR},ir.prototype.updateLocationInfo=function(a){a===Ne.INTERIOR&&(this._isIn=!0),a===Ne.BOUNDARY&&this._numBoundaries++},ir.prototype.computeLocation=function(a,h){if(h instanceof gs&&this.updateLocationInfo(this.locateInternal(a,h)),h instanceof ps)this.updateLocationInfo(this.locateInternal(a,h));else if(h instanceof ms)this.updateLocationInfo(this.locateInternal(a,h));else if(h instanceof pl)for(var y=h,x=0;x<y.getNumGeometries();x++){var D=y.getGeometryN(x);this.updateLocationInfo(this.locateInternal(a,D))}else if(h instanceof Oa)for(var U=h,H=0;H<U.getNumGeometries();H++){var pe=U.getGeometryN(H);this.updateLocationInfo(this.locateInternal(a,pe))}else if(h instanceof zi)for(var Ge=new eu(h);Ge.hasNext();){var wt=Ge.next();wt!==h&&this.computeLocation(a,wt)}},ir.prototype.locate=function(a,h){return h.isEmpty()?Ne.EXTERIOR:h instanceof ps||h instanceof ms?this.locateInternal(a,h):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(a,h),this._boundaryRule.isInBoundary(this._numBoundaries)?Ne.BOUNDARY:this._numBoundaries>0||this._isIn?Ne.INTERIOR:Ne.EXTERIOR)},ir.prototype.interfaces_=function(){return[]},ir.prototype.getClass=function(){return ir};var Tr=function a(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length)a.call(this,arguments[0],a.INSIDE_AREA,arguments[1]);else if(3===arguments.length){var D=arguments[1],U=arguments[2];this._component=arguments[0],this._segIndex=D,this._pt=U}},qi={INSIDE_AREA:{configurable:!0}};Tr.prototype.isInsideArea=function(){return this._segIndex===Tr.INSIDE_AREA},Tr.prototype.getCoordinate=function(){return this._pt},Tr.prototype.getGeometryComponent=function(){return this._component},Tr.prototype.getSegmentIndex=function(){return this._segIndex},Tr.prototype.interfaces_=function(){return[]},Tr.prototype.getClass=function(){return Tr},qi.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Tr,qi);var Es=function(a){this._pts=a||null};Es.prototype.filter=function(a){a instanceof gs&&this._pts.add(a)},Es.prototype.interfaces_=function(){return[ya]},Es.prototype.getClass=function(){return Es},Es.getPoints=function(){if(1===arguments.length){var a=arguments[0];return a instanceof gs?Yu.singletonList(a):Es.getPoints(a,new Ze)}if(2===arguments.length){var h=arguments[0],y=arguments[1];return h instanceof gs?y.add(h):h instanceof zi&&h.apply(new Es(y)),y}};var eo=function(){this._locations=null,this._locations=arguments[0]};eo.prototype.filter=function(a){(a instanceof gs||a instanceof ps||a instanceof ms)&&this._locations.add(new Tr(a,0,a.getCoordinate()))},eo.prototype.interfaces_=function(){return[ya]},eo.prototype.getClass=function(){return eo},eo.getLocations=function(a){var h=new Ze;return a.apply(new eo(h)),h};var Vi=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new ir,this._minDistanceLocation=null,this._minDistance=ee.MAX_VALUE,2===arguments.length)this._geom=[arguments[0],arguments[1]],this._terminateDistance=0;else if(3===arguments.length){var y=arguments[0],x=arguments[1],D=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=y,this._geom[1]=x,this._terminateDistance=D}};Vi.prototype.computeContainmentDistance=function(){if(0===arguments.length){var a=new Array(2).fill(null);if(this.computeContainmentDistance(0,a),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,a)}else if(2===arguments.length){var h=arguments[0],y=arguments[1],x=1-h,D=un.getPolygons(this._geom[h]);if(D.size()>0){var U=eo.getLocations(this._geom[x]);if(this.computeContainmentDistance(U,D,y),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[x]=y[0],this._minDistanceLocation[h]=y[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&Bt(arguments[0],ct)&&Bt(arguments[1],ct)){for(var H=arguments[0],pe=arguments[1],Ge=arguments[2],wt=0;wt<H.size();wt++)for(var qt=H.get(wt),nn=0;nn<pe.size();nn++)if(this.computeContainmentDistance(qt,pe.get(nn),Ge),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Tr&&arguments[1]instanceof ms){var Wn=arguments[0],kn=arguments[1],tr=arguments[2],lr=Wn.getCoordinate();if(Ne.EXTERIOR!==this._ptLocator.locate(lr,kn))return this._minDistance=0,tr[0]=Wn,tr[1]=new Tr(kn,lr),null}},Vi.prototype.computeMinDistanceLinesPoints=function(a,h,y){for(var x=0;x<a.size();x++)for(var D=a.get(x),U=0;U<h.size();U++){var H=h.get(U);if(this.computeMinDistance(D,H,y),this._minDistance<=this._terminateDistance)return null}},Vi.prototype.computeFacetDistance=function(){var a=new Array(2).fill(null),h=Qt.getLines(this._geom[0]),y=Qt.getLines(this._geom[1]),x=Es.getPoints(this._geom[0]),D=Es.getPoints(this._geom[1]);return this.computeMinDistanceLines(h,y,a),this.updateMinDistance(a,!1),this._minDistance<=this._terminateDistance?null:(a[0]=null,a[1]=null,this.computeMinDistanceLinesPoints(h,D,a),this.updateMinDistance(a,!1),this._minDistance<=this._terminateDistance?null:(a[0]=null,a[1]=null,this.computeMinDistanceLinesPoints(y,x,a),this.updateMinDistance(a,!0),this._minDistance<=this._terminateDistance?null:(a[0]=null,a[1]=null,this.computeMinDistancePoints(x,D,a),void this.updateMinDistance(a,!1))))},Vi.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},Vi.prototype.updateMinDistance=function(a,h){if(null===a[0])return null;h?(this._minDistanceLocation[0]=a[1],this._minDistanceLocation[1]=a[0]):(this._minDistanceLocation[0]=a[0],this._minDistanceLocation[1]=a[1])},Vi.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},Vi.prototype.computeMinDistance=function(){if(0===arguments.length){if(null!==this._minDistanceLocation||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof ps&&arguments[1]instanceof gs){var a=arguments[0],h=arguments[1],y=arguments[2];if(a.getEnvelopeInternal().distance(h.getEnvelopeInternal())>this._minDistance)return null;for(var x=a.getCoordinates(),D=h.getCoordinate(),U=0;U<x.length-1;U++){var H=en.distancePointLine(D,x[U],x[U+1]);if(H<this._minDistance){this._minDistance=H;var pe=new hr(x[U],x[U+1]).closestPoint(D);y[0]=new Tr(a,U,pe),y[1]=new Tr(h,0,D)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof ps&&arguments[1]instanceof ps){var Ge=arguments[0],wt=arguments[1],qt=arguments[2];if(Ge.getEnvelopeInternal().distance(wt.getEnvelopeInternal())>this._minDistance)return null;for(var nn=Ge.getCoordinates(),Wn=wt.getCoordinates(),kn=0;kn<nn.length-1;kn++)for(var tr=0;tr<Wn.length-1;tr++){var lr=en.distanceLineLine(nn[kn],nn[kn+1],Wn[tr],Wn[tr+1]);if(lr<this._minDistance){this._minDistance=lr;var ji=new hr(nn[kn],nn[kn+1]),Gn=new hr(Wn[tr],Wn[tr+1]),ga=ji.closestPoints(Gn);qt[0]=new Tr(Ge,kn,ga[0]),qt[1]=new Tr(wt,tr,ga[1])}if(this._minDistance<=this._terminateDistance)return null}}},Vi.prototype.computeMinDistancePoints=function(a,h,y){for(var x=0;x<a.size();x++)for(var D=a.get(x),U=0;U<h.size();U++){var H=h.get(U),pe=D.getCoordinate().distance(H.getCoordinate());if(pe<this._minDistance&&(this._minDistance=pe,y[0]=new Tr(D,0,D.getCoordinate()),y[1]=new Tr(H,0,H.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},Vi.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new ce("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},Vi.prototype.computeMinDistanceLines=function(a,h,y){for(var x=0;x<a.size();x++)for(var D=a.get(x),U=0;U<h.size();U++){var H=h.get(U);if(this.computeMinDistance(D,H,y),this._minDistance<=this._terminateDistance)return null}},Vi.prototype.interfaces_=function(){return[]},Vi.prototype.getClass=function(){return Vi},Vi.distance=function(a,h){return new Vi(a,h).distance()},Vi.isWithinDistance=function(a,h,y){return new Vi(a,h,y).distance()<=y},Vi.nearestPoints=function(a,h){return new Vi(a,h).nearestPoints()};var Xi=function(){this._pt=[new re,new re],this._distance=ee.NaN,this._isNull=!0};Xi.prototype.getCoordinates=function(){return this._pt},Xi.prototype.getCoordinate=function(a){return this._pt[a]},Xi.prototype.setMinimum=function(){if(1===arguments.length){var a=arguments[0];this.setMinimum(a._pt[0],a._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var x=h.distance(y);x<this._distance&&this.initialize(h,y,x)}},Xi.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var a=arguments[0],h=arguments[1];this._pt[0].setCoordinate(a),this._pt[1].setCoordinate(h),this._distance=a.distance(h),this._isNull=!1}else if(3===arguments.length){var x=arguments[1],D=arguments[2];this._pt[0].setCoordinate(arguments[0]),this._pt[1].setCoordinate(x),this._distance=D,this._isNull=!1}},Xi.prototype.toString=function(){return Pt.toLineString(this._pt[0],this._pt[1])},Xi.prototype.getDistance=function(){return this._distance},Xi.prototype.setMaximum=function(){if(1===arguments.length){var a=arguments[0];this.setMaximum(a._pt[0],a._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var x=h.distance(y);x>this._distance&&this.initialize(h,y,x)}},Xi.prototype.interfaces_=function(){return[]},Xi.prototype.getClass=function(){return Xi};var $r=function(){};$r.prototype.interfaces_=function(){return[]},$r.prototype.getClass=function(){return $r},$r.computeDistance=function(){if(arguments[2]instanceof Xi&&arguments[0]instanceof ps&&arguments[1]instanceof re)for(var a=arguments[0],h=arguments[1],y=arguments[2],x=new hr,D=a.getCoordinates(),U=0;U<D.length-1;U++){x.setCoordinates(D[U],D[U+1]);var H=x.closestPoint(h);y.setMinimum(H,h)}else if(arguments[2]instanceof Xi&&arguments[0]instanceof ms&&arguments[1]instanceof re){var pe=arguments[0],Ge=arguments[1],wt=arguments[2];$r.computeDistance(pe.getExteriorRing(),Ge,wt);for(var qt=0;qt<pe.getNumInteriorRing();qt++)$r.computeDistance(pe.getInteriorRingN(qt),Ge,wt)}else if(arguments[2]instanceof Xi&&arguments[0]instanceof zn&&arguments[1]instanceof re){var nn=arguments[0],Wn=arguments[1],kn=arguments[2];if(nn instanceof ps)$r.computeDistance(nn,Wn,kn);else if(nn instanceof ms)$r.computeDistance(nn,Wn,kn);else if(nn instanceof zi)for(var tr=nn,lr=0;lr<tr.getNumGeometries();lr++){var ji=tr.getGeometryN(lr);$r.computeDistance(ji,Wn,kn)}else kn.setMinimum(nn.getCoordinate(),Wn)}else if(arguments[2]instanceof Xi&&arguments[0]instanceof hr&&arguments[1]instanceof re){var ga=arguments[1],ma=arguments[2],il=arguments[0].closestPoint(ga);ma.setMinimum(il,ga)}};var uo=function(){this._g0=null,this._g1=null,this._ptDist=new Xi,this._densifyFrac=0;var h=arguments[1];this._g0=arguments[0],this._g1=h},Xs={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};uo.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},uo.prototype.setDensifyFraction=function(a){if(a>1||a<=0)throw new ce("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=a},uo.prototype.compute=function(a,h){this.computeOrientedDistance(a,h,this._ptDist),this.computeOrientedDistance(h,a,this._ptDist)},uo.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},uo.prototype.computeOrientedDistance=function(a,h,y){var x=new Da(h);if(a.apply(x),y.setMaximum(x.getMaxPointDistance()),this._densifyFrac>0){var D=new to(h,this._densifyFrac);a.apply(D),y.setMaximum(D.getMaxPointDistance())}},uo.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},uo.prototype.interfaces_=function(){return[]},uo.prototype.getClass=function(){return uo},uo.distance=function(){if(2===arguments.length)return new uo(arguments[0],arguments[1]).distance();if(3===arguments.length){var D=arguments[2],U=new uo(arguments[0],arguments[1]);return U.setDensifyFraction(D),U.distance()}},Xs.MaxPointDistanceFilter.get=function(){return Da},Xs.MaxDensifiedByFractionDistanceFilter.get=function(){return to},Object.defineProperties(uo,Xs);var Da=function(){this._maxPtDist=new Xi,this._minPtDist=new Xi,this._euclideanDist=new $r,this._geom=null,this._geom=arguments[0]};Da.prototype.filter=function(a){this._minPtDist.initialize(),$r.computeDistance(this._geom,a,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Da.prototype.getMaxPointDistance=function(){return this._maxPtDist},Da.prototype.interfaces_=function(){return[ni]},Da.prototype.getClass=function(){return Da};var to=function(){this._maxPtDist=new Xi,this._minPtDist=new Xi,this._geom=null,this._numSubSegs=0;var h=arguments[1];this._geom=arguments[0],this._numSubSegs=Math.trunc(Math.round(1/h))};to.prototype.filter=function(a,h){if(0===h)return null;for(var y=a.getCoordinate(h-1),x=a.getCoordinate(h),D=(x.x-y.x)/this._numSubSegs,U=(x.y-y.y)/this._numSubSegs,H=0;H<this._numSubSegs;H++){var wt=new re(y.x+H*D,y.y+H*U);this._minPtDist.initialize(),$r.computeDistance(this._geom,wt,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},to.prototype.isDone=function(){return!1},to.prototype.isGeometryChanged=function(){return!1},to.prototype.getMaxPointDistance=function(){return this._maxPtDist},to.prototype.interfaces_=function(){return[Xo]},to.prototype.getClass=function(){return to};var Zs=function(a,h,y){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=a||null,this._bufDistance=h||null,this._result=y||null},lo={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Zs.prototype.checkMaximumDistance=function(a,h,y){var x=new uo(h,a);if(x.setDensifyFraction(.25),this._maxDistanceFound=x.orientedDistance(),this._maxDistanceFound>y){this._isValid=!1;var D=x.getCoordinates();this._errorLocation=D[1],this._errorIndicator=a.getFactory().createLineString(D),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+Pt.toLineString(D[0],D[1])+")"}},Zs.prototype.isValid=function(){var a=Math.abs(this._bufDistance),h=Zs.MAX_DISTANCE_DIFF_FRAC*a;return this._minValidDistance=a-h,this._maxValidDistance=a+h,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Zs.VERBOSE&&xn.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},Zs.prototype.checkNegativeValid=function(){if(!(this._input instanceof ms||this._input instanceof Oa||this._input instanceof zi))return null;var a=this.getPolygonLines(this._input);if(this.checkMinimumDistance(a,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(a,this._result,this._maxValidDistance)},Zs.prototype.getErrorIndicator=function(){return this._errorIndicator},Zs.prototype.checkMinimumDistance=function(a,h,y){var x=new Vi(a,h,y);if(this._minDistanceFound=x.distance(),this._minDistanceFound<y){this._isValid=!1;var D=x.nearestPoints();this._errorLocation=x.nearestPoints()[1],this._errorIndicator=a.getFactory().createLineString(D),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+Pt.toLineString(D[0],D[1])+" )"}},Zs.prototype.checkPositiveValid=function(){var a=this._result.getBoundary();if(this.checkMinimumDistance(this._input,a,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,a,this._maxValidDistance)},Zs.prototype.getErrorLocation=function(){return this._errorLocation},Zs.prototype.getPolygonLines=function(a){for(var h=new Ze,y=new Qt(h),x=un.getPolygons(a).iterator();x.hasNext();)x.next().apply(y);return a.getFactory().buildGeometry(h)},Zs.prototype.getErrorMessage=function(){return this._errMsg},Zs.prototype.interfaces_=function(){return[]},Zs.prototype.getClass=function(){return Zs},lo.VERBOSE.get=function(){return!1},lo.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Zs,lo);var as=function(a,h,y){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=a||null,this._distance=h||null,this._result=y||null},Fc={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};as.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},as.prototype.checkEnvelope=function(){if(this._distance<0)return null;var a=this._distance*as.MAX_ENV_DIFF_FRAC;0===a&&(a=.001);var h=new wn(this._input.getEnvelopeInternal());h.expandBy(this._distance);var y=new wn(this._result.getEnvelopeInternal());y.expandBy(a),y.contains(h)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(y)),this.report("Envelope")},as.prototype.checkDistance=function(){var a=new Zs(this._input,this._distance,this._result);a.isValid()||(this._isValid=!1,this._errorMsg=a.getErrorMessage(),this._errorLocation=a.getErrorLocation(),this._errorIndicator=a.getErrorIndicator()),this.report("Distance")},as.prototype.checkArea=function(){var a=this._input.getArea(),h=this._result.getArea();this._distance>0&&a>h&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&a<h&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},as.prototype.checkPolygonal=function(){this._result instanceof ms||this._result instanceof Oa||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},as.prototype.getErrorIndicator=function(){return this._errorIndicator},as.prototype.getErrorLocation=function(){return this._errorLocation},as.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},as.prototype.report=function(a){if(!as.VERBOSE)return null;xn.out.println("Check "+a+": "+(this._isValid?"passed":"FAILED"))},as.prototype.getErrorMessage=function(){return this._errorMsg},as.prototype.interfaces_=function(){return[]},as.prototype.getClass=function(){return as},as.isValidMsg=function(a,h,y){var x=new as(a,h,y);return x.isValid()?null:x.getErrorMessage()},as.isValid=function(a,h,y){return!!new as(a,h,y).isValid()},Fc.VERBOSE.get=function(){return!1},Fc.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(as,Fc);var nu=function(){this._pts=null,this._data=null;var h=arguments[1];this._pts=arguments[0],this._data=h};nu.prototype.getCoordinates=function(){return this._pts},nu.prototype.size=function(){return this._pts.length},nu.prototype.getCoordinate=function(a){return this._pts[a]},nu.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},nu.prototype.getSegmentOctant=function(a){return a===this._pts.length-1?-1:hc.octant(this.getCoordinate(a),this.getCoordinate(a+1))},nu.prototype.setData=function(a){this._data=a},nu.prototype.getData=function(){return this._data},nu.prototype.toString=function(){return Pt.toLineString(new Ds(this._pts))},nu.prototype.interfaces_=function(){return[Ru]},nu.prototype.getClass=function(){return nu};var Ri=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new Ze,this._intersectionCount=0,this._keepIntersections=!0,this._li=arguments[0],this._interiorIntersection=null};Ri.prototype.getInteriorIntersection=function(){return this._interiorIntersection},Ri.prototype.setCheckEndSegmentsOnly=function(a){this._isCheckEndSegmentsOnly=a},Ri.prototype.getIntersectionSegments=function(){return this._intSegments},Ri.prototype.count=function(){return this._intersectionCount},Ri.prototype.getIntersections=function(){return this._intersections},Ri.prototype.setFindAllIntersections=function(a){this._findAllIntersections=a},Ri.prototype.setKeepIntersections=function(a){this._keepIntersections=a},Ri.prototype.processIntersections=function(a,h,y,x){if(!this._findAllIntersections&&this.hasIntersection()||a===y&&h===x||this._isCheckEndSegmentsOnly&&!this.isEndSegment(a,h)&&!this.isEndSegment(y,x))return null;var D=a.getCoordinates()[h],U=a.getCoordinates()[h+1],H=y.getCoordinates()[x],pe=y.getCoordinates()[x+1];this._li.computeIntersection(D,U,H,pe),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=D,this._intSegments[1]=U,this._intSegments[2]=H,this._intSegments[3]=pe,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},Ri.prototype.isEndSegment=function(a,h){return 0===h||h>=a.size()-2},Ri.prototype.hasIntersection=function(){return null!==this._interiorIntersection},Ri.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},Ri.prototype.interfaces_=function(){return[Ou]},Ri.prototype.getClass=function(){return Ri},Ri.createAllIntersectionsFinder=function(a){var h=new Ri(a);return h.setFindAllIntersections(!0),h},Ri.createAnyIntersectionFinder=function(a){return new Ri(a)},Ri.createIntersectionCounter=function(a){var h=new Ri(a);return h.setFindAllIntersections(!0),h.setKeepIntersections(!1),h};var bn=function(){this._li=new Yt,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0,this._segStrings=arguments[0]};bn.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},bn.prototype.getIntersections=function(){return this._segInt.getIntersections()},bn.prototype.isValid=function(){return this.execute(),this._isValid},bn.prototype.setFindAllIntersections=function(a){this._findAllIntersections=a},bn.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Ri(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var a=new $l;if(a.setSegmentIntersector(this._segInt),a.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},bn.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Hn(this.getErrorMessage(),this._segInt.getInteriorIntersection())},bn.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var a=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+Pt.toLineString(a[0],a[1])+" and "+Pt.toLineString(a[2],a[3])},bn.prototype.interfaces_=function(){return[]},bn.prototype.getClass=function(){return bn},bn.computeIntersections=function(a){var h=new bn(a);return h.setFindAllIntersections(!0),h.isValid(),h.getIntersections()};var qr=function a(){this._nv=null,this._nv=new bn(a.toSegmentStrings(arguments[0]))};qr.prototype.checkValid=function(){this._nv.checkValid()},qr.prototype.interfaces_=function(){return[]},qr.prototype.getClass=function(){return qr},qr.toSegmentStrings=function(a){for(var h=new Ze,y=a.iterator();y.hasNext();){var x=y.next();h.add(new nu(x.getCoordinates(),x))}return h},qr.checkValid=function(a){new qr(a).checkValid()};var co=function(a){this._mapOp=a};co.prototype.map=function(a){for(var h=new Ze,y=0;y<a.getNumGeometries();y++){var x=this._mapOp.map(a.getGeometryN(y));x.isEmpty()||h.add(x)}return a.getFactory().createGeometryCollection(er.toGeometryArray(h))},co.prototype.interfaces_=function(){return[]},co.prototype.getClass=function(){return co},co.map=function(a,h){return new co(h).map(a)};var _o=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new Ze,this._resultLineList=new Ze;var h=arguments[1],y=arguments[2];this._op=arguments[0],this._geometryFactory=h,this._ptLocator=y};_o.prototype.collectLines=function(a){for(var h=this._op.getGraph().getEdgeEnds().iterator();h.hasNext();){var y=h.next();this.collectLineEdge(y,a,this._lineEdgesList),this.collectBoundaryTouchEdge(y,a,this._lineEdgesList)}},_o.prototype.labelIsolatedLine=function(a,h){var y=this._ptLocator.locate(a.getCoordinate(),this._op.getArgGeometry(h));a.getLabel().setLocation(h,y)},_o.prototype.build=function(a){return this.findCoveredLineEdges(),this.collectLines(a),this.buildLines(a),this._resultLineList},_o.prototype.collectLineEdge=function(a,h,y){var x=a.getLabel(),D=a.getEdge();a.isLineEdge()&&(a.isVisited()||!xr.isResultOfOp(x,h)||D.isCovered()||(y.add(D),a.setVisitedEdge(!0)))},_o.prototype.findCoveredLineEdges=function(){for(var a=this._op.getGraph().getNodes().iterator();a.hasNext();)a.next().getEdges().findCoveredLineEdges();for(var h=this._op.getGraph().getEdgeEnds().iterator();h.hasNext();){var y=h.next(),x=y.getEdge();if(y.isLineEdge()&&!x.isCoveredSet()){var D=this._op.isCoveredByA(y.getCoordinate());x.setCovered(D)}}},_o.prototype.labelIsolatedLines=function(a){for(var h=a.iterator();h.hasNext();){var y=h.next(),x=y.getLabel();y.isIsolated()&&(x.isNull(0)?this.labelIsolatedLine(y,0):this.labelIsolatedLine(y,1))}},_o.prototype.buildLines=function(a){for(var h=this._lineEdgesList.iterator();h.hasNext();){var y=h.next(),x=this._geometryFactory.createLineString(y.getCoordinates());this._resultLineList.add(x),y.setInResult(!0)}},_o.prototype.collectBoundaryTouchEdge=function(a,h,y){var x=a.getLabel();return a.isLineEdge()||a.isVisited()||a.isInteriorAreaEdge()||a.getEdge().isInResult()?null:(Se.isTrue(!(a.isInResult()||a.getSym().isInResult())||!a.getEdge().isInResult()),void(xr.isResultOfOp(x,h)&&h===xr.INTERSECTION&&(y.add(a.getEdge()),a.setVisitedEdge(!0))))},_o.prototype.interfaces_=function(){return[]},_o.prototype.getClass=function(){return _o};var xa=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new Ze;var h=arguments[1];this._op=arguments[0],this._geometryFactory=h};xa.prototype.filterCoveredNodeToPoint=function(a){var h=a.getCoordinate();if(!this._op.isCoveredByLA(h)){var y=this._geometryFactory.createPoint(h);this._resultPointList.add(y)}},xa.prototype.extractNonCoveredResultNodes=function(a){for(var h=this._op.getGraph().getNodes().iterator();h.hasNext();){var y=h.next();if(!(y.isInResult()||y.isIncidentEdgeInResult()||0!==y.getEdges().getDegree()&&a!==xr.INTERSECTION)){var x=y.getLabel();xr.isResultOfOp(x,a)&&this.filterCoveredNodeToPoint(y)}}},xa.prototype.build=function(a){return this.extractNonCoveredResultNodes(a),this._resultPointList},xa.prototype.interfaces_=function(){return[]},xa.prototype.getClass=function(){return xa};var io=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};io.prototype.transformPoint=function(a,h){return this._factory.createPoint(this.transformCoordinates(a.getCoordinateSequence(),a))},io.prototype.transformPolygon=function(a,h){var y=!0,x=this.transformLinearRing(a.getExteriorRing(),a);null!==x&&x instanceof Za&&!x.isEmpty()||(y=!1);for(var D=new Ze,U=0;U<a.getNumInteriorRing();U++){var H=this.transformLinearRing(a.getInteriorRingN(U),a);null===H||H.isEmpty()||(H instanceof Za||(y=!1),D.add(H))}if(y)return this._factory.createPolygon(x,D.toArray([]));var pe=new Ze;return null!==x&&pe.add(x),pe.addAll(D),this._factory.buildGeometry(pe)},io.prototype.createCoordinateSequence=function(a){return this._factory.getCoordinateSequenceFactory().create(a)},io.prototype.getInputGeometry=function(){return this._inputGeom},io.prototype.transformMultiLineString=function(a,h){for(var y=new Ze,x=0;x<a.getNumGeometries();x++){var D=this.transformLineString(a.getGeometryN(x),a);null!==D&&(D.isEmpty()||y.add(D))}return this._factory.buildGeometry(y)},io.prototype.transformCoordinates=function(a,h){return this.copy(a)},io.prototype.transformLineString=function(a,h){return this._factory.createLineString(this.transformCoordinates(a.getCoordinateSequence(),a))},io.prototype.transformMultiPoint=function(a,h){for(var y=new Ze,x=0;x<a.getNumGeometries();x++){var D=this.transformPoint(a.getGeometryN(x),a);null!==D&&(D.isEmpty()||y.add(D))}return this._factory.buildGeometry(y)},io.prototype.transformMultiPolygon=function(a,h){for(var y=new Ze,x=0;x<a.getNumGeometries();x++){var D=this.transformPolygon(a.getGeometryN(x),a);null!==D&&(D.isEmpty()||y.add(D))}return this._factory.buildGeometry(y)},io.prototype.copy=function(a){return a.copy()},io.prototype.transformGeometryCollection=function(a,h){for(var y=new Ze,x=0;x<a.getNumGeometries();x++){var D=this.transform(a.getGeometryN(x));null!==D&&(this._pruneEmptyGeometry&&D.isEmpty()||y.add(D))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(er.toGeometryArray(y)):this._factory.buildGeometry(y)},io.prototype.transform=function(a){if(this._inputGeom=a,this._factory=a.getFactory(),a instanceof gs)return this.transformPoint(a,null);if(a instanceof Ac)return this.transformMultiPoint(a,null);if(a instanceof Za)return this.transformLinearRing(a,null);if(a instanceof ps)return this.transformLineString(a,null);if(a instanceof pl)return this.transformMultiLineString(a,null);if(a instanceof ms)return this.transformPolygon(a,null);if(a instanceof Oa)return this.transformMultiPolygon(a,null);if(a instanceof zi)return this.transformGeometryCollection(a,null);throw new ce("Unknown Geometry subtype: "+a.getClass().getName())},io.prototype.transformLinearRing=function(a,h){var y=this.transformCoordinates(a.getCoordinateSequence(),a);if(null===y)return this._factory.createLinearRing(null);var x=y.size();return x>0&&x<4&&!this._preserveType?this._factory.createLineString(y):this._factory.createLinearRing(y)},io.prototype.interfaces_=function(){return[]},io.prototype.getClass=function(){return io};var da=function a(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new hr,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof ps&&"number"==typeof arguments[1]){var y=arguments[1];a.call(this,arguments[0].getCoordinates(),y)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var x=arguments[0],D=arguments[1];this._srcPts=x,this._isClosed=a.isClosed(x),this._snapTolerance=D}};da.prototype.snapVertices=function(a,h){for(var y=this._isClosed?a.size()-1:a.size(),x=0;x<y;x++){var D=a.get(x),U=this.findSnapForVertex(D,h);null!==U&&(a.set(x,new re(U)),0===x&&this._isClosed&&a.set(a.size()-1,new re(U)))}},da.prototype.findSnapForVertex=function(a,h){for(var y=0;y<h.length;y++){if(a.equals2D(h[y]))return null;if(a.distance(h[y])<this._snapTolerance)return h[y]}return null},da.prototype.snapTo=function(a){var h=new Nt(this._srcPts);return this.snapVertices(h,a),this.snapSegments(h,a),h.toCoordinateArray()},da.prototype.snapSegments=function(a,h){if(0===h.length)return null;var y=h.length;h[0].equals2D(h[h.length-1])&&(y=h.length-1);for(var x=0;x<y;x++){var D=h[x],U=this.findSegmentIndexToSnap(D,a);U>=0&&a.add(U+1,new re(D),!1)}},da.prototype.findSegmentIndexToSnap=function(a,h){for(var y=ee.MAX_VALUE,x=-1,D=0;D<h.size()-1;D++){if(this._seg.p0=h.get(D),this._seg.p1=h.get(D+1),this._seg.p0.equals2D(a)||this._seg.p1.equals2D(a)){if(this._allowSnappingToSourceVertices)continue;return-1}var U=this._seg.distance(a);U<this._snapTolerance&&U<y&&(y=U,x=D)}return x},da.prototype.setAllowSnappingToSourceVertices=function(a){this._allowSnappingToSourceVertices=a},da.prototype.interfaces_=function(){return[]},da.prototype.getClass=function(){return da},da.isClosed=function(a){return!(a.length<=1)&&a[0].equals2D(a[a.length-1])};var Ur=function(a){this._srcGeom=a||null},Bc={SNAP_PRECISION_FACTOR:{configurable:!0}};Ur.prototype.snapTo=function(a,h){var y=this.extractTargetCoordinates(a);return new nl(h,y).transform(this._srcGeom)},Ur.prototype.snapToSelf=function(a,h){var y=this.extractTargetCoordinates(this._srcGeom),x=new nl(a,y,!0).transform(this._srcGeom),D=x;return h&&Bt(D,_a)&&(D=x.buffer(0)),D},Ur.prototype.computeSnapTolerance=function(a){return this.computeMinimumSegmentLength(a)/10},Ur.prototype.extractTargetCoordinates=function(a){for(var h=new mt,y=a.getCoordinates(),x=0;x<y.length;x++)h.add(y[x]);return h.toArray(new Array(0).fill(null))},Ur.prototype.computeMinimumSegmentLength=function(a){for(var h=ee.MAX_VALUE,y=0;y<a.length-1;y++){var x=a[y].distance(a[y+1]);x<h&&(h=x)}return h},Ur.prototype.interfaces_=function(){return[]},Ur.prototype.getClass=function(){return Ur},Ur.snap=function(a,h,y){var x=new Array(2).fill(null),D=new Ur(a);x[0]=D.snapTo(h,y);var U=new Ur(h);return x[1]=U.snapTo(x[0],y),x},Ur.computeOverlaySnapTolerance=function(){if(1===arguments.length){var a=arguments[0],h=Ur.computeSizeBasedSnapTolerance(a),y=a.getPrecisionModel();if(y.getType()===pn.FIXED){var x=1/y.getScale()*2/1.415;x>h&&(h=x)}return h}if(2===arguments.length){var U=arguments[1];return Math.min(Ur.computeOverlaySnapTolerance(arguments[0]),Ur.computeOverlaySnapTolerance(U))}},Ur.computeSizeBasedSnapTolerance=function(a){var h=a.getEnvelopeInternal();return Math.min(h.getHeight(),h.getWidth())*Ur.SNAP_PRECISION_FACTOR},Ur.snapToSelf=function(a,h,y){return new Ur(a).snapToSelf(h,y)},Bc.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(Ur,Bc);var nl=function(a){function h(y,x,D){a.call(this),this._snapTolerance=y||null,this._snapPts=x||null,this._isSelfSnap=void 0!==D&&D}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.snapLine=function(y,x){var D=new da(y,this._snapTolerance);return D.setAllowSnappingToSourceVertices(this._isSelfSnap),D.snapTo(x)},h.prototype.transformCoordinates=function(y,x){var D=y.toCoordinateArray(),U=this.snapLine(D,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(U)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(io),pr=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};pr.prototype.getCommon=function(){return ee.longBitsToDouble(this._commonBits)},pr.prototype.add=function(a){var h=ee.doubleToLongBits(a);return this._isFirst?(this._commonBits=h,this._commonSignExp=pr.signExpBits(this._commonBits),this._isFirst=!1,null):pr.signExpBits(h)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=pr.numCommonMostSigMantissaBits(this._commonBits,h),void(this._commonBits=pr.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},pr.prototype.toString=function(){if(1===arguments.length){var a=arguments[0],h=ee.longBitsToDouble(a),y="0000000000000000000000000000000000000000000000000000000000000000"+ee.toBinaryString(a),x=y.substring(y.length-64);return x.substring(0,1)+"  "+x.substring(1,12)+"(exp) "+x.substring(12)+" [ "+h+" ]"}},pr.prototype.interfaces_=function(){return[]},pr.prototype.getClass=function(){return pr},pr.getBit=function(a,h){return a&1<<h?1:0},pr.signExpBits=function(a){return a>>52},pr.zeroLowerBits=function(a,h){return a&~((1<<h)-1)},pr.numCommonMostSigMantissaBits=function(a,h){for(var y=0,x=52;x>=0;x--){if(pr.getBit(a,x)!==pr.getBit(h,x))return y;y++}return 52};var pa=function(){this._commonCoord=null,this._ccFilter=new za},Dl={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};pa.prototype.addCommonBits=function(a){var h=new vo(this._commonCoord);a.apply(h),a.geometryChanged()},pa.prototype.removeCommonBits=function(a){if(0===this._commonCoord.x&&0===this._commonCoord.y)return a;var h=new re(this._commonCoord);h.x=-h.x,h.y=-h.y;var y=new vo(h);return a.apply(y),a.geometryChanged(),a},pa.prototype.getCommonCoordinate=function(){return this._commonCoord},pa.prototype.add=function(a){a.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},pa.prototype.interfaces_=function(){return[]},pa.prototype.getClass=function(){return pa},Dl.CommonCoordinateFilter.get=function(){return za},Dl.Translater.get=function(){return vo},Object.defineProperties(pa,Dl);var za=function(){this._commonBitsX=new pr,this._commonBitsY=new pr};za.prototype.filter=function(a){this._commonBitsX.add(a.x),this._commonBitsY.add(a.y)},za.prototype.getCommonCoordinate=function(){return new re(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},za.prototype.interfaces_=function(){return[ni]},za.prototype.getClass=function(){return za};var vo=function(){this.trans=null,this.trans=arguments[0]};vo.prototype.filter=function(a,h){var y=a.getOrdinate(h,0)+this.trans.x,x=a.getOrdinate(h,1)+this.trans.y;a.setOrdinate(h,0,y),a.setOrdinate(h,1,x)},vo.prototype.isDone=function(){return!1},vo.prototype.isGeometryChanged=function(){return!0},vo.prototype.interfaces_=function(){return[Xo]},vo.prototype.getClass=function(){return vo};var _s=function(a,h){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=a,this._geom[1]=h,this.computeSnapTolerance()};_s.prototype.selfSnap=function(a){return new Ur(a).snapTo(a,this._snapTolerance)},_s.prototype.removeCommonBits=function(a){this._cbr=new pa,this._cbr.add(a[0]),this._cbr.add(a[1]);var h=new Array(2).fill(null);return h[0]=this._cbr.removeCommonBits(a[0].copy()),h[1]=this._cbr.removeCommonBits(a[1].copy()),h},_s.prototype.prepareResult=function(a){return this._cbr.addCommonBits(a),a},_s.prototype.getResultGeometry=function(a){var h=this.snap(this._geom),y=xr.overlayOp(h[0],h[1],a);return this.prepareResult(y)},_s.prototype.checkValid=function(a){a.isValid()||xn.out.println("Snapped geometry is invalid")},_s.prototype.computeSnapTolerance=function(){this._snapTolerance=Ur.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},_s.prototype.snap=function(a){var h=this.removeCommonBits(a);return Ur.snap(h[0],h[1],this._snapTolerance)},_s.prototype.interfaces_=function(){return[]},_s.prototype.getClass=function(){return _s},_s.overlayOp=function(a,h,y){return new _s(a,h).getResultGeometry(y)},_s.union=function(a,h){return _s.overlayOp(a,h,xr.UNION)},_s.intersection=function(a,h){return _s.overlayOp(a,h,xr.INTERSECTION)},_s.symDifference=function(a,h){return _s.overlayOp(a,h,xr.SYMDIFFERENCE)},_s.difference=function(a,h){return _s.overlayOp(a,h,xr.DIFFERENCE)};var Ls=function(a,h){this._geom=new Array(2).fill(null),this._geom[0]=a,this._geom[1]=h};Ls.prototype.getResultGeometry=function(a){var h=null,y=!1,x=null;try{h=xr.overlayOp(this._geom[0],this._geom[1],a),y=!0}catch(D){if(!(D instanceof Re))throw D;x=D}if(!y)try{h=_s.overlayOp(this._geom[0],this._geom[1],a)}catch(D){throw D instanceof Re?x:D}return h},Ls.prototype.interfaces_=function(){return[]},Ls.prototype.getClass=function(){return Ls},Ls.overlayOp=function(a,h,y){return new Ls(a,h).getResultGeometry(y)},Ls.union=function(a,h){return Ls.overlayOp(a,h,xr.UNION)},Ls.intersection=function(a,h){return Ls.overlayOp(a,h,xr.INTERSECTION)},Ls.symDifference=function(a,h){return Ls.overlayOp(a,h,xr.SYMDIFFERENCE)},Ls.difference=function(a,h){return Ls.overlayOp(a,h,xr.DIFFERENCE)};var $n=function(){this.mce=null,this.chainIndex=null;var h=arguments[1];this.mce=arguments[0],this.chainIndex=h};$n.prototype.computeIntersections=function(a,h){this.mce.computeIntersectsForChain(this.chainIndex,a.mce,a.chainIndex,h)},$n.prototype.interfaces_=function(){return[]},$n.prototype.getClass=function(){return $n};var ho=function a(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var h=arguments[0],y=arguments[1];this._eventType=a.DELETE,this._xValue=h,this._insertEvent=y}else if(3===arguments.length){var x=arguments[0],D=arguments[1],U=arguments[2];this._eventType=a.INSERT,this._label=x,this._xValue=D,this._obj=U}},dh={INSERT:{configurable:!0},DELETE:{configurable:!0}};ho.prototype.isDelete=function(){return this._eventType===ho.DELETE},ho.prototype.setDeleteEventIndex=function(a){this._deleteEventIndex=a},ho.prototype.getObject=function(){return this._obj},ho.prototype.compareTo=function(a){return this._xValue<a._xValue?-1:this._xValue>a._xValue?1:this._eventType<a._eventType?-1:this._eventType>a._eventType?1:0},ho.prototype.getInsertEvent=function(){return this._insertEvent},ho.prototype.isInsert=function(){return this._eventType===ho.INSERT},ho.prototype.isSameLabel=function(a){return null!==this._label&&this._label===a._label},ho.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},ho.prototype.interfaces_=function(){return[oe]},ho.prototype.getClass=function(){return ho},dh.INSERT.get=function(){return 1},dh.DELETE.get=function(){return 2},Object.defineProperties(ho,dh);var ku=function(){};ku.prototype.interfaces_=function(){return[]},ku.prototype.getClass=function(){return ku};var fo=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var h=arguments[1],y=arguments[2];this._li=arguments[0],this._includeProper=h,this._recordIsolated=y};fo.prototype.isTrivialIntersection=function(a,h,y,x){if(a===y&&1===this._li.getIntersectionNum()){if(fo.isAdjacentSegments(h,x))return!0;if(a.isClosed()){var D=a.getNumPoints()-1;if(0===h&&x===D||0===x&&h===D)return!0}}return!1},fo.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},fo.prototype.setIsDoneIfProperInt=function(a){this._isDoneWhenProperInt=a},fo.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},fo.prototype.isBoundaryPointInternal=function(a,h){for(var y=h.iterator();y.hasNext();){var x=y.next().getCoordinate();if(a.isIntersection(x))return!0}return!1},fo.prototype.hasProperIntersection=function(){return this._hasProper},fo.prototype.hasIntersection=function(){return this._hasIntersection},fo.prototype.isDone=function(){return this._isDone},fo.prototype.isBoundaryPoint=function(a,h){return!(null===h||!this.isBoundaryPointInternal(a,h[0])&&!this.isBoundaryPointInternal(a,h[1]))},fo.prototype.setBoundaryNodes=function(a,h){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=a,this._bdyNodes[1]=h},fo.prototype.addIntersections=function(a,h,y,x){if(a===y&&h===x)return null;this.numTests++;var D=a.getCoordinates()[h],U=a.getCoordinates()[h+1],H=y.getCoordinates()[x],pe=y.getCoordinates()[x+1];this._li.computeIntersection(D,U,H,pe),this._li.hasIntersection()&&(this._recordIsolated&&(a.setIsolated(!1),y.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(a,h,y,x)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(a.addIntersections(this._li,h,0),y.addIntersections(this._li,x,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},fo.prototype.interfaces_=function(){return[]},fo.prototype.getClass=function(){return fo},fo.isAdjacentSegments=function(a,h){return 1===Math.abs(a-h)};var wa=function(a){function h(){a.call(this),this.events=new Ze,this.nOverlaps=null}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.prepareEvents=function(){Yu.sort(this.events);for(var y=0;y<this.events.size();y++){var x=this.events.get(y);x.isDelete()&&x.getInsertEvent().setDeleteEventIndex(y)}},h.prototype.computeIntersections=function(){if(1===arguments.length){var y=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var x=0;x<this.events.size();x++){var D=this.events.get(x);if(D.isInsert()&&this.processOverlaps(x,D.getDeleteEventIndex(),D,y),y.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof fo&&Bt(arguments[0],ct)&&Bt(arguments[1],ct)){var U=arguments[0],H=arguments[1],pe=arguments[2];this.addEdges(U,U),this.addEdges(H,H),this.computeIntersections(pe)}else if("boolean"==typeof arguments[2]&&Bt(arguments[0],ct)&&arguments[1]instanceof fo){var Ge=arguments[0],wt=arguments[1];arguments[2]?this.addEdges(Ge,null):this.addEdges(Ge),this.computeIntersections(wt)}},h.prototype.addEdge=function(y,x){for(var D=y.getMonotoneChainEdge(),U=D.getStartIndexes(),H=0;H<U.length-1;H++){var pe=new $n(D,H),Ge=new ho(x,D.getMinX(H),pe);this.events.add(Ge),this.events.add(new ho(D.getMaxX(H),Ge))}},h.prototype.processOverlaps=function(y,x,D,U){for(var H=D.getObject(),pe=y;pe<x;pe++){var Ge=this.events.get(pe);if(Ge.isInsert()){var wt=Ge.getObject();D.isSameLabel(Ge)||(H.computeIntersections(wt,U),this.nOverlaps++)}}},h.prototype.addEdges=function(){if(1===arguments.length)for(var y=arguments[0].iterator();y.hasNext();){var x=y.next();this.addEdge(x,x)}else if(2===arguments.length)for(var U=arguments[1],H=arguments[0].iterator();H.hasNext();){var pe=H.next();this.addEdge(pe,U)}},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(ku),ru=function(){this._min=ee.POSITIVE_INFINITY,this._max=ee.NEGATIVE_INFINITY},Or={NodeComparator:{configurable:!0}};ru.prototype.getMin=function(){return this._min},ru.prototype.intersects=function(a,h){return!(this._min>h||this._max<a)},ru.prototype.getMax=function(){return this._max},ru.prototype.toString=function(){return Pt.toLineString(new re(this._min,0),new re(this._max,0))},ru.prototype.interfaces_=function(){return[]},ru.prototype.getClass=function(){return ru},Or.NodeComparator.get=function(){return ba},Object.defineProperties(ru,Or);var ba=function(){};ba.prototype.compare=function(a,h){var D=(a._min+a._max)/2,U=(h._min+h._max)/2;return D<U?-1:D>U?1:0},ba.prototype.interfaces_=function(){return[_e]},ba.prototype.getClass=function(){return ba};var Vh=function(a){function h(){a.call(this),this._item=null;var x=arguments[1],D=arguments[2];this._min=arguments[0],this._max=x,this._item=D}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.query=function(y,x,D){if(!this.intersects(y,x))return null;D.visitItem(this._item)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(ru),fd=function(a){function h(){a.call(this),this._node1=null,this._node2=null;var x=arguments[1];this._node1=arguments[0],this._node2=x,this.buildExtent(this._node1,this._node2)}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.buildExtent=function(y,x){this._min=Math.min(y._min,x._min),this._max=Math.max(y._max,x._max)},h.prototype.query=function(y,x,D){if(!this.intersects(y,x))return null;null!==this._node1&&this._node1.query(y,x,D),null!==this._node2&&this._node2.query(y,x,D)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(ru),Ys=function(){this._leaves=new Ze,this._root=null,this._level=0};Ys.prototype.buildTree=function(){Yu.sort(this._leaves,new ru.NodeComparator);for(var a=this._leaves,h=null,y=new Ze;;){if(this.buildLevel(a,y),1===y.size())return y.get(0);h=a,a=y,y=h}},Ys.prototype.insert=function(a,h,y){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new Vh(a,h,y))},Ys.prototype.query=function(a,h,y){this.init(),this._root.query(a,h,y)},Ys.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},Ys.prototype.printNode=function(a){xn.out.println(Pt.toLineString(new re(a._min,this._level),new re(a._max,this._level)))},Ys.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},Ys.prototype.buildLevel=function(a,h){this._level++,h.clear();for(var y=0;y<a.size();y+=2){var x=a.get(y);if(null===(y+1<a.size()?a.get(y):null))h.add(x);else{var D=new fd(a.get(y),a.get(y+1));h.add(D)}}},Ys.prototype.interfaces_=function(){return[]},Ys.prototype.getClass=function(){return Ys};var rl=function(){this._items=new Ze};rl.prototype.visitItem=function(a){this._items.add(a)},rl.prototype.getItems=function(){return this._items},rl.prototype.interfaces_=function(){return[Hr]},rl.prototype.getClass=function(){return rl};var Fu=function(){this._index=null;var a=arguments[0];if(!Bt(a,_a))throw new ce("Argument must be Polygonal");this._index=new cu(a)},Hl={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Fu.prototype.locate=function(a){var h=new _n(a),y=new js(h);return this._index.query(a.y,a.y,y),h.getLocation()},Fu.prototype.interfaces_=function(){return[kc]},Fu.prototype.getClass=function(){return Fu},Hl.SegmentVisitor.get=function(){return js},Hl.IntervalIndexedGeometry.get=function(){return cu},Object.defineProperties(Fu,Hl);var js=function(){this._counter=null,this._counter=arguments[0]};js.prototype.visitItem=function(a){var h=a;this._counter.countSegment(h.getCoordinate(0),h.getCoordinate(1))},js.prototype.interfaces_=function(){return[Hr]},js.prototype.getClass=function(){return js};var cu=function(){this._index=new Ys,this.init(arguments[0])};cu.prototype.init=function(a){for(var h=Qt.getLines(a).iterator();h.hasNext();){var y=h.next().getCoordinates();this.addLine(y)}},cu.prototype.addLine=function(a){for(var h=1;h<a.length;h++){var y=new hr(a[h-1],a[h]),x=Math.min(y.p0.y,y.p1.y),D=Math.max(y.p0.y,y.p1.y);this._index.insert(x,D,y)}},cu.prototype.query=function(){if(2===arguments.length){var a=arguments[0],h=arguments[1],y=new rl;return this._index.query(a,h,y),y.getItems()}3===arguments.length&&this._index.query(arguments[0],arguments[1],arguments[2])},cu.prototype.interfaces_=function(){return[]},cu.prototype.getClass=function(){return cu};var na=function(a){function h(){if(a.call(this),this._parentGeom=null,this._lineEdgeMap=new Pc,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new ir,2===arguments.length){var x=arguments[1],D=Ci.OGC_SFS_BOUNDARY_RULE;this._argIndex=arguments[0],this._parentGeom=x,this._boundaryNodeRule=D,null!==x&&this.add(x)}else if(3===arguments.length){var H=arguments[1],pe=arguments[2];this._argIndex=arguments[0],this._parentGeom=H,this._boundaryNodeRule=pe,null!==H&&this.add(H)}}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.insertBoundaryPoint=function(y,x){var D=this._nodes.addNode(x).getLabel(),U=1;D.getLocation(y,Tn.ON)===Ne.BOUNDARY&&U++;var H=h.determineBoundary(this._boundaryNodeRule,U);D.setLocation(y,H)},h.prototype.computeSelfNodes=function(){if(2===arguments.length)return this.computeSelfNodes(arguments[0],arguments[1],!1);if(3===arguments.length){var U=arguments[1],H=arguments[2],pe=new fo(arguments[0],!0,!1);return pe.setIsDoneIfProperInt(H),this.createEdgeSetIntersector().computeIntersections(this._edges,pe,U||!(this._parentGeom instanceof Za||this._parentGeom instanceof ms||this._parentGeom instanceof Oa)),this.addSelfIntersectionNodes(this._argIndex),pe}},h.prototype.computeSplitEdges=function(y){for(var x=this._edges.iterator();x.hasNext();)x.next().eiList.addSplitEdges(y)},h.prototype.computeEdgeIntersections=function(y,x,D){var U=new fo(x,D,!0);return U.setBoundaryNodes(this.getBoundaryNodes(),y.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,y._edges,U),U},h.prototype.getGeometry=function(){return this._parentGeom},h.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},h.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},h.prototype.addPoint=function(){if(arguments[0]instanceof gs){var y=arguments[0].getCoordinate();this.insertPoint(this._argIndex,y,Ne.INTERIOR)}else arguments[0]instanceof re&&this.insertPoint(this._argIndex,arguments[0],Ne.INTERIOR)},h.prototype.addPolygon=function(y){this.addPolygonRing(y.getExteriorRing(),Ne.EXTERIOR,Ne.INTERIOR);for(var x=0;x<y.getNumInteriorRing();x++){var D=y.getInteriorRingN(x);this.addPolygonRing(D,Ne.INTERIOR,Ne.EXTERIOR)}},h.prototype.addEdge=function(y){this.insertEdge(y);var x=y.getCoordinates();this.insertPoint(this._argIndex,x[0],Ne.BOUNDARY),this.insertPoint(this._argIndex,x[x.length-1],Ne.BOUNDARY)},h.prototype.addLineString=function(y){var x=lt.removeRepeatedPoints(y.getCoordinates());if(x.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=x[0],null;var D=new fc(x,new Ui(this._argIndex,Ne.INTERIOR));this._lineEdgeMap.put(y,D),this.insertEdge(D),Se.isTrue(x.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,x[0]),this.insertBoundaryPoint(this._argIndex,x[x.length-1])},h.prototype.getInvalidPoint=function(){return this._invalidPoint},h.prototype.getBoundaryPoints=function(){for(var y=this.getBoundaryNodes(),x=new Array(y.size()).fill(null),D=0,U=y.iterator();U.hasNext();){var H=U.next();x[D++]=H.getCoordinate().copy()}return x},h.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},h.prototype.addSelfIntersectionNode=function(y,x,D){if(this.isBoundaryNode(y,x))return null;D===Ne.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(y,x):this.insertPoint(y,x,D)},h.prototype.addPolygonRing=function(y,x,D){if(y.isEmpty())return null;var U=lt.removeRepeatedPoints(y.getCoordinates());if(U.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=U[0],null;var H=x,pe=D;en.isCCW(U)&&(H=D,pe=x);var Ge=new fc(U,new Ui(this._argIndex,Ne.BOUNDARY,H,pe));this._lineEdgeMap.put(y,Ge),this.insertEdge(Ge),this.insertPoint(this._argIndex,U[0],Ne.BOUNDARY)},h.prototype.insertPoint=function(y,x,D){var U=this._nodes.addNode(x),H=U.getLabel();null===H?U._label=new Ui(y,D):H.setLocation(y,D)},h.prototype.createEdgeSetIntersector=function(){return new wa},h.prototype.addSelfIntersectionNodes=function(y){for(var x=this._edges.iterator();x.hasNext();)for(var D=x.next(),U=D.getLabel().getLocation(y),H=D.eiList.iterator();H.hasNext();){var pe=H.next();this.addSelfIntersectionNode(y,pe.coord,U)}},h.prototype.add=function(){if(1!==arguments.length)return a.prototype.add.apply(this,arguments);var y=arguments[0];if(y.isEmpty())return null;if(y instanceof Oa&&(this._useBoundaryDeterminationRule=!1),y instanceof ms)this.addPolygon(y);else if(y instanceof ps)this.addLineString(y);else if(y instanceof gs)this.addPoint(y);else if(y instanceof Ac)this.addCollection(y);else if(y instanceof pl)this.addCollection(y);else if(y instanceof Oa)this.addCollection(y);else{if(!(y instanceof zi))throw new Error(y.getClass().getName());this.addCollection(y)}},h.prototype.addCollection=function(y){for(var x=0;x<y.getNumGeometries();x++){var D=y.getGeometryN(x);this.add(D)}},h.prototype.locate=function(y){return Bt(this._parentGeom,_a)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new Fu(this._parentGeom)),this._areaPtLocator.locate(y)):this._ptLocator.locate(y,this._parentGeom)},h.prototype.findEdge=function(){return 1===arguments.length?this._lineEdgeMap.get(arguments[0]):a.prototype.findEdge.apply(this,arguments)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.determineBoundary=function(y,x){return y.isInBoundary(x)?Ne.BOUNDARY:Ne.INTERIOR},h}(ys),Gs=function(){if(this._li=new Yt,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var a=arguments[0];this.setComputationPrecision(a.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new na(0,a)}else if(2===arguments.length){var h=arguments[0],y=arguments[1],x=Ci.OGC_SFS_BOUNDARY_RULE;h.getPrecisionModel().compareTo(y.getPrecisionModel())>=0?this.setComputationPrecision(h.getPrecisionModel()):this.setComputationPrecision(y.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new na(0,h,x),this._arg[1]=new na(1,y,x)}else if(3===arguments.length){var D=arguments[0],U=arguments[1],H=arguments[2];D.getPrecisionModel().compareTo(U.getPrecisionModel())>=0?this.setComputationPrecision(D.getPrecisionModel()):this.setComputationPrecision(U.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new na(0,D,H),this._arg[1]=new na(1,U,H)}};Gs.prototype.getArgGeometry=function(a){return this._arg[a].getGeometry()},Gs.prototype.setComputationPrecision=function(a){this._resultPrecisionModel=a,this._li.setPrecisionModel(this._resultPrecisionModel)},Gs.prototype.interfaces_=function(){return[]},Gs.prototype.getClass=function(){return Gs};var Bu=function(){};Bu.prototype.interfaces_=function(){return[]},Bu.prototype.getClass=function(){return Bu},Bu.map=function(){if(arguments[0]instanceof zn&&Bt(arguments[1],Bu.MapOp)){for(var a=arguments[0],h=arguments[1],y=new Ze,x=0;x<a.getNumGeometries();x++){var D=h.map(a.getGeometryN(x));null!==D&&y.add(D)}return a.getFactory().buildGeometry(y)}if(Bt(arguments[0],be)&&Bt(arguments[1],Bu.MapOp)){for(var U=arguments[0],H=arguments[1],pe=new Ze,Ge=U.iterator();Ge.hasNext();){var wt=Ge.next(),qt=H.map(wt);null!==qt&&pe.add(qt)}return pe}},Bu.MapOp=function(){};var xr=function(a){function h(){var y=arguments[0];a.call(this,y,arguments[1]),this._ptLocator=new ir,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Lr,this._resultPolyList=new Ze,this._resultLineList=new Ze,this._resultPointList=new Ze,this._graph=new ys(new el),this._geomFact=y.getFactory()}return a&&(h.__proto__=a),(h.prototype=Object.create(a&&a.prototype)).constructor=h,h.prototype.insertUniqueEdge=function(y){var x=this._edgeList.findEqualEdge(y);if(null!==x){var D=x.getLabel(),U=y.getLabel();x.isPointwiseEqual(y)||(U=new Ui(y.getLabel())).flip();var H=x.getDepth();H.isNull()&&H.add(D),H.add(U),D.merge(U)}else this._edgeList.add(y)},h.prototype.getGraph=function(){return this._graph},h.prototype.cancelDuplicateResultEdges=function(){for(var y=this._graph.getEdgeEnds().iterator();y.hasNext();){var x=y.next(),D=x.getSym();x.isInResult()&&D.isInResult()&&(x.setInResult(!1),D.setInResult(!1))}},h.prototype.isCoveredByLA=function(y){return!!this.isCovered(y,this._resultLineList)||!!this.isCovered(y,this._resultPolyList)},h.prototype.computeGeometry=function(y,x,D,U){var H=new Ze;return H.addAll(y),H.addAll(x),H.addAll(D),H.isEmpty()?h.createEmptyResult(U,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(H)},h.prototype.mergeSymLabels=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();)y.next().getEdges().mergeSymLabels()},h.prototype.isCovered=function(y,x){for(var D=x.iterator();D.hasNext();){var U=D.next();if(this._ptLocator.locate(y,U)!==Ne.EXTERIOR)return!0}return!1},h.prototype.replaceCollapsedEdges=function(){for(var y=new Ze,x=this._edgeList.iterator();x.hasNext();){var D=x.next();D.isCollapsed()&&(x.remove(),y.add(D.getCollapsedEdge()))}this._edgeList.addAll(y)},h.prototype.updateNodeLabelling=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();){var x=y.next(),D=x.getEdges().getLabel();x.getLabel().merge(D)}},h.prototype.getResultGeometry=function(y){return this.computeOverlay(y),this._resultGeom},h.prototype.insertUniqueEdges=function(y){for(var x=y.iterator();x.hasNext();){var D=x.next();this.insertUniqueEdge(D)}},h.prototype.computeOverlay=function(y){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var x=new Ze;this._arg[0].computeSplitEdges(x),this._arg[1].computeSplitEdges(x),this.insertUniqueEdges(x),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),qr.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(y),this.cancelDuplicateResultEdges();var D=new la(this._geomFact);D.add(this._graph),this._resultPolyList=D.getPolygons();var U=new _o(this,this._geomFact,this._ptLocator);this._resultLineList=U.build(y);var H=new xa(this,this._geomFact,this._ptLocator);this._resultPointList=H.build(y),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,y)},h.prototype.labelIncompleteNode=function(y,x){var D=this._ptLocator.locate(y.getCoordinate(),this._arg[x].getGeometry());y.getLabel().setLocation(x,D)},h.prototype.copyPoints=function(y){for(var x=this._arg[y].getNodeIterator();x.hasNext();){var D=x.next();this._graph.addNode(D.getCoordinate()).setLabel(y,D.getLabel().getLocation(y))}},h.prototype.findResultAreaEdges=function(y){for(var x=this._graph.getEdgeEnds().iterator();x.hasNext();){var D=x.next(),U=D.getLabel();U.isArea()&&!D.isInteriorAreaEdge()&&h.isResultOfOp(U.getLocation(0,Tn.RIGHT),U.getLocation(1,Tn.RIGHT),y)&&D.setInResult(!0)}},h.prototype.computeLabelsFromDepths=function(){for(var y=this._edgeList.iterator();y.hasNext();){var x=y.next(),D=x.getLabel(),U=x.getDepth();if(!U.isNull()){U.normalize();for(var H=0;H<2;H++)D.isNull(H)||!D.isArea()||U.isNull(H)||(0===U.getDelta(H)?D.toLine(H):(Se.isTrue(!U.isNull(H,Tn.LEFT),"depth of LEFT side has not been initialized"),D.setLocation(H,Tn.LEFT,U.getLocation(H,Tn.LEFT)),Se.isTrue(!U.isNull(H,Tn.RIGHT),"depth of RIGHT side has not been initialized"),D.setLocation(H,Tn.RIGHT,U.getLocation(H,Tn.RIGHT))))}}},h.prototype.computeLabelling=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();)y.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},h.prototype.labelIncompleteNodes=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();){var x=y.next(),D=x.getLabel();x.isIsolated()&&(D.isNull(0)?this.labelIncompleteNode(x,0):this.labelIncompleteNode(x,1)),x.getEdges().updateLabelling(D)}},h.prototype.isCoveredByA=function(y){return!!this.isCovered(y,this._resultPolyList)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Gs);xr.overlayOp=function(a,h,y){return new xr(a,h).getResultGeometry(y)},xr.intersection=function(a,h){if(a.isEmpty()||h.isEmpty())return xr.createEmptyResult(xr.INTERSECTION,a,h,a.getFactory());if(a.isGeometryCollection()){var y=h;return co.map(a,{interfaces_:function(){return[Bu.MapOp]},map:function(x){return x.intersection(y)}})}return a.checkNotGeometryCollection(a),a.checkNotGeometryCollection(h),Ls.overlayOp(a,h,xr.INTERSECTION)},xr.symDifference=function(a,h){if(a.isEmpty()||h.isEmpty()){if(a.isEmpty()&&h.isEmpty())return xr.createEmptyResult(xr.SYMDIFFERENCE,a,h,a.getFactory());if(a.isEmpty())return h.copy();if(h.isEmpty())return a.copy()}return a.checkNotGeometryCollection(a),a.checkNotGeometryCollection(h),Ls.overlayOp(a,h,xr.SYMDIFFERENCE)},xr.resultDimension=function(a,h,y){var x=h.getDimension(),D=y.getDimension(),U=-1;switch(a){case xr.INTERSECTION:U=Math.min(x,D);break;case xr.UNION:U=Math.max(x,D);break;case xr.DIFFERENCE:U=x;break;case xr.SYMDIFFERENCE:U=Math.max(x,D)}return U},xr.createEmptyResult=function(a,h,y,x){var D=null;switch(xr.resultDimension(a,h,y)){case-1:D=x.createGeometryCollection(new Array(0).fill(null));break;case 0:D=x.createPoint();break;case 1:D=x.createLineString();break;case 2:D=x.createPolygon()}return D},xr.difference=function(a,h){return a.isEmpty()?xr.createEmptyResult(xr.DIFFERENCE,a,h,a.getFactory()):h.isEmpty()?a.copy():(a.checkNotGeometryCollection(a),a.checkNotGeometryCollection(h),Ls.overlayOp(a,h,xr.DIFFERENCE))},xr.isResultOfOp=function(){if(2===arguments.length){var a=arguments[0],h=arguments[1],y=a.getLocation(0),x=a.getLocation(1);return xr.isResultOfOp(y,x,h)}if(3===arguments.length){var D=arguments[0],U=arguments[1];switch(D===Ne.BOUNDARY&&(D=Ne.INTERIOR),U===Ne.BOUNDARY&&(U=Ne.INTERIOR),arguments[2]){case xr.INTERSECTION:return D===Ne.INTERIOR&&U===Ne.INTERIOR;case xr.UNION:return D===Ne.INTERIOR||U===Ne.INTERIOR;case xr.DIFFERENCE:return D===Ne.INTERIOR&&U!==Ne.INTERIOR;case xr.SYMDIFFERENCE:return D===Ne.INTERIOR&&U!==Ne.INTERIOR||D!==Ne.INTERIOR&&U===Ne.INTERIOR}return!1}},xr.INTERSECTION=1,xr.UNION=2,xr.DIFFERENCE=3,xr.SYMDIFFERENCE=4;var Cu=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new ir,this._seg=new hr;var a=arguments[0],h=arguments[1];this._g=a,this._boundaryDistanceTolerance=h,this._linework=this.extractLinework(a)};Cu.prototype.isWithinToleranceOfBoundary=function(a){for(var h=0;h<this._linework.getNumGeometries();h++)for(var y=this._linework.getGeometryN(h).getCoordinateSequence(),x=0;x<y.size()-1;x++)if(y.getCoordinate(x,this._seg.p0),y.getCoordinate(x+1,this._seg.p1),this._seg.distance(a)<=this._boundaryDistanceTolerance)return!0;return!1},Cu.prototype.getLocation=function(a){return this.isWithinToleranceOfBoundary(a)?Ne.BOUNDARY:this._ptLocator.locate(a,this._g)},Cu.prototype.extractLinework=function(a){var h=new Aa;a.apply(h);var y=h.getLinework(),x=er.toLineStringArray(y);return a.getFactory().createMultiLineString(x)},Cu.prototype.interfaces_=function(){return[]},Cu.prototype.getClass=function(){return Cu};var Aa=function(){this._linework=null,this._linework=new Ze};Aa.prototype.getLinework=function(){return this._linework},Aa.prototype.filter=function(a){if(a instanceof ms){var h=a;this._linework.add(h.getExteriorRing());for(var y=0;y<h.getNumInteriorRing();y++)this._linework.add(h.getInteriorRingN(y))}},Aa.prototype.interfaces_=function(){return[ya]},Aa.prototype.getClass=function(){return Aa};var Al=function(){this._g=null,this._doLeft=!0,this._doRight=!0,this._g=arguments[0]};Al.prototype.extractPoints=function(a,h,y){for(var x=a.getCoordinates(),D=0;D<x.length-1;D++)this.computeOffsetPoints(x[D],x[D+1],h,y)},Al.prototype.setSidesToGenerate=function(a,h){this._doLeft=a,this._doRight=h},Al.prototype.getPoints=function(a){for(var h=new Ze,y=Qt.getLines(this._g).iterator();y.hasNext();){var x=y.next();this.extractPoints(x,a,h)}return h},Al.prototype.computeOffsetPoints=function(a,h,y,x){var D=h.x-a.x,U=h.y-a.y,H=Math.sqrt(D*D+U*U),pe=y*D/H,Ge=y*U/H,wt=(h.x+a.x)/2,qt=(h.y+a.y)/2;if(this._doLeft){var nn=new re(wt-Ge,qt+pe);x.add(nn)}if(this._doRight){var Wn=new re(wt+Ge,qt-pe);x.add(Wn)}},Al.prototype.interfaces_=function(){return[]},Al.prototype.getClass=function(){return Al};var Su=function a(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=a.TOLERANCE,this._testCoords=new Ze;var h=arguments[0],y=arguments[1],x=arguments[2];this._boundaryDistanceTolerance=a.computeBoundaryDistanceTolerance(h,y),this._geom=[h,y,x],this._locFinder=[new Cu(this._geom[0],this._boundaryDistanceTolerance),new Cu(this._geom[1],this._boundaryDistanceTolerance),new Cu(this._geom[2],this._boundaryDistanceTolerance)]},dd={TOLERANCE:{configurable:!0}};Su.prototype.reportResult=function(a,h,y){xn.out.println("Overlay result invalid - A:"+Ne.toLocationSymbol(h[0])+" B:"+Ne.toLocationSymbol(h[1])+" expected:"+(y?"i":"e")+" actual:"+Ne.toLocationSymbol(h[2]))},Su.prototype.isValid=function(a){return this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]),this.checkValid(a)},Su.prototype.checkValid=function(){if(1===arguments.length){for(var a=arguments[0],h=0;h<this._testCoords.size();h++){var y=this._testCoords.get(h);if(!this.checkValid(a,y))return this._invalidLocation=y,!1}return!0}if(2===arguments.length){var x=arguments[0],D=arguments[1];return this._location[0]=this._locFinder[0].getLocation(D),this._location[1]=this._locFinder[1].getLocation(D),this._location[2]=this._locFinder[2].getLocation(D),!!Su.hasLocation(this._location,Ne.BOUNDARY)||this.isValidResult(x,this._location)}},Su.prototype.addTestPts=function(a){var h=new Al(a);this._testCoords.addAll(h.getPoints(5*this._boundaryDistanceTolerance))},Su.prototype.isValidResult=function(a,h){var y=xr.isResultOfOp(h[0],h[1],a),x=!(y^h[2]===Ne.INTERIOR);return x||this.reportResult(a,h,y),x},Su.prototype.getInvalidLocation=function(){return this._invalidLocation},Su.prototype.interfaces_=function(){return[]},Su.prototype.getClass=function(){return Su},Su.hasLocation=function(a,h){for(var y=0;y<3;y++)if(a[y]===h)return!0;return!1},Su.computeBoundaryDistanceTolerance=function(a,h){return Math.min(Ur.computeSizeBasedSnapTolerance(a),Ur.computeSizeBasedSnapTolerance(h))},Su.isValid=function(a,h,y,x){return new Su(a,h,x).isValid(y)},dd.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Su,dd);var Ua=function a(h){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=a.extractFactory(h),this._inputGeoms=h};Ua.prototype.extractElements=function(a,h){if(null===a)return null;for(var y=0;y<a.getNumGeometries();y++){var x=a.getGeometryN(y);this._skipEmpty&&x.isEmpty()||h.add(x)}},Ua.prototype.combine=function(){for(var a=new Ze,h=this._inputGeoms.iterator();h.hasNext();){var y=h.next();this.extractElements(y,a)}return 0===a.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(a)},Ua.prototype.interfaces_=function(){return[]},Ua.prototype.getClass=function(){return Ua},Ua.combine=function(){return 1===arguments.length?new Ua(arguments[0]).combine():2===arguments.length?new Ua(Ua.createList(arguments[0],arguments[1])).combine():3===arguments.length?new Ua(Ua.createList(arguments[0],arguments[1],arguments[2])).combine():void 0},Ua.extractFactory=function(a){return a.isEmpty()?null:a.iterator().next().getFactory()},Ua.createList=function(){if(2===arguments.length){var a=arguments[0],h=arguments[1],y=new Ze;return y.add(a),y.add(h),y}if(3===arguments.length){var x=arguments[0],D=arguments[1],U=arguments[2],H=new Ze;return H.add(x),H.add(D),H.add(U),H}};var no=function(){this._inputPolys=null,this._geomFactory=null,this._inputPolys=arguments[0],null===this._inputPolys&&(this._inputPolys=new Ze)},pd={STRTREE_NODE_CAPACITY:{configurable:!0}};no.prototype.reduceToGeometries=function(a){for(var h=new Ze,y=a.iterator();y.hasNext();){var x=y.next(),D=null;Bt(x,ct)?D=this.unionTree(x):x instanceof zn&&(D=x),h.add(D)}return h},no.prototype.extractByEnvelope=function(a,h,y){for(var x=new Ze,D=0;D<h.getNumGeometries();D++){var U=h.getGeometryN(D);U.getEnvelopeInternal().intersects(a)?x.add(U):y.add(U)}return this._geomFactory.buildGeometry(x)},no.prototype.unionOptimized=function(a,h){var y=a.getEnvelopeInternal(),x=h.getEnvelopeInternal();if(!y.intersects(x))return Ua.combine(a,h);if(a.getNumGeometries()<=1&&h.getNumGeometries()<=1)return this.unionActual(a,h);var D=y.intersection(x);return this.unionUsingEnvelopeIntersection(a,h,D)},no.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var a=new Xc(no.STRTREE_NODE_CAPACITY),h=this._inputPolys.iterator();h.hasNext();){var y=h.next();a.insert(y.getEnvelopeInternal(),y)}this._inputPolys=null;var x=a.itemsTree();return this.unionTree(x)},no.prototype.binaryUnion=function(){if(1===arguments.length){var a=arguments[0];return this.binaryUnion(a,0,a.size())}if(3===arguments.length){var h=arguments[0],y=arguments[1],x=arguments[2];if(x-y<=1){var D=no.getGeometry(h,y);return this.unionSafe(D,null)}if(x-y==2)return this.unionSafe(no.getGeometry(h,y),no.getGeometry(h,y+1));var U=Math.trunc((x+y)/2),H=this.binaryUnion(h,y,U),pe=this.binaryUnion(h,U,x);return this.unionSafe(H,pe)}},no.prototype.repeatedUnion=function(a){for(var h=null,y=a.iterator();y.hasNext();){var x=y.next();h=null===h?x.copy():h.union(x)}return h},no.prototype.unionSafe=function(a,h){return null===a&&null===h?null:null===a?h.copy():null===h?a.copy():this.unionOptimized(a,h)},no.prototype.unionActual=function(a,h){return no.restrictToPolygons(a.union(h))},no.prototype.unionTree=function(a){var h=this.reduceToGeometries(a);return this.binaryUnion(h)},no.prototype.unionUsingEnvelopeIntersection=function(a,h,y){var x=new Ze,D=this.extractByEnvelope(y,a,x),U=this.extractByEnvelope(y,h,x),H=this.unionActual(D,U);return x.add(H),Ua.combine(x)},no.prototype.bufferUnion=function(){if(1===arguments.length){var a=arguments[0];return a.get(0).getFactory().buildGeometry(a).buffer(0)}if(2===arguments.length){var h=arguments[0],y=arguments[1];return h.getFactory().createGeometryCollection([h,y]).buffer(0)}},no.prototype.interfaces_=function(){return[]},no.prototype.getClass=function(){return no},no.restrictToPolygons=function(a){if(Bt(a,_a))return a;var h=un.getPolygons(a);return 1===h.size()?h.get(0):a.getFactory().createMultiPolygon(er.toPolygonArray(h))},no.getGeometry=function(a,h){return h>=a.size()?null:a.get(h)},no.union=function(a){return new no(a).union()},pd.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(no,pd);var ke=function(){};ke.prototype.interfaces_=function(){return[]},ke.prototype.getClass=function(){return ke},ke.union=function(a,h){if(a.isEmpty()||h.isEmpty()){if(a.isEmpty()&&h.isEmpty())return xr.createEmptyResult(xr.UNION,a,h,a.getFactory());if(a.isEmpty())return h.copy();if(h.isEmpty())return a.copy()}return a.checkNotGeometryCollection(a),a.checkNotGeometryCollection(h),Ls.overlayOp(a,h,xr.UNION)},ve.GeoJSONReader=ur,ve.GeoJSONWriter=hh,ve.OverlayOp=xr,ve.UnionOp=ke,ve.BufferOp=ta,Object.defineProperty(ve,"__esModule",{value:!0})}(ot)},4703:Dt=>{Dt.exports=function ve(){for(var me={},q=0;q<arguments.length;q++){var Ee=arguments[q];for(var p in Ee)ot.call(Ee,p)&&(me[p]=Ee[p])}return me};var ot=Object.prototype.hasOwnProperty},9652:(Dt,ot,ve)=>{"use strict";ve.d(ot,{x0:()=>p});let p=(J=21)=>crypto.getRandomValues(new Uint8Array(J)).reduce((ye,Ce)=>ye+((Ce&=63)<36?Ce.toString(36):Ce<62?(Ce-26).toString(36).toUpperCase():Ce>62?"-":"_"),"")}},Dt=>{Dt(Dt.s=6198)}]);